

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CoachHe">
  <meta name="keywords" content="">
  
    <meta name="description" content="ä¸€ã€zookeeperç®€ä»‹ç®€ä»‹zooKeeperç”±é›…è™ç ”ç©¶é™¢å¼€å‘ï¼Œæ˜¯Google Chubbyçš„å¼€æºå®ç°ï¼Œåæ¥æ‰˜ç®¡åˆ° Apacheï¼Œäº2010å¹´11æœˆæ­£å¼æˆä¸ºApacheçš„é¡¶çº§é¡¹ç›®ã€‚  å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿé‡Œçš„å¾ˆå¤šç»„ä»¶çš„å‘½åéƒ½æ˜¯æŸç§åŠ¨ç‰©æˆ–è€…æ˜†è™«ï¼Œæ¯”å¦‚hadoopå°±æ˜¯ ğŸ˜ï¼Œhiveå°±æ˜¯ğŸã€‚zookeeperå³åŠ¨ç‰©å›­ç®¡ç†è€…ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç®¡ç†å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿå„ç»„ä»¶çš„ç®¡ç†å‘˜ã€‚  å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š    zooke">
<meta property="og:type" content="article">
<meta property="og:title" content="Zookeeperç¬”è®°">
<meta property="og:url" content="http://example.com/2022/12/6005cb796f88.html">
<meta property="og:site_name" content="CoachHe&#39;s Blog">
<meta property="og:description" content="ä¸€ã€zookeeperç®€ä»‹ç®€ä»‹zooKeeperç”±é›…è™ç ”ç©¶é™¢å¼€å‘ï¼Œæ˜¯Google Chubbyçš„å¼€æºå®ç°ï¼Œåæ¥æ‰˜ç®¡åˆ° Apacheï¼Œäº2010å¹´11æœˆæ­£å¼æˆä¸ºApacheçš„é¡¶çº§é¡¹ç›®ã€‚  å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿé‡Œçš„å¾ˆå¤šç»„ä»¶çš„å‘½åéƒ½æ˜¯æŸç§åŠ¨ç‰©æˆ–è€…æ˜†è™«ï¼Œæ¯”å¦‚hadoopå°±æ˜¯ ğŸ˜ï¼Œhiveå°±æ˜¯ğŸã€‚zookeeperå³åŠ¨ç‰©å›­ç®¡ç†è€…ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç®¡ç†å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿå„ç»„ä»¶çš„ç®¡ç†å‘˜ã€‚  å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š    zooke">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091859.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092026.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092147.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092714.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092913.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093503.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409104631.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409105129.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110005.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110136.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110236.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093807.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093932.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093950.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094011.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094036.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094049.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094546.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094616.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094656.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094808.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094844.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094911.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407095033.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407095133.png">
<meta property="article:published_time" content="2022-12-03T18:45:56.000Z">
<meta property="article:modified_time" content="2022-12-03T18:48:30.376Z">
<meta property="article:author" content="CoachHe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091859.png">
  
  
  
  <title>Zookeeperç¬”è®° - CoachHe&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Zookeeperç¬”è®°"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-04 02:45" pubdate>
          2022å¹´12æœˆ4æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          27k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          224 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Zookeeperç¬”è®°</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="ä¸€ã€zookeeperç®€ä»‹"><a href="#ä¸€ã€zookeeperç®€ä»‹" class="headerlink" title="ä¸€ã€zookeeperç®€ä»‹"></a>ä¸€ã€zookeeperç®€ä»‹</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>zooKeeperç”±é›…è™ç ”ç©¶é™¢å¼€å‘ï¼Œæ˜¯Google Chubbyçš„å¼€æºå®ç°ï¼Œåæ¥æ‰˜ç®¡åˆ° Apacheï¼Œäº2010å¹´11æœˆæ­£å¼æˆä¸ºApacheçš„é¡¶çº§é¡¹ç›®ã€‚ </p>
<p>å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿé‡Œçš„å¾ˆå¤šç»„ä»¶çš„å‘½åéƒ½æ˜¯æŸç§åŠ¨ç‰©æˆ–è€…æ˜†è™«ï¼Œæ¯”å¦‚hadoopå°±æ˜¯ ğŸ˜ï¼Œhiveå°±æ˜¯ğŸã€‚zookeeperå³åŠ¨ç‰©å›­ç®¡ç†è€…ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç®¡ç†å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿå„ç»„ä»¶çš„ç®¡ç†å‘˜ã€‚ </p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091859.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h2 id="zookeeperåº”ç”¨åœºæ™¯"><a href="#zookeeperåº”ç”¨åœºæ™¯" class="headerlink" title="zookeeperåº”ç”¨åœºæ™¯"></a>zookeeperåº”ç”¨åœºæ™¯</h2><h3 id="1-ç»´æŠ¤é…ç½®ä¿¡æ¯"><a href="#1-ç»´æŠ¤é…ç½®ä¿¡æ¯" class="headerlink" title="1. ç»´æŠ¤é…ç½®ä¿¡æ¯"></a>1. ç»´æŠ¤é…ç½®ä¿¡æ¯</h3><p>javaç¼–ç¨‹ç»å¸¸ä¼šé‡åˆ°é…ç½®é¡¹ï¼Œæ¯”å¦‚æ•°æ®åº“çš„urlã€schemaã€userå’Œpassword ç­‰ã€‚é€šå¸¸è¿™äº›é…ç½®é¡¹æˆ‘ä»¬ä¼šæ”¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå†å°†é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨æœåŠ¡å™¨ä¸Šå½“éœ€è¦æ›´æ”¹é…ç½®é¡¹æ—¶ï¼Œéœ€è¦å»æœåŠ¡å™¨ä¸Šä¿®æ”¹å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ </p>
<p>ä½†æ˜¯éšç€åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…´èµ·ï¼Œç”±äºè®¸å¤šæœåŠ¡éƒ½éœ€è¦ä½¿ç”¨åˆ°è¯¥é…ç½®æ–‡ä»¶ï¼Œå› æ­¤æœ‰å¿…é¡»ä¿è¯è¯¥é…ç½®æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰å’Œå„å°æœåŠ¡å™¨ä¸Šé…ç½®æ•°æ®çš„ä¸€è‡´æ€§ã€‚é€šå¸¸ä¼šå°†é…ç½®æ–‡ä»¶éƒ¨ç½²åœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œç„¶è€Œä¸€ä¸ªé›†ç¾¤åŠ¨è¾„ä¸Šåƒå°æœåŠ¡å™¨ï¼Œæ­¤æ—¶å¦‚æœå†ä¸€å°å°æœåŠ¡å™¨é€ä¸ªä¿®æ”¹é…ç½®æ–‡ä»¶é‚£å°†æ˜¯éå¸¸ç¹çä¸”å±é™©çš„çš„æ“ä½œï¼Œå› æ­¤å°±éœ€è¦ä¸€ç§æœåŠ¡ï¼Œèƒ½å¤Ÿé«˜æ•ˆå¿«é€Ÿä¸”å¯é åœ°å®Œæˆé…ç½®é¡¹çš„æ›´æ”¹ç­‰æ“ä½œï¼Œå¹¶èƒ½å¤Ÿä¿è¯å„é…ç½®é¡¹åœ¨æ¯å°æœåŠ¡å™¨ä¸Šçš„æ•°æ®ä¸€è‡´æ€§ã€‚ </p>
<p>zookeeperå°±å¯ä»¥æä¾›è¿™æ ·ä¸€ç§æœåŠ¡ï¼Œå…¶ä½¿ç”¨Zabè¿™ç§ä¸€è‡´æ€§åè®®æ¥ä¿è¯ä¸€è‡´æ€§ã€‚ç°åœ¨æœ‰å¾ˆå¤šå¼€æºé¡¹ç›®ä½¿ç”¨zookeeperæ¥ç»´æŠ¤é…ç½®ï¼Œæ¯”å¦‚åœ¨hbaseä¸­ï¼Œå®¢æˆ·ç«¯å°±æ˜¯è¿æ¥ä¸€ä¸ªzookeeperï¼Œè·å¾—å¿…è¦çš„hbaseé›†ç¾¤çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åæ‰å¯ä»¥è¿›ä¸€æ­¥æ“ä½œã€‚è¿˜æœ‰åœ¨å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—kafkaä¸­ï¼Œä¹Ÿä½¿ç”¨zookeeperæ¥ç»´æŠ¤brokerçš„ä¿¡æ¯ã€‚åœ¨alibabaå¼€æºçš„soaæ¡†æ¶dubboä¸­ä¹Ÿå¹¿æ³›çš„ä½¿ç”¨zookeeperç®¡ç†ä¸€äº›é…ç½®æ¥å®ç°æœåŠ¡æ²»ç†ã€‚ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092026.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h3 id="2-åˆ†å¸ƒå¼é”æœåŠ¡"><a href="#2-åˆ†å¸ƒå¼é”æœåŠ¡" class="headerlink" title="2. åˆ†å¸ƒå¼é”æœåŠ¡"></a>2. åˆ†å¸ƒå¼é”æœåŠ¡</h3><p>ä¸€ä¸ªé›†ç¾¤æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”±å¤šå°æœåŠ¡å™¨ç»„æˆã€‚ä¸ºäº†æé«˜å¹¶å‘åº¦å’Œå¯é æ€§ï¼Œ å¤šå°æœåŠ¡å™¨ä¸Šè¿è¡Œç€åŒä¸€ç§æœåŠ¡ã€‚å½“å¤šä¸ªæœåŠ¡åœ¨è¿è¡Œæ—¶å°±éœ€è¦åè°ƒå„æœåŠ¡çš„è¿›åº¦ï¼Œæœ‰æ—¶å€™éœ€è¦ä¿è¯å½“æŸä¸ªæœåŠ¡åœ¨è¿›è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œå…¶ä»–çš„æœåŠ¡éƒ½ä¸èƒ½è¿›è¡Œè¯¥æ“ä½œï¼Œå³å¯¹è¯¥æ“ä½œè¿›è¡ŒåŠ é”ï¼Œå¦‚æœå½“å‰æœºå™¨æŒ‚æ‰åï¼Œé‡Šæ”¾é”å¹¶fail over åˆ°å…¶ä»–çš„æœºå™¨ç»§ç»­æ‰§è¡Œè¯¥æœåŠ¡ã€‚ </p>
<h3 id="3-é›†ç¾¤ç®¡ç†"><a href="#3-é›†ç¾¤ç®¡ç†" class="headerlink" title="3. é›†ç¾¤ç®¡ç†"></a>3. é›†ç¾¤ç®¡ç†</h3><p>ä¸€ä¸ªé›†ç¾¤æœ‰æ—¶ä¼šå› ä¸ºå„ç§è½¯ç¡¬ä»¶æ•…éšœæˆ–è€…ç½‘ç»œæ•…éšœï¼Œå‡ºç°æŸäº›æœåŠ¡å™¨æŒ‚æ‰è€Œè¢«ç§»é™¤é›†ç¾¤ï¼Œè€ŒæŸäº›æœåŠ¡å™¨åŠ å…¥åˆ°é›†ç¾¤ä¸­çš„æƒ…å†µï¼Œzookeeperä¼šå°†è¿™äº›æœåŠ¡å™¨åŠ å…¥&#x2F;ç§»å‡ºçš„æƒ…å†µé€šçŸ¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–æ­£å¸¸å·¥ä½œçš„æœåŠ¡å™¨ï¼Œä»¥åŠæ—¶è°ƒæ•´å­˜å‚¨å’Œè®¡ç®—ç­‰ä»»åŠ¡çš„åˆ†é…å’Œæ‰§è¡Œç­‰ã€‚æ­¤å¤–zookeeperè¿˜ä¼šå¯¹æ•…éšœçš„æœåŠ¡å™¨åšå‡ºè¯Šæ–­å¹¶å°è¯•ä¿®å¤ã€‚ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092147.png" srcset="/img/loading.gif" lazyload style="zoom:33%;" />

<h3 id="4-ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€ID"><a href="#4-ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€ID" class="headerlink" title="4. ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€ID"></a>4. ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€ID</h3><p>åœ¨è¿‡å»çš„å•åº“å•è¡¨å‹ç³»ç»Ÿä¸­ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨æ•°æ®åº“å­—æ®µè‡ªå¸¦çš„auto_increment å±æ€§æ¥è‡ªåŠ¨ä¸ºæ¯æ¡è®°å½•ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDã€‚ä½†æ˜¯åˆ†åº“åˆ†è¡¨åï¼Œå°±æ— æ³•åœ¨ä¾é æ•°æ®åº“çš„ auto_incrementå±æ€§æ¥å”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨zookeeperåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”Ÿæˆå…¨å±€å”¯ä¸€IDã€‚</p>
<h4 id="åšæ³•"><a href="#åšæ³•" class="headerlink" title="åšæ³•"></a>åšæ³•</h4><p>æ¯æ¬¡è¦ç”Ÿæˆä¸€ä¸ªæ–°Idæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»º æ“ä½œè¿”å›çš„èŠ‚ç‚¹åºå·ï¼Œå³ä¸ºæ–°Idï¼Œç„¶åæŠŠæ¯”è‡ªå·±èŠ‚ç‚¹å°çš„åˆ é™¤å³å¯ </p>
<h2 id="zookeeperçš„è®¾è®¡ç›®æ ‡"><a href="#zookeeperçš„è®¾è®¡ç›®æ ‡" class="headerlink" title="zookeeperçš„è®¾è®¡ç›®æ ‡"></a>zookeeperçš„è®¾è®¡ç›®æ ‡</h2><h3 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h3><p>zooKeeperè‡´åŠ›äºä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€ä¸ª<strong>é«˜æ€§èƒ½</strong>ã€<strong>é«˜å¯ç”¨</strong>ï¼Œä¸”å…·æœ‰<strong>ä¸¥æ ¼é¡ºåºè®¿é—®æ§åˆ¶èƒ½åŠ›</strong>çš„<strong>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</strong> </p>
<h3 id="1-é«˜æ€§èƒ½"><a href="#1-é«˜æ€§èƒ½" class="headerlink" title="1. é«˜æ€§èƒ½"></a>1. é«˜æ€§èƒ½</h3><p>zooKeeperå°†å…¨é‡æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ç›´æ¥æœåŠ¡äºå®¢æˆ·ç«¯çš„æ‰€æœ‰éäº‹åŠ¡è¯·æ±‚ï¼Œå°¤ å…¶é€‚ç”¨äºä»¥è¯»ä¸ºä¸»çš„åº”ç”¨åœºæ™¯ </p>
<h3 id="2-é«˜å¯ç”¨"><a href="#2-é«˜å¯ç”¨" class="headerlink" title="2. é«˜å¯ç”¨"></a>2. é«˜å¯ç”¨</h3><p>zooKeeperä¸€èˆ¬ä»¥é›†ç¾¤çš„æ–¹å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸€èˆ¬3 ~ 5å°æœºå™¨å°±å¯ä»¥ç»„æˆä¸€ä¸ªå¯ç”¨çš„Zookeeperé›†ç¾¤äº†ï¼Œæ¯å°æœºå™¨éƒ½ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤å½“å‰çš„æœåŠ¡å™¨çŠ¶æ€ï¼Œå¹¶ä¸”æ¯å°æœºå™¨ä¹‹é—´éƒ½ç›¸äº’ä¿æŒç€é€šä¿¡ã€‚åªè¦é›†ç¾¤ä¸­è¶…è¿‡ä¸€åŠçš„æœºå™¨éƒ½èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±èƒ½å¤Ÿæ­£å¸¸å¯¹å¤–æœåŠ¡ </p>
<h3 id="3-ä¸¥æ ¼è®¿é—®é¡ºåº"><a href="#3-ä¸¥æ ¼è®¿é—®é¡ºåº" class="headerlink" title="3. ä¸¥æ ¼è®¿é—®é¡ºåº"></a>3. ä¸¥æ ¼è®¿é—®é¡ºåº</h3><p>å¯¹äºæ¥è‡ªå®¢æˆ·ç«¯çš„æ¯ä¸ªæ›´æ–°è¯·æ±‚ï¼ŒZooKeeperéƒ½ä¼šåˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„é€’å¢ç¼–å·ï¼Œ è¿™ä¸ªç¼–å·åæ˜ äº†æ‰€æœ‰äº‹åŠ¡æ“ä½œçš„å…ˆåé¡ºåº</p>
<h1 id="äºŒã€zookeeperçš„æ•°æ®æ¨¡å‹"><a href="#äºŒã€zookeeperçš„æ•°æ®æ¨¡å‹" class="headerlink" title="äºŒã€zookeeperçš„æ•°æ®æ¨¡å‹"></a>äºŒã€zookeeperçš„æ•°æ®æ¨¡å‹</h1><h2 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>zookeeperçš„æ•°æ®èŠ‚ç‚¹å¯ä»¥è§†ä¸ºæ ‘çŠ¶ç»“æ„ï¼ˆæˆ–è€…ç›®å½•ï¼‰ï¼Œæ ‘ä¸­çš„å„èŠ‚ç‚¹è¢«ç§°ä¸º znodeï¼ˆå³zookeeper nodeï¼‰ï¼Œä¸€ä¸ªznodeå¯ä»¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ã€‚ </p>
<p>zookeeperèŠ‚ç‚¹åœ¨ç»“æ„ä¸Šè¡¨ç°ä¸ºæ ‘çŠ¶ï¼› </p>
<p>ä½¿ç”¨è·¯å¾„pathæ¥å®šä½æŸä¸ªznodeï¼Œæ¯”å¦‚&#x2F;ns1&#x2F;itcast&#x2F;mysql&#x2F;schema1&#x2F;table1ï¼Œæ­¤å¤„ns-1ã€itcastã€mysqlã€schema1ã€table1åˆ†åˆ«æ˜¯æ ¹èŠ‚ç‚¹ã€2çº§èŠ‚ç‚¹ã€3çº§èŠ‚ç‚¹ä»¥åŠ4çº§èŠ‚ç‚¹ï¼› </p>
<p>å…¶ä¸­ns-1æ˜¯itcastçš„çˆ¶èŠ‚ç‚¹ï¼Œitcastæ˜¯ns-1çš„å­ èŠ‚ç‚¹ï¼Œitcastæ˜¯mysqlçš„çˆ¶èŠ‚ç‚¹ï¼Œmysqlæ˜¯itcastçš„å­èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚ </p>
<h3 id="znode"><a href="#znode" class="headerlink" title="znode"></a>znode</h3><p>znodeï¼Œå…¼å…·æ–‡ä»¶å’Œç›®å½•ä¸¤ç§ç‰¹ç‚¹ã€‚æ—¢åƒæ–‡ä»¶ä¸€æ ·ç»´æŠ¤ç€æ•°æ®ã€å…ƒä¿¡æ¯ã€ACLã€æ—¶ é—´æˆ³ç­‰æ•°æ®ç»“æ„ï¼Œåˆåƒç›®å½•ä¸€æ ·å¯ä»¥ä½œä¸ºè·¯å¾„æ ‡è¯†çš„ä¸€éƒ¨åˆ†ã€‚ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092714.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="å¦‚ä½•æè¿°ä¸€ä¸ªznodeï¼Ÿ"><a href="#å¦‚ä½•æè¿°ä¸€ä¸ªznodeï¼Ÿ" class="headerlink" title="å¦‚ä½•æè¿°ä¸€ä¸ªznodeï¼Ÿ"></a>å¦‚ä½•æè¿°ä¸€ä¸ªznodeï¼Ÿ</h2><p>ä¸€ä¸ªznodeå¤§ä½“ä¸Šåˆ†ä¸º3å„éƒ¨åˆ†ï¼š </p>
<ol>
<li>èŠ‚ç‚¹çš„æ•°æ®ï¼šå³znode data(èŠ‚ç‚¹path, èŠ‚ç‚¹data)çš„å…³ç³»å°±åƒæ˜¯java mapä¸­(key, value)çš„å…³ç³» </li>
<li>èŠ‚ç‚¹çš„å­èŠ‚ç‚¹children </li>
<li>èŠ‚ç‚¹çš„çŠ¶æ€statï¼šç”¨æ¥æè¿°å½“å‰èŠ‚ç‚¹çš„åˆ›å»ºã€ä¿®æ”¹è®°å½•ï¼ŒåŒ…æ‹¬cZxidã€ctimeç­‰</li>
</ol>
<h2 id="èŠ‚ç‚¹çŠ¶æ€statçš„å±æ€§"><a href="#èŠ‚ç‚¹çŠ¶æ€statçš„å±æ€§" class="headerlink" title="èŠ‚ç‚¹çŠ¶æ€statçš„å±æ€§"></a>èŠ‚ç‚¹çŠ¶æ€statçš„å±æ€§</h2><p>åœ¨zookeeper shellä¸­ä½¿ç”¨getå‘½ä»¤æŸ¥çœ‹æŒ‡å®šè·¯å¾„èŠ‚ç‚¹çš„dataã€statä¿¡æ¯ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092913.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h3 id="å±æ€§è¯´æ˜"><a href="#å±æ€§è¯´æ˜" class="headerlink" title="å±æ€§è¯´æ˜"></a>å±æ€§è¯´æ˜</h3><ul>
<li>cZxidï¼šæ•°æ®èŠ‚ç‚¹åˆ›å»ºæ—¶çš„äº‹åŠ¡ ID </li>
<li>ctimeï¼šæ•°æ®èŠ‚ç‚¹åˆ›å»ºæ—¶çš„æ—¶é—´ </li>
<li>mZxidï¼šæ•°æ®èŠ‚ç‚¹æœ€åä¸€æ¬¡æ›´æ–°æ—¶çš„äº‹åŠ¡ ID </li>
<li>mtimeï¼šæ•°æ®èŠ‚ç‚¹æœ€åä¸€æ¬¡æ›´æ–°æ—¶çš„æ—¶é—´ </li>
<li>pZxidï¼šæ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡ ID </li>
<li>cversionï¼šå­èŠ‚ç‚¹çš„æ›´æ”¹æ¬¡æ•° </li>
<li>dataVersionï¼šèŠ‚ç‚¹æ•°æ®çš„æ›´æ”¹æ¬¡æ•° </li>
<li>aclVersionï¼šèŠ‚ç‚¹çš„ ACL çš„æ›´æ”¹æ¬¡æ•° </li>
<li>ephemeralOwnerï¼šå¦‚æœèŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ™è¡¨ç¤ºåˆ›å»ºè¯¥èŠ‚ç‚¹çš„ä¼šè¯çš„ SessionIDï¼›å¦‚æœèŠ‚ç‚¹æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Œåˆ™è¯¥å±æ€§å€¼ä¸º 0 </li>
<li>dataLengthï¼šæ•°æ®å†…å®¹çš„é•¿åº¦ </li>
<li>numChildrenï¼šæ•°æ®èŠ‚ç‚¹å½“å‰çš„å­èŠ‚ç‚¹ä¸ªæ•°</li>
</ul>
<h2 id="zookeeperèŠ‚ç‚¹ç±»å‹"><a href="#zookeeperèŠ‚ç‚¹ç±»å‹" class="headerlink" title="zookeeperèŠ‚ç‚¹ç±»å‹"></a>zookeeperèŠ‚ç‚¹ç±»å‹</h2><p>zookeeperä¸­çš„èŠ‚ç‚¹æœ‰ä¸¤ç§ï¼š </p>
<p>ä¸´æ—¶èŠ‚ç‚¹å’Œæ°¸ä¹…èŠ‚ç‚¹ã€‚èŠ‚ç‚¹çš„ç±»å‹åœ¨åˆ›å»ºæ—¶å³è¢«ç¡®å®šï¼Œå¹¶ä¸”ä¸èƒ½æ”¹å˜ã€‚ </p>
<h3 id="ä¸´æ—¶èŠ‚ç‚¹"><a href="#ä¸´æ—¶èŠ‚ç‚¹" class="headerlink" title="ä¸´æ—¶èŠ‚ç‚¹"></a>ä¸´æ—¶èŠ‚ç‚¹</h3><p>è¯¥èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¾èµ–äºåˆ›å»ºå®ƒä»¬çš„ä¼šè¯ã€‚ä¸€æ—¦ä¼šè¯(Session)ç»“æŸï¼Œä¸´ æ—¶èŠ‚ç‚¹å°†è¢«è‡ªåŠ¨åˆ é™¤ï¼Œå½“ç„¶å¯ä»¥ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ é™¤ã€‚è™½ç„¶æ¯ä¸ªä¸´æ—¶çš„Znodeéƒ½ä¼šç»‘å®šåˆ°ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼Œä½†ä»–ä»¬å¯¹æ‰€æœ‰çš„å®¢æˆ·ç«¯è¿˜æ˜¯å¯è§çš„ã€‚å¦å¤–ï¼ŒZooKeeperçš„ä¸´æ—¶èŠ‚ç‚¹ä¸å…è®¸æ‹¥æœ‰å­èŠ‚ç‚¹ã€‚ </p>
<h3 id="æŒä¹…åŒ–èŠ‚ç‚¹"><a href="#æŒä¹…åŒ–èŠ‚ç‚¹" class="headerlink" title="æŒä¹…åŒ–èŠ‚ç‚¹"></a>æŒä¹…åŒ–èŠ‚ç‚¹</h3><p>è¯¥èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¸ä¾èµ–äºä¼šè¯ï¼Œå¹¶ä¸”åªæœ‰åœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºæ‰§è¡Œåˆ é™¤æ“ä½œçš„æ—¶å€™ï¼Œä»–ä»¬æ‰èƒ½è¢«åˆ é™¤ </p>
<h1 id="ä¸‰ã€zookeeperå•æœºå®‰è£…"><a href="#ä¸‰ã€zookeeperå•æœºå®‰è£…" class="headerlink" title="ä¸‰ã€zookeeperå•æœºå®‰è£…"></a>ä¸‰ã€zookeeperå•æœºå®‰è£…</h1><h2 id="æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²"><a href="#æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²" class="headerlink" title="æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²"></a>æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²</h2><h3 id="å®‰è£…å‰å‡†å¤‡"><a href="#å®‰è£…å‰å‡†å¤‡" class="headerlink" title="å®‰è£…å‰å‡†å¤‡"></a>å®‰è£…å‰å‡†å¤‡</h3><p>ï¼ˆ1ï¼‰å®‰è£…Jdk </p>
<p>ï¼ˆ2ï¼‰æ‹·è´Zookeeperå®‰è£…åŒ…åˆ°Linuxç³»ç»Ÿä¸‹ </p>
<p>ï¼ˆ3ï¼‰è§£å‹åˆ°æŒ‡å®šç›®å½• </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/ <br></code></pre></td></tr></table></figure>

<h3 id="é…ç½®ä¿®æ”¹"><a href="#é…ç½®ä¿®æ”¹" class="headerlink" title="é…ç½®ä¿®æ”¹"></a>é…ç½®ä¿®æ”¹</h3><p>ï¼ˆ1ï¼‰å°†&#x2F;opt&#x2F;module&#x2F;zookeeper-3.4.10&#x2F;confè¿™ä¸ªè·¯å¾„ä¸‹çš„zoo_sample.cfgä¿®æ”¹ä¸ºzoo.cfgï¼› </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 conf]$ mv zoo_sample.cfg zoo.cfg<br></code></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æ‰“å¼€zoo.cfgæ–‡ä»¶ï¼Œä¿®æ”¹dataDirè·¯å¾„ï¼š </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ vim zoo.cfg<br></code></pre></td></tr></table></figure>

<p>ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">dataDir=/opt/module/zookeeper-3.4.10/zkData <br></code></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰åœ¨&#x2F;opt&#x2F;module&#x2F;zookeeper-3.4.10&#x2F;è¿™ä¸ªç›®å½•ä¸Šåˆ›å»ºzkDataæ–‡ä»¶å¤¹ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ mkdir zkData <br></code></pre></td></tr></table></figure>

<h3 id="æ“ä½œzookeeper"><a href="#æ“ä½œzookeeper" class="headerlink" title="æ“ä½œzookeeper"></a>æ“ä½œzookeeper</h3><p>ï¼ˆ1ï¼‰å¯åŠ¨Zookeeper </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh start<br></code></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ jps <br>4020 Jps <br>4001 QuorumPeerMain <br></code></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰æŸ¥çœ‹çŠ¶æ€ï¼š </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh status <br>ZooKeeper JMX enabled by default <br>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg <br>Mode: standalone <br></code></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰å¯åŠ¨å®¢æˆ·ç«¯ï¼š </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkCli.sh<br></code></pre></td></tr></table></figure>

<p>ï¼ˆ5ï¼‰é€€å‡ºå®¢æˆ·ç«¯ï¼š </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk: localhost:2181(CONNECTED) 0] quit <br></code></pre></td></tr></table></figure>

<p>ï¼ˆ6ï¼‰åœæ­¢Zookeeper </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh stop<br></code></pre></td></tr></table></figure>

<p> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093503.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="é…ç½®å‚æ•°è§£è¯»"><a href="#é…ç½®å‚æ•°è§£è¯»" class="headerlink" title="é…ç½®å‚æ•°è§£è¯»"></a>é…ç½®å‚æ•°è§£è¯»</h3><p>1ï¼tickTime &#x3D;2000ï¼šé€šä¿¡å¿ƒè·³æ•°ï¼ŒZookeeperæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’ </p>
<p>Zookeeperä½¿ç”¨çš„åŸºæœ¬æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ï¼Œæ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚ </p>
<p>å®ƒç”¨äºå¿ƒè·³æœºåˆ¶ï¼Œå¹¶ä¸”è®¾ç½®æœ€å°çš„sessionè¶…æ—¶æ—¶é—´ä¸ºä¸¤å€å¿ƒè·³æ—¶é—´ã€‚(sessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTime) </p>
<p>2ï¼initLimit &#x3D;10ï¼šLFåˆå§‹é€šä¿¡æ—¶é™ </p>
<p>é›†ç¾¤ä¸­çš„Followerè·Ÿéšè€…æœåŠ¡å™¨ä¸Leaderé¢†å¯¼è€…æœåŠ¡å™¨ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ï¼Œç”¨å®ƒæ¥é™å®šé›†ç¾¤ä¸­çš„ZookeeperæœåŠ¡å™¨è¿æ¥åˆ°Leaderçš„æ—¶é™ã€‚ </p>
<p>3ï¼syncLimit &#x3D;5ï¼šLFåŒæ­¥é€šä¿¡æ—¶é™ </p>
<p>é›†ç¾¤ä¸­Leaderä¸Followerä¹‹é—´çš„æœ€å¤§å“åº”æ—¶é—´å•ä½ï¼Œå‡å¦‚å“åº”è¶…è¿‡syncLimit * tickTimeï¼ŒLeaderè®¤ä¸ºFollweræ­»æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwerã€‚ </p>
<p>4ï¼dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„ </p>
<p>ä¸»è¦ç”¨äºä¿å­˜Zookeeperä¸­çš„æ•°æ®ã€‚ </p>
<p>5ï¼clientPort &#x3D;2181ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ </p>
<p>ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£ã€‚ </p>
<h2 id="é›†ç¾¤éƒ¨ç½²"><a href="#é›†ç¾¤éƒ¨ç½²" class="headerlink" title="é›†ç¾¤éƒ¨ç½²"></a>é›†ç¾¤éƒ¨ç½²</h2><h3 id="é…ç½®æ›´æ”¹"><a href="#é…ç½®æ›´æ”¹" class="headerlink" title="é…ç½®æ›´æ”¹"></a>é…ç½®æ›´æ”¹</h3><p>åœ¨å•æœºæ¨¡å¼çš„åŸºç¡€ä¸Šã€‚é¦–å…ˆ</p>
<ol>
<li><p>åœ¨<code>/opt/module/zookeeper-3.4.14/zkData</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidçš„æ–‡ä»¶ï¼Œå°†å…¶è®¾ç½®ä¸º1</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409104631.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />
</li>
<li><p>å°†<code>/opt/module/zookeeper-3.4.14</code>æ‹·è´åˆ°å…¶ä»–æœºå™¨ä¸Š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/home/bin/xsync /opt/module/zookeeper-3.4.14<br></code></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ”¹zoo.cfgï¼Œå¢åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">########cluster########</span></span><br>server.1=chadoop1:2888:3888<br>server.2=chadoop2:2888:3888<br>server.3=chadoop3:2888:3888<br></code></pre></td></tr></table></figure>

<p>é…ç½®å‚æ•°è§£è¯»</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">server.A=B:C:D<br></code></pre></td></tr></table></figure>

<p><strong>A</strong> æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨ï¼›</p>
<p>é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶ myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ dataDir ç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯ A çš„å€¼ï¼ŒZookeeper å¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸ zoo.cfg é‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ª serverã€‚ </p>
<p><strong>B</strong> æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼›</p>
<p><strong>C</strong> æ˜¯è¿™ä¸ªæœåŠ¡å™¨ Follower ä¸é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼›</p>
<p><strong>D</strong> æ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚</p>
</li>
<li><p>åŒæ­¥zoo.cfg</p>
</li>
</ol>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409105129.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<ol start="5">
<li>ä¿®æ”¹æ¯ä¸ªæœåŠ¡å™¨ä¸­çš„myidä¸ºå¯¹åº”æœåŠ¡å™¨å·</li>
</ol>
<h3 id="å¯åŠ¨é›†ç¾¤"><a href="#å¯åŠ¨é›†ç¾¤" class="headerlink" title="å¯åŠ¨é›†ç¾¤"></a>å¯åŠ¨é›†ç¾¤</h3><ol>
<li><p>åˆ†åˆ«åœ¨ä¸‰ä¸ªé›†ç¾¤æ‰§è¡Œå¯åŠ¨æŒ‡ä»¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zkServer.sh start<br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110005.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />
</li>
<li><p>æŸ¥çœ‹çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zkServer.sh status<br></code></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ä¸»æœºchadoop1ï¼š</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110136.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>ç¬¬äºŒä¸ªæ‰§è¡Œçš„ä¸»æœºchadoop2ï¼š</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110236.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒä¸ªæ‰§è¡Œçš„æ˜¯leaderï¼Œè¯´æ˜å¯åŠ¨æ­£å¸¸ï¼</p>
</li>
</ol>
<h1 id="å››ã€zookeeperå¸¸ç”¨Shellå‘½ä»¤"><a href="#å››ã€zookeeperå¸¸ç”¨Shellå‘½ä»¤" class="headerlink" title="å››ã€zookeeperå¸¸ç”¨Shellå‘½ä»¤"></a>å››ã€zookeeperå¸¸ç”¨Shellå‘½ä»¤</h1><h2 id="1-æ–°å¢èŠ‚ç‚¹"><a href="#1-æ–°å¢èŠ‚ç‚¹" class="headerlink" title="1. æ–°å¢èŠ‚ç‚¹"></a>1. æ–°å¢èŠ‚ç‚¹</h2><h3 id="ä¸¤ç§å‚æ•°"><a href="#ä¸¤ç§å‚æ•°" class="headerlink" title="ä¸¤ç§å‚æ•°"></a>ä¸¤ç§å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">create [-s] [-e] path data <br>-s: <br>æœ‰åºèŠ‚ç‚¹ <br>-e: <br>ä¸´æ—¶èŠ‚ç‚¹ <br></code></pre></td></tr></table></figure>

<p>å› æ­¤å…±æœ‰4ç§ç»„åˆï¼Œåˆ†åˆ«ä¸º </p>
<ol>
<li>æŒä¹…åŒ–æœ‰åºèŠ‚ç‚¹ </li>
<li>æŒä¹…åŒ–æ— åºèŠ‚ç‚¹ </li>
<li>ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ </li>
<li>ä¸´æ—¶æ— åºèŠ‚ç‚¹ã€‚</li>
</ol>
<h4 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h4><p>ä¼šè¯ç»“æŸä¹‹åèŠ‚ç‚¹è¿˜ä¼šä¿ç•™ä¸‹æ¥çš„èŠ‚ç‚¹å«åšæŒä¹…åŒ–èŠ‚ç‚¹ã€‚ </p>
<p>æœ‰åºèŠ‚ç‚¹ä¼šåœ¨åˆ›å»ºæ—¶è·¯å¾„åé¢æ·»åŠ ä¸€ä¸ªåºåˆ—å·ã€‚ </p>
<p> é»˜è®¤æ˜¯æŒä¹…åŒ–æ— åºèŠ‚ç‚¹ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093807.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h3 id="åˆ›å»ºæŒä¹…åŒ–æ— åºèŠ‚ç‚¹"><a href="#åˆ›å»ºæŒä¹…åŒ–æ— åºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºæŒä¹…åŒ–æ— åºèŠ‚ç‚¹"></a>åˆ›å»ºæŒä¹…åŒ–æ— åºèŠ‚ç‚¹</h3><p>é»˜è®¤ä¸ºæŒä¹…åŒ–æ— åºèŠ‚ç‚¹ï¼Œç›´æ¥createå³å¯ã€‚ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093932.png" srcset="/img/loading.gif" lazyload style="zoom:33%;" />

<h3 id="åˆ›å»ºæŒä¹…åŒ–æœ‰åºèŠ‚ç‚¹"><a href="#åˆ›å»ºæŒä¹…åŒ–æœ‰åºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºæŒä¹…åŒ–æœ‰åºèŠ‚ç‚¹"></a>åˆ›å»ºæŒä¹…åŒ–æœ‰åºèŠ‚ç‚¹</h3><h4 id="è§£é‡Š-1"><a href="#è§£é‡Š-1" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h4><p>ä¼šè¯ç»“æŸä¹‹åèŠ‚ç‚¹è¿˜ä¼šä¿ç•™ä¸‹æ¥çš„èŠ‚ç‚¹å«åšæŒä¹…åŒ–èŠ‚ç‚¹ã€‚ </p>
<h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">create -s path data <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093950.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>å¯ä»¥ç”¨æ¥åˆ›å»ºå”¯ä¸€ID </p>
<h3 id="åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹"><a href="#åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹"></a>åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹</h3><h4 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">create -s -e path name <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094011.png" srcset="/img/loading.gif" lazyload style="zoom:33%;" />

<h4 id="ä½œç”¨-1"><a href="#ä½œç”¨-1" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ç”¨æ¥ç”Ÿæˆåˆ†å¸ƒå¼é”</p>
<h3 id="åˆ›å»ºä¸´æ—¶æ— åºèŠ‚ç‚¹"><a href="#åˆ›å»ºä¸´æ—¶æ— åºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºä¸´æ—¶æ— åºèŠ‚ç‚¹"></a>åˆ›å»ºä¸´æ—¶æ— åºèŠ‚ç‚¹</h3><h4 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">create -e path name<br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094036.png" srcset="/img/loading.gif" lazyload style="zoom:33%;" />

<h4 id="é‡å¯ä¹‹åæ¶ˆå¤±"><a href="#é‡å¯ä¹‹åæ¶ˆå¤±" class="headerlink" title="é‡å¯ä¹‹åæ¶ˆå¤±"></a>é‡å¯ä¹‹åæ¶ˆå¤±</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094049.png" srcset="/img/loading.gif" lazyload style="zoom:33%;" />



<h2 id="2-æ›´æ–°èŠ‚ç‚¹"><a href="#2-æ›´æ–°èŠ‚ç‚¹" class="headerlink" title="2. æ›´æ–°èŠ‚ç‚¹"></a>2. æ›´æ–°èŠ‚ç‚¹</h2><h3 id="è¯­æ³•-3"><a href="#è¯­æ³•-3" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">set path new_data <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094546.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="åŸºäºç‰ˆæœ¬å·ä¿®æ”¹"><a href="#åŸºäºç‰ˆæœ¬å·ä¿®æ”¹" class="headerlink" title="åŸºäºç‰ˆæœ¬å·ä¿®æ”¹"></a>åŸºäºç‰ˆæœ¬å·ä¿®æ”¹</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094616.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="3-åˆ é™¤èŠ‚ç‚¹"><a href="#3-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="3. åˆ é™¤èŠ‚ç‚¹"></a>3. åˆ é™¤èŠ‚ç‚¹</h2><h3 id="è¯­æ³•-4"><a href="#è¯­æ³•-4" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">delete path [version] <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094656.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="4-æŸ¥çœ‹èŠ‚ç‚¹"><a href="#4-æŸ¥çœ‹èŠ‚ç‚¹" class="headerlink" title="4. æŸ¥çœ‹èŠ‚ç‚¹"></a>4. æŸ¥çœ‹èŠ‚ç‚¹</h2><h3 id="è¯­æ³•-5"><a href="#è¯­æ³•-5" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">get path<br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094808.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="å±æ€§è§£é‡Š"><a href="#å±æ€§è§£é‡Š" class="headerlink" title="å±æ€§è§£é‡Š"></a>å±æ€§è§£é‡Š</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094844.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="å­èŠ‚ç‚¹åˆ›å»ºå’Œæ›´æ”¹"><a href="#å­èŠ‚ç‚¹åˆ›å»ºå’Œæ›´æ”¹" class="headerlink" title="å­èŠ‚ç‚¹åˆ›å»ºå’Œæ›´æ”¹"></a>å­èŠ‚ç‚¹åˆ›å»ºå’Œæ›´æ”¹</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094911.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h3><p>å¯ä»¥ä½¿ç”¨ stat å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œå®ƒçš„è¿”å›å€¼å’Œ get å‘½ä»¤ç±»ä¼¼ï¼Œä½†ä¸ä¼šè¿”å›èŠ‚ç‚¹æ•°æ®</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407095033.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="5-æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨"><a href="#5-æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨" class="headerlink" title="5. æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨"></a>5. æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨</h2><p>æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨æœ‰ ls path å’Œ ls2 path ä¸¤ä¸ªå‘½ä»¤ï¼Œåè€…æ˜¯å‰è€…çš„å¢å¼ºï¼Œä¸ä»…å¯ä»¥æŸ¥çœ‹æŒ‡å®šè·¯å¾„ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„ä¿¡æ¯ </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407095133.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="6-ç›‘å¬å™¨"><a href="#6-ç›‘å¬å™¨" class="headerlink" title="6. ç›‘å¬å™¨"></a>6. ç›‘å¬å™¨</h2><h3 id="1-get-path-watch"><a href="#1-get-path-watch" class="headerlink" title="1. get path [watch]"></a>1. get path [watch]</h3><p>ä½¿ç”¨<code>get path [watch]</code>æ³¨å†Œçš„ç›‘å¬å™¨èƒ½å¤Ÿåœ¨èŠ‚ç‚¹å†…å®¹å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºé€šçŸ¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯zookeeperçš„è§¦å‘å™¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼ˆone-time triggerï¼‰ï¼Œå³è§¦å‘ä¸€æ¬¡åå°±ä¼šç«‹å³å¤±æ•ˆã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk:localhost:2181(CONNECTED) 4] get /hadoop watch<br>[zk:localhost:2181(CONNECTED) 5] set /hadoop 45678<br>WATCHER::<br>WatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop #èŠ‚ç‚¹å€¼æ”¹å˜<br></code></pre></td></tr></table></figure>

<h3 id="2-stat-path-watch"><a href="#2-stat-path-watch" class="headerlink" title="2. stat path [watch]"></a>2. stat path [watch]</h3><p>ä½¿ç”¨<code>stat path [watch]</code>æ³¨å†Œçš„ç›‘å¬å™¨èƒ½å¤Ÿåœ¨èŠ‚ç‚¹çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºé€šçŸ¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk:localhost:2181(CONNECTED) 7] stat /hadoop watch<br>[zk:localhost:2181(CONNECTED) 8] set /hadoop 112233<br>WATCHER::<br>WatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop #èŠ‚ç‚¹å€¼æ”¹å˜<br></code></pre></td></tr></table></figure>

<h3 id="3-ls-x2F-ls2-path-watch"><a href="#3-ls-x2F-ls2-path-watch" class="headerlink" title="3. ls &#x2F; ls2 path [watch]"></a>3. ls &#x2F; ls2 path [watch]</h3><p>ä½¿ç”¨<code>ls path [watch]</code>æˆ–<code>ls2 path [watch]</code>æ³¨å†Œçš„ç›‘å¬å™¨èƒ½å¤Ÿç›‘å¬è¯¥èŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹çš„å¢åŠ å’Œåˆ é™¤æ“ä½œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk:localhost:2181(CONNECTED) 9] ls /hadoop watch<br>[]<br>[zk:localhost:2181(CONNECTED) 8] create /hadoop/yarn &quot;aaa&quot;<br>WATCHER::<br>WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/hadoop<br></code></pre></td></tr></table></figure>

<h1 id="å…­ã€Zookeeper-JavaAPI"><a href="#å…­ã€Zookeeper-JavaAPI" class="headerlink" title="å…­ã€Zookeeper JavaAPI"></a>å…­ã€Zookeeper JavaAPI</h1><h2 id="1-è¿æ¥åˆ°Zookeeper"><a href="#1-è¿æ¥åˆ°Zookeeper" class="headerlink" title="1 è¿æ¥åˆ°Zookeeper"></a>1 è¿æ¥åˆ°Zookeeper</h2><h3 id="éœ€è¦çš„jaråŒ…"><a href="#éœ€è¦çš„jaråŒ…" class="headerlink" title="éœ€è¦çš„jaråŒ…"></a>éœ€è¦çš„jaråŒ…</h3><p>éœ€è¦æ·»åŠ çš„jaråŒ…åœ¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">ZOOKEEPER_HOME</span><br></code></pre></td></tr></table></figure>

<p>å’Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">ZOOKEEPER_HOME/lib</span><br></code></pre></td></tr></table></figure>

<p>ä¸‹é¢</p>
<p>æˆ–è€…ä½¿ç”¨mavené¡¹ç›®ï¼Œ<code>pom.xml</code>ç»™å‡º</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> </span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span> <br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.coachhe<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ZK-API<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-hdfs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span> <br></code></pre></td></tr></table></figure>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.zookeeper; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br> <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperConnection</span> &#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// è®¡æ•°å™¨å¯¹è±¡ </span><br>            <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>            <span class="hljs-comment">// arg1:æœåŠ¡å™¨ipå’Œç«¯å£ </span><br>            <span class="hljs-comment">// arg2:å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ </span><br>            <span class="hljs-comment">// arg3:ç›‘è§†å™¨å¯¹è±¡ </span><br>            <span class="hljs-type">ZooKeeper</span> <span class="hljs-variable">zooKeeper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(<span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>, <span class="hljs-number">5000</span>, <br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>                        <span class="hljs-meta">@Override</span> <br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent event)</span> &#123; <br>                            <span class="hljs-keyword">if</span> (event.getState() == Event.KeeperState.SyncConnected) &#123; <br>                                System.out.println(<span class="hljs-string">&quot;è¿æ¥åˆ›å»ºæˆåŠŸ&quot;</span>); <br>                                <span class="hljs-comment">// é€šçŸ¥countDownLatchä¸ç”¨ç»§ç»­é˜»å¡äº† </span><br>                                countDownLatch.countDown(); <br>                            &#125; <br>                        &#125; <br>                    &#125;); <br>            <span class="hljs-comment">//ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾…è¿æ¥å¯¹è±¡çš„åˆ›å»ºæˆåŠŸ </span><br>            countDownLatch.await(); <br>            <span class="hljs-comment">//ä¼šè¯ç¼–å· </span><br>            System.out.println(zooKeeper.getSessionId()); <br>            zooKeeper.close(); <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure>

<h2 id="2-æ–°å¢èŠ‚ç‚¹"><a href="#2-æ–°å¢èŠ‚ç‚¹" class="headerlink" title="2 æ–°å¢èŠ‚ç‚¹"></a>2 æ–°å¢èŠ‚ç‚¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒæ­¥æ–¹å¼</span><br>create(String path, <span class="hljs-type">byte</span>[] data, List&lt;ACL&gt; acl, CreateMode createMode)<br><span class="hljs-comment">//å¼‚æ­¥æ–¹å¼</span><br>create(String path, <span class="hljs-type">byte</span>[] data, List&lt;ACL&gt; acl, CreateMode createMode,<br>       AsyncCallback.StringCallback callBack, Object ctx)<br></code></pre></td></tr></table></figure>

<h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><ul>
<li>path - znodeè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>/node</code>ï¼Œ<code>/node1/node11</code></li>
<li>data - è¦å­˜å‚¨åœ¨æŒ‡å®šznodeè·¯å¾„ä¸­çš„æ•°æ®</li>
<li>ack - è¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚</li>
<li>createMode - èŠ‚ç‚¹çš„ç±»å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæšä¸¾ã€‚</li>
<li>callBack - å¼‚æ­¥å›è°ƒæ¥å£</li>
<li>ctx - ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</li>
</ul>
<h2 id="3-æ›´æ–°èŠ‚ç‚¹"><a href="#3-æ›´æ–°èŠ‚ç‚¹" class="headerlink" title="3 æ›´æ–°èŠ‚ç‚¹"></a>3 æ›´æ–°èŠ‚ç‚¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŒæ­¥æ–¹å¼</span><br>setData(String path, <span class="hljs-type">byte</span>[] data, <span class="hljs-type">int</span> version)<br><span class="hljs-comment">// å¼‚æ­¥æ–¹å¼</span><br>setData(String path, <span class="hljs-type">byte</span>[] data, <span class="hljs-type">int</span> version, AsyncCallback.StatCallback callback, Object ctx)<br></code></pre></td></tr></table></figure>

<h3 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><ul>
<li>path - znodeè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>/node</code>ï¼Œ<code>/node1/node11</code></li>
<li>data - è¦å­˜å‚¨åœ¨æŒ‡å®šznodeè·¯å¾„ä¸­çš„æ•°æ®</li>
<li>version - znodeçš„å½“å‰ç‰ˆæœ¬ã€‚æ¯å½“æ•°æ®æ›´æ”¹æ—¶ï¼ŒZooKeeperä¼šæ›´æ–°znodeçš„ç‰ˆæœ¬å·</li>
<li>callBack - å¼‚æ­¥å›è°ƒæ¥å£</li>
<li>ctx - ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</li>
</ul>
<h2 id="4-åˆ é™¤èŠ‚ç‚¹delete"><a href="#4-åˆ é™¤èŠ‚ç‚¹delete" class="headerlink" title="4 åˆ é™¤èŠ‚ç‚¹delete()"></a>4 åˆ é™¤èŠ‚ç‚¹delete()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŒæ­¥æ–¹å¼</span><br>delete(String path, <span class="hljs-type">int</span> version)<br><span class="hljs-comment">// å¼‚æ­¥æ–¹å¼</span><br>setData(String path, <span class="hljs-type">int</span> version, AsyncCallback.StatCallback callback, Object ctx)<br></code></pre></td></tr></table></figure>

<ul>
<li>path - znodeè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>/node</code>ï¼Œ<code>/node1/node11</code></li>
<li>version - znodeçš„å½“å‰ç‰ˆæœ¬ã€‚æ¯å½“æ•°æ®æ›´æ”¹æ—¶ï¼ŒZooKeeperä¼šæ›´æ–°znodeçš„ç‰ˆæœ¬å·</li>
<li>callBack - å¼‚æ­¥å›è°ƒæ¥å£</li>
<li>ctx - ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</li>
</ul>
<h2 id="5-æŸ¥çœ‹èŠ‚ç‚¹getData"><a href="#5-æŸ¥çœ‹èŠ‚ç‚¹getData" class="headerlink" title="5 æŸ¥çœ‹èŠ‚ç‚¹getData()"></a>5 æŸ¥çœ‹èŠ‚ç‚¹getData()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŒæ­¥æ–¹å¼</span><br>getData(String path, <span class="hljs-type">boolean</span> b, Stat stat)<br><span class="hljs-comment">// å¼‚æ­¥æ–¹å¼</span><br>getData(String path, <span class="hljs-type">boolean</span> b, AsyncCallback.StatCallback callback, Object ctx)<br></code></pre></td></tr></table></figure>

<ul>
<li>path - znodeè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>/node</code>ï¼Œ<code>/node1/node11</code></li>
<li>b - æ˜¯å¦ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­æ³¨å†Œçš„ç›‘è§†å™¨</li>
<li>stat - è¿”å›znodeçš„å…ƒæ•°æ®</li>
<li>callBack - å¼‚æ­¥å›è°ƒæ¥å£</li>
<li>ctx - ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</li>
</ul>
<h1 id="ä¸ƒã€ZooKeeperäº‹ä»¶ç›‘å¬æœºåˆ¶"><a href="#ä¸ƒã€ZooKeeperäº‹ä»¶ç›‘å¬æœºåˆ¶" class="headerlink" title="ä¸ƒã€ZooKeeperäº‹ä»¶ç›‘å¬æœºåˆ¶"></a>ä¸ƒã€ZooKeeperäº‹ä»¶ç›‘å¬æœºåˆ¶</h1><h2 id="1-watcher"><a href="#1-watcher" class="headerlink" title="1 watcher"></a>1 watcher</h2><h3 id="1-watcheræ¦‚å¿µ"><a href="#1-watcheræ¦‚å¿µ" class="headerlink" title="1. watcheræ¦‚å¿µ"></a>1. watcheræ¦‚å¿µ</h3><p>zookeeperæä¾›äº†æ•°æ®çš„å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½ï¼Œå¤šä¸ªè®¢é˜…è€…å¯åŒæ—¶ç›‘å¬æŸä¸€ç‰¹å®šä¸»é¢˜å¯¹è±¡ï¼Œå½“è¯¥ä¸»é¢˜å¯¹è±¡çš„è‡ªèº«çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶(ä¾‹å¦‚èŠ‚ç‚¹å†…å®¹æ”¹å˜ã€èŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨æ”¹å˜ç­‰)ï¼Œä¼šå®æ—¶ã€ä¸»åŠ¨é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… </p>
<p>zookeeperé‡‡ç”¨äº†Watcheræœºåˆ¶å®ç°æ•°æ®çš„å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½ã€‚è¯¥æœºåˆ¶åœ¨è¢«è®¢é˜…å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ä¼šå¼‚æ­¥é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸å¿…åœ¨Watcheræ³¨å†Œåè½®è¯¢é˜»å¡ï¼Œä»è€Œå‡è½»äº†å®¢æˆ·ç«¯å‹åŠ›ã€‚ </p>
<p>watcheræœºåˆ¶å®é™…ä¸Šä¸è§‚å¯Ÿè€…æ¨¡å¼ç±»ä¼¼ï¼Œä¹Ÿå¯çœ‹ä½œæ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„å®ç°æ–¹å¼ã€‚ </p>
<h3 id="2-watcheræ¶æ„"><a href="#2-watcheræ¶æ„" class="headerlink" title="2. watcheræ¶æ„"></a>2. watcheræ¶æ„</h3><p>Watcherå®ç°ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š </p>
<ol>
<li>ZookeeperæœåŠ¡ç«¯ </li>
<li>Zookeeperå®¢æˆ·ç«¯ </li>
<li>å®¢æˆ·ç«¯çš„ZKWatchManagerå¯¹è±¡</li>
</ol>
<h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><p>å®¢æˆ·ç«¯é¦–å…ˆå°†Watcheræ³¨å†Œåˆ°æœåŠ¡ç«¯ï¼ŒåŒæ—¶å°†Watcherå¯¹è±¡ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„WatchManagerä¸­ã€‚å½“ZooKeeperæœåŠ¡ç«¯ç›‘å¬çš„æ•°æ®çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯ï¼Œ æ¥ç€å®¢æˆ·ç«¯çš„Watchç®¡ç†å™¨ä¼šè§¦å‘ç›¸å…³Watcheræ¥å›è°ƒç›¸åº”å¤„ç†é€»è¾‘ï¼Œä»è€Œå®Œæˆæ•´ä½“çš„æ•°æ®å‘å¸ƒ&#x2F;è®¢é˜…æµç¨‹ã€‚ </p>
<h3 id="3-watcherç‰¹æ€§"><a href="#3-watcherç‰¹æ€§" class="headerlink" title="3. watcherç‰¹æ€§"></a>3. watcherç‰¹æ€§</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸€æ¬¡æ€§</td>
<td>watcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è§¦å‘å°±ä¼šè¢«ç§»é™¤ï¼Œå†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œ</td>
</tr>
<tr>
<td>å®¢æˆ·ç«¯é¡ºåºå›è°ƒ</td>
<td>watcherå›è°ƒæ˜¯é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œçš„ï¼Œåªæœ‰å›è°ƒåå®¢æˆ·ç«¯æ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ä¸€ä¸ªwatcherå›è°ƒé€»è¾‘ä¸åº”è¯¥å¤ªå¤šï¼Œä»¥å…å½±å“åˆ«çš„watcheræ‰§è¡Œ</td>
</tr>
<tr>
<td>è½»é‡çº§</td>
<td>WatchEventæ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œç»“æ„ä¸ŠåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œå¹¶ä¸ä¼šå‘Šè¯‰æ•°æ®èŠ‚ç‚¹å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ï¼›</td>
</tr>
<tr>
<td>æ—¶æ•ˆæ€§</td>
<td>watcheråªæœ‰åœ¨å½“å‰sessionå½»åº•å¤±æ•ˆæ—¶æ‰ä¼šæ— æ•ˆï¼Œè‹¥åœ¨sessionæœ‰æ•ˆæœŸå†…å¿«é€Ÿé‡è¿æˆåŠŸï¼Œåˆ™watcherä¾ç„¶å­˜åœ¨ï¼Œæ‰”å¯æ¥å—åˆ°é€šçŸ¥ã€‚</td>
</tr>
</tbody></table>
<h3 id="4-watcheræ¥å£è®¾è®¡"><a href="#4-watcheræ¥å£è®¾è®¡" class="headerlink" title="4. watcheræ¥å£è®¾è®¡"></a>4. watcheræ¥å£è®¾è®¡</h3><p>Watcheræ˜¯ä¸€ä¸ªæ¥å£ï¼Œä»»ä½•å®ç°äº†Watcheræ¥å£çš„ç±»å°±æ˜¯ä¸€ä¸ªæ–°çš„Watcherã€‚ </p>
<p>Watcherå†…éƒ¨åŒ…å«äº†ä¸¤ä¸ªæšä¸¾ç±»ï¼šKeeperStateã€EventType </p>
<h4 id="Watcheré€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰"><a href="#Watcheré€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰" class="headerlink" title="Watcheré€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰"></a>Watcheré€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰</h4><p>KeeperStateæ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å¯¹åº”çš„é€šçŸ¥ç±»å‹ã€‚è·¯å¾„ä¸ºorg.apache.zookeeper.Watcher.Event.KeeperStateï¼Œæ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå…¶æšä¸¾å±æ€§ å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æšä¸¾å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>SyncConnected</td>
<td>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ­£å¸¸è¿æ¥æ—¶</td>
</tr>
<tr>
<td>Disconnected</td>
<td>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥æ—¶</td>
</tr>
<tr>
<td>Expired</td>
<td>ä¼šè¯sessionå¤±æ•ˆæ—¶</td>
</tr>
<tr>
<td>AuthFailed</td>
<td>èº«ä»½è®¤è¯å¤±è´¥æ—¶</td>
</tr>
</tbody></table>
<h4 id="Watcheräº‹ä»¶ç±»å‹ï¼ˆEventTypeï¼‰"><a href="#Watcheräº‹ä»¶ç±»å‹ï¼ˆEventTypeï¼‰" class="headerlink" title="Watcheräº‹ä»¶ç±»å‹ï¼ˆEventTypeï¼‰"></a>Watcheräº‹ä»¶ç±»å‹ï¼ˆEventTypeï¼‰</h4><p>EventTypeæ˜¯æ•°æ®èŠ‚ç‚¹(znode)å‘ç”Ÿå˜åŒ–æ—¶å¯¹åº”çš„é€šçŸ¥ç±»å‹ã€‚EventTypeå˜åŒ–æ—¶ KeeperStateæ°¸è¿œå¤„äºSyncConnectedé€šçŸ¥çŠ¶æ€ä¸‹ï¼›å½“KeeperStateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œ EventTypeæ°¸è¿œä¸ºNoneã€‚å…¶è·¯å¾„ä¸ºorg.apache.zookeeper.Watcher.Event.EventTypeï¼Œ æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œæšä¸¾å±æ€§å¦‚ä¸‹ï¼š </p>
<table>
<thead>
<tr>
<th>æšä¸¾å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>None</td>
<td>æ— </td>
</tr>
<tr>
<td>NodeCreated</td>
<td>Watcherç›‘å¬çš„æ•°æ®èŠ‚ç‚¹ä¸åˆ›å»ºæ—¶</td>
</tr>
<tr>
<td>NodeDeleted</td>
<td>Watcherç›‘å¬çš„æ•°æ®èŠ‚ç‚¹è¢«åˆ é™¤æ—¶</td>
</tr>
<tr>
<td>NodeDataChanged</td>
<td>Watcherç›‘å¬çš„æ•°æ®èŠ‚ç‚¹å†…å®¹å‘ç”Ÿå˜æ›´æ—¶ï¼ˆæ— è®ºå†…å®¹æ•°æ®æ˜¯å¦å˜åŒ–ï¼‰</td>
</tr>
<tr>
<td>NodeChildrenChanged</td>
<td>Watcherç›‘å¬çš„æ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨å‘ç”Ÿå˜åŒ–æ—¶</td>
</tr>
</tbody></table>
<p>æ³¨ï¼šå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç›¸å…³äº‹ä»¶é€šçŸ¥ä¸­åªåŒ…å«çŠ¶æ€åŠç±»å‹ç­‰ä¿¡æ¯ï¼Œä¸åŒ…æ‹¬èŠ‚ç‚¹å˜åŒ–å‰åçš„ å…·ä½“å†…å®¹ï¼Œå˜åŒ–å‰çš„æ•°æ®éœ€ä¸šåŠ¡è‡ªèº«å­˜å‚¨ï¼Œå˜åŒ–åçš„æ•°æ®éœ€è°ƒç”¨getç­‰æ–¹æ³•é‡æ–°è·å–ï¼› </p>
<h3 id="5-æ•è·ç›¸åº”çš„äº‹ä»¶"><a href="#5-æ•è·ç›¸åº”çš„äº‹ä»¶" class="headerlink" title="5. æ•è·ç›¸åº”çš„äº‹ä»¶"></a>5. æ•è·ç›¸åº”çš„äº‹ä»¶</h3><p>åœ¨zookeeperä¸­é‡‡ç”¨ zk.getChildren(path, watch)ã€zk.exists(path, watch)ã€zk.getData(path, watcher, stat) </p>
<p> è¿™æ ·çš„æ–¹å¼ä¸ºæŸä¸ªznodeæ³¨å†Œç›‘å¬ã€‚ </p>
<table>
<thead>
<tr>
<th>æ³¨å†Œæ–¹å¼</th>
<th>create</th>
<th>ChildrenChanged</th>
<th>Changed</th>
<th>Deleted</th>
</tr>
</thead>
<tbody><tr>
<td>zk.exists(â€œ&#x2F;node-xâ€,watcher)</td>
<td>å¯ç›‘æ§</td>
<td></td>
<td>å¯ç›‘æ§</td>
<td>å¯ç›‘æ§</td>
</tr>
<tr>
<td>zk.getData(â€œ&#x2F;node-xâ€,watcher)</td>
<td></td>
<td></td>
<td>å¯ç›‘æ§</td>
<td>å¯ç›‘æ§</td>
</tr>
<tr>
<td>zk.getChildren(â€œ&#x2F;node-xâ€,watcher)</td>
<td></td>
<td>å¯ç›‘æ§</td>
<td></td>
<td>å¯ç›‘æ§</td>
</tr>
</tbody></table>
<h3 id="6-æ³¨å†Œwatcherçš„æ–¹æ³•"><a href="#6-æ³¨å†Œwatcherçš„æ–¹æ³•" class="headerlink" title="6. æ³¨å†Œwatcherçš„æ–¹æ³•"></a>6. æ³¨å†Œwatcherçš„æ–¹æ³•</h3><h4 id="1-å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥çŠ¶æ€"><a href="#1-å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥çŠ¶æ€" class="headerlink" title="1. å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥çŠ¶æ€"></a>1. å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥çŠ¶æ€</h4><ul>
<li>KeeperState:é€šçŸ¥çŠ¶æ€</li>
<li>SyncConnectedï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ­£å¸¸è¿æ¥æ—¶</li>
<li>Disconnectedï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥æ—¶</li>
<li>Expiredï¼šä¼šè¯sessionå¤±æ•ˆæ—¶</li>
<li>AuthFailedï¼šèº«ä»½è®¤è¯å¤±è´¥æ—¶</li>
</ul>
<p>æ—¶é—´ç±»å‹ä¸ºï¼šNone</p>
<h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.watcher; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZKConnectionWatcher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watcher</span> &#123; <br> <br>    <span class="hljs-comment">//è®¡æ•°å™¨å¯¹è±¡ </span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>    <span class="hljs-comment">//è¿æ¥å¯¹è±¡ </span><br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-comment">//è¿æ¥çš„IP </span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZKConnectionWatcher</span>()); <br>            <span class="hljs-comment">// é˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…è¿æ¥çš„åˆ›å»º </span><br>            countDownLatch.await(); <br>            <span class="hljs-comment">// ä¼šè¯id </span><br>            System.out.println(zooKeeper.getSessionId()); <br>            Thread.sleep(<span class="hljs-number">50000</span>); <br>            zooKeeper.close(); <br>            System.out.println(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br> <br>    &#125; <br> <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>        <span class="hljs-comment">// äº‹ä»¶ç±»å‹ </span><br>        <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;è¿æ¥åˆ›å»ºæˆåŠŸ!&quot;</span>); <br>                <span class="hljs-comment">//ç»§ç»­å¾€ä¸‹æ‰§è¡Œ </span><br>                countDownLatch.countDown(); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Disconnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;æ–­å¼€è¿æ¥ï¼&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Expired) &#123; <br>                System.out.println(<span class="hljs-string">&quot;ä¼šè¯è¶…æ—¶!&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.AuthFailed) &#123; <br>                System.out.println(<span class="hljs-string">&quot;è®¤è¯å¤±è´¥!&quot;</span>); <br>            &#125; <br>        &#125; <br>    &#125; <br>&#125; <br><br></code></pre></td></tr></table></figure>

<h3 id="7-æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#7-æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="headerlink" title="7. æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"></a>7. æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½¿ç”¨è¿æ¥å¯¹è±¡çš„ç›‘è§†å™¨</span><br>exists(String path, <span class="hljs-type">boolean</span> b)<br><span class="hljs-comment">// è‡ªå®šä¹‰ç›‘è§†å™¨</span><br>exists(String path, Watcher w)<br>  <br><span class="hljs-comment">// NodeCreated:èŠ‚ç‚¹åˆ›å»º</span><br><span class="hljs-comment">// NodeDeleted:èŠ‚ç‚¹åˆ é™¤</span><br><span class="hljs-comment">// NodeDataChanged:èŠ‚ç‚¹å†…å®¹å‘ç”Ÿå˜åŒ–</span><br></code></pre></td></tr></table></figure>

<ul>
<li>path - znodeè·¯å¾„</li>
<li>b - æ˜¯å¦ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­æ³¨å†Œçš„ç›‘è§†å™¨</li>
<li>w - ç›‘è§†å™¨å¯¹è±¡</li>
</ul>
<h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.watcher; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br><span class="hljs-keyword">import</span> org.junit.After; <br><span class="hljs-keyword">import</span> org.junit.Before; <br><span class="hljs-keyword">import</span> org.junit.Test; <br> <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZKWatcherExists</span> &#123; <br> <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    ZooKeeper zooKeeper; <br> <br>    <span class="hljs-meta">@Before</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        <span class="hljs-comment">// è®¡æ•°å™¨ </span><br>        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>        <span class="hljs-comment">// arg1:æœåŠ¡å™¨ipå’Œç«¯å£ </span><br>        <span class="hljs-comment">// arg2:å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ </span><br>        <span class="hljs-comment">// arg3:ç›‘è§†å™¨å¯¹è±¡ </span><br>        zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>            <span class="hljs-meta">@Override</span> <br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent event)</span> &#123; <br>                <span class="hljs-keyword">if</span> (event.getState() == Event.KeeperState.SyncConnected) &#123; <br>                    System.out.println(<span class="hljs-string">&quot;è¿æ¥åˆ›å»ºæˆåŠŸ&quot;</span>); <br>                    <span class="hljs-comment">// é€šçŸ¥countDownLatchä¸ç”¨ç»§ç»­é˜»å¡äº† </span><br>                    countDownLatch.countDown(); <br>                &#125; <br>                System.out.println(<span class="hljs-string">&quot;path = &quot;</span> + event.getPath()); <br>                System.out.println(<span class="hljs-string">&quot;eventType = &quot;</span> + event.getType()); <br>            &#125; <br>        &#125;); <br>        <span class="hljs-comment">//ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾…è¿æ¥å¯¹è±¡çš„åˆ›å»ºæˆåŠŸ </span><br>        countDownLatch.await(); <br>        <span class="hljs-comment">//ä¼šè¯ç¼–å· </span><br>        System.out.println(zooKeeper.getSessionId()); <br>        zooKeeper.close(); <br>    &#125; <br>     <br>    <span class="hljs-meta">@After</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        zooKeeper.close(); <br>    &#125; <br>     <br>     <br>    <span class="hljs-meta">@Test</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherExists1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">// arg1è¡¨ç¤ºèŠ‚ç‚¹çš„è·¯å¾„ </span><br>        <span class="hljs-comment">// trueè¡¨ç¤ºéœ€è¦è¿›è¡Œç›‘å¬,è¿æ¥å¯¹è±¡ä¸­çš„watcher </span><br>        zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-literal">true</span>); <br>        Thread.sleep(<span class="hljs-number">50000</span>); <br>        System.out.println(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure>

<h3 id="8-watcherçš„ä¸€æ¬¡æ€§"><a href="#8-watcherçš„ä¸€æ¬¡æ€§" class="headerlink" title="8. watcherçš„ä¸€æ¬¡æ€§"></a>8. watcherçš„ä¸€æ¬¡æ€§</h3><p>æ³¨æ„ </p>
<p>watcherç›‘å¬æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè‹¥æ˜¯éœ€è¦å¤šæ¬¡ç›‘å¬ï¼Œé‚£ä¹ˆéœ€è¦å°†existsæ–¹æ³•æ”¾åˆ°processæ–¹æ³•é‡Œé¢ï¼ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherExists3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      <span class="hljs-keyword">try</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;è‡ªå®šä¹‰watcher&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;path = &quot;</span> + watchedEvent.getPath());<br>        System.out.println(<span class="hljs-string">&quot;eventType = &quot;</span> + watchedEvent.getType());<br>        zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-built_in">this</span>);<br>      &#125; <span class="hljs-keyword">catch</span> (KeeperException e)&#123;<br>        e.printStackTrace();<br>      &#125; <span class="hljs-keyword">catch</span> (InterruptedException e)&#123;<br>        e.printStackTrace();<br>      &#125;<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="9-æ³¨å†Œå¤šä¸ªç›‘è§†å™¨å¯¹è±¡"><a href="#9-æ³¨å†Œå¤šä¸ªç›‘è§†å™¨å¯¹è±¡" class="headerlink" title="9. æ³¨å†Œå¤šä¸ªç›‘è§†å™¨å¯¹è±¡"></a>9. æ³¨å†Œå¤šä¸ªç›‘è§†å™¨å¯¹è±¡</h3><p>åŒä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œä¸¤ä¸ªç›‘è§†å™¨å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å…¶æ”¹åŠ¨æ—¶ä¸¤ä¸ªç›‘å¬å™¨å¯¹è±¡éƒ½ä¼šæœ‰å“åº”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ³¨å†Œå¤šä¸ªç›‘è§†å™¨å¯¹è±¡</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherExists3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;1&quot;</span>)<br>    &#125;<br>  &#125;);<br>    zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;2&quot;</span>)<br>    &#125;<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="10-æŸ¥çœ‹èŠ‚ç‚¹getData"><a href="#10-æŸ¥çœ‹èŠ‚ç‚¹getData" class="headerlink" title="10. æŸ¥çœ‹èŠ‚ç‚¹getData()"></a>10. æŸ¥çœ‹èŠ‚ç‚¹getData()</h3><h5 id="ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­çš„watcher"><a href="#ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­çš„watcher" class="headerlink" title="ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­çš„watcher"></a>ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­çš„watcher</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherGetData1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// arg1:èŠ‚ç‚¹çš„è·¯å¾„</span><br>  <span class="hljs-comment">// arg2:ä½¿ç”¨è¿æ¥å¯¹è±¡çš„watcher</span><br>  zooKeeper.getData(<span class="hljs-string">&quot;/watcher2&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>);<br>  Tread.sleep(<span class="hljs-number">500000</span>);<br>  System.out.println(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="è‡ªå®šä¹‰watcherå¯¹è±¡"><a href="#è‡ªå®šä¹‰watcherå¯¹è±¡" class="headerlink" title="è‡ªå®šä¹‰watcherå¯¹è±¡"></a>è‡ªå®šä¹‰watcherå¯¹è±¡</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherGetData1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  zooKeeper.getData(<span class="hljs-string">&quot;/watcher2&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;è‡ªå®šä¹‰watcher&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;path = &quot;</span> + watchedEvent.getPath();<br>      System.out.println(<span class="hljs-string">&quot;eventType = &quot;</span> + watchedEvent.getType());<br>    &#125;<br>  &#125;, <span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€IDæ¡ˆä¾‹"><a href="#2-ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€IDæ¡ˆä¾‹" class="headerlink" title="2 ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€IDæ¡ˆä¾‹"></a>2 ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€IDæ¡ˆä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.æ¡ˆä¾‹; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.*; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GloballyUniqueId</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watcher</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">defaultPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/uniqueId&quot;</span>; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br> <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>        <span class="hljs-comment">// äº‹ä»¶ç±»å‹ </span><br>        <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;è¿æ¥åˆ›å»ºæˆåŠŸ!&quot;</span>); <br>                <span class="hljs-comment">//ç»§ç»­å¾€ä¸‹æ‰§è¡Œ </span><br>                countDownLatch.countDown(); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Disconnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;æ–­å¼€è¿æ¥ï¼&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Expired) &#123; <br>                System.out.println(<span class="hljs-string">&quot;ä¼šè¯è¶…æ—¶!&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.AuthFailed) &#123; <br>                System.out.println(<span class="hljs-string">&quot;è®¤è¯å¤±è´¥!&quot;</span>); <br>            &#125; <br>        &#125;  <br>    &#125; <br>     <br>    <span class="hljs-comment">// æ„é€ æ–¹æ³• </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GloballyUniqueId</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// åˆ›å»ºè¿æ¥å¯¹è±¡ </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-built_in">this</span>); <br>            <span class="hljs-comment">// é˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…è¿æ¥åˆ›å»ºæˆåŠŸ </span><br>            countDownLatch.await(); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br>     <br>    <span class="hljs-comment">//ç”ŸæˆIDçš„æ–¹æ³• </span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUniqueId</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <br>        <span class="hljs-keyword">try</span> &#123; <br>            path = zooKeeper.create(defaultPath, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, <br>                    CreateMode.EPHEMERAL); <br>        &#125; <span class="hljs-keyword">catch</span> (KeeperException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125;  <br>        <span class="hljs-keyword">return</span> path.substring(<span class="hljs-number">9</span>); <br>    &#125; <br> <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-type">GloballyUniqueId</span> <span class="hljs-variable">globallyUniqueId</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GloballyUniqueId</span>(); <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) &#123; <br>            <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> globallyUniqueId.getUniqueId(); <br>            System.out.println(id); <br>        &#125; <br>         <br>         <br>    &#125; <br>     <br>&#125; <br></code></pre></td></tr></table></figure>

<h2 id="3-é…ç½®ä¸­å¿ƒæ¡ˆä¾‹"><a href="#3-é…ç½®ä¸­å¿ƒæ¡ˆä¾‹" class="headerlink" title="3 é…ç½®ä¸­å¿ƒæ¡ˆä¾‹"></a>3 é…ç½®ä¸­å¿ƒæ¡ˆä¾‹</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>å·¥ä½œä¸­æœ‰è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯: </p>
<p>æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œåº”ç”¨è¯»å–è¯¥é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä¿¡æ¯æ”¾å…¥ç¼“å­˜ã€‚ </p>
<p>è‹¥æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç æ”¹å˜æ—¶å€™ï¼Œè¿˜éœ€è¦é‡æ–°åŠ è½½ç¼“å­˜ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œé€šè¿‡ ZooKeeperå¯ä»¥è½»æ¾å®Œæˆï¼Œå½“æ•°æ®åº“å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨å®Œæˆç¼“å­˜åŒæ­¥ã€‚ </p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™é‡Œæœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœèƒ½åŠæ—¶è¯»å–æ›´æ”¹ä¿¡æ¯ã€‚ </p>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ol>
<li><p>è¿æ¥zookeeperæœåŠ¡å™¨ </p>
</li>
<li><p>è¯»å–zookeeperä¸­çš„é…ç½®ä¿¡æ¯ï¼Œæ³¨å†Œwatcherç›‘å¬å™¨ï¼Œå­˜å…¥æœ¬åœ°å˜é‡ </p>
</li>
<li><p>å½“zookeeperä¸­çš„é…ç½®ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡watcherçš„å›è°ƒæ–¹æ³•æ•è·æ•°æ®å˜åŒ–äº‹ä»¶ </p>
</li>
<li><p>é‡æ–°è·å–é…ç½®ä¿¡æ¯</p>
</li>
</ol>
<h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.æ¡ˆä¾‹; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.KeeperException; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfigCenter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watcher</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>     <br>    <span class="hljs-comment">// ç”¨äºæœ¬åœ°åŒ–å­˜å‚¨é…ç½®ä¿¡æ¯ </span><br>    <span class="hljs-keyword">private</span> String url; <br>    <span class="hljs-keyword">private</span> String username; <br> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUrl</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> url; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUrl</span><span class="hljs-params">(String url)</span> &#123; <br>        <span class="hljs-built_in">this</span>.url = url; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> username; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123; <br>        <span class="hljs-built_in">this</span>.username = username; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> password; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123; <br>        <span class="hljs-built_in">this</span>.password = password; <br>    &#125; <br> <br>    <span class="hljs-keyword">private</span> String password; <br> <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>        <span class="hljs-comment">// äº‹ä»¶ç±»å‹ </span><br>        <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;è¿æ¥åˆ›å»ºæˆåŠŸ!&quot;</span>); <br>                <span class="hljs-comment">//ç»§ç»­å¾€ä¸‹æ‰§è¡Œ </span><br>                countDownLatch.countDown(); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Disconnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;æ–­å¼€è¿æ¥ï¼&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Expired) &#123; <br>                System.out.println(<span class="hljs-string">&quot;ä¼šè¯è¶…æ—¶!&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.AuthFailed) &#123; <br>                System.out.println(<span class="hljs-string">&quot;è®¤è¯å¤±è´¥!&quot;</span>); <br>            &#125; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDataChanged) &#123; <br>            initValue(); <br>        &#125; <br>    &#125; <br>     <br>    <span class="hljs-comment">// è¿æ¥zookeeperæœåŠ¡å™¨ï¼Œè¯»å–é…ç½®ä¿¡æ¯ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initValue</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// åˆ›å»ºè¿æ¥å¯¹è±¡ </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-built_in">this</span>); <br>            <span class="hljs-comment">// é˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…è¿æ¥åˆ›å»ºæˆåŠŸ </span><br>            countDownLatch.await(); <br>            <span class="hljs-comment">// è¯»å–é…ç½®ä¿¡æ¯ </span><br>            <span class="hljs-built_in">this</span>.url = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(zooKeeper.getData(<span class="hljs-string">&quot;/config/url&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>)); <br>            <span class="hljs-built_in">this</span>.username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(zooKeeper.getData(<span class="hljs-string">&quot;/config/username&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>)); <br>            <span class="hljs-built_in">this</span>.password = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(zooKeeper.getData(<span class="hljs-string">&quot;/config/password&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>)); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <span class="hljs-keyword">catch</span> (KeeperException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">// æ„é€ æ–¹æ³• </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyConfigCenter</span><span class="hljs-params">()</span> &#123; <br>        initValue(); <br>    &#125; <br> <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-type">MyConfigCenter</span> <span class="hljs-variable">myConfigCenter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyConfigCenter</span>(); <br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) &#123; <br>                Thread.sleep(<span class="hljs-number">3000</span>); <br>                System.out.println(<span class="hljs-string">&quot;url:&quot;</span> + myConfigCenter.getUrl()); <br>                System.out.println(<span class="hljs-string">&quot;username:&quot;</span> + myConfigCenter.getUsername()); <br>                System.out.println(<span class="hljs-string">&quot;password:&quot;</span> + myConfigCenter.getPassword()); <br>            &#125; <br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure>

<h2 id="4-åˆ†å¸ƒå¼é”"><a href="#4-åˆ†å¸ƒå¼é”" class="headerlink" title="4 åˆ†å¸ƒå¼é”"></a>4 åˆ†å¸ƒå¼é”</h2><h3 id="è®¾è®¡æ€è·¯"><a href="#è®¾è®¡æ€è·¯" class="headerlink" title="è®¾è®¡æ€è·¯"></a>è®¾è®¡æ€è·¯</h3><p>åˆ†å¸ƒå¼é”æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡æ•°æ®åº“ã€rediséƒ½å¯å®ç°ã€‚ä½œä¸ºåˆ†å¸ƒå¼ååŒå·¥å…·ZooKeeperï¼Œå½“ç„¶ä¹Ÿæœ‰ç€æ ‡å‡†çš„å®ç°æ–¹å¼ã€‚ä¸‹é¢ä»‹ç»åœ¨zookeeperä¸­å¦‚ä½•å®ç°æ’ä»–é”ã€‚  </p>
<p>è®¾è®¡æ€è·¯ï¼š  </p>
<ol>
<li><p>æ¯ä¸ªå®¢æˆ·ç«¯å¾€&#x2F;Locksä¸‹åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹&#x2F;Locks&#x2F;Lock_000000001 </p>
</li>
<li><p>å®¢æˆ·ç«¯å–å¾—&#x2F;Locksä¸‹å­èŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œæ’åºï¼Œåˆ¤æ–­æ’åœ¨æœ€å‰é¢çš„æ˜¯å¦ä¸ºè‡ªå·±ï¼Œå¦‚æœè‡ªå·±çš„ é”èŠ‚ç‚¹åœ¨ç¬¬ä¸€ä½ï¼Œä»£è¡¨è·å–é”æˆåŠŸ </p>
</li>
<li><p>å¦‚æœè‡ªå·±çš„é”èŠ‚ç‚¹ä¸åœ¨ç¬¬ä¸€ä½ï¼Œåˆ™ç›‘å¬è‡ªå·±å‰ä¸€ä½çš„é”èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè‡ªå·±é”èŠ‚ç‚¹ Lock 000000001 </p>
</li>
<li><p>å½“å‰ä¸€ä½é”èŠ‚ç‚¹ï¼ˆLock 000000002ï¼‰çš„é€»è¾‘ </p>
</li>
<li><p>ç›‘å¬å®¢æˆ·ç«¯é‡æ–°æ‰§è¡Œç¬¬2æ­¥é€»è¾‘ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯å¦è·å¾—äº†é”</p>
</li>
</ol>
<h3 id="1-åˆ›å»ºèŠ‚ç‚¹"><a href="#1-åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="1. åˆ›å»ºèŠ‚ç‚¹"></a>1. åˆ›å»ºèŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.lock; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.*; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.data.Stat; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLock</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_ROOT_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/locks&quot;</span>; <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_NODE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Lock_&quot;</span>; <br>    <span class="hljs-keyword">private</span> String lockPath; <br> <br>    <span class="hljs-comment">//æ‰“å¼€zookeeperè¿æ¥ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLock</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// åˆ›å»ºè¿æ¥å¯¹è±¡ </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>                <span class="hljs-meta">@Override</span> <br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>                    <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>                        <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                            System.out.println(<span class="hljs-string">&quot;è¿æ¥æˆåŠŸ&quot;</span>); <br>                            countDownLatch.countDown(); <br>                        &#125; <br>                    &#125; <br>                &#125; <br>            &#125;); <br>            <span class="hljs-comment">// é˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…è¿æ¥åˆ›å»ºæˆåŠŸ </span><br>            countDownLatch.await(); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">//è·å–é” </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">//åˆ›å»ºé”èŠ‚ç‚¹ </span><br>        createLock(); <br>        <span class="hljs-comment">//å°è¯•è·å–é” </span><br>        attemptLock(); <br>    &#125; <br> <br>    <span class="hljs-comment">//åˆ›å»ºé”èŠ‚ç‚¹ </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        <span class="hljs-comment">// åˆ¤æ–­locksèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º </span><br>        <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> zooKeeper.exists(LOCK_ROOT_PATH, <span class="hljs-literal">false</span>); <br>        <span class="hljs-keyword">if</span> (stat == <span class="hljs-literal">null</span>) &#123; <br>            zooKeeper.create(LOCK_ROOT_PATH, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, <br>                    CreateMode.PERSISTENT); <br>        &#125; <br>        <span class="hljs-comment">// åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹ </span><br>        lockPath = zooKeeper.create(LOCK_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + LOCK_NODE_NAME, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], <br>                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); <br>        System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹åˆ›å»ºæˆåŠŸï¼š&quot;</span> + lockPath); <br>    &#125; <br> <br>    <span class="hljs-comment">//å°è¯•è·å–é” </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attemptLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br> <br>    &#125; <br> <br>    <span class="hljs-comment">//é‡Šæ”¾é” </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br> <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-type">MyLock</span> <span class="hljs-variable">myLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLock</span>(); <br>            myLock.createLock(); <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>&#125; <br></code></pre></td></tr></table></figure>

<h3 id="2-è·å–é”"><a href="#2-è·å–é”" class="headerlink" title="2. è·å–é”"></a>2. è·å–é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.lock; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.*; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.data.Stat; <br><span class="hljs-keyword">import</span> sun.tools.jstack.JStack; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.Collection; <br><span class="hljs-keyword">import</span> java.util.Collections; <br><span class="hljs-keyword">import</span> java.util.List; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLock</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_ROOT_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/locks&quot;</span>; <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_NODE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Lock_&quot;</span>; <br>    <span class="hljs-keyword">private</span> String lockPath; <br> <br>    <span class="hljs-comment">//æ‰“å¼€zookeeperè¿æ¥ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLock</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// åˆ›å»ºè¿æ¥å¯¹è±¡ </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>                <span class="hljs-meta">@Override</span> <br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>                    <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>                        <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                            System.out.println(<span class="hljs-string">&quot;è¿æ¥æˆåŠŸ&quot;</span>); <br>                            countDownLatch.countDown(); <br>                        &#125; <br>                    &#125; <br>                &#125; <br>            &#125;); <br>            <span class="hljs-comment">// é˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…è¿æ¥åˆ›å»ºæˆåŠŸ </span><br>            countDownLatch.await(); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">//ç›‘è§†å™¨å¯¹è±¡ï¼Œç›‘è§†ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦è¢«åˆ é™¤ </span><br>    <span class="hljs-type">Watcher</span> <span class="hljs-variable">watcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>        <span class="hljs-meta">@Override</span> <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDeleted) &#123; <br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123; <br>                    MyLock.<span class="hljs-built_in">this</span>.notifyAll(); <br>                &#125; <br>            &#125; <br>        &#125; <br>    &#125;; <br> <br>    <span class="hljs-comment">//è·å–é” </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">//åˆ›å»ºé”èŠ‚ç‚¹ </span><br>        createLock(); <br>        <span class="hljs-comment">//å°è¯•è·å–é” </span><br>        attemptLock(); <br>    &#125; <br> <br>    <span class="hljs-comment">//åˆ›å»ºé”èŠ‚ç‚¹ </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        <span class="hljs-comment">// åˆ¤æ–­locksèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º </span><br>        <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> zooKeeper.exists(LOCK_ROOT_PATH, <span class="hljs-literal">false</span>); <br>        <span class="hljs-keyword">if</span> (stat == <span class="hljs-literal">null</span>) &#123; <br>            zooKeeper.create(LOCK_ROOT_PATH, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, <br>                    CreateMode.PERSISTENT); <br>        &#125; <br>        <span class="hljs-comment">// åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹ </span><br>        lockPath = zooKeeper.create(LOCK_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + LOCK_NODE_NAME, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], <br>                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); <br>        System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹åˆ›å»ºæˆåŠŸï¼š&quot;</span> + lockPath); <br>    &#125; <br> <br>    <span class="hljs-comment">//å°è¯•è·å–é” </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attemptLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">// è·å–LocksèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ </span><br>        List&lt;String&gt; list = zooKeeper.getChildren(LOCK_ROOT_PATH, <span class="hljs-literal">false</span>); <br>        <span class="hljs-comment">// å¯¹å­èŠ‚ç‚¹è¿›è¡Œæ’åº </span><br>        Collections.sort(list); <br>        <span class="hljs-comment">// /Locks/Lock_0000000001 </span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> list.indexOf(lockPath.substring(LOCK_ROOT_PATH.length() + <span class="hljs-number">1</span>)); <br>        <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123; <br>            <span class="hljs-comment">//è¯´æ˜å½“å‰ä¸´æ—¶æœ‰åºèŠ‚ç‚¹æ’åç¬¬ä¸€ </span><br>            System.out.println(<span class="hljs-string">&quot;è·å–é”æˆåŠŸ&quot;</span>); <br>            <span class="hljs-keyword">return</span>; <br>        &#125; <span class="hljs-keyword">else</span> &#123; <br>            <span class="hljs-comment">// è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ </span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> list.get(index - <span class="hljs-number">1</span>); <br>            <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> zooKeeper.exists(LOCK_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + path, watcher); <br>            <span class="hljs-keyword">if</span> (stat == <span class="hljs-literal">null</span>) &#123; <br>                <span class="hljs-comment">//å¦‚æœç­‰äºç©ºï¼Œé‚£ä¹ˆå°±æ˜¯åœ¨æ‰§è¡Œä¸Šé¢ä¸¤è¡Œä»£ç çš„æ—¶å€™å‰ä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤æ‰äº†ï¼Œé‚£ä¹ˆé‡æ–°å°è¯• </span><br>                attemptLock(); <br>            &#125; <span class="hljs-keyword">else</span> &#123; <br>                <span class="hljs-comment">//å¦‚æœä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ç­‰å¾…ä¸Šä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ </span><br>                <span class="hljs-keyword">synchronized</span> (watcher) &#123; <br>                    watcher.wait(); <br>                &#125; <br>                attemptLock(); <br>            &#125; <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">//é‡Šæ”¾é” </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br> <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-type">MyLock</span> <span class="hljs-variable">myLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLock</span>(); <br>            myLock.createLock(); <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>&#125; <br></code></pre></td></tr></table></figure>

<h3 id="3-é‡Šæ”¾é”"><a href="#3-é‡Šæ”¾é”" class="headerlink" title="3. é‡Šæ”¾é”"></a>3. é‡Šæ”¾é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é‡Šæ”¾é” </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>    <span class="hljs-comment">//åˆ é™¤ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ </span><br>    zooKeeper.delete(<span class="hljs-built_in">this</span>.lockPath, -<span class="hljs-number">1</span>); <br>    zooKeeper.close(); <br>    System.out.println(<span class="hljs-string">&quot;é”å·²ç»é‡Šæ”¾ï¼š&quot;</span> + <span class="hljs-built_in">this</span>.lockPath); <br>&#125; <br></code></pre></td></tr></table></figure>






















                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="category-chain-item">å¤§æ•°æ®</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop%E7%94%9F%E6%80%81/" class="category-chain-item">Hadoopç”Ÿæ€</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop%E7%94%9F%E6%80%81/Zookeeper/" class="category-chain-item">Zookeeper</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Zookeeperç¬”è®°</div>
      <div>http://example.com/2022/12/6005cb796f88.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>CoachHe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´12æœˆ4æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/705f32784171.html" title="2. è¿è¡Œæ—¶æ ˆå¸§ç»“æ„">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2. è¿è¡Œæ—¶æ ˆå¸§ç»“æ„</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/12/90f28c3b7ebc.html" title="rediså…¥é—¨">
                        <span class="hidden-mobile">rediså…¥é—¨</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
