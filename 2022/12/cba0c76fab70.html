

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CoachHe">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、 Hive基本概念1. 什么是HiveHive：由 Facebook 开源用于解决海量结构化日志的数据统计。  Hive 是基于 Hadoop 的一个数据仓库工具，可以将结构化的数据文件映射为一张表，并提供类 SQL 查询功能。  hive的本质将 HQL 转化成 MapReduce 程序 hive的转换流程 1）Hive 处理的数据存储在 HDFS  2）Hive 分析数据底层的默认实现是">
<meta property="og:type" content="article">
<meta property="og:title" content="CoachHe&#39;s Blog">
<meta property="og:url" content="http://example.com/2022/12/cba0c76fab70.html">
<meta property="og:site_name" content="CoachHe&#39;s Blog">
<meta property="og:description" content="一、 Hive基本概念1. 什么是HiveHive：由 Facebook 开源用于解决海量结构化日志的数据统计。  Hive 是基于 Hadoop 的一个数据仓库工具，可以将结构化的数据文件映射为一张表，并提供类 SQL 查询功能。  hive的本质将 HQL 转化成 MapReduce 程序 hive的转换流程 1）Hive 处理的数据存储在 HDFS  2）Hive 分析数据底层的默认实现是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210309004619.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407134518.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407135223.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407140008.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407141448.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143151.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143220.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143325.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143628.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143643.png">
<meta property="og:image" content="http://example.com/Users/coachhe/Library/Application%20Support/typora-user-images/image-20210407144028852.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144103.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144220.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144250.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144650.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144743.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144755.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407145132.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407145236.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212512.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212707.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212843.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213026.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213204.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213251.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213353.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408092400.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094702.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094745.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094802.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408095351.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408095412.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100617.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100732.png">
<meta property="og:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100826.png">
<meta property="article:published_time" content="2022-12-03T13:38:08.695Z">
<meta property="article:modified_time" content="2022-12-03T13:38:08.695Z">
<meta property="article:author" content="CoachHe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210309004619.png">
  
  
  
  <title>CoachHe&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text=""></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-03 21:38" pubdate>
          2022年12月3日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          143 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none"></h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一、-Hive基本概念"><a href="#一、-Hive基本概念" class="headerlink" title="一、 Hive基本概念"></a>一、 Hive基本概念</h1><h2 id="1-什么是Hive"><a href="#1-什么是Hive" class="headerlink" title="1. 什么是Hive"></a>1. 什么是Hive</h2><p>Hive：由 Facebook 开源用于解决<strong>海量结构化日志</strong>的数据统计。 </p>
<p>Hive 是基于 Hadoop 的一个<strong>数据仓库工具</strong>，可以将结构化的数据文件映射为一张表，并提供<strong>类 SQL</strong> 查询功能。 </p>
<h3 id="hive的本质"><a href="#hive的本质" class="headerlink" title="hive的本质"></a>hive的本质</h3><p>将 HQL 转化成 MapReduce 程序</p>
<h3 id="hive的转换流程"><a href="#hive的转换流程" class="headerlink" title="hive的转换流程"></a>hive的转换流程</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210309004619.png" srcset="/img/loading.gif" lazyload></p>
<p>1）Hive 处理的数据存储在 HDFS </p>
<p>2）Hive 分析数据底层的默认实现是 MapReduce </p>
<p>3）执行程序运行在 Yarn 上</p>
<p>（类似于Hadoop的客户端，因此，hive并不是以集群形式来操作，而是可以单个节点，所有的节点都可以单独进行安装和操作）</p>
<h2 id="2-hive的优缺点"><a href="#2-hive的优缺点" class="headerlink" title="2. hive的优缺点"></a>2. hive的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li><p>操作接口采用类 SQL 语法，提供快速开发的能力（简单、容易上手）。 </p>
</li>
<li><p>避免了去写 MapReduce，减少开发人员的学习成本。 </p>
</li>
<li><p>Hive 的执行延迟比较高，因此 Hive 常用于数据分析，对实时性要求不高的场合。 </p>
</li>
<li><p>Hive 优势在于处理大数据，对于处理小数据没有优势，因为 Hive 的执行延迟比较高。 </p>
</li>
<li><p>Hive 支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</p>
</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>1．Hive的HQL表达能力有限 </p>
<p>（1）迭代式算法无法表达 </p>
<p>（2）数据挖掘方面不擅长 </p>
<p>2．Hive的效率比较低 </p>
<p>（1）Hive自动生成的MapReduce作业，通常情况下不够智能化 </p>
<p>（2）Hive调优比较困难，粒度较粗 </p>
<h2 id="3-hive架构原理"><a href="#3-hive架构原理" class="headerlink" title="3. hive架构原理"></a>3. hive架构原理</h2><h3 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407134518.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h4 id="1．用户接口：Client"><a href="#1．用户接口：Client" class="headerlink" title="1．用户接口：Client"></a>1．用户接口：Client</h4><p>CLI（hive shell）、JDBC&#x2F;ODBC(java 访问 hive)、WEBUI（浏览器访问 hive） </p>
<h4 id="2．元数据：Metastore"><a href="#2．元数据：Metastore" class="headerlink" title="2．元数据：Metastore"></a>2．元数据：Metastore</h4><p>元数据包括：表名、表所属的数据库（默认是 default）、表的拥有者、列&#x2F;分区字段、表的类型（是否是外部表）、表的数据所在目录等； </p>
<p>默认存储在自带的 derby 数据库中，推荐使用 MySQL 存储 Metastore </p>
<h4 id="3．Hadoop"><a href="#3．Hadoop" class="headerlink" title="3．Hadoop"></a>3．Hadoop</h4><p>使用 HDFS 进行存储，使用 MapReduce 进行计算。 </p>
<h4 id="4．驱动器：Driver"><a href="#4．驱动器：Driver" class="headerlink" title="4．驱动器：Driver"></a>4．驱动器：Driver</h4><p>（1）解析器（SQL Parser）：将 SQL 字符串转换成抽象语法树 AST，这一步一般都用 第三方工具库完成，比如 antlr；对 AST 进行语法分析，比如表是否存在、字段是否存 在、SQL 语义是否有误。 </p>
<p>（2）编译器（Physical Plan）：将 AST 编译生成逻辑执行计划。 </p>
<p>（3）优化器（Query Optimizer）：对逻辑执行计划进行优化。 </p>
<p>（4）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于 Hive 来 说，就是 MR&#x2F;Spark。 </p>
<h3 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h3><p>Hive 通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的 Driver， 结合元数据(MetaStore)，将这些指令翻译成 MapReduce，提交到 Hadoop 中执行，最后，将 执行返回的结果输出到用户交互接口。 </p>
<p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407135223.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="4-hive与数据库的关系"><a href="#4-hive与数据库的关系" class="headerlink" title="4. hive与数据库的关系"></a>4. hive与数据库的关系</h2><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><p>由于 Hive 采用了类似 SQL 的查询语言 HQL(Hive Query Language) ， 因此很容易将 Hive 理解为数据库。 </p>
<p>其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。 </p>
<h4 id="hive与数据库的关系"><a href="#hive与数据库的关系" class="headerlink" title="hive与数据库的关系"></a>hive与数据库的关系</h4><p>数据库可以用在 Online 的应用中，但是 Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。 </p>
<ol>
<li><p>查询语言 </p>
<p>由于 SQL 被广泛的应用在数据仓库中，因此，专门针对 Hive 的特性设计了类 SQL 的查询语言 HQL。熟悉 SQL 开发的开发者可以很方便的使用 Hive 进行开发。 </p>
</li>
<li><p>数据存储位置 </p>
<p>Hive 是建立在 Hadoop 之上的，所有 Hive 的数据都是存储在 HDFS 中的。而数据库则可以将数据保存在块设备或者本地文件系统中。 </p>
</li>
<li><p>数据更新 </p>
<p>由于 Hive 是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive 中不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是 需要经常进行修改的，因此可以使用INSERT INTO … VALUES添加数据，使用UPDATE … SET 修改数据。 </p>
</li>
<li><p>索引 </p>
<p>Hive 在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些 Key 建立索引。Hive 要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了 Hive 不适合在线数据查询。 </p>
</li>
<li><p>执行 </p>
<p>Hive 中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的。而数据库通常 有自己的执行引擎。 </p>
</li>
<li><p>执行延迟 </p>
<p>Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个 导致 Hive 执行延迟高的因素是 MapReduce 框架。由于 MapReduce 本身具有较高的延迟， 因此在利用 MapReduce 执行 Hive 查询时，也会有较高的延迟。相对的，数据库的执行延迟 较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力 的时候，Hive 的并行计算显然能体现出优势。 </p>
</li>
<li><p>可扩展性 </p>
<p>由于 Hive 是建立在 Hadoop 之上的，因此 Hive 的可扩展性是和 Hadoop 的可扩展性是 一致的（世界上最大的 Hadoop 集群在 Yahoo!，2009 年的规模在 4000 台节点左右）。而数据库由于 ACID 语义的严格限制，扩展行非常有限。目前最先进的并行数据库 Oracle 在理论上的扩展能力也只有 100 台左右。 </p>
</li>
<li><p>数据规模 </p>
<p>由于 Hive 建立在集群上并可以利用 MapReduce 进行并行计算，因此可以支持很大规模 的数据；对应的，数据库可以支持的数据规模较小。</p>
</li>
</ol>
<h1 id="二、Hive安装"><a href="#二、Hive安装" class="headerlink" title="二、Hive安装"></a>二、Hive安装</h1><h2 id="1-Hive安装与配置"><a href="#1-Hive安装与配置" class="headerlink" title="1. Hive安装与配置"></a>1. Hive安装与配置</h2><h3 id="1-hive配置"><a href="#1-hive配置" class="headerlink" title="1. hive配置"></a>1. hive配置</h3><ol>
<li><p>把 apache-hive-1.2.1-bin.tar.gz 上传到 linux 的&#x2F;opt&#x2F;software 目录下 </p>
</li>
<li><p>解压 apache-hive-1.2.1-bin.tar.gz 到&#x2F;opt&#x2F;module&#x2F;目录下面 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /opt/module/</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>修改 apache-hive-1.2.1-bin.tar.gz 的名称为 hive </p>
</li>
<li><p>修改&#x2F;opt&#x2F;module&#x2F;hive&#x2F;conf 目录下的 hive-env.sh.template 名称为 hive-env.sh </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mv</span> hive-env.sh.template hive-env.sh</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>配置 hive-env.sh 文件 </p>
<p>a. 配置 HADOOP_HOME 路径 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HADOOP_HOME=/opt/module/hadoop-2.7.2 <br></code></pre></td></tr></table></figure>

<p>b. 配置 HIVE_CONF_DIR 路径 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HIVE_CONF_DIR=/opt/module/hive/conf <br></code></pre></td></tr></table></figure>

<p>最后还可以配置&#x2F;etc&#x2F;profile文件将hive的bin加入path中。这样就可以直接使用hive指令了 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407140008.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" /></li>
</ol>
<h3 id="2-Hive集群配置"><a href="#2-Hive集群配置" class="headerlink" title="2. Hive集群配置"></a>2. Hive集群配置</h3><p>（1）必须启动 hdfs 和 yarn </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sbin/start-dfs.sh</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sbin/start-yarn.sh</span> <br></code></pre></td></tr></table></figure>

<p>（2）在 HDFS 上创建&#x2F;tmp 和&#x2F;user&#x2F;hive&#x2F;warehouse 两个目录并修改他们的同组权限可写 (可不操作，系统会自动创建) </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">mkdir</span> /tmp</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">mkdir</span> -p /user/hive/warehouse</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">chmod</span> g+w /tmp</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">chmod</span> g+w /user/hive/warehouse</span> <br></code></pre></td></tr></table></figure>

<h3 id="3-Hive基本操作"><a href="#3-Hive基本操作" class="headerlink" title="3. Hive基本操作"></a>3. Hive基本操作</h3><ol>
<li><p>启动 hive </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hive</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>查看数据库 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases;</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>打开默认数据库 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">use default;</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>显示 default 数据库中的表 </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show tables;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建一张表 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">create table student(<span class="hljs-built_in">id</span> int, name string);</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>显示数据库中有几张表 </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show tables;</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>查看表的结构 </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc student;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>向表中插入数据 </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">insert into student values(1000,<span class="hljs-string">&quot;ss&quot;</span>);</span>  <br></code></pre></td></tr></table></figure>
</li>
<li><p>查询表中数据 </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">select * from student;</span> <br></code></pre></td></tr></table></figure>
</li>
<li><p>退出 hive </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">quit;</span> <br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-本地文件导入Hive"><a href="#2-本地文件导入Hive" class="headerlink" title="2. 本地文件导入Hive"></a>2. 本地文件导入Hive</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>将本地&#x2F;opt&#x2F;module&#x2F;data&#x2F;student.txt 这个目录下的数据导入到 hive 的 student(id int, name string)表中。 </p>
<h3 id="1-数据准备"><a href="#1-数据准备" class="headerlink" title="1. 数据准备"></a>1. 数据准备</h3><p>在&#x2F;opt&#x2F;module&#x2F;data 这个目录下准备数据 </p>
<p>（1）在&#x2F;opt&#x2F;module&#x2F;目录下创建 data </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> data</span><br></code></pre></td></tr></table></figure>

<p>（2）在&#x2F;opt&#x2F;module&#x2F;datas&#x2F;目录下创建 student.txt 文件并添加数据 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> student.txt</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">vi student.txt</span> <br>1001 zhangshan <br>1002 lishi <br>1003 zhaoliu <br></code></pre></td></tr></table></figure>

<h3 id="2-hive实际操作"><a href="#2-hive实际操作" class="headerlink" title="2. hive实际操作"></a>2. hive实际操作</h3><ol>
<li>启动 hive<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hive</span><br></code></pre></td></tr></table></figure></li>
<li>显示数据库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases;</span><br></code></pre></td></tr></table></figure></li>
<li>使用 default 数据库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">use default;</span><br></code></pre></td></tr></table></figure></li>
<li>显示 default 数据库中的表<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show tables;</span><br></code></pre></td></tr></table></figure></li>
<li>删除已创建的 student 表<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop table student;</span><br></code></pre></td></tr></table></figure></li>
<li>创建 student 表, 并声明文件分隔符’\t’<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">create</span><br>table<br>student(id int,<br>name<br>string)<br>ROW<br>FORMAT<br>DELIMITED FIELDS TERMINATED<br>BY &#x27;\t&#x27;;<br></code></pre></td></tr></table></figure></li>
<li>加载&#x2F;opt&#x2F;module&#x2F;data&#x2F;student.txt 文件到 student 数据库表中。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">load data <span class="hljs-built_in">local</span> inpath <span class="hljs-string">&#x27;/opt/module/data/student.txt&#x27;</span> into table student;</span><br></code></pre></td></tr></table></figure></li>
<li>Hive 查询结果<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">select * from student;</span><br>OK<br>1001 zhangshan<br>1002 lishi<br>1003 zhaoliu<br>Time taken: 0.266 seconds, Fetched: 3 row(s)<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-遇到的问题"><a href="#3-遇到的问题" class="headerlink" title="3. 遇到的问题"></a>3. 遇到的问题</h3><p>再打开一个客户端窗口启动 hive，会产生 java.sql.SQLException 异常。 </p>
<h3 id="load的本质"><a href="#load的本质" class="headerlink" title="load的本质"></a>load的本质</h3><p>load的本质其实就是put，load将本地文件或者hdfs上的文件当如对应的数据库存储位置。如果直接将其余文件直接放入该位置，那么select时也会出现其余文件的数据。 </p>
<h4 id="并且值得注意的是"><a href="#并且值得注意的是" class="headerlink" title="并且值得注意的是"></a>并且值得注意的是</h4><p>如果是本地操作，那么load就会将数据复制一份到对应的目录下面，如果是hdfs上的操作，那么load相当于剪切一份到对应的目录下面。 </p>
<h4 id="对于hdfs上面的操作"><a href="#对于hdfs上面的操作" class="headerlink" title="对于hdfs上面的操作"></a>对于hdfs上面的操作</h4><p>load其实只需要更改元数据上面的内容即可，并不是真的需要将文件进行搬移，因为真实的文件都放在服务器的$HADOOP_HOME&#x2F;data&#x2F;tmp&#x2F;……里面，只需要更改元数据上面的指向就可以将文件在hdfs的目录上进行剪切。 </p>
<h2 id="3-mysql安装"><a href="#3-mysql安装" class="headerlink" title="3. mysql安装"></a>3. mysql安装</h2><h3 id="1-安装包准备"><a href="#1-安装包准备" class="headerlink" title="1. 安装包准备"></a>1. 安装包准备</h3><p>1．查看 mysql 是否安装，如果安装了，卸载 mysql </p>
<p>​	a. 查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rpm -qa|grep mysql</span> <br>mysql-libs-5.1.73-7.el6.x86_64 <br></code></pre></td></tr></table></figure>

<p>​	b. 卸载 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rpm -e --nodeps mysql-libs-5.1.73-7.el6.x86_64</span> <br></code></pre></td></tr></table></figure>

<p>2．解压 mysql-libs.zip 文件到当前目录 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 software]# unzip mysql-libs.zip <br>[root@hadoop102 software]# ls <br>mysql-libs.zip <br>mysql-libs <br></code></pre></td></tr></table></figure>

<p>3．进入到 mysql-libs 文件夹下 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# ll<br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407141448.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="2-安装mysql服务器"><a href="#2-安装mysql服务器" class="headerlink" title="2. 安装mysql服务器"></a>2. 安装mysql服务器</h3><ol>
<li><p>安装mysql服务端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# rpm -ivh MySQL.xx.rpm<br></code></pre></td></tr></table></figure>
</li>
<li><p>查看产生的随机密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# cat /root/.mysql_secret<br>xxxxxxx<br></code></pre></td></tr></table></figure>
</li>
<li><p>查看mysql状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# service mysql status<br></code></pre></td></tr></table></figure>
</li>
<li><p>启动mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# service mysql start<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-安装MySQL客户端"><a href="#3-安装MySQL客户端" class="headerlink" title="3. 安装MySQL客户端"></a>3. 安装MySQL客户端</h3><ol>
<li><p>安装mysql客户端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# rpm -ivh mysql.xx.rpm<br></code></pre></td></tr></table></figure>
</li>
<li><p>链接mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# mysql -uroot -pxxxxxx<br></code></pre></td></tr></table></figure>
</li>
<li><p>修改密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt;</span><span class="language-bash">SET PASSWORD(<span class="hljs-string">&#x27;000000&#x27;</span>);</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>退出mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt;</span><span class="language-bash"><span class="hljs-built_in">exit</span></span><br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-MySQL中user表中主机配置"><a href="#4-MySQL中user表中主机配置" class="headerlink" title="4. MySQL中user表中主机配置"></a>4. MySQL中user表中主机配置</h3><h4 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h4><p>配置只要是root用户名+密码，在任何主机上都能登录MySQL数据库</p>
<ol>
<li><p>进入mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# mysql -uroot -p000000<br></code></pre></td></tr></table></figure>
</li>
<li><p>显示数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>使用mysql数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">use mysql;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>展示mysql表中的所有表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt;</span><span class="language-bash">show tables;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>展示user表的结构</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">desc user;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>查询user表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">select User, Host, Password from user;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>修改user表，把Host表内容修改为%</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">update user <span class="hljs-built_in">set</span> host=<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-built_in">where</span> host=<span class="hljs-string">&#x27;localhost&#x27;</span></span><br></code></pre></td></tr></table></figure>
</li>
<li><p>删除root用户的其他host</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">delete from user where Host=&#x27;hadoop102&#x27;;<br>delete from user where Host=&#x27;127.0.0.1&#x27;;<br>delete from suer where Host=&#x27;::1&#x27;;<br></code></pre></td></tr></table></figure>
</li>
<li><p>刷新</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>退出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">quit;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="5-Hive元数据配置到Mysql"><a href="#5-Hive元数据配置到Mysql" class="headerlink" title="5. Hive元数据配置到Mysql"></a>5. Hive元数据配置到Mysql</h2><h3 id="1-驱动拷贝"><a href="#1-驱动拷贝" class="headerlink" title="1. 驱动拷贝"></a>1. 驱动拷贝</h3><ol>
<li><p>在<code>/opt/software/mysql-libs</code>目录下解压<code>mysql-connector-java-5.1.27.tar.gz</code>驱动包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# tar -zxvf mysql-xxx.tar.gz<br></code></pre></td></tr></table></figure>
</li>
<li><p>拷贝<code>mysql-connector-java-5.1.27-bin.jar</code>到<code>/opt/module/hive/lib</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# cp /opt/software/mysql-libs/mysql-connector-xxx /opt/module/hive/lib/<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-配置MetaStore到Mysql"><a href="#2-配置MetaStore到Mysql" class="headerlink" title="2. 配置MetaStore到Mysql"></a>2. 配置MetaStore到Mysql</h3><ol>
<li><p>在<code>/opt/module/hive/conf</code>目录下创建一个<code>hive-site.xml</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# touch hive-site.xml<br>[root@hadoop102 mysql-libs]# vim hive-site.xml<br></code></pre></td></tr></table></figure>
</li>
<li><p>根据官方文档配置参数，拷贝数据到<code>hive-site.xml</code></p>
</li>
</ol>
<img src=https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143038.png height=500>

   
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;?xml-stylesheet type=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;configuration.xsl&quot;</span>?&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>jdbc:mysql://9.135.220.213:3306/metastore?createDatabaseIfNotExist=true<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span> <br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>username to use against metastore database<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>JxZah*7428Cp<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>password to use against metastore database<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span> <br></code></pre></td></tr></table></figure>

<ol start="3">
<li>配置完毕后，如果启动hive异常，可以重新启动虚拟机。</li>
</ol>
<h3 id="3-创建数据库以及对应目录"><a href="#3-创建数据库以及对应目录" class="headerlink" title="3. 创建数据库以及对应目录"></a>3. 创建数据库以及对应目录</h3><p>首先创建一个表aa</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143151.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>可以看到，创建表aa之后，会出现在hdfs上的<code>/user/hive/warehouse</code>目录中，对应一条对应的记录。 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143220.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>并且可以看到，在mysql的metastore数据库中，查询表DBS，可以看到有一条记录，这条记录就是hive默认的default数据库，每创建一个数据库都会对应生成一条数据，如下所示： </p>
<p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143325.png" srcset="/img/loading.gif" lazyload></p>
<p>![image-20210407143358869](&#x2F;Users&#x2F;coachhe&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210407143358869.png)</p>
<h2 id="6-Hive-JDBC访问"><a href="#6-Hive-JDBC访问" class="headerlink" title="6. Hive JDBC访问"></a>6. Hive JDBC访问</h2><p>基本用不到，在这里就不介绍了</p>
<h2 id="7-Hive常用交互命令"><a href="#7-Hive常用交互命令" class="headerlink" title="7. Hive常用交互命令"></a>7. Hive常用交互命令</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>有时候需要使用脚本去使用hive语句，因此需要学习交互命令。 </p>
<h3 id="2-从命令行执行hive"><a href="#2-从命令行执行hive" class="headerlink" title="2. 从命令行执行hive"></a>2. 从命令行执行hive</h3><p>语法 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive -e &quot;hql&quot; <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143628.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h3 id="3-从脚本执行hive"><a href="#3-从脚本执行hive" class="headerlink" title="3. 从脚本执行hive"></a>3. 从脚本执行hive</h3><p>语法 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive -f filename <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143643.png" srcset="/img/loading.gif" lazyload style="zoom: 33%;" />

<h2 id="8-Hive常用属性配置"><a href="#8-Hive常用属性配置" class="headerlink" title="8. Hive常用属性配置"></a>8. Hive常用属性配置</h2><h3 id="1-Hive数据仓库位置配置"><a href="#1-Hive数据仓库位置配置" class="headerlink" title="1. Hive数据仓库位置配置"></a>1. Hive数据仓库位置配置</h3><ol>
<li><p>Default 数据仓库的最原始位置是在 hdfs 上的：&#x2F;user&#x2F;hive&#x2F;warehouse 路径下。  </p>
</li>
<li><p>在仓库目录下，没有对默认的数据库 default 创建文件夹。如果某张表属于 default 数据库，直接在数据仓库目录下创建一个文件夹。</p>
<img src="/Users/coachhe/Library/Application Support/typora-user-images/image-20210407144028852.png" srcset="/img/loading.gif" lazyload alt="image-20210407144028852" style="zoom: 50%;" />
</li>
<li><p>修改 default 数据仓库原始位置（将 hive-default.xml.template 如下配置信息拷贝到 hive-site.xml 文件中）。 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144103.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />
</li>
<li><p>配置同组用户有执行权限 </p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/hdfs dfs -chmod g+w /user/hive/warehouse <br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-查询后信息显示配置"><a href="#2-查询后信息显示配置" class="headerlink" title="2. 查询后信息显示配置"></a>2. 查询后信息显示配置</h3><ol>
<li><p>在 hive-site.xml 文件中添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置。 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144220.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />
</li>
<li><p>重启hive，看情况</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144250.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" /></li>
</ol>
<h3 id="3-Hive运行日志信息配置"><a href="#3-Hive运行日志信息配置" class="headerlink" title="3. Hive运行日志信息配置"></a>3. Hive运行日志信息配置</h3><ol>
<li><p>Hive 的 log 默认存放在&#x2F;tmp&#x2F;coachhe&#x2F;hive.log 目录下（当前用户名下）</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144650.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />
</li>
<li><p>修改hive 的 log 存放日志到&#x2F;opt&#x2F;module&#x2F;hive&#x2F;logs </p>
<p>（1）修改<code>/opt/module/hive/conf/hive-log4j.properties.template </code>文件名称为 <code>hive-log4j.properties </code></p>
<p>（2）在<code>hive-log4j.properties</code>文件中修改 log 存放位置 <code>hive.log.dir=/opt/module/hive/logs </code></p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144743.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144755.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" /></li>
</ol>
<h3 id="4-参数配置方式"><a href="#4-参数配置方式" class="headerlink" title="4. 参数配置方式"></a>4. 参数配置方式</h3><p>1．查看当前所有的配置信息 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt;</span><span class="language-bash"><span class="hljs-built_in">set</span>;</span> <br></code></pre></td></tr></table></figure>

<p>2．参数的配置三种方式 </p>
<p>（1）配置文件方式 </p>
<p>默认配置文件：<code>hive-default.xml </code></p>
<p>用户自定义配置文件：<code>hive-site.xml </code></p>
<p>注意： </p>
<p>用户自定义配置会覆盖默认配置。另外，Hive 也会读入 Hadoop 的配置，因 为 Hive 是作为 Hadoop 的客户端启动的，Hive 的配置会覆盖 Hadoop 的配置。配置文件 的设定对本机启动的所有 Hive 进程都有效。 </p>
<p>（2）命令行参数方式 启动 Hive 时，可以在命令行添加-hiveconf param&#x3D;value 来设定参数。 </p>
<p>例如： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hive -hiveconf mapred.reduce.tasks=10;</span> <br></code></pre></td></tr></table></figure>

<p>注意：仅对本次 hive 启动有效 查看参数设置： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; set mapred.reduce.tasks; <br></code></pre></td></tr></table></figure>

<p>（3）参数声明方式 </p>
<p>可以在 HQL 中使用 SET 关键字设定参数 </p>
<p>例如： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; set mapred.reduce.tasks=100; <br></code></pre></td></tr></table></figure>

<p>注意：仅对本次 hive 启动有效。 </p>
<p>查看参数设置 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; set mapred.reduce.tasks; <br></code></pre></td></tr></table></figure>

<p>上述三种设定方式的优先级依次递增。即配置文件&lt;命令行参数&lt;参数声明。注意某些 系统级的参数，例如 log4j 相关的设定，必须用前两种方式设定，因为那些参数的读取在会 话建立以前已经完成了。 </p>
<h1 id="三、Hive数据类型"><a href="#三、Hive数据类型" class="headerlink" title="三、Hive数据类型"></a>三、Hive数据类型</h1><h2 id="1-基本数据类型"><a href="#1-基本数据类型" class="headerlink" title="1. 基本数据类型"></a>1. 基本数据类型</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407145132.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>对于 Hive 的 String 类型相当于数据库的 varchar 类型，该类型是一个可变的字符串，不过它不能声明其中最多能存储多少个字符，理论上它可以存储 2GB 的字符数。</p>
<h2 id="2-集合数据类型"><a href="#2-集合数据类型" class="headerlink" title="2. 集合数据类型"></a>2. 集合数据类型</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>Hive有三种复杂数据类型 ARRAY、MAP 和 STRUCT。ARRAY 和 MAP 与 Java 中的 Array 和 Map 类似，而 STRUCT 与 C 语言中的 Struct 类似，它封装了一个命名字段集合， 复杂数据类型允许任意层次的嵌套。 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407145236.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="3-类型转换"><a href="#3-类型转换" class="headerlink" title="3. 类型转换"></a>3. 类型转换</h2><h3 id="隐式类型转换"><a href="#隐式类型转换" class="headerlink" title="隐式类型转换"></a>隐式类型转换</h3><p>（1）任何整数类型都可以隐式地转换为一个范围更广的类型，如 TINYINT 可以转换成 INT，INT 可以转换成 BIGINT。 </p>
<p>（2）所有整数类型、FLOAT 和 STRING 类型都可以隐式地转换成 DOUBLE。 </p>
<p>（3）TINYINT、SMALLINT、INT 都可以转换为 FLOAT。 </p>
<p>（4）BOOLEAN 类型不可以转换为任何其它的类型。 </p>
<h3 id="用CAST操作显示进行数据类型转换"><a href="#用CAST操作显示进行数据类型转换" class="headerlink" title="用CAST操作显示进行数据类型转换"></a>用CAST操作显示进行数据类型转换</h3><p>例如 CAST(‘1’ AS INT)将把字符串’1’ 转换成整数 1；如果强制类型转换失败，如执行 CAST(‘X’ AS INT)，表达式返回空值 NULL。 </p>
<h1 id="四、HiveDDL"><a href="#四、HiveDDL" class="headerlink" title="四、HiveDDL"></a>四、HiveDDL</h1><h2 id="1-DDL和DML定义"><a href="#1-DDL和DML定义" class="headerlink" title="1. DDL和DML定义"></a>1. DDL和DML定义</h2><h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><p>（baiData Definition Language 数据定义语言） </p>
<p>数据定义语言 </p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>用于定义和管理 SQL 数据库中的所有对象的语言 </p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">create table 创建表      <br>alter table  修改表    <br>drop table 删除表    <br>truncate table 删除表中所有行dao      <br>create index 创建索引    <br>drop index  删除索引 <br></code></pre></td></tr></table></figure>

<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li>当执行DDL语句时，在每一条语句前后，oracle都将提交当前的事务。 </li>
<li>如果用户使用insert命令将记录插入到数据库后，执行了一条DDL语句(如create table)，此时来自insert命令的数据将被提交到数据库。 </li>
<li>当DDL语句执行完成时，DDL语句会被自动提交，不能回滚。</li>
</ol>
<p>  </p>
<h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3><p>（Data Manipulation Language 数据操作语言）  </p>
<p>数据操作语言 </p>
<h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>用来直接对数据进行操作 </p>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">insert 将记录插入到数据库  <br>update 修改数据库的记录  <br>delete 删除数据库的记录 <br></code></pre></td></tr></table></figure>

<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><ol>
<li>当执行DML命令如果没有提交，将不会被其他会话看到。 </li>
<li>除非在DML命令之后执行了DDL命令或DCL命令，或用户退出会话，或终止实例，此时系统会自动发出commit命令，使未提交的DML命令提交。</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>DML是SELECT、UPDATE、INSERT、DELETE，就象它的名字一样，这4条命令是用来对数据库里的数据进行操作的语言。  </p>
<p>DDL比DML要多，主要的命令有CREATE、ALTER、DROP等，DDL主要是用在定义或改变表（TABLE）的结构，数据类型，表之间的链接和约束等初始化工作上，他们大多在建立表时使用。 </p>
<h2 id="2-创建数据库"><a href="#2-创建数据库" class="headerlink" title="2. 创建数据库"></a>2. 创建数据库</h2><p>1）创建一个数据库，数据库在 HDFS 上的默认存储路径是&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;*.db。  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; create database db_hive;  <br></code></pre></td></tr></table></figure>

<p>2）避免要创建的数据库已经存在错误，增加 if not exists 判断。（标准写法）  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; create database db_hive;  <br>FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. Database db_hive already exists <br>hive (default)&gt; create database if not exisis db_hive;  <br></code></pre></td></tr></table></figure>

<p>3）创建一个数据库，指定数据库在 HDFS 上存放的位置 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; create database db_hive2 location &#x27;/db_hive2.db&#x27;; <br></code></pre></td></tr></table></figure>

<p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212512.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="3-查询数据库"><a href="#3-查询数据库" class="headerlink" title="3. 查询数据库"></a>3. 查询数据库</h2><h3 id="1-显示数据库"><a href="#1-显示数据库" class="headerlink" title="1. 显示数据库"></a>1. 显示数据库</h3><h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases;</span> <br></code></pre></td></tr></table></figure>

<h3 id="2-过滤显示查询的数据库"><a href="#2-过滤显示查询的数据库" class="headerlink" title="2. 过滤显示查询的数据库"></a>2. 过滤显示查询的数据库</h3><p>语法 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases like <span class="hljs-string">&#x27;db_hive*&#x27;</span>;</span> <br>OK <br>db_hive <br>db_hive_1 <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212707.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="3-查看数据库详情"><a href="#3-查看数据库详情" class="headerlink" title="3. 查看数据库详情"></a>3. 查看数据库详情</h3><h4 id="1．显示数据库信息"><a href="#1．显示数据库信息" class="headerlink" title="1．显示数据库信息"></a>1．显示数据库信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc database db_hive;</span> <br>OK<br>db_hive <br>hdfs://hadoop102:9000/user/hive/warehouse/db_hive.db <br>atguiguUSER  <br></code></pre></td></tr></table></figure>

<h4 id="2．显示数据库详细信息，extended"><a href="#2．显示数据库详细信息，extended" class="headerlink" title="2．显示数据库详细信息，extended"></a>2．显示数据库详细信息，extended</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc database extended db_hive;</span> <br>OK <br>db_hive <br>hdfs://hadoop102:9000/user/hive/warehouse/db_hive.db atguiguUSER <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212843.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>在这里用两种查询方式没有区别，因为我们没有经过相应的操作，如果修改数据库之后再进行操作就会有区别了。在后面的修改数据库会给出。 </p>
<h3 id="4-切断当前数据库"><a href="#4-切断当前数据库" class="headerlink" title="4. 切断当前数据库"></a>4. 切断当前数据库</h3><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">hive (<span class="hljs-keyword">default</span>)&gt; <span class="hljs-keyword">use</span> db_hive; <br></code></pre></td></tr></table></figure>

<h2 id="4-修改数据库"><a href="#4-修改数据库" class="headerlink" title="4. 修改数据库"></a>4. 修改数据库</h2><p>用户可以使用 ALTER DATABASE 命令为某个数据库的 DBPROPERTIES 设置键-值对 属性值，来描述这个数据库的属性信息。数据库的其他元数据信息都是不可更改的，包括数据库名和数据库所在的目录位置。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; alter database hive set dbproperties(&#x27;createtime&#x27;=&#x27;20170830&#x27;); <br></code></pre></td></tr></table></figure>

<p>在 hive 中查看修改结果 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc database extended db_hive;</span> <br>db_name comment location owner_name owner_type parameters db_hive hdfs://hadoop102:8020/user/hive/warehouse/db_hive.db atguigu USER &#123;createtime=20170830&#125; <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213026.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="5-删除数据库"><a href="#5-删除数据库" class="headerlink" title="5. 删除数据库"></a>5. 删除数据库</h2><h3 id="1-删除空数据库"><a href="#1-删除空数据库" class="headerlink" title="1. 删除空数据库"></a>1. 删除空数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt;</span><span class="language-bash">drop database db_hive2;</span> <br></code></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>这里只能删除空的数据库，不能删除有内容的数据库。 </p>
<h3 id="2-如果删除的数据库不存在"><a href="#2-如果删除的数据库不存在" class="headerlink" title="2. 如果删除的数据库不存在"></a>2. 如果删除的数据库不存在</h3><p>最好采用 if exists 判断数据库是否存在 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database db_hive;</span> <br>FAILED: SemanticException [Error 10072]: Database does not exist: db_hive <br><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database <span class="hljs-keyword">if</span> exists db_hive2;</span> <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213204.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="3-如果删除的数据库不为空（不推荐）"><a href="#3-如果删除的数据库不为空（不推荐）" class="headerlink" title="3. 如果删除的数据库不为空（不推荐）"></a>3. 如果删除的数据库不为空（不推荐）</h3><p>可以采用 cascade 命令，强制删除 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database db_hive;</span> <br>FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. InvalidOperationException(message:Database db_hive is not empty. One or more tables exist.) <br><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database db_hive cascade;</span> <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213251.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h2 id="6-创建表"><a href="#6-创建表" class="headerlink" title="6. 创建表"></a>6. 创建表</h2><h3 id="1-简介-1"><a href="#1-简介-1" class="headerlink" title="1. 简介"></a>1. 简介</h3><h4 id="建表语法"><a href="#建表语法" class="headerlink" title="建表语法"></a>建表语法</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213353.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>[]表示可选字段。 </p>
<p>解释 </p>
<ol>
<li><p><code>CREATE TABLE</code></p>
<p>创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用 IF NOT EXISTS 选项来忽略这个异常。 </p>
</li>
<li><p><code>EXTERNAL 关键字 </code></p>
<p>可以让用户创建一个外部表，在建表的同时指定一个指向实际 数据的路径（LOCATION），Hive 创建内部表时，会将数据移动到数据仓库指向的路 径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的 时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。 </p>
</li>
<li><p><code>COMMENT</code>： </p>
<p>为表和列添加注释。 </p>
</li>
<li><p><code>PARTITIONED BY </code></p>
<p>创建分区表 </p>
</li>
<li><p><code>CLUSTERED BY </code></p>
<p>创建分桶表 </p>
</li>
<li><p><code>SORTED BY </code></p>
<p>不常用 </p>
</li>
<li><p><code>ROW FORMAT</code> </p>
<p>默认为SerDe，是Serialize&#x2F;Deserilize的简称，目的是用于序列化和反序列化。 </p>
</li>
<li><p><code>STORED AS </code></p>
<p>指定存储文件类型 常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、 RCFILE（列式存储格式文件） 如果文件数据是纯文本，可以使用 STORED AS TEXTFILE。如果数据需要压缩， 使用 STORED AS SEQUENCEFILE。 </p>
</li>
<li><p><code>LOCATION </code></p>
<p>指定表在 HDFS 上的存储位置。 </p>
</li>
<li><p><code>LIKE </code></p>
<p>允许用户复制现有的表结构，但是不复制数据。</p>
</li>
</ol>
<h4 id="查看完整建表语句"><a href="#查看完整建表语句" class="headerlink" title="查看完整建表语句"></a>查看完整建表语句</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default) &gt; show create table table_name; <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408092400.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="2-管理表（内部表）"><a href="#2-管理表（内部表）" class="headerlink" title="2. 管理表（内部表）"></a>2. 管理表（内部表）</h3><h4 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h4><p>默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或少地）控制着数据的生命周期。 </p>
<p>Hive 默认情况下会将这些表的数据存储 在由配置项 <code>hive.metastore.warehouse.dir</code>(例如，<code>/user/hive/warehouse</code>)所定义的目录的子目录下。 当我们删除一个管理表时，Hive 也会删除这个表中数据。管理表不适合和其他工具共享数据。 </p>
<h3 id="3-外部表"><a href="#3-外部表" class="headerlink" title="3. 外部表"></a>3. 外部表</h3><p>假设我们正在分析来自股票市场的数据。我们会定期从像Infochimps(<a target="_blank" rel="noopener" href="http://infochimps.com/datasets)%E8%BF%99%E6%A0%B7%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90%E6%8E%A5%E5%85%A5%E5%85%B3%E4%BA%8ENASDAQ%E5%92%8CNYSE%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BD%BF%E7%94%A8%E5%BE%88%E5%A4%9A%E5%B7%A5%E5%85%B7%E6%9D%A5%E5%88%86%E6%9E%90%E8%BF%99%E4%BB%BD%E6%95%B0%E6%8D%AE%E3%80%82">http://infochimps.com/datasets)这样的数据源接入关于NASDAQ和NYSE的数据，然后使用很多工具来分析这份数据。</a> </p>
<p>我们假设这些数据文件位于分布式文件系统的<code>/data/stocks</code>目录下。</p>
<p>下面的语句将创建一个外部表，其可以读取所有位于<code>/data/stocks</code>目录下的以逗号分隔的数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTERNAL</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> stocks (<br>	exchange STRING,<br>	symbol   STRING,<br>  ...<br>)<br><span class="hljs-type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;,&#x27;</span><br>LOCATION <span class="hljs-string">&#x27;/data/stocks&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>关键字EXTERNAL告诉你这个表是外部的，而后面的LOCATION字句则用于告诉你Hive数据库位于哪个路径下。</p>
<p>因为表示外部的，所以Hive并非认为其完全拥有这份数据。因此，删除该表并不会删除这份数据，不过描述表的元数据信息则会被完全删除。</p>
<h3 id="4-内外部表的关系"><a href="#4-内外部表的关系" class="headerlink" title="4. 内外部表的关系"></a>4. 内外部表的关系</h3><h4 id="内外部表的相互转换"><a href="#内外部表的相互转换" class="headerlink" title="内外部表的相互转换"></a>内外部表的相互转换</h4><ol>
<li><p>查询表的类型</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; desc formatted student2;<br>Table Type:     MANAGED_TABLE<br></code></pre></td></tr></table></figure>
</li>
<li><p>修改内部表student2为外部表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">alter table student2 set tdlproperties(&#x27;EXTERNAL&#x27;=&#x27;TRUE&#x27;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>查询表的类型</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; desc formatted student2;<br>Table Type:     EXTERNAL_TABLE<br></code></pre></td></tr></table></figure>
</li>
<li><p>修改外部表student2为内部表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">alter table student2 set tdlproperties(&#x27;EXTERNAL&#x27;=&#x27;FALSE&#x27;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>查询表的类型</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; desc formatted student2;<br>Table Type:     MANAGED_TABLE<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="内外部表的核心区别"><a href="#内外部表的核心区别" class="headerlink" title="内外部表的核心区别"></a>内外部表的核心区别</h4><p>对于内部表和外部表，核心区别在于删除时是否会把实际数据一起删除。 </p>
<p>对于内部表，认为数据是自己的，删除时一起删除了：</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094702.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<p>对于外部表，认为数据不是自己的，不会一起删除。 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094745.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094802.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p>也就是说，外部表删除时，只会删除元数据（mysql中的数据），而不会去删除实际数据。 </p>
<h4 id="内部表和外部表的使用"><a href="#内部表和外部表的使用" class="headerlink" title="内部表和外部表的使用"></a>内部表和外部表的使用</h4><p>在实际公司环境中，内部表一般作为中间表，因为删除方便。 </p>
<p>外部表作为最终的结果表，因为安全。 </p>
<h2 id="7-分区表"><a href="#7-分区表" class="headerlink" title="7. 分区表"></a>7. 分区表</h2><h3 id="分区表定义"><a href="#分区表定义" class="headerlink" title="分区表定义"></a>分区表定义</h3><p>分区表实际上就是对应一个 HDFS 文件系统上的独立的文件夹，该文件夹下是该分区所有的数据文件。 </p>
<h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4><p>在当前，每个表对应的就是一个文件夹，所有数据都放在里面，若加上了分区，那么在这个文件夹里面就会有很多子文件，每个分区对应一个文件夹。 </p>
<p>Hive 中的分区就是<strong>分目录</strong>，把一个大的数据集根据业务需要分割成小的数据集。 </p>
<p>在查询时通过 WHERE 子句中的表达式选择查询所需要的指定的分区，这样的查询效率会提高很多。 </p>
<h3 id="分区表基本操作"><a href="#分区表基本操作" class="headerlink" title="分区表基本操作"></a>分区表基本操作</h3><h4 id="1-创建分区表语法、加载数据"><a href="#1-创建分区表语法、加载数据" class="headerlink" title="1. 创建分区表语法、加载数据"></a>1. 创建分区表语法、加载数据</h4><ol>
<li><p>引入分区表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/hive/warehouse/log_partition/20170702/20170702.log<br>/usr/hive/warehouse/log_partition/20170703/20170703.log<br>/usr/hive/warehouse/log_partition/20170704/20170704.log<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建分区表语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; create table dept_partition(<br>	deptno int,<br>	dname string,<br>	loc string<br>)<br>partitioned by (month string)<br>row format delimited fields terminated by &#x27;\t&#x27;;<br></code></pre></td></tr></table></figure></li>
</ol>
<p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408095351.png" srcset="/img/loading.gif" lazyload></p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408095412.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h4 id="2-增加分区"><a href="#2-增加分区" class="headerlink" title="2. 增加分区"></a>2. 增加分区</h4><ol>
<li><p>创建单个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition add partition(month=&#x27;20210706&#x27;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>同时创建多个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition add partition(month=&#x27;20210706&#x27;) partition(month=&#x27;20210707&#x27;);<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-删除分区"><a href="#3-删除分区" class="headerlink" title="3. 删除分区"></a>3. 删除分区</h4><p>删除分区不同于增加分区，增加多个分区用空格隔开，而删除多个分区用”,”隔开。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition drop partition(month=&#x27;20210706&#x27;), partition(month=&#x27;20210707&#x27;);<br></code></pre></td></tr></table></figure>

<h4 id="4-查看分区表有多少分区"><a href="#4-查看分区表有多少分区" class="headerlink" title="4. 查看分区表有多少分区"></a>4. 查看分区表有多少分区</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt;</span><span class="language-bash">show partitions dept_partition;</span><br></code></pre></td></tr></table></figure>

<h4 id="5-查看分区表结构"><a href="#5-查看分区表结构" class="headerlink" title="5. 查看分区表结构"></a>5. 查看分区表结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc formatted dept_partition;</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Partition Information</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">col_name data_type comment month string</span><br></code></pre></td></tr></table></figure>

<h3 id="分区表注意事项"><a href="#分区表注意事项" class="headerlink" title="分区表注意事项"></a>分区表注意事项</h3><h4 id="1-创建二级分区表"><a href="#1-创建二级分区表" class="headerlink" title="1. 创建二级分区表"></a>1. 创建二级分区表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">create table dept_partition2(</span><br><span class="hljs-meta prompt_">		&gt; </span><span class="language-bash">  deptno int, dname string, loc string</span><br><span class="hljs-meta prompt_">		&gt; </span><span class="language-bash">)</span><br><span class="hljs-meta prompt_">		&gt; </span><span class="language-bash">partitioned by (mon string, day string)</span><br><span class="hljs-meta prompt_">		&gt; </span><span class="language-bash">row format delimited fields terminated by <span class="hljs-string">&#x27;\t&#x27;</span>;</span><br></code></pre></td></tr></table></figure>

<h4 id="2-到二级分区加载和查询数据"><a href="#2-到二级分区加载和查询数据" class="headerlink" title="2. 到二级分区加载和查询数据"></a>2. 到二级分区加载和查询数据</h4><ol>
<li><p>加载数据到二级分区表中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default) &gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept_partition2 partition(month=&#x27;201709&#x27;,day=&#x27;13&#x27;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>查询分区数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default) &gt; select * from dept_partition2 where month=&#x27;201709&#x27; and day=&#x27;13&#x27;;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>会在大目录下创建一个二级目录</p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100617.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h3 id="把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式"><a href="#把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式" class="headerlink" title="把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式"></a>把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式</h3><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>如果我们直接往hdfs目录下上传文件，那么是查不出来的。 </p>
<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100732.png" srcset="/img/loading.gif" lazyload style="zoom: 50%;" />

<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>没有元数据！mysql没有感知到这个数据。 </p>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><h5 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h5><p>执行修复命令 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">msck repair table dept_partition2; <br></code></pre></td></tr></table></figure>

<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100826.png" srcset="/img/loading.gif" lazyload style="zoom:50%;" />

<h5 id="方式2：上传数据"><a href="#方式2：上传数据" class="headerlink" title="方式2：上传数据"></a>方式2：上传数据</h5><ol>
<li><p>上传数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; dfs mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=11;<br>hive(default) &gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201709/day=11;<br></code></pre></td></tr></table></figure>
</li>
<li><p>执行添加分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition2 add partition(month=&#x27;201709&#x27;, day=&#x27;11&#x27;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>查询数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default &gt; select * from dept_partition2 where month = &#x27;201709&#x27; and day = &#x27;11&#x27;;<br></code></pre></td></tr></table></figure></li>
</ol>
<h5 id="方式3：创建文件夹后load数据到分区"><a href="#方式3：创建文件夹后load数据到分区" class="headerlink" title="方式3：创建文件夹后load数据到分区"></a>方式3：创建文件夹后load数据到分区</h5><ol>
<li><p>创建目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=11<br></code></pre></td></tr></table></figure>
</li>
<li><p>上传数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table dept_partition2 partition(month=&#x27;201709&#x27;, day=&#x27;11&#x27;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>查询数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default &gt; select * from dept_partition2 where month = &#x27;201709&#x27; and day = &#x27;11&#x27;;<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="8-修改表"><a href="#8-修改表" class="headerlink" title="8. 修改表"></a>8. 修改表</h2><h3 id="1-重命名表"><a href="#1-重命名表" class="headerlink" title="1. 重命名表"></a>1. 重命名表</h3><h4 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ALTER TABLE table_name RENAME TO new_table_name<br></code></pre></td></tr></table></figure>

<h4 id="实操案例"><a href="#实操案例" class="headerlink" title="实操案例"></a>实操案例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition2 rename to dept_partition3<br></code></pre></td></tr></table></figure>

<h3 id="2-增加-x2F-修改-x2F-替换列信息"><a href="#2-增加-x2F-修改-x2F-替换列信息" class="headerlink" title="2. 增加&#x2F;修改&#x2F;替换列信息"></a>2. 增加&#x2F;修改&#x2F;替换列信息</h3><h4 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h4><h5 id="更新列"><a href="#更新列" class="headerlink" title="更新列"></a>更新列</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]<br></code></pre></td></tr></table></figure>

<h5 id="增加和替换列"><a href="#增加和替换列" class="headerlink" title="增加和替换列"></a>增加和替换列</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)<br></code></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="category-chain-item">大数据</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop%E7%94%9F%E6%80%81/" class="category-chain-item">Hadoop生态</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop%E7%94%9F%E6%80%81/Hive/" class="category-chain-item">Hive</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div></div>
      <div>http://example.com/2022/12/cba0c76fab70.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>CoachHe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年12月3日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/127e4ef121ee.html" title="">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/12/57c0e88f0643.html" title="">
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
