<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>8 Flink容错机制</title>
    <link href="/2022/12/daf08f5331cb.html"/>
    <url>/2022/12/daf08f5331cb.html</url>
    
    <content type="html"><![CDATA[<h1 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h1><ul><li>一致性检查点（checkpoint）</li><li>从检查点恢复状态</li><li>Flink检查点算法</li><li>保存点（save points）</li></ul><h1 id="现代流处理引擎结果保障"><a href="#现代流处理引擎结果保障" class="headerlink" title="现代流处理引擎结果保障"></a>现代流处理引擎结果保障</h1><ol><li>至多一次</li><li>至少一次</li><li>精确一次</li><li>端到端的精确一次</li></ol><h1 id="一致性检查点"><a href="#一致性检查点" class="headerlink" title="一致性检查点"></a>一致性检查点</h1><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210802203011.png"></p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>7.3 Flink的状态管理-状态后端</title>
    <link href="/2022/12/665277e3bcb7.html"/>
    <url>/2022/12/665277e3bcb7.html</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>7.2 Flink的状态管理-实例</title>
    <link href="/2022/12/76cb4f966664.html"/>
    <url>/2022/12/76cb4f966664.html</url>
    
    <content type="html"><![CDATA[<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><p>利用KeyedState，检测传感器的温度值，如果连续两个温度差值超过10度，就报警。</p><h2 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.apitest.state;<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.functions.RichFlatMapFunction;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ValueState;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;<br><span class="hljs-keyword">import</span> org.apache.flink.api.java.tuple.Tuple;<br><span class="hljs-keyword">import</span> org.apache.flink.api.java.tuple.Tuple3;<br><span class="hljs-keyword">import</span> org.apache.flink.configuration.Configuration;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;<br><span class="hljs-keyword">import</span> org.apache.flink.util.Collector;<br><span class="hljs-keyword">import</span> util.SensorReading;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyedState_Case</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();<br>        env.setParallelism(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// socket文本流</span><br>        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">7777</span>);<br><br>        <span class="hljs-comment">// 转换成SensorReading类型</span><br>        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;<br>            String[] fields = line.split(<span class="hljs-string">&quot;,&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SensorReading</span>(fields[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(fields[<span class="hljs-number">1</span>]), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(fields[<span class="hljs-number">2</span>]));<br>        &#125;);<br><br><br>        <span class="hljs-comment">// 定义一个flatmap操作，检测温度跳变，输出报警</span><br>        SingleOutputStreamOperator&lt;Tuple3&lt;String, Double, Double&gt;&gt; resultStream =<br>                dataStream.keyBy(<span class="hljs-string">&quot;id&quot;</span>)<br>                .flatMap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TempChangingWarning</span>(<span class="hljs-number">10.0</span>));<br><br><br>        resultStream.print();<br><br>        env.execute();<br>    &#125;<br><br>    <span class="hljs-comment">// 实现自定义函数类</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TempChangingWarning</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RichFlatMapFunction</span>&lt;SensorReading, Tuple3&lt;String, Double, Double&gt;&gt; &#123;<br>        <span class="hljs-comment">// 私有属性，温度跳变的阈值</span><br>        <span class="hljs-keyword">private</span> Double threshold;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">TempChangingWarning</span><span class="hljs-params">(Double threshold)</span> &#123;<br>            <span class="hljs-built_in">this</span>.threshold = threshold;<br>        &#125;<br><br>        <span class="hljs-comment">// 定义状态，保存上次的温度值</span><br>        <span class="hljs-keyword">private</span> ValueState&lt;Double&gt; lastTempState;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">(Configuration parameters)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            lastTempState = getRuntimeContext().getState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;Double&gt;(<span class="hljs-string">&quot;last-temp&quot;</span>, Double.class));<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flatMap</span><span class="hljs-params">(SensorReading sensorReading, Collector&lt;Tuple3&lt;String, Double, Double&gt;&gt; collector)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-comment">// 获取状态</span><br>            <span class="hljs-type">Double</span> <span class="hljs-variable">lastTemp</span> <span class="hljs-operator">=</span> lastTempState.value();<br><br>            <span class="hljs-comment">// 如果状态不为null，那么就判断两次温度差值</span><br>            <span class="hljs-keyword">if</span> (lastTemp != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">Double</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> Math.abs(sensorReading.getTemperature() - lastTemp);<br>                <span class="hljs-keyword">if</span> (diff &gt;= threshold) &#123;<br>                    collector.collect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Tuple3</span>&lt;&gt;(sensorReading.getId(), lastTemp, sensorReading.getTemperature()));<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// 更新状态</span><br>            lastTempState.update(sensorReading.getTemperature());<br>        &#125;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210610002802.png" style="zoom:50%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>7 Flink的状态管理</title>
    <link href="/2022/12/0dd631d465ee.html"/>
    <url>/2022/12/0dd631d465ee.html</url>
    
    <content type="html"><![CDATA[<h1 id="7-Flink的状态管理"><a href="#7-Flink的状态管理" class="headerlink" title="7 Flink的状态管理"></a>7 Flink的状态管理</h1><h1 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h1><ol><li>Flink中的状态</li><li>算子状态（Operator State）</li><li>键控状态（Keyed State）</li><li>状态后端（State Backends）</li></ol><h2 id="状态的概念"><a href="#状态的概念" class="headerlink" title="状态的概念"></a>状态的概念</h2><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210521002340.png" style="zoom:50%;" /><ul><li><p>由一个任务维护，并且用来计算某个结果的所有数据，都属于这个任务的状态</p></li><li><p>可以认为状态就是一个本地变量，可以被任务的业务逻辑访问</p><p>注意：事实上，状态的确保存在本地，只是需要保证状态一致性等操作，由Flink实现</p></li><li><p>Flink会进行状态管理，包括状态一致性、故障处理以及高效存储和访问，以便开发人员可以专注于应用程序的逻辑</p></li></ul><h2 id="Flink中的状态"><a href="#Flink中的状态" class="headerlink" title="Flink中的状态"></a>Flink中的状态</h2><ul><li><p>在Flink中，状态始终与特定算子关联（和任务绑定）</p><p>注意：不能跨任务使用状态</p></li><li><p>为了使运行时的Flink了解算子的状态，算子需要预先注册其状态</p></li></ul><h3 id="状态的分类"><a href="#状态的分类" class="headerlink" title="状态的分类"></a>状态的分类</h3><p>根据<strong>作用域</strong>的不同，状态可以分为两类：</p><ol><li><p>算子状态</p><p>算子状态的作用范围限定为算子</p></li><li><p>键值分区状态</p><p>根据输入数据流中定义的键（key）来维护和访问</p></li></ol><h3 id="①-算子状态"><a href="#①-算子状态" class="headerlink" title="① 算子状态"></a>① 算子状态</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210521002947.png" style="zoom: 33%;" /><ul><li>算子状态的作用范围限定为<strong>算子任务</strong>，由同一并行任务所处理的所有数据都可以访问到相同的状态</li><li>状态对于同一子任务而言是共享的</li><li>算子状态不能由相同或不同算子的另一个子任务访问</li></ul><p>也就是说，哪怕都是map算子，但若不是同一个算子任务，则不能相互访问（例如一个map的结果要给另一个map，这两个map之间不能相互访问）。但是对于一个并行度为2的算子任务，这两个算子任务是可以相互访问的。</p><h4 id="算子状态的数据结构"><a href="#算子状态的数据结构" class="headerlink" title="算子状态的数据结构"></a>算子状态的数据结构</h4><ol><li><p>列表状态（list state）</p><p>将状态表示为一个条目列表</p></li><li><p>联合状态列表（union list state）</p><p>同样是将状态表示为一个条目列表，但在进行故障恢复或从某个保存点启动应用时，状态的恢复方式和普通列表有所不同。</p></li><li><p>广播状态（broadcast state）</p><p>如果一个算子有多项任务，而他们的任务状态又都相同，那么这种特殊情况最适合应用广播状态。</p></li></ol><h4 id="算子状态实例"><a href="#算子状态实例" class="headerlink" title="算子状态实例"></a>算子状态实例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.apitest.state;<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.functions.MapFunction;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.checkpoint.ListCheckpointed;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;<br><span class="hljs-keyword">import</span> util.SensorReading;<br><br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperatorState</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();<br>        env.setParallelism(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// socket文本流</span><br>        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">7777</span>);<br><br>        <span class="hljs-comment">// 转换成SensorReading类型</span><br>        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;<br>            String[] fields = line.split(<span class="hljs-string">&quot;,&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SensorReading</span>(fields[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(fields[<span class="hljs-number">1</span>]), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(fields[<span class="hljs-number">2</span>]));<br>        &#125;);<br><br>        <span class="hljs-comment">// 定义一个有状态的map操作，统计当前分区数据个数</span><br>        DataStream&lt;Integer&gt; resultStream = dataStream.map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCountMapper</span>());<br><br>        resultStream.print();<br><br><br>        env.execute();<br><br>    &#125;<br><br>    <span class="hljs-comment">// 自定义MapFunction</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCountMapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MapFunction</span>&lt;SensorReading, Integer&gt;, ListCheckpointed&lt;Integer&gt; &#123;<br><br>        <span class="hljs-comment">// 定义一个本地变量，作为算子状态</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">map</span><span class="hljs-params">(SensorReading sensorReading)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            count++;<br>            <span class="hljs-keyword">return</span> count;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">snapshotState</span><span class="hljs-params">(<span class="hljs-type">long</span> l, <span class="hljs-type">long</span> l1)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-comment">// 对状态做快照，返回Integer类型的list</span><br>            <span class="hljs-keyword">return</span> Collections.singletonList(count);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">restoreState</span><span class="hljs-params">(List&lt;Integer&gt; state)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-comment">// 从错误状态恢复</span><br>            <span class="hljs-keyword">for</span> (Integer number : state) &#123;<br>                <br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210609012434.png" style="zoom:50%;" /><h3 id="②-键值分区状态"><a href="#②-键值分区状态" class="headerlink" title="② 键值分区状态"></a>② 键值分区状态</h3><p>键值分区状态会按照<strong>算子输入记录</strong>所定义的<strong>键值</strong>来进行维护或访问。</p><p>Flink为每个键值都维护了一个状态实例，该实例总是位于那个<strong>处理对应键值记录的算子任务</strong>上。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210522191509.png" style="zoom: 80%;" /><p>图中两个Task是两个<strong>并行子任务</strong>（也就是同一个任务，每个任务可能有多个key），图中每种颜色的数据代表一个key。每个key有一个状态，黄色的key只能访问黄色的状态，粉色的key只能访问粉色的状态。</p><p>当任务处理一条数据时，它会自动访问当前键值对应的状态。</p><h4 id="键值分区状态的数据结构"><a href="#键值分区状态的数据结构" class="headerlink" title="键值分区状态的数据结构"></a>键值分区状态的数据结构</h4><ol><li><p>值状态（Value state）</p><p>将状态表示为单个的值</p></li><li><p>列表状态（List State）</p><p>将状态表示为一组数据的列表</p></li><li><p>映射状态（Map state）</p><p>将状态表示为一组key-value对</p></li><li><p>聚合状态（Reducing state &amp; Aggregating State）</p><p>将状态表示为一个用于聚合操作的列表</p></li></ol><h4 id="键值分区状态实例"><a href="#键值分区状态实例" class="headerlink" title="键值分区状态实例"></a>键值分区状态实例</h4><p>使用：</p><ul><li><p>声明一个键控状态</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">myValueState = getRuntimeContext().getState(<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;Integer&gt;(<br>  <span class="hljs-string">&quot;my-value&quot;</span>,<br>  Integer.class));<br></code></pre></td></tr></table></figure></li><li><p>读取状态</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Integer</span> <span class="hljs-variable">myValue</span> <span class="hljs-operator">=</span> myValueState.value()<br></code></pre></td></tr></table></figure></li><li><p>对状态赋值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">myValue.update(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure></li></ul><h5 id="值状态实例"><a href="#值状态实例" class="headerlink" title="值状态实例"></a>值状态实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.apitest.state;<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.functions.RichMapFunction;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ValueState;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;<br><span class="hljs-keyword">import</span> org.apache.flink.configuration.Configuration;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;<br><span class="hljs-keyword">import</span> util.SensorReading;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyedState</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();<br>        env.setParallelism(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// socket文本流</span><br>        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">7777</span>);<br><br>        <span class="hljs-comment">// 转换成SensorReading类型</span><br>        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;<br>            String[] fields = line.split(<span class="hljs-string">&quot;,&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SensorReading</span>(fields[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(fields[<span class="hljs-number">1</span>]), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(fields[<span class="hljs-number">2</span>]));<br>        &#125;);<br><br>        <span class="hljs-comment">// 定义一个有状态的map操作，统计当前sensor数据个数</span><br>        DataStream&lt;Integer&gt; resultStream = dataStream<br>                .keyBy(<span class="hljs-string">&quot;id&quot;</span>)<br>                .map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyKeyCountMapper</span>());<br><br>        resultStream.print();<br><br><br>        env.execute();<br>    &#125;<br><br>    <span class="hljs-comment">//自定义MapFunction，普通MapFunction不能完成，必须使用RichMapFunction</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyKeyCountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RichMapFunction</span>&lt;SensorReading, Integer&gt;&#123;<br><br>        <span class="hljs-keyword">private</span> ValueState&lt;Integer&gt; keyCountState;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">(Configuration parameters)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            keyCountState = getRuntimeContext().getState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;Integer&gt;(<span class="hljs-string">&quot;key-count&quot;</span>, Integer.class));<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">map</span><span class="hljs-params">(SensorReading sensorReading)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> keyCountState.value();<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-literal">null</span>) &#123;<br>                count = <span class="hljs-number">0</span>;<br>            &#125;<br>            count++;<br>            keyCountState.update(count);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125;<br>    &#125;<br><br><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210609010347.png" style="zoom:30%;" /><h5 id="列表状态实例"><a href="#列表状态实例" class="headerlink" title="列表状态实例"></a>列表状态实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.apitest.state;<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.functions.RichMapFunction;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ListState;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ListStateDescriptor;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ValueState;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;<br><span class="hljs-keyword">import</span> org.apache.flink.configuration.Configuration;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.checkpoint.ListCheckpointed;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;<br><span class="hljs-keyword">import</span> util.SensorReading;<br><br><span class="hljs-keyword">import</span> java.util.Collections;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyedState</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();<br>        env.setParallelism(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// socket文本流</span><br>        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">7777</span>);<br><br>        <span class="hljs-comment">// 转换成SensorReading类型</span><br>        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;<br>            String[] fields = line.split(<span class="hljs-string">&quot;,&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SensorReading</span>(fields[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(fields[<span class="hljs-number">1</span>]), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(fields[<span class="hljs-number">2</span>]));<br>        &#125;);<br><br>        <span class="hljs-comment">// 定义一个有状态的map操作，统计当前sensor数据个数</span><br>        DataStream&lt;Integer&gt; resultStream = dataStream<br>                .keyBy(<span class="hljs-string">&quot;id&quot;</span>)<br>                .map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyKeyCountMapper</span>());<br><br>        resultStream.print();<br><br><br>        env.execute();<br>    &#125;<br><br>    <span class="hljs-comment">//自定义MapFunction，普通MapFunction不能完成，必须使用RichMapFunction</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyKeyCountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RichMapFunction</span>&lt;SensorReading, Integer&gt;&#123;<br><br>        <span class="hljs-keyword">private</span> ValueState&lt;Integer&gt; keyCountState;<br>        <span class="hljs-keyword">private</span> ListState&lt;String&gt; listState;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">(Configuration parameters)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            keyCountState = getRuntimeContext().getState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;Integer&gt;(<span class="hljs-string">&quot;key-count&quot;</span>, Integer.class));<br>            listState = getRuntimeContext().getListState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListStateDescriptor</span>&lt;String&gt;(<span class="hljs-string">&quot;my-list&quot;</span>, String.class));<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">map</span><span class="hljs-params">(SensorReading sensorReading)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-comment">// 值状态API调用</span><br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> keyCountState.value();<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-literal">null</span>) &#123;<br>                count = <span class="hljs-number">0</span>;<br>            &#125;<br>            count++;<br>            keyCountState.update(count);<br><br>            <span class="hljs-comment">// 列表状态API调用</span><br>            Iterable&lt;String&gt; strings = listState.get();<br>            <span class="hljs-comment">// 每次增加一行，值为count</span><br>            listState.add(String.valueOf(count));<br>            <span class="hljs-comment">// 然后遍历</span><br>            <span class="hljs-keyword">for</span> (String each : strings) &#123;<br>                System.out.println(<span class="hljs-string">&quot;the element of strings is &quot;</span> + each);<br>            &#125;<br>            <br>            <span class="hljs-keyword">return</span> count;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果：</p><img src="/Users/heyizhi/Library/Application Support/typora-user-images/image-20210609011913221.png" alt="image-20210609011913221" style="zoom:50%;" /><h5 id="映射状态实例"><a href="#映射状态实例" class="headerlink" title="映射状态实例"></a>映射状态实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.apitest.state;<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.functions.RichMapFunction;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.state.*;<br><span class="hljs-keyword">import</span> org.apache.flink.configuration.Configuration;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.checkpoint.ListCheckpointed;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;<br><span class="hljs-keyword">import</span> util.SensorReading;<br><br><span class="hljs-keyword">import</span> java.util.Collections;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyedState</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();<br>        env.setParallelism(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// socket文本流</span><br>        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">7777</span>);<br><br>        <span class="hljs-comment">// 转换成SensorReading类型</span><br>        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;<br>            String[] fields = line.split(<span class="hljs-string">&quot;,&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SensorReading</span>(fields[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(fields[<span class="hljs-number">1</span>]), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(fields[<span class="hljs-number">2</span>]));<br>        &#125;);<br><br>        <span class="hljs-comment">// 定义一个有状态的map操作，统计当前sensor数据个数</span><br>        DataStream&lt;Integer&gt; resultStream = dataStream<br>                .keyBy(<span class="hljs-string">&quot;id&quot;</span>)<br>                .map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyKeyCountMapper</span>());<br><br>        resultStream.print();<br><br><br>        env.execute();<br>    &#125;<br><br>    <span class="hljs-comment">//自定义MapFunction，普通MapFunction不能完成，必须使用RichMapFunction</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyKeyCountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RichMapFunction</span>&lt;SensorReading, Integer&gt;&#123;<br><br>        <span class="hljs-keyword">private</span> ValueState&lt;Integer&gt; keyCountState;<br>        <span class="hljs-keyword">private</span> ListState&lt;String&gt; listState;<br>        <span class="hljs-keyword">private</span> MapState&lt;String, Integer&gt; mapState;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">(Configuration parameters)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            keyCountState = getRuntimeContext().getState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;Integer&gt;(<span class="hljs-string">&quot;key-count&quot;</span>, Integer.class));<br>            listState = getRuntimeContext().getListState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListStateDescriptor</span>&lt;String&gt;(<span class="hljs-string">&quot;my-list&quot;</span>, String.class));<br>            mapState = getRuntimeContext().getMapState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapStateDescriptor</span>&lt;String, Integer&gt;(<span class="hljs-string">&quot;my-map&quot;</span>, String.class, Integer.class));<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">map</span><span class="hljs-params">(SensorReading sensorReading)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-comment">// 值状态API调用</span><br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> keyCountState.value();<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-literal">null</span>) &#123;<br>                count = <span class="hljs-number">0</span>;<br>            &#125;<br>            count++;<br>            keyCountState.update(count);<br><br>            <span class="hljs-comment">// 列表状态API调用</span><br>            Iterable&lt;String&gt; strings = listState.get();<br>            <span class="hljs-comment">// 每次增加一行，值为count</span><br>            listState.add(String.valueOf(count));<br>            <span class="hljs-comment">// 然后遍历</span><br>            <span class="hljs-keyword">for</span> (String each : strings) &#123;<br>                System.out.println(<span class="hljs-string">&quot;the element of strings is &quot;</span> + each);<br>            &#125;<br>            <br>            <span class="hljs-comment">// map state</span><br>            mapState.get(<span class="hljs-string">&quot;1&quot;</span>);<br>            mapState.put(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">1</span>);<br>            mapState.remove(<span class="hljs-string">&quot;2&quot;</span>);<br>            <br>            <span class="hljs-keyword">return</span> count;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="状态后端"><a href="#状态后端" class="headerlink" title="状态后端"></a>状态后端</h2><p>为了保证快速访问状态，每个并行任务都会把状态维护在本地。至于状态具体的存储、访问和维护，则是由一个名为<strong>状态后端</strong>的可插拔组件来决定。</p><h3 id="状态后端的任务"><a href="#状态后端的任务" class="headerlink" title="状态后端的任务"></a>状态后端的任务</h3><p>状态后端主要负责两件事：</p><ol><li>本地状态的管理</li><li>将状态以检查点的形式写入远程存储</li></ol><h3 id="状态后端的存储方式"><a href="#状态后端的存储方式" class="headerlink" title="状态后端的存储方式"></a>状态后端的存储方式</h3><ol><li>一类状态后端会把<strong>键值分区状态作为对象</strong>，以内存数据结构的形式<strong>存在JVM堆</strong>中</li><li>另一类状态后端会把<strong>状态对象序列化</strong>后<strong>存到RocksDB</strong>中</li></ol><h3 id="状态后端类型"><a href="#状态后端类型" class="headerlink" title="状态后端类型"></a>状态后端类型</h3><ol><li><p>MemoryStateBackend</p><p>内存级的状态后端，会将键控状态作为内存中的对象进行管理，将它们存储在TaskManager的JVM堆上，而将checkpoint存储在JobManager的内存中</p><p><strong>特点</strong>：</p><p>快速、低延迟，但不稳定（使用较少）</p></li><li><p>FsStateBackend</p><p>将checkpoint存到远程的持久化文件系统上，而对本地状态，和MemoryStateBackend一样，也会存在TaskManager的JVM堆上</p><p><strong>特点</strong>：</p><p>同时拥有内存级的本地访问速度，和更好的容错保证</p><p><strong>缺点</strong>：</p><p>所有状态放在内存中，内存可能不够，只能不断扩容然后重新启动。</p></li><li><p>RocksDBStateBackend</p><p>将所有状态序列化后，存入本地的RocksDB中存储。</p><p><strong>特点</strong>：</p><p>不会出现内存不够的情况，状态存在本地RocksDB（硬盘管够）</p><p><strong>缺点</strong>：</p><p>所有状态都需要序列化，速度可能更慢</p></li></ol><h2 id="有状态算子的扩缩容"><a href="#有状态算子的扩缩容" class="headerlink" title="有状态算子的扩缩容"></a>有状态算子的扩缩容</h2><h3 id="扩缩容介绍"><a href="#扩缩容介绍" class="headerlink" title="扩缩容介绍"></a>扩缩容介绍</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210526162745.png" style="zoom: 33%;" /><p>Flink对不同类型的状态提供了四种扩缩容模式。</p><h3 id="带有键值分区状态的算子"><a href="#带有键值分区状态的算子" class="headerlink" title="带有键值分区状态的算子"></a>带有键值分区状态的算子</h3><p>带有键值分区状态的算子在扩缩容时会根据新的任务数量对键值重新分区。</p><p><strong>注意</strong>：</p><p>为了降低状态在不同任务之间的迁移成本，Flink不会对单独的键值实施再分配，而是会把所有键值分为不同的键值组（key group）。每个键值组都包含了部分键值，Flink以此为单位把键值分配给不同任务。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210526105034.png" style="zoom: 30%;" /><p>如图所示，两个键值分区状态组成一个键值组，在扩缩容时，Flink不对一个键值组里的具体键值分区状态进行重分配，而是直接将整个键值组进行重分配给不同任务。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210526201935.png" style="zoom: 33%;" /><p>更进一步的，如上图所示，一个DataStream经过keyBy之后会被切分为不同的KeyStream，每个KeyStream会有不同的key，</p><h3 id="带有算子状态的算子"><a href="#带有算子状态的算子" class="headerlink" title="带有算子状态的算子"></a>带有算子状态的算子</h3><p>带有算子状态的算子在扩缩容时会对列表中的条目进行重分配。</p><p>理论上，所有并行算子任务的列表条目会被统一收集起来，随后均匀分配到更少或更多的任务之上。</p><p><strong>注意</strong>：</p><p>如果列表条目的数量小于算子新设置的并行度，部分任务在启动时的状态就可能为空。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>6.2 基于时间的算子</title>
    <link href="/2022/12/1f5fdac17e80.html"/>
    <url>/2022/12/1f5fdac17e80.html</url>
    
    <content type="html"><![CDATA[<h1 id="时间语义"><a href="#时间语义" class="headerlink" title="时间语义"></a>时间语义</h1><p>算子语义应该依赖事件实际发生时间而且应用收到事件的时间。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210228185234.png" style="zoom:50%;" /><p>流式应用可以使用两个完全不同概念的时间，即处理时间和事件时间</p><ol><li><p>处理时间（processing time）</p><p>处理时间是当前流处理算在所在机器上的本地时钟时间。与机器有关</p></li><li><p>事件时间（event time）</p><p>事件时间是数据流中事件实际发生的时间，它以附加在数据流中事件的时间戳为依据。</p></li></ol><h2 id="图解处理时间和事件时间"><a href="#图解处理时间和事件时间" class="headerlink" title="图解处理时间和事件时间"></a>图解处理时间和事件时间</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210228185928.png" style="zoom:50%;" /><p>事件时间将处理速度和结果内容彻底解耦。我们也往往更关心事件时间。基于事件时间的操作是可预测的，其结果具有确定性。无论数据流的处理速度如何、事件到达算子的顺序怎样，基于事件时间的窗口都会生成相同的结果。</p><h2 id="哪种时间语义更重要"><a href="#哪种时间语义更重要" class="headerlink" title="哪种时间语义更重要"></a>哪种时间语义更重要</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210301024310.png" style="zoom:50%;" /><p>可以看到，红色框为 Processing Time，绿色框为 Event Time，大部分时间 Event Time 更重要。</p><h2 id="设置处理时间或事件时间的方法"><a href="#设置处理时间或事件时间的方法" class="headerlink" title="设置处理时间或事件时间的方法"></a>设置处理时间或事件时间的方法</h2><p>默认状态即为处理时间，若需要使用事件时间则需要设置</p><h3 id="Scala-版本"><a href="#Scala-版本" class="headerlink" title="Scala 版本"></a>Scala 版本</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.<span class="hljs-type">TimeCharacteristic</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.<span class="hljs-type">StreamExecutionEnvironment</span><br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">TimeWindowTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br>    <span class="hljs-comment">// 设置事件时间</span><br><span class="hljs-comment">//    env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)</span><br>    <span class="hljs-comment">// 设置处理时间</span><br>    env.setStreamTimeCharacteristic(<span class="hljs-type">TimeCharacteristic</span>.<span class="hljs-type">ProcessingTime</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Java-版本"><a href="#Java-版本" class="headerlink" title="Java 版本"></a>Java 版本</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">apitest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();  <br>        <span class="hljs-comment">// 设置为处理时间  </span><br>        env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="水位线（watermark）"><a href="#水位线（watermark）" class="headerlink" title="水位线（watermark）"></a>水位线（watermark）</h1><h2 id="乱序数据的影响"><a href="#乱序数据的影响" class="headerlink" title="乱序数据的影响"></a>乱序数据的影响</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210301025256.png" style="zoom:33%;" /><p>在上图中，我们将窗口设置为 5s，那么在实际情况中，5s 的数据已经来到，此时是否应该关闭窗口？</p><ul><li>Flink 以 Event Time 模式处理数据流时，它会根据数据里的时间戳来处理基于时间的算子</li><li>由于网络、分布式等原因，会导致乱序数据的产生</li></ul><p>因为需要引入水位线</p><h2 id="水位线概念"><a href="#水位线概念" class="headerlink" title="水位线概念"></a>水位线概念</h2><p>水位线是一个<strong>全局进度指标</strong>，表示我们确信不会再有延迟事件到来的某个的时间点。本质上水位线提供了一个逻辑时钟，用来通知系统当前的事件时间。</p><p>当一个算子接收到时间为 T 的水位线，就可以认为不会再收到任何时间戳小于或等于 T 的事件了。水位线无论对于事件时间窗口还是处理乱序事件的算子都很关键。算子一旦收到某个水位线，就相当于接到信号：某个特定时间区间的时间戳已经到齐，可以触发窗口计算或对接收的数据进行排序了。</p><h2 id="水位线作用"><a href="#水位线作用" class="headerlink" title="水位线作用"></a>水位线作用</h2><p>水位线允许我们在结果的<strong>准确性和延迟之间做出取舍</strong>。</p><h2 id="水位线特点"><a href="#水位线特点" class="headerlink" title="水位线特点"></a>水位线特点</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210301031105.png"></p><ul><li><p>watermark 是一条特殊的数据记录（里面只有一类信息：当前的事件时间）</p><p>也就是说，水位线到来之后，水位线的记录时间之前的数据开始全部不接受，窗口关闭。</p></li><li><p>watermark 必须单调递增，以确保任务的事件时间时钟在向前推进，而不是在后退</p></li><li><p>water 与数据时间戳相关</p></li></ul><h2 id="水位线的类型"><a href="#水位线的类型" class="headerlink" title="水位线的类型"></a>水位线的类型</h2><h3 id="有序流中的水位线"><a href="#有序流中的水位线" class="headerlink" title="有序流中的水位线"></a>有序流中的水位线</h3><ol><li><p>每条记录都插入一条水位线</p><img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221130014608.png" width = "100%" /><p>可以看到，每到来一条记录就会产生一条水位线，这种是最直观的，但是效率也很低</p></li><li><p>周期性插入水位线</p><img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221130014750.png" width = "100%" /><p>可以看到，首先来的数据是 2 5 7，此时到了一个周期，会自动找到这个周期中最大值，也就是 7，产生一条水位线，然后是 9 9 9 10 11，最大值是 11，也会产生一条水位线。</p></li></ol><h3 id="乱序流中的水位线"><a href="#乱序流中的水位线" class="headerlink" title="乱序流中的水位线"></a>乱序流中的水位线</h3><ol><li><p>判断只有数据的时间戳比当前时钟大，才能推动时间前进，这时才插入水位线</p><img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221130015328.png" width = "100%" /><p>可以看到，当水位线为9时，来了时间戳为7 9 9的数据，水位线都不产生变动，因为这个是所谓“迟到数据”，只有当时间戳为11的数据来了时，水位线才会变动。以此类推</p></li><li><p>周期性插入水位线的方法</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221130020335168.png" width = "100%" /><p>和上面的类似，也是比较周期时间范围内时间戳的最大值</p></li></ol><p></p><h3 id="处理迟到数据的水位线"><a href="#处理迟到数据的水位线" class="headerlink" title="处理迟到数据的水位线"></a>处理迟到数据的水位线</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221130020619684.png" width = "100%" /><p>可以看到，此时处理的水位线是T-2的，也就是说，当接受到数据时间为8的数据时，此时会将窗口的右半边延伸至T&#x3D;6处，确保迟到数据能处理完成（但也不绝对，有可能就是延迟很久，需要做权衡）</p><h2 id="水位线的传播"><a href="#水位线的传播" class="headerlink" title="水位线的传播"></a>水位线的传播</h2><p>当任务接收到一个水位线时会执行以下操作：</p><ol><li>基于水位线记录的时间戳更新内部时间时钟</li><li>任务的时间服务会找出所有触发时间小于更新后事件时间的计时器。对于每个到期的计时器，调用回调函数，利用它来执行计算或发出记录</li><li>任务根据更新后的事件时间将水位线发出</li></ol><p>Flink 会将数据流划分为不同的分区，并将它们交由不同的算子任务来并行执行。每个分区作为一个数据流，都会包含带有时间戳的记录以及水位线。</p><p>一个任务可能同时接受来自多个输入分区的记录和水位线，也可能需要将它们发送到多个输出分区。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>一个 4 个输入分区和 3 个输出分区的任务在接收到水位线后对分区水位线和事件时钟的更新过程。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210301042945.png"></p><h2 id="时间戳分配和水位线生成"><a href="#时间戳分配和水位线生成" class="headerlink" title="时间戳分配和水位线生成"></a>时间戳分配和水位线生成</h2><p>时间戳和水位线通常都是在数据流刚刚进入流处理应用的时候分配和生成的。</p><p>生成水位线可以由以下三种方式指定：</p><ol><li><p>在数据源完成</p><p>可以利用 SourceFunction 在应用读入数据流的时候分配时间戳和生成水位线。源函数会发出一条记录流。每个发出的记录都可以附加一个时间戳，水位线可以作为特殊记录在任何时间点发出。</p></li><li><p>周期分配器</p><p>用名为 AssignerWithPeriodWatermarks 的用户自定义函数，它可以用来从每条记录提取时间戳，并周期性地响应获取当前水位线的查询请求。</p></li><li><p>定点分配器</p><p>用名为 AssignerWithPunctuatedWatermarks 的用户自定义函数，它可以用于需要根据特殊输入记录产生水位线的情况。</p></li></ol><h3 id="周期性水位线分配器"><a href="#周期性水位线分配器" class="headerlink" title="周期性水位线分配器"></a>周期性水位线分配器</h3><p>周期性分配水位线的含义是我们会指示系统以固定的机器时间间隔来发出水位线并推动事件时间前进。</p><h4 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h4><p>设置每 5 秒发出一次水位线</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br><br>env.setStreamTimeCharacteristic(<span class="hljs-type">TimeCharacteristic</span>.<span class="hljs-type">EventTime</span>)<br><span class="hljs-comment">// 每5秒生成一次水位线</span><br>env.getConfig.setAutoWatermarkInterval(<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>实际上，Flink 会每隔 5 秒调用一次 AssignerWithPeriodWatermarks 中的 getCurrentWatermark()方法。如果该方法返回值非空，且时间戳大于上一个水位线的时间戳，那么算子就会发出一个新的水位线。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>6.1 基于窗口的算子</title>
    <link href="/2022/12/97241936c765.html"/>
    <url>/2022/12/97241936c765.html</url>
    
    <content type="html"><![CDATA[<h1 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h1><ul><li>window 概念</li><li>window 类型</li><li>window API</li></ul><h1 id="window-概念"><a href="#window-概念" class="headerlink" title="window 概念"></a>window 概念</h1><p>streaming 流式计算是一种被设计用于处理无限数据集的数据处理引擎，而无限数据集是指一种不断增长的本质上无限的数据集， 而 window 是一种切割无限数据 为有限块进行处理的手段。</p><p>Window 是无限数据流处理的核心，Window 将一个无限的 stream 拆分成有限大小的”buckets”桶， 我们可以在这些桶上做计算操作。</p><h1 id="window-类型"><a href="#window-类型" class="headerlink" title="window 类型"></a>window 类型</h1><ul><li><p>时间窗口（Time Window）</p><ul><li>滚动时间窗口</li><li>滑动时间窗口</li><li>会话窗口</li></ul></li><li><p>计数窗口（Count Window）</p><p>基于数量的窗口具有不确定性，因为其需要依赖于元素的到达顺序。</p><ul><li>滚动计数窗口</li><li>滑动计数窗口</li></ul></li></ul><h1 id="window-API"><a href="#window-API" class="headerlink" title="window API"></a>window API</h1><p>可以用 <code>.window()</code> 来定义一个窗口，然后基于这个 window 去做一些聚合或者其他处理操作。</p><p>Flink 内置窗口分配器所创建的窗口类型为 TimeWindow。该窗口类型实际上表示两个时间戳之间的时间区间（左闭右开）。它对外提供了获取窗口边界、检查窗口是否想交以及合并重叠窗口等方法。</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>window()方法必须在 keyBy 之后才能用</p><h2 id="滚动窗口"><a href="#滚动窗口" class="headerlink" title="滚动窗口"></a>滚动窗口</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210226015355.png" style="zoom: 50%;" /><p>如图所示，滚动窗口分配器将元素放入大小固定且互不重叠的窗口中。</p><h3 id="开启窗口方法"><a href="#开启窗口方法" class="headerlink" title="开启窗口方法"></a>开启窗口方法</h3><h4 id="window"><a href="#window" class="headerlink" title="window"></a>window</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.window(<span class="hljs-type">TumblingEventTimeWindows</span>.of(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">1</span>)))<br></code></pre></td></tr></table></figure><h4 id="timeWindow"><a href="#timeWindow" class="headerlink" title="timeWindow"></a>timeWindow</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.timeWindow(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure><p>在这里滚动窗口默认和纪元时间 1970-01-01-00：00：00.000 对齐</p><h3 id="指定偏移量"><a href="#指定偏移量" class="headerlink" title="指定偏移量"></a>指定偏移量</h3><p>通过第二个参数指定一个偏移量</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.window(<span class="hljs-type">TumblingEventTimeWindows</span>.of(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">1</span>), <span class="hljs-type">Time</span>.minutes(<span class="hljs-number">15</span>)))<br></code></pre></td></tr></table></figure><p>上述代码展示了偏移量</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> resultStream2: <span class="hljs-type">WindowedStream</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>), <span class="hljs-type">Tuple</span>, <span class="hljs-type">TimeWindow</span>] = sensorData<br>  .map(data =&gt; (data.id, data.temperature))<br>  <span class="hljs-comment">// 用二元祖的第一个元素来进行分区</span><br>  <span class="hljs-comment">//      .keyBy(_._1)</span><br>  .keyBy(<span class="hljs-number">1</span>) <span class="hljs-comment">//两种都可以</span><br>  <span class="hljs-comment">// .window(TumblingEventTimeWindows.of(Time.seconds(1)))的简写</span><br>  <span class="hljs-comment">// .timeWindow(Time.seconds(1))</span><br>  .window(<span class="hljs-type">TumblingEventTimeWindows</span>.of(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">1</span>), <span class="hljs-type">Time</span>.minutes(<span class="hljs-number">15</span>)))<br></code></pre></td></tr></table></figure><h2 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210226015520.png" style="zoom:50%;" /><p>如图所示，滑动窗口分配器将元素置于大小固定且可能重叠的窗口中。</p><p>与滚动窗口类似，用的是 SlidingEventTimeWindows</p><h3 id="开启滑动窗口"><a href="#开启滑动窗口" class="headerlink" title="开启滑动窗口"></a>开启滑动窗口</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 方法1</span><br>.window(<span class="hljs-type">SlidingEventTimeWindows</span>.of(<span class="hljs-type">Time</span>.hours(<span class="hljs-number">1</span>), <span class="hljs-type">Time</span>.minutes(<span class="hljs-number">15</span>)))<br><span class="hljs-comment">// 方法2</span><br>.timeWindow(<span class="hljs-type">Time</span>.hours(<span class="hljs-number">1</span>), <span class="hljs-type">Time</span>.minutes(<span class="hljs-number">15</span>))<br></code></pre></td></tr></table></figure><p>类似的，可以用第三个参数可以设置偏移时间</p><h3 id="设置偏移时间"><a href="#设置偏移时间" class="headerlink" title="设置偏移时间"></a>设置偏移时间</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.window(<span class="hljs-type">SlidingEventTimeWindows</span>.of(<span class="hljs-type">Time</span>.hours(<span class="hljs-number">1</span>), <span class="hljs-type">Time</span>.minutes(<span class="hljs-number">15</span>), <span class="hljs-type">Time</span>.seconds(<span class="hljs-number">5</span>)))<br></code></pre></td></tr></table></figure><h2 id="会话窗口"><a href="#会话窗口" class="headerlink" title="会话窗口"></a>会话窗口</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210226020035.png" style="zoom:50%;" /><p>由一系列事件组合一个指定时间长度的 timeout 间隙组成， 类似于 web 应用的 session， 也就是一段时间没有接收到新数据就会生成新的窗口。</p><p>特点：时间无对齐。</p><p>session 窗口分配器通过 session 活动来对元素进行分组， session 窗口跟滚动窗口和滑动窗口相比，不会有重叠和固定的开始时间和结束时间的情况，相反，当它在一个固定的时间周期内不再收到元素， 即非活动间隔产生， 那个这个窗口就会关闭。一个 session 窗口通过一个 session 间隔来配置，这个 session 间隔定义了非活跃周期的长度，当这个非活跃周期产生，那么当前的 session 将关闭并且后续的元素将被分配到新的 session 窗口中去。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.window(<span class="hljs-type">ProcessingTimeSessionWindows</span>.withGap(<span class="hljs-type">Time</span>.minutes(<span class="hljs-number">15</span>)))<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>若需要指定偏移量则不能用简写。</p><p>简写形式全是用来创建没有偏移量的滑动窗口和滚动窗口。</p><p>会话窗口的创建没有简写。</p><h1 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h1><h2 id="DataStream-转换图"><a href="#DataStream-转换图" class="headerlink" title="DataStream 转换图"></a>DataStream 转换图</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210226163820.png" style="zoom:50%;" /><p>经过一系列的操作，最终 DataStream 会回到本身的类型</p><p>从 WindowStream 到 DataStream 的步骤为 window function（窗口函数）。</p><h2 id="窗口函数的类型"><a href="#窗口函数的类型" class="headerlink" title="窗口函数的类型"></a>窗口函数的类型</h2><ol><li><p>增量聚合函数。</p><p>它的应用场景是窗口内以状态形式存储某个值且需要根语个加入窗口的元素对该值进行更新。此类函数通常会十分节省空间且最终会将聚合值作为单个结果发送出去。</p><p>ReduceFunction 和 AggregateFunction 就属于增量聚合函数。</p><p>也就是说，<strong>每条数据</strong>到来就进行计算，保持一个简单的状态。</p></li><li><p>全量窗口函数</p><p>它会收集窗口内的<strong>所有元素</strong>，并在执行计算时对它们进行遍历。虽然全量窗口函数通常需要占用更多空间，但它和增量聚合函数相比，支持更复杂的逻辑。</p><p>ProcesswindowFunction 就是一个全量窗口函数。</p></li></ol><h2 id="ReduceFunction"><a href="#ReduceFunction" class="headerlink" title="ReduceFunction"></a>ReduceFunction</h2><p>ReduceFunction 接收两个同类型的值并将它们组合生成一个类型不变的值。当被用在窗口化数据流上时，ReduceFunction 会对分配给窗口的元素进行增量聚合。</p><p>窗口只需要存储当前聚合结果，一个和 ReduceFunction 的输入及输出类型都相同的值。每当收到一个新元素，算子都会以该元素和从窗口状态取出的当前聚合值为参数调用 ReduceFunction，随后会用 ReduceFunction 的结果替换窗口状态。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>只需为每个窗口维护一个常数级别的小状态。此外函数的接口也很简单。</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>ReduceFunction 的应用场景存在一定局限，由于输入输出类型必须一致，所以通常仅限于一些简单的聚合。</p><h3 id="每一步对应关系"><a href="#每一步对应关系" class="headerlink" title="每一步对应关系"></a>每一步对应关系</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/20210609004754.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210227035639.png" style="zoom: 50%;" /><p>可以看到，先通过 map()将每个 SensorReading 类型的 DataStream 对应变换为二元祖类型的 DataStream。</p><p>然后根据 keyBy()将二元祖根据第一个元素（String）进行分区，得到 KeyedStream，其第一个元素是二元祖，第二个元素是 String。请注意，这里的 String 就是分区的键值，如果是按照第二个元素（Double）进行分区，那么得到的 KeyedStream 的第二个元素就是 Double。</p><p>然后根据 timeWindow()将 KeyedStream 变为由三个元祖组成的 WindowedStream。</p><p>最后根据 reduce()将 WindowedStream 转换为 DataStream。</p><p>在最后的</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.reduce((r1, r2) =&gt; (r1._1, r1_2.min(r2._2)))<br></code></pre></td></tr></table></figure><p>其中的 r1 和 r2 分别是新老数据，实时进行更新。</p><h2 id="AggregateFunction"><a href="#AggregateFunction" class="headerlink" title="AggregateFunction"></a>AggregateFunction</h2><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PublicEvolving</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AggregateFunction</span>&lt;IN, ACC, OUT&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span>, Serializable &#123;<br>    ACC <span class="hljs-title function_">createAccumulator</span><span class="hljs-params">()</span>;<br><br>    ACC <span class="hljs-title function_">add</span><span class="hljs-params">(IN var1, ACC var2)</span>;<br><br>    OUT <span class="hljs-title function_">getResult</span><span class="hljs-params">(ACC var1)</span>;<br><br>    ACC <span class="hljs-title function_">merge</span><span class="hljs-params">(ACC var1, ACC var2)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>该接口定义了输入类型 IN，累加器类型 ACC 以及结果类型 OUT。</p><p>它和 ReduceFunction 不同的是中间数据类型以及结果类型<strong>不再依赖输入类型</strong>。</p><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>使用 AggregateFunction 计算每个窗口内传感器读书的平均温度。累加器负责维护不断变化的温度总和及数量，getResult()方法用来计算平均值。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.functions.<span class="hljs-type">AggregateFunction</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala._<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.time.<span class="hljs-type">Time</span><br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">AggregateFunctionTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br>    <span class="hljs-keyword">val</span> sensorData: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] =<br>      env.fromElements(<span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor_1&quot;</span>, <span class="hljs-number">100</span>, <span class="hljs-number">20</span>), <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor_2&quot;</span>, <span class="hljs-number">101</span>, <span class="hljs-number">22</span>))<br><br>    <span class="hljs-keyword">val</span> avgTempPerWindow: <span class="hljs-type">DataStream</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>)] = sensorData<br>      .map(r =&gt; (r.id, r.temperature))<br>      .keyBy(_._1)<br>      .timeWindow(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">15</span>))<br>      .aggregate(<span class="hljs-keyword">new</span> <span class="hljs-type">AvgTempFunction</span>)<br><br>    avgTempPerWindow.print()<br>    env.execute(<span class="hljs-string">&quot;Aggregation Test&quot;</span>)<br><br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AvgTempFunction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AggregateFunction</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>), (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>), (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>)] </span>&#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createAccumulator</span></span>(): (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>) = &#123;<br>    (<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0</span>)<br>  &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(in: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>), acc: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>)): (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>) = &#123;<br>    (in._1, in._2 + acc._2, <span class="hljs-number">1</span> + acc._3)<br>  &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getResult</span></span>(acc: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>)): (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>) = &#123;<br>    (acc._1, acc._2 /  acc._3)<br>  &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">merge</span></span>(acc: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>), acc1: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>)): (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Int</span>) = &#123;<br>    (acc._1, acc._2 + acc1._2, acc._3 + acc1._3)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ProcessWindowFunction"><a href="#ProcessWindowFunction" class="headerlink" title="ProcessWindowFunction"></a>ProcessWindowFunction</h2><h3 id="reduce-和-aggregate-的不足"><a href="#reduce-和-aggregate-的不足" class="headerlink" title="reduce()和 aggregate()的不足"></a>reduce()和 aggregate()的不足</h3><p>它们都是对分配到窗口的事件进行增量计算。然而有时候我们需要访问窗口内的所有元素来执行一些更复杂的计算，例如计算窗口内的中值或出现频率最高的值。</p><h3 id="ProcessWindowFunction-接口"><a href="#ProcessWindowFunction-接口" class="headerlink" title="ProcessWindowFunction 接口"></a>ProcessWindowFunction 接口</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><span class="hljs-keyword">package</span> org.apache.flink.streaming.api.functions.windowing;<br><span class="hljs-meta">@PublicEvolving</span><br>public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessWindowFunction&lt;IN</span>, <span class="hljs-title">OUT</span>, <span class="hljs-title">KEY</span>, <span class="hljs-title">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Window&gt;</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRichFunction</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1</span>L;<br>    public <span class="hljs-type">ProcessWindowFunction</span>() &#123;<br>    &#125;<br>    public <span class="hljs-keyword">abstract</span> void process(<span class="hljs-type">KEY</span> var1, <span class="hljs-type">ProcessWindowFunction</span>&lt;<span class="hljs-type">IN</span>, <span class="hljs-type">OUT</span>, <span class="hljs-type">KEY</span>, <span class="hljs-type">W</span>&gt;.<span class="hljs-type">Context</span> var2, <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">IN</span>&gt; var3, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">OUT</span>&gt; var4) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span>;<br>  <span class="hljs-comment">// 在窗口清除时删除自定义的单个窗口状态</span><br>    public void clear(<span class="hljs-type">ProcessWindowFunction</span>&lt;<span class="hljs-type">IN</span>, <span class="hljs-type">OUT</span>, <span class="hljs-type">KEY</span>, <span class="hljs-type">W</span>&gt;.<span class="hljs-type">Context</span> context) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;<br>    &#125;<br>  <span class="hljs-comment">// 保存窗口元数据的上下文</span><br>    public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Context</span> <span class="hljs-title">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>        public <span class="hljs-type">Context</span>() &#123;<br>        &#125;<br><span class="hljs-comment">// 返回窗口的元数据</span><br>        public <span class="hljs-keyword">abstract</span> <span class="hljs-type">W</span> window();<br><span class="hljs-comment">// 返回当前处理时间</span><br>        public <span class="hljs-keyword">abstract</span> long currentProcessingTime();<br><span class="hljs-comment">// 返回当前事件时间水位线</span><br>        public <span class="hljs-keyword">abstract</span> long currentWatermark();<br><span class="hljs-comment">// 返回单个窗口状态的访问器</span><br>        public <span class="hljs-keyword">abstract</span> <span class="hljs-type">KeyedStateStore</span> windowState();<br><span class="hljs-comment">// 用于每个键值全局状态的访问器</span><br>        public <span class="hljs-keyword">abstract</span> <span class="hljs-type">KeyedStateStore</span> globalState();<br><span class="hljs-comment">// 向OutputTag标识的副输出发送记录</span><br>        public <span class="hljs-keyword">abstract</span> &lt;<span class="hljs-type">X</span>&gt; void output(<span class="hljs-type">OutputTag</span>&lt;<span class="hljs-type">X</span>&gt; var1, <span class="hljs-type">X</span> var2);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="process-方法在被调用时的传入数据："><a href="#process-方法在被调用时的传入数据：" class="headerlink" title="process()方法在被调用时的传入数据："></a>process()方法在被调用时的传入数据：</h4><ol><li><p>窗口的键值</p></li><li><p>一个用于访问窗口内元素的 Iterator</p><p>相当于窗口内的所有元素放在一个 Iterator 里面</p></li><li><p>一个用于发出结果的 Collector</p></li><li><p>一个 Context 参数</p><p>Context 对象作用（就是上面的 Context 类）</p><ol><li>返回窗口的元数据</li><li>返回当前处理时间</li><li>返回当前事件时间水位线</li><li>返回单个窗口状态的访问器</li><li>用于每个键值全局状态的访问器</li><li>向 OutputTag 标识的副输出发送记录</li></ol></li></ol><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala._<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala.function.<span class="hljs-type">ProcessWindowFunction</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="hljs-type">DataStream</span>, <span class="hljs-type">StreamExecutionEnvironment</span>&#125;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.time.<span class="hljs-type">Time</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.windows.<span class="hljs-type">TimeWindow</span><br><span class="hljs-keyword">import</span> org.apache.flink.util.<span class="hljs-type">Collector</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MinMaxTemp</span>(<span class="hljs-params">id:<span class="hljs-type">String</span>, min:<span class="hljs-type">Double</span>, max:<span class="hljs-type">Double</span>, endTs:<span class="hljs-type">Long</span></span>)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该ProcessWindowFunction用于计算每个</span><br><span class="hljs-comment"> * 窗口内的最低和最高温度读数，</span><br><span class="hljs-comment"> * 它会将读数连同窗口结束时间戳一起发起。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HighAndLowTempProcessFunction</span></span><br><span class="hljs-keyword">extends</span> <span class="hljs-type">ProcessWindowFunction</span>[<span class="hljs-type">SensorReading</span>, <span class="hljs-type">MinMaxTemp</span> , <span class="hljs-type">String</span>, <span class="hljs-type">TimeWindow</span>]&#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span></span>(key: <span class="hljs-type">String</span>,<br>                       ctx: <span class="hljs-type">Context</span>,<br>                       vals: <span class="hljs-type">Iterable</span>[<span class="hljs-type">SensorReading</span>],<br>                       out: <span class="hljs-type">Collector</span>[<span class="hljs-type">MinMaxTemp</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">// 通过map将Iterator里面的所有数据转换成Double</span><br>    <span class="hljs-keyword">val</span> temps: <span class="hljs-type">Iterable</span>[<span class="hljs-type">Double</span>] = vals.map(_.temperature)<br>    <span class="hljs-comment">// 通过上下文的window得到window的结束位置</span><br>    <span class="hljs-keyword">val</span> windowEnd: <span class="hljs-type">Long</span> = ctx.window.getEnd<br>    out.collect(<span class="hljs-type">MinMaxTemp</span>(key, temps.min, temps.max, windowEnd))<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">WindowFunctions</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br><br>    <span class="hljs-comment">// set up the streaming execution environment</span><br>    <span class="hljs-keyword">val</span> env = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br>    <span class="hljs-comment">// checkpoint every 10 seconds</span><br>    env.getCheckpointConfig.setCheckpointInterval(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>)<br><br>    <span class="hljs-keyword">val</span> sensorData: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] = &#123;<br>      env.fromElements(<span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor1&quot;</span>, <span class="hljs-number">100</span>, <span class="hljs-number">20</span>), <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor2&quot;</span>, <span class="hljs-number">101</span>, <span class="hljs-number">21</span>))<br>    &#125;<br>    <span class="hljs-comment">// output the lowest and highest temperature reading every 5 seconds</span><br>    <span class="hljs-keyword">val</span> minMaxTempPerWindow: <span class="hljs-type">DataStream</span>[<span class="hljs-type">MinMaxTemp</span>] = sensorData<br>      .keyBy(_.id)<br>      .timeWindow(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">5</span>))<br>      .process(<span class="hljs-keyword">new</span> <span class="hljs-type">HighAndLowTempProcessFunction</span>)<br><br>    <span class="hljs-comment">// print result stream</span><br>    minMaxTempPerWindow.print()<br><br>    env.execute()<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="增量聚合与-ProcessWindowFunction"><a href="#增量聚合与-ProcessWindowFunction" class="headerlink" title="增量聚合与 ProcessWindowFunction"></a>增量聚合与 ProcessWindowFunction</h2><p>ProcessWindowFunction 是一个功能十分强大的窗口函数。</p><p>如果在增量聚合表示逻辑之后还需要访问窗口元数据，则可以用 ReduceFunction 或 Aggregate 与功能更强的 ProcessWindowFunction 组合使用。即可以对分配给窗口的元素立即执行聚合，随后当窗口触发器触发时，再将聚合后的结果传给 ProcessWindowFunction。</p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>原始的 process()方法中的 Iterable 参数内有窗口的所有值。而增量聚合之后的 Iterable 参数内将只有一个值，也就是增量聚合的结果值。</p><h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssignWindowEndProcessFunction</span></span><br>  <span class="hljs-keyword">extends</span> <span class="hljs-type">ProcessWindowFunction</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Double</span>), <span class="hljs-type">MinMaxTemp</span>, <span class="hljs-type">String</span>, <span class="hljs-type">TimeWindow</span>] &#123;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span></span>(<br>                        key: <span class="hljs-type">String</span>,<br>                        ctx: <span class="hljs-type">Context</span>,<br>                        minMaxIt: <span class="hljs-type">Iterable</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Double</span>)],<br>                        out: <span class="hljs-type">Collector</span>[<span class="hljs-type">MinMaxTemp</span>]): <span class="hljs-type">Unit</span> = &#123;<br><br>    <span class="hljs-keyword">val</span> minMax = minMaxIt.head<br>    <span class="hljs-keyword">val</span> windowEnd = ctx.window.getEnd<br>    out.collect(<span class="hljs-type">MinMaxTemp</span>(key, minMax._2, minMax._3, windowEnd))<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>增量聚合之后的 process()</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> minMaxTempPerWindow2: <span class="hljs-type">DataStream</span>[<span class="hljs-type">MinMaxTemp</span>] = sensorData<br>  .map(r =&gt; (r.id, r.temperature, r.temperature))<br>  .keyBy(_._1)<br>  .timeWindow(<span class="hljs-type">Time</span>.seconds(<span class="hljs-number">5</span>))<br>  .reduce(<br>    <span class="hljs-comment">// incrementally compute min and max temperature</span><br>    (r1: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Double</span>), r2: (<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Double</span>)) =&gt; &#123;<br>      (r1._1, r1._2.min(r2._2), r1._3.max(r2._3))<br>    &#125;,<br>    <span class="hljs-comment">// finalize result in ProcessWindowFunction</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-type">AssignWindowEndProcessFunction</span>()<br>  )<br></code></pre></td></tr></table></figure><p>可以看到，就是在 reduce 方法之后用到了 ProcessWindowFunction。</p><h2 id="自定义窗口算子"><a href="#自定义窗口算子" class="headerlink" title="自定义窗口算子"></a>自定义窗口算子</h2><h3 id="元素进入窗口算子之后的执行流程"><a href="#元素进入窗口算子之后的执行流程" class="headerlink" title="元素进入窗口算子之后的执行流程"></a>元素进入窗口算子之后的执行流程</h3><ol><li>当一个元素进入窗口算子时会被移交给 WindowAssigner.该分配器决定了元素应该被放入哪（几）个窗口中。如果目标窗口不存在，则会创建它。</li><li>如果为窗口算子配置的是增量聚合函数（如 ReduceFunction 或 AggregateFunction),那么新加入的元素会立即执行聚合，其结果会作为窗口内容存储。如果窗口算子没有配置增量聚合函数，那么新加入的元素会附加到一个用于存储所有窗口分配元素的 ListState 上。</li><li>每个元素在加入窗口后还会被传递至该窗口的触发器。触发器定义了窗口何时准备好执行计算（触发），何时需要清除自身及保存的内容。触发器可以根据已分配的元素或注册的计时器（类似处理函数）来决定在某些特定时刻执行计算或清除窗口中的内容。触发器成功触发后的行为取决于窗口算子所配置的函数。如果算子只是配置一个增量聚合函数，就会发出当前聚合结果。</li></ol><h3 id="窗口分配器（WindowAssigner）"><a href="#窗口分配器（WindowAssigner）" class="headerlink" title="窗口分配器（WindowAssigner）"></a>窗口分配器（WindowAssigner）</h3><p>WindowAssigner 用于决定将到来的元素分配给哪些窗口。每个元素可以被加到零个、一个或者多个窗口中。</p><h4 id="WindowAssigner-接口"><a href="#WindowAssigner-接口" class="headerlink" title="WindowAssigner 接口"></a>WindowAssigner 接口</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">package</span> org.apache.flink.streaming.api.windowing.assigners;<br><br><span class="hljs-keyword">import</span> java.io.<span class="hljs-type">Serializable</span>;<br><span class="hljs-keyword">import</span> java.util.<span class="hljs-type">Collection</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.annotation.<span class="hljs-type">PublicEvolving</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.<span class="hljs-type">ExecutionConfig</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.typeutils.<span class="hljs-type">TypeSerializer</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.<span class="hljs-type">StreamExecutionEnvironment</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.triggers.<span class="hljs-type">Trigger</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.windows.<span class="hljs-type">Window</span>;<br><br><span class="hljs-meta">@PublicEvolving</span><br>public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowAssigner&lt;T</span>, <span class="hljs-title">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Window&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1</span>L;<br><br>    public <span class="hljs-type">WindowAssigner</span>() &#123;<br>    &#125;<br><span class="hljs-comment">// 返回元素分配的目标窗口集合</span><br>    public <span class="hljs-keyword">abstract</span> <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">W</span>&gt; assignWindows(<span class="hljs-type">T</span> var1, long var2, <span class="hljs-type">WindowAssigner</span>.<span class="hljs-type">WindowAssignerContext</span> var4);<br><span class="hljs-comment">// 返回WindowAssigner的默认触发器</span><br>    public <span class="hljs-keyword">abstract</span> <span class="hljs-type">Trigger</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">W</span>&gt; getDefaultTrigger(<span class="hljs-type">StreamExecutionEnvironment</span> var1);<br><span class="hljs-comment">// 返回WIndowAssigner中窗口的TypeSerializer</span><br>    public <span class="hljs-keyword">abstract</span> <span class="hljs-type">TypeSerializer</span>&lt;<span class="hljs-type">W</span>&gt; getWindowSerializer(<span class="hljs-type">ExecutionConfig</span> var1);<br><span class="hljs-comment">// 表明此分配器是否创建基于事件时间的窗口</span><br>    public <span class="hljs-keyword">abstract</span> boolean isEventTime();<br><span class="hljs-comment">// 用于访问当前处理时间的上下文</span><br>    public <span class="hljs-keyword">abstract</span> static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowAssignerContext</span> </span>&#123;<br>        public <span class="hljs-type">WindowAssignerContext</span>() &#123;<br>        &#125;<br><span class="hljs-comment">// 返回当前处理时间</span><br>        public <span class="hljs-keyword">abstract</span> long getCurrentProcessingTime();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h5><p>用于滚动事件时间窗口的窗口分配器</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-keyword">import</span> java.util<br><span class="hljs-keyword">import</span> java.util.<span class="hljs-type">Collections</span><br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.<span class="hljs-type">ExecutionConfig</span><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.typeutils.<span class="hljs-type">TypeSerializer</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.environment.<span class="hljs-type">StreamExecutionEnvironment</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.<span class="hljs-type">WindowAssigner</span><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.triggers.&#123;<span class="hljs-type">EventTimeTrigger</span>, <span class="hljs-type">Trigger</span>&#125;<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.windowing.windows.<span class="hljs-type">TimeWindow</span><br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">DIY_WindowFunction</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br><br>  &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWindowAssigner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WindowAssigner</span>[<span class="hljs-type">Object</span>, <span class="hljs-type">TimeWindow</span>] </span>&#123;<br><br>  <span class="hljs-keyword">val</span> windowSize: <span class="hljs-type">Long</span> = <span class="hljs-number">30</span> * <span class="hljs-number">1000</span>L<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">assignWindows</span></span>(<br>                              o: <span class="hljs-type">Object</span>,<br>                              ts: <span class="hljs-type">Long</span>,<br>                              ctx: <span class="hljs-type">WindowAssigner</span>.<span class="hljs-type">WindowAssignerContext</span>): java.util.<span class="hljs-type">List</span>[<span class="hljs-type">TimeWindow</span>] =<br>    &#123;<br>      <span class="hljs-comment">// 30s取余</span><br>      <span class="hljs-keyword">val</span> startTime: <span class="hljs-type">Long</span> = ts - (ts % windowSize)<br>      <span class="hljs-keyword">val</span> endTime: <span class="hljs-type">Long</span> = startTime + windowSize<br>      <span class="hljs-comment">// 发出相应的时间窗口</span><br>      <span class="hljs-type">Collections</span>.singletonList(<span class="hljs-keyword">new</span> <span class="hljs-type">TimeWindow</span>(startTime, endTime))<br>    &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getDefaultTrigger</span></span>(<br>                                  env: <span class="hljs-type">StreamExecutionEnvironment</span>): <span class="hljs-type">Trigger</span>[<span class="hljs-type">Object</span>, <span class="hljs-type">TimeWindow</span>] = &#123;<br>    <span class="hljs-type">EventTimeTrigger</span>.create()<br>  &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getWindowSerializer</span></span>(<br>                                    executionConfig: <span class="hljs-type">ExecutionConfig</span>):<br>  <span class="hljs-type">TypeSerializer</span>[<span class="hljs-type">TimeWindow</span>] = &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-type">TimeWindow</span>.<span class="hljs-type">Serializer</span><br>  &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">isEventTime</span></span>: <span class="hljs-type">Boolean</span> = <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="触发器（Trigger）"><a href="#触发器（Trigger）" class="headerlink" title="触发器（Trigger）"></a>触发器（Trigger）</h3><p>触发器用来定义何时对窗口进行计算并发出结果。它的触发条件可以是时间，也可以是某些特定的数据条件。</p><p>触发器不仅能够访问时间属性和计时器，还可以使用状态，因此它在某种意义上等价于处理函数。</p><p>每次调用触发器都会生成一个 TriggerResult，它用于决定窗口接下来的行为。</p><p>TriggerResult 可以是以下值之一：</p><ol><li><p>CONTINUE</p><p>什么都不做</p></li><li><p>FIRE</p><p>如果窗口算子配备了 ProcessWindowFunction 则会调用该函数并发出结果。如果只有一个增量函数，那么直接发出聚合结果，窗口状态不会有任何变化。</p></li><li><p>PURGE</p><p>完全清除窗口内容</p></li><li><p>FIRE_AND_PURGE</p><p>先进行窗口的计算（FIRE），随后删除所有状态及元数据（PURGE）。</p></li></ol><h3 id="移除器（Evictor）"><a href="#移除器（Evictor）" class="headerlink" title="移除器（Evictor）"></a>移除器（Evictor）</h3><p>Evictor 是 Flink 窗口机制中的一个可选组件，可用于在窗口执行计算前或后从窗口删除元素。</p><p>移除器常用语 GlobalWindow，它支持清理部分窗口内容而不必完全清除整个窗口状态。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>5.DataStream API（1.7版本）</title>
    <link href="/2022/12/511b0eecaaf6.html"/>
    <url>/2022/12/511b0eecaaf6.html</url>
    
    <content type="html"><![CDATA[<h1 id="构建一个典型的-Flink-流式应用的步骤"><a href="#构建一个典型的-Flink-流式应用的步骤" class="headerlink" title="构建一个典型的 Flink 流式应用的步骤"></a>构建一个典型的 Flink 流式应用的步骤</h1><ol><li>设置执行环境</li><li>从数据源读取一条或多条流</li><li>通过一系列流式转换来实现应用逻辑</li><li>选择性地将结果输出到一个或多个数据汇中</li><li>执行程序</li></ol><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210223201933.png"></p><p>这是一个 flink 程序的基本流程。</p><h1 id="一、-Environment"><a href="#一、-Environment" class="headerlink" title="一、 Environment"></a>一、 Environment</h1><ol><li><p>getExecutionEnvironment</p><p>创建一个执行环境，表示当前执行程序的上下文。</p><p>如果程序是<strong>独立调用</strong>的，则此方法返回本地执行环境；</p><p>如果从<strong>命令行客户端调用程序以提交到集群</strong>，则此方法返回此集群的执行环境</p><p>也就是说: getExecutionEnvironment 会根据查询运行的方式决定返回什么样的运行环境，是最常用的一种创建执行环境的方式。</p></li><li><p>createLocalEnvironment</p><p>返回集群执行环境， 将 Jar 提交到远程服务器。 需要在调用时指定 JobManager 的 IP 和端口号， 并指定要在集群中运行的 Jar 包。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">val</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.createLocalEnvironment(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure></li><li><p>createRemoteEnvironment</p><p>返回集群执行环境， 将 Jar 提交到远程服务器。 需要在调用时指定 JobManager 的 IP 和端口号， 并指定要在集群中运行的 Jar 包。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> env = <span class="hljs-type">ExecutionEnvironment</span>.createRemoteEnvironment(<span class="hljs-string">&quot;jobmanage-hostname&quot;</span>, <span class="hljs-number">6123</span>,<span class="hljs-string">&quot;YOURPATH//wordcount.jar&quot;</span>)<br></code></pre></td></tr></table></figure></li></ol><h1 id="二、Source"><a href="#二、Source" class="headerlink" title="二、Source"></a>二、Source</h1><h3 id="读取数据的方式"><a href="#读取数据的方式" class="headerlink" title="读取数据的方式"></a>读取数据的方式</h3><p>共有四种</p><ol><li>从集合中读取数据</li><li>从文本文件中读取数据</li><li>从消息队列（kafka）中读取数据</li><li>自定义 Source</li></ol><h3 id="1-从集合中读取数据"><a href="#1-从集合中读取数据" class="headerlink" title="1. 从集合中读取数据"></a>1. 从集合中读取数据</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> dataList = <span class="hljs-type">List</span>(<br>    <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor_1&quot;</span>, <span class="hljs-number">1547718199</span>, <span class="hljs-number">35.8</span>),<br>    <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor_6&quot;</span>, <span class="hljs-number">1547718201</span>, <span class="hljs-number">15.4</span>),<br>    <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor_7&quot;</span>, <span class="hljs-number">1547718202</span>, <span class="hljs-number">6.7</span>),<br>    <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;sensor_10&quot;</span>, <span class="hljs-number">1547718205</span>, <span class="hljs-number">38.1</span>)<br>)<br><span class="hljs-keyword">val</span> stream1 = env.fromCollection(dataList)<br>stream1.print()<br></code></pre></td></tr></table></figure><h3 id="2-从文本文件中读取数据"><a href="#2-从文本文件中读取数据" class="headerlink" title="2. 从文本文件中读取数据"></a>2. 从文本文件中读取数据</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> inputPath = <span class="hljs-string">&quot;/Users/heyizhi/Nutstore Files/我的坚果云/程序员/学习/大数据/10 flink/1st flink project/flinkTutorial/src/main/resources/sensor.txt&quot;</span><br><span class="hljs-keyword">val</span> stream2 = env.readTextFile(inputPath)<br>stream2.print()<br></code></pre></td></tr></table></figure><h3 id="3-从-Kafka-中读取数据"><a href="#3-从-Kafka-中读取数据" class="headerlink" title="3. 从 Kafka 中读取数据"></a>3. 从 Kafka 中读取数据</h3><p>① 启动 kafka</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210223233317.png"></p><p>② 创建 topic</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210223233439.png"></p><p>③ 读取数据</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> properties = <span class="hljs-keyword">new</span> <span class="hljs-type">Properties</span>()<br>properties.setProperty(<span class="hljs-string">&quot;bootstrap.servers&quot;</span>, <span class="hljs-string">&quot;localhost:9092&quot;</span>)<br>properties.setProperty(<span class="hljs-string">&quot;group.id&quot;</span>, <span class="hljs-string">&quot;consumer-group&quot;</span>)<br><span class="hljs-keyword">val</span> stream3 = env.addSource(<span class="hljs-keyword">new</span> <span class="hljs-type">FlinkKafkaConsumer011</span>[<span class="hljs-type">String</span>](<span class="hljs-string">&quot;sensor&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleStringSchema</span>(), properties))<br>stream3.print()<br></code></pre></td></tr></table></figure><h3 id="4-自定义-Source"><a href="#4-自定义-Source" class="headerlink" title="4. 自定义 Source"></a>4. 自定义 Source</h3><p>需要自定义 SourceFunction[SensorReading]</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224103647.png"></p><p>Source 类</p><p>需要继承 SourceFunction</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224103931.png"></p><h1 id="三、-Transform"><a href="#三、-Transform" class="headerlink" title="三、 Transform"></a>三、 Transform</h1><p>流式转换以一个或多个数据流为输入，并将它们转换成一个或多个输出流。</p><h2 id="DataStream-API-程序的本质"><a href="#DataStream-API-程序的本质" class="headerlink" title="DataStream API 程序的本质"></a>DataStream API 程序的本质</h2><p>通过组合不同的转换来创建一个满足应用逻辑的 Dataflow 图。</p><h2 id="DataStream-API-算子种类"><a href="#DataStream-API-算子种类" class="headerlink" title="DataStream API 算子种类"></a>DataStream API 算子种类</h2><p>这里的算子主要分为四类</p><ol><li>作用于单个事件的基本转换（例如 map）</li><li>针对相同键值事件的 KeyedStream 转换</li><li>将多条数据流合并为一条或将一条数据流拆分成多条流的转换</li><li>对流中的事件进行重新组织的分发转换</li></ol><h2 id="简单转换算子"><a href="#简单转换算子" class="headerlink" title="简单转换算子"></a>简单转换算子</h2><p>map、flatMap 和 Filter 称为简单转换算子</p><h3 id="1-map"><a href="#1-map" class="headerlink" title="1. map"></a>1. map</h3><p>一对一转换</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224160034.png" style="zoom:33%;" /><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> streamMap = stream.map&#123;x =&gt; x * <span class="hljs-number">2</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-flatMap"><a href="#2-flatMap" class="headerlink" title="2. flatMap"></a>2. flatMap</h3><p>相当于是把集合类型的元素打散，从一个集合（例如二元数组）转换后再将结果拼接成一个打散的集合（例如一元数组）</p><p>flatMap 的<strong>函数签名</strong>：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flatMap</span></span>[<span class="hljs-type">A</span>,<span class="hljs-type">B</span>](as: <span class="hljs-type">List</span>[<span class="hljs-type">A</span>])(f: <span class="hljs-type">A</span> = <span class="hljs-type">List</span>[<span class="hljs-type">B</span>]):<span class="hljs-type">List</span>[<span class="hljs-type">B</span>]<br></code></pre></td></tr></table></figure><p>例如:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">flatMap(<span class="hljs-type">List</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>))(i ⇒ <span class="hljs-type">List</span>(i,i))<br></code></pre></td></tr></table></figure><p>结果是 <code>List(1,1,2,2,3,3)</code>,</p><p>而</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-type">List</span>(<span class="hljs-string">&quot; a b&quot;</span> , <span class="hljs-string">&quot;c d&quot;</span> ).flatMap(line ⇒ line.split(<span class="hljs-string">&quot; &quot;</span>))<br></code></pre></td></tr></table></figure><p>结果是 <code>List(a, b, c, d)</code>。</p><h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> streamFlatMap = stream.flatMap&#123;<br>  x =&gt; x.split(<span class="hljs-string">&quot; &quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-Filter"><a href="#3-Filter" class="headerlink" title="3. Filter"></a>3. Filter</h3><p>过滤，对每个元素进行判断</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224161505.png" style="zoom:33%;" /><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> streamFilter = stream.filter&#123;<br>  x =&gt; x == <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="键控流转换算子（基于-KeyedStream-的转换）"><a href="#键控流转换算子（基于-KeyedStream-的转换）" class="headerlink" title="键控流转换算子（基于 KeyedStream 的转换）"></a>键控流转换算子（基于 KeyedStream 的转换）</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224161649.png" style="zoom:33%;" /><p>DataStream $\rightarrow$ KeyedStream，逻辑地将一个流拆分成不想交的分区，每个分区包含具有相同 key 的元素，在内部以 hash 的形式实现。</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>在这里 KeyedStream 继承了 DataStream，所以其本质上还是一个 DataStream。</p><h3 id="滚动聚合算子"><a href="#滚动聚合算子" class="headerlink" title="滚动聚合算子"></a>滚动聚合算子</h3><p>这些算子可以针对 KeyedStream 的每一个支流做聚合</p><ul><li><p><code>sum()</code></p><p>滚动计算输入流中指定字段的和</p></li><li><p><code>min()</code></p><p>滚动计算输入流中指定字段的最小值</p></li><li><p><code>max()</code></p><p>滚动计算输入流中指定字段的最大值</p></li><li><p><code>minBy()</code></p><p>滚动计算输入流中迄今为止最小值，返回该值所在事件</p></li><li><p><code>maxBy()</code></p><p>滚动计算输入流中迄今为止最大值，返回该值所在事件</p></li></ul><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>无法将多个滚动聚合方法组合使用，每次只能计算一个</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>传感器示例中以 id 分区，求当前温度最小值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">TransformTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br><br>    <span class="hljs-comment">// 读取数据</span><br>    <span class="hljs-keyword">val</span> inputPath = <span class="hljs-string">&quot;/Users/heyizhi/Nutstore Files/我的坚果云/程序员/学习/大数据/10 flink/1st flink project/flinkTutorial/src/main/resources/sensor.txt&quot;</span><br>    <span class="hljs-keyword">val</span> inputStream = env.readTextFile(inputPath)<br><br>    <span class="hljs-comment">// 转换成样例类</span><br>    <span class="hljs-keyword">val</span> dataStream = inputStream<br>      .map(data =&gt; &#123;<br>        <span class="hljs-keyword">val</span> arr = data.split(<span class="hljs-string">&quot;,&quot;</span>)<br>        <span class="hljs-type">SensorReading</span>(arr(<span class="hljs-number">0</span>), arr(<span class="hljs-number">1</span>).toLong, arr(<span class="hljs-number">2</span>).toDouble)<br>      &#125;)<br><br>    <span class="hljs-comment">// 分组聚合，输出每个传感器当前温度最小值</span><br>    <span class="hljs-keyword">val</span> aggStream = dataStream<br>      .keyBy(<span class="hljs-number">0</span>)<br>      .min(<span class="hljs-string">&quot;temperature&quot;</span>)<br>    aggStream.print()<br><br>    env.execute(<span class="hljs-string">&quot;transform test&quot;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h3><p><code>reduce</code> 转换是滚动聚合转换的<strong>泛化</strong>。</p><p>它将 <code>ReduceFunction</code> 应用在一个 <code>KeyedStream</code> 上，每个到来时间都会和 <code>reduce</code> 结果进行一次组合，从而产生一个新的<code>DataStream</code>。<code>reduce</code> 转换不会改变数据类型，因此输出流的类型会永远和输入流保持一致。</p><h4 id="reduce-方法源码"><a href="#reduce-方法源码" class="headerlink" title="reduce 方法源码"></a>reduce 方法源码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-meta">@Public</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ReduceFunction</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span>, Serializable &#123;<br>    T <span class="hljs-title function_">reduce</span><span class="hljs-params">(T var1, T var2)</span> <span class="hljs-keyword">throws</span> Exception;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，这里的 <code>reduce</code> 方法的输入参数是 两个 <code>T</code> 类型的变量，最终输出也是一个 <code>T</code> 类型的变量，然后这个输出的变量会和下一个参数继续进行 <code>reduce</code> 操作，直到最后执行完成，输出最后一次 <code>reduce</code> 的结果。</p><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><ol><li>传感器示例中以 id 分区，求当前温度最小值，要求时间戳为当前时间戳</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 需要输出当前最小的温度值，以及最近的时间戳，要用reduce</span><br><span class="hljs-keyword">val</span> resultStream = dataStream<br>  .keyBy(<span class="hljs-string">&quot;id&quot;</span>)<br>  .reduce((curState, newData) =&gt;<br>    <span class="hljs-type">SensorReading</span>(curState.id, newData.timestamp, curState.temperature.min(newData.temperature))<br>  )<br></code></pre></td></tr></table></figure><ol start="2"><li>获取每个用户的访问频次</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">DataStreamSource&lt;Event&gt; stream = env.fromElements(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Mary&quot;</span>, <span class="hljs-string">&quot;./home&quot;</span>, <span class="hljs-number">1000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./cart&quot;</span>, <span class="hljs-number">2000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;./prod?id=100&quot;</span>, <span class="hljs-number">3000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./prod?id=1&quot;</span>, <span class="hljs-number">3300L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;./prod?id=200&quot;</span>, <span class="hljs-number">3200L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./home&quot;</span>, <span class="hljs-number">3500L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./prod?id=2&quot;</span>, <span class="hljs-number">3800L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./prod?id=3&quot;</span>, <span class="hljs-number">4200L</span>)<br>);<br><br><span class="hljs-comment">// 1.统计每个用户的访问频次</span><br>SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; clickByUser = stream<br>        <span class="hljs-comment">// 首先使用map方法将stream中的event挨个转换成Tuple2&lt;String, Long&gt;的形式,其中第一个元素是user，第二个元素固定是1L</span><br>        .map((MapFunction&lt;Event, Tuple2&lt;String, Long&gt;&gt;) event -&gt; Tuple2.of(event.user, <span class="hljs-number">1L</span>))<br>        <span class="hljs-comment">// 然后将Tuple2&lt;String, Long&gt;类型的所有data根据其f0元素（也就是Tuple2的第一个元素event.user）分组，获得一个KeyedStream</span><br>        .keyBy(data -&gt; data.f0)<br>        <span class="hljs-comment">// 最后将keyStream进行reduce操作，对每两个元素(Tuple2&lt;String, Long&gt;类型)执行函数，最终获得Tuple2类型的一个结果,第一个元素是user，第二个元素是1L之和，其实就是有多少个点击次数</span><br>        .reduce((ReduceFunction&lt;Tuple2&lt;String, Long&gt;&gt;) (value1, value2) -&gt; Tuple2.of(value1.f0, value1.f1 + value2.f1)<br>        );<br><br><span class="hljs-comment">// 2. 获取当前最活跃的用户</span><br>SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; result = clickByUser<br>        <span class="hljs-comment">// 首先根据对应的key（也就是用户）进行分组</span><br>        .keyBy(data -&gt; <span class="hljs-string">&quot;key&quot;</span>)<br>        <span class="hljs-comment">// 然后比较每个值的f1，也就是点击量之和，最终输出最大值</span><br>        .reduce((ReduceFunction&lt;Tuple2&lt;String, Long&gt;&gt;) (value1, value2) -&gt; value1.f1 &gt; value2.f1 ? value1 : value2);<br><br></code></pre></td></tr></table></figure><h3 id="用户自定义函数（UDF）"><a href="#用户自定义函数（UDF）" class="headerlink" title="用户自定义函数（UDF）"></a>用户自定义函数（UDF）</h3><h4 id="函数类"><a href="#函数类" class="headerlink" title="函数类"></a>函数类</h4><h5 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h5><p>Flink 中所有用户自定义函数(如 MapFunction, FilterFunction 及 ProcessFunction)的接口都是以接口或抽象类的形式对外暴露。</p><p>我们可以通过实现接口或继承抽象类的方式实现函数。下面的例子实现了一个 FilterFunction,用来过滤出所有包含“flink”― 词的字符串。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlinkFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FilterFunction</span>&lt;Event&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">filter</span><span class="hljs-params">(Event value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> value.url.contains(<span class="hljs-string">&quot;home&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后可以直接将函数类的实例作为参数传递给 filter 转换：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. 传入实现FilterFunction接口的自定义函数类</span><br>DataStream&lt;Event&gt; stream1 = clicks.filter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FlinkFilter</span>());<br></code></pre></td></tr></table></figure><p>还可以通过匿名类来实现函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 2. 传入匿名类</span><br>DataStream&lt;Event&gt; stream3 = clicks.filter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterFunction</span>&lt;Event&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">filter</span><span class="hljs-params">(Event value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> value.url.contains(<span class="hljs-string">&quot;home&quot;</span>);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>可以看到，传入了一个匿名类，内部实现了 filter 方法。</p><h5 id="scala-实现"><a href="#scala-实现" class="headerlink" title="scala 实现"></a>scala 实现</h5><p>Flink 暴露了所有 udf 函数的接口（实现方式为接口或者抽象类）。例如 MapFunction，FilterFunction 和 ProcessFunction 等。</p><p>几乎所有的算子都有对应的 udf 函数类，也就是可以定制。</p><p>例如定义一个 filter，如下如梭</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 自定义一个函数类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FilterFunction</span>[<span class="hljs-type">SensorReading</span>] </span>&#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter</span></span>(t: <span class="hljs-type">SensorReading</span>): <span class="hljs-type">Boolean</span> =<br>    t.id.startsWith(<span class="hljs-string">&quot;sensor1&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>在继承一个 FilterFunction 之后继承了 filter 方法，然后可以直接使用。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> <span class="hljs-type">MyFilterStream</span> = stream.filter(<span class="hljs-keyword">new</span> <span class="hljs-type">MyFilter</span>)<br></code></pre></td></tr></table></figure><p>注意，这里我们定义的 Filter 和原来的流的类型一定要相同。</p><p>也可以通过匿名类来实现函数</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> <span class="hljs-type">MyFilterStream2</span> = stream.filter(<br><span class="hljs-keyword">new</span> <span class="hljs-type">RichFilterFunction</span>[<span class="hljs-type">String</span>]&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter</span></span>(value: <span class="hljs-type">String</span>): <span class="hljs-type">Boolean</span> = &#123;<br>      value.contains(<span class="hljs-string">&quot;flink&quot;</span>)<br>    &#125;<br>  &#125;<br>)<br></code></pre></td></tr></table></figure><p>此外，函数可以通过其构造函数接收参数。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> tweets: <span class="hljs-type">DataStream</span>[<span class="hljs-type">String</span>] = ???<br><span class="hljs-keyword">val</span> flinkTweets = tweets.filter(<span class="hljs-keyword">new</span> <span class="hljs-type">KeywordFilter</span>(<span class="hljs-string">&quot;flink&quot;</span>))<br><br><span class="hljs-comment">// 自定义一个函数类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span>(<span class="hljs-params">keyWord: <span class="hljs-type">String</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">FilterFunction</span>[<span class="hljs-type">SensorReading</span>] </span>&#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter</span></span>(t: <span class="hljs-type">SensorReading</span>): <span class="hljs-type">Boolean</span> =<br>    t.id.contains(keyWord)<br>&#125;<br></code></pre></td></tr></table></figure><p>在例子中，我们通过构造函数传入了“flink”参数，可以作为参数使用</p><h4 id="Lambda-函数"><a href="#Lambda-函数" class="headerlink" title="Lambda 函数"></a>Lambda 函数</h4><h5 id="scala-实现-1"><a href="#scala-实现-1" class="headerlink" title="scala 实现"></a>scala 实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 3. 传入Lambda表达式</span><br>SingleOutputStreamOperator&lt;Event&gt; stream4 = clicks.filter(data -&gt; data.url.contains(<span class="hljs-string">&quot;home&quot;</span>));<br></code></pre></td></tr></table></figure><h5 id="java-实现"><a href="#java-实现" class="headerlink" title="java 实现"></a>java 实现</h5><h4 id="富函数"><a href="#富函数" class="headerlink" title="富函数"></a>富函数</h4><p>很多时候，我们需要在函数处理第一条记录之前进行一些初始化工作或是取得函数执行相关的上下文信息。Datastream API 提供了一类富函数，它和我们之前见到的普通函数相比可对外提供更多功能。</p><p>DataStream API 中所有的转换函数都有对应的富函数。富函数的使用位置和普通函数以及 Lambda 函数相同。它们可以像普通函数类一样接收参数。 富函数的命名规则是以 Rich 开头，后面跟着普通转换函数的名字，例如： RichMapFunction、 RichFlatMapFunction 等。</p><p>在使用富函数时，可以对应函数的生命周期实现两个额外的方法：</p><ul><li>open()方法是富函数中的初始化方法。它在每个任务首次调用转换方法（如 filter 或 map）前调用一次。 open()通常用于那些只需进行一次的设置工作。</li><li>close()作为函数的终止方法，会在每个任务最后一次调用转换方法后调用一次。它通常用于清理和释放资源</li></ul><p>此外，可以利用 getRuntimeContext()方法访问函数的 RuntimeContext。从 RuntimeContext 中能获取到一些信息，例如函数的并行度，函数所在子任务的编号以及执行函数的任务名称。同时，它还提供访问分区状态的方法。</p><p>注意：<br>富函数不能使用 lambda 表达式，因为这里不是只有一个抽象方法。所以只能用函数类</p><h5 id="java-实现-1"><a href="#java-实现-1" class="headerlink" title="java 实现"></a>java 实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 将点击事件转换成长整型的时间戳输出</span><br>clicks.map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RichMapFunction</span>&lt;Event, Long&gt;() &#123;<br>    <span class="hljs-comment">// 这里替换了父类的open()方法，会在map方法执行前被执行一次</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">(Configuration parameters)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                <span class="hljs-built_in">super</span>.open(parameters);<br>                System.out.println(<span class="hljs-string">&quot;索引为 &quot;</span> + getRuntimeContext().getIndexOfThisSubtask() + <span class="hljs-string">&quot; 的任务开始&quot;</span>);<br>            &#125;<br><br>    <span class="hljs-comment">// 必须实现的一个方法</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">map</span><span class="hljs-params">(Event value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                <span class="hljs-keyword">return</span> value.timestamp;<br>            &#125;<br><br>    <span class="hljs-comment">// 这里替换了父类的close()方法，会在所有map方法执行后被执行一次</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                <span class="hljs-built_in">super</span>.close();<br>                System.out.println(<span class="hljs-string">&quot;索引为 &quot;</span> + getRuntimeContext().getIndexOfThisSubtask() + <span class="hljs-string">&quot; 的任务结束&quot;</span>);<br>            &#125;<br>        &#125;)<br>        .print();<br><br></code></pre></td></tr></table></figure><h5 id="scala-实现-2"><a href="#scala-实现-2" class="headerlink" title="scala 实现"></a>scala 实现</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 富函数</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRichFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RichFilterFunction</span>[<span class="hljs-type">SensorReading</span>] </span>&#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter</span></span>(t: <span class="hljs-type">SensorReading</span>): <span class="hljs-type">Boolean</span> = ???<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open</span></span>(parameters: <span class="hljs-type">Configuration</span>): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">//做一些初始化操作，比如数据库的连接</span><br>  &#125;<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close</span></span>(): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">// 一般做收尾工作，比如关闭连接，或者清空状态</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="分流操作（split-和-select）"><a href="#分流操作（split-和-select）" class="headerlink" title="分流操作（split 和 select）"></a>分流操作（split 和 select）</h2><p>split 转换是 union 转换的逆操作。它将输入流分割成两条或多条类型和输入流相同的输出流。每一个到来的事件都可以被发往零个、一个或多个输出流。<br>因此，split 也可以用来过滤或复制事件。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224181644.png" style="zoom:33%;" />上图中，split算子将所有白色事件和其他事件分开，发往不同的数据流<p>具体来说</p><h3 id="split"><a href="#split" class="headerlink" title="split"></a>split</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224191817.png" style="zoom:33%;" /><p>DataStream → SplitStream：根据某些特征把一个 DataStream 拆分成两个或者多个 DataStream。</p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224191934.png" style="zoom:33%;" /><p>split 和 select 总是一起出现，<strong>select()方法会在每个输入时间到来时被调用，并随机返回一个对象。类似 KeyBy()方法之后总是跟着一个滚动聚合算子</strong>。split 函数就会根据这个 select 方法确认应该将上游的数据分发到哪些输出流。</p><h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><p>将传感器数据通过温度分开，以 30 度为界</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 4.分流操作</span><br><span class="hljs-keyword">val</span> splitStream = dataStream<br>  .split(<br>    data =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (data.temperature &gt; <span class="hljs-number">30.0</span>) <span class="hljs-type">Seq</span>(<span class="hljs-string">&quot;high&quot;</span>) <span class="hljs-keyword">else</span> <span class="hljs-type">Seq</span>(<span class="hljs-string">&quot;low&quot;</span>)<br>    &#125;<br>  )<br><span class="hljs-keyword">val</span> highTempStream: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] = splitStream.select(<span class="hljs-string">&quot;high&quot;</span>)<br><span class="hljs-keyword">val</span> lowTempStream: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] = splitStream.select(<span class="hljs-string">&quot;low&quot;</span>)<br><span class="hljs-keyword">val</span> allTempStream: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] = splitStream.select(<span class="hljs-string">&quot;high&quot;</span>, <span class="hljs-string">&quot;low&quot;</span>)<br><br>highTempStream.print(<span class="hljs-string">&quot;high&quot;</span>)<br>lowTempStream.print(<span class="hljs-string">&quot;low&quot;</span>)<br>allTempStream.print(<span class="hljs-string">&quot;all&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="合流操作"><a href="#合流操作" class="headerlink" title="合流操作"></a>合流操作</h2><h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224223544.png" style="zoom:33%;" /><p>DataStream,DataStream → ConnectedStreams：连接两个保持他们类型的数据流， 两个数据流被 Connect 之后， 只是被放在了一个同一个流中， 内部依然保持各自的数据和形式不发生任何变化， 两个流相互独立。</p><h3 id="CoMap-CoFlatMap"><a href="#CoMap-CoFlatMap" class="headerlink" title="CoMap,CoFlatMap"></a>CoMap,CoFlatMap</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224223711.png" style="zoom:33%;" /><p>ConnectedStreams → DataStream：作用于 ConnectedStreams 上， 功能与 map 和 flatMap 一样， 对 ConnectedStreams 中的每一个 Stream 分别进行 map 和 flatMap 处理。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 4.2 合流操作</span><br><span class="hljs-keyword">val</span> warningStream = highTempStream<br>  .map(data =&gt; (data.id, data.temperature))<br><br><span class="hljs-keyword">val</span>  connectedStreams = warningStream.connect(lowTempStream)<br><br><span class="hljs-comment">// 用coMap对数据进行分别处理</span><br><span class="hljs-keyword">val</span> coMapResultStream = connectedStreams<br>  .map(<br>    warningData =&gt; (warningData._1, warningData._2, <span class="hljs-string">&quot;warning&quot;</span>),<br>    lowTempData =&gt; (lowTempData.id, <span class="hljs-string">&quot;healthy&quot;</span>)<br>  )<br><br>coMapResultStream.print(<span class="hljs-string">&quot;coMap&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h3><p>DataStream.union()方法可以合并两条或多条<strong>类型相同</strong>的 DataStream，生成一个<strong>新的类型相同</strong>的 DataStream。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224225326.png" style="zoom:33%;" /><h2 id="分发转换"><a href="#分发转换" class="headerlink" title="分发转换"></a>分发转换</h2><p>分发转换操作定义了如何将事件分配给不同任务。某些时候，我们有必要或希望能够在应用级别控制这些分区策略，或者自定义分区器。例如，如果我们知道 DataStream 的并行分区存在数据倾斜，那么可能就希望通过重新平衡数据来均匀分配后续算子的负载。</p><p>注意：<br>keyBy()和分发转换是不同的，keyBy()会生成一个 KeyedStream，是一个逻辑分区，分区后的数据并没有真正承载到不同的 slot 上，但分发转换生成的是 DataStream，是真正承载在不同 Slot 上的。</p><h3 id="随机"><a href="#随机" class="headerlink" title="随机"></a>随机</h3><p>可以利用 DataStream.shuffle()方法实现随机数据交换策略。该方法会依照均匀分布随机地将记录发往后继算子的并行任务。</p><h3 id="轮流"><a href="#轮流" class="headerlink" title="轮流"></a>轮流</h3><p>rebalance()方法会将输入流中的事件以轮流方式均匀分配给后继任务。</p><h3 id="重调"><a href="#重调" class="headerlink" title="重调"></a>重调</h3><p>rescale()也会以轮流方式对事件进行分发，但分发目标仅限于部分后继任务。</p><p>用法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">DataStreamSource&lt;Event&gt; stream = env.fromElements(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Mary&quot;</span>, <span class="hljs-string">&quot;./home&quot;</span>, <span class="hljs-number">1000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./cart&quot;</span>, <span class="hljs-number">2000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;./prod?id=100&quot;</span>, <span class="hljs-number">3000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;./prod?id=200&quot;</span>, <span class="hljs-number">3500L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./prod?id=2&quot;</span>, <span class="hljs-number">2500L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;./prod?id=300&quot;</span>, <span class="hljs-number">3600L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./home&quot;</span>, <span class="hljs-number">3000L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./prod?id=1&quot;</span>, <span class="hljs-number">2300L</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./prod?id=3&quot;</span>, <span class="hljs-number">3300L</span>));<br><br><span class="hljs-comment">// 1. 随机分区</span><br>stream.shuffle().print().setParallelism(<span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// 2. 轮询分区</span><br>stream.rebalance().print().setParallelism(<span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// 3. rescale 重缩放分区</span><br>stream.rescale().print().setParallelism(<span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure><p><strong>轮流和重调的区别</strong>：</p><p>rebalance()和 rescale()的本质不同体现在生成任务连接的方式。rebalance()会在所有发送任务和接收任务之间建立通信通道（例如 2 个上游任务和 10 个下游任务，那么这两个上游任务会分别和下游的这 10 个任务建立连接，一共会有 20 个连接生成）；</p><p>而 rescale()中每个发送任务只会和下游算子的部分任务建立通道（例如 2 个上游任务和 10 个下游任务，那么第 1 个上游任务会和前 5 个下游任务建立连接，第 2 个上游任务会和后 5 个下游任务建立连接，那么一共只有 10 个连接，若刚好这 10 个下游任务就分布在 2 个 TaskManager 上，那么第 1 个上游任务对应第 1 个 TaskManager，第 2 个上游任务对应第 2 个 TaskManager，就完全避免了网络上的开销）</p><p>当上游任务越多时，节省的资源则越明显。</p><p>因此 rescale 可以看做是在一些情况下对 rebalance 的一种优化</p><p><strong>区别演示</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 演示rebalance和rescale的区别</span><br>env.addSource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RichParallelSourceFunction</span>&lt;Integer&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(SourceContext&lt;Integer&gt; sourceContext)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>            <span class="hljs-comment">// 将偶数和基数分开，将奇偶数分别发送到0号和1号并行分区</span><br>            <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == getRuntimeContext().getIndexOfThisSubtask()) &#123;<br>                sourceContext.collect(i);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;).setParallelism(<span class="hljs-number">2</span>)<br>        .rescale()<br>        .print()<br>        .setParallelism(<span class="hljs-number">4</span>);<br><br>env.execute();<br></code></pre></td></tr></table></figure><p>可以看到，这里定义了一个并行度为 2 的 Source Function，其作用是将奇数分配给 1 号分区，偶数分配给 0 号分区。如果直接打印输出，那么结果一定是无序的：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221127174529343.png" width = "50%" /><p>因为上游任务会随机将数据流发送给下游的输出算子进行打印。</p><p>如果用 rebalance 方式进行打印，那么结果也会是无序的，因为 rebalance 方式会将处理过的数据随机分配给下游 sink 输出。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221127180736451.png" width = "50%" /><p>如果用 rescale 方式进行打印，那么结果就会是有序的，因为一共有 4 个 sink 算子，rescale 方式会将偶数分配到前两个算子，奇数分配到后两个算子</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221127181100218.png" width = "50%" /><p>可以看到，和我们预期是相同的。</p><h3 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h3><p>broadcast()方法会将输入流中的事件复制并发往所有下游算子的并行任务。那么就是每个数据在下游算子全部会输出一遍。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221127181356193.png" width = "50%" /><p>可以看到，数据源 1 在 1-4 的 sink 都输出了一遍，数据源 3 在 1-4 的数据源也都输出了一遍。</p><h3 id="全局"><a href="#全局" class="headerlink" title="全局"></a>全局</h3><p>global()方法会将输入流中的所有事件发往下游算子的第一个并行任务。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221127181540244.png" width = "50%" /><p>可以看到，虽然输出的并行度设置为 4，但是全局分区会将所有的时间都发往第一个 sink 输出。</p><h3 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h3><p>可以利用 partitionCustom()方法自己定义分区策略</p><h2 id="设置并行度"><a href="#设置并行度" class="headerlink" title="设置并行度"></a>设置并行度</h2><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>算子并行化任务的数目称为该算子的并行度。它决定了算子处理的并行化程度以及能够处理的数据规模</p><h4 id="默认并行度"><a href="#默认并行度" class="headerlink" title="默认并行度"></a>默认并行度</h4><p>算子的并行度可以在执行环境级别或单个算子级别进行控制。默认情况下，应用内所有算子的并行度都会被设置为应用执行环境的并行度。而环境的并行度（即所有算子的默认并行度）则会根据应用启动时所处的上下文自动初始化。</p><p>如果应用是在一个本地执行环境中运行，并行度会设置为 CPU 的线程数目。如果应用是提交到 Flink 集群运行，那么除非提交客户端明确指定，否则环境并行度将设置为集群默认并行度。</p><h4 id="获取环境默认并行度方法"><a href="#获取环境默认并行度方法" class="headerlink" title="获取环境默认并行度方法"></a>获取环境默认并行度方法</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224233225.png"></p><h4 id="覆盖环境默认并行度方法"><a href="#覆盖环境默认并行度方法" class="headerlink" title="覆盖环境默认并行度方法"></a>覆盖环境默认并行度方法</h4><p>注意，一旦如此，将无法通过提交客户端控制应用并行度</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210224233344.png"></p><h1 id="四、类型"><a href="#四、类型" class="headerlink" title="四、类型"></a>四、类型</h1><p>Flink DataStream 应用所处理的事件会以数据对象的形式存在。函数在调用时会传入数据对象，同时它也可以发出数据对象。因此 Flink 在内部需要对这些数据对象进行一些处理，即出于网络传输，读写状态、检查点和保存点等目的，需要对它们进行序列化和反序列化。为了提高上述过程的效率，Flink 有必要详细了解应用处理的数据类型。Flink 利用类型信息的概念来表示数据类型，并且对于每种类型，都会为其生成特定的序列化器、反序列化器以及比较器。</p><p>此外，Flink 中还有一个类型提取系统，它可以通过分析函数的输入、输出类型来自动获取类型信息，继而得到相应的序列化器和反序列化器。但在某些情况下，例如使用了 Lambda 函数或泛型类型，则必须显式指定类型信息才能启动应用或提高其性能。</p><h2 id="支持的数据类型"><a href="#支持的数据类型" class="headerlink" title="支持的数据类型"></a>支持的数据类型</h2><p>Flink 支持 Java 和 Scala 中所有常用数据类型。例如：</p><ul><li>原始类型</li><li>Java 和 Scala 元祖</li><li>Scala 样例类</li><li>POJO</li><li>一些特殊类型</li></ul><p>那些无法特别处理的类型会被当做泛型类型交给 Kryo 序列化框架进行序列化</p><h3 id="原始类型"><a href="#原始类型" class="headerlink" title="原始类型"></a>原始类型</h3><p>Flink 支持所有 Java 和 Scala 的原始类型，例如 Int、String 和 Double。</p><h4 id="Java-原始类型"><a href="#Java-原始类型" class="headerlink" title="Java 原始类型"></a>Java 原始类型</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">DataStreamSource&lt;Long&gt; stream = env.fromElements(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">3L</span>, <span class="hljs-number">4L</span>);  <br>stream.map(n -&gt; n + <span class="hljs-number">1</span>).print();<br></code></pre></td></tr></table></figure><h4 id="Scala-原始数据"><a href="#Scala-原始数据" class="headerlink" title="Scala 原始数据"></a>Scala 原始数据</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> numbers: <span class="hljs-type">DataStream</span>[<span class="hljs-type">Long</span>] = env.fromElements(<span class="hljs-number">1</span>L, <span class="hljs-number">2</span>L, <span class="hljs-number">3</span>L, <span class="hljs-number">4</span>L)<br>numbers.map(n =&gt; n + <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>在这里是一个 Long 类型的 DataStream，其中的元素分别为 1L，2L，3L 和 4L，对其进行 map 操作</p><h3 id="Java-和-Scala-元祖"><a href="#Java-和-Scala-元祖" class="headerlink" title="Java 和 Scala 元祖"></a>Java 和 Scala 元祖</h3><p>元祖是由固定数量的强类型字段所组成的复合数据类型。</p><h4 id="Scala-元祖"><a href="#Scala-元祖" class="headerlink" title="Scala 元祖"></a>Scala 元祖</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> persons: <span class="hljs-type">DataStream</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>)] = env.fromElements(<br>  (<span class="hljs-string">&quot;Adam&quot;</span>, <span class="hljs-number">17</span>),<br>  (<span class="hljs-string">&quot;Sarah&quot;</span>, <span class="hljs-number">23</span>)<br>)<br>persons.filter(p =&gt; p._2 &gt; <span class="hljs-number">18</span>)<br>persons.print()<br>env.execute(<span class="hljs-string">&quot;Tuple&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="Java-元祖"><a href="#Java-元祖" class="headerlink" title="Java 元祖"></a>Java 元祖</h4><p>和 <code>Scala</code> 不同的是，<code>Java</code> 元组是可变的，因此可以为其字段重新赋值。函数中可以对 <code>Java</code> 元组进行重用，以减轻垃圾回收器的压力。下面的例子展示了如何对 <code>Java</code> 元组的字段进行使用和更新：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Java元祖的使用  </span><br>Tuple2&lt;String, Integer&gt; personTuple = Tuple2.of(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">42</span>);  <span class="hljs-comment">// 创建一个Tuple2类型的Java元祖</span><br><span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> personTuple.getField(<span class="hljs-number">1</span>); <span class="hljs-comment">// 获取第2个元素，也就是age=42  </span><br>personTuple.f1 = <span class="hljs-number">43</span>; <span class="hljs-comment">// 将第二个字段设为42  </span><br>personTuple.setField(<span class="hljs-number">42</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// 将第二个字段设为42</span><br></code></pre></td></tr></table></figure><p>学会使用 <code>Java</code> 元祖之后，就可以使用其来创建数据流了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 2. Java和Scala元祖  </span><br>DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; personStream = env.fromElements(  <br>        Tuple2.of(<span class="hljs-string">&quot;Adam&quot;</span>, <span class="hljs-number">17</span>),  <br>        Tuple2.of(<span class="hljs-string">&quot;Sarah&quot;</span>, <span class="hljs-number">23</span>)  <br>);  <br><span class="hljs-comment">// 过滤出那些年龄大于18的人  </span><br>personStream.filter(p -&gt; p.f1 &gt; <span class="hljs-number">18</span>);<br></code></pre></td></tr></table></figure><p>可以看到，<code>Java</code> 中需要使用 <code>Tuple2.of()</code> 的方式生成元祖，<code>Scala</code> 可以直接使用 <code>()</code>，Flink 提供了 Java 元组的高效实现，它最多可包含 25 个字段，每个字段长度都对应一个单独的实现类— <code>Tuplel</code>, <code>Tuple2</code>, 直到 <code>Tuple25</code> 这些元组类都是强类型的。</p><h3 id="Scala-样例类"><a href="#Scala-样例类" class="headerlink" title="Scala 样例类"></a>Scala 样例类</h3><p>在这里定义一个样例类 Person，有两个字段：name 和 age。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-comment">// Scala样例类</span><br><span class="hljs-keyword">val</span> personsss: <span class="hljs-type">DataStream</span>[<span class="hljs-type">Person</span>] = env.fromElements(<br>  <span class="hljs-type">Person</span>(<span class="hljs-string">&quot;Adam&quot;</span>, <span class="hljs-number">17</span>),<br>  <span class="hljs-type">Person</span>(<span class="hljs-string">&quot;Sarah&quot;</span>, <span class="hljs-number">23</span>)<br>)<br><span class="hljs-comment">// 过滤出那些年龄大于18的人</span><br>personsss.filter( p =&gt; p.age &gt; <span class="hljs-number">18</span>)<br>personsss.print()<br>env.execute(<span class="hljs-string">&quot;Scala case class&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="POJO"><a href="#POJO" class="headerlink" title="POJO"></a>POJO</h3><p>Flink 会分析那些不属于任何一类的数据类型并尝试将它们作为 POJO 类型进行处理。如果一个类满足以下条件，Flink 就会将它看做 POJO：</p><ul><li>是一个公有类</li><li>有一个共有的无参默认构造函数</li><li>所有字段都是公有的或提供了相应的 getter 和 setter 方法。</li><li>所有字段类型都必须是 Flink 所支持的</li></ul><p>例如这样的一个类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person_POJO</span> &#123;<br>    <span class="hljs-keyword">public</span> String name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person_POJO</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person_POJO</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这样的类 Flink 就可以进行处理：</p><h4 id="Scala-处理"><a href="#Scala-处理" class="headerlink" title="Scala 处理"></a>Scala 处理</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// POJO</span><br><span class="hljs-keyword">val</span> personssss: <span class="hljs-type">DataStream</span>[<span class="hljs-type">Person_POJO</span>] = env.fromElements(<br>  <span class="hljs-keyword">new</span> <span class="hljs-type">Person_POJO</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">42</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-type">Person_POJO</span>(<span class="hljs-string">&quot;Wendy&quot;</span>, <span class="hljs-number">23</span>)<br>)<br>personssss.filter( p =&gt; p.age &gt; <span class="hljs-number">18</span>)<br>personsss.print()<br>env.execute(<span class="hljs-string">&quot;POJO&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="Java-处理"><a href="#Java-处理" class="headerlink" title="Java 处理"></a>Java 处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 3. POJO  </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;  <br>    <span class="hljs-comment">// 两个字段都是公有字段  </span><br>    <span class="hljs-keyword">public</span> String name;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;  <br>  <br>    <span class="hljs-comment">// 提供了默认构造函数  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span>&#123;&#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.name = name;  <br>        <span class="hljs-built_in">this</span>.age = age;  <br>    &#125;  <br>&#125;  <br>  <br>env.fromElements(  <br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">42</span>),  <br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Wendy&quot;</span>, <span class="hljs-number">23</span>)  <br>);<br></code></pre></td></tr></table></figure><h2 id="为数据类型创建类型信息"><a href="#为数据类型创建类型信息" class="headerlink" title="为数据类型创建类型信息"></a>为数据类型创建类型信息</h2><p><code>Flink</code> 类型系统的核心类是 <code>TypeInformation</code>，它为系统生成序列化器和比较器提供了必要信息。</p><p>例如：如果需要通过某个键值进行 <code>Join</code> 或者分组，<code>TypeInformation</code> 允许 <code>Flink</code> 对能否使用某字段作为键值进行语义检测。</p><p>需要使用 <code>TypeInformation</code> 的情况：<br>在类型提取器失灵的时候可能需要定义自己的类型并告知 <code>Flink</code> 如何高效地处理它们。这种情况下就需要为特定数据类型生成 <code>TypeInformation</code>。</p><p><code>Flink</code> 为 <code>Java</code> 和 <code>Scala</code> 提供了两个辅助类，其中的静态方法可以用来生成 <code>Typeinformation</code>。</p><h3 id="生成-TypeInformation"><a href="#生成-TypeInformation" class="headerlink" title="生成 TypeInformation"></a>生成 TypeInformation</h3><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><p><code>Java</code> 中的这个辅助类是 <code>org.apache.flink.api.common.typeinfo.Type</code>，具体使用方式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// TypeInformation</span><br><span class="hljs-comment">// 原始类型的TypeInformation</span><br>TypeInformation&lt;Integer&gt; intType = Types.INT;<br><span class="hljs-comment">// Java元祖的TypeInformation</span><br>TypeInformation&lt;Tuple2&lt;Long,String&gt;&gt; tupleType = Types.TUPLE(Types.LONG, Types.STRING);<br><span class="hljs-comment">// POJO的TypeInformation</span><br>TypeInformation&lt;Person_POJO&gt; personType = Types.POJO(Person_POJO.class);<br></code></pre></td></tr></table></figure><h4 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h4><p><code>Scala</code> <code>API</code> 中有关 <code>Typeinformation</code> 的辅助类是 <code>org.apache.flink.api.scala.typeutils.Types</code>, 它的用法如下：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// TypeInformation</span><br><span class="hljs-comment">// 1. 原始类型的TypeInformation</span><br><span class="hljs-keyword">val</span> stringType: <span class="hljs-type">TypeInformation</span>[<span class="hljs-type">String</span>] = <span class="hljs-type">Types</span>.<span class="hljs-type">STRING</span><br><span class="hljs-comment">// 2. Scala元祖的TypeInformation</span><br><span class="hljs-keyword">val</span> tupleType: <span class="hljs-type">TypeInformation</span>[(<span class="hljs-type">Int</span>, <span class="hljs-type">Long</span>)] = <span class="hljs-type">Types</span>.<span class="hljs-type">TUPLE</span>[(<span class="hljs-type">Int</span>, <span class="hljs-type">Long</span>)]<br><span class="hljs-comment">// 3. 样例类的TypeInformation</span><br><span class="hljs-keyword">val</span> caseClassType: <span class="hljs-type">TypeInformation</span>[<span class="hljs-type">Person</span>] = <span class="hljs-type">Types</span>.<span class="hljs-type">CASE_CLASS</span>[<span class="hljs-type">Person</span>]<br></code></pre></td></tr></table></figure><h2 id="显式提供类型信息"><a href="#显式提供类型信息" class="headerlink" title="显式提供类型信息"></a>显式提供类型信息</h2><p>在 <code>Flink</code> 无法自动推断类型时需要向 <code>Flink</code> 显式提供 <code>TypeInformation</code> 对象。<br>上面创建的类型信息就是为了给返回值显式明确类型信息。</p><p>使用方式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReturnTypeTest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();  <br>        env.setParallelism(<span class="hljs-number">1</span>);  <br>  <br>        DataStreamSource&lt;Event&gt; clicks = env.fromElements(  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Mary&quot;</span>, <span class="hljs-string">&quot;./home&quot;</span>, <span class="hljs-number">1000L</span>),  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;./cart&quot;</span>, <span class="hljs-number">2000L</span>)  <br>        );  <br>  <br>        <span class="hljs-comment">// 想要转换成二元组类型，需要进行以下处理  </span><br>        <span class="hljs-comment">// 1) 使用显式的 &quot;.returns(...)&quot;        DataStream&lt;Tuple2&lt;String, Long&gt;&gt; stream3 = clicks  </span><br>                .map( event -&gt; Tuple2.of(event.user, <span class="hljs-number">1L</span>) )  <br>                .returns(Types.TUPLE(Types.STRING, Types.LONG));  <br>        stream3.print();  <br>  <br>  <br>        <span class="hljs-comment">// 2) 使用类来替代Lambda表达式  </span><br>        clicks.map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTuple2Mapper</span>())  <br>                .print();  <br>  <br>        <span class="hljs-comment">// 3) 使用匿名类来代替Lambda表达式  </span><br>        clicks.map(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapFunction</span>&lt;Event, Tuple2&lt;String, Long&gt;&gt;() &#123;  <br>            <span class="hljs-meta">@Override</span>  <br>            <span class="hljs-keyword">public</span> Tuple2&lt;String, Long&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(Event value)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>                <span class="hljs-keyword">return</span> Tuple2.of(value.user, <span class="hljs-number">1L</span>);  <br>            &#125;  <br>        &#125;).print();  <br>  <br>        env.execute();  <br>    &#125;  <br>  <br>    <span class="hljs-comment">// 自定义MapFunction的实现类  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTuple2Mapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MapFunction</span>&lt;Event, Tuple2&lt;String, Long&gt;&gt;&#123;  <br>        <span class="hljs-meta">@Override</span>  <br>        <span class="hljs-keyword">public</span> Tuple2&lt;String, Long&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(Event value)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>            <span class="hljs-keyword">return</span> Tuple2.of(value.user, <span class="hljs-number">1L</span>);  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="五、定义键值和引用字段"><a href="#五、定义键值和引用字段" class="headerlink" title="五、定义键值和引用字段"></a>五、定义键值和引用字段</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p>Flink 不是在输入类型中提前定义好键值，而是将键值定义为<strong>输入数据上的函数</strong>。</p><p>因此，没有必要为键和值再单独定义数据类型，这样可以省去大量样板代码。</p><h2 id="字段位置"><a href="#字段位置" class="headerlink" title="字段位置"></a>字段位置</h2><p>针对元祖数据类型，可以简单地使用元祖相应元素的字段位置来定义键值。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.java.tuple.<span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala.createTypeInformation<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="hljs-type">DataStream</span>, <span class="hljs-type">KeyedStream</span>, <span class="hljs-type">StreamExecutionEnvironment</span>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">KeyValueTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br>    <span class="hljs-keyword">val</span> input: <span class="hljs-type">DataStream</span>[(<span class="hljs-type">Int</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Double</span>)] = env.fromElements((<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-number">1.1</span>))<br>    <span class="hljs-keyword">val</span> keyed: <span class="hljs-type">KeyedStream</span>[(<span class="hljs-type">Int</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Double</span>), <span class="hljs-type">Tuple</span>] = input.keyBy(<span class="hljs-number">1</span>)<br>    keyed.print()<br>    env.execute(<span class="hljs-string">&quot;tuple_key&quot;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这里，input.keyBy(1)表示根据第 1 个元素来进行分组，也就是 String 类型的元素。</p><p>此外，还可以通过多个元祖字段定义符合键值，只需将所有位置以列表形式逐一提供即可。</p><p>例如</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> keyed: <span class="hljs-type">KeyedStream</span>[(<span class="hljs-type">Int</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Double</span>), <span class="hljs-type">Tuple</span>] = input.keyBy(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h2 id="字段表达式"><a href="#字段表达式" class="headerlink" title="字段表达式"></a>字段表达式</h2><p>另一种定义键值和选择字段的方法是使用基于字符串的字段表达式。</p><p>它可用于元祖、POJO 以及样例类，同时还支持选择嵌套的字段。</p><h3 id="样例类"><a href="#样例类" class="headerlink" title="样例类"></a>样例类</h3><p>现在有样例类 SensorReading</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SensorReading</span>(<span class="hljs-params">id:<span class="hljs-type">String</span>, timestamp:<span class="hljs-type">Long</span>, temperature:<span class="hljs-type">Double</span></span>)</span><br></code></pre></td></tr></table></figure><p>为了将传感器 ID 设为数据流的键值，我们可以把字段名称 id 传给 keyBy()函数</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> sensorStream: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] = env.fromElements(<span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">20200225</span>, <span class="hljs-number">20.0</span>), <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">20200226</span>, <span class="hljs-number">21.0</span>))<br><span class="hljs-keyword">val</span> keyedSensors: <span class="hljs-type">KeyedStream</span>[<span class="hljs-type">SensorReading</span>, <span class="hljs-type">Tuple</span>] = sensorStream.keyBy(<span class="hljs-string">&quot;id&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h4><p>这里就不能用位置了，只有元祖可以用位置。</p><h3 id="POJO-1"><a href="#POJO-1" class="headerlink" title="POJO"></a>POJO</h3><p>现在有 POJO：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest;<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.common.typeinfo.<span class="hljs-type">TypeInformation</span>;<br><span class="hljs-keyword">import</span> org.apache.flink.api.common.typeinfo.<span class="hljs-type">Types</span>;<br><span class="hljs-keyword">import</span> scala.<span class="hljs-type">Tuple2</span>;<br><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person_POJO</span> </span>&#123;<br>    public <span class="hljs-type">String</span> name;<br>    public int age;<br><br>    public <span class="hljs-type">Person_POJO</span>()&#123;&#125;<br><br>    public <span class="hljs-type">Person_POJO</span>(<span class="hljs-type">String</span> name, int age) &#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>同样可以像样例类那样采用字段名称进行选择。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> <span class="hljs-type">POJOStream</span>: <span class="hljs-type">DataStream</span>[<span class="hljs-type">Person_POJO</span>] = env.fromElements(<span class="hljs-keyword">new</span> <span class="hljs-type">Person_POJO</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> <span class="hljs-type">Person_POJO</span>(<span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-number">2</span>))<br><span class="hljs-keyword">val</span> <span class="hljs-type">POJOSensors</span>: <span class="hljs-type">KeyedStream</span>[<span class="hljs-type">Person_POJO</span>, <span class="hljs-type">Tuple</span>] = <span class="hljs-type">POJOStream</span>.keyBy(<span class="hljs-string">&quot;age&quot;</span>)<br><span class="hljs-type">POJOSensors</span>.print()<br>env.execute(<span class="hljs-string">&quot;POJO&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h4><p>元祖字段的引用既可以使用字段名称，也可以使用从 0 开始的字段索引。不过 Scala 元祖编号从 1 开始，Java 元祖编号从 0 开始。</p><h2 id="嵌套字段"><a href="#嵌套字段" class="headerlink" title="嵌套字段"></a>嵌套字段</h2><p>如需选择 POJO 和元祖中嵌套字段，可以利用”.“来区分嵌套级别。假设有以下样例类：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-class">                  address: <span class="hljs-type">String</span>,</span></span><br><span class="hljs-params"><span class="hljs-class">                  zip: <span class="hljs-type">String</span>,</span></span><br><span class="hljs-params"><span class="hljs-class">                  country: <span class="hljs-type">String</span></span></span><br><span class="hljs-params"><span class="hljs-class">                  </span>)</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-class">                 name: <span class="hljs-type">String</span>,</span></span><br><span class="hljs-params"><span class="hljs-class">                 birthday: (<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span></span>), <span class="hljs-comment">//年月日</span></span><br>                 address: <span class="hljs-type">Address</span><br>                 )<br></code></pre></td></tr></table></figure><p>可以看到，Person 的 address 是 Address 类型，有三种属性，我们需要通过 zip 来进行区分时可以采用下面方式：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><span class="hljs-keyword">import</span> org.apache.flink.api.java.tuple.<span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala.createTypeInformation<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="hljs-type">DataStream</span>, <span class="hljs-type">KeyedStream</span>, <span class="hljs-type">StreamExecutionEnvironment</span>&#125;<br><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-class">                  address: <span class="hljs-type">String</span>,</span></span><br><span class="hljs-params"><span class="hljs-class">                  zip: <span class="hljs-type">String</span>,</span></span><br><span class="hljs-params"><span class="hljs-class">                  country: <span class="hljs-type">String</span></span></span><br><span class="hljs-params"><span class="hljs-class">                  </span>)</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-class">                 name: <span class="hljs-type">String</span>,</span></span><br><span class="hljs-params"><span class="hljs-class">                 birthday: (<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span></span>), <span class="hljs-comment">//年月日</span></span><br>                 address: <span class="hljs-type">Address</span><br>                 )<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">KeyValueTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br>    <span class="hljs-keyword">val</span> person: <span class="hljs-type">DataStream</span>[<span class="hljs-type">Person</span>] = env.fromElements(<span class="hljs-keyword">new</span> <span class="hljs-type">Person</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> <span class="hljs-type">Address</span>(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>)))<br>    <span class="hljs-keyword">val</span> persons: <span class="hljs-type">DataStream</span>[<span class="hljs-type">Person</span>] = person.keyBy(<span class="hljs-string">&quot;address.zip&quot;</span>)<br>    persons.print()<br>    env.execute(<span class="hljs-string">&quot;.&quot;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="混合类型上的嵌套表达式"><a href="#混合类型上的嵌套表达式" class="headerlink" title="混合类型上的嵌套表达式"></a>混合类型上的嵌套表达式</h3><p>若需要访问嵌套在 POJO 中某一元祖的字段：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">persons.keyBy(<span class="hljs-string">&quot;birthday._1&quot;</span>)<br></code></pre></td></tr></table></figure><p>可以使用通配符字段表达式”_“选择全部字段</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">persons.keyBy(<span class="hljs-string">&quot;birthday._&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="键值选择器"><a href="#键值选择器" class="headerlink" title="键值选择器"></a>键值选择器</h2><p>第三种指定键值的方法是使用 KeySelector 函数，它可以从输入事件中提取键值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.java.tuple.<span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala.createTypeInformation<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="hljs-type">DataStream</span>, <span class="hljs-type">KeyedStream</span>, <span class="hljs-type">StreamExecutionEnvironment</span>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">KeyValueTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br><br>    <span class="hljs-keyword">val</span> sensorStream: <span class="hljs-type">DataStream</span>[<span class="hljs-type">SensorReading</span>] = env.fromElements(<span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">20200225</span>, <span class="hljs-number">20.0</span>), <span class="hljs-type">SensorReading</span>(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">20200226</span>, <span class="hljs-number">21.0</span>))<br>    <span class="hljs-comment">// 键值选择器</span><br>    <span class="hljs-keyword">val</span> byId: <span class="hljs-type">KeyedStream</span>[<span class="hljs-type">SensorReading</span>, <span class="hljs-type">String</span>] = sensorStream<br>      .keyBy(r =&gt; r.id)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>KeySelector 函数接收一个输入项，返回一个键值。会根据返回的键值进行分组。</p><p>这个实例中，KeySelector 函数会返回元祖中最大的字段作为键值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.apitest<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.java.tuple.<span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala.createTypeInformation<br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="hljs-type">DataStream</span>, <span class="hljs-type">KeyedStream</span>, <span class="hljs-type">StreamExecutionEnvironment</span>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">KeyValueTest</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">StreamExecutionEnvironment</span> = <span class="hljs-type">StreamExecutionEnvironment</span>.getExecutionEnvironment<br><br>    <span class="hljs-comment">// 键值选择器2</span><br>    <span class="hljs-keyword">val</span> key_input: <span class="hljs-type">DataStream</span>[(<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>)] = env.fromElements((<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">val</span> keyedStream = key_input.keyBy(value =&gt; math.max(value._1, value._2))<br>    keyedStream.print()<br>    env.execute(<span class="hljs-string">&quot;key_selector&quot;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>4.Apache Flink架构</title>
    <link href="/2022/12/507aad122b24.html"/>
    <url>/2022/12/507aad122b24.html</url>
    
    <content type="html"><![CDATA[<h1 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h1><p>Flink是一个用于<strong>状态化流处理的分布式系统</strong>。它的搭建射击多个进程，这些进程通常会分布在多台机器上。</p><h2 id="分布式系统需要应对的常见挑战"><a href="#分布式系统需要应对的常见挑战" class="headerlink" title="分布式系统需要应对的常见挑战"></a>分布式系统需要应对的常见挑战</h2><p>Flink并没有依靠自身实现所有分布式系统需要解决的问题，而是在已有集群基础设施和服务之上专注于它的核心功能。</p><ol><li><p>分配和管理集群计算资源</p><p>Flink自身可以实现</p></li><li><p>进程协调</p><p>Flink自身可以实现</p></li><li><p>持久且<strong>高可用</strong>的<strong>数据存储</strong>以及<strong>故障恢复</strong>等</p><ol><li>Flink没有提供分布式持久化存储，而是利用了现有的分布式文件系统（如HDFS）或对象存储（如S3）。</li><li>它依赖Apache Zookeeper来完成高可用设置中的领导选举工作。</li></ol></li></ol><h1 id="搭建Flink所需组件"><a href="#搭建Flink所需组件" class="headerlink" title="搭建Flink所需组件"></a>搭建Flink所需组件</h1><p>Flink搭建需要四个不同组件。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221121005414.png" width = "50%" /><h2 id="作业管理器（JobManager）"><a href="#作业管理器（JobManager）" class="headerlink" title="作业管理器（JobManager）"></a>作业管理器（JobManager）</h2><ul><li>控制一个应用程序执行的主进程，也就是说，每个应用程序都会被一个不同的 JobManager 所控制执行</li><li>JobManager 会先接收到要执行的应用程序，这个应用程序会包括：作业图 （JobGraph），即逻辑Dataflow图和打包了所有的类、 库和其它资源的JAR包。</li><li>JobManager 会把JobGraph转换成一个物理层面的数据流图，这个图被叫做“执行图”（ExecutionGraph），包含了所有可以并发执行的任务。</li><li>JobManager 会向资源管理器（ResourceManager）请求执行任务必要的资源， 也就是任务管理器（TaskManager）上的插槽（slot）。一旦它获取到了足够的资源，就会将执行图分发到真正运行它们的TaskManager上。而在运行过程中， JobManager会负责所有需要中央协调的操作，比如说检查点（checkpoints）的协调。</li></ul><h3 id="JobManager-最重要的三个组件"><a href="#JobManager-最重要的三个组件" class="headerlink" title="JobManager 最重要的三个组件"></a>JobManager 最重要的三个组件</h3><h4 id="1-JobMaster"><a href="#1-JobMaster" class="headerlink" title="1. JobMaster"></a>1. JobMaster</h4><ul><li><p><code>JobMaster</code> 是 <code>JobManager</code> 中最核心的组件，负责处理单独的作业。</p></li><li><p>在作业提交时， <code>JobManager</code> 会最先接收到要执行的应用，一般是由客户端提交来的，包括：<code>Jar</code> 包，数据流图（<code>dataflow graph</code>）和作业图（<code>JobGraph</code>）。</p></li><li><p><code>JobMaster</code> 会把 <code>JobGraph</code> 转换成一个物理层面的数据流图，这个图被称为执行图（<code>ExecutionGraph</code>），它包含所有并发执行的任务。<code>JobMaster</code> 会向资源管理器（<code>Resource Manager</code>）发出请求，申请执行任务的必要资源。一旦它获取到了足够资源，就会将执行图分发到真正运行它们的 <code>TaskManager</code> 上。</p></li><li><p>在运行过程中，<code>JobMaster</code> 会负责所有需要中央协调的操作，比如检查点（<code>checkpoints</code>）的协调。</p></li></ul><h4 id="2-资源管理器（ResourceManager）"><a href="#2-资源管理器（ResourceManager）" class="headerlink" title="2. 资源管理器（ResourceManager）"></a>2. 资源管理器（ResourceManager）</h4><ul><li><p>主要负责管理任务管理器（<code>TaskManager</code>）的插槽（<code>slot</code>），<code>TaskManger</code> 插槽是 <code>Flink</code> 中定义的处理资源单元。</p></li><li><p>Flink为不同的环境和资源管理工具提供了不同资源管理器，比如<code>YARN</code>、<code>Mesos</code>、<code>K8s</code>，以及<code>standalone</code>部署。</p></li><li><p>当 <code>JobManager</code> 申请插槽资源时，<code>ResourceManager</code> 会将有空闲插槽的 <code>TaskManager</code> 分配给 <code>JobManager</code> 。如果 <code>ResourceManager</code> 没有足够的插槽来满足 <code>JobManager</code> 的请求，它还可以向资源提供平台发起会话，以提供启动<br> <code>TaskManager</code> 进程的容器。</p></li></ul><h4 id="3-分发器（Dispatcher）"><a href="#3-分发器（Dispatcher）" class="headerlink" title="3. 分发器（Dispatcher）"></a>3. 分发器（Dispatcher）</h4><ul><li><p>可以跨作业运行，它为应用提交提供了REST接口。</p></li><li><p>当一个应用被提交执行时，分发器就会启动并将应用移交给一个<code>JobManager</code>。</p></li><li><p><code>Dispatcher</code>也会启动一个<code>Web UI</code>，用来方便地展示和监控作业执行的信息。</p></li><li><p><code>Dispatcher</code>在架构中可能并不是必需的，这取决于应用提交运行的方式。</p></li></ul><h2 id="任务管理器（TaskManager）"><a href="#任务管理器（TaskManager）" class="headerlink" title="任务管理器（TaskManager）"></a>任务管理器（TaskManager）</h2><ul><li><p><code>Flink</code>中的工作进程。通常在Flink中会有多个 <code>TaskManager</code> 运行，每一个 <code>TaskManager</code> 都包含了一定数量的插槽（<code>slots</code>）。插槽的数量限制了 <code>TaskManager</code> 能够执行的任务数量。</p><p><strong>注意：<code>TaskManager</code> 数量与插槽总数的乘积就是集群静态的并行计算的能力。</strong></p></li><li><p>启动之后， <code>TaskManager</code> 会向资源管理器注册它的插槽；收到资源管理器的指令后， <code>TaskManager</code> 就会将一个或者多个插槽提供给J <code>JobManager</code> 调用。Jo <code>JobManager</code> 就可以向插槽分配任务（<code>tasks</code>）来执行了。</p></li><li><p>在执行过程中，一个 <code>TaskManager</code> 可以跟其它运行同一应用程序的 <code>TaskManager</code> 交换数据。</p></li></ul><h1 id="应用提交执行过程中Flink各组件之间的交互过程"><a href="#应用提交执行过程中Flink各组件之间的交互过程" class="headerlink" title="应用提交执行过程中Flink各组件之间的交互过程"></a>应用提交执行过程中Flink各组件之间的交互过程</h1><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201214152703.png" style="zoom: 67%;" /><h3 id="Standalone模式下作业提交流程"><a href="#Standalone模式下作业提交流程" class="headerlink" title="Standalone模式下作业提交流程"></a>Standalone模式下作业提交流程</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221121011451.png" width = "50%" /><h3 id="在YARN模式下应用提交流程"><a href="#在YARN模式下应用提交流程" class="headerlink" title="在YARN模式下应用提交流程"></a>在YARN模式下应用提交流程</h3><h4 id="session-mode"><a href="#session-mode" class="headerlink" title="session mode"></a>session mode</h4><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221121011647.png" width = "50%" /><p>一开始只有 <code>JobManager</code></p><h4 id="单作业模式"><a href="#单作业模式" class="headerlink" title="单作业模式"></a>单作业模式</h4><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221121012006.png" width = "50%" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201214170015.png" style="zoom: 67%;" /><h1 id="任务调度原理"><a href="#任务调度原理" class="headerlink" title="任务调度原理"></a>任务调度原理</h1><h2 id="任务的概念"><a href="#任务的概念" class="headerlink" title="任务的概念"></a>任务的概念</h2><p>任务是最小单位，任务数量$&#x3D;$算子$\times$ 并行度，当算子并行度为1时，任务数量就是算子数量。</p><p>任务是构成slot的部分。</p><p>任务提交的主要工作就是将任务给到JobManager，JobManager需要进行进一步的处理，这个就是任务调度。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210222085003.png"></p><p>上图介绍了从code（程序）到最后的Task的过程。 </p><h2 id="并行度"><a href="#并行度" class="headerlink" title="并行度"></a>并行度</h2><p><strong>定义</strong>：一个特定算子的子任务（subtask）的个数被称之为其并行度。一般情况下，一个stream的并行度，可以认为就是其所有算子中最大的并行度。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210222091736.png"></p><p>以source为例，设置并行度为2，代表Souce会有两个并行的子任务，Sink的并行度为1，因为只有一个子任务，所有按照最大的并行子任务来计算，Stream的并行度为2。</p><p>最后可以合并：(参照下面的任务链接)</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221124005223.png"></p><h3 id="并行度设置"><a href="#并行度设置" class="headerlink" title="并行度设置"></a>并行度设置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">.setParallelism(<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h2 id="TaskManager和Slots"><a href="#TaskManager和Slots" class="headerlink" title="TaskManager和Slots"></a>TaskManager和Slots</h2><p><code>Slot</code> 是指 <code>TaskManager</code> 具有的并行执行程序</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210222165915.png"></p><ul><li>Flink中每一个TaskManager都是一个JVM进程，它可能会在独立的线程上执行一个或多个任务</li><li>为了控制一个TaskManager能接收多少个task，TaskManager通过task slot来进行控制（一个TaskManager至少有一个slot）</li><li>简单来说，线程所占据的资源就是slot</li></ul><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210222161633.png"></p><ul><li><p>默认情况下，Flink允许子任务共享slot，即使它们是不同任务的子任务。这样的结果是，一个slot可以保存作业的整个管道。</p><p>也就是说，一个slot代表一个作业的一类操作，整个作业的管道就在这里保存。</p><p><strong>注意</strong>：管道就是整个处理流程的每一步操作（一整套计算流程）</p></li><li><p>Task Slot是静态的概念，是指TaskManager具有的并发执行能力。</p></li></ul><h3 id="任务共享Slot"><a href="#任务共享Slot" class="headerlink" title="任务共享Slot"></a>任务共享Slot</h3><ul><li>默认情况下，<code>Flink</code> 允许子任务共享 <code>slot</code> 。这样的结果是，一个 <code>slot</code> 可以保存作业的整个管道</li><li>当我们讲资源密集型和非密集型的任务同时放到一个 <code>slot</code> 中，它们就可以自行分配对资源占用的比例，从而保证最重的活平均分配给所有的 <code>TaskManager</code>。</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>一个JobGraph可以转换为多个TaskManager，每个TaskManager由不同的slot构成，一个slot对应一个任务。</p><h2 id="并行子任务的分配"><a href="#并行子任务的分配" class="headerlink" title="并行子任务的分配"></a>并行子任务的分配</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210222170745.png"></p><p>原则是尽量保证每个slot任务均衡</p><h2 id="高可用性设置"><a href="#高可用性设置" class="headerlink" title="高可用性设置"></a>高可用性设置</h2><p>高可用性分为两部分，分别是TaskManager故障和JobManager故障</p><ol><li><p>TaskManager故障</p><p>如果TaskManager出现故常，则可用的slot数量减少，此时JobManager就会向ResourceManager申请更多的slot，如果无法完成，JobManager将无法重启应用，直至有足够数量的可用slot。</p></li><li><p>JobManager故障</p><p>JobManager在高可用模式下工作时，会将JobGraph以及全部所需的元数据（例如所写的JAR文件）写入一个远程持久化存储系统（例如HDFS）中。此外，JobManager还会将存储位置的路径地址写入ZooKeeper的数据存储。</p><p>如图所示：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210222174727.png" style="zoom: 25%;" /><p>当JobManager发生故障时，其下应用的所有任务都会自动取消，新接手的JobManager会执行以下步骤：</p><ol><li>向ZooKeeper请求存储位置，以获取JobGraph、JAR文件以及应用最新检查点在远程存储的状态句柄</li><li>向ResourceManager申请处理槽来继续执行应用</li><li>重启应用并利用最近一次检查点充值任务状态</li></ol></li></ol><h2 id="Flink中的数据传输"><a href="#Flink中的数据传输" class="headerlink" title="Flink中的数据传输"></a>Flink中的数据传输</h2><h3 id="数据传输形式"><a href="#数据传输形式" class="headerlink" title="数据传输形式"></a>数据传输形式</h3><ol><li><code>one-to-one</code>： 这意味着map算子的子任务看到的元素的个数以及顺序跟 source 算子的子任务生产的元素的个数、顺序相同。<code>map</code>, <code>filter</code>, <code>flatMap</code> 等算子都是 <code>one-to-one</code> 的对应关系。</li><li><code>Redistributing</code>： stream 的分区会发生改变。每个算子的子任务依赖所选择的 transformation 发送数据到不同的目标任务。 例如，keyBy基于 hashCode 重分区、而broadcast 和 rebalance 会随机重新分区，这些算子都会引起 <code>redistribute</code> 过程，而 <code>redistribute</code> 过程就类似于 <code>Spark</code> 中的 <code>shuffle</code> 过程</li></ol><p>在运行过程中，应用的任务会持续进行数据交换。TaskManager负责将数据从发送任务传输至接收任务。它的网络模块在记录传输前会先将它们收集到缓冲区中。</p><p>换言之，<strong>记录并非逐个发送的，而是在缓冲区中以批次形式发送</strong>。</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>将记录放入缓冲区并不意味着Flink的处理模型是基于微批次的。</p><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>通过网络连接逐条发送记录不但低效，还会导致很多额外开销。若想充分利用网络连接带宽，就需要对数据进行缓冲。在流处理环境下，缓冲的一个明显缺点是会增加延迟，因为记录首先要收集到缓冲区中而不会立即发送。</p><h3 id="基于信用值的流量控制"><a href="#基于信用值的流量控制" class="headerlink" title="基于信用值的流量控制"></a>基于信用值的流量控制</h3><h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>接收任务会给发送任务授予一定的信用值，其实就是保留一些用来接收它数据的网络缓冲。一旦发送端收到信用通知，就会在信用值所限定的范围内尽可能多地传输缓冲数据，并会附带上积压量（已经填满准备传输的网络缓冲数目）大小。<br>接收端使用保留的缓冲来处理收到的数据，同时依据各发送端的积压量信息来计算所有相连的发送端在下一轮的信用优先级。</p><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>发送端可以在接收端有足够资源时立即传输数据，所以基于信用值的流量控制可以有效降低延迟。此外，信用值的授予是根据各发送端的数据积压量来完成的，因此该机制还能在出现数据倾斜（data skew）时有效地分配网络资源。</p><h3 id="任务链接（算子链）"><a href="#任务链接（算子链）" class="headerlink" title="任务链接（算子链）"></a>任务链接（算子链）</h3><p>Flink采用一种名为<strong>任务链接</strong>的优化技术来降低某些情况下的本地通信开销。</p><h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><p>多个算子必须有<strong>相同的并行度</strong>且通过<strong>本地转发通道</strong>（local forward channel）相连。</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210223021122.png" style="zoom: 33%;" /><p>可以看到，图中所有算子的并行度相同并且通过本地转发通道相连，因此可以将三个算子进行“融合”，在单线程中进行执行，并且通过方法调用进行数据传输。也就是说，不同函数之间直接可以调用也避免了tcp连接。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210223021239.png" style="zoom: 33%;" /><p>虽然任务链接可以有效地降低本地任务之间的通信开销，但有的流水线应用反而不希望应用到它。例如有时候我们需要对过长任务连接进行切分或者将两个计算量大的函数分配到不同处理槽中。</p><h4 id="分配到不同处理槽的方法"><a href="#分配到不同处理槽的方法" class="headerlink" title="分配到不同处理槽的方法"></a>分配到不同处理槽的方法</h4><p>disableChaining()方法</p><p>结果就是每个函数都交由单独的任务、在特定线程内处理。</p><p>也可以用startNewChain()方法开始新的任务链</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210223022633.png" style="zoom: 33%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>3.Flink安装部署</title>
    <link href="/2022/12/94f4d9a4e592.html"/>
    <url>/2022/12/94f4d9a4e592.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-解压文件"><a href="#1-解压文件" class="headerlink" title="1 解压文件"></a>1 解压文件</h1><p>将文件解压到&#x2F;opt&#x2F;module文件夹下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxvf flink flink-1.10.1-bin-scala_2.12.tgz<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213211354.png"></p><h1 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2 修改配置文件"></a>2 修改配置文件</h1><p>首先进入conf目录中。</p><ol><li><p>修改flink-conf.yaml文件</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213211645.png" style="zoom: 33%;" /></li><li><p>修改slaves文件</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213211744.png" style="zoom:50%;" /></li><li><p>分发给另外两台机器</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213211843.png" style="zoom:50%;" /></li><li><p>启动</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213212136.png" style="zoom: 33%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213214824.png" style="zoom: 33%;" /></li><li><p>访问<a href="http://hadoop100:8081，可以对flink集群和任务进行监控管理">http://hadoop100:8081，可以对flink集群和任务进行监控管理</a></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213212329.png"></p></li></ol><h1 id="2-提交任务"><a href="#2-提交任务" class="headerlink" title="2 提交任务"></a>2 提交任务</h1><ol><li><p>准备数据文件（如果需要），分发到taskmanager机器中</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213213202.png" style="zoom: 33%;" /><p>如果从文件中读取数据，由于是从本地磁盘读取，实际任务会被分发到taskmanager的机器中，所以要把目标文件分发。如果是HDFS上读取文件则不需要。</p></li><li></li></ol>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2.Dataflow编程概述</title>
    <link href="/2022/12/529163297a85.html"/>
    <url>/2022/12/529163297a85.html</url>
    
    <content type="html"><![CDATA[<p>在深入探索流处理的基础知识之前，我们需要先介绍Dataflow编程的必要背景。</p><h1 id="Dataflow图"><a href="#Dataflow图" class="headerlink" title="Dataflow图"></a>Dataflow图</h1><h2 id="先决了解"><a href="#先决了解" class="headerlink" title="先决了解"></a>先决了解</h2><p>Dataflow是数据流，源自于谷歌非常著名的论文。本节就是较为基础地讲解了Dataflow的知识，并且需要知道的是，Flink就是基本按照那篇论文的架构来进行实现的。</p><h2 id="Dataflow介绍"><a href="#Dataflow介绍" class="headerlink" title="Dataflow介绍"></a>Dataflow介绍</h2><p>顾名思义，Dataflow程序描述了数据如何在不同操作之间流动。Dataflow程序通常表示为<strong>有向图</strong>。</p><p>图中<strong>顶点为算子</strong>，表示<strong>计算</strong>；而<strong>边表示数据依赖关系</strong>。</p><h3 id="算子"><a href="#算子" class="headerlink" title="算子"></a>算子</h3><p>算子是Dataflow程序的基本功能单元，它们从输入获取数据，对其进行计算，然后产生数据并发往输出以供后续处理。没有输入端的算子称为<strong>数据源</strong>，没有输出端的算子称为<strong>数据汇</strong>。</p><p>一个Dataflow图至少要有一个数据源和一个数据汇。下图展示了一个从推文输入流中提取并统计主题标签的Dataflow程序。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213220929.png" style="zoom: 50%;" /><p>图中的Tweets source是数据源，也就是没有输入端的算子（自身就是输入端）。Trending topics sink为数据汇，也就是没有输出端的算子（自身就是最终节点）。中间的Extract hashtags和Count就是普通算子。</p><h2 id="逻辑Dataflow图和物理Dataflow图"><a href="#逻辑Dataflow图和物理Dataflow图" class="headerlink" title="逻辑Dataflow图和物理Dataflow图"></a>逻辑Dataflow图和物理Dataflow图</h2><p>类似上图2-1称为<strong>逻辑Dataflow图</strong>，因为它们表达了高层视角下的计算逻辑。</p><p>为了执行Dataflow程序，需要将逻辑Dataflow图转化为<strong>物理Dataflow图</strong>，后者会指定程序的执行细节。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213220954.png" style="zoom: 50%;" /><h4 id="逻辑Dataflow图和物理Dataflow图的区别"><a href="#逻辑Dataflow图和物理Dataflow图的区别" class="headerlink" title="逻辑Dataflow图和物理Dataflow图的区别"></a>逻辑Dataflow图和物理Dataflow图的区别</h4><p>在逻辑Dataflow图中，顶点代表<strong>算子</strong>。</p><p>在物理Dataflow图中，顶点代表<strong>任务</strong>。</p><p>以图2-1为例，顶点推文数据源的下一个顶点是抽取主题标签，代表的是一个算子，也就是一类型的任务。而图2-2中顶点推文数据源中的下一个顶点为两个抽取主题标签，”抽取主题标签“算起包含两个并行算子任务，每个任务负责计算一部分输入数据。</p><h1 id="数据并行和任务并行"><a href="#数据并行和任务并行" class="headerlink" title="数据并行和任务并行"></a>数据并行和任务并行</h1><p>Dataflow图的并行性可以通过多种方式加以利用。</p><h6 id="数据并行"><a href="#数据并行" class="headerlink" title="数据并行"></a>数据并行</h6><p>将输入数据分组，让同一操作的多个任务并行执行在不同数据子集上，这种并行称为数据并行。</p><h6 id="任务并行"><a href="#任务并行" class="headerlink" title="任务并行"></a>任务并行</h6><p>让不同算子的任务并行计算，这种并行称为任务并行</p><h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p>数据并行就是同一个任务的数据并行进行计算，任务并行就是不同任务并行进行。</p><h1 id="数据交换策略"><a href="#数据交换策略" class="headerlink" title="数据交换策略"></a>数据交换策略</h1><p>数据交换策略定义了如何将数据项分配给物理Dataflow中的不同任务。</p><p>分为转发策略，广播策略，基于键值策略和随机策略。分别表示如下：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213221018.png" style="zoom: 33%;" /><ol><li>转发策略：发送端任务和接收端任务之间一对一进行数据传输。</li><li>广播策略：会把每个任务项发往下游算子的全部并行任务。代价较为昂贵。</li><li>基于键值的策略：基于某一键值属性对数据分区，并保证键值相同的项会进入同一个任务处理。</li><li>随机策略：会将数据均匀分配给所有任务。</li></ol><h1 id="并行流处理"><a href="#并行流处理" class="headerlink" title="并行流处理"></a>并行流处理</h1><h2 id="数据流的定义"><a href="#数据流的定义" class="headerlink" title="数据流的定义"></a>数据流的定义</h2><p>数据流是一个可能无限的时间序列。</p><p>由于数据流没有总执行时间的概念，因此我们用延迟和吞吐来表示系统的性能。</p><h2 id="延迟"><a href="#延迟" class="headerlink" title="延迟"></a>延迟</h2><p>延迟表示处理一个事件所需要的时间。</p><h4 id="延迟的分类"><a href="#延迟的分类" class="headerlink" title="延迟的分类"></a>延迟的分类</h4><p>延迟分为平均延迟，最大延迟和延迟的百分位数值。例如95百分位在10ms表示有95%的数据会在10ms内被处理。</p><h2 id="吞吐"><a href="#吞吐" class="headerlink" title="吞吐"></a>吞吐</h2><p>吞吐是用来衡量系统处理能力的指标，它告诉我们系统每单位时间能处理多少事件。</p><h3 id="数据流上的操作"><a href="#数据流上的操作" class="headerlink" title="数据流上的操作"></a>数据流上的操作</h3><h4 id="窗口"><a href="#窗口" class="headerlink" title="窗口"></a>窗口</h4><ol><li><p>滚动窗口</p><p>将事件分配到长度固定且互不重叠的桶中。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Algorithm/20201213193956.png" style="zoom:33%;" /><p>​基于数量的滚动窗口</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213195451.png" style="zoom:33%;" /><p>​基于时间的滚动窗口</p></li><li><p>滑动窗口</p><p>将事件分配到大小固定且允许相互冲切的桶中，这意味着每个事件可能会同时属于多个桶。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213195734.png" style="zoom: 33%;" /><p>​长度为4个事件滑动间隔为3个事件的基于数量的滑动窗口</p></li><li><p>会话窗口</p><p>能将属于同一会话的时间分配到相同桶中。会话窗口根据会话间隔将事件分为不同的会话，改间隔值定义了会话在关闭前的非活动时间长度。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213201043.png" style="zoom:33%;" /><p>​会话窗口</p></li></ol><h1 id="时间语义"><a href="#时间语义" class="headerlink" title="时间语义"></a>时间语义</h1><h2 id="处理时间"><a href="#处理时间" class="headerlink" title="处理时间"></a>处理时间</h2><p>处理时间是当前<strong>流处理算子所在机器</strong>上本地时钟时间。</p><p>也就是说，若某个人离线之后再重新连接，离线的那段时间并不是处理时间，因为他并没有和算子所在机器取得联系。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213221100.png" style="zoom:50%;" /><p>可以看到，不会将离线时间考虑在内。</p><h2 id="事件时间"><a href="#事件时间" class="headerlink" title="事件时间"></a>事件时间</h2><p>事件时间是数据流中事件实际发生的时间，它以<strong>附加在数据流中事件的时间戳</strong>为依据。如下图所示，即便有事件延迟，事件时间窗口也能准确地将事件分配到窗口中，从而反映出真实发生的情况。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201213221119.png" style="zoom:50%;" /><p>事件时间将处理速度和结果内容彻底解耦。要客服的挑战之一是如何处理延迟事件。</p><h2 id="水位线"><a href="#水位线" class="headerlink" title="水位线"></a>水位线</h2><p>水位线是一个全局进度指标，表示我们确信不再有延迟事件到来的某个时间点。</p><p>本质上，水位线提供了一个<strong>逻辑时钟</strong>，用来通知系统<strong>当前的事件时间</strong>。</p><h4 id="水位线的意义"><a href="#水位线的意义" class="headerlink" title="水位线的意义"></a>水位线的意义</h4><p>当一个算子接收到时间为T的水位线，就可以认为不会再收到任何时间戳小于或等于T的事件了。也就是说，算子一旦收到某个水位线，就相当于接到信号：某个特定时间区间的时间戳已经到齐，可以出发窗口计算或对接收的数据进行排序了。</p><h2 id="事件时间和处理时间"><a href="#事件时间和处理时间" class="headerlink" title="事件时间和处理时间"></a>事件时间和处理时间</h2><p>事件时间虽然能解决所有问题，但是处理时间窗口能够将延迟降到最低。无需考虑迟到或者乱序。对于那些更重视处理速度而非准确度的应用，处理时间就会派上用场。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1.状态流处理概述</title>
    <link href="/2022/12/9108907eb755.html"/>
    <url>/2022/12/9108907eb755.html</url>
    
    <content type="html"><![CDATA[<h1 id="事务型处理"><a href="#事务型处理" class="headerlink" title="事务型处理"></a>事务型处理</h1><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211170831.png" style="zoom: 33%;" /><p>在事务型处理问题时，多个应用会共享同一个数据库系统，有时候还会访问相同的数据库或表。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>一旦多个而应用基于相同的数据表示或共享架构，那么更改表模式或对数据库系统进行扩缩容必将劳心费力。</p><h1 id="分析型处理"><a href="#分析型处理" class="headerlink" title="分析型处理"></a>分析型处理</h1><pre><code class=" mermaid">graph LR事务性--&gt;分析型</code></pre><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>如果能将不同事务型数据库的内容进行联合查询，能为企业提供更加全面的分析见解。然而事务型数据库之间通常相互隔离，难以联合分析，因此将其<strong>全部导入一个数据仓库中</strong>，就可以进行联合查询，创造更高价值。</p><h2 id="分析型数据库操作"><a href="#分析型数据库操作" class="headerlink" title="分析型数据库操作"></a>分析型数据库操作</h2><p>对于分析类查询，我们通常不会直接在事务型数据库上执行，而是将数据复制到一个专门用来处理分析类查询的<strong>数据仓库</strong>。</p><h3 id="数据仓库怎么来"><a href="#数据仓库怎么来" class="headerlink" title="数据仓库怎么来"></a>数据仓库怎么来</h3><p>为了填充数据仓库，需要将事务性数据库系统中的数据拷贝过去。这个向数据仓库拷贝数据的过程被称为提取-转换-加载（Extract-Transform-Load，<strong>ETL</strong>）。</p><h4 id="ETL基本流程"><a href="#ETL基本流程" class="headerlink" title="ETL基本流程"></a>ETL基本流程</h4><p>从事务型数据库中提取数据，将其转换为通用表示形式，最终加载到分析型数据库（数据仓库）中。<br>并且为了保证数据同步，ETL需要周期性执行。</p><h3 id="用于数据分析的传统数仓架构"><a href="#用于数据分析的传统数仓架构" class="headerlink" title="用于数据分析的传统数仓架构"></a>用于数据分析的传统数仓架构</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211190414.png" style="zoom: 33%;" /><p>如图所示，对数据仓库的查询分析有两种  </p><ol><li><p><strong>定期报告查询</strong><br>  可用于计算业务相关的统计数据，如收入等。将这些指标整合成报告，能够帮助管理层评估企业整体健康状况。</p></li><li><p><strong>即席查询</strong></p></li></ol><p>  主要目的是通过解答特定问题来辅助关键性的商业决策，例如通过查询来整合应收数字和电台广告中的投入，以评估市场营销的有效性。</p><h1 id="状态化流处理"><a href="#状态化流处理" class="headerlink" title="状态化流处理"></a>状态化流处理</h1><h2 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h2><p>几乎所有数据都是以连续时间流的形式产生。</p><h2 id="有状态定义"><a href="#有状态定义" class="headerlink" title="有状态定义"></a>有状态定义</h2><p>有状态的定义是能够存储和访问中间结果。任何一个处理事件流的应用，如果要支持跨多条记录的转换操作，都必须是有状态的。</p><h2 id="Flink应用状态存储方式"><a href="#Flink应用状态存储方式" class="headerlink" title="Flink应用状态存储方式"></a>Flink应用状态存储方式</h2><p>Apache Flink会将应用状态存储在本地内存或嵌入式数据库中。由于采用的是分布式架构，Flink需要对本地状态予以保护。以避免因应用或机器故障导致数据丢失。</p><h3 id="本地状态保护方式"><a href="#本地状态保护方式" class="headerlink" title="本地状态保护方式"></a>本地状态保护方式</h3><p>Flink会定期将应用状态的一致性检查点（checkpoint）写入远程持久化存储。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211190506.png" style="zoom:33%;" /><h2 id="有状态的流处理应用读取事件记录的方式"><a href="#有状态的流处理应用读取事件记录的方式" class="headerlink" title="有状态的流处理应用读取事件记录的方式"></a>有状态的流处理应用读取事件记录的方式</h2><p>有状态的流处理应用通常会从事件日志中读取事件记录。</p><p>事件日志负责<strong>存储事件流并将其分布式化</strong>。</p><h2 id="三种常见有状态流处理应用"><a href="#三种常见有状态流处理应用" class="headerlink" title="三种常见有状态流处理应用"></a>三种常见有状态流处理应用</h2><h3 id="①-事件驱动型应用"><a href="#①-事件驱动型应用" class="headerlink" title="① 事件驱动型应用"></a>① 事件驱动型应用</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>事件驱动型应用是一类通过接收事件流触发特定应用业务逻辑的有状态的流式应用</p><h4 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h4><ol><li>实时推荐</li><li>模式识别或复杂事件处理</li><li>异常监控</li></ol><p>事件驱动型应用利用日志进行通信，其数据则会以<strong>本地状态形式</strong>存储。</p><h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ol><li>访问本地状态的性能比读写远程数据存储系统更好<br>也就是说，其数据存储在本地（通过checkpoint和远程同步），对某些事件的反应（例如异常监控）时不需要访问远程数据库，从而速度快很多。</li><li>伸缩和容错交由流引擎完成</li><li>以事件日志作为应用的输入，完整可靠，还支持精准的数据重放</li></ol><h3 id="②-数据管道"><a href="#②-数据管道" class="headerlink" title="② 数据管道"></a>② 数据管道</h3><h4 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h4><p>公司为了提高数据访问性能把相同数据存储到多个系统。<br>例如网点内的某产品信息会同时放在事务型数据库、网站缓存以及搜索引擎中。  </p><h4 id="原因-2"><a href="#原因-2" class="headerlink" title="原因"></a>原因</h4><p>数据存在多个副本，这些数据存储系统之间需要保持同步。</p><h4 id="同步方式"><a href="#同步方式" class="headerlink" title="同步方式"></a>同步方式</h4><p>使用事件日志系统来分发更新。具体来说就是将更新写入时间日志系统，并由它进行分发。</p><h3 id="③-流式分析"><a href="#③-流式分析" class="headerlink" title="③ 流式分析"></a>③ 流式分析</h3><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ol><li>手机网络质量监控</li><li>移动应用中的用户行为分析</li><li>消费者技术中的实时数据即席分析</li></ol><h1 id="开源流处理的演变"><a href="#开源流处理的演变" class="headerlink" title="开源流处理的演变"></a>开源流处理的演变</h1><h2 id="第1代流引擎（Storm）"><a href="#第1代流引擎（Storm）" class="headerlink" title="第1代流引擎（Storm）"></a>第1代流引擎（Storm）</h2><p>典型代表就是Storm，并未针对流式应用的结果的准确性和一致性提供内置保障，结果完全取决于事件到达的时间和顺序。<br>此外，虽然数据在出错时不会丢失，但可能被处理多次。</p><h2 id="第2代流引擎（Lambda架构）"><a href="#第2代流引擎（Lambda架构）" class="headerlink" title="第2代流引擎（Lambda架构）"></a>第2代流引擎（Lambda架构）</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211190556.png" style="zoom:33%;" /><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>用两套系统，同时保证低延迟和结果准确。<br>在传统周期性批处理架构的基础上添加了一个由低延迟流处理引擎所驱动的“提速层”。<br>最终将两层的结果进行合并。</p><h3 id="第3带流引擎（Flink）"><a href="#第3带流引擎（Flink）" class="headerlink" title="第3带流引擎（Flink）"></a>第3带流引擎（Flink）</h3><p>解决了时间顺序问题。<br>无需让用户在延迟和吞吐量之间做出困难的抉择。</p><h1 id="Flink初体验"><a href="#Flink初体验" class="headerlink" title="Flink初体验"></a>Flink初体验</h1><ol><li><p>安装Flink（第3章会介绍）</p></li><li><p>启动本地集群</p><p>在这里我们采用的是群起集群，具体配置和方式会在后面进行介绍</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211191810.png" style="zoom:25%;" /></li><li><p>下载示例JAR文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://streaming-with-flink.github.io/examples/download/examples-scala.jar<br></code></pre></td></tr></table></figure></li><li><p>通过指定应用的入口类和JAR文件，在集群上运行示例。</p></li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211192437.png" style="zoom: 50%;" /><ol start="5"><li><p>可以看到，在Web UI会看到“Running Jobs”列表中有一个作业。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211192625.png"></p><p>单击那个作业，可以看到下图所示的数据流程及运行作业中算子的实时指标。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211195101.png"></p></li><li><p>作业的输出会写入Flink工作流程的标准输出，默认情况下它会重定向到.&#x2F;logs目录下的文件</p><p>可以使用tail命令监控持续产生的结果。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tail -f flink-coachhe-taskexecutor-0-hadoop100.out<br></code></pre></td></tr></table></figure></li><li><p>由于应用是流式的，它会一直运行下去，直到手动取消。取消的方式是在Web UI中选中作业，然后单击页面上方的Cancel按钮。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211194318.png"></p></li><li><p>最后别忘了停止本地Flink集群</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201211194426.png" style="zoom:50%;" /></li></ol><h1 id="批处理WordCount"><a href="#批处理WordCount" class="headerlink" title="批处理WordCount"></a>批处理WordCount</h1><h2 id="1-首先建立一个Maven项目"><a href="#1-首先建立一个Maven项目" class="headerlink" title="1. 首先建立一个Maven项目"></a>1. 首先建立一个Maven项目</h2><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0</span></span><br><span class="hljs-string"><span class="hljs-tag">http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.flink<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>FlinkTutorial<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.flink<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flink-scala_2.12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.10.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-scala --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.flink<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flink-streaming-scala_2.12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.10.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 该插件用于将 Scala 代码编译成 class 文件 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.alchim31.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>scala-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- 声明绑定到 maven 的 compile 阶段 --&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>make-assembly<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>single<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-在src下创建scala目录并标志为Sources-Root，准备文件"><a href="#2-在src下创建scala目录并标志为Sources-Root，准备文件" class="headerlink" title="2. 在src下创建scala目录并标志为Sources Root，准备文件"></a>2. 在src下创建scala目录并标志为Sources Root，准备文件</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210129032337.png" style="zoom: 33%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210129034938.png" style="zoom:33%;" /><h2 id="3-编写程序"><a href="#3-编写程序" class="headerlink" title="3. 编写程序"></a>3. 编写程序</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.wc<br><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala.<span class="hljs-type">ExecutionEnvironment</span><br><span class="hljs-keyword">import</span> org.apache.flink.api.scala._<br><br><span class="hljs-comment">// 批处理wordcount</span><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">WordCount</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">// 1. 创建一个批处理执行环境</span><br>    <span class="hljs-keyword">val</span> env: <span class="hljs-type">ExecutionEnvironment</span> = <span class="hljs-type">ExecutionEnvironment</span>.getExecutionEnvironment<br><br>    <span class="hljs-comment">// 2. 从文件中读取数据</span><br>    <span class="hljs-keyword">val</span> inputPath: <span class="hljs-type">String</span> = <span class="hljs-string">&quot;/Users/heyizhi/Nutstore Files/我的坚果云/程序员/学习/大数据/10 flink/1st flink project/flinkTutorial/src/main/resources/hello.txt&quot;</span><br>    <span class="hljs-keyword">val</span> inputDataSet: <span class="hljs-type">DataSet</span>[<span class="hljs-type">String</span>] = env.readTextFile(inputPath)<br><br>    <span class="hljs-comment">// 3. 对数据进行转换处理统计，先分词，再按照word进行分组，最后进行聚合统计</span><br>    <span class="hljs-keyword">val</span> resultDataSet: <span class="hljs-type">DataSet</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>)] = inputDataSet<br>      .flatMap(_.split(<span class="hljs-string">&quot; &quot;</span>))<br>      .map((_, <span class="hljs-number">1</span>))<br>      .groupBy(<span class="hljs-number">0</span>) <span class="hljs-comment">// 以第一个元素作为key，进行分组</span><br>      .sum(<span class="hljs-number">1</span>) <span class="hljs-comment">// 对当前分组的所有数据的第2个元素求和</span><br><br><br>    <span class="hljs-comment">// 4. 打印输出</span><br>    resultDataSet.print()<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-运行"><a href="#4-运行" class="headerlink" title="4. 运行"></a>4. 运行</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210129035014.png" style="zoom:33%;" /><h1 id="流处理WordCount"><a href="#流处理WordCount" class="headerlink" title="流处理WordCount"></a>流处理WordCount</h1><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.wc<br><br><span class="hljs-keyword">import</span> org.apache.flink.streaming.api.scala._<br><br><span class="hljs-comment">// 流处理WordCount</span><br>object StreamWordCount &#123;<br>  def <span class="hljs-title function_">main</span><span class="hljs-params">(args: Array[String])</span>: Unit = &#123;<br>    <span class="hljs-comment">// 1. 创建流处理执行环境</span><br>    val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment<br><br>    <span class="hljs-comment">// 2. 接收一个socket文本流</span><br>    val inputDataStream: DataStream[String] = env.socketTextStream(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">7777</span>)<br><br>    <span class="hljs-comment">// 3. 进行转化处理统计</span><br>    val resultDataStream: DataStream[(String, Int)] = inputDataStream<br>      .flatMap(_.split(<span class="hljs-string">&quot; &quot;</span>))<br>      .filter(_.nonEmpty)<br>      .map((_, <span class="hljs-number">1</span>))<br>      .keyBy(<span class="hljs-number">0</span>)<br>      .sum(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment">// 4. 打印输出</span><br>    resultDataStream.print()<br><br>    <span class="hljs-comment">// 5. 启动任务执行（调用环境）</span><br>    env.execute(<span class="hljs-string">&quot;stream word count&quot;</span>) <span class="hljs-comment">//job的名字</span><br><br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>使用nc命令往电脑的7777端口发送数据，程序会接收并处理数据。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">nc -lk 7777<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210129041256.png"></p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>左边的7 4 2 4 4 表示并行的子任务个数</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>基于Apache Flink的流处理</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/127e4ef121ee.html"/>
    <url>/2022/12/127e4ef121ee.html</url>
    
    <content type="html"><![CDATA[<h1 id="主要部分"><a href="#主要部分" class="headerlink" title="主要部分"></a>主要部分</h1><h2 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h2><h3 id="1-git-commit"><a href="#1-git-commit" class="headerlink" title="1. git commit"></a>1. git commit</h3><p>Git 仓库中的提交记录保存的是你的目录下所有文件的快照，就像是把整个目录复制，然后再粘贴一样，但比复制粘贴优雅许多！</p><p>Git 希望提交记录尽可能地轻量，因此在你每次进行提交时，它并不会盲目地复制整个目录。条件允许的情况下，它会将当前版本与仓库中的上一个版本进行对比，并把所有的差异打包到一起作为一个提交记录。</p><p>Git 还保存了提交的历史记录。这也是为什么大多数提交记录的上面都有父节点的原因 —— 我们会在图示中用箭头来表示这种关系。对于项目组的成员来说，维护提交历史对大家都有好处。</p><p>关于提交记录太深入的东西咱们就不再继续探讨了，现在你可以把提交记录看作是项目的快照。提交记录非常轻量，可以快速地在这些提交记录之间切换</p><h3 id="2-git-branch"><a href="#2-git-branch" class="headerlink" title="2. git branch"></a>2. git branch</h3><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch branchName branchLocation<br></code></pre></td></tr></table></figure><p>最后一个branchLocation是可选的，如果不写默认是当前所在节点位置，若写了则是某个节点的位置。</p><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch bugWork main~1^2~1<br></code></pre></td></tr></table></figure><p>该条语句的作用是去main节点的上一个节点的第二个父节点的父节点上创建一个名为branch的分支。</p><p>Git 的分支也非常轻量。它们只是简单地指向某个提交纪录 —— 仅此而已。所以许多 Git 爱好者传颂：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">早建分支！多用分支！<br></code></pre></td></tr></table></figure><p>这是因为即使创建再多的分支也不会造成储存或内存上的开销，并且按逻辑分解工作到不同的分支要比维护那些特别臃肿的分支简单多了。</p><p>在将分支和提交记录结合起来后，我们会看到两者如何协作。现在只要记住使用分支其实就相当于在说：“我想基于这个提交以及它所有的父提交进行新的工作。”</p><p>咱们通过实际操作来看看分支是什么样子的。</p><p>接下来，我们将要创建一个到名为 <code>newImage</code> 的分支。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch newImage<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205614428.png" alt="image-20210613205614428" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205629447.png" alt="image-20210613205629447" style="zoom:50%;" /><p>看到了吗，创建分支就是这么容易！新创建的分支 <code>newImage</code> 指向的是提交记录 <code>C1</code>。</p><p>此时执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git commit<br></code></pre></td></tr></table></figure><p>结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205704756.png" alt="image-20210613205704756" style="zoom:50%;" /><p>为什么 <code>main</code> 分支前进了，但 <code>newImage</code> 分支还待在原地呢？！这是因为我们没有“在”这个新分支上，看到 <code>main</code> 分支上的那个星号（*）了吗？这表示当前所在的分支是 <code>main</code>。</p><p>此时需要引用：</p><h3 id="3-git-checkout"><a href="#3-git-checkout" class="headerlink" title="3. git checkout"></a>3. git checkout</h3><p>现在咱们告诉 Git 我们想要切换到新的分支上</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git checkout <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><br></code></pre></td></tr></table></figure><p>下面的命令会让我们在提交修改之前先切换到新的分支上</p><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout newImage<br>git commit<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205812585.png" alt="image-20210613205812585" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205826513.png" alt="image-20210613205826513" style="zoom:50%;" /><p>这就对了！我们的修改已经保存到新的分支里了。</p><h4 id="创建同时切换git-checkout-b"><a href="#创建同时切换git-checkout-b" class="headerlink" title="创建同时切换git checkout -b"></a>创建同时切换git checkout -b</h4><p>如果你想创建一个新的分支同时切换到新创建的分支的话，可以通过 <code>git checkout -b &lt;your-branch-name&gt;</code> 来实现。</p><h3 id="分支与合并"><a href="#分支与合并" class="headerlink" title="分支与合并"></a>分支与合并</h3><h4 id="1-git-merge"><a href="#1-git-merge" class="headerlink" title="1. git merge"></a>1. git merge</h4><p>在 Git 中合并两个分支时会产生一个特殊的提交记录，它有两个父节点。翻译成自然语言相当于：“我要把这两个父节点本身及它们所有的祖先都包含进来。”</p><p>我们准备了两个分支，每个分支上各有一个独有的提交。这意味着没有一个分支包含了我们修改的所有内容。咱们通过合并这两个分支来解决这个问题。</p><p>我们要把 <code>bugFix</code> 合并到 <code>main</code> 里：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git merge bugFix<br></code></pre></td></tr></table></figure><p>合并前：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613131618.png"></p><p>合并后：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613131641.png"></p><p>首先，<code>main</code> 现在指向了一个拥有两个父节点的提交记录。假如从 <code>main</code> 开始沿着箭头向上看，在到达起点的路上会经过所有的提交记录。这意味着 <code>main</code> 包含了对代码库的所有修改。</p><p>咱们再把 <code>main</code> 分支合并到 <code>bugFix</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout bugFix<br>git merge main<br></code></pre></td></tr></table></figure><h5 id="考核"><a href="#考核" class="headerlink" title="考核"></a>考核</h5><p>要想通过这一关，需要以下几步：</p><ul><li>创建新分支 <code>bugFix</code></li><li>用 <code>git checkout bugFix</code> 命令切换到该分支</li><li>提交一次</li><li>用 <code>git checkout main</code> 切换回 <code>main</code></li><li>再提交一次</li><li>用 <code>git merge</code> 把 <code>bugFix</code> 合并到 <code>main</code></li></ul><p>解答：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout -b bugFix  <span class="hljs-comment">## -b可以创建该分支并且直接使用该分支</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit  <span class="hljs-comment">## 在bugFix分区上提交一次</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout main<span class="hljs-comment">## 回到main分区</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit<span class="hljs-comment">## 在main分区上提交，此时仍然在main分区</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge bugFix<span class="hljs-comment">## 将bugFix分区和main分区合并</span></span><br></code></pre></td></tr></table></figure><h4 id="2-git-rebase"><a href="#2-git-rebase" class="headerlink" title="2. git rebase"></a>2. git rebase</h4><p>第二种合并分支的方法是 <code>git rebase</code>。Rebase 实际上就是取出一系列的提交记录，“复制”它们，然后在另外一个地方逐个的放下去。</p><p>Rebase 的优势就是可以创造更线性的提交历史，这听上去有些难以理解。如果只允许使用 Rebase 的话，代码库的提交历史将会变得异常清晰。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase<br></code></pre></td></tr></table></figure><p>使用前：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613131652.png"></p><p>使用后：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613131700.png"></p><p>现在 bugFix 分支上的工作在 main 的最顶端，同时我们也得到了一个更线性的提交序列。</p><p>注意，提交记录 C3 依然存在（树上那个半透明的节点），而 C3’ 是我们 Rebase 到 main 分支上的 C3 的副本。</p><p>现在唯一的问题就是 main 还没有更新</p><p>现在我们切换到了 <code>main</code> 上。把它 rebase 到 <code>bugFix</code> 分支上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase bugFix<br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613131710.png"></p><p>由于 <code>bugFix</code> 继承自 <code>main</code>，所以 Git 只是简单的把 <code>main</code> 分支的引用向前移动了一下而已。</p><h5 id="考核-1"><a href="#考核-1" class="headerlink" title="考核"></a>考核</h5><ul><li>新建并切换到 <code>bugFix</code> 分支</li><li>提交一次</li><li>切换回 main 分支再提交一次</li><li>再次切换到 bugFix 分支，rebase 到 main 上</li></ul><p>答案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout -b bugFix</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout main</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout bugFix</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase main</span><br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613132014.png" style="zoom:50%;" /><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase main bugFix<br></code></pre></td></tr></table></figure><p>这句代码的含义是将bugFix移动到main分支的下面</p><h2 id="高级篇"><a href="#高级篇" class="headerlink" title="高级篇"></a>高级篇</h2><h3 id="1-在提交树上移动"><a href="#1-在提交树上移动" class="headerlink" title="1. 在提交树上移动"></a>1. 在提交树上移动</h3><h4 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h4><p>我们首先看一下 “HEAD”。 HEAD 是一个对当前检出记录的符号引用 —— 也就是指向你正在其基础上进行工作的提交记录。</p><p><strong>HEAD 总是指向当前分支上最近一次提交记录</strong>。大多数修改提交树的 Git 命令都是从改变 HEAD 的指向开始的。</p><p>HEAD 通常情况下是指向分支名的（如 bugFix）。在你提交时，改变了 bugFix 的状态，这一变化通过 HEAD 变得可见。</p><h5 id="HEAD的操作"><a href="#HEAD的操作" class="headerlink" title="HEAD的操作"></a>HEAD的操作</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout C1<br>git checkout main<br>git commit<br>git checkout C2<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613145255682.png" alt="image-20210613145255682" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613145401223.png" alt="image-20210613145401223" style="zoom:50%;" /><p>看到了吗？ HEAD 指向了 <code>main</code>，随着提交向前移动。</p><p>实际这些命令并不是真的在查看 HEAD 指向，看下一屏就了解了。如果想看 HEAD 指向，可以通过 <code>cat .git/HEAD</code> 查看， 如果 HEAD 指向的是一个引用，还可以用 <code>git symbolic-ref HEAD</code> 查看它的指向。但是该程序不支持这两个命令</p><h5 id="分离的HEAD"><a href="#分离的HEAD" class="headerlink" title="分离的HEAD"></a>分离的HEAD</h5><p>分离的 HEAD 就是让其指向了某个具体的提交记录而不是分支名。</p><p><strong>命令：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout C1<br></code></pre></td></tr></table></figure><p><strong>命令执行之前：</strong></p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613145624960.png" alt="image-20210613145624960" style="zoom:50%;" /><p><code>HEAD -&gt; main -&gt; C1</code></p><p>HEAD 指向 main， main 指向 C1</p><p><strong>命令执行之后：</strong></p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613145701043.png" alt="image-20210613145701043" style="zoom:50%;" /><p><code>HEAD -&gt; C1</code></p><h5 id="考核-2"><a href="#考核-2" class="headerlink" title="考核"></a>考核</h5><p>想完成此关，从 <code>bugFix</code> 分支中分离出 HEAD 并让其指向一个提交记录。</p><p>通过哈希值指定提交记录。每个提交记录的哈希值显示在代表提交记录的圆圈中。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout C4<br></code></pre></td></tr></table></figure><h3 id="2-相对引用"><a href="#2-相对引用" class="headerlink" title="2. 相对引用"></a>2. 相对引用</h3><p>通过指定提交记录哈希值的方式在 Git 中移动不太方便。在实际应用时，并没有像本程序中这么漂亮的可视化提交树供你参考，所以你就不得不用 <code>git log</code> 来查查看提交记录的哈希值。</p><p>并且哈希值在真实的 Git 世界中也会更长（译者注：基于 SHA-1，共 40 位）。例如前一关的介绍中的提交记录的哈希值可能是 <code>fed2da64c0efc5293610bdd892f82a58e8cbc5d8</code>。舌头都快打结了吧…</p><p>比较令人欣慰的是，Git 对哈希的处理很智能。你只需要提供能够唯一标识提交记录的前几个字符即可。因此我可以仅输入<code>fed2</code> 而不是上面的一长串字符。</p><p>正如我前面所说，通过哈希值指定提交记录很不方便，所以 Git 引入了相对引用。这个就很厉害了!</p><p>使用相对引用的话，你就可以从一个易于记忆的地方（比如 <code>bugFix</code> 分支或 <code>HEAD</code>）开始计算。</p><p>相对引用非常给力，这里我介绍两个简单的用法：</p><ul><li>使用 <code>^</code> 向上移动 1 个提交记录</li><li>使用 <code>~&lt;num&gt;</code> 向上移动多个提交记录，如 <code>~3</code></li></ul><h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符(^)"></a>操作符(^)</h4><p>首先看看操作符 (^)。把这个符号加在引用名称的后面，表示让 Git 寻找指定提交记录的父提交。</p><p>所以 <code>main^</code> 相当于“<code>main</code> 的父节点”。</p><p><code>main^^</code> 是 <code>main</code> 的第二个父节点</p><p>现在咱们切换到 main 的父节点</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout main^<br></code></pre></td></tr></table></figure><p>你也可以将 <code>HEAD</code> 作为相对引用的参照。下面咱们就用 <code>HEAD</code> 在提交树中向上移动几次。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout C3<br>git checkout HEAD^<br>git checkout HEAD^<br>git checkout HEAD^<br></code></pre></td></tr></table></figure><h5 id="考核-3"><a href="#考核-3" class="headerlink" title="考核"></a>考核</h5><p>要完成此关，切换到 <code>bugFix</code> 的父节点。这会进入分离 <code>HEAD</code> 状态。</p><p>如果你愿意的话，使用哈希值也可以过关，但请尽量使用相对引用！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout C4<br></code></pre></td></tr></table></figure><h4 id="操作符-1"><a href="#操作符-1" class="headerlink" title="操作符(~)"></a>操作符(~)</h4><p>“~”操作符</p><p>如果你想在提交树中向上移动很多步的话，敲那么多 <code>^</code> 貌似也挺烦人的，Git 当然也考虑到了这一点，于是又引入了操作符 <code>~</code>。</p><p>该操作符后面可以跟一个数字（可选，不跟数字时与 <code>^</code> 相同，向上移动一次），指定向上移动多少次。咱们还是通过实际操作看一下吧</p><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout HEAD~4<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613150354658.png" alt="image-20210613150354658" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613150410.png" style="zoom:50%;" /><p>强制修改分支位置</p><p>你现在是相对引用的专家了，现在用它来做点实际事情。</p><p>我使用相对引用最多的就是移动分支。可以直接使用 <code>-f</code> 选项让分支指向另一个提交。例如:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch -f main HEAD~3<br></code></pre></td></tr></table></figure><p>上面的命令会将 main 分支强制指向 HEAD 的第 3 级父提交。</p><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613150511314.png" alt="image-20210613150511314" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613150531857.png" alt="image-20210613150531857" style="zoom:50%;" /><p>这就对了! 相对引用为我们提供了一种简洁的引用提交记录 <code>C1</code> 的方式， 而 <code>-f</code> 则容许我们将分支强制移动到那个位置。</p><h5 id="考核-4"><a href="#考核-4" class="headerlink" title="考核"></a>考核</h5><p>要完成此关，移动 <code>HEAD</code>，<code>main</code> 和 <code>bugFix</code> 到目标所示的位置。</p><p>初始位置：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613151711954.png" alt="image-20210613151711954" style="zoom: 50%;" /><p>最终位置：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613151817891.png" alt="image-20210613151817891" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f main c6</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f bugFix c0</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout c1</span><br></code></pre></td></tr></table></figure><h3 id="3-撤销变更"><a href="#3-撤销变更" class="headerlink" title="3. 撤销变更"></a>3. 撤销变更</h3><p>在 Git 里撤销变更的方法很多。和提交一样，撤销变更由底层部分（暂存区的独立文件或者片段）和上层部分（变更到底是通过哪种方式被撤销的）组成。我们这个应用主要关注的是后者。</p><p>主要有两种方法用来撤销变更 —— 一是 <code>git reset</code>，还有就是 <code>git revert</code>。接下来咱们逐个进行讲解。</p><h4 id="1-git-reset"><a href="#1-git-reset" class="headerlink" title="1. git reset"></a>1. git reset</h4><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git reset HEAD~1<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613152200852.png" alt="image-20210613152200852" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613152216391.png" alt="image-20210613152216391" style="zoom:50%;" /><p>Git 把 main 分支移回到 <code>C1</code>；现在我们的本地代码库根本就不知道有 <code>C2</code> 这个提交了。</p><p>（译者注：在reset后， <code>C2</code> 所做的变更还在，但是处于未加入暂存区状态。）</p><h4 id="2-git-revert"><a href="#2-git-revert" class="headerlink" title="2. git revert"></a>2. git revert</h4><p>虽然在你的本地分支中使用 <code>git reset</code> 很方便，但是这种“改写历史”的方法对大家一起使用的远程分支是无效的哦！</p><p>为了撤销更改并<strong>分享</strong>给别人，我们需要使用 <code>git revert</code>。来看演示：</p><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git revert HEAD<br></code></pre></td></tr></table></figure><p>执行前：</p><p>如上</p><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613152358148.png" alt="image-20210613152358148" style="zoom:50%;" /><p>奇怪！在我们要撤销的提交记录后面居然多了一个新提交！这是因为新提交记录 <code>C2&#39;</code> 引入了<strong>更改</strong> —— 这些更改刚好是用来撤销 <code>C2</code> 这个提交的。也就是说 <code>C2&#39;</code> 的状态与 <code>C1</code> 是相同的。</p><p>revert 之后就可以把你的更改推送到远程仓库与别人分享啦。</p><h4 id="考核-5"><a href="#考核-5" class="headerlink" title="考核"></a>考核</h4><p>要完成此关，分别撤销 <code>local</code> 分支和 <code>pushed</code> 分支上的最近一次提交。共需要撤销两个提交（每个分支一个）。</p><p>记住 <code>pushed</code> 是远程分支，<code>local</code> 是本地分支 —— 这么说你应该知道用分别哪种方法了吧？</p><p>初始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613152521615.png" alt="image-20210613152521615" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613152534.png" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git reset <span class="hljs-built_in">local</span>~1</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout pushed</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git revert pushed</span><br></code></pre></td></tr></table></figure><h2 id="移动提交记录"><a href="#移动提交记录" class="headerlink" title="移动提交记录"></a>移动提交记录</h2><p>到现在我们已经学习了 Git 的基础知识 —— 提交、分支以及在提交树上移动。 这些概念涵盖了 Git 90% 的功能，同样也足够满足开发者的日常需求</p><p>然而, 剩余的 10% 在处理复杂的工作流时(或者当你陷入困惑时）可能就显得尤为重要了。接下来要讨论的这个话题是“整理提交记录” —— 开发人员有时会说“我想要把这个提交放到这里, 那个提交放到刚才那个提交的后面”, 而接下来就讲的就是它的实现方式，非常清晰、灵活，还很生动。</p><p>看起来挺复杂, 其实是个很简单的概念。</p><h3 id="1-git-cherry-pick"><a href="#1-git-cherry-pick" class="headerlink" title="1. git cherry-pick"></a>1. git cherry-pick</h3><p>本系列的第一个命令是 <code>git cherry-pick</code>, 命令形式为:</p><ul><li><code>git cherry-pick &lt;提交号&gt;...</code></li></ul><p>如果你想将一些提交复制到当前所在的位置（<code>HEAD</code>）下面的话， Cherry-pick 是最直接的方式了。我个人非常喜欢 <code>cherry-pick</code>，因为它特别简单。</p><p>这里有一个仓库, 我们想将 <code>side</code> 分支上的工作复制到 <code>main</code> 分支，你立刻想到了之前学过的 <code>rebase</code> 了吧？但是咱们还是看看 <code>cherry-pick</code> 有什么本领吧。</p><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git cherry-pick C2 C4<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613203911386.png" alt="image-20210613203911386" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613203950062.png" alt="image-20210613203950062" style="zoom:50%;" /><p>这就是了！我们只需要提交记录 <code>C2</code> 和 <code>C4</code>，所以 Git 就将被它们抓过来放到当前分支下了。 就是这么简单!</p><h4 id="考核-6"><a href="#考核-6" class="headerlink" title="考核"></a>考核</h4><p>要通过此关, 只需要简单的将三个分支中的提交记录复制到 main 上就可以了。</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613204140350.png" alt="image-20210613204140350" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613204156.png" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git cherry-pick bugFix c4 another</span><br></code></pre></td></tr></table></figure><h3 id="2-交互式的rebase"><a href="#2-交互式的rebase" class="headerlink" title="2. 交互式的rebase"></a>2. 交互式的rebase</h3><p>当你知道你所需要的提交记录（<strong>并且</strong>还知道这些提交记录的哈希值）时, 用 cherry-pick 再好不过了 —— 没有比这更简单的方式了。</p><p>但是如果你不清楚你想要的提交记录的哈希值呢? 幸好 Git 帮你想到了这一点, 我们可以利用交互式的 rebase —— 如果你想从一系列的提交记录中找到想要的记录, 这就是最好的方法了</p><p>交互式 rebase 指的是使用带参数 <code>--interactive</code> 的 rebase 命令, 简写为 <code>-i</code></p><p>如果你在命令后增加了这个选项, Git 会打开一个 UI 界面并列出将要被复制到目标分支的备选提交记录，它还会显示每个提交记录的哈希值和提交说明，提交说明有助于你理解这个提交进行了哪些更改。</p><p>在实际使用时，所谓的 UI 窗口一般会在文本编辑器 —— 如 Vim —— 中打开一个文件。 考虑到课程的初衷，我弄了一个对话框来模拟这些操作。</p><h4 id="rebase-UI界面打开能做的操作"><a href="#rebase-UI界面打开能做的操作" class="headerlink" title="rebase UI界面打开能做的操作"></a>rebase UI界面打开能做的操作</h4><p>当 rebase UI界面打开时, 你能做3件事:</p><ul><li>调整提交记录的顺序（通过鼠标拖放来完成）</li><li>删除你不想要的提交（通过切换 <code>pick</code> 的状态来完成，关闭就意味着你不想要这个提交记录）</li><li>合并提交。 遗憾的是由于某种逻辑的原因，我们的课程不支持此功能，因此我不会详细介绍这个操作。简而言之，它允许你把多个提交记录合并成一个。</li></ul><p>接下来咱们看个实例</p><p>当你点击下面的按钮时，会出现一个交互对话框。对提交记录做个排序（当然你也可以删除某些提交），点击确定看结果</p><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase -i HEAD~4<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613204633183.png" alt="image-20210613204633183" style="zoom:50%;" /><p>执行后：</p><p>首先会出现UI界面：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613204724523.png" alt="image-20210613204724523" style="zoom:50%;" /><p>可以任意更改顺序，例如：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613204824214.png" alt="image-20210613204824214" style="zoom:50%;" /><p>在这里我将C3放在第一个，C4、C5、C2放在接下来的位置。</p><p>结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613204904110.png" alt="image-20210613204904110" style="zoom:50%;" /><p>结果严格按照我刚才的顺序进行复制。</p><h4 id="考核-7"><a href="#考核-7" class="headerlink" title="考核"></a>考核</h4><p>要通过本关, 做一次交互式的 rebase，整理成目标窗口中的提交顺序。</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205104703.png" alt="image-20210613205104703" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205123405.png" alt="image-20210613205123405" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase -i main~4<br></code></pre></td></tr></table></figure><p>会出现图形界面，选择：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613205320523.png" alt="image-20210613205320523" style="zoom:50%;" /><h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><h3 id="1-只取一个提交记录"><a href="#1-只取一个提交记录" class="headerlink" title="1. 只取一个提交记录"></a>1. 只取一个提交记录</h3><p>来看一个在开发中经常会遇到的情况：我正在解决某个特别棘手的 Bug，为了便于调试而在代码中添加了一些调试命令并向控制台打印了一些信息。</p><p>这些调试和打印语句都在它们各自的提交记录里。最后我终于找到了造成这个 Bug 的根本原因，解决掉以后觉得沾沾自喜！</p><p>最后就差把 <code>bugFix</code> 分支里的工作合并回 <code>main</code> 分支了。你可以选择通过 fast-forward 快速合并到 <code>main</code> 分支上，但这样的话 <code>main</code> 分支就会包含我这些调试语句了。你肯定不想这样，应该还有更好的方式……</p><p>实际我们只要让 Git 复制解决问题的那一个提交记录就可以了。跟之前我们在“整理提交记录”中学到的一样，我们可以使用</p><ul><li><code>git rebase -i</code></li><li><code>git cherry-pick</code></li></ul><p>来达到目的。</p><p>由于我们刚刚闯过类似的关卡，所以要不要再尝试一次就看你自己了。但是如果你想试一把的话，确保 <code>main</code> 分支能得到 <code>bugFix</code> 分支上的相关提交。</p><h4 id="考核-8"><a href="#考核-8" class="headerlink" title="考核"></a>考核</h4><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613223019483.png" alt="image-20210613223019483" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613223034691.png" alt="image-20210613223034691" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase -i bugFix~3<br></code></pre></td></tr></table></figure><p>选择omit C2和omit C3</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613224029595.png" alt="image-20210613224029595" style="zoom:50%;" /><p>结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613224047926.png" alt="image-20210613224047926" style="zoom:50%;" /><p>最后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch -f main bugFix<br></code></pre></td></tr></table></figure><h3 id="2-提交的技巧1"><a href="#2-提交的技巧1" class="headerlink" title="2. 提交的技巧1"></a>2. 提交的技巧1</h3><p>接下来这种情况也是很常见的：你之前在 <code>newImage</code> 分支上进行了一次提交，然后又基于它创建了 <code>caption</code> 分支，然后又提交了一次。</p><p>此时你想对某个以前的提交记录进行一些小小的调整。比如设计师想修改一下 <code>newImage</code> 中图片的分辨率，尽管那个提交记录并不是最新的了。</p><p>我们可以通过下面的方法来克服困难：</p><ul><li>先用 <code>git rebase -i</code> 将提交重新排序，然后把我们想要修改的提交记录挪到最前</li><li>然后用 <code>git commit --amend</code> 来进行一些小修改</li><li>接着再用 <code>git rebase -i</code> 来将他们调回原来的顺序</li><li>最后我们把 main 移到修改的最前端（用你自己喜欢的方法），就大功告成啦！</li></ul><p>当然完成这个任务的方法不止上面提到的一种（我知道你在看 cherry-pick 啦），之后我们会多点关注这些技巧啦，但现在暂时只专注上面这种方法。 最后有必要说明一下目标状态中的那几个<code>&#39;</code> —— 我们把这个提交移动了两次，每移动一次会产生一个 <code>&#39;</code>；而 C2 上多出来的那个是我们在使用了 amend 参数提交时产生的，所以最终结果就是这样了。</p><p>也就是说，我在对比结果的时候只会对比提交树的结构，对于 <code>&#39;</code> 的数量上的不同，并不纳入对比范围内。只要你的 <code>main</code> 分支结构与目标结构相同，我就算你通过。</p><h4 id="考核-9"><a href="#考核-9" class="headerlink" title="考核"></a>考核</h4><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613224445662.png" alt="image-20210613224445662" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613224502290.png" alt="image-20210613224502290" style="zoom:50%;" /><p>代码：</p><p>首先，执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase -i caption~3<br></code></pre></td></tr></table></figure><p>出现图形界面并调整顺序：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613224642202.png" alt="image-20210613224642202" style="zoom:50%;" /><p>接着进行修改：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git commit --amend<br></code></pre></td></tr></table></figure><p>最后再次执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase -i caption~4<br>git branch -f main caption<br></code></pre></td></tr></table></figure><p>重新更改顺序并且将main分支移动到caption位置处</p><h3 id="3-提交的技巧2"><a href="#3-提交的技巧2" class="headerlink" title="3. 提交的技巧2"></a>3. 提交的技巧2</h3><p><em>如果你还没有完成“提交的技巧 #1”（前一关）的话，请先通过以后再来！</em></p><p>正如你在上一关所见到的，我们可以使用 <code>rebase -i</code> 对提交记录进行重新排序。只要把我们想要的提交记录挪到最前端，我们就可以很轻松的用 <code>--amend</code> 修改它，然后把它们重新排成我们想要的顺序。</p><p>但这样做就唯一的问题就是要进行两次排序，而这有可能造成由 rebase 而导致的冲突。下面还是看看 <code>git cherry-pick</code> 是怎么做的吧。</p><p>要在心里牢记 cherry-pick 可以将提交树上任何地方的提交记录取过来追加到 HEAD 上（只要不是 HEAD 上游的提交就没问题）。</p><p>来看看这个例子：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613225109384.png" alt="image-20210613225109384" style="zoom:50%;" /><p>执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git cherry-pick C2<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613225145140.png" alt="image-20210613225145140" style="zoom:50%;" /><h4 id="考核-10"><a href="#考核-10" class="headerlink" title="考核"></a>考核</h4><p>这一关的目标和上一关一样，通过 <code>--amend</code> 改变提交记录 <code>C2</code>，但你不能用 <code>rebase -i</code>。自己想想要怎么解决吧！ :D</p><p>对了，提交记录上面的<code>&#39;</code>的数量并不重要，只是引用的不同而已。也就是说如果你的最终结果在某个提交记录上多了个<code>&#39;</code>，我也会算你通过的。</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613225453038.png" alt="image-20210613225453038" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613225733090.png" alt="image-20210613225733090" style="zoom:50%;" /><p>思路：我们可以首先定位到newImage这个branch，然后进行一次提交，会生成新的分支，然后将main定位到newImage上，此时main和提交之后的newImage属于同一个分支，而caption不是，再将caption使用cherry-pick重新定位回该分支即可</p><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout newImage<span class="hljs-comment">## 定位到newImage</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit --amend<span class="hljs-comment">## 提交，产生平行的一个c2</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f main newImage<span class="hljs-comment">## 将main定位到newImage上</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout main<span class="hljs-comment">## 将HEAD定位到main上</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git cherry-pick caption<span class="hljs-comment">## 将caption加入到main的分支里</span></span><br></code></pre></td></tr></table></figure><h3 id="4-git-tag"><a href="#4-git-tag" class="headerlink" title="4. git tag"></a>4. git tag</h3><p>相信通过前面课程的学习你已经发现了：分支很容易被人为移动，并且当有新的提交时，它也会移动。分支很容易被改变，大部分分支还只是临时的，并且还一直在变。</p><p>你可能会问了：有没有什么可以<em>永远</em>指向某个提交记录的标识呢，比如软件发布新的大版本，或者是修正一些重要的 Bug 或是增加了某些新特性，有没有比分支更好的可以永远指向这些提交的方法呢？</p><p>当然有了！Git 的 tag 就是干这个用的啊，它们可以（在某种程度上 —— 因为标签可以被删除后重新在另外一个位置创建同名的标签）永久地将某个特定的提交命名为里程碑，然后就可以像分支一样引用了。</p><p>更难得的是，它们并不会随着新的提交而移动。你也不能检出到某个标签上面进行修改提交，它就像是提交树上的一个锚点，标识了某个特定的位置。</p><p>咱们来看看标签到底是什么样。</p><p>咱们先建立一个标签，指向提交记录 <code>C1</code>，表示这是我们 1.0 版本。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613233617910.png" alt="image-20210613233617910" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git tag v1 C1<br></code></pre></td></tr></table></figure><p>执行之后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613233650497.png" alt="image-20210613233650497" style="zoom:50%;" /><h4 id="考核-11"><a href="#考核-11" class="headerlink" title="考核"></a>考核</h4><p>在这个关卡中，按照目标建立两个标签，然后检出到 <code>v1</code> 上面，要注意你会进到分离 <code>HEAD</code> 的状态 —— 这是因为不能直接在<code>v1</code> 上面做 commit。</p><p>在下个关卡中我们会介绍更多关于标签的有趣的应用。</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613233736967.png" alt="image-20210613233736967" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613233751.png" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag v0 C1</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git tag v1 C2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout v1</span><br></code></pre></td></tr></table></figure><h3 id="5-git-describe"><a href="#5-git-describe" class="headerlink" title="5. git describe"></a>5. git describe</h3><p>由于标签在代码库中起着“锚点”的作用，Git 还为此专门设计了一个命令用来<strong>描述</strong>离你最近的锚点（也就是标签），它就是 <code>git describe</code>！</p><p>Git Describe 能帮你在提交历史中移动了多次以后找到方向；当你用 <code>git bisect</code>（一个查找产生 Bug 的提交记录的指令）找到某个提交记录时，或者是当你坐在你那刚刚度假回来的同事的电脑前时， 可能会用到这个命令。</p><p><code>git describe</code> 的语法是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">git <span class="hljs-keyword">describe</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">ref</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p><code>&lt;ref&gt;</code> 可以是任何能被 Git 识别成提交记录的引用，如果你没有指定的话，Git 会以你目前所检出的位置（<code>HEAD</code>）。</p><p>它输出的结果是这样的：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span>&gt;</span>_<span class="hljs-tag">&lt;<span class="hljs-name">numCommits</span>&gt;</span>_g<span class="hljs-tag">&lt;<span class="hljs-name">hash</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>tag</code> 表示的是离 <code>ref</code> 最近的标签， <code>numCommits</code> 是表示这个 <code>ref</code> 与 <code>tag</code> 相差有多少个提交记录， <code>hash</code> 表示的是你所给定的 <code>ref</code> 所表示的提交记录哈希值的前几位。</p><p>当 <code>ref</code> 提交记录上有某个标签时，则只输出标签名称</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614131816054.png" alt="image-20210614131816054" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git describe main  ## describe表示main<br>git describe side  ## describe表示side<br></code></pre></td></tr></table></figure><p>输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">v1_2_gC2## main的输出<br>v2_1_gC4## side的输出<br></code></pre></td></tr></table></figure><h2 id="高级话题"><a href="#高级话题" class="headerlink" title="高级话题"></a>高级话题</h2><h3 id="1-多分支rebase"><a href="#1-多分支rebase" class="headerlink" title="1. 多分支rebase"></a>1. 多分支rebase</h3><p>哥们儿，我们准备了很多分支！咱们把这些分支 rebase 到 main 上吧。</p><h4 id="考核-12"><a href="#考核-12" class="headerlink" title="考核"></a>考核</h4><p>但是你的领导给你提了点要求 —— 他们希望得到有序的提交历史，也就是我们最终的结果应该是 <code>C6&#39;</code> 在 <code>C7&#39;</code> 上面， <code>C5&#39;</code> 在 <code>C6&#39;</code> 上面，依此类推。</p><p>即使你搞砸了也没关系，用 <code>reset</code> 命令就可以重新开始了。记得看看我们提供的答案，看你能否使用更少的命令来完成任务！</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614132319810.png" alt="image-20210614132319810" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614132333781.png" alt="image-20210614132333781" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase main bugFix</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase bugFix C5</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase HEAD side</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase side another</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f main another</span><br></code></pre></td></tr></table></figure><h3 id="2-两个父节点"><a href="#2-两个父节点" class="headerlink" title="2. 两个父节点"></a>2. 两个父节点</h3><p>操作符 <code>^</code> 与 <code>~</code> 符一样，后面也可以跟一个数字。</p><p>但是该操作符后面的数字与 <code>~</code> 后面的不同，并不是用来指定向上返回几代，而是指定合并提交记录的某个父提交。还记得前面提到过的一个合并提交有两个父提交吧，所以遇到这样的节点时该选择哪条路径就不是很清晰了。</p><p>Git 默认选择合并提交的“第一个”父提交，在操作符 <code>^</code> 后跟一个数字可以改变这一默认行为。</p><p>这里有一个合并提交记录。如果不加数字修改符直接检出 <code>main^</code>，会回到第一个父提交记录。</p><p>(<em>在我们的图示中，第一个父提交记录是指合并提交记录正上方的那个提交记录。</em>)</p><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614134400763.png" alt="image-20210614134400763" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout main^<br></code></pre></td></tr></table></figure><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614134429848.png" alt="image-20210614134429848" style="zoom:50%;" /><p>这是常规用法，现在试试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout main^2<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614134502950.png" alt="image-20210614134502950" style="zoom:50%;" /><p>我们回到了另一个父提交上。</p><h4 id="考核-13"><a href="#考核-13" class="headerlink" title="考核"></a>考核</h4><p>要完成此关，在指定的目标位置创建一个新的分支。</p><p>很明显可以简单地直接使用提交记录的哈希值（比如 <code>C6</code>），但我要求你使用刚刚讲到的相对引用修饰符！</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614135609480.png" alt="image-20210614135609480" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614135623479.png" alt="image-20210614135623479" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch bugWork main~1^2~1<br></code></pre></td></tr></table></figure><h3 id="3-纠缠不清的分支"><a href="#3-纠缠不清的分支" class="headerlink" title="3. 纠缠不清的分支"></a>3. 纠缠不清的分支</h3><p>现在我们的 <code>main</code> 分支是比 <code>one</code>、<code>two</code> 和 <code>three</code> 要多几个提交。出于某种原因，我们需要把 <code>main</code> 分支上最近的几次提交做不同的调整后，分别添加到各个的分支上。</p><p><code>one</code> 需要重新排序并删除 <code>C5</code>，<code>two</code> 仅需要重排排序，而 <code>three</code> 只需要提交一次。</p><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614135716088.png" alt="image-20210614135716088" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614135727790.png" alt="image-20210614135727790" style="zoom:50%;" /><p>代码：(我的、7条)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f one main</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout one</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase -i one~4</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f three C2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f two main</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout two</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git rebase -i two~4</span><br></code></pre></td></tr></table></figure><p>答案（5条）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout one</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git cherry-pick C4 C3 C2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout two</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git cherry-pick C5 C4 C3 C2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f three C2</span><br></code></pre></td></tr></table></figure><h1 id="远程部分"><a href="#远程部分" class="headerlink" title="远程部分"></a>远程部分</h1><h2 id="Push-amp-Pull-Git-远程仓库"><a href="#Push-amp-Pull-Git-远程仓库" class="headerlink" title="Push &amp; Pull -Git 远程仓库"></a>Push &amp; Pull -Git 远程仓库</h2><p>是时候分享你的代码了，让编码变得社交化吧</p><p>远程仓库并不复杂, 在如今的云计算盛行的世界很容易把远程仓库想象成一个富有魔力的东西, 但实际上它们只是你的仓库在另个一台计算机上的拷贝。你可以通过因特网与这台计算机通信 —— 也就是增加或是获取提交记录</p><p>话虽如此, 远程仓库却有一系列强大的特性</p><ul><li>首先也是最重要的的点, 远程仓库是一个强大的备份。本地仓库也有恢复文件到指定版本的能力, 但所有的信息都是保存在本地的。有了远程仓库以后，即使丢失了本地所有数据, 你仍可以通过远程仓库拿回你丢失的数据。</li><li>还有就是, 远程让代码社交化了! 既然你的项目被托管到别的地方了, 你的朋友可以更容易地为你的项目做贡献(或者拉取最新的变更)</li></ul><p>现在用网站来对远程仓库进行可视化操作变得越发流行了(像 <a href="https://github.com/">GitHub</a> 或 <a href="http://phabricator.org/">Phabricator</a>), 但远程仓库<strong>永远</strong>是这些工具的顶梁柱, 因此理解其概念非常的重要!</p><p>直到现在, 教程都聚焦于<strong>本地</strong>仓库的操作（branch、merge、rebase 等等）。但我们现在需要学习远程仓库的操作 —— 我们需要一个配置这种环境的命令, 它就是 <code>git clone</code>。 </p><h3 id="1-git-clone"><a href="#1-git-clone" class="headerlink" title="1. git clone"></a>1. git clone</h3><p>从技术上来讲，<code>git clone</code> 命令在真实的环境下的作用是在<strong>本地</strong>创建一个远程仓库的拷贝（比如从 github.com）。 但在我们的教程中使用这个命令会有一些不同 —— 它会在远程创建一个你本地仓库的副本。显然这和真实命令的意思刚好相反，但是它帮咱们把本地仓库和远程仓库关联到了一起，在教程中就凑合着用吧。</p><p>远程仓库（在图示中）的样子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613132540.png" style="zoom:50%;" /><p>执行后：</p><img src="/Users/heyizhi/Library/Application Support/typora-user-images/image-20210613132618606.png" alt="image-20210613132618606" style="zoom:50%;" /><p>就是它了! 现在我们有了一个自己项目的远程仓库。除了远程仓库使用虚线之外, 它们几乎没有什么差别 —— 在后面的关卡中, 你将会学习怎样在本地仓库和远程仓库间分享工作成果。</p><h3 id="2-远程分支"><a href="#2-远程分支" class="headerlink" title="2. 远程分支"></a>2. 远程分支</h3><p>既然你已经看过 <code>git clone</code> 命令了，咱们深入地看一下发生了什么。</p><p>你可能注意到的第一个事就是在我们的本地仓库多了一个名为 <code>o/main</code> 的分支, 这种类型的分支就叫<strong>远程</strong>分支。由于远程分支的特性导致其拥有一些特殊属性。</p><p>远程分支反映了远程仓库(在你上次和它通信时)的<strong>状态</strong>。这会有助于你理解本地的工作与公共工作的差别 —— 这是你与别人分享工作成果前至关重要的一步.</p><h4 id="远程分支的特别属性："><a href="#远程分支的特别属性：" class="headerlink" title="远程分支的特别属性："></a>远程分支的特别属性：</h4><p>在你检出时自动进入<strong>分离 HEAD</strong> 状态。Git 这么做是出于不能直接在这些分支上进行操作的原因, 你必须在别的地方完成你的工作, （更新了远程分支之后）再用远程分享你的工作成果。（这个在下面有图解）</p><h4 id="为什么有-o-？"><a href="#为什么有-o-？" class="headerlink" title="为什么有 o/？"></a>为什么有 <code>o/</code>？</h4><p>你可能想问这些远程分支的前面的 <code>o/</code> 是什么意思呢？好吧, 远程分支有一个命名规范 —— 它们的格式是:</p><ul><li><code>&lt;remote name&gt;/&lt;branch name&gt;</code></li></ul><p>因此，如果你看到一个名为 <code>o/main</code> 的分支，那么这个分支就叫 <code>main</code>，远程仓库的名称就是 <code>o</code>。</p><p>大多数的开发人员会将它们主要的远程仓库命名为 <code>origin</code>，并不是 <code>o</code>。这是因为当你用 <code>git clone</code> 某个仓库时，Git 已经帮你把远程仓库的名称设置为 <code>origin</code> 了</p><p>不过 <code>origin</code> 对于我们的 UI 来说太长了，因此不得不使用简写 <code>o</code> :) 但是要记住, 当你使用真正的 Git 时, 你的远程仓库默认为 <code>origin</code>!</p><h4 id="如果检出远程分支会怎么样呢？"><a href="#如果检出远程分支会怎么样呢？" class="headerlink" title="如果检出远程分支会怎么样呢？"></a>如果检出远程分支会怎么样呢？</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout o/main<br>git commit<br></code></pre></td></tr></table></figure><p>提交前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613133051.png" style="zoom:50%;" /><p>提交后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613133110.png" style="zoom:50%;" /><p>正如你所见，Git 变成了分离 HEAD 状态，当添加新的提交时 <code>o/main</code> 也不会更新。这是因为 <code>o/main</code> 只有在远程仓库中相应的分支更新了以后才会更新。</p><h4 id="考核-14"><a href="#考核-14" class="headerlink" title="考核"></a>考核</h4><p>要通过本关，在 <code>main</code> 分支上做一次提交；然后检出 <code>o/main</code>，再做一提交。这有助于你理解远程分支的不同，他们的更新只是反映了远程的状态。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout o/main</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit</span><br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613133437.png" style="zoom:50%;" /><h3 id="3-git-fetch"><a href="#3-git-fetch" class="headerlink" title="3.git fetch"></a>3.git fetch</h3><p>Git 远程仓库相当的操作实际可以归纳为两点：向远程仓库传输数据以及从远程仓库获取数据。既然我们能与远程仓库同步，那么就可以分享任何能被 Git 管理的更新（因此可以分享代码、文件、想法、情书等等）。</p><p>本节课我们将学习如何从远程仓库获取数据 —— 命令如其名，它就是 <code>git fetch</code>。</p><p>你会看到当我们从远程仓库获取数据时, 远程分支也会更新以反映最新的远程仓库。在上一节课程中我们已经提及过这一点了。</p><p>在解释 <code>git fetch</code> 前，我们先看看实例。这里我们有一个远程仓库, 它有两个我们本地仓库中没有的提交。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fetch<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613133632.png" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210613133654.png" style="zoom:50%;" /><p>就是这样了! <code>C2</code>,<code>C3</code> 被下载到了本地仓库，同时远程分支 <code>o/main</code> 也被更新，反映到了这一变化</p><h4 id="git-fetch做了什么？"><a href="#git-fetch做了什么？" class="headerlink" title="git fetch做了什么？"></a>git fetch做了什么？</h4><p><code>git fetch</code> 完成了仅有的但是很重要的两步:</p><ul><li>从远程仓库下载本地仓库中缺失的提交记录</li><li>更新远程分支指针(如 <code>o/main</code>)</li></ul><p><code>git fetch</code> 实际上将本地仓库中的远程分支更新成了远程仓库相应分支最新的状态。</p><p>如果你还记得上一节课程中我们说过的，远程分支反映了远程仓库在你<strong>最后一次与它通信时</strong>的状态，<code>git fetch</code> 就是你与远程仓库通信的方式了！希望我说的够明白了，你已经了解 <code>git fetch</code> 与远程分支之间的关系了吧。</p><p><code>git fetch</code> 通常通过互联网（使用 <code>http://</code> 或 <code>git://</code> 协议) 与远程仓库通信。</p><h4 id="git-fetch不会做的工作"><a href="#git-fetch不会做的工作" class="headerlink" title="git fetch不会做的工作"></a>git fetch不会做的工作</h4><p><code>git fetch</code> 并不会改变你本地仓库的状态。它不会更新你的 <code>main</code> 分支，也不会修改你磁盘上的文件。</p><p>理解这一点很重要，因为许多开发人员误以为执行了 <code>git fetch</code> 以后，他们本地仓库就与远程仓库同步了。它可能已经将进行这一操作所需的所有数据都下载了下来，但是<strong>并没有</strong>修改你本地的文件。我们在后面的课程中将会讲解能完成该操作的命令 <code> :D</code></p><p>所以, 你可以将 <code>git fetch</code> 的理解为单纯的下载操作。</p><h3 id="4-git-pull"><a href="#4-git-pull" class="headerlink" title="4. git pull"></a>4. git pull</h3><p>既然我们已经知道了如何用 <code>git fetch</code> 获取远程的数据, 现在我们学习如何将这些变化更新到我们的工作当中。</p><p>其实有很多方法的 —— 当远程分支中有新的提交时，你可以像合并本地分支那样来合并远程分支。也就是说就是你可以执行以下命令:</p><ul><li><code>git cherry-pick o/main</code></li><li><code>git rebase o/main</code></li><li><code>git merge o/main</code></li><li>等等</li></ul><p>实际上，由于先抓取更新再合并到本地分支这个流程很常用，因此 Git 提供了一个专门的命令来完成这两个操作。它就是我们要讲的 <code>git pull</code>。</p><h4 id="fetch、merge依次执行的效果"><a href="#fetch、merge依次执行的效果" class="headerlink" title="fetch、merge依次执行的效果"></a>fetch、merge依次执行的效果</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fetch<br>git merge o/main<br></code></pre></td></tr></table></figure><p>执行前：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613134429761.png" alt="image-20210613134429761"></p><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613134515205.png" alt="image-20210613134515205" style="zoom:50%;" /><p>我们用 <code>fetch</code> 下载了 <code>C3</code>, 然后通过 <code>git merge o/main</code> 合并了这一提交记录。现在我们的 <code>main</code> 分支包含了远程仓库中的更新（在本例中远程仓库名为 <code>origin</code>）</p><h4 id="使用git-pull的效果"><a href="#使用git-pull的效果" class="headerlink" title="使用git pull的效果"></a>使用git pull的效果</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git pull<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613134735472.png" alt="image-20210613134735472" style="zoom:50%;" /><p>同样的结果！这清楚地说明了 <code>git pull</code> 就是 git fetch 和 git merge 的缩写！</p><h3 id="5-模拟团队合作"><a href="#5-模拟团队合作" class="headerlink" title="5. 模拟团队合作"></a>5. 模拟团队合作</h3><p>这里有一件棘手的事 —— 为了接下来的课程, 我们需要先教你如何制造远程仓库的变更。</p><p>这意味着，我们需要“假装”你的同事、朋友、合作伙伴更新了远程仓库，有可能是某个特定的分支，或是几个提交记录。</p><p>为了做到这点，我们引入一个自造命令 <code>git fakeTeamwork</code>！它的名称已经说明了一切</p><p><code>fakeTeamwork</code> 默认操作就是在远程仓库的 main 分支上做一次提交。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fakeTeamwork ## 这不是一个git命令，只是为了模拟在远程产生的效果<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613135011538.png" alt="image-20210613135011538" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613135038560.png" alt="image-20210613135038560" style="zoom:50%;" /><p>完成了 —— 远程仓库增加了一个新提交，我们还没有下载它，因为我们还没有执行 <code>git fetch</code>。</p><p>还可以指定提交的分支或是数量，只需要在命令后面加上它们就可以了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fakeTeamwork foo 3<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613135141331.png" alt="image-20210613135141331" style="zoom:50%;" /><p>通过一个命令，我们就模拟队友推送了 3 个提交记录到远程仓库的 foo 分支。</p><p>接下来的关卡会相当的困难，所以在本关会让你做许多事情，先来热热身。</p><h4 id="考核-15"><a href="#考核-15" class="headerlink" title="考核"></a>考核</h4><p>克隆一个远程仓库（用 <code>git clone</code>），再在刚创建的远程仓库中模拟一些修改，然后在你自己的本地分支上做一些提交，再拉取远程仓库的变更。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613135523641.png" alt="image-20210613135523641" style="zoom:50%;" /><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span></span><br><br>local branch &quot;main&quot; set to track remote branch &quot;o/main&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git fakeTeamwork main 2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git pull</span><br></code></pre></td></tr></table></figure><h3 id="6-git-push"><a href="#6-git-push" class="headerlink" title="6. git push"></a>6. git push</h3><p>OK，我们已经学过了如何从远程仓库获取更新并合并到本地的分支当中。这非常棒……但是我如何与大家分享<strong>我的</strong>成果呢？</p><p>嗯，上传自己分享内容与下载他人的分享刚好相反，那与 <code>git pull</code> 相反的命令是什么呢？<code>git push</code>！</p><p><code>git push</code> 负责将<strong>你的</strong>变更上传到指定的远程仓库，并在远程仓库上合并你的新提交记录。一旦 <code>git push</code> 完成, 你的朋友们就可以从这个远程仓库下载你分享的成果了！</p><p>你可以将 <code>git push</code> 想象成发布你成果的命令。它有许多应用技巧，稍后我们会了解到，但是咱们还是先从基础的开始吧……</p><p><em>注意 —— <code>git push</code> 不带任何参数时的行为与 Git 的一个名为 <code>push.default</code> 的配置有关。它的默认值取决于你正使用的 Git 的版本，但是在教程中我们使用的是 <code>upstream</code>。 这没什么太大的影响，但是在你的项目中进行推送之前，最好检查一下这个配置。</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613135821575.png" alt="image-20210613135821575" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613135840775.png" alt="image-20210613135840775" style="zoom:50%;" /><p>过去了, 远程仓库接收了 <code>C2</code>，远程仓库中的 <code>main</code> 分支也被更新到指向 <code>C2</code> 了，我们的远程分支 (o&#x2F;main) 也同样被更新了。所有的分支都同步了！</p><h3 id="7-偏离的工作"><a href="#7-偏离的工作" class="headerlink" title="7. 偏离的工作"></a>7. 偏离的工作</h3><p>现在我们已经知道了如何从其它地方 <code>pull</code> 提交记录，以及如何 <code>push</code> 我们自己的变更。看起来似乎没什么难度，但是为何还会让人们如此困惑呢？</p><p>困难来自于远程库提交历史的<strong>偏离</strong>。</p><p>假设你周一克隆了一个仓库，然后开始研发某个新功能。到周五时，你新功能开发测试完毕，可以发布了。但是 —— 天啊！你的同事这周写了一堆代码，还改了许多你的功能中使用的 API，这些变动会导致你新开发的功能变得不可用。但是他们已经将那些提交推送到远程仓库了，因此你的工作就变成了基于项目<strong>旧版</strong>的代码，与远程仓库最新的代码不匹配了。</p><p>这种情况下, <code>git push</code> 就不知道该如何操作了。如果你执行 <code>git push</code>，Git 应该让远程仓库回到星期一那天的状态吗？还是直接在新代码的基础上添加你的代码，亦或由于你的提交已经过时而直接忽略你的提交？</p><p>因为这情况（历史偏离）有许多的不确定性，Git 是不会允许你 <code>push</code> 变更的。实际上它会强制你先合并远程最新的代码，然后才能分享你的工作。</p><h4 id="实际案例"><a href="#实际案例" class="headerlink" title="实际案例"></a>实际案例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push<br></code></pre></td></tr></table></figure><p>提交前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613140436373.png" alt="image-20210613140436373" style="zoom:50%;" /><p>此时远程代码和本地代码版本不同（一个c2一个c3）</p><p>提交后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613140524333.png" alt="image-20210613140524333" style="zoom:50%;" /><p>什么都没有变，因为命令失败了！<code>git push</code> 失败是因为你最新提交的 <code>C3</code> 基于远程分支中的 <code>C1</code>。而远程仓库中该分支已经更新到 <code>C2</code> 了，所以 Git 拒绝了你的推送请求。</p><h4 id="如何解决"><a href="#如何解决" class="headerlink" title="如何解决"></a>如何解决</h4><h5 id="方法1：git-rebase"><a href="#方法1：git-rebase" class="headerlink" title="方法1：git rebase"></a>方法1：git rebase</h5><p>很简单，你需要做的就是使你的工作基于最新的远程分支。</p><p>有许多方法做到这一点呢，不过最直接的方法就是通过 rebase 调整你的工作。咱们继续，看看怎么 rebase！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fetch<br>git rebase o/main<br>git push<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613140648977.png" alt="image-20210613140648977" style="zoom:50%;" /><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613140722949.png" alt="image-20210613140722949" style="zoom:50%;" /><p>我们用 <code>git fetch</code> 更新了本地仓库中的远程分支，然后用 rebase 将我们的工作移动到最新的提交记录下，最后再用 <code>git push</code> 推送到远程仓库。</p><h5 id="方法2：git-merge"><a href="#方法2：git-merge" class="headerlink" title="方法2：git merge"></a>方法2：git merge</h5><p>还有其它的方法可以在远程仓库变更了以后更新我的工作吗? 当然有，我们还可以使用 <code>merge</code></p><p>尽管 <code>git merge</code> 不会移动你的工作（它会创建新的合并提交），但是它会告诉 Git 你已经合并了远程仓库的所有变更。这是因为远程分支现在是你本地分支的祖先，也就是说你的提交已经包含了远程分支的所有变化。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git fetch<br>git merge o/main<br>git push<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613140933501.png" alt="image-20210613140933501" style="zoom:50%;" /><p>我们用 <code>git fetch</code> 更新了本地仓库中的远程分支，然后<strong>合并</strong>了新变更到我们的本地分支（为了包含远程仓库的变更），最后我们用 <code>git push</code> 把工作推送到远程仓库</p><p>很好！但是要敲那么多命令，有没有更简单一点的？</p><p>当然 —— 前面已经介绍过 <code>git pull</code> 就是 fetch 和 merge 的简写，类似的 <code>git pull --rebase</code> 就是 fetch 和 rebase 的简写！</p><h4 id="考核-16"><a href="#考核-16" class="headerlink" title="考核"></a>考核</h4><ul><li>克隆你的仓库</li><li>模拟一次远程提交（fakeTeamwork）</li><li>完成一次本地提交</li><li>用 <em>rebase</em> 发布你的工作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span></span><br><br>local branch &quot;main&quot; set to track remote branch &quot;o/main&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git fakeTeamwork</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git commit</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git pull --rebase</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push</span><br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210613144732833.png" alt="image-20210613144732833" style="zoom:50%;" /><h3 id="8-远程服务器拒绝"><a href="#8-远程服务器拒绝" class="headerlink" title="8. 远程服务器拒绝"></a>8. 远程服务器拒绝</h3><p>如果你是在一个大的合作团队中工作, 很可能是main被锁定了, 需要一些Pull Request流程来合并修改。如果你直接提交(commit)到本地main, 然后试图推送(push)修改, 你将会收到这样类似的信息:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">! [远程服务器拒绝] main -&gt; main (TF402455: 不允许推送(push)这个分支; 你必须使用pull request来更新这个分支.)<br></code></pre></td></tr></table></figure><p>远程服务器拒绝直接推送(push)提交到main, 因为策略配置要求 pull requests 来提交更新.</p><p>你应该按照流程,新建一个分支, 推送(push)这个分支并申请pull request,但是你忘记并直接提交给了main.现在你卡住并且无法推送你的更新.</p><p>新建一个分支feature, 推送到远程服务器. 然后reset你的main分支和远程服务器保持一致, 否则下次你pull并且他人的提交和你冲突的时候就会有问题.</p><h4 id="考核-17"><a href="#考核-17" class="headerlink" title="考核"></a>考核</h4><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614141122199.png" alt="image-20210614141122199" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614141136943.png" alt="image-20210614141136943" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout -b feature<span class="hljs-comment">## 在本地创建并使用feature分支</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push<span class="hljs-comment">## 将该分支push到远程仓库</span></span><br><br>local branch &quot;feature&quot; set to track remote branch &quot;o/feature&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -f main o/main<span class="hljs-comment">## 将main分支移动回o/main分支</span></span><br></code></pre></td></tr></table></figure><h2 id="origin和它的周边-Git远程仓库高级操作"><a href="#origin和它的周边-Git远程仓库高级操作" class="headerlink" title="origin和它的周边 - Git远程仓库高级操作"></a>origin和它的周边 - Git远程仓库高级操作</h2><h3 id="1-推送主分支"><a href="#1-推送主分支" class="headerlink" title="1. 推送主分支"></a>1. 推送主分支</h3><p>既然你应该很熟悉 fetch、pull、push 了，现在我们要通过一个新的工作流来测试你的这些技能。</p><p>在大型项目中开发人员通常会在（从 <code>main</code> 上分出来的）特性分支上工作，工作完成后只做一次集成。这跟前面课程的描述很相像（把 side 分支推送到远程仓库），不过本节我们会深入一些.</p><p>但是有些开发人员只在 main 上做 push、pull —— 这样的话 main 总是最新的，始终与远程分支 (o&#x2F;main) 保持一致。</p><p>对于接下来这个工作流，我们集成了两个步骤：</p><ul><li>将特性分支集成到 <code>main</code> 上</li><li>推送并更新远程分支</li></ul><h4 id="快速更新main分支并推送到远端"><a href="#快速更新main分支并推送到远端" class="headerlink" title="快速更新main分支并推送到远端"></a>快速更新main分支并推送到远端</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git pull --rebase<br>git push<br></code></pre></td></tr></table></figure><p>执行前：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614141838313.png" alt="image-20210614141838313" style="zoom:50%;" /><p>main分支比o&#x2F;main多一次提交。并且远程main分支比本机o&#x2F;mian也多一次提交。</p><p>执行后：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614141945129.png" alt="image-20210614141945129" style="zoom:50%;" /><p>我们执行了两个命令:</p><ul><li>将我们的工作 rebase 到远程分支的最新提交记录</li><li>向远程仓库推送我们的工作</li></ul><h4 id="考核-18"><a href="#考核-18" class="headerlink" title="考核"></a>考核</h4><p>这个关卡的 Boss 很厉害 —— 以下是通关提示：</p><ul><li>这里共有三个特性分支 —— <code>side1</code> <code>side2</code> 和 <code>side3</code></li><li>我需要将这三分支按顺序推送到远程仓库</li><li>因为远程仓库已经被更新过了，所以我们还要把那些工作合并过来</li></ul><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614142106202.png" alt="image-20210614142106202" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614142121124.png" alt="image-20210614142121124" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout main<span class="hljs-comment">## 首先切换到main分支</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git pull --rebase<span class="hljs-comment">## 将远端的c8拉取过来，创建一个新的支路</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git cherry-pick c2 c3 c4 c5 c6 c7<span class="hljs-comment">## 将节点按顺序放入到main之后</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push<span class="hljs-comment">## 提交到远端</span></span><br></code></pre></td></tr></table></figure><h3 id="2-使用merge"><a href="#2-使用merge" class="headerlink" title="2. 使用merge"></a>2. 使用merge</h3><p>为了 push 新变更到远程仓库，你要做的就是<strong>包含</strong>远程仓库中最新变更。意思就是只要你的本地分支包含了远程分支（如 <code>o/main</code>）中的最新变更就可以了，至于具体是用 rebase 还是 merge，并没有限制。</p><p>那么既然没有规定限制，为何前面几节都在着重于 rebase 呢？为什么在操作远程分支时不喜欢用 <code>merge</code> 呢？</p><p>在开发社区里，有许多关于 merge 与 rebase 的讨论。以下是关于 rebase 的优缺点：</p><p>优点:</p><ul><li>Rebase 使你的提交树变得很干净, 所有的提交都在一条线上</li></ul><p>缺点:</p><ul><li>Rebase 修改了提交树的历史</li></ul><p>比如, 提交 C1 可以被 rebase 到 C3 之后。这看起来 C1 中的工作是在 C3 之后进行的，但实际上是在 C3 之前。</p><p>一些开发人员喜欢保留提交历史，因此更偏爱 merge。而其他人（比如我自己）可能更喜欢干净的提交树，于是偏爱 rebase。仁者见仁，智者见智。 </p><h4 id="考核-19"><a href="#考核-19" class="headerlink" title="考核"></a>考核</h4><p>原始图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614142705802.png" alt="image-20210614142705802" style="zoom:50%;" /><p>目标图形：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614142724225.png" alt="image-20210614142724225" style="zoom:50%;" /><p>代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git checkout main</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git pull --rebase</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge side1</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge side2</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git merge side3</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
      <category>Git</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/cba0c76fab70.html"/>
    <url>/2022/12/cba0c76fab70.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、-Hive基本概念"><a href="#一、-Hive基本概念" class="headerlink" title="一、 Hive基本概念"></a>一、 Hive基本概念</h1><h2 id="1-什么是Hive"><a href="#1-什么是Hive" class="headerlink" title="1. 什么是Hive"></a>1. 什么是Hive</h2><p>Hive：由 Facebook 开源用于解决<strong>海量结构化日志</strong>的数据统计。 </p><p>Hive 是基于 Hadoop 的一个<strong>数据仓库工具</strong>，可以将结构化的数据文件映射为一张表，并提供<strong>类 SQL</strong> 查询功能。 </p><h3 id="hive的本质"><a href="#hive的本质" class="headerlink" title="hive的本质"></a>hive的本质</h3><p>将 HQL 转化成 MapReduce 程序</p><h3 id="hive的转换流程"><a href="#hive的转换流程" class="headerlink" title="hive的转换流程"></a>hive的转换流程</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210309004619.png"></p><p>1）Hive 处理的数据存储在 HDFS </p><p>2）Hive 分析数据底层的默认实现是 MapReduce </p><p>3）执行程序运行在 Yarn 上</p><p>（类似于Hadoop的客户端，因此，hive并不是以集群形式来操作，而是可以单个节点，所有的节点都可以单独进行安装和操作）</p><h2 id="2-hive的优缺点"><a href="#2-hive的优缺点" class="headerlink" title="2. hive的优缺点"></a>2. hive的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li><p>操作接口采用类 SQL 语法，提供快速开发的能力（简单、容易上手）。 </p></li><li><p>避免了去写 MapReduce，减少开发人员的学习成本。 </p></li><li><p>Hive 的执行延迟比较高，因此 Hive 常用于数据分析，对实时性要求不高的场合。 </p></li><li><p>Hive 优势在于处理大数据，对于处理小数据没有优势，因为 Hive 的执行延迟比较高。 </p></li><li><p>Hive 支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</p></li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>1．Hive的HQL表达能力有限 </p><p>（1）迭代式算法无法表达 </p><p>（2）数据挖掘方面不擅长 </p><p>2．Hive的效率比较低 </p><p>（1）Hive自动生成的MapReduce作业，通常情况下不够智能化 </p><p>（2）Hive调优比较困难，粒度较粗 </p><h2 id="3-hive架构原理"><a href="#3-hive架构原理" class="headerlink" title="3. hive架构原理"></a>3. hive架构原理</h2><h3 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407134518.png" style="zoom: 33%;" /><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h4 id="1．用户接口：Client"><a href="#1．用户接口：Client" class="headerlink" title="1．用户接口：Client"></a>1．用户接口：Client</h4><p>CLI（hive shell）、JDBC&#x2F;ODBC(java 访问 hive)、WEBUI（浏览器访问 hive） </p><h4 id="2．元数据：Metastore"><a href="#2．元数据：Metastore" class="headerlink" title="2．元数据：Metastore"></a>2．元数据：Metastore</h4><p>元数据包括：表名、表所属的数据库（默认是 default）、表的拥有者、列&#x2F;分区字段、表的类型（是否是外部表）、表的数据所在目录等； </p><p>默认存储在自带的 derby 数据库中，推荐使用 MySQL 存储 Metastore </p><h4 id="3．Hadoop"><a href="#3．Hadoop" class="headerlink" title="3．Hadoop"></a>3．Hadoop</h4><p>使用 HDFS 进行存储，使用 MapReduce 进行计算。 </p><h4 id="4．驱动器：Driver"><a href="#4．驱动器：Driver" class="headerlink" title="4．驱动器：Driver"></a>4．驱动器：Driver</h4><p>（1）解析器（SQL Parser）：将 SQL 字符串转换成抽象语法树 AST，这一步一般都用 第三方工具库完成，比如 antlr；对 AST 进行语法分析，比如表是否存在、字段是否存 在、SQL 语义是否有误。 </p><p>（2）编译器（Physical Plan）：将 AST 编译生成逻辑执行计划。 </p><p>（3）优化器（Query Optimizer）：对逻辑执行计划进行优化。 </p><p>（4）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于 Hive 来 说，就是 MR&#x2F;Spark。 </p><h3 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h3><p>Hive 通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的 Driver， 结合元数据(MetaStore)，将这些指令翻译成 MapReduce，提交到 Hadoop 中执行，最后，将 执行返回的结果输出到用户交互接口。 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407135223.png"></p><h2 id="4-hive与数据库的关系"><a href="#4-hive与数据库的关系" class="headerlink" title="4. hive与数据库的关系"></a>4. hive与数据库的关系</h2><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><p>由于 Hive 采用了类似 SQL 的查询语言 HQL(Hive Query Language) ， 因此很容易将 Hive 理解为数据库。 </p><p>其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。 </p><h4 id="hive与数据库的关系"><a href="#hive与数据库的关系" class="headerlink" title="hive与数据库的关系"></a>hive与数据库的关系</h4><p>数据库可以用在 Online 的应用中，但是 Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。 </p><ol><li><p>查询语言 </p><p>由于 SQL 被广泛的应用在数据仓库中，因此，专门针对 Hive 的特性设计了类 SQL 的查询语言 HQL。熟悉 SQL 开发的开发者可以很方便的使用 Hive 进行开发。 </p></li><li><p>数据存储位置 </p><p>Hive 是建立在 Hadoop 之上的，所有 Hive 的数据都是存储在 HDFS 中的。而数据库则可以将数据保存在块设备或者本地文件系统中。 </p></li><li><p>数据更新 </p><p>由于 Hive 是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive 中不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是 需要经常进行修改的，因此可以使用INSERT INTO … VALUES添加数据，使用UPDATE … SET 修改数据。 </p></li><li><p>索引 </p><p>Hive 在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些 Key 建立索引。Hive 要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了 Hive 不适合在线数据查询。 </p></li><li><p>执行 </p><p>Hive 中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的。而数据库通常 有自己的执行引擎。 </p></li><li><p>执行延迟 </p><p>Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个 导致 Hive 执行延迟高的因素是 MapReduce 框架。由于 MapReduce 本身具有较高的延迟， 因此在利用 MapReduce 执行 Hive 查询时，也会有较高的延迟。相对的，数据库的执行延迟 较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力 的时候，Hive 的并行计算显然能体现出优势。 </p></li><li><p>可扩展性 </p><p>由于 Hive 是建立在 Hadoop 之上的，因此 Hive 的可扩展性是和 Hadoop 的可扩展性是 一致的（世界上最大的 Hadoop 集群在 Yahoo!，2009 年的规模在 4000 台节点左右）。而数据库由于 ACID 语义的严格限制，扩展行非常有限。目前最先进的并行数据库 Oracle 在理论上的扩展能力也只有 100 台左右。 </p></li><li><p>数据规模 </p><p>由于 Hive 建立在集群上并可以利用 MapReduce 进行并行计算，因此可以支持很大规模 的数据；对应的，数据库可以支持的数据规模较小。</p></li></ol><h1 id="二、Hive安装"><a href="#二、Hive安装" class="headerlink" title="二、Hive安装"></a>二、Hive安装</h1><h2 id="1-Hive安装与配置"><a href="#1-Hive安装与配置" class="headerlink" title="1. Hive安装与配置"></a>1. Hive安装与配置</h2><h3 id="1-hive配置"><a href="#1-hive配置" class="headerlink" title="1. hive配置"></a>1. hive配置</h3><ol><li><p>把 apache-hive-1.2.1-bin.tar.gz 上传到 linux 的&#x2F;opt&#x2F;software 目录下 </p></li><li><p>解压 apache-hive-1.2.1-bin.tar.gz 到&#x2F;opt&#x2F;module&#x2F;目录下面 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /opt/module/</span> <br></code></pre></td></tr></table></figure></li><li><p>修改 apache-hive-1.2.1-bin.tar.gz 的名称为 hive </p></li><li><p>修改&#x2F;opt&#x2F;module&#x2F;hive&#x2F;conf 目录下的 hive-env.sh.template 名称为 hive-env.sh </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mv</span> hive-env.sh.template hive-env.sh</span> <br></code></pre></td></tr></table></figure></li><li><p>配置 hive-env.sh 文件 </p><p>a. 配置 HADOOP_HOME 路径 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HADOOP_HOME=/opt/module/hadoop-2.7.2 <br></code></pre></td></tr></table></figure><p>b. 配置 HIVE_CONF_DIR 路径 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export HIVE_CONF_DIR=/opt/module/hive/conf <br></code></pre></td></tr></table></figure><p>最后还可以配置&#x2F;etc&#x2F;profile文件将hive的bin加入path中。这样就可以直接使用hive指令了 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407140008.png" style="zoom:50%;" /></li></ol><h3 id="2-Hive集群配置"><a href="#2-Hive集群配置" class="headerlink" title="2. Hive集群配置"></a>2. Hive集群配置</h3><p>（1）必须启动 hdfs 和 yarn </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sbin/start-dfs.sh</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sbin/start-yarn.sh</span> <br></code></pre></td></tr></table></figure><p>（2）在 HDFS 上创建&#x2F;tmp 和&#x2F;user&#x2F;hive&#x2F;warehouse 两个目录并修改他们的同组权限可写 (可不操作，系统会自动创建) </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">mkdir</span> /tmp</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">mkdir</span> -p /user/hive/warehouse</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">chmod</span> g+w /tmp</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hadoop fs -<span class="hljs-built_in">chmod</span> g+w /user/hive/warehouse</span> <br></code></pre></td></tr></table></figure><h3 id="3-Hive基本操作"><a href="#3-Hive基本操作" class="headerlink" title="3. Hive基本操作"></a>3. Hive基本操作</h3><ol><li><p>启动 hive </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hive</span> <br></code></pre></td></tr></table></figure></li><li><p>查看数据库 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases;</span> <br></code></pre></td></tr></table></figure></li><li><p>打开默认数据库 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">use default;</span> <br></code></pre></td></tr></table></figure></li><li><p>显示 default 数据库中的表 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show tables;</span><br></code></pre></td></tr></table></figure></li><li><p>创建一张表 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">create table student(<span class="hljs-built_in">id</span> int, name string);</span> <br></code></pre></td></tr></table></figure></li><li><p>显示数据库中有几张表 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show tables;</span> <br></code></pre></td></tr></table></figure></li><li><p>查看表的结构 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc student;</span><br></code></pre></td></tr></table></figure></li><li><p>向表中插入数据 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">insert into student values(1000,<span class="hljs-string">&quot;ss&quot;</span>);</span>  <br></code></pre></td></tr></table></figure></li><li><p>查询表中数据 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">select * from student;</span> <br></code></pre></td></tr></table></figure></li><li><p>退出 hive </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">quit;</span> <br></code></pre></td></tr></table></figure></li></ol><h2 id="2-本地文件导入Hive"><a href="#2-本地文件导入Hive" class="headerlink" title="2. 本地文件导入Hive"></a>2. 本地文件导入Hive</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>将本地&#x2F;opt&#x2F;module&#x2F;data&#x2F;student.txt 这个目录下的数据导入到 hive 的 student(id int, name string)表中。 </p><h3 id="1-数据准备"><a href="#1-数据准备" class="headerlink" title="1. 数据准备"></a>1. 数据准备</h3><p>在&#x2F;opt&#x2F;module&#x2F;data 这个目录下准备数据 </p><p>（1）在&#x2F;opt&#x2F;module&#x2F;目录下创建 data </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> data</span><br></code></pre></td></tr></table></figure><p>（2）在&#x2F;opt&#x2F;module&#x2F;datas&#x2F;目录下创建 student.txt 文件并添加数据 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> student.txt</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">vi student.txt</span> <br>1001 zhangshan <br>1002 lishi <br>1003 zhaoliu <br></code></pre></td></tr></table></figure><h3 id="2-hive实际操作"><a href="#2-hive实际操作" class="headerlink" title="2. hive实际操作"></a>2. hive实际操作</h3><ol><li>启动 hive<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hive</span><br></code></pre></td></tr></table></figure></li><li>显示数据库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases;</span><br></code></pre></td></tr></table></figure></li><li>使用 default 数据库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">use default;</span><br></code></pre></td></tr></table></figure></li><li>显示 default 数据库中的表<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show tables;</span><br></code></pre></td></tr></table></figure></li><li>删除已创建的 student 表<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop table student;</span><br></code></pre></td></tr></table></figure></li><li>创建 student 表, 并声明文件分隔符’\t’<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">create</span><br>table<br>student(id int,<br>name<br>string)<br>ROW<br>FORMAT<br>DELIMITED FIELDS TERMINATED<br>BY &#x27;\t&#x27;;<br></code></pre></td></tr></table></figure></li><li>加载&#x2F;opt&#x2F;module&#x2F;data&#x2F;student.txt 文件到 student 数据库表中。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">load data <span class="hljs-built_in">local</span> inpath <span class="hljs-string">&#x27;/opt/module/data/student.txt&#x27;</span> into table student;</span><br></code></pre></td></tr></table></figure></li><li>Hive 查询结果<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">select * from student;</span><br>OK<br>1001 zhangshan<br>1002 lishi<br>1003 zhaoliu<br>Time taken: 0.266 seconds, Fetched: 3 row(s)<br></code></pre></td></tr></table></figure></li></ol><h3 id="3-遇到的问题"><a href="#3-遇到的问题" class="headerlink" title="3. 遇到的问题"></a>3. 遇到的问题</h3><p>再打开一个客户端窗口启动 hive，会产生 java.sql.SQLException 异常。 </p><h3 id="load的本质"><a href="#load的本质" class="headerlink" title="load的本质"></a>load的本质</h3><p>load的本质其实就是put，load将本地文件或者hdfs上的文件当如对应的数据库存储位置。如果直接将其余文件直接放入该位置，那么select时也会出现其余文件的数据。 </p><h4 id="并且值得注意的是"><a href="#并且值得注意的是" class="headerlink" title="并且值得注意的是"></a>并且值得注意的是</h4><p>如果是本地操作，那么load就会将数据复制一份到对应的目录下面，如果是hdfs上的操作，那么load相当于剪切一份到对应的目录下面。 </p><h4 id="对于hdfs上面的操作"><a href="#对于hdfs上面的操作" class="headerlink" title="对于hdfs上面的操作"></a>对于hdfs上面的操作</h4><p>load其实只需要更改元数据上面的内容即可，并不是真的需要将文件进行搬移，因为真实的文件都放在服务器的$HADOOP_HOME&#x2F;data&#x2F;tmp&#x2F;……里面，只需要更改元数据上面的指向就可以将文件在hdfs的目录上进行剪切。 </p><h2 id="3-mysql安装"><a href="#3-mysql安装" class="headerlink" title="3. mysql安装"></a>3. mysql安装</h2><h3 id="1-安装包准备"><a href="#1-安装包准备" class="headerlink" title="1. 安装包准备"></a>1. 安装包准备</h3><p>1．查看 mysql 是否安装，如果安装了，卸载 mysql </p><p>​a. 查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rpm -qa|grep mysql</span> <br>mysql-libs-5.1.73-7.el6.x86_64 <br></code></pre></td></tr></table></figure><p>​b. 卸载 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rpm -e --nodeps mysql-libs-5.1.73-7.el6.x86_64</span> <br></code></pre></td></tr></table></figure><p>2．解压 mysql-libs.zip 文件到当前目录 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 software]# unzip mysql-libs.zip <br>[root@hadoop102 software]# ls <br>mysql-libs.zip <br>mysql-libs <br></code></pre></td></tr></table></figure><p>3．进入到 mysql-libs 文件夹下 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# ll<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407141448.png" style="zoom:50%;" /><h3 id="2-安装mysql服务器"><a href="#2-安装mysql服务器" class="headerlink" title="2. 安装mysql服务器"></a>2. 安装mysql服务器</h3><ol><li><p>安装mysql服务端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# rpm -ivh MySQL.xx.rpm<br></code></pre></td></tr></table></figure></li><li><p>查看产生的随机密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# cat /root/.mysql_secret<br>xxxxxxx<br></code></pre></td></tr></table></figure></li><li><p>查看mysql状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# service mysql status<br></code></pre></td></tr></table></figure></li><li><p>启动mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# service mysql start<br></code></pre></td></tr></table></figure></li></ol><h3 id="3-安装MySQL客户端"><a href="#3-安装MySQL客户端" class="headerlink" title="3. 安装MySQL客户端"></a>3. 安装MySQL客户端</h3><ol><li><p>安装mysql客户端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# rpm -ivh mysql.xx.rpm<br></code></pre></td></tr></table></figure></li><li><p>链接mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# mysql -uroot -pxxxxxx<br></code></pre></td></tr></table></figure></li><li><p>修改密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt;</span><span class="language-bash">SET PASSWORD(<span class="hljs-string">&#x27;000000&#x27;</span>);</span><br></code></pre></td></tr></table></figure></li><li><p>退出mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt;</span><span class="language-bash"><span class="hljs-built_in">exit</span></span><br></code></pre></td></tr></table></figure></li></ol><h3 id="4-MySQL中user表中主机配置"><a href="#4-MySQL中user表中主机配置" class="headerlink" title="4. MySQL中user表中主机配置"></a>4. MySQL中user表中主机配置</h3><h4 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h4><p>配置只要是root用户名+密码，在任何主机上都能登录MySQL数据库</p><ol><li><p>进入mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# mysql -uroot -p000000<br></code></pre></td></tr></table></figure></li><li><p>显示数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span><br></code></pre></td></tr></table></figure></li><li><p>使用mysql数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">use mysql;</span><br></code></pre></td></tr></table></figure></li><li><p>展示mysql表中的所有表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt;</span><span class="language-bash">show tables;</span><br></code></pre></td></tr></table></figure></li><li><p>展示user表的结构</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">desc user;</span><br></code></pre></td></tr></table></figure></li><li><p>查询user表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">select User, Host, Password from user;</span><br></code></pre></td></tr></table></figure></li><li><p>修改user表，把Host表内容修改为%</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">update user <span class="hljs-built_in">set</span> host=<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-built_in">where</span> host=<span class="hljs-string">&#x27;localhost&#x27;</span></span><br></code></pre></td></tr></table></figure></li><li><p>删除root用户的其他host</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">delete from user where Host=&#x27;hadoop102&#x27;;<br>delete from user where Host=&#x27;127.0.0.1&#x27;;<br>delete from suer where Host=&#x27;::1&#x27;;<br></code></pre></td></tr></table></figure></li><li><p>刷新</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges</span><br></code></pre></td></tr></table></figure></li><li><p>退出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">quit;</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="5-Hive元数据配置到Mysql"><a href="#5-Hive元数据配置到Mysql" class="headerlink" title="5. Hive元数据配置到Mysql"></a>5. Hive元数据配置到Mysql</h2><h3 id="1-驱动拷贝"><a href="#1-驱动拷贝" class="headerlink" title="1. 驱动拷贝"></a>1. 驱动拷贝</h3><ol><li><p>在<code>/opt/software/mysql-libs</code>目录下解压<code>mysql-connector-java-5.1.27.tar.gz</code>驱动包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# tar -zxvf mysql-xxx.tar.gz<br></code></pre></td></tr></table></figure></li><li><p>拷贝<code>mysql-connector-java-5.1.27-bin.jar</code>到<code>/opt/module/hive/lib</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# cp /opt/software/mysql-libs/mysql-connector-xxx /opt/module/hive/lib/<br></code></pre></td></tr></table></figure></li></ol><h3 id="2-配置MetaStore到Mysql"><a href="#2-配置MetaStore到Mysql" class="headerlink" title="2. 配置MetaStore到Mysql"></a>2. 配置MetaStore到Mysql</h3><ol><li><p>在<code>/opt/module/hive/conf</code>目录下创建一个<code>hive-site.xml</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop102 mysql-libs]# touch hive-site.xml<br>[root@hadoop102 mysql-libs]# vim hive-site.xml<br></code></pre></td></tr></table></figure></li><li><p>根据官方文档配置参数，拷贝数据到<code>hive-site.xml</code></p></li></ol><img src=https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143038.png height=500>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;?xml-stylesheet type=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;configuration.xsl&quot;</span>?&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>jdbc:mysql://9.135.220.213:3306/metastore?createDatabaseIfNotExist=true<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span> <br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>username to use against metastore database<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>JxZah*7428Cp<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>password to use against metastore database<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span> <br></code></pre></td></tr></table></figure><ol start="3"><li>配置完毕后，如果启动hive异常，可以重新启动虚拟机。</li></ol><h3 id="3-创建数据库以及对应目录"><a href="#3-创建数据库以及对应目录" class="headerlink" title="3. 创建数据库以及对应目录"></a>3. 创建数据库以及对应目录</h3><p>首先创建一个表aa</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143151.png" style="zoom:50%;" /><p>可以看到，创建表aa之后，会出现在hdfs上的<code>/user/hive/warehouse</code>目录中，对应一条对应的记录。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143220.png" style="zoom:50%;" /><p>并且可以看到，在mysql的metastore数据库中，查询表DBS，可以看到有一条记录，这条记录就是hive默认的default数据库，每创建一个数据库都会对应生成一条数据，如下所示： </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143325.png"></p><p>![image-20210407143358869](&#x2F;Users&#x2F;coachhe&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210407143358869.png)</p><h2 id="6-Hive-JDBC访问"><a href="#6-Hive-JDBC访问" class="headerlink" title="6. Hive JDBC访问"></a>6. Hive JDBC访问</h2><p>基本用不到，在这里就不介绍了</p><h2 id="7-Hive常用交互命令"><a href="#7-Hive常用交互命令" class="headerlink" title="7. Hive常用交互命令"></a>7. Hive常用交互命令</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>有时候需要使用脚本去使用hive语句，因此需要学习交互命令。 </p><h3 id="2-从命令行执行hive"><a href="#2-从命令行执行hive" class="headerlink" title="2. 从命令行执行hive"></a>2. 从命令行执行hive</h3><p>语法 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive -e &quot;hql&quot; <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143628.png" style="zoom: 33%;" /><h3 id="3-从脚本执行hive"><a href="#3-从脚本执行hive" class="headerlink" title="3. 从脚本执行hive"></a>3. 从脚本执行hive</h3><p>语法 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive -f filename <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407143643.png" style="zoom: 33%;" /><h2 id="8-Hive常用属性配置"><a href="#8-Hive常用属性配置" class="headerlink" title="8. Hive常用属性配置"></a>8. Hive常用属性配置</h2><h3 id="1-Hive数据仓库位置配置"><a href="#1-Hive数据仓库位置配置" class="headerlink" title="1. Hive数据仓库位置配置"></a>1. Hive数据仓库位置配置</h3><ol><li><p>Default 数据仓库的最原始位置是在 hdfs 上的：&#x2F;user&#x2F;hive&#x2F;warehouse 路径下。  </p></li><li><p>在仓库目录下，没有对默认的数据库 default 创建文件夹。如果某张表属于 default 数据库，直接在数据仓库目录下创建一个文件夹。</p><img src="/Users/coachhe/Library/Application Support/typora-user-images/image-20210407144028852.png" alt="image-20210407144028852" style="zoom: 50%;" /></li><li><p>修改 default 数据仓库原始位置（将 hive-default.xml.template 如下配置信息拷贝到 hive-site.xml 文件中）。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144103.png" style="zoom:50%;" /></li><li><p>配置同组用户有执行权限 </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/hdfs dfs -chmod g+w /user/hive/warehouse <br></code></pre></td></tr></table></figure></li></ol><h3 id="2-查询后信息显示配置"><a href="#2-查询后信息显示配置" class="headerlink" title="2. 查询后信息显示配置"></a>2. 查询后信息显示配置</h3><ol><li><p>在 hive-site.xml 文件中添加如下配置信息，就可以实现显示当前数据库，以及查询表的头信息配置。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144220.png" style="zoom:50%;" /></li><li><p>重启hive，看情况</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144250.png" style="zoom:50%;" /></li></ol><h3 id="3-Hive运行日志信息配置"><a href="#3-Hive运行日志信息配置" class="headerlink" title="3. Hive运行日志信息配置"></a>3. Hive运行日志信息配置</h3><ol><li><p>Hive 的 log 默认存放在&#x2F;tmp&#x2F;coachhe&#x2F;hive.log 目录下（当前用户名下）</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144650.png" style="zoom:50%;" /></li><li><p>修改hive 的 log 存放日志到&#x2F;opt&#x2F;module&#x2F;hive&#x2F;logs </p><p>（1）修改<code>/opt/module/hive/conf/hive-log4j.properties.template </code>文件名称为 <code>hive-log4j.properties </code></p><p>（2）在<code>hive-log4j.properties</code>文件中修改 log 存放位置 <code>hive.log.dir=/opt/module/hive/logs </code></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144743.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407144755.png" style="zoom:50%;" /></li></ol><h3 id="4-参数配置方式"><a href="#4-参数配置方式" class="headerlink" title="4. 参数配置方式"></a>4. 参数配置方式</h3><p>1．查看当前所有的配置信息 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt;</span><span class="language-bash"><span class="hljs-built_in">set</span>;</span> <br></code></pre></td></tr></table></figure><p>2．参数的配置三种方式 </p><p>（1）配置文件方式 </p><p>默认配置文件：<code>hive-default.xml </code></p><p>用户自定义配置文件：<code>hive-site.xml </code></p><p>注意： </p><p>用户自定义配置会覆盖默认配置。另外，Hive 也会读入 Hadoop 的配置，因 为 Hive 是作为 Hadoop 的客户端启动的，Hive 的配置会覆盖 Hadoop 的配置。配置文件 的设定对本机启动的所有 Hive 进程都有效。 </p><p>（2）命令行参数方式 启动 Hive 时，可以在命令行添加-hiveconf param&#x3D;value 来设定参数。 </p><p>例如： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/hive -hiveconf mapred.reduce.tasks=10;</span> <br></code></pre></td></tr></table></figure><p>注意：仅对本次 hive 启动有效 查看参数设置： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; set mapred.reduce.tasks; <br></code></pre></td></tr></table></figure><p>（3）参数声明方式 </p><p>可以在 HQL 中使用 SET 关键字设定参数 </p><p>例如： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; set mapred.reduce.tasks=100; <br></code></pre></td></tr></table></figure><p>注意：仅对本次 hive 启动有效。 </p><p>查看参数设置 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; set mapred.reduce.tasks; <br></code></pre></td></tr></table></figure><p>上述三种设定方式的优先级依次递增。即配置文件&lt;命令行参数&lt;参数声明。注意某些 系统级的参数，例如 log4j 相关的设定，必须用前两种方式设定，因为那些参数的读取在会 话建立以前已经完成了。 </p><h1 id="三、Hive数据类型"><a href="#三、Hive数据类型" class="headerlink" title="三、Hive数据类型"></a>三、Hive数据类型</h1><h2 id="1-基本数据类型"><a href="#1-基本数据类型" class="headerlink" title="1. 基本数据类型"></a>1. 基本数据类型</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407145132.png" style="zoom:50%;" /><p>对于 Hive 的 String 类型相当于数据库的 varchar 类型，该类型是一个可变的字符串，不过它不能声明其中最多能存储多少个字符，理论上它可以存储 2GB 的字符数。</p><h2 id="2-集合数据类型"><a href="#2-集合数据类型" class="headerlink" title="2. 集合数据类型"></a>2. 集合数据类型</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>Hive有三种复杂数据类型 ARRAY、MAP 和 STRUCT。ARRAY 和 MAP 与 Java 中的 Array 和 Map 类似，而 STRUCT 与 C 语言中的 Struct 类似，它封装了一个命名字段集合， 复杂数据类型允许任意层次的嵌套。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407145236.png" style="zoom:50%;" /><h2 id="3-类型转换"><a href="#3-类型转换" class="headerlink" title="3. 类型转换"></a>3. 类型转换</h2><h3 id="隐式类型转换"><a href="#隐式类型转换" class="headerlink" title="隐式类型转换"></a>隐式类型转换</h3><p>（1）任何整数类型都可以隐式地转换为一个范围更广的类型，如 TINYINT 可以转换成 INT，INT 可以转换成 BIGINT。 </p><p>（2）所有整数类型、FLOAT 和 STRING 类型都可以隐式地转换成 DOUBLE。 </p><p>（3）TINYINT、SMALLINT、INT 都可以转换为 FLOAT。 </p><p>（4）BOOLEAN 类型不可以转换为任何其它的类型。 </p><h3 id="用CAST操作显示进行数据类型转换"><a href="#用CAST操作显示进行数据类型转换" class="headerlink" title="用CAST操作显示进行数据类型转换"></a>用CAST操作显示进行数据类型转换</h3><p>例如 CAST(‘1’ AS INT)将把字符串’1’ 转换成整数 1；如果强制类型转换失败，如执行 CAST(‘X’ AS INT)，表达式返回空值 NULL。 </p><h1 id="四、HiveDDL"><a href="#四、HiveDDL" class="headerlink" title="四、HiveDDL"></a>四、HiveDDL</h1><h2 id="1-DDL和DML定义"><a href="#1-DDL和DML定义" class="headerlink" title="1. DDL和DML定义"></a>1. DDL和DML定义</h2><h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><p>（baiData Definition Language 数据定义语言） </p><p>数据定义语言 </p><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>用于定义和管理 SQL 数据库中的所有对象的语言 </p><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">create table 创建表      <br>alter table  修改表    <br>drop table 删除表    <br>truncate table 删除表中所有行dao      <br>create index 创建索引    <br>drop index  删除索引 <br></code></pre></td></tr></table></figure><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol><li>当执行DDL语句时，在每一条语句前后，oracle都将提交当前的事务。 </li><li>如果用户使用insert命令将记录插入到数据库后，执行了一条DDL语句(如create table)，此时来自insert命令的数据将被提交到数据库。 </li><li>当DDL语句执行完成时，DDL语句会被自动提交，不能回滚。</li></ol><p>  </p><h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3><p>（Data Manipulation Language 数据操作语言）  </p><p>数据操作语言 </p><h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>用来直接对数据进行操作 </p><h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">insert 将记录插入到数据库  <br>update 修改数据库的记录  <br>delete 删除数据库的记录 <br></code></pre></td></tr></table></figure><h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><ol><li>当执行DML命令如果没有提交，将不会被其他会话看到。 </li><li>除非在DML命令之后执行了DDL命令或DCL命令，或用户退出会话，或终止实例，此时系统会自动发出commit命令，使未提交的DML命令提交。</li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>DML是SELECT、UPDATE、INSERT、DELETE，就象它的名字一样，这4条命令是用来对数据库里的数据进行操作的语言。  </p><p>DDL比DML要多，主要的命令有CREATE、ALTER、DROP等，DDL主要是用在定义或改变表（TABLE）的结构，数据类型，表之间的链接和约束等初始化工作上，他们大多在建立表时使用。 </p><h2 id="2-创建数据库"><a href="#2-创建数据库" class="headerlink" title="2. 创建数据库"></a>2. 创建数据库</h2><p>1）创建一个数据库，数据库在 HDFS 上的默认存储路径是&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;*.db。  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; create database db_hive;  <br></code></pre></td></tr></table></figure><p>2）避免要创建的数据库已经存在错误，增加 if not exists 判断。（标准写法）  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; create database db_hive;  <br>FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. Database db_hive already exists <br>hive (default)&gt; create database if not exisis db_hive;  <br></code></pre></td></tr></table></figure><p>3）创建一个数据库，指定数据库在 HDFS 上存放的位置 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; create database db_hive2 location &#x27;/db_hive2.db&#x27;; <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212512.png"></p><h2 id="3-查询数据库"><a href="#3-查询数据库" class="headerlink" title="3. 查询数据库"></a>3. 查询数据库</h2><h3 id="1-显示数据库"><a href="#1-显示数据库" class="headerlink" title="1. 显示数据库"></a>1. 显示数据库</h3><h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases;</span> <br></code></pre></td></tr></table></figure><h3 id="2-过滤显示查询的数据库"><a href="#2-过滤显示查询的数据库" class="headerlink" title="2. 过滤显示查询的数据库"></a>2. 过滤显示查询的数据库</h3><p>语法 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">show databases like <span class="hljs-string">&#x27;db_hive*&#x27;</span>;</span> <br>OK <br>db_hive <br>db_hive_1 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212707.png" style="zoom:50%;" /><h3 id="3-查看数据库详情"><a href="#3-查看数据库详情" class="headerlink" title="3. 查看数据库详情"></a>3. 查看数据库详情</h3><h4 id="1．显示数据库信息"><a href="#1．显示数据库信息" class="headerlink" title="1．显示数据库信息"></a>1．显示数据库信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc database db_hive;</span> <br>OK<br>db_hive <br>hdfs://hadoop102:9000/user/hive/warehouse/db_hive.db <br>atguiguUSER  <br></code></pre></td></tr></table></figure><h4 id="2．显示数据库详细信息，extended"><a href="#2．显示数据库详细信息，extended" class="headerlink" title="2．显示数据库详细信息，extended"></a>2．显示数据库详细信息，extended</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc database extended db_hive;</span> <br>OK <br>db_hive <br>hdfs://hadoop102:9000/user/hive/warehouse/db_hive.db atguiguUSER <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407212843.png" style="zoom:50%;" /><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>在这里用两种查询方式没有区别，因为我们没有经过相应的操作，如果修改数据库之后再进行操作就会有区别了。在后面的修改数据库会给出。 </p><h3 id="4-切断当前数据库"><a href="#4-切断当前数据库" class="headerlink" title="4. 切断当前数据库"></a>4. 切断当前数据库</h3><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">hive (<span class="hljs-keyword">default</span>)&gt; <span class="hljs-keyword">use</span> db_hive; <br></code></pre></td></tr></table></figure><h2 id="4-修改数据库"><a href="#4-修改数据库" class="headerlink" title="4. 修改数据库"></a>4. 修改数据库</h2><p>用户可以使用 ALTER DATABASE 命令为某个数据库的 DBPROPERTIES 设置键-值对 属性值，来描述这个数据库的属性信息。数据库的其他元数据信息都是不可更改的，包括数据库名和数据库所在的目录位置。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default)&gt; alter database hive set dbproperties(&#x27;createtime&#x27;=&#x27;20170830&#x27;); <br></code></pre></td></tr></table></figure><p>在 hive 中查看修改结果 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc database extended db_hive;</span> <br>db_name comment location owner_name owner_type parameters db_hive hdfs://hadoop102:8020/user/hive/warehouse/db_hive.db atguigu USER &#123;createtime=20170830&#125; <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213026.png" style="zoom:50%;" /><h2 id="5-删除数据库"><a href="#5-删除数据库" class="headerlink" title="5. 删除数据库"></a>5. 删除数据库</h2><h3 id="1-删除空数据库"><a href="#1-删除空数据库" class="headerlink" title="1. 删除空数据库"></a>1. 删除空数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt;</span><span class="language-bash">drop database db_hive2;</span> <br></code></pre></td></tr></table></figure><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>这里只能删除空的数据库，不能删除有内容的数据库。 </p><h3 id="2-如果删除的数据库不存在"><a href="#2-如果删除的数据库不存在" class="headerlink" title="2. 如果删除的数据库不存在"></a>2. 如果删除的数据库不存在</h3><p>最好采用 if exists 判断数据库是否存在 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database db_hive;</span> <br>FAILED: SemanticException [Error 10072]: Database does not exist: db_hive <br><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database <span class="hljs-keyword">if</span> exists db_hive2;</span> <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213204.png" style="zoom:50%;" /><h3 id="3-如果删除的数据库不为空（不推荐）"><a href="#3-如果删除的数据库不为空（不推荐）" class="headerlink" title="3. 如果删除的数据库不为空（不推荐）"></a>3. 如果删除的数据库不为空（不推荐）</h3><p>可以采用 cascade 命令，强制删除 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database db_hive;</span> <br>FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. InvalidOperationException(message:Database db_hive is not empty. One or more tables exist.) <br><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">drop database db_hive cascade;</span> <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213251.png" style="zoom:50%;" /><h2 id="6-创建表"><a href="#6-创建表" class="headerlink" title="6. 创建表"></a>6. 创建表</h2><h3 id="1-简介-1"><a href="#1-简介-1" class="headerlink" title="1. 简介"></a>1. 简介</h3><h4 id="建表语法"><a href="#建表语法" class="headerlink" title="建表语法"></a>建表语法</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407213353.png" style="zoom:50%;" /><p>[]表示可选字段。 </p><p>解释 </p><ol><li><p><code>CREATE TABLE</code></p><p>创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用 IF NOT EXISTS 选项来忽略这个异常。 </p></li><li><p><code>EXTERNAL 关键字 </code></p><p>可以让用户创建一个外部表，在建表的同时指定一个指向实际 数据的路径（LOCATION），Hive 创建内部表时，会将数据移动到数据仓库指向的路 径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的 时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。 </p></li><li><p><code>COMMENT</code>： </p><p>为表和列添加注释。 </p></li><li><p><code>PARTITIONED BY </code></p><p>创建分区表 </p></li><li><p><code>CLUSTERED BY </code></p><p>创建分桶表 </p></li><li><p><code>SORTED BY </code></p><p>不常用 </p></li><li><p><code>ROW FORMAT</code> </p><p>默认为SerDe，是Serialize&#x2F;Deserilize的简称，目的是用于序列化和反序列化。 </p></li><li><p><code>STORED AS </code></p><p>指定存储文件类型 常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、 RCFILE（列式存储格式文件） 如果文件数据是纯文本，可以使用 STORED AS TEXTFILE。如果数据需要压缩， 使用 STORED AS SEQUENCEFILE。 </p></li><li><p><code>LOCATION </code></p><p>指定表在 HDFS 上的存储位置。 </p></li><li><p><code>LIKE </code></p><p>允许用户复制现有的表结构，但是不复制数据。</p></li></ol><h4 id="查看完整建表语句"><a href="#查看完整建表语句" class="headerlink" title="查看完整建表语句"></a>查看完整建表语句</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default) &gt; show create table table_name; <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408092400.png" style="zoom:50%;" /><h3 id="2-管理表（内部表）"><a href="#2-管理表（内部表）" class="headerlink" title="2. 管理表（内部表）"></a>2. 管理表（内部表）</h3><h4 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h4><p>默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或少地）控制着数据的生命周期。 </p><p>Hive 默认情况下会将这些表的数据存储 在由配置项 <code>hive.metastore.warehouse.dir</code>(例如，<code>/user/hive/warehouse</code>)所定义的目录的子目录下。 当我们删除一个管理表时，Hive 也会删除这个表中数据。管理表不适合和其他工具共享数据。 </p><h3 id="3-外部表"><a href="#3-外部表" class="headerlink" title="3. 外部表"></a>3. 外部表</h3><p>假设我们正在分析来自股票市场的数据。我们会定期从像Infochimps(<a href="http://infochimps.com/datasets)%E8%BF%99%E6%A0%B7%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90%E6%8E%A5%E5%85%A5%E5%85%B3%E4%BA%8ENASDAQ%E5%92%8CNYSE%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BD%BF%E7%94%A8%E5%BE%88%E5%A4%9A%E5%B7%A5%E5%85%B7%E6%9D%A5%E5%88%86%E6%9E%90%E8%BF%99%E4%BB%BD%E6%95%B0%E6%8D%AE%E3%80%82">http://infochimps.com/datasets)这样的数据源接入关于NASDAQ和NYSE的数据，然后使用很多工具来分析这份数据。</a> </p><p>我们假设这些数据文件位于分布式文件系统的<code>/data/stocks</code>目录下。</p><p>下面的语句将创建一个外部表，其可以读取所有位于<code>/data/stocks</code>目录下的以逗号分隔的数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTERNAL</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> stocks (<br>exchange STRING,<br>symbol   STRING,<br>  ...<br>)<br><span class="hljs-type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;,&#x27;</span><br>LOCATION <span class="hljs-string">&#x27;/data/stocks&#x27;</span>;<br></code></pre></td></tr></table></figure><p>关键字EXTERNAL告诉你这个表是外部的，而后面的LOCATION字句则用于告诉你Hive数据库位于哪个路径下。</p><p>因为表示外部的，所以Hive并非认为其完全拥有这份数据。因此，删除该表并不会删除这份数据，不过描述表的元数据信息则会被完全删除。</p><h3 id="4-内外部表的关系"><a href="#4-内外部表的关系" class="headerlink" title="4. 内外部表的关系"></a>4. 内外部表的关系</h3><h4 id="内外部表的相互转换"><a href="#内外部表的相互转换" class="headerlink" title="内外部表的相互转换"></a>内外部表的相互转换</h4><ol><li><p>查询表的类型</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; desc formatted student2;<br>Table Type:     MANAGED_TABLE<br></code></pre></td></tr></table></figure></li><li><p>修改内部表student2为外部表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">alter table student2 set tdlproperties(&#x27;EXTERNAL&#x27;=&#x27;TRUE&#x27;);<br></code></pre></td></tr></table></figure></li><li><p>查询表的类型</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; desc formatted student2;<br>Table Type:     EXTERNAL_TABLE<br></code></pre></td></tr></table></figure></li><li><p>修改外部表student2为内部表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">alter table student2 set tdlproperties(&#x27;EXTERNAL&#x27;=&#x27;FALSE&#x27;);<br></code></pre></td></tr></table></figure></li><li><p>查询表的类型</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; desc formatted student2;<br>Table Type:     MANAGED_TABLE<br></code></pre></td></tr></table></figure></li></ol><h4 id="内外部表的核心区别"><a href="#内外部表的核心区别" class="headerlink" title="内外部表的核心区别"></a>内外部表的核心区别</h4><p>对于内部表和外部表，核心区别在于删除时是否会把实际数据一起删除。 </p><p>对于内部表，认为数据是自己的，删除时一起删除了：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094702.png" style="zoom:50%;" /><p>对于外部表，认为数据不是自己的，不会一起删除。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094745.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408094802.png" style="zoom:50%;" /><h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p>也就是说，外部表删除时，只会删除元数据（mysql中的数据），而不会去删除实际数据。 </p><h4 id="内部表和外部表的使用"><a href="#内部表和外部表的使用" class="headerlink" title="内部表和外部表的使用"></a>内部表和外部表的使用</h4><p>在实际公司环境中，内部表一般作为中间表，因为删除方便。 </p><p>外部表作为最终的结果表，因为安全。 </p><h2 id="7-分区表"><a href="#7-分区表" class="headerlink" title="7. 分区表"></a>7. 分区表</h2><h3 id="分区表定义"><a href="#分区表定义" class="headerlink" title="分区表定义"></a>分区表定义</h3><p>分区表实际上就是对应一个 HDFS 文件系统上的独立的文件夹，该文件夹下是该分区所有的数据文件。 </p><h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4><p>在当前，每个表对应的就是一个文件夹，所有数据都放在里面，若加上了分区，那么在这个文件夹里面就会有很多子文件，每个分区对应一个文件夹。 </p><p>Hive 中的分区就是<strong>分目录</strong>，把一个大的数据集根据业务需要分割成小的数据集。 </p><p>在查询时通过 WHERE 子句中的表达式选择查询所需要的指定的分区，这样的查询效率会提高很多。 </p><h3 id="分区表基本操作"><a href="#分区表基本操作" class="headerlink" title="分区表基本操作"></a>分区表基本操作</h3><h4 id="1-创建分区表语法、加载数据"><a href="#1-创建分区表语法、加载数据" class="headerlink" title="1. 创建分区表语法、加载数据"></a>1. 创建分区表语法、加载数据</h4><ol><li><p>引入分区表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/hive/warehouse/log_partition/20170702/20170702.log<br>/usr/hive/warehouse/log_partition/20170703/20170703.log<br>/usr/hive/warehouse/log_partition/20170704/20170704.log<br></code></pre></td></tr></table></figure></li><li><p>创建分区表语法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; create table dept_partition(<br>deptno int,<br>dname string,<br>loc string<br>)<br>partitioned by (month string)<br>row format delimited fields terminated by &#x27;\t&#x27;;<br></code></pre></td></tr></table></figure></li></ol><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408095351.png"></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408095412.png" style="zoom:50%;" /><h4 id="2-增加分区"><a href="#2-增加分区" class="headerlink" title="2. 增加分区"></a>2. 增加分区</h4><ol><li><p>创建单个分区</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition add partition(month=&#x27;20210706&#x27;);<br></code></pre></td></tr></table></figure></li><li><p>同时创建多个分区</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition add partition(month=&#x27;20210706&#x27;) partition(month=&#x27;20210707&#x27;);<br></code></pre></td></tr></table></figure></li></ol><h4 id="3-删除分区"><a href="#3-删除分区" class="headerlink" title="3. 删除分区"></a>3. 删除分区</h4><p>删除分区不同于增加分区，增加多个分区用空格隔开，而删除多个分区用”,”隔开。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition drop partition(month=&#x27;20210706&#x27;), partition(month=&#x27;20210707&#x27;);<br></code></pre></td></tr></table></figure><h4 id="4-查看分区表有多少分区"><a href="#4-查看分区表有多少分区" class="headerlink" title="4. 查看分区表有多少分区"></a>4. 查看分区表有多少分区</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt;</span><span class="language-bash">show partitions dept_partition;</span><br></code></pre></td></tr></table></figure><h4 id="5-查看分区表结构"><a href="#5-查看分区表结构" class="headerlink" title="5. 查看分区表结构"></a>5. 查看分区表结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">desc formatted dept_partition;</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Partition Information</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">col_name data_type comment month string</span><br></code></pre></td></tr></table></figure><h3 id="分区表注意事项"><a href="#分区表注意事项" class="headerlink" title="分区表注意事项"></a>分区表注意事项</h3><h4 id="1-创建二级分区表"><a href="#1-创建二级分区表" class="headerlink" title="1. 创建二级分区表"></a>1. 创建二级分区表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">hive&gt; </span><span class="language-bash">create table dept_partition2(</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">  deptno int, dname string, loc string</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">)</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">partitioned by (mon string, day string)</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">row format delimited fields terminated by <span class="hljs-string">&#x27;\t&#x27;</span>;</span><br></code></pre></td></tr></table></figure><h4 id="2-到二级分区加载和查询数据"><a href="#2-到二级分区加载和查询数据" class="headerlink" title="2. 到二级分区加载和查询数据"></a>2. 到二级分区加载和查询数据</h4><ol><li><p>加载数据到二级分区表中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default) &gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table default.dept_partition2 partition(month=&#x27;201709&#x27;,day=&#x27;13&#x27;);<br></code></pre></td></tr></table></figure></li><li><p>查询分区数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive (default) &gt; select * from dept_partition2 where month=&#x27;201709&#x27; and day=&#x27;13&#x27;;<br></code></pre></td></tr></table></figure></li></ol><p>会在大目录下创建一个二级目录</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100617.png" style="zoom:50%;" /><h3 id="把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式"><a href="#把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式" class="headerlink" title="把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式"></a>把数据直接上传到分区目录上，让分区表和数据产生关联的三种方式</h3><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>如果我们直接往hdfs目录下上传文件，那么是查不出来的。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100732.png" style="zoom: 50%;" /><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>没有元数据！mysql没有感知到这个数据。 </p><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><h5 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h5><p>执行修复命令 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">msck repair table dept_partition2; <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210408100826.png" style="zoom:50%;" /><h5 id="方式2：上传数据"><a href="#方式2：上传数据" class="headerlink" title="方式2：上传数据"></a>方式2：上传数据</h5><ol><li><p>上传数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; dfs mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=11;<br>hive(default) &gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201709/day=11;<br></code></pre></td></tr></table></figure></li><li><p>执行添加分区</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition2 add partition(month=&#x27;201709&#x27;, day=&#x27;11&#x27;);<br></code></pre></td></tr></table></figure></li><li><p>查询数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default &gt; select * from dept_partition2 where month = &#x27;201709&#x27; and day = &#x27;11&#x27;;<br></code></pre></td></tr></table></figure></li></ol><h5 id="方式3：创建文件夹后load数据到分区"><a href="#方式3：创建文件夹后load数据到分区" class="headerlink" title="方式3：创建文件夹后load数据到分区"></a>方式3：创建文件夹后load数据到分区</h5><ol><li><p>创建目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=11<br></code></pre></td></tr></table></figure></li><li><p>上传数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; load data local inpath &#x27;/opt/module/datas/dept.txt&#x27; into table dept_partition2 partition(month=&#x27;201709&#x27;, day=&#x27;11&#x27;);<br></code></pre></td></tr></table></figure></li><li><p>查询数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default &gt; select * from dept_partition2 where month = &#x27;201709&#x27; and day = &#x27;11&#x27;;<br></code></pre></td></tr></table></figure></li></ol><h2 id="8-修改表"><a href="#8-修改表" class="headerlink" title="8. 修改表"></a>8. 修改表</h2><h3 id="1-重命名表"><a href="#1-重命名表" class="headerlink" title="1. 重命名表"></a>1. 重命名表</h3><h4 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ALTER TABLE table_name RENAME TO new_table_name<br></code></pre></td></tr></table></figure><h4 id="实操案例"><a href="#实操案例" class="headerlink" title="实操案例"></a>实操案例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hive(default) &gt; alter table dept_partition2 rename to dept_partition3<br></code></pre></td></tr></table></figure><h3 id="2-增加-x2F-修改-x2F-替换列信息"><a href="#2-增加-x2F-修改-x2F-替换列信息" class="headerlink" title="2. 增加&#x2F;修改&#x2F;替换列信息"></a>2. 增加&#x2F;修改&#x2F;替换列信息</h3><h4 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h4><h5 id="更新列"><a href="#更新列" class="headerlink" title="更新列"></a>更新列</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]<br></code></pre></td></tr></table></figure><h5 id="增加和替换列"><a href="#增加和替换列" class="headerlink" title="增加和替换列"></a>增加和替换列</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)<br></code></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hive</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/57c0e88f0643.html"/>
    <url>/2022/12/57c0e88f0643.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、zookeeper简介"><a href="#一、zookeeper简介" class="headerlink" title="一、zookeeper简介"></a>一、zookeeper简介</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>zooKeeper由雅虎研究院开发，是Google Chubby的开源实现，后来托管到 Apache，于2010年11月正式成为Apache的顶级项目。 </p><p>大数据生态系统里的很多组件的命名都是某种动物或者昆虫，比如hadoop就是 🐘，hive就是🐝。zookeeper即动物园管理者，顾名思义就是管理大数据生态系统各组件的管理员。 </p><p>如下图所示： </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091859.png" style="zoom: 33%;" /><h2 id="zookeeper应用场景"><a href="#zookeeper应用场景" class="headerlink" title="zookeeper应用场景"></a>zookeeper应用场景</h2><h3 id="1-维护配置信息"><a href="#1-维护配置信息" class="headerlink" title="1. 维护配置信息"></a>1. 维护配置信息</h3><p>java编程经常会遇到配置项，比如数据库的url、schema、user和password 等。通常这些配置项我们会放置在配置文件中，再将配置文件放置在服务器上当需要更改配置项时，需要去服务器上修改对应的配置文件。 </p><p>但是随着分布式系统的兴起，由于许多服务都需要使用到该配置文件，因此有必须保证该配置服务的高可用性（high availability）和各台服务器上配置数据的一致性。通常会将配置文件部署在一个集群上，然而一个集群动辄上千台服务器，此时如果再一台台服务器逐个修改配置文件那将是非常繁琐且危险的的操作，因此就需要一种服务，能够高效快速且可靠地完成配置项的更改等操作，并能够保证各配置项在每台服务器上的数据一致性。 </p><p>zookeeper就可以提供这样一种服务，其使用Zab这种一致性协议来保证一致性。现在有很多开源项目使用zookeeper来维护配置，比如在hbase中，客户端就是连接一个zookeeper，获得必要的hbase集群的配置信息，然后才可以进一步操作。还有在开源的消息队列kafka中，也使用zookeeper来维护broker的信息。在alibaba开源的soa框架dubbo中也广泛的使用zookeeper管理一些配置来实现服务治理。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092026.png" style="zoom: 33%;" /><h3 id="2-分布式锁服务"><a href="#2-分布式锁服务" class="headerlink" title="2. 分布式锁服务"></a>2. 分布式锁服务</h3><p>一个集群是一个分布式系统，由多台服务器组成。为了提高并发度和可靠性， 多台服务器上运行着同一种服务。当多个服务在运行时就需要协调各服务的进度，有时候需要保证当某个服务在进行某个操作时，其他的服务都不能进行该操作，即对该操作进行加锁，如果当前机器挂掉后，释放锁并fail over 到其他的机器继续执行该服务。 </p><h3 id="3-集群管理"><a href="#3-集群管理" class="headerlink" title="3. 集群管理"></a>3. 集群管理</h3><p>一个集群有时会因为各种软硬件故障或者网络故障，出现某些服务器挂掉而被移除集群，而某些服务器加入到集群中的情况，zookeeper会将这些服务器加入&#x2F;移出的情况通知给集群中的其他正常工作的服务器，以及时调整存储和计算等任务的分配和执行等。此外zookeeper还会对故障的服务器做出诊断并尝试修复。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092147.png" style="zoom:33%;" /><h3 id="4-生成分布式唯一ID"><a href="#4-生成分布式唯一ID" class="headerlink" title="4. 生成分布式唯一ID"></a>4. 生成分布式唯一ID</h3><p>在过去的单库单表型系统中，通常可以使用数据库字段自带的auto_increment 属性来自动为每条记录生成一个唯一的ID。但是分库分表后，就无法在依靠数据库的 auto_increment属性来唯一标识一条记录了。此时我们就可以用zookeeper在分布式环境下生成全局唯一ID。</p><h4 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h4><p>每次要生成一个新Id时，创建一个持久顺序节点，创建 操作返回的节点序号，即为新Id，然后把比自己节点小的删除即可 </p><h2 id="zookeeper的设计目标"><a href="#zookeeper的设计目标" class="headerlink" title="zookeeper的设计目标"></a>zookeeper的设计目标</h2><h3 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h3><p>zooKeeper致力于为分布式应用提供一个<strong>高性能</strong>、<strong>高可用</strong>，且具有<strong>严格顺序访问控制能力</strong>的<strong>分布式协调服务</strong> </p><h3 id="1-高性能"><a href="#1-高性能" class="headerlink" title="1. 高性能"></a>1. 高性能</h3><p>zooKeeper将全量数据存储在内存中，并直接服务于客户端的所有非事务请求，尤 其适用于以读为主的应用场景 </p><h3 id="2-高可用"><a href="#2-高可用" class="headerlink" title="2. 高可用"></a>2. 高可用</h3><p>zooKeeper一般以集群的方式对外提供服务，一般3 ~ 5台机器就可以组成一个可用的Zookeeper集群了，每台机器都会在内存中维护当前的服务器状态，并且每台机器之间都相互保持着通信。只要集群中超过一半的机器都能够正常工作，那么整个集群就能够正常对外服务 </p><h3 id="3-严格访问顺序"><a href="#3-严格访问顺序" class="headerlink" title="3. 严格访问顺序"></a>3. 严格访问顺序</h3><p>对于来自客户端的每个更新请求，ZooKeeper都会分配一个全局唯一的递增编号， 这个编号反映了所有事务操作的先后顺序</p><h1 id="二、zookeeper的数据模型"><a href="#二、zookeeper的数据模型" class="headerlink" title="二、zookeeper的数据模型"></a>二、zookeeper的数据模型</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>zookeeper的数据节点可以视为树状结构（或者目录），树中的各节点被称为 znode（即zookeeper node），一个znode可以有多个子节点。 </p><p>zookeeper节点在结构上表现为树状； </p><p>使用路径path来定位某个znode，比如&#x2F;ns1&#x2F;itcast&#x2F;mysql&#x2F;schema1&#x2F;table1，此处ns-1、itcast、mysql、schema1、table1分别是根节点、2级节点、3级节点以及4级节点； </p><p>其中ns-1是itcast的父节点，itcast是ns-1的子 节点，itcast是mysql的父节点，mysql是itcast的子节点，以此类推。 </p><h3 id="znode"><a href="#znode" class="headerlink" title="znode"></a>znode</h3><p>znode，兼具文件和目录两种特点。既像文件一样维护着数据、元信息、ACL、时 间戳等数据结构，又像目录一样可以作为路径标识的一部分。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092714.png" style="zoom:50%;" /><h2 id="如何描述一个znode？"><a href="#如何描述一个znode？" class="headerlink" title="如何描述一个znode？"></a>如何描述一个znode？</h2><p>一个znode大体上分为3各部分： </p><ol><li>节点的数据：即znode data(节点path, 节点data)的关系就像是java map中(key, value)的关系 </li><li>节点的子节点children </li><li>节点的状态stat：用来描述当前节点的创建、修改记录，包括cZxid、ctime等</li></ol><h2 id="节点状态stat的属性"><a href="#节点状态stat的属性" class="headerlink" title="节点状态stat的属性"></a>节点状态stat的属性</h2><p>在zookeeper shell中使用get命令查看指定路径节点的data、stat信息 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407092913.png" style="zoom: 33%;" /><h3 id="属性说明"><a href="#属性说明" class="headerlink" title="属性说明"></a>属性说明</h3><ul><li>cZxid：数据节点创建时的事务 ID </li><li>ctime：数据节点创建时的时间 </li><li>mZxid：数据节点最后一次更新时的事务 ID </li><li>mtime：数据节点最后一次更新时的时间 </li><li>pZxid：数据节点的子节点最后一次被修改时的事务 ID </li><li>cversion：子节点的更改次数 </li><li>dataVersion：节点数据的更改次数 </li><li>aclVersion：节点的 ACL 的更改次数 </li><li>ephemeralOwner：如果节点是临时节点，则表示创建该节点的会话的 SessionID；如果节点是持久节点，则该属性值为 0 </li><li>dataLength：数据内容的长度 </li><li>numChildren：数据节点当前的子节点个数</li></ul><h2 id="zookeeper节点类型"><a href="#zookeeper节点类型" class="headerlink" title="zookeeper节点类型"></a>zookeeper节点类型</h2><p>zookeeper中的节点有两种： </p><p>临时节点和永久节点。节点的类型在创建时即被确定，并且不能改变。 </p><h3 id="临时节点"><a href="#临时节点" class="headerlink" title="临时节点"></a>临时节点</h3><p>该节点的生命周期依赖于创建它们的会话。一旦会话(Session)结束，临 时节点将被自动删除，当然可以也可以手动删除。虽然每个临时的Znode都会绑定到一个客户端会话，但他们对所有的客户端还是可见的。另外，ZooKeeper的临时节点不允许拥有子节点。 </p><h3 id="持久化节点"><a href="#持久化节点" class="headerlink" title="持久化节点"></a>持久化节点</h3><p>该节点的生命周期不依赖于会话，并且只有在客户端显示执行删除操作的时候，他们才能被删除 </p><h1 id="三、zookeeper单机安装"><a href="#三、zookeeper单机安装" class="headerlink" title="三、zookeeper单机安装"></a>三、zookeeper单机安装</h1><h2 id="本地模式安装部署"><a href="#本地模式安装部署" class="headerlink" title="本地模式安装部署"></a>本地模式安装部署</h2><h3 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h3><p>（1）安装Jdk </p><p>（2）拷贝Zookeeper安装包到Linux系统下 </p><p>（3）解压到指定目录 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/ <br></code></pre></td></tr></table></figure><h3 id="配置修改"><a href="#配置修改" class="headerlink" title="配置修改"></a>配置修改</h3><p>（1）将&#x2F;opt&#x2F;module&#x2F;zookeeper-3.4.10&#x2F;conf这个路径下的zoo_sample.cfg修改为zoo.cfg； </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 conf]$ mv zoo_sample.cfg zoo.cfg<br></code></pre></td></tr></table></figure><p>（2）打开zoo.cfg文件，修改dataDir路径： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ vim zoo.cfg<br></code></pre></td></tr></table></figure><p>修改如下内容： </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">dataDir=/opt/module/zookeeper-3.4.10/zkData <br></code></pre></td></tr></table></figure><p>（3）在&#x2F;opt&#x2F;module&#x2F;zookeeper-3.4.10&#x2F;这个目录上创建zkData文件夹 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ mkdir zkData <br></code></pre></td></tr></table></figure><h3 id="操作zookeeper"><a href="#操作zookeeper" class="headerlink" title="操作zookeeper"></a>操作zookeeper</h3><p>（1）启动Zookeeper </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh start<br></code></pre></td></tr></table></figure><p>（2）查看进程是否启动 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ jps <br>4020 Jps <br>4001 QuorumPeerMain <br></code></pre></td></tr></table></figure><p>（3）查看状态： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh status <br>ZooKeeper JMX enabled by default <br>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg <br>Mode: standalone <br></code></pre></td></tr></table></figure><p>（4）启动客户端： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkCli.sh<br></code></pre></td></tr></table></figure><p>（5）退出客户端： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk: localhost:2181(CONNECTED) 0] quit <br></code></pre></td></tr></table></figure><p>（6）停止Zookeeper </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[coachhe@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh stop<br></code></pre></td></tr></table></figure><p> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093503.png"></p><h3 id="配置参数解读"><a href="#配置参数解读" class="headerlink" title="配置参数解读"></a>配置参数解读</h3><p>1．tickTime &#x3D;2000：通信心跳数，Zookeeper服务器与客户端心跳时间，单位毫秒 </p><p>Zookeeper使用的基本时间，服务器之间或客户端与服务器之间维持心跳的时间间隔，也就是每个tickTime时间就会发送一个心跳，时间单位为毫秒。 </p><p>它用于心跳机制，并且设置最小的session超时时间为两倍心跳时间。(session的最小超时时间是2*tickTime) </p><p>2．initLimit &#x3D;10：LF初始通信时限 </p><p>集群中的Follower跟随者服务器与Leader领导者服务器之间初始连接时能容忍的最多心跳数（tickTime的数量），用它来限定集群中的Zookeeper服务器连接到Leader的时限。 </p><p>3．syncLimit &#x3D;5：LF同步通信时限 </p><p>集群中Leader与Follower之间的最大响应时间单位，假如响应超过syncLimit * tickTime，Leader认为Follwer死掉，从服务器列表中删除Follwer。 </p><p>4．dataDir：数据文件目录+数据持久化路径 </p><p>主要用于保存Zookeeper中的数据。 </p><p>5．clientPort &#x3D;2181：客户端连接端口 </p><p>监听客户端连接的端口。 </p><h2 id="集群部署"><a href="#集群部署" class="headerlink" title="集群部署"></a>集群部署</h2><h3 id="配置更改"><a href="#配置更改" class="headerlink" title="配置更改"></a>配置更改</h3><p>在单机模式的基础上。首先</p><ol><li><p>在<code>/opt/module/zookeeper-3.4.14/zkData</code>目录下创建一个myid的文件，将其设置为1</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409104631.png" style="zoom:50%;" /></li><li><p>将<code>/opt/module/zookeeper-3.4.14</code>拷贝到其他机器上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/home/bin/xsync /opt/module/zookeeper-3.4.14<br></code></pre></td></tr></table></figure></li><li><p>更改zoo.cfg，增加如下配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">########cluster########</span></span><br>server.1=chadoop1:2888:3888<br>server.2=chadoop2:2888:3888<br>server.3=chadoop3:2888:3888<br></code></pre></td></tr></table></figure><p>配置参数解读</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">server.A=B:C:D<br></code></pre></td></tr></table></figure><p><strong>A</strong> 是一个数字，表示这个是第几号服务器；</p><p>集群模式下配置一个文件 myid，这个文件在 dataDir 目录下，这个文件里面有一个数据就是 A 的值，Zookeeper 启动时读取此文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是哪个 server。 </p><p><strong>B</strong> 是这个服务器的地址；</p><p><strong>C</strong> 是这个服务器 Follower 与集群中的 Leader 服务器交换信息的端口；</p><p><strong>D</strong> 是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。</p></li><li><p>同步zoo.cfg</p></li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409105129.png" style="zoom: 33%;" /><ol start="5"><li>修改每个服务器中的myid为对应服务器号</li></ol><h3 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h3><ol><li><p>分别在三个集群执行启动指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zkServer.sh start<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110005.png" style="zoom:50%;" /></li><li><p>查看状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zkServer.sh status<br></code></pre></td></tr></table></figure><p>第一个执行的主机chadoop1：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110136.png" style="zoom:50%;" /><p>第二个执行的主机chadoop2：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409110236.png" style="zoom:50%;" /><p>可以看到，第二个执行的是leader，说明启动正常！</p></li></ol><h1 id="四、zookeeper常用Shell命令"><a href="#四、zookeeper常用Shell命令" class="headerlink" title="四、zookeeper常用Shell命令"></a>四、zookeeper常用Shell命令</h1><h2 id="1-新增节点"><a href="#1-新增节点" class="headerlink" title="1. 新增节点"></a>1. 新增节点</h2><h3 id="两种参数"><a href="#两种参数" class="headerlink" title="两种参数"></a>两种参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">create [-s] [-e] path data <br>-s: <br>有序节点 <br>-e: <br>临时节点 <br></code></pre></td></tr></table></figure><p>因此共有4种组合，分别为 </p><ol><li>持久化有序节点 </li><li>持久化无序节点 </li><li>临时有序节点 </li><li>临时无序节点。</li></ol><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>会话结束之后节点还会保留下来的节点叫做持久化节点。 </p><p>有序节点会在创建时路径后面添加一个序列号。 </p><p> 默认是持久化无序节点 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093807.png" style="zoom: 33%;" /><h3 id="创建持久化无序节点"><a href="#创建持久化无序节点" class="headerlink" title="创建持久化无序节点"></a>创建持久化无序节点</h3><p>默认为持久化无序节点，直接create即可。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093932.png" style="zoom:33%;" /><h3 id="创建持久化有序节点"><a href="#创建持久化有序节点" class="headerlink" title="创建持久化有序节点"></a>创建持久化有序节点</h3><h4 id="解释-1"><a href="#解释-1" class="headerlink" title="解释"></a>解释</h4><p>会话结束之后节点还会保留下来的节点叫做持久化节点。 </p><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">create -s path data <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407093950.png" style="zoom: 33%;" /><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>可以用来创建唯一ID </p><h3 id="创建临时有序节点"><a href="#创建临时有序节点" class="headerlink" title="创建临时有序节点"></a>创建临时有序节点</h3><h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">create -s -e path name <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094011.png" style="zoom:33%;" /><h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>用来生成分布式锁</p><h3 id="创建临时无序节点"><a href="#创建临时无序节点" class="headerlink" title="创建临时无序节点"></a>创建临时无序节点</h3><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">create -e path name<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094036.png" style="zoom:33%;" /><h4 id="重启之后消失"><a href="#重启之后消失" class="headerlink" title="重启之后消失"></a>重启之后消失</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094049.png" style="zoom:33%;" /><h2 id="2-更新节点"><a href="#2-更新节点" class="headerlink" title="2. 更新节点"></a>2. 更新节点</h2><h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">set path new_data <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094546.png" style="zoom:50%;" /><h3 id="基于版本号修改"><a href="#基于版本号修改" class="headerlink" title="基于版本号修改"></a>基于版本号修改</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094616.png" style="zoom:50%;" /><h2 id="3-删除节点"><a href="#3-删除节点" class="headerlink" title="3. 删除节点"></a>3. 删除节点</h2><h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">delete path [version] <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094656.png" style="zoom:50%;" /><h2 id="4-查看节点"><a href="#4-查看节点" class="headerlink" title="4. 查看节点"></a>4. 查看节点</h2><h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">get path<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094808.png" style="zoom:50%;" /><h3 id="属性解释"><a href="#属性解释" class="headerlink" title="属性解释"></a>属性解释</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094844.png" style="zoom:50%;" /><h3 id="子节点创建和更改"><a href="#子节点创建和更改" class="headerlink" title="子节点创建和更改"></a>子节点创建和更改</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407094911.png" style="zoom:50%;" /><h3 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h3><p>可以使用 stat 命令查看节点状态，它的返回值和 get 命令类似，但不会返回节点数据</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407095033.png" style="zoom:50%;" /><h2 id="5-查看节点列表"><a href="#5-查看节点列表" class="headerlink" title="5. 查看节点列表"></a>5. 查看节点列表</h2><p>查看节点列表有 ls path 和 ls2 path 两个命令，后者是前者的增强，不仅可以查看指定路径下的所有节点，还可以查看当前节点的信息 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407095133.png" style="zoom:50%;" /><h2 id="6-监听器"><a href="#6-监听器" class="headerlink" title="6. 监听器"></a>6. 监听器</h2><h3 id="1-get-path-watch"><a href="#1-get-path-watch" class="headerlink" title="1. get path [watch]"></a>1. get path [watch]</h3><p>使用<code>get path [watch]</code>注册的监听器能够在节点内容发生改变的时候，向客户端发出通知。需要注意的是zookeeper的触发器是一次性的（one-time trigger），即触发一次后就会立即失效。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk:localhost:2181(CONNECTED) 4] get /hadoop watch<br>[zk:localhost:2181(CONNECTED) 5] set /hadoop 45678<br>WATCHER::<br>WatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop #节点值改变<br></code></pre></td></tr></table></figure><h3 id="2-stat-path-watch"><a href="#2-stat-path-watch" class="headerlink" title="2. stat path [watch]"></a>2. stat path [watch]</h3><p>使用<code>stat path [watch]</code>注册的监听器能够在节点状态发生改变时，向客户端发出通知</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk:localhost:2181(CONNECTED) 7] stat /hadoop watch<br>[zk:localhost:2181(CONNECTED) 8] set /hadoop 112233<br>WATCHER::<br>WatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop #节点值改变<br></code></pre></td></tr></table></figure><h3 id="3-ls-x2F-ls2-path-watch"><a href="#3-ls-x2F-ls2-path-watch" class="headerlink" title="3. ls &#x2F; ls2 path [watch]"></a>3. ls &#x2F; ls2 path [watch]</h3><p>使用<code>ls path [watch]</code>或<code>ls2 path [watch]</code>注册的监听器能够监听该节点下所有子节点的增加和删除操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[zk:localhost:2181(CONNECTED) 9] ls /hadoop watch<br>[]<br>[zk:localhost:2181(CONNECTED) 8] create /hadoop/yarn &quot;aaa&quot;<br>WATCHER::<br>WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/hadoop<br></code></pre></td></tr></table></figure><h1 id="六、Zookeeper-JavaAPI"><a href="#六、Zookeeper-JavaAPI" class="headerlink" title="六、Zookeeper JavaAPI"></a>六、Zookeeper JavaAPI</h1><h2 id="1-连接到Zookeeper"><a href="#1-连接到Zookeeper" class="headerlink" title="1 连接到Zookeeper"></a>1 连接到Zookeeper</h2><h3 id="需要的jar包"><a href="#需要的jar包" class="headerlink" title="需要的jar包"></a>需要的jar包</h3><p>需要添加的jar包在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">ZOOKEEPER_HOME</span><br></code></pre></td></tr></table></figure><p>和</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">ZOOKEEPER_HOME/lib</span><br></code></pre></td></tr></table></figure><p>下面</p><p>或者使用maven项目，<code>pom.xml</code>给出</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> </span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span> <br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.coachhe<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ZK-API<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-hdfs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span> <br></code></pre></td></tr></table></figure><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.zookeeper; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br> <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperConnection</span> &#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// 计数器对象 </span><br>            <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>            <span class="hljs-comment">// arg1:服务器ip和端口 </span><br>            <span class="hljs-comment">// arg2:客户端与服务器之间的会话超时时间（ms） </span><br>            <span class="hljs-comment">// arg3:监视器对象 </span><br>            <span class="hljs-type">ZooKeeper</span> <span class="hljs-variable">zooKeeper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(<span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>, <span class="hljs-number">5000</span>, <br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>                        <span class="hljs-meta">@Override</span> <br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent event)</span> &#123; <br>                            <span class="hljs-keyword">if</span> (event.getState() == Event.KeeperState.SyncConnected) &#123; <br>                                System.out.println(<span class="hljs-string">&quot;连接创建成功&quot;</span>); <br>                                <span class="hljs-comment">// 通知countDownLatch不用继续阻塞了 </span><br>                                countDownLatch.countDown(); <br>                            &#125; <br>                        &#125; <br>                    &#125;); <br>            <span class="hljs-comment">//主线程阻塞等待连接对象的创建成功 </span><br>            countDownLatch.await(); <br>            <span class="hljs-comment">//会话编号 </span><br>            System.out.println(zooKeeper.getSessionId()); <br>            zooKeeper.close(); <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="2-新增节点"><a href="#2-新增节点" class="headerlink" title="2 新增节点"></a>2 新增节点</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//同步方式</span><br>create(String path, <span class="hljs-type">byte</span>[] data, List&lt;ACL&gt; acl, CreateMode createMode)<br><span class="hljs-comment">//异步方式</span><br>create(String path, <span class="hljs-type">byte</span>[] data, List&lt;ACL&gt; acl, CreateMode createMode,<br>       AsyncCallback.StringCallback callBack, Object ctx)<br></code></pre></td></tr></table></figure><h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><ul><li>path - znode路径。例如，<code>/node</code>，<code>/node1/node11</code></li><li>data - 要存储在指定znode路径中的数据</li><li>ack - 要创建的节点的访问控制列表。</li><li>createMode - 节点的类型，这是一个枚举。</li><li>callBack - 异步回调接口</li><li>ctx - 传递上下文参数</li></ul><h2 id="3-更新节点"><a href="#3-更新节点" class="headerlink" title="3 更新节点"></a>3 更新节点</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 同步方式</span><br>setData(String path, <span class="hljs-type">byte</span>[] data, <span class="hljs-type">int</span> version)<br><span class="hljs-comment">// 异步方式</span><br>setData(String path, <span class="hljs-type">byte</span>[] data, <span class="hljs-type">int</span> version, AsyncCallback.StatCallback callback, Object ctx)<br></code></pre></td></tr></table></figure><h3 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h3><ul><li>path - znode路径。例如，<code>/node</code>，<code>/node1/node11</code></li><li>data - 要存储在指定znode路径中的数据</li><li>version - znode的当前版本。每当数据更改时，ZooKeeper会更新znode的版本号</li><li>callBack - 异步回调接口</li><li>ctx - 传递上下文参数</li></ul><h2 id="4-删除节点delete"><a href="#4-删除节点delete" class="headerlink" title="4 删除节点delete()"></a>4 删除节点delete()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 同步方式</span><br>delete(String path, <span class="hljs-type">int</span> version)<br><span class="hljs-comment">// 异步方式</span><br>setData(String path, <span class="hljs-type">int</span> version, AsyncCallback.StatCallback callback, Object ctx)<br></code></pre></td></tr></table></figure><ul><li>path - znode路径。例如，<code>/node</code>，<code>/node1/node11</code></li><li>version - znode的当前版本。每当数据更改时，ZooKeeper会更新znode的版本号</li><li>callBack - 异步回调接口</li><li>ctx - 传递上下文参数</li></ul><h2 id="5-查看节点getData"><a href="#5-查看节点getData" class="headerlink" title="5 查看节点getData()"></a>5 查看节点getData()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 同步方式</span><br>getData(String path, <span class="hljs-type">boolean</span> b, Stat stat)<br><span class="hljs-comment">// 异步方式</span><br>getData(String path, <span class="hljs-type">boolean</span> b, AsyncCallback.StatCallback callback, Object ctx)<br></code></pre></td></tr></table></figure><ul><li>path - znode路径。例如，<code>/node</code>，<code>/node1/node11</code></li><li>b - 是否使用连接对象中注册的监视器</li><li>stat - 返回znode的元数据</li><li>callBack - 异步回调接口</li><li>ctx - 传递上下文参数</li></ul><h1 id="七、ZooKeeper事件监听机制"><a href="#七、ZooKeeper事件监听机制" class="headerlink" title="七、ZooKeeper事件监听机制"></a>七、ZooKeeper事件监听机制</h1><h2 id="1-watcher"><a href="#1-watcher" class="headerlink" title="1 watcher"></a>1 watcher</h2><h3 id="1-watcher概念"><a href="#1-watcher概念" class="headerlink" title="1. watcher概念"></a>1. watcher概念</h3><p>zookeeper提供了数据的发布&#x2F;订阅功能，多个订阅者可同时监听某一特定主题对象，当该主题对象的自身状态发生变化时(例如节点内容改变、节点下的子节点列表改变等)，会实时、主动通知所有订阅者 </p><p>zookeeper采用了Watcher机制实现数据的发布&#x2F;订阅功能。该机制在被订阅对象发生变化时会异步通知客户端，因此客户端不必在Watcher注册后轮询阻塞，从而减轻了客户端压力。 </p><p>watcher机制实际上与观察者模式类似，也可看作是一种观察者模式在分布式场景下的实现方式。 </p><h3 id="2-watcher架构"><a href="#2-watcher架构" class="headerlink" title="2. watcher架构"></a>2. watcher架构</h3><p>Watcher实现由三个部分组成： </p><ol><li>Zookeeper服务端 </li><li>Zookeeper客户端 </li><li>客户端的ZKWatchManager对象</li></ol><h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><p>客户端首先将Watcher注册到服务端，同时将Watcher对象保存到客户端的WatchManager中。当ZooKeeper服务端监听的数据状态发生变化时，服务端会主动通知客户端， 接着客户端的Watch管理器会触发相关Watcher来回调相应处理逻辑，从而完成整体的数据发布&#x2F;订阅流程。 </p><h3 id="3-watcher特性"><a href="#3-watcher特性" class="headerlink" title="3. watcher特性"></a>3. watcher特性</h3><table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>一次性</td><td>watcher是一次性的，一旦触发就会被移除，再次使用时需要重新注册</td></tr><tr><td>客户端顺序回调</td><td>watcher回调是顺序串行化执行的，只有回调后客户端才能看到最新的数据状态。一个watcher回调逻辑不应该太多，以免影响别的watcher执行</td></tr><tr><td>轻量级</td><td>WatchEvent是最小的通信单位，结构上只包含通知状态、事件类型和节点路径，并不会告诉数据节点变化前后的具体内容；</td></tr><tr><td>时效性</td><td>watcher只有在当前session彻底失效时才会无效，若在session有效期内快速重连成功，则watcher依然存在，扔可接受到通知。</td></tr></tbody></table><h3 id="4-watcher接口设计"><a href="#4-watcher接口设计" class="headerlink" title="4. watcher接口设计"></a>4. watcher接口设计</h3><p>Watcher是一个接口，任何实现了Watcher接口的类就是一个新的Watcher。 </p><p>Watcher内部包含了两个枚举类：KeeperState、EventType </p><h4 id="Watcher通知状态（KeeperState）"><a href="#Watcher通知状态（KeeperState）" class="headerlink" title="Watcher通知状态（KeeperState）"></a>Watcher通知状态（KeeperState）</h4><p>KeeperState是客户端与服务端连接状态发生变化时对应的通知类型。路径为org.apache.zookeeper.Watcher.Event.KeeperState，是一个枚举类，其枚举属性 如下：</p><table><thead><tr><th>枚举属性</th><th>说明</th></tr></thead><tbody><tr><td>SyncConnected</td><td>客户端与服务器正常连接时</td></tr><tr><td>Disconnected</td><td>客户端与服务器断开连接时</td></tr><tr><td>Expired</td><td>会话session失效时</td></tr><tr><td>AuthFailed</td><td>身份认证失败时</td></tr></tbody></table><h4 id="Watcher事件类型（EventType）"><a href="#Watcher事件类型（EventType）" class="headerlink" title="Watcher事件类型（EventType）"></a>Watcher事件类型（EventType）</h4><p>EventType是数据节点(znode)发生变化时对应的通知类型。EventType变化时 KeeperState永远处于SyncConnected通知状态下；当KeeperState发生变化时， EventType永远为None。其路径为org.apache.zookeeper.Watcher.Event.EventType， 是一个枚举类，枚举属性如下： </p><table><thead><tr><th>枚举属性</th><th>说明</th></tr></thead><tbody><tr><td>None</td><td>无</td></tr><tr><td>NodeCreated</td><td>Watcher监听的数据节点与创建时</td></tr><tr><td>NodeDeleted</td><td>Watcher监听的数据节点被删除时</td></tr><tr><td>NodeDataChanged</td><td>Watcher监听的数据节点内容发生变更时（无论内容数据是否变化）</td></tr><tr><td>NodeChildrenChanged</td><td>Watcher监听的数据节点的子节点列表发生变化时</td></tr></tbody></table><p>注：客户端接收到的相关事件通知中只包含状态及类型等信息，不包括节点变化前后的 具体内容，变化前的数据需业务自身存储，变化后的数据需调用get等方法重新获取； </p><h3 id="5-捕获相应的事件"><a href="#5-捕获相应的事件" class="headerlink" title="5. 捕获相应的事件"></a>5. 捕获相应的事件</h3><p>在zookeeper中采用 zk.getChildren(path, watch)、zk.exists(path, watch)、zk.getData(path, watcher, stat) </p><p> 这样的方式为某个znode注册监听。 </p><table><thead><tr><th>注册方式</th><th>create</th><th>ChildrenChanged</th><th>Changed</th><th>Deleted</th></tr></thead><tbody><tr><td>zk.exists(“&#x2F;node-x”,watcher)</td><td>可监控</td><td></td><td>可监控</td><td>可监控</td></tr><tr><td>zk.getData(“&#x2F;node-x”,watcher)</td><td></td><td></td><td>可监控</td><td>可监控</td></tr><tr><td>zk.getChildren(“&#x2F;node-x”,watcher)</td><td></td><td>可监控</td><td></td><td>可监控</td></tr></tbody></table><h3 id="6-注册watcher的方法"><a href="#6-注册watcher的方法" class="headerlink" title="6. 注册watcher的方法"></a>6. 注册watcher的方法</h3><h4 id="1-客户端与服务器的连接状态"><a href="#1-客户端与服务器的连接状态" class="headerlink" title="1. 客户端与服务器的连接状态"></a>1. 客户端与服务器的连接状态</h4><ul><li>KeeperState:通知状态</li><li>SyncConnected：客户端与服务器正常连接时</li><li>Disconnected：客户端与服务器断开连接时</li><li>Expired：会话session失效时</li><li>AuthFailed：身份认证失败时</li></ul><p>时间类型为：None</p><h5 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.watcher; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZKConnectionWatcher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watcher</span> &#123; <br> <br>    <span class="hljs-comment">//计数器对象 </span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>    <span class="hljs-comment">//连接对象 </span><br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-comment">//连接的IP </span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZKConnectionWatcher</span>()); <br>            <span class="hljs-comment">// 阻塞线程，等待连接的创建 </span><br>            countDownLatch.await(); <br>            <span class="hljs-comment">// 会话id </span><br>            System.out.println(zooKeeper.getSessionId()); <br>            Thread.sleep(<span class="hljs-number">50000</span>); <br>            zooKeeper.close(); <br>            System.out.println(<span class="hljs-string">&quot;结束&quot;</span>); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br> <br>    &#125; <br> <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>        <span class="hljs-comment">// 事件类型 </span><br>        <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;连接创建成功!&quot;</span>); <br>                <span class="hljs-comment">//继续往下执行 </span><br>                countDownLatch.countDown(); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Disconnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;断开连接！&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Expired) &#123; <br>                System.out.println(<span class="hljs-string">&quot;会话超时!&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.AuthFailed) &#123; <br>                System.out.println(<span class="hljs-string">&quot;认证失败!&quot;</span>); <br>            &#125; <br>        &#125; <br>    &#125; <br>&#125; <br><br></code></pre></td></tr></table></figure><h3 id="7-检查节点是否存在"><a href="#7-检查节点是否存在" class="headerlink" title="7. 检查节点是否存在"></a>7. 检查节点是否存在</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 使用连接对象的监视器</span><br>exists(String path, <span class="hljs-type">boolean</span> b)<br><span class="hljs-comment">// 自定义监视器</span><br>exists(String path, Watcher w)<br>  <br><span class="hljs-comment">// NodeCreated:节点创建</span><br><span class="hljs-comment">// NodeDeleted:节点删除</span><br><span class="hljs-comment">// NodeDataChanged:节点内容发生变化</span><br></code></pre></td></tr></table></figure><ul><li>path - znode路径</li><li>b - 是否使用连接对象中注册的监视器</li><li>w - 监视器对象</li></ul><h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.watcher; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br><span class="hljs-keyword">import</span> org.junit.After; <br><span class="hljs-keyword">import</span> org.junit.Before; <br><span class="hljs-keyword">import</span> org.junit.Test; <br> <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZKWatcherExists</span> &#123; <br> <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    ZooKeeper zooKeeper; <br> <br>    <span class="hljs-meta">@Before</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        <span class="hljs-comment">// 计数器 </span><br>        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>        <span class="hljs-comment">// arg1:服务器ip和端口 </span><br>        <span class="hljs-comment">// arg2:客户端与服务器之间的会话超时时间（ms） </span><br>        <span class="hljs-comment">// arg3:监视器对象 </span><br>        zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>            <span class="hljs-meta">@Override</span> <br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent event)</span> &#123; <br>                <span class="hljs-keyword">if</span> (event.getState() == Event.KeeperState.SyncConnected) &#123; <br>                    System.out.println(<span class="hljs-string">&quot;连接创建成功&quot;</span>); <br>                    <span class="hljs-comment">// 通知countDownLatch不用继续阻塞了 </span><br>                    countDownLatch.countDown(); <br>                &#125; <br>                System.out.println(<span class="hljs-string">&quot;path = &quot;</span> + event.getPath()); <br>                System.out.println(<span class="hljs-string">&quot;eventType = &quot;</span> + event.getType()); <br>            &#125; <br>        &#125;); <br>        <span class="hljs-comment">//主线程阻塞等待连接对象的创建成功 </span><br>        countDownLatch.await(); <br>        <span class="hljs-comment">//会话编号 </span><br>        System.out.println(zooKeeper.getSessionId()); <br>        zooKeeper.close(); <br>    &#125; <br>     <br>    <span class="hljs-meta">@After</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        zooKeeper.close(); <br>    &#125; <br>     <br>     <br>    <span class="hljs-meta">@Test</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherExists1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">// arg1表示节点的路径 </span><br>        <span class="hljs-comment">// true表示需要进行监听,连接对象中的watcher </span><br>        zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-literal">true</span>); <br>        Thread.sleep(<span class="hljs-number">50000</span>); <br>        System.out.println(<span class="hljs-string">&quot;结束&quot;</span>); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="8-watcher的一次性"><a href="#8-watcher的一次性" class="headerlink" title="8. watcher的一次性"></a>8. watcher的一次性</h3><p>注意 </p><p>watcher监听是一次性的，若是需要多次监听，那么需要将exists方法放到process方法里面！ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherExists3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      <span class="hljs-keyword">try</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;自定义watcher&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;path = &quot;</span> + watchedEvent.getPath());<br>        System.out.println(<span class="hljs-string">&quot;eventType = &quot;</span> + watchedEvent.getType());<br>        zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-built_in">this</span>);<br>      &#125; <span class="hljs-keyword">catch</span> (KeeperException e)&#123;<br>        e.printStackTrace();<br>      &#125; <span class="hljs-keyword">catch</span> (InterruptedException e)&#123;<br>        e.printStackTrace();<br>      &#125;<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9-注册多个监视器对象"><a href="#9-注册多个监视器对象" class="headerlink" title="9. 注册多个监视器对象"></a>9. 注册多个监视器对象</h3><p>同一个节点注册两个监视器对象，那么在其改动时两个监听器对象都会有响应</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 注册多个监视器对象</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherExists3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;1&quot;</span>)<br>    &#125;<br>  &#125;);<br>    zooKeeper.exists(<span class="hljs-string">&quot;/watcher1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;2&quot;</span>)<br>    &#125;<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10-查看节点getData"><a href="#10-查看节点getData" class="headerlink" title="10. 查看节点getData()"></a>10. 查看节点getData()</h3><h5 id="使用连接对象中的watcher"><a href="#使用连接对象中的watcher" class="headerlink" title="使用连接对象中的watcher"></a>使用连接对象中的watcher</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherGetData1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// arg1:节点的路径</span><br>  <span class="hljs-comment">// arg2:使用连接对象的watcher</span><br>  zooKeeper.getData(<span class="hljs-string">&quot;/watcher2&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>);<br>  Tread.sleep(<span class="hljs-number">500000</span>);<br>  System.out.println(<span class="hljs-string">&quot;结束&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="自定义watcher对象"><a href="#自定义watcher对象" class="headerlink" title="自定义watcher对象"></a>自定义watcher对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watcherGetData1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  zooKeeper.getData(<span class="hljs-string">&quot;/watcher2&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;自定义watcher&quot;</span>);<br>      System.out.println(<span class="hljs-string">&quot;path = &quot;</span> + watchedEvent.getPath();<br>      System.out.println(<span class="hljs-string">&quot;eventType = &quot;</span> + watchedEvent.getType());<br>    &#125;<br>  &#125;, <span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-生成分布式唯一ID案例"><a href="#2-生成分布式唯一ID案例" class="headerlink" title="2 生成分布式唯一ID案例"></a>2 生成分布式唯一ID案例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.案例; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.*; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GloballyUniqueId</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watcher</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">defaultPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/uniqueId&quot;</span>; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br> <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>        <span class="hljs-comment">// 事件类型 </span><br>        <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;连接创建成功!&quot;</span>); <br>                <span class="hljs-comment">//继续往下执行 </span><br>                countDownLatch.countDown(); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Disconnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;断开连接！&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Expired) &#123; <br>                System.out.println(<span class="hljs-string">&quot;会话超时!&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.AuthFailed) &#123; <br>                System.out.println(<span class="hljs-string">&quot;认证失败!&quot;</span>); <br>            &#125; <br>        &#125;  <br>    &#125; <br>     <br>    <span class="hljs-comment">// 构造方法 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GloballyUniqueId</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// 创建连接对象 </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-built_in">this</span>); <br>            <span class="hljs-comment">// 阻塞线程，等待连接创建成功 </span><br>            countDownLatch.await(); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br>     <br>    <span class="hljs-comment">//生成ID的方法 </span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUniqueId</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>; <br>        <span class="hljs-keyword">try</span> &#123; <br>            path = zooKeeper.create(defaultPath, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, <br>                    CreateMode.EPHEMERAL); <br>        &#125; <span class="hljs-keyword">catch</span> (KeeperException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125;  <br>        <span class="hljs-keyword">return</span> path.substring(<span class="hljs-number">9</span>); <br>    &#125; <br> <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-type">GloballyUniqueId</span> <span class="hljs-variable">globallyUniqueId</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GloballyUniqueId</span>(); <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) &#123; <br>            <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> globallyUniqueId.getUniqueId(); <br>            System.out.println(id); <br>        &#125; <br>         <br>         <br>    &#125; <br>     <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="3-配置中心案例"><a href="#3-配置中心案例" class="headerlink" title="3 配置中心案例"></a>3 配置中心案例</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>工作中有这样的一个场景: </p><p>数据库用户名和密码信息放在一个配置文件中，应用读取该配置文件，配置文件信息放入缓存。 </p><p>若数据库的用户名和密码改变时候，还需要重新加载缓存，比较麻烦，通过 ZooKeeper可以轻松完成，当数据库发生变化时自动完成缓存同步。 </p><p>也就是说，在这里有用户名和密码，如果能及时读取更改信息。 </p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol><li><p>连接zookeeper服务器 </p></li><li><p>读取zookeeper中的配置信息，注册watcher监听器，存入本地变量 </p></li><li><p>当zookeeper中的配置信息发生变化时，通过watcher的回调方法捕获数据变化事件 </p></li><li><p>重新获取配置信息</p></li></ol><h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.案例; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.KeeperException; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfigCenter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watcher</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>     <br>    <span class="hljs-comment">// 用于本地化存储配置信息 </span><br>    <span class="hljs-keyword">private</span> String url; <br>    <span class="hljs-keyword">private</span> String username; <br> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUrl</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> url; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUrl</span><span class="hljs-params">(String url)</span> &#123; <br>        <span class="hljs-built_in">this</span>.url = url; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> username; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123; <br>        <span class="hljs-built_in">this</span>.username = username; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> password; <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123; <br>        <span class="hljs-built_in">this</span>.password = password; <br>    &#125; <br> <br>    <span class="hljs-keyword">private</span> String password; <br> <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>        <span class="hljs-comment">// 事件类型 </span><br>        <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;连接创建成功!&quot;</span>); <br>                <span class="hljs-comment">//继续往下执行 </span><br>                countDownLatch.countDown(); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Disconnected) &#123; <br>                System.out.println(<span class="hljs-string">&quot;断开连接！&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.Expired) &#123; <br>                System.out.println(<span class="hljs-string">&quot;会话超时!&quot;</span>); <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.AuthFailed) &#123; <br>                System.out.println(<span class="hljs-string">&quot;认证失败!&quot;</span>); <br>            &#125; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDataChanged) &#123; <br>            initValue(); <br>        &#125; <br>    &#125; <br>     <br>    <span class="hljs-comment">// 连接zookeeper服务器，读取配置信息 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initValue</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// 创建连接对象 </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-built_in">this</span>); <br>            <span class="hljs-comment">// 阻塞线程，等待连接创建成功 </span><br>            countDownLatch.await(); <br>            <span class="hljs-comment">// 读取配置信息 </span><br>            <span class="hljs-built_in">this</span>.url = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(zooKeeper.getData(<span class="hljs-string">&quot;/config/url&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>)); <br>            <span class="hljs-built_in">this</span>.username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(zooKeeper.getData(<span class="hljs-string">&quot;/config/username&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>)); <br>            <span class="hljs-built_in">this</span>.password = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(zooKeeper.getData(<span class="hljs-string">&quot;/config/password&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>)); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <span class="hljs-keyword">catch</span> (KeeperException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">// 构造方法 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyConfigCenter</span><span class="hljs-params">()</span> &#123; <br>        initValue(); <br>    &#125; <br> <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-type">MyConfigCenter</span> <span class="hljs-variable">myConfigCenter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyConfigCenter</span>(); <br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) &#123; <br>                Thread.sleep(<span class="hljs-number">3000</span>); <br>                System.out.println(<span class="hljs-string">&quot;url:&quot;</span> + myConfigCenter.getUrl()); <br>                System.out.println(<span class="hljs-string">&quot;username:&quot;</span> + myConfigCenter.getUsername()); <br>                System.out.println(<span class="hljs-string">&quot;password:&quot;</span> + myConfigCenter.getPassword()); <br>            &#125; <br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="4-分布式锁"><a href="#4-分布式锁" class="headerlink" title="4 分布式锁"></a>4 分布式锁</h2><h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><p>分布式锁有多种实现方式，比如通过数据库、redis都可实现。作为分布式协同工具ZooKeeper，当然也有着标准的实现方式。下面介绍在zookeeper中如何实现排他锁。  </p><p>设计思路：  </p><ol><li><p>每个客户端往&#x2F;Locks下创建临时有序节点&#x2F;Locks&#x2F;Lock_000000001 </p></li><li><p>客户端取得&#x2F;Locks下子节点，并进行排序，判断排在最前面的是否为自己，如果自己的 锁节点在第一位，代表获取锁成功 </p></li><li><p>如果自己的锁节点不在第一位，则监听自己前一位的锁节点。例如，自己锁节点 Lock 000000001 </p></li><li><p>当前一位锁节点（Lock 000000002）的逻辑 </p></li><li><p>监听客户端重新执行第2步逻辑，判断自己是否获得了锁</p></li></ol><h3 id="1-创建节点"><a href="#1-创建节点" class="headerlink" title="1. 创建节点"></a>1. 创建节点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.lock; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.*; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.data.Stat; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLock</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_ROOT_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/locks&quot;</span>; <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_NODE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Lock_&quot;</span>; <br>    <span class="hljs-keyword">private</span> String lockPath; <br> <br>    <span class="hljs-comment">//打开zookeeper连接 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLock</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// 创建连接对象 </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>                <span class="hljs-meta">@Override</span> <br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>                    <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>                        <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                            System.out.println(<span class="hljs-string">&quot;连接成功&quot;</span>); <br>                            countDownLatch.countDown(); <br>                        &#125; <br>                    &#125; <br>                &#125; <br>            &#125;); <br>            <span class="hljs-comment">// 阻塞线程，等待连接创建成功 </span><br>            countDownLatch.await(); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">//获取锁 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">//创建锁节点 </span><br>        createLock(); <br>        <span class="hljs-comment">//尝试获取锁 </span><br>        attemptLock(); <br>    &#125; <br> <br>    <span class="hljs-comment">//创建锁节点 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        <span class="hljs-comment">// 判断locks节点是否存在，不存在则创建 </span><br>        <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> zooKeeper.exists(LOCK_ROOT_PATH, <span class="hljs-literal">false</span>); <br>        <span class="hljs-keyword">if</span> (stat == <span class="hljs-literal">null</span>) &#123; <br>            zooKeeper.create(LOCK_ROOT_PATH, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, <br>                    CreateMode.PERSISTENT); <br>        &#125; <br>        <span class="hljs-comment">// 创建临时有序节点 </span><br>        lockPath = zooKeeper.create(LOCK_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + LOCK_NODE_NAME, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], <br>                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); <br>        System.out.println(<span class="hljs-string">&quot;节点创建成功：&quot;</span> + lockPath); <br>    &#125; <br> <br>    <span class="hljs-comment">//尝试获取锁 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attemptLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br> <br>    &#125; <br> <br>    <span class="hljs-comment">//释放锁 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br> <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-type">MyLock</span> <span class="hljs-variable">myLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLock</span>(); <br>            myLock.createLock(); <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="2-获取锁"><a href="#2-获取锁" class="headerlink" title="2. 获取锁"></a>2. 获取锁</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.lock; <br> <br><span class="hljs-keyword">import</span> org.apache.zookeeper.*; <br><span class="hljs-keyword">import</span> org.apache.zookeeper.data.Stat; <br><span class="hljs-keyword">import</span> sun.tools.jstack.JStack; <br> <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.Collection; <br><span class="hljs-keyword">import</span> java.util.Collections; <br><span class="hljs-keyword">import</span> java.util.List; <br><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch; <br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLock</span> &#123; <br>    <span class="hljs-type">String</span> <span class="hljs-variable">IP</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;10.211.55.100:2181&quot;</span>; <br>    <span class="hljs-keyword">static</span> ZooKeeper zooKeeper; <br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>); <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_ROOT_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/locks&quot;</span>; <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_NODE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Lock_&quot;</span>; <br>    <span class="hljs-keyword">private</span> String lockPath; <br> <br>    <span class="hljs-comment">//打开zookeeper连接 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLock</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-comment">// 创建连接对象 </span><br>            zooKeeper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeper</span>(IP, <span class="hljs-number">5000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>                <span class="hljs-meta">@Override</span> <br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>                    <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.None) &#123; <br>                        <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123; <br>                            System.out.println(<span class="hljs-string">&quot;连接成功&quot;</span>); <br>                            countDownLatch.countDown(); <br>                        &#125; <br>                    &#125; <br>                &#125; <br>            &#125;); <br>            <span class="hljs-comment">// 阻塞线程，等待连接创建成功 </span><br>            countDownLatch.await(); <br>        &#125; <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">//监视器对象，监视上一个节点是否被删除 </span><br>    <span class="hljs-type">Watcher</span> <span class="hljs-variable">watcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>() &#123; <br>        <span class="hljs-meta">@Override</span> <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> &#123; <br>            <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDeleted) &#123; <br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123; <br>                    MyLock.<span class="hljs-built_in">this</span>.notifyAll(); <br>                &#125; <br>            &#125; <br>        &#125; <br>    &#125;; <br> <br>    <span class="hljs-comment">//获取锁 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">//创建锁节点 </span><br>        createLock(); <br>        <span class="hljs-comment">//尝试获取锁 </span><br>        attemptLock(); <br>    &#125; <br> <br>    <span class="hljs-comment">//创建锁节点 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123; <br>        <span class="hljs-comment">// 判断locks节点是否存在，不存在则创建 </span><br>        <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> zooKeeper.exists(LOCK_ROOT_PATH, <span class="hljs-literal">false</span>); <br>        <span class="hljs-keyword">if</span> (stat == <span class="hljs-literal">null</span>) &#123; <br>            zooKeeper.create(LOCK_ROOT_PATH, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, <br>                    CreateMode.PERSISTENT); <br>        &#125; <br>        <span class="hljs-comment">// 创建临时有序节点 </span><br>        lockPath = zooKeeper.create(LOCK_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + LOCK_NODE_NAME, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>], <br>                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); <br>        System.out.println(<span class="hljs-string">&quot;节点创建成功：&quot;</span> + lockPath); <br>    &#125; <br> <br>    <span class="hljs-comment">//尝试获取锁 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attemptLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-comment">// 获取Locks节点下的所有子节点 </span><br>        List&lt;String&gt; list = zooKeeper.getChildren(LOCK_ROOT_PATH, <span class="hljs-literal">false</span>); <br>        <span class="hljs-comment">// 对子节点进行排序 </span><br>        Collections.sort(list); <br>        <span class="hljs-comment">// /Locks/Lock_0000000001 </span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> list.indexOf(lockPath.substring(LOCK_ROOT_PATH.length() + <span class="hljs-number">1</span>)); <br>        <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123; <br>            <span class="hljs-comment">//说明当前临时有序节点排名第一 </span><br>            System.out.println(<span class="hljs-string">&quot;获取锁成功&quot;</span>); <br>            <span class="hljs-keyword">return</span>; <br>        &#125; <span class="hljs-keyword">else</span> &#123; <br>            <span class="hljs-comment">// 获取上一个节点的路径 </span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> list.get(index - <span class="hljs-number">1</span>); <br>            <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> zooKeeper.exists(LOCK_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + path, watcher); <br>            <span class="hljs-keyword">if</span> (stat == <span class="hljs-literal">null</span>) &#123; <br>                <span class="hljs-comment">//如果等于空，那么就是在执行上面两行代码的时候前一个节点被删除掉了，那么重新尝试 </span><br>                attemptLock(); <br>            &#125; <span class="hljs-keyword">else</span> &#123; <br>                <span class="hljs-comment">//如果不为空，那么就等待上一个节点被删除 </span><br>                <span class="hljs-keyword">synchronized</span> (watcher) &#123; <br>                    watcher.wait(); <br>                &#125; <br>                attemptLock(); <br>            &#125; <br>        &#125; <br>    &#125; <br> <br>    <span class="hljs-comment">//释放锁 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br> <br>    &#125; <br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-keyword">try</span> &#123; <br>            <span class="hljs-type">MyLock</span> <span class="hljs-variable">myLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLock</span>(); <br>            myLock.createLock(); <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>            e.printStackTrace(); <br>        &#125; <br>    &#125; <br> <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="3-释放锁"><a href="#3-释放锁" class="headerlink" title="3. 释放锁"></a>3. 释放锁</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//释放锁 </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>    <span class="hljs-comment">//删除临时有序节点 </span><br>    zooKeeper.delete(<span class="hljs-built_in">this</span>.lockPath, -<span class="hljs-number">1</span>); <br>    zooKeeper.close(); <br>    System.out.println(<span class="hljs-string">&quot;锁已经释放：&quot;</span> + <span class="hljs-built_in">this</span>.lockPath); <br>&#125; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Zookeeper</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/bbeb762a64e3.html"/>
    <url>/2022/12/bbeb762a64e3.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、登录"><a href="#一、登录" class="headerlink" title="一、登录"></a>一、登录</h1><h2 id="虚拟机网络的三种连接方式"><a href="#虚拟机网络的三种连接方式" class="headerlink" title="虚拟机网络的三种连接方式"></a>虚拟机网络的三种连接方式</h2><ol><li><p>桥接模式 </p><p>如图中张三所示，centos虚拟机的地址和张三共享了同一个网段。</p> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404043439.png" style="zoom:50%;" /><p><strong>好处</strong> </p><p>大家都在同一个网段，可以相互通讯 </p><p><strong>缺点</strong> </p><p>因为IP地址有限，可能造成ip冲突 </p></li><li><p>NAT模式【网络地址转换模式】 </p><p>在windows基础上会<strong>生成一个新的地址</strong>，该地址不和原来的地址在一个网段中。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404043646.png" style="zoom:50%;" /><p><strong>好处</strong> </p><p>虚拟机不再占用原来的网段 </p><p><strong>缺点</strong> </p><p>该虚拟机不能被除了本机以外的其他机器找到，但是反过来该虚拟机可以找到其他机器（通过代理）。 </p></li><li><p>主机模式 </p><p>单独的一台电脑</p></li></ol><h2 id="linux目录结构"><a href="#linux目录结构" class="headerlink" title="linux目录结构"></a>linux目录结构</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>linux的文件系统是采用级层式的树状目录结构。在此结构中最上层的根目录是”&#x2F;“，然后在此目录下再创建其他目录。 </p><p> 在<strong>Linux</strong>世界中，<strong>一切皆文件</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404043829.png" style="zoom:50%;" /><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><ol><li>linux的目录中有且只有一个根目录&#x2F; </li><li>linux的各个目录存放的内容是规划好的，不用乱放文件 </li><li>linux是文件的形式管理我们的设备，因此linux系统，一切皆为文件。 </li><li>linux的各个文件目录下存放什么内容需要有一个认识。</li></ol><h1 id="二、用户"><a href="#二、用户" class="headerlink" title="二、用户"></a>二、用户</h1><h2 id="关机-amp-重启指令"><a href="#关机-amp-重启指令" class="headerlink" title="关机&amp;重启指令"></a>关机&amp;重启指令</h2><ol><li><p>shutdown </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">shutdown -h now：表示立即关机 <br>shutdown -h 1：表示一分钟后关机 <br>shutdown -r now： 表示立即重启 <br></code></pre></td></tr></table></figure></li><li><p>halt </p><p>直接使用，效果等价于关机 </p></li><li><p>reboot </p><p>就是重启系统 </p></li><li><p>sync </p><p>把内存的数据同步到磁盘上 </p><p><strong>注意</strong> </p><p>当我们关机或重启时，都应该先执行一下sync指令，把内存的数据写入磁盘，防止数据丢失。</p></li></ol><h2 id="用户的登录和注销"><a href="#用户的登录和注销" class="headerlink" title="用户的登录和注销"></a>用户的登录和注销</h2><h3 id="注销用户：logout"><a href="#注销用户：logout" class="headerlink" title="注销用户：logout"></a>注销用户：logout</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404044234.png" style="zoom:50%;" /><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>logout在图形界面是无效的 </p><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>Linux系统是一个多用户多任务操作系统，任何一个要使用资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。 </p><h3 id="1-添加用户"><a href="#1-添加用户" class="headerlink" title="1 添加用户"></a>1 添加用户</h3><p>基本语法 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd [选项] 用户名 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404044414.png" style="zoom:50%;" /><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><ol><li>当用户创建成功后，会自动创建和用户同名的家目录 </li><li>也可以通过useradd -d 指定目录 用户名 创建用户</li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404045035.png" style="zoom:50%;" /><p>更改密码 </p><p>passwd 用户名 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404045056.png" style="zoom:50%;" /><h3 id="2-删除用户"><a href="#2-删除用户" class="headerlink" title="2 删除用户"></a>2 删除用户</h3><p>基本语法 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">userdel [选项] 用户名 <br></code></pre></td></tr></table></figure><h4 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h4><ol><li><p>删除小明，但是保留家目录</p><p>方法：不带参数，直接删除</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406105833.png" style="zoom:50%;" /></li><li><p>删除小明，同时删除家目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">userdel -r xh<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406110015.png" style="zoom:50%;" /></li></ol><p>在删除用户时，一般不会删除家目录</p><h3 id="3-用户查询"><a href="#3-用户查询" class="headerlink" title="3 用户查询"></a>3 用户查询</h3><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">id 用户名 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406110219.png" style="zoom:50%;" /> <h3 id="4-切换用户"><a href="#4-切换用户" class="headerlink" title="4 切换用户"></a>4 切换用户</h3><p>在linux中，如果当前用户权限不够，可以通过su -用户名的方式切换用户 </p><h4 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">su - 切换用户名 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406110259.png" style="zoom:50%;" /><h4 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h4><p>root切换到其他用户不用输密码，其他密码切换到root时需要输密码 </p><h3 id="5-查看自己是什么用户"><a href="#5-查看自己是什么用户" class="headerlink" title="5 查看自己是什么用户"></a>5 查看自己是什么用户</h3><h4 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">who am i <br></code></pre></td></tr></table></figure><h2 id="组的管理"><a href="#组的管理" class="headerlink" title="组的管理"></a>组的管理</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>类似于角色，系统可以对<strong>有共性的</strong>多个用户进行统一的管理。 </p><h3 id="1-创建组"><a href="#1-创建组" class="headerlink" title="1 创建组"></a>1 创建组</h3><h4 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">groupadd 组名<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406110656.png" style="zoom:50%;" /> <h3 id="2-删除组"><a href="#2-删除组" class="headerlink" title="2 删除组"></a>2 删除组</h3><h4 id="基本语法-4"><a href="#基本语法-4" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">groupdel 组名  <br></code></pre></td></tr></table></figure><h3 id="3-用户组"><a href="#3-用户组" class="headerlink" title="3 用户组"></a>3 用户组</h3><p>增加用户时直接加上组 </p><h4 id="基本语法-5"><a href="#基本语法-5" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd -g 用户组 用户名 <br></code></pre></td></tr></table></figure><h3 id="4-修改用户组"><a href="#4-修改用户组" class="headerlink" title="4 修改用户组"></a>4 修改用户组</h3><h4 id="基本语法-6"><a href="#基本语法-6" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod -g 用户组 用户名 <br></code></pre></td></tr></table></figure><h2 id="用户和组的相关文件"><a href="#用户和组的相关文件" class="headerlink" title="用户和组的相关文件"></a>用户和组的相关文件</h2><h3 id="x2F-etc-x2F-passwd文件"><a href="#x2F-etc-x2F-passwd文件" class="headerlink" title="&#x2F;etc&#x2F;passwd文件"></a>&#x2F;etc&#x2F;passwd文件</h3><p>用户（user）的配置文件，记录用户的各种信息</p><p>每行的含义：用户名:口令:用户标识号:组标识号:注释性描述:主目录:登陆Shell</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406111550.png" style="zoom: 33%;" /><h3 id="x2F-etc-x2F-shadow文件"><a href="#x2F-etc-x2F-shadow文件" class="headerlink" title="&#x2F;etc&#x2F;shadow文件"></a>&#x2F;etc&#x2F;shadow文件</h3><p>口令的配置文件</p><p>每行的含义：登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406111630.png"></p><h3 id="x2F-etc-x2F-group文件"><a href="#x2F-etc-x2F-group文件" class="headerlink" title="&#x2F;etc&#x2F;group文件"></a>&#x2F;etc&#x2F;group文件</h3><p>组（group）的配置文件，记录linxu包含的组的信息</p><p>每行含义：组名:口令:组标识号:组内用户列表</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406111652.png" style="zoom: 33%;" /><h1 id="三、常用指令"><a href="#三、常用指令" class="headerlink" title="三、常用指令"></a>三、常用指令</h1><h2 id="1-指定运行级别"><a href="#1-指定运行级别" class="headerlink" title="1 指定运行级别"></a>1 指定运行级别</h2><h3 id="linux共有7个运行级别"><a href="#linux共有7个运行级别" class="headerlink" title="linux共有7个运行级别"></a>linux共有7个运行级别</h3><p>0：关机 </p><p>1：单用户（找回丢失密码） </p><p>2：多用户无网络服务 </p><p>3：多用户有网络服务（用的最多） </p><p>4：保留级别 </p><p>5：图形界面 </p><p>6：重启 </p><h3 id="系统运行级别配置文件"><a href="#系统运行级别配置文件" class="headerlink" title="系统运行级别配置文件"></a>系统运行级别配置文件</h3><p>&#x2F;etc&#x2F;inittab </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406171957.png"></p><h3 id="切换到指定运行级别"><a href="#切换到指定运行级别" class="headerlink" title="切换到指定运行级别"></a>切换到指定运行级别</h3><h4 id="基本语法-7"><a href="#基本语法-7" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">init [012356] <br></code></pre></td></tr></table></figure><h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>通过init来切换不同的运行级别，比如5-&gt;3，然后关机 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406172145.png"></p><h3 id="作用：通过运行级别找回丢失的密码"><a href="#作用：通过运行级别找回丢失的密码" class="headerlink" title="作用：通过运行级别找回丢失的密码"></a>作用：通过运行级别找回丢失的密码</h3><p>如果不小心忘记了root密码如何找回？ </p><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>进入到单用户模式，然后修改root密码即可 </p><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>进入单用户模式root不需要密码就可以登录 </p><h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406172310.png" style="zoom: 33%;" /><p>输入e之后</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406172337.png" style="zoom:50%;" /><p>输入1：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406172352.png" style="zoom:50%;" /><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>开机-&gt;在引导时输入回车-&gt;看到一个界面输入e-&gt;看到一个新的界面，选中第二行（编辑内核） -&gt; 再输入e -&gt; 在这行最后输入1，再回车 -&gt; 再次输入b，这时就会进入单用户模式。</p><p>此时我们就到了单用户模式，使用passwd指令来修改root密码。</p><h4 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h4><p>该命令是不能通过远程命令找回root密码的，必须直接在服务器上进行操作。此时默认这台主机是你的。 </p><p>因此linux还是很安全的 </p><h3 id="练习：如何让系统开机之后会自动进入命令行模式？"><a href="#练习：如何让系统开机之后会自动进入命令行模式？" class="headerlink" title="练习：如何让系统开机之后会自动进入命令行模式？"></a>练习：如何让系统开机之后会自动进入命令行模式？</h3><h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>将&#x2F;etc&#x2F;inittab中的默认运行级别改为3即可。 </p><h2 id="2-软链接"><a href="#2-软链接" class="headerlink" title="2 软链接"></a>2 软链接</h2><h3 id="基本语法-8"><a href="#基本语法-8" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s 目标目录 软链接名 <br></code></pre></td></tr></table></figure><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406190626.png" style="zoom: 50%;" /><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm -rf 软链接名<br></code></pre></td></tr></table></figure><h4 id="注意-4"><a href="#注意-4" class="headerlink" title="注意"></a>注意</h4><p>不能带斜杠</p><img src="/Users/coachhe/Library/Application Support/typora-user-images/image-20210406190821577.png" alt="image-20210406190821577" style="zoom:50%;" /><h2 id="3-查找类"><a href="#3-查找类" class="headerlink" title="3 查找类"></a>3 查找类</h2><h3 id="1-find指令"><a href="#1-find指令" class="headerlink" title="1. find指令"></a>1. find指令</h3><h4 id="基本语法-9"><a href="#基本语法-9" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find [搜索范围] [选项] <br></code></pre></td></tr></table></figure><p>选项说明如下案例 </p><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><ol><li><p>找到home目录下的某个文件</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406191330.png" style="zoom:50%;" /></li><li><p>查找home目录下属于某个用户的文件</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406191507.png" style="zoom:50%;" /></li><li><p>查找某个范围内大小大于20M的文件</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406191617.png" style="zoom:50%;" /></li></ol><h3 id="2-locate指令"><a href="#2-locate指令" class="headerlink" title="2. locate指令"></a>2. locate指令</h3><p>注意： </p><p>第一次使用locate指令的时候，需要使用updatedb创建locate数据库 </p><h1 id="四、权限"><a href="#四、权限" class="headerlink" title="四、权限"></a>四、权限</h1><h2 id="1-组管理"><a href="#1-组管理" class="headerlink" title="1. 组管理"></a>1. 组管理</h2><h3 id="linux组的基本介绍"><a href="#linux组的基本介绍" class="headerlink" title="linux组的基本介绍"></a>linux组的基本介绍</h3><p>linux的每个用户都必须属于一个组，不能独立于组外。 </p><p>在linux中每个文件在所有者、所在组、其他组的概念 </p><ol><li>所有者：属于哪个用户 </li><li>所在组：属于哪个组 </li><li>其他组：除去所在组之外的所有组</li></ol><h4 id="所有者"><a href="#所有者" class="headerlink" title="所有者"></a>所有者</h4><p>一般来说，文件的创建者就是所有者 </p><h5 id="如何查看文件的所有者"><a href="#如何查看文件的所有者" class="headerlink" title="如何查看文件的所有者"></a>如何查看文件的所有者</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -ahl<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406192043.png" style="zoom:50%;" /><h5 id="改变文件所有者"><a href="#改变文件所有者" class="headerlink" title="改变文件所有者"></a>改变文件所有者</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chown 用户名 文件名<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406192202.png" style="zoom:50%;" /><h5 id="注意-5"><a href="#注意-5" class="headerlink" title="注意"></a>注意</h5><p>更改用户之后组不会改变</p><h3 id="所在组"><a href="#所在组" class="headerlink" title="所在组"></a>所在组</h3><h5 id="修改文件所在组"><a href="#修改文件所在组" class="headerlink" title="修改文件所在组"></a>修改文件所在组</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp 组名 文件名<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406192331.png" style="zoom:50%;" /><h5 id="改变用户所在组"><a href="#改变用户所在组" class="headerlink" title="改变用户所在组"></a>改变用户所在组</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod -g 组名 用户名<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406192450.png" style="zoom:50%;" /><h2 id="2-权限说明"><a href="#2-权限说明" class="headerlink" title="2. 权限说明"></a>2. 权限说明</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406192841.png" style="zoom: 33%;" /><h3 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h3><p>-：普通文件 </p><p>d：目录 </p><p>l：软链接 </p><p>c：字符设备（键盘、鼠标） </p><p>b：块文件，硬盘 </p><h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p>r：读 </p><p>w：写 </p><p>x：在文件上表示可以被执行，在目录上表示可以进入 </p><p>r、w、x的数字表示 </p><p>r表示4，w表示2，x表示1，因此rwx&#x3D;4+2+1&#x3D;7 </p><h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-rwxrw-r-- 1 root root 1213 Feb 2 09:39 abc <br></code></pre></td></tr></table></figure><h4 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h4><p>-表示这是个普通文件 </p><p>接下来三个rwx表示这个文件可以被所有者读写，也可以被执行 </p><p>接下来三个rw-表示这个文件可以组内的用户读写，但不能执行 </p><p>接下来三个r–表示可以被其他用户读，但不能写和执行 </p><p>1是硬链接数 </p><p>1213表示文件大小（如果是目录则为4096，目录本身占有的空间） </p><h2 id="3-权限管理"><a href="#3-权限管理" class="headerlink" title="3. 权限管理"></a>3. 权限管理</h2><h3 id="修改权限"><a href="#修改权限" class="headerlink" title="修改权限"></a>修改权限</h3><p>用chmod修改文件权限 </p><h4 id="方法1：用-、-、-x3D-变更权限"><a href="#方法1：用-、-、-x3D-变更权限" class="headerlink" title="方法1：用+、-、&#x3D;变更权限"></a>方法1：用+、-、&#x3D;变更权限</h4><p>u：所有者 g：所有组 o：其他人 a：所有人(u,g,o的总和） </p><ol><li>chmod u&#x3D;rwx,g&#x3D;rx,o&#x3D;x 文件目录名 </li><li>chmod o+w 文件目录名—————-&gt;给其他人加上w权限 </li><li>chmod a-x 文件目录名——————&gt;给所有人减去x权限</li></ol><p><strong>举例</strong></p><p>新建一个abc文件，给所有者读写执行权限，给所在组读和执行的权限，给其他人读和执行的权限 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211202.png" style="zoom:50%;" /><p>去掉所有者的执行权限，给所在组加上写的权限：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211236.png" style="zoom:50%;" /><p>给文件的所有用户加上读的权限</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211323.png" style="zoom:50%;" /><h4 id="方法2：用数字方式实现"><a href="#方法2：用数字方式实现" class="headerlink" title="方法2：用数字方式实现"></a>方法2：用数字方式实现</h4><p>用数字形式让文件权限修改为rwxr–r-x </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211436.png" style="zoom:50%;" /><p>4+2+1&#x3D;7 </p><p>4&#x3D;4 </p><p>4+1&#x3D;5 </p><p>因此输入745 </p><h3 id="修改文件所有者-chown"><a href="#修改文件所有者-chown" class="headerlink" title="修改文件所有者-chown"></a>修改文件所有者-chown</h3><h4 id="针对文件"><a href="#针对文件" class="headerlink" title="针对文件"></a>针对文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chown newowner:newgroup file <br></code></pre></td></tr></table></figure><p>或者 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chown newownver file <br></code></pre></td></tr></table></figure><h4 id="针对目录"><a href="#针对目录" class="headerlink" title="针对目录"></a>针对目录</h4><p>如果是目录，则使用-R，使其下所有子文件或者目录递归生效 </p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>将文件abc所有者改为coachhe </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211623.png" style="zoom:50%;" /><p>其实相当于没操作 </p><p>将&#x2F;home&#x2F;目录下的目录abc以及里面内容所有者都改为jy </p><p>注意：要使用root用户 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211650.png" style="zoom:50%;" /><h3 id="修改文件所在组-chgrp"><a href="#修改文件所在组-chgrp" class="headerlink" title="修改文件所在组-chgrp"></a>修改文件所在组-chgrp</h3><h4 id="针对文件-1"><a href="#针对文件-1" class="headerlink" title="针对文件"></a>针对文件</h4><p>则直接 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp newgroup file <br></code></pre></td></tr></table></figure><p>或者 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp newgroup file <br></code></pre></td></tr></table></figure><h4 id="针对目录-1"><a href="#针对目录-1" class="headerlink" title="针对目录"></a>针对目录</h4><p>则 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgro -R newgroup file <br></code></pre></td></tr></table></figure><h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p>将文件abc的组更改为coachhe组 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406211821.png" style="zoom:50%;" /><h2 id="权限实践—警察小偷游戏"><a href="#权限实践—警察小偷游戏" class="headerlink" title="权限实践—警察小偷游戏"></a>权限实践—警察小偷游戏</h2><p>有两个组：警察（police）和土匪（bandit） </p><p>有两个警察：jack和jerry </p><p>有两个土匪：xh和xq </p><ol><li><p>jack创建一个文件，自己可以读写，本组人可以读，其他组没有人有任何权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; <span class="hljs-built_in">touch</span> hello</span> <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; <span class="hljs-built_in">chmod</span> 640 hello</span> <br></code></pre></td></tr></table></figure></li><li><p>jack修改该文件，让其他组人可以读，本组人可以读写 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; chomd 646 hello</span> <br></code></pre></td></tr></table></figure></li><li><p>xh投靠警察，看看是否可以读写。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; usermod -g police xh</span> <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; su - xh<span class="hljs-comment">## 注意：如果是在xh的界面，则需要注销之后再重新进入</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; vim abc</span> <br></code></pre></td></tr></table></figure><p>是可以读写的</p></li></ol><h1 id="五、任务调度"><a href="#五、任务调度" class="headerlink" title="五、任务调度"></a>五、任务调度</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">crontab <br>-e 直接进行任务设置 <br>-l 显示所有任务 <br></code></pre></td></tr></table></figure><h1 id="六、分区和硬盘"><a href="#六、分区和硬盘" class="headerlink" title="六、分区和硬盘"></a>六、分区和硬盘</h1><h2 id="1-分区的概念"><a href="#1-分区的概念" class="headerlink" title="1. 分区的概念"></a>1. 分区的概念</h2><h3 id="分区的方式"><a href="#分区的方式" class="headerlink" title="分区的方式"></a>分区的方式</h3><ol><li>mbr分区 <ul><li>最多支持四个主分区 </li><li>系统只能安装在主分区 </li><li>扩展分区要占一个主分区 </li><li>MBR最大只支持2TB，但拥有最好的兼容性</li></ul></li><li>gtp分区 <ul><li>支持无限多个主分区（但是操作系统可能限制） </li><li>最大支持18EB的大容量（1EB&#x3D;1024PB，1PB&#x3D;1024TB） </li><li>windows7 64位以后支持分区</li></ul></li></ol><h2 id="2-linux分区原理示意图"><a href="#2-linux分区原理示意图" class="headerlink" title="2. linux分区原理示意图"></a>2. linux分区原理示意图</h2><ol><li><p>Linux来说无论有几个分区，分给哪一个目录使用，它归根结底就只有一个根目录，一个独立且唯一的文件结构，linux中的每个分区都是用来组成整个文件系统的一部分。 </p></li><li><p>Linux采用了一种叫“载入”的处理方法，它的整个文件系统中包含了一整套的文件和目录，且将一个分区和一个目录联系起来。这时要载入的一个分区将使它的存储空间在同一个目录下获得。 </p></li><li><p>示意图</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406212421.png" style="zoom: 50%;" /></li></ol><h2 id="3-硬盘说明"><a href="#3-硬盘说明" class="headerlink" title="3 硬盘说明"></a>3 硬盘说明</h2><h3 id="几大基本硬盘"><a href="#几大基本硬盘" class="headerlink" title="几大基本硬盘"></a>几大基本硬盘</h3><ol><li>Linux硬盘分为IDE硬盘、virtio硬盘和SCSI硬盘，目前基本是SCSI硬盘（但是阿里云服务器的硬盘是virtio硬盘） </li><li>对于IDE硬盘，驱动器标识符为“hdx<del>”，其中“hd”表明分区所在设备的类型，这里是指IDE硬盘。“x”为盘号（a为基本盘，b为基本从属盘，c为辅助主盘，d为辅助从属盘），“</del>”表示分区，前4个分区用数字1到4表示，它们是主分区或者扩展分区，从5开始就是逻辑分区。 </li><li>对于SISI硬盘则表示为“sdx~”，SCSI硬盘是用“sd”来表示分区所在设备的类型的，其余则和IDE硬盘的表示方式一样。 </li><li>对于virtio硬盘，驱动器标识符为“vdx!”。其中“vd”表示分区所在设备的的类型，其余则和IDE硬盘的表示方式一样。</li></ol><h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><p>整体上来看这三者的最大不同还是挂载磁盘的数量。根据在ovirt的上测试，一台win7的虚拟机，最多可以创建3个ide硬盘，当再次创建新的ide硬盘时候，会提示无法创建。同时，实验中最多创建了14块virtio硬盘，虽然界面允许创建更多virtio硬盘，但是超过14块，虚拟机是无法启动的。virtio-scsi可以创建足够多的硬盘，以至于协议自身并不是限制因素，而内核的限制反而成了硬盘数目的极限。 </p><h3 id="查看系统分区和挂载的情况"><a href="#查看系统分区和挂载的情况" class="headerlink" title="查看系统分区和挂载的情况"></a>查看系统分区和挂载的情况</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">lsblk -f   ## 查看系统分区和挂载的情况 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406212630.png" style="zoom:50%;" /><p>注意： </p><p>挂载点就是文件系统 </p><h3 id="查看系统分区和挂载的情况以及文件的大小情况"><a href="#查看系统分区和挂载的情况以及文件的大小情况" class="headerlink" title="查看系统分区和挂载的情况以及文件的大小情况"></a>查看系统分区和挂载的情况以及文件的大小情况</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">lsblk <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406212704.png" style="zoom:50%;" /><h2 id="4-linux挂载经典案例"><a href="#4-linux挂载经典案例" class="headerlink" title="4 linux挂载经典案例"></a>4 linux挂载经典案例</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>给我们的linux系统增加一个新的硬盘，并且挂载到&#x2F;home&#x2F;newdisk </p><h3 id="如何增加一块硬盘"><a href="#如何增加一块硬盘" class="headerlink" title="如何增加一块硬盘"></a>如何增加一块硬盘</h3><ol><li>虚拟机添加硬盘 </li><li>分区 </li><li>格式化 </li><li>挂载 </li><li>设置可以自动挂载</li></ol><h3 id="我的虚拟机和硬盘"><a href="#我的虚拟机和硬盘" class="headerlink" title="我的虚拟机和硬盘"></a>我的虚拟机和硬盘</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406212855.png" style="zoom:50%;" /><p>sda硬盘，若加上一块新硬盘应该为sdb。 </p><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="1-虚拟机添加硬盘"><a href="#1-虚拟机添加硬盘" class="headerlink" title="1. 虚拟机添加硬盘"></a>1. 虚拟机添加硬盘</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406212937.png"></p><p>然后选择2G的硬盘，一路确定下去就可以了。 </p><p>注意：需要重启之后才能看到新的硬盘 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213003.png" style="zoom:50%;" /><h4 id="2-分区"><a href="#2-分区" class="headerlink" title="2. 分区"></a>2. 分区</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">fdisk /dev/sdb <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213045.png" style="zoom:50%;" /><p>得到结果 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213113.png" style="zoom:50%;" /><h4 id="3-格式化"><a href="#3-格式化" class="headerlink" title="3. 格式化"></a>3. 格式化</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkfs -t ext4 /dev/sdb1 <br></code></pre></td></tr></table></figure><p>含义是用mkfs -t指令将&#x2F;dev&#x2F;sdb1硬盘格式化为ext4格式。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213148.png" style="zoom:50%;" /><p>结果 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213207.png" style="zoom:50%;" /><p>出现了文件类型和uuid，格式化成功 </p><h4 id="4-挂载"><a href="#4-挂载" class="headerlink" title="4. 挂载"></a>4. 挂载</h4><ol><li><p>先创建一个目录 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /home/newdisk<br></code></pre></td></tr></table></figure></li><li><p>挂载mount</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mount /dev/sdb1 /home/newdisk <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213330.png" style="zoom:50%;" /><p>注意：</p><p>​此时为临时挂载，重启之后就失去作用了。因此需要设置永久挂载</p></li></ol><h4 id="5-设置可自动挂载"><a href="#5-设置可自动挂载" class="headerlink" title="5. 设置可自动挂载"></a>5. 设置可自动挂载</h4><p>修改&#x2F;etc&#x2F;fstab文件 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213446.png"></p><p>然后运行mount -a即可生效 </p><h2 id="5-硬盘卸载"><a href="#5-硬盘卸载" class="headerlink" title="5 硬盘卸载"></a>5 硬盘卸载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">umount 设备名 <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213525.png"></p><h2 id="6-磁盘情况查询"><a href="#6-磁盘情况查询" class="headerlink" title="6 磁盘情况查询"></a>6 磁盘情况查询</h2><h3 id="查询系统整体磁盘使用情况"><a href="#查询系统整体磁盘使用情况" class="headerlink" title="查询系统整体磁盘使用情况"></a>查询系统整体磁盘使用情况</h3><h4 id="基本语法-10"><a href="#基本语法-10" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">df -h /目录<br></code></pre></td></tr></table></figure><p>查询指定目录的磁盘占用情况，默认为当前目录。 </p><h4 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210406213625.png" style="zoom:50%;" /><h3 id="查询指定目录的磁盘占用情况"><a href="#查询指定目录的磁盘占用情况" class="headerlink" title="查询指定目录的磁盘占用情况"></a>查询指定目录的磁盘占用情况</h3><h4 id="基本语法-11"><a href="#基本语法-11" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">du -参数 /目录 <br></code></pre></td></tr></table></figure><p>参数 </p><p>-a 指定目录 </p><p>-h 带计量单位 </p><p>–max-depth&#x3D;1 子目录深度（也就是需要查到第几级） </p><p>-s 指定目录占用大小汇总 </p><p>-c：列出明细的同时，增加汇总值 </p><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p>查看&#x2F;opt目录占用磁盘空间的情况，深度为1 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210406233939.png" style="zoom:50%;" /><p>注意： </p><p>深度就是表示会显示&#x2F;opt目录下的第几级文件，如果是1那就只可能显示&#x2F;opt&#x2F;rh而不会更具体到&#x2F;opt&#x2F;rh&#x2F;xxx </p><h2 id="7-常用指令"><a href="#7-常用指令" class="headerlink" title="7 常用指令"></a>7 常用指令</h2><h3 id="1-统计-x2F-home文件夹下文件的数量"><a href="#1-统计-x2F-home文件夹下文件的数量" class="headerlink" title="1. 统计&#x2F;home文件夹下文件的数量"></a>1. 统计&#x2F;home文件夹下文件的数量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l | grep &quot;^-&quot; | wc -l<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210406234421.png" style="zoom:50%;" /><h3 id="2-统计-x2F-home文件夹下目录的数量"><a href="#2-统计-x2F-home文件夹下目录的数量" class="headerlink" title="2. 统计&#x2F;home文件夹下目录的数量"></a>2. 统计&#x2F;home文件夹下目录的数量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l | grep &quot;^d&quot; | wc -l<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210406234511.png" style="zoom:50%;" /><h3 id="3-统计-x2F-home文件夹下文件的个数，包括子文件夹里面的"><a href="#3-统计-x2F-home文件夹下文件的个数，包括子文件夹里面的" class="headerlink" title="3. 统计&#x2F;home文件夹下文件的个数，包括子文件夹里面的"></a>3. 统计&#x2F;home文件夹下文件的个数，包括子文件夹里面的</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -lR /home | grep &quot;^-&quot; | wc -l<br></code></pre></td></tr></table></figure><h3 id="4-统计-x2F-home文件夹下文件夹的个数，包括子文件夹里面的"><a href="#4-统计-x2F-home文件夹下文件夹的个数，包括子文件夹里面的" class="headerlink" title="4. 统计&#x2F;home文件夹下文件夹的个数，包括子文件夹里面的"></a>4. 统计&#x2F;home文件夹下文件夹的个数，包括子文件夹里面的</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -lR /home | grep &quot;^d&quot; | wc -l<br></code></pre></td></tr></table></figure><h3 id="5-以树状形式展示整个目录"><a href="#5-以树状形式展示整个目录" class="headerlink" title="5. 以树状形式展示整个目录"></a>5. 以树状形式展示整个目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tree<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210406234737.png" style="zoom:50%;" /><h1 id="七-网络配置"><a href="#七-网络配置" class="headerlink" title="七 网络配置"></a>七 网络配置</h1><h2 id="1-linux网络配置原理图"><a href="#1-linux网络配置原理图" class="headerlink" title="1 linux网络配置原理图"></a>1 linux网络配置原理图</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210406235842.png"></p><h3 id="以我的电脑为例"><a href="#以我的电脑为例" class="headerlink" title="以我的电脑为例"></a>以我的电脑为例</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407000655.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407000802.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407000728.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407000745.png" style="zoom:50%;" /><h2 id="2-查看网络ip和网关"><a href="#2-查看网络ip和网关" class="headerlink" title="2 查看网络ip和网关"></a>2 查看网络ip和网关</h2><h3 id="1-查看虚拟网络编辑器"><a href="#1-查看虚拟网络编辑器" class="headerlink" title="1. 查看虚拟网络编辑器"></a>1. 查看虚拟网络编辑器</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407000959.png"  /><h3 id="2-修改ip地址"><a href="#2-修改ip地址" class="headerlink" title="2. 修改ip地址"></a>2. 修改ip地址</h3><p>点击上面的修改即可以 </p><h3 id="3-查看网关"><a href="#3-查看网关" class="headerlink" title="3. 查看网关"></a>3. 查看网关</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001036.png"></p><h2 id="3-linux网络环境配置"><a href="#3-linux网络环境配置" class="headerlink" title="3 linux网络环境配置"></a>3 linux网络环境配置</h2><h3 id="1-自动获取"><a href="#1-自动获取" class="headerlink" title="1. 自动获取"></a>1. 自动获取</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001128.png"></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001140.png" style="zoom:50%;" /><p>点上连接即可。 </p><p><strong>缺点 ：</strong></p><p>每次自动获取的IP地址不相同。因此不适合做服务器，因为服务器ip是固定的。 </p><h3 id="2-指定固定ip地址"><a href="#2-指定固定ip地址" class="headerlink" title="2. 指定固定ip地址"></a>2. 指定固定ip地址</h3><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>直接修改配置文件来指定IP，并可以接到外网，编辑&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-etho </p><h4 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h4><p>将ip地址配置的是静态的 </p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001251.png"></p><h2 id="4-修改主机名"><a href="#4-修改主机名" class="headerlink" title="4 修改主机名"></a>4 修改主机名</h2><h3 id="1-查看当前主机名"><a href="#1-查看当前主机名" class="headerlink" title="1. 查看当前主机名"></a>1. 查看当前主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo $HOSTNAME <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001354.png" style="zoom:50%;" /><h3 id="2-修改linux的主机映射文件"><a href="#2-修改linux的主机映射文件" class="headerlink" title="2. 修改linux的主机映射文件"></a>2. 修改linux的主机映射文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/sysconfig/network <br></code></pre></td></tr></table></figure><p>中的内容 </p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">NETWORKING=yes <br>NETWORKING_IPV^=no <br>HOSTNAME=xxxxx//新的主机名 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001455.png" style="zoom:50%;" /><p>注意：主机名不能有“_”下划线 </p><h3 id="3-修改-x2F-etc-x2F-hosts增加ip和主机之间的映射"><a href="#3-修改-x2F-etc-x2F-hosts增加ip和主机之间的映射" class="headerlink" title="3. 修改&#x2F;etc&#x2F;hosts增加ip和主机之间的映射"></a>3. 修改&#x2F;etc&#x2F;hosts增加ip和主机之间的映射</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001534.png" style="zoom:50%;" /><h3 id="4-重启设备"><a href="#4-重启设备" class="headerlink" title="4. 重启设备"></a>4. 重启设备</h3><h1 id="八-进程管理"><a href="#八-进程管理" class="headerlink" title="八 进程管理"></a>八 进程管理</h1><h2 id="1-进程的基本介绍"><a href="#1-进程的基本介绍" class="headerlink" title="1 进程的基本介绍"></a>1 进程的基本介绍</h2><ol><li>在Linux中，每个执行的<strong>程序（代码）</strong>都称为一个<strong>进程</strong>，每个进程都分配一个ID号 </li><li>每一个进程，都会对应一个父进程，而这个父进程可以复制多个子进程，例如www服务器。 </li><li>每个进程都可能以两种方式存在。前台和后台，所谓前台进程就是用户目前的屏幕上可以进行操作的。后台进程则是实际在操作，但由于屏幕上无法看到的进程，通常使用后台方式执行。 </li><li>一般系统的服务都是以后台进程的方式存在，而且都会常驻在系统中，直到关机才结束。</li></ol><h2 id="2-显示系统执行的进程"><a href="#2-显示系统执行的进程" class="headerlink" title="2 显示系统执行的进程"></a>2 显示系统执行的进程</h2><h3 id="ps指令"><a href="#ps指令" class="headerlink" title="ps指令"></a>ps指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps <br></code></pre></td></tr></table></figure><h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p>查看执行的指令是ps，一般来说使用的参数是ps -aux </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -a  ## 显示当前终端的所有进程信息 <br><br>ps -u  ## 以用户的格式显示进程信息 <br><br>ps -x  ## 显示后台进程进行的参数 <br></code></pre></td></tr></table></figure><h5 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -aux | more <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407001859.png"></p><h4 id="显示专门的进程"><a href="#显示专门的进程" class="headerlink" title="显示专门的进程"></a>显示专门的进程</h4><p>显示专门的进程可以用grep过滤</p><h5 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h5><p>我想看有没有关于sshd相关的进程： </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002036.png"></p><h4 id="看某个进程的父进程"><a href="#看某个进程的父进程" class="headerlink" title="看某个进程的父进程"></a>看某个进程的父进程</h4><h5 id="举例-3"><a href="#举例-3" class="headerlink" title="举例"></a>举例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | more <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002141.png"></p><h2 id="3-终止进程kill和killall"><a href="#3-终止进程kill和killall" class="headerlink" title="3 终止进程kill和killall"></a>3 终止进程kill和killall</h2><h3 id="基本语法-12"><a href="#基本语法-12" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">kill 选项 进程号 ## 功能描述：通过进程号杀死进程<br>killall 进程名称 ## 功能描述：通过进程名杀死进程，也支持通配符，这在系统因负载过大而变得很慢时很有用 <br></code></pre></td></tr></table></figure><h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><p>-9：强迫进程立即停止 </p><h3 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h3><h4 id="1-踢掉某个非法登录的用户"><a href="#1-踢掉某个非法登录的用户" class="headerlink" title="1. 踢掉某个非法登录的用户"></a>1. 踢掉某个非法登录的用户</h4><p>这里存在某个illegal_user: </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002358.png" style="zoom:50%;" /><p>我想把他踢走，因为他是通过sshd远程登录，因此可以查到登录信息 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -aux | grep sshd <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002431.png" style="zoom:50%;" /><p>可以看到有illegal_user的登录信息。 </p><p>kill掉这个进程即可 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002458.png"></p><h4 id="2-终止sshd服务的操作"><a href="#2-终止sshd服务的操作" class="headerlink" title="2. 终止sshd服务的操作"></a>2. 终止sshd服务的操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kill 1655 <br></code></pre></td></tr></table></figure><p>导致的结果就是不能再使用远程进行连接了。 </p><h4 id="3-终止多个gedit编辑器（通过killall）"><a href="#3-终止多个gedit编辑器（通过killall）" class="headerlink" title="3. 终止多个gedit编辑器（通过killall）"></a>3. 终止多个gedit编辑器（通过killall）</h4><p>通过多个终端打开了多个gedit编辑器 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002609.png"></p><p>使用命令： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">killall gedit<br></code></pre></td></tr></table></figure><p> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002643.png"></p><p>两个终端的gedit程序都已经同时被杀死。 </p><h4 id="4-强制杀掉一个终端"><a href="#4-强制杀掉一个终端" class="headerlink" title="4. 强制杀掉一个终端"></a>4. 强制杀掉一个终端</h4><p>首先查看当前打开的所有终端（bash） </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -aux | grep bash<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002752.png"></p><p>在这里，左边的bash对应右边的终端 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002810.png" style="zoom:50%;" /><p>首先kill：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kill 3103<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002904.png" style="zoom:50%;" /><p>结果：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002923.png" style="zoom:50%;" /><p>但是此时发现右边依旧存在。 </p><p>因此用-9，强制终止。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kill -9 3103<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407002957.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003014.png" style="zoom:50%;" /><h2 id="4-linux服务管理（service）简介和原理"><a href="#4-linux服务管理（service）简介和原理" class="headerlink" title="4 linux服务管理（service）简介和原理"></a>4 linux服务管理（service）简介和原理</h2><h3 id="服务介绍"><a href="#服务介绍" class="headerlink" title="服务介绍"></a>服务介绍</h3><p>服务（service）本质就是进程，但是是运行在后台的，通常都会监听某个端口，等待其他程序的请求，比如mysql，sshd，防火墙等，因此我们又称为守护进程，是Linux中非常重要的知识点 </p><h3 id="服务原理图"><a href="#服务原理图" class="headerlink" title="服务原理图"></a>服务原理图</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003136.png"></p><p>也就是说，服务本身就是监控某个端口的进程，用来提供ssh或者远程连接mysql等服务。</p><h3 id="service管理指令"><a href="#service管理指令" class="headerlink" title="service管理指令"></a>service管理指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">service 服务名 [start | stop | restart | reload | status] <br></code></pre></td></tr></table></figure><h4 id="注意-6"><a href="#注意-6" class="headerlink" title="注意"></a>注意</h4><p>在Centos7.0之后不再使用service，而是用systemctl，但用法几乎相同 </p><h3 id="案例-4"><a href="#案例-4" class="headerlink" title="案例"></a>案例</h3><p>查看当前防火墙的状况，关闭防火墙和重启防火墙。 </p><h4 id="1-查看防火墙当前状态"><a href="#1-查看防火墙当前状态" class="headerlink" title="1. 查看防火墙当前状态"></a>1. 查看防火墙当前状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">service iptables status <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003342.png"></p><h4 id="2-关闭防火墙和重启防火墙"><a href="#2-关闭防火墙和重启防火墙" class="headerlink" title="2. 关闭防火墙和重启防火墙"></a>2. 关闭防火墙和重启防火墙</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">service iptables stop <br>service iptables start <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003424.png"></p><h2 id="5-telnet指令"><a href="#5-telnet指令" class="headerlink" title="5 telnet指令"></a>5 telnet指令</h2><p>通过telnet指令检查linux的某个端口是否在监听，并且可以访问 </p><h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">telnet ip 端口 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003538.png" style="zoom:50%;" /><p>可以看到，建立起了连接，这意味着22号端口是在服务的。 </p><h3 id="注意：永久生效问题"><a href="#注意：永久生效问题" class="headerlink" title="注意：永久生效问题"></a>注意：永久生效问题</h3><p>service只是用来临时生效的，重启系统之后，还是回归以前对服务的设置。 </p><p>如果希望设置某个服务自启动或关闭永久生效，要使用chkconfig指令。 </p><h2 id="6-chkconfig指令"><a href="#6-chkconfig指令" class="headerlink" title="6 chkconfig指令"></a>6 chkconfig指令</h2><h3 id="chkconfig指令"><a href="#chkconfig指令" class="headerlink" title="chkconfig指令"></a>chkconfig指令</h3><p>通过chkconfig命令可以给每个服务的各个运行级别设置自启动&#x2F;关闭 </p><h3 id="基本语法-13"><a href="#基本语法-13" class="headerlink" title="基本语法"></a>基本语法</h3><h4 id="1-查看服务："><a href="#1-查看服务：" class="headerlink" title="1. 查看服务："></a>1. 查看服务：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chkconfig --list|grep xxx ## 或者 <br>chkconfig xxx --list <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003804.png"></p><p>可以查看sshd指令在每个运行级别的自启动状态 </p><h4 id="2-设置某个服务在某个运行级别下是否自启动"><a href="#2-设置某个服务在某个运行级别下是否自启动" class="headerlink" title="2. 设置某个服务在某个运行级别下是否自启动"></a>2. 设置某个服务在某个运行级别下是否自启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chkconfig --level 级别 xxx on/off <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407003907.png"></p><p>可以看到，将sshd在运行级别为5时的自启动关闭后再重新打开了。  </p><h3 id="注意-7"><a href="#注意-7" class="headerlink" title="注意"></a>注意</h3><p>chkconfig设置之后需要重启之后才能生效。 </p><h1 id="九-进程监控"><a href="#九-进程监控" class="headerlink" title="九 进程监控"></a>九 进程监控</h1><h2 id="1-动态监控进程top"><a href="#1-动态监控进程top" class="headerlink" title="1 动态监控进程top"></a>1 动态监控进程top</h2><h3 id="top介绍"><a href="#top介绍" class="headerlink" title="top介绍"></a>top介绍</h3><p>top与ps很相似，它们都用来显示正在执行的进程，区别在于top会实时更新 </p><h3 id="基本语法-14"><a href="#基本语法-14" class="headerlink" title="基本语法"></a>基本语法</h3><p>top [选项] </p><h3 id="案例-5"><a href="#案例-5" class="headerlink" title="案例"></a>案例</h3><h4 id="1-top直接使用的案例"><a href="#1-top直接使用的案例" class="headerlink" title="1. top直接使用的案例"></a>1. top直接使用的案例</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407004153.png"></p><h4 id="2-查看某个用户的案例"><a href="#2-查看某个用户的案例" class="headerlink" title="2. 查看某个用户的案例"></a>2. 查看某个用户的案例</h4><p>输入u之后出现下面这行： </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407004227.png"></p><p>然后输入root回车即可 </p><h4 id="3-杀死某个进程"><a href="#3-杀死某个进程" class="headerlink" title="3. 杀死某个进程"></a>3. 杀死某个进程</h4><p>输入k之后出现下面这行 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407004310.png"></p><p>然后输入进程号回车即可 </p><h4 id="4-指定系统状态更新的时间"><a href="#4-指定系统状态更新的时间" class="headerlink" title="4. 指定系统状态更新的时间"></a>4. 指定系统状态更新的时间</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">top -d time <br></code></pre></td></tr></table></figure><h4 id="5-互动指令"><a href="#5-互动指令" class="headerlink" title="5. 互动指令"></a>5. 互动指令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">P:CPU使用率 <br>M:按内存排序 <br>N:按PID排序 <br></code></pre></td></tr></table></figure><h2 id="2-监控网络状态netstat"><a href="#2-监控网络状态netstat" class="headerlink" title="2 监控网络状态netstat"></a>2 监控网络状态netstat</h2><h3 id="基本语法-15"><a href="#基本语法-15" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat [选项] <br></code></pre></td></tr></table></figure><h3 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h3><p>一般来说都是netstat -anp </p><p>-an：按一定顺序排列输出 </p><p>-p：显示哪个进程在调用 </p><h3 id="应用案例-1"><a href="#应用案例-1" class="headerlink" title="应用案例"></a>应用案例</h3><h4 id="1-查看系统所有的网络服务"><a href="#1-查看系统所有的网络服务" class="headerlink" title="1. 查看系统所有的网络服务"></a>1. 查看系统所有的网络服务</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407004741.png"></p><h3 id="2-查看系统的某个网络服务"><a href="#2-查看系统的某个网络服务" class="headerlink" title="2. 查看系统的某个网络服务"></a>2. 查看系统的某个网络服务</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407004817.png"></p><h1 id="十-下载管理"><a href="#十-下载管理" class="headerlink" title="十 下载管理"></a>十 下载管理</h1><h2 id="1-rpm包的管理"><a href="#1-rpm包的管理" class="headerlink" title="1 rpm包的管理"></a>1 rpm包的管理</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>RPM是RedHat Package Manager（RehHat软件包管理工具）的缩写，这一文件名称虽然打上了RedHat的标志，但理念是通用的。 </p><h3 id="rpm包的简单查询指令"><a href="#rpm包的简单查询指令" class="headerlink" title="rpm包的简单查询指令"></a>rpm包的简单查询指令</h3><p>查询已安装的rpm列表 </p><h4 id="基本语法-16"><a href="#基本语法-16" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -qa | grep xx <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005004.png"></p><h4 id="注意-8"><a href="#注意-8" class="headerlink" title="注意"></a>注意</h4><p>i686、i386表示32位系统，noarch表示通用 </p><h3 id="rpm包其他查询指令"><a href="#rpm包其他查询指令" class="headerlink" title="rpm包其他查询指令"></a>rpm包其他查询指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -qa <br>rpm -qa 查询所有rpm软件包 <br>rpm -qa | more 查询所有，以分页显示 <br>rpm -qa | grep xxx 查询某个 <br></code></pre></td></tr></table></figure><h4 id="rpm-qi-xxx"><a href="#rpm-qi-xxx" class="headerlink" title="rpm -qi xxx"></a>rpm -qi xxx</h4><p>rpm -qi xxx 查询安装的rpm包软件的信息 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005114.png"></p><h4 id="rpm-ql-xxx"><a href="#rpm-ql-xxx" class="headerlink" title="rpm -ql xxx"></a>rpm -ql xxx</h4><p>查询软件包中的文件 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005236.png"></p><h4 id="rpm-qf-文件路径名"><a href="#rpm-qf-文件路径名" class="headerlink" title="rpm -qf 文件路径名"></a>rpm -qf 文件路径名</h4><p>查询文件所属的软件包 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005256.png" style="zoom:50%;" /><h2 id="2-rpm包的卸载和安装"><a href="#2-rpm包的卸载和安装" class="headerlink" title="2 rpm包的卸载和安装"></a>2 rpm包的卸载和安装</h2><h3 id="1-删除"><a href="#1-删除" class="headerlink" title="1. 删除"></a>1. 删除</h3><h4 id="基本语法-17"><a href="#基本语法-17" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -e RPM包的名字 <br></code></pre></td></tr></table></figure><h4 id="注意-9"><a href="#注意-9" class="headerlink" title="注意"></a>注意</h4><p>如果删除其他软件包依赖于要卸载的软件包，卸载时则会报错： </p><p>若需要强制删除（不推荐）则运行： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rmp -e --nodeps xxx <br></code></pre></td></tr></table></figure><h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h3><h4 id="基本语法-18"><a href="#基本语法-18" class="headerlink" title="基本语法"></a>基本语法</h4><p>rpm -ivh RPM包全路径名称 </p><h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><p>i&#x3D;install 安装 </p><p>v&#x3D;verbose 提示 </p><p>h&#x3D;hash 进度条 </p><h4 id="应用实例：安装火狐浏览器"><a href="#应用实例：安装火狐浏览器" class="headerlink" title="应用实例：安装火狐浏览器"></a>应用实例：安装火狐浏览器</h4><ol><li><p>找到firefox安装包，需要挂载上我们安装centos的iso文件，然后到&#x2F;media&#x2F;下去找 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005619.png"></p></li><li><p>将其复制到某个希望的文件夹后安装</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005656.png"></p></li></ol><h2 id="3-yum介绍"><a href="#3-yum介绍" class="headerlink" title="3 yum介绍"></a>3 yum介绍</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>yum是一个Shell前端软件管理器。<strong>基于RPM包管理****，能够从指定的服务器自动下载RPM包并且安装，可以</strong>自动处理依赖关系**，并且一次性安装所有依赖的软件。 </p><p>使用yum的前提是可以联网 </p><h3 id="指令-1"><a href="#指令-1" class="headerlink" title="指令"></a>指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum list <br></code></pre></td></tr></table></figure><p>用来看所有yum服务器上的软件 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005821.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum list | grep xxx <br></code></pre></td></tr></table></figure><p>用来看所需要的软件在yum服务器上是否存在，若存在可以直接安装，否则需要另想办法 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005848.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install xxx <br></code></pre></td></tr></table></figure><p>直接使用 </p><h3 id="用yum来安装chrome"><a href="#用yum来安装chrome" class="headerlink" title="用yum来安装chrome"></a>用yum来安装chrome</h3><h4 id="查看yum服务器是否有chrome"><a href="#查看yum服务器是否有chrome" class="headerlink" title="查看yum服务器是否有chrome"></a>查看yum服务器是否有chrome</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210407005934.png"></p><h4 id="2-yum-install-chrome即可"><a href="#2-yum-install-chrome即可" class="headerlink" title="2. yum install chrome即可"></a>2. yum install chrome即可</h4>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>Command</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/b97b4b83acd0.html"/>
    <url>/2022/12/b97b4b83acd0.html</url>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>最初的如cpp或者c等语言，编译之后会直接出现二进制文件，然后直接在对应的平台上运行。<br>例如在windows上编译，会直接出现.exe文件，这个文件只能在windows上执行，不能在macos或者linux上执行。<br>在类Unix上编译（例如linux或者macos），会直接出现.out文件，这个文件只能在对应系统上执行，不能在windows上执行。<br>因此，我们编译的文件和操作系统是息息相关的。<br>但是，由于最近10年虚拟机以及大量建立在虚拟机之上的程序语言蓬勃发展，将我们编写的程序编译成二进制本地机器码已不再是唯一的选择，越来越多的程序语言选择了与操作系统和机器指令集无关的，平台中立的格式作为程序编译后的存储格式。<br>也就是说，我们编译出来的文件（例如Java编译后的.class文件），可以放在任何操作系统中运行。前提是安装了Java虚拟机（JVM），由JVM负责底层的处理，.class文件运行在JVM之上。</p><h1 id="无关性的基石"><a href="#无关性的基石" class="headerlink" title="无关性的基石"></a>无关性的基石</h1><p>各种不同平台的虚拟机与所有平台都统一使用的程序存储格式—&#x3D;&#x3D;字节码&#x3D;&#x3D;是平台无关性的基石<br>注意：<br>在这里，无关性分为两种：</p><ul><li>平台无关性</li><li>语言无关性</li></ul><p>大多数人最开始只关注平台无关性，也就是我们的程序可以在任何操作系统上运行。但是现在语言无关性也正在成为JVM的优势，也就是说，JVM不一定和Java程序绑定，JVM不关心在其之上运行一定要是Java编译的.class文件，其他程序（例如Scala、Jython等）程序，只要编译成.class文件，也同样能在JVM上运行，其实现基础仍然是虚拟机和字节码的存储格式。</p><p>Java语言中的各种变量、关键字和运算符号的语义最终都是由多条字节码组合而成的，因此字节码命令所能提供的语义描述能力肯定会比Java语言本身更加强大。</p><h1 id="Class类文件的结构"><a href="#Class类文件的结构" class="headerlink" title="Class类文件的结构"></a>Class类文件的结构</h1><p>注意：<br>任何一个Class文件都对应着<strong>唯一一个</strong>类或接口的定义信息。但是反过来并不成立，也就是类或者接口并不一定非得定义在Class文件里，例如可以通过类加载器直接生成。</p><p>Class文件是一组以8位字节为基础单位的二进制流，，各个数据项目严格按照顺序紧凑地排列在Class文件之中，中间没有添加任何分隔符，这使得整个Class文件中存储的内容几乎全部都是程序运行的必要数据，没有空隙存在。</p><h2 id="Class文件格式"><a href="#Class文件格式" class="headerlink" title="Class文件格式"></a>Class文件格式</h2><p>根据JVM规范，Class文件格式采用一种类似C语言结构体的伪结构来存储数据，这种伪结构只有两种数据类型：</p><ul><li>无符号数<ol><li>介绍<br>  无符号数属于基本数据类型，以u1、u2、u4、u8来分别代表1个字节、2个字节、4个字节和8个字节的无符号数</li><li>作用<br>  无符号数可以用来描述数字、索引引用、数量值或者按照UTF-8编码构成的字符串值。</li></ol></li><li>表<ol><li>介绍<br>  表是多个无符号数或者其他表作为数据项构成的复合数据类型，所有表都习惯性以<code>_info</code>结尾。</li><li>作用<br>  表用于描述有层次关系的符合数据结构的数据。<br>整个Class文件本质上就是一张表</li></ol></li></ul><h2 id="组成Class文件的数据项"><a href="#组成Class文件的数据项" class="headerlink" title="组成Class文件的数据项"></a>组成Class文件的数据项</h2><table><thead><tr><th>类型</th><th>名称</th><th>数量</th><th>含义</th></tr></thead><tbody><tr><td>u4</td><td>magic</td><td>1</td><td>魔数，代表这是一个Class文件</td></tr><tr><td>u2</td><td>minor_version</td><td>1</td><td>次版本号</td></tr><tr><td>u2</td><td>major_version</td><td>1</td><td>主版本号</td></tr><tr><td>u2</td><td>const_pool_count</td><td>1</td><td>常量池标志</td></tr><tr><td>cp_info</td><td>const_pool</td><td>constant_pool_count-1</td><td>常量池</td></tr><tr><td>u2</td><td>access_flages</td><td>1</td><td>访问标志</td></tr><tr><td>u2</td><td>this_class</td><td>1</td><td>类索引</td></tr><tr><td>u2</td><td>super_class</td><td>1</td><td>父类索引</td></tr><tr><td>u2</td><td>interfaces_count</td><td>1</td><td>接口数量</td></tr><tr><td>u2</td><td>interfaces</td><td>interfaces_count</td><td>接口索引</td></tr><tr><td>u2</td><td>fields_count</td><td>1</td><td>字段表数量</td></tr><tr><td>field_info</td><td>fields</td><td>fields_count</td><td>字段表集合</td></tr><tr><td>u2</td><td>methods_count</td><td>1</td><td>方法表数量</td></tr><tr><td>method_info</td><td>methods</td><td>methods_count</td><td>方法表集合</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td><td>属性数量</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td><td>属性集合</td></tr></tbody></table><p>接下来让我们一一进行分析</p><h3 id="魔数"><a href="#魔数" class="headerlink" title="魔数"></a>魔数</h3><p>每个Class文件的头四个字节被称为魔数（magic number），它的唯一作用是确定这个文件是否为一个能被虚拟机接收的Class文件。</p><h3 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h3><p>紧接着魔术的4个字节存储的是Class文件的版本号：5 6字节存储的是此版本号，7 8字节存储的是主版本号</p><h4 id="演示："><a href="#演示：" class="headerlink" title="演示："></a>演示：</h4><p>在这里准备了一段简单的代码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.clazz;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> m;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">inc</span><span class="hljs-params">()</span>&#123;  <br>        <span class="hljs-keyword">return</span> m + <span class="hljs-number">1</span>;  <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>将其用<code>javac TestClass.java</code>编译成<code>TestClass.class</code>文件之后我们将其用vim打开，并且转换成16进制。<br>方法为：</p><ol><li>用<code>vim -b</code>打开<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim -b TestClass.class<br></code></pre></td></tr></table></figure></li><li>输入<code>:%!xxd</code></li></ol><p>我们可以看到：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811103802.png></p><p>首先是头4个字节，为<code>cafe babe</code>，表名这是一个class文件，后两个字节<code>0000</code>代表次版本号，再两个字节<code>0034</code>表示主版本号，为<code>(3</code>$\times$<code>16)+4=52</code>，对应的版本为JDK8（具体版本对应关系可以百度查一下，因为内容不是特别重要我就不在这里全部列出了），也就是说，该版本号说明这个文件是可以被JDK8或以上版本的虚拟机执行的Class文件。</p><h3 id="常量池"><a href="#常量池" class="headerlink" title="常量池"></a>常量池</h3><p>常量池可以理解为Class文件之中的<strong>资源仓库</strong>。</p><h4 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h4><ol><li>常量池是Class文件结构中与其他项目关联最多的数据类型</li><li>也是占用Class文件空间最大的数据项目之一</li><li>同时它还是在Class文件中第一个出现的表类型数据项目</li></ol><p>由于常量池的数量是不固定的，所以在常量池的入口需要放置一项u2类型的数据，代表常量池容量计数器。<br>注意：<br>常量池容量的索引池范围为1<del>21，若索引值为0，则表示<strong>不可引用任何一个常量池项目</strong><br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811194509.png><br>可以看到，常量池容量为<code>0x0013</code>，也就是十进制的19，这就代表常量池有18项常量，索引值为0</del>18。</p><h4 id="主要存放的常量"><a href="#主要存放的常量" class="headerlink" title="主要存放的常量"></a>主要存放的常量</h4><ol><li>字面量<br>字面量比较接近于Java语言层面的常量概念，如文本字符串、被声明为final的常量值等。</li><li>符号引用<br>符号引用则属于编译原理方面的概念，主要包括下面几类常量：<ul><li>被模块导出或者开放的包（Package）</li><li>类和接口的全限定名</li><li>字段的名称和描述符</li><li>方法的名称和描述符</li><li>方法句柄和方法类型</li><li>动态调用点和动态常量</li></ul></li></ol><p>Java代码在运行Javac编译的时候，并不像C和C++一样有“连接”的步骤，而是在虚拟机加载Class文件的时候进行动态连接，也就是说，在Class文件中不会保存各个方法、字段的最终内存布局信息，因此这些字段、方法的符号不经过运行期转换的话无法得到真正的内存入口地址，也就无法直接被虚拟机使用。当虚拟机运行时，需要从常量池获得对应的符号引用，再在类创建时或运行时解析、翻译到具体的内存地址之中。（具体见[[8 虚拟机字节码执行引擎]]和[[7 虚拟机类加载机制]]）</p><p>常量池的项目类型：</p><table><thead><tr><th>类型</th><th>标志</th><th>描述</th></tr></thead><tbody><tr><td>CONSTANT_Utf8_info</td><td>1</td><td>UTF-8编码的字符串</td></tr><tr><td>CONSTANT_Integer_info</td><td>3</td><td>整型字面量</td></tr><tr><td>CONSTANT_Float_info</td><td>4</td><td>浮点型字面量</td></tr><tr><td>CONSTANT_Long_info</td><td>5</td><td>长整型字面量</td></tr><tr><td>CONSTANT_Double_info</td><td>6</td><td>双精度浮点型字面量</td></tr><tr><td>CONSTANT_Class_info</td><td>7</td><td>类或接口的符号引用</td></tr><tr><td>CONSTANT_Fieldref_info</td><td>8</td><td>字符串的符号引用</td></tr><tr><td>CONSTANT_String_info</td><td>9</td><td>字段和符号引用</td></tr><tr><td>CONSTANT_Methodref_info</td><td>10</td><td>类中方法的符号引用</td></tr><tr><td>CONSTANT_InterfaceMethodre_info</td><td>11</td><td>接口中方法的符号引用</td></tr><tr><td>CONSTANT_NameAndType_info</td><td>12</td><td>字段活方法的部分符号引用</td></tr><tr><td>CONSTANT_MethodHandle_info</td><td>15</td><td>表示方法句柄</td></tr><tr><td>CONSTANT_Dynamic_info</td><td>16</td><td>表示方法类型</td></tr><tr><td>CONSTANT_McthodType_info</td><td>17</td><td>表示一个动态计算常量</td></tr><tr><td>CONSTANT_InvokeDynamic_info</td><td>18</td><td>表示一个动态方法调用点</td></tr><tr><td>CONSTANT_Module_info</td><td>19</td><td>表示一个模块</td></tr><tr><td>CONSTANT_Package_info</td><td>20</td><td>表示一个模块中开发或者导出的包</td></tr></tbody></table><p>接下来看常量池的第一项常量，它的标志位为<code>0x0a</code></p><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811194944.png><p>对应十进制为10，表示类中方法的符号引用。</p><p>我们用<code>javap -verbose TestClass.class</code>来分析Class文件字节码。</p><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811195614.png>图中的第一项就是我们刚才推断出来的方法引用，那么接着看：<img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811200720.png>我们代码中的常量和方法名等数据都在里面有对应。<p><strong>问题</strong>：在图中我们可以看到，V、I、<code>&lt;init&gt;</code>方法在我们的代码里没有呀，这些常量是哪里来的呢？<br><strong>回答</strong>：它们都是编译器自动生成的，会被后面即将讲到的字段表(field_info)、方法表(method_info)、属性表(attribute_info)所引用，它们将会被用来描述一些不方便使用 “固定字节”进行表达的内容，譬如描述方法的返回值是什么，有几个参数，每个参数的类型是什么。因为Java中的“类”是无穷无尽的，无法通过简单的无符号数来描述一个方法用到了什么类，因此在描述方法的这些信息时，需要引用 常量表中的符号引用进行表达。这部分内容将在后面进一步详细阐述。</p><p>常量池中有17种数据类型，在这里就不一一列出了，有需要的可以翻阅《深入理解Java虚拟机》第222页-224页。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>总的来说，常量池就是将所有常量进行记录，但是需要注意的是，这些常量并不一定可以直接使用，还需要进一步进行解析等操作。</p><h2 id="访问标志"><a href="#访问标志" class="headerlink" title="访问标志"></a>访问标志</h2><p>在常量池结束之后，紧接着的2个字节代表访问标志(access_flags),这个标志用于识别一些类或者接口层次的访问信息，包括：这个Class是类还是接口；是否定义为public类型；是否定义为abstract类型；如果是类的话，是否被声明为final，等等</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811202057.png"></p><p><code>0x0021</code>为<code>0x0020|0x0001</code>，也就是<code>ACC_PUBLIC|ACC_SUPER</code>，具体的对应关系为：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811202409.png></p><h2 id="类索引、父类索引与接口索引集合"><a href="#类索引、父类索引与接口索引集合" class="headerlink" title="类索引、父类索引与接口索引集合"></a>类索引、父类索引与接口索引集合</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210811234110.png"></p><p>如图所示，介绍完前面几个数据之后，接下来是类索引、父类索引与接口索引集合。</p><h3 id="类索引、父类索引介绍"><a href="#类索引、父类索引介绍" class="headerlink" title="类索引、父类索引介绍"></a>类索引、父类索引介绍</h3><p>类索引、父类索引和接口索引集合都按顺序排列在访问标志之后，类索引和父类索引用两个u2类型的索引值表示，它们各自指向一个类型为CONSTANT_Class_info的类描述符常量，通过CONSTANT_Class_info类型的常量中的索引值可以找到定义在CONSTANT, Utf8_info类型的常量中的全限定名字符串。</p><h3 id="接口索引集合介绍"><a href="#接口索引集合介绍" class="headerlink" title="接口索引集合介绍"></a>接口索引集合介绍</h3><p>接口索引集合就用来描述这个类实现了哪些接口，这些被实现的接口将按implements关键字(如果这个Class文件表示的是一个接口，则应当是extends关键字)后的接口顺序从左到右排列在接口索引集合中。</p><h3 id="以我们的TestClass-class为例"><a href="#以我们的TestClass-class为例" class="headerlink" title="以我们的TestClass.class为例"></a>以我们的TestClass.class为例</h3><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210811235226.png><p>看到访问标志之后为<code>0x0003、0x0004、0x0000</code>，也就是说，类索引为3，父类索引为4，接口索引集合大小为0。查看我们对应的常量池：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811195614.png height=500></p><p>可以看到，类索引对应的常量池中的数据为#17，对应的Utf-8类型常量全限定名为TestClass类，对应的父类索引为#18，对应的Utf-8类型常量全限定名为Object类，接口索引集合大小为0，这是因为我们没有实现任何接口。</p><h2 id="字段表集合"><a href="#字段表集合" class="headerlink" title="字段表集合"></a>字段表集合</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>字段表（field_info）用于描述接口或者类中声明的变量。<br>Java语言中的“字段”（Field） 包括类级变量以及实例级变量，但不包括在方法内部声明的局部变量。<br>例如TestClass.class中的<code>private int m</code> 或者<code>private static int m</code>也可以，但是这个m不能在inc()方法之中，必须得在方法外。</p><h3 id="字段的修饰符"><a href="#字段的修饰符" class="headerlink" title="字段的修饰符"></a>字段的修饰符</h3><p>字段可以包括的修饰符有:</p><ol><li>字段的作用域 （public, private, protected修饰符）</li><li>是实例变量还是类变量（static修饰符）</li><li>可变性（final）</li><li>并发可见性（volatile修饰符，是否强制从主内存读写）</li><li>可否被序列化（transient修饰符）</li><li>字段数据类型（基本类型、对象、数组）</li><li>字段名称</li></ol><p>上述这些信息中，各个修饰符（1-5）都是布尔值，要么有某个修饰符，要么没有，很适合使用标志位来表示。<br>而字段叫做什么名字、字段被定义为什么数据类型（6-7），这些都是无法固定的，只能引用常量池中的常量来描述</p><h3 id="字段表结构"><a href="#字段表结构" class="headerlink" title="字段表结构"></a>字段表结构</h3><table><thead><tr><th>类型</th><th>名称</th><th>数量</th><th>介绍</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>1</td><td>字段修饰符（例如public或private）</td></tr><tr><td>u2</td><td>name_index</td><td>1</td><td>字段的简单名称(例如private int m)中就是m</td></tr><tr><td>u2</td><td>descriptor_index</td><td>1</td><td>字段的描述索引，例如private int m中就是I,也就是对应的int</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td><td>字段的属性值的数量</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td><td>例如private int m &#x3D; 100中的100</td></tr></tbody></table><ol><li>access_flag<br>字段访问标志，如下所示：</li></ol><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210812004431.png"></p><p>与我们之前介绍的类中的access_flags是很类似的。用来描述方法的标志。</p><p>跟随access_flags标志的是两项索引值，name_index和descriptor_index，它们都是<strong>对常量池的引用</strong>，分别代表字段的<strong>简单名称</strong>以及字段和方法的<strong>描述符</strong>。</p><ul><li>全限定名<br><code>com/coachhe/clazz/TestClass</code>是这个类的全限定名，仅仅是把类全名中的”.“换成了”&#x2F;“。</li><li>简单名称<br>简单名称就是指没有类型和参数修饰的方法或者字段名称，比如inc()方法和m字段的简单名称就是inc和m</li><li>描述符<br>  描述符作用：<br>  描述符的作用是用来描述字段的数据类型、方法的参数列表（包括数量、类型以及顺序）和返回值。<br>  描述符规则：<br>  基本数据类型以及代表无返回值的void类型都用一个大写字符来表示，而对象用L加对象的全限定名来表示。而对于数组，每一维度将使用一个前置的”[“来描述。比如一个被定义为”java.lang.String[][]“类型的二维数组将被记录成[[Ljava&#x2F;lang&#x2F;String，其中前面两个[表示这是一个二维数组，后面的L表示是一个对象，“java&#x2F;lang&#x2F;String”表示这是一个String类型。<br>  用描述符来描述方法时，按照先参数列表、后返回值的顺序描述，参数列表按照参数的严格顺序放在一组小括号“()”里。如方法<code>void inc()</code>的描述符为<code>()V</code>，方法<code>java.lang.String toString()</code>的描述符为<code>()Ljava/Lang/String</code>，方法<code>int indexOf(char[] source, int sourceOffset, char[] target, int targetOffset, int fromIndex)</code>的描述符为<code>([CII[CIII)I</code>。</li></ul><h3 id="以我们的TestClass-class为例-1"><a href="#以我们的TestClass-class为例-1" class="headerlink" title="以我们的TestClass.class为例"></a>以我们的TestClass.class为例</h3><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210812234554.png><p>结合之前的顺序表：</p><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210812234711.png height=500><p>和fields的数据结构：</p><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210812235756.png height=200><p>可以看到，接口索引之后是fields_count，为<code>0x0001</code>，也就是数量为1，表示我们类中的字段表只有1个（也就是我们定义的m）。<br>fields_count之后是fields，fields结构为在之前已经讲过，首先是2个字节的access_flags，值为<code>0x0002</code>，是十进制的2，查阅我们之前的标志位表，表明为private方法。接着是2个字节的name_index，值为<code>0x0005</code>，从常量表中可以看到，对应的是一个UTF8类型的m，再接着是2个字节的descriptor_index，值为<code>0x0006</code>，对应常量池为UTF8类型的I，表明为一个int类型，此时已经知道，我们定义了一个类变量，并且定义的方式是<code>private int m</code>。</p><p>注意：<br>因为我们这里没有给其赋值，所以后面再接了两个字节的attributes_count大小为0，如果我们将字段m的声明改为<code>final static int m = 123</code>，那么就会存在一个ConstantValue的属性，其值指向常量123.</p><h2 id="方法表集合"><a href="#方法表集合" class="headerlink" title="方法表集合"></a>方法表集合</h2><p>Class文件存储格式中对方法的描述与字段的描述采用了几乎完全一致的方式。</p><p>方法表结构：</p><table><thead><tr><th>类型</th><th>名称</th><th>数量</th><th>介绍</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>1</td><td>方法修饰符（例如public或private）</td></tr><tr><td>u2</td><td>name_index</td><td>1</td><td>方法的简单名称(例如private int imc())中就是imc</td></tr><tr><td>u2</td><td>descriptor_index</td><td>1</td><td>方法的描述索引，例如private int imc()中就是I,也就是对应的int</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td><td>方法的属性值的数量</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td><td></td></tr></tbody></table><h3 id="以我们的TestClass-class为例-2"><a href="#以我们的TestClass-class为例-2" class="headerlink" title="以我们的TestClass.class为例"></a>以我们的TestClass.class为例</h3><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210813001217.png height=500><p>可以看到，和字段表集合非常类似，首先是0002，表示集合里有两个方法，一个是源码中的inc()，第二个方法是为编译器添加的实例构造器&lt;init&gt;。<br>接下来首先看看第一个方法，</p><ol><li>标志为0001，表明是一个public方法</li><li>接着是名称索引0007，查看常量池对应为&lt;init&gt;，说明方法名叫做&lt;init&gt;</li><li>然后是描述符索引值为0008，对应()V，也就是说这是一个void方法，并且没有参数</li></ol><p>此时我们已经可以得到，这个方法为<code>public void &lt;init&gt;()</code></p><ol start="4"><li>接着属性表计数器attributes_count的值为0001，表示此方法的属性表集合有一个属性</li><li>接着看为0009，对应常量池为Code，说明这个属性是方法的字节码描述。</li></ol><p>看到这里，相信大家都会有跟我一样的疑惑，我们现在知道方法为<code>public void &lt;init&gt;()</code>，但是里面的代码呢？？被吃了吗？只知道对应一个Code，这到底是啥？<br>实际上，方法里的Java代码，经过Javac编译器编译成字节码指令之后，存放在方法属性表集合中一个名为“Code”的属性里面，属性表作为Class文件格式中最具拓展性的一种数据项目，我们现在来好好分析分析。</p><h2 id="属性表集合"><a href="#属性表集合" class="headerlink" title="属性表集合"></a>属性表集合</h2><p>属性表集合相信大家都不陌生，在Class文件、字段表、方法表中都可以携带自己的属性表集合，以描述某些场景转悠的信息。</p><p>与Class文件中其他的数据项目要求严格的顺序、长度和内容不同，属性表集合的限制稍微宽松一些，不再要求各个属性表具有严格顺序，并且《Java虚拟机规范》允许只要不与已有属性名重复，任何人实现的编译器都可以向属性表中写入自己定义的属性信息，Java 虚拟机运行时会忽略掉它不认识的属性 。为了能正确解析Class文件，《Java虚拟机规范》 最初只预定义了 9项所有Java虚拟机实现都应当能识别的属性，而在最新的《Java虚拟机规范》的Java SE 12版本中，预定义属性已经增加到29项。</p><p>在这里列出部分常见的预定义属性，具体的可以查看《深入理解Java虚拟机》第三版P231。</p><table><thead><tr><th>属性名称</th><th>使用位置</th><th>含义</th></tr></thead><tbody><tr><td>Code</td><td>方法表</td><td>Java代码编译成的字节码指令</td></tr><tr><td>ConstantValue</td><td>字段表</td><td>由final关键字定义的常量值</td></tr><tr><td>Deprecated</td><td>类、方发表、字段表</td><td>被声明为deprecated的方法和字段</td></tr><tr><td>Exceptions</td><td>方法表</td><td>方法抛出的异常列表</td></tr><tr><td>…….</td><td></td><td></td></tr></tbody></table><p>对于每一个属性，它的名称都要从常量池中引出一个CONSTANT_Utf8_info类型的常量所占用的位数即可。<br>一个符合规则的属性表应该满足以下定义的结构：</p><table><thead><tr><th>类型</th><th>名称</th><th>数量</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u1</td><td>info</td><td>attribute_length</td></tr></tbody></table><h3 id="Code属性"><a href="#Code属性" class="headerlink" title="Code属性"></a>Code属性</h3><p>Java程序方法体里面的代码经过Javac编译器处理之后，最终变为字节码指令存储在Code属性内。Code属性出现在方法表的属性集合之中<br>注意：<br>但并非所有的方法表都必须存在这个属性，譬如接口或者抽象类中的方法就不存在Code属性，如果方法表有Code属性存在, 那么它的结构将如下所示：</p><p>Code属性表的结构：</p><table><thead><tr><th>类型</th><th>名称</th><th>数量</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>max_stack</td><td>1</td></tr><tr><td>u2</td><td>max_locals</td><td>1</td></tr><tr><td>u4</td><td>code_length</td><td>1</td></tr><tr><td>u1</td><td>code</td><td>code_length</td></tr><tr><td>u2</td><td>exception_table_length</td><td>1</td></tr><tr><td>exception_info</td><td>exception_table</td><td>exception_table_length</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td></tr></tbody></table><p>注意：<br>这里并不和上面的属性表结构相冲突，只是info部分更加具体化了。</p><ol><li><code>attribute_name_index</code>(属性名称)<br>attribute_name_index是一项指向CONSTANT_Utf8_info型常量的索引，此常量值固定为”Code”，它代表该属性的属性名称。</li><li><code>attribute_length</code>(属性值长度)<br>attribute_length指示了属性值的长度。由于前两个类型分别为u2和u4，共6个字节，所以属性值的长度固定为整个属性表长度-6</li><li><code>max_stack</code>(操作数栈深度最大值)<br>max_stack代表了操作数栈深度的最大值。在方法执行时操作数栈不会超过这个深度。虚拟机运行的时候需要根据这个值来分配栈帧中的操作栈深度。</li><li><code>max_locals</code>(局部变量表所需存储空间)<br>max_locals代表了局部变量表所需的存储空间。max_locals的单位是变量槽（Slot），变量槽是虚拟机为<strong>局部变量</strong>分配内存所使用的最小单位。<br><strong>注意</strong> :<br>局部变量就是方法中的变量，区别于之前的类变量和实例变量。<br>局部变量表占用Slot情况：<br> <strong>a</strong>. 对于byte、char、float、int、short、boolean和returnAddress等长度不超过32位的数据类型，每个局部变量占用一个变量槽。<br> <strong>b</strong>. double和long这两种64位的数据类型则需要两个变量槽来存放。<br> <strong>c</strong>. 方法参数（包括实例方法中的隐藏参数“this”）<br> <strong>d</strong>. 显式异常处理程序的参数（也就是<code>try-catch</code>块中所定义的异常）<br> <strong>e</strong>. 方法体中定义的局部变量也需要依赖局部变量表来存放</li></ol><p>注意，并不是在方法中用了多少个局部变量，就把这些局部变量所占变量槽数量之和作为<code>max_locals</code>的值，操作数栈和局部变量表直接决定一个该方法的栈帧所耗费的内存，不必要的操作数栈深度和变量槽数量会造成内存的浪费。Java虚拟机的做法是将局部变量表中的变量槽进行重用，当代码执行超出一个局部变量的作用域时，这个局部变量所占的变量槽可以被其他局部变量所使用 ，Javac编译器会根据变量的作用域来分配变量槽给各个变量使用，根据同时生存的最大局部变量数量和类型计算出max_ locals的大小。</p><ol start="5"><li><code>code_length</code>和<code>code</code><br><code>code_length</code>和<code>code</code>用来存储程序编译后生成的字节码指令。<br><code>code_length</code>代表字节码长度，<code>code</code>是用于存储字节码指令的一系列字节流。<br><strong>字节码指令的含义：</strong><br>每个指令就是一个u1类型的单字节，当虚拟机读取到code中的一个字节码时，就可以 对应找出这个字节码代表的是什么指令 ，并且可以知道这条指令后面是否需要跟随参数， 以及后续的参数应当如何解析。</li></ol><h4 id="Code属性的重要性"><a href="#Code属性的重要性" class="headerlink" title="Code属性的重要性"></a>Code属性的重要性</h4><p>Code属性是Class文件中&#x3D;&#x3D;最重要的一个属性&#x3D;&#x3D;，如果把一个Java程序中的信息分为代码 （Code,方法体里面的Java代码）和元数据（Metadata,包括类、字段、方法定义及其他信息）两部分，那么<strong>在整个Class文件里，Code属性用于描述代码，所有的其他数据项目都用于描述元数据</strong>。<br>了解Code属性是学习后面关于字节码执行引擎内容的<strong>必要基础</strong>，能直接阅读字节码也是工作中分析Java代码语义问题的<strong>必要工具和基本技能</strong>，</p><p>因为Code属性如此重要，因此我们用一个很详细的实例来分析一下JVM是怎么使用这个属性的</p><h4 id="Code属性的使用"><a href="#Code属性的使用" class="headerlink" title="Code属性的使用"></a>Code属性的使用</h4><p>让我们接着分析之前的TestClass.class。之前分析到0009，对应常量池为Code，说明这个属性是方法的字节码描述。<br>接着往下看：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210813101723.png height=500></p><p>根据之前的分析我们知道，首先attribute_name_index是0009，固定指向常量池的Code，接着是0000001d，4个字节，转换成10进制为30，也就是说，属性值长度为30。<br>再接着看，接下来2个字节为max_stack，值为0001，再接着2个字节为max_locals，也为0001，再接着4个字节为00000005，为code_length，表示字节码长度，表示接下来5个字节是对应的字节码，我们可以看到，为<code>2a b7 00 01 b1</code>。<br>我们知道，每个字节码对应一个字节，所以我们一个一个来进行分析。</p><ol><li><code>0x2a</code><br>第一个字节是2a，通过查表可以得到，对应的指令为aload_0</li></ol><p>我们先看看aload_所对应的字节码指令：</p><table><thead><tr><th>字节码</th><th>助记码</th><th>指令含义</th></tr></thead><tbody><tr><td><code>0x2a</code></td><td>aload_0</td><td>将第一个引用类型本地变量推送至栈顶</td></tr><tr><td><code>0x2b</code></td><td>aload_1</td><td>将第二个引用类型本地变量推送至栈顶</td></tr><tr><td><code>0x2c</code></td><td>aload_2</td><td>将第三个引用类型本地变量推送至栈顶</td></tr><tr><td><code>0x2d</code></td><td>aload_3</td><td>将第四个引用类型本地变量推送至栈顶</td></tr></tbody></table><p>从表中可以看到，<code>aload_0</code>这个指令的含义是将第0个<strong>变量槽</strong>（也就是局部变量表，下面的LocalVariableTable）中名为reference类型的本地变量推送到操作数栈顶。在这里，就是将this引用推送至栈顶。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">public com.coachhe.clazz.LocalVariableTest();<br>  descriptor: ()V<br>  flags: (0x0001) ACC_PUBLIC<br>  Code:<br>    stack=1, locals=1, args_size=1<br>       0: aload_0<br>       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>       4: return<br>    LocalVariableTable:<br>      Start  Length  Slot  Name   Signature<br>          0       5     0  this   Lcom/coachhe/clazz/LocalVariableTest;<br></code></pre></td></tr></table></figure><ol start="2"><li><code>0xb7</code><br>将this引用推送至栈顶之后，读入<code>0xb7</code>，查表得到其对应的指令为invokespecial</li></ol><p>invokespecial指令：<br>这条指令的作用是以栈顶reference类型的数据所指向的对象作为方法接受者，调用此对象的实例构造方法、private方法或者它的父类的方法。<br>这个方法有一个u2类型的参数说明具体调用哪一个方法，他指向常量池中的CONSTANT_Methodref_info类型常量，也就是这个方法的符号引用。</p><ol start="3"><li><code>0x0001</code><br>这是invokespecial指令的参数，代表一个符号引用，查看对应的常量为实例构造器“&lt;init&gt;()”方法的符号引用。</li><li><code>0xb1</code><br>查表之后发现对应指令为return，含义是从方法的返回，并且返回值为void。这条指令执行后，当前方法正常结束。</li></ol><p>这段字节码虽然很短，但我们可以从中看出它执行过程中的数据交换、方法调用等操作都是基于栈（操作数栈）的。关于虚拟机字节码执行的讲解是后面两章的话题，我们不妨把这里的疑问放到[[8 虚拟机字节码执行引擎]]去解决。</p><p>再次执行<code>javap -verbose TestClass</code>，我们可以验证刚才的计算，并且可以验证我们刚才的另一个方法<code>inc()</code>。<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210813131057.png height=500></p><p>可以看到，这个跟我们之前的计算结果是完全相同的。</p><p>注意：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210813131303.png height=200></p><p>可是我明明没有参数，为什么这里的size为什么会是1呢？<br>回答：<br>这是因为在任何实例方法里面，都可以<strong>通过this关键字访问到此方法所属的对象</strong>。<br>这个访问机制对Java程序的编写很重要，而它的实现非常简单，仅仅是通过在Javac编译器编译的时候把对this关键字的访问转变为对一个普通方法参数的访问，然后再虚拟机调用实例方法时自动传入此参数而已。因此在实例方法的局部变量表中至少会存在一个指向当前对象实例的局部变量，局部变量表也会预留出第一个变量槽位来存放对象实例的引用，所以实例方法参数值从1开始计算。<br>不过这种方式只对实例方法有效，对于static修饰的方法，如果没有参数，size就为0了。</p><h4 id="异常表"><a href="#异常表" class="headerlink" title="异常表"></a>异常表</h4><p>如果存在异常表，那它的格式应如下所示:</p><table><thead><tr><th>类型</th><th>名称</th><th>数量</th></tr></thead><tbody><tr><td>u2</td><td>start_pc</td><td>1</td></tr><tr><td>u2</td><td>end_pc</td><td>1</td></tr><tr><td>u2</td><td>handler_pc</td><td>1</td></tr><tr><td>u2</td><td>catch_type</td><td>1</td></tr></tbody></table><p>包含四个字段，这些字段的含义为: 如果当字节码从第start_pc行到第end_pc行之间(不含第end_pc行)出现了类型为catch_type或者其子类的异常(catch_type为指向一个CONSTANT_Class_info型常量的索引)，则转到第handler_pc行继续处理。当catchjype的值为0时，代表任意异常情况都需要转到handler_pc处进行处理。</p><p>Java源代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.clazz;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionTestClass</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">inc</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">int</span> x;<br>        <span class="hljs-keyword">try</span> &#123;<br>            x = <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> x;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            x = <span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">return</span> x;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            x = <span class="hljs-number">3</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>编译后的ByteCode字节码及异常表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">inc</span><span class="hljs-params">()</span>;<br>    descriptor: ()I<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=<span class="hljs-number">1</span>, locals=<span class="hljs-number">5</span>, args_size=<span class="hljs-number">1</span><br>         <span class="hljs-number">0</span>: iconst_1    <span class="hljs-comment">// 将int型1推送至栈顶</span><br>         <span class="hljs-number">1</span>: istore_1<span class="hljs-comment">// 将栈顶int型数值存入第二个本地变量</span><br>         <span class="hljs-number">2</span>: iload_1<span class="hljs-comment">// 将第二个int型本地变量推送至栈顶</span><br>         <span class="hljs-number">3</span>: istore_2<span class="hljs-comment">// 将栈顶int型数值存入第三个本地变量</span><br>         <span class="hljs-number">4</span>: iconst_3<br>         <span class="hljs-number">5</span>: istore_1<br>         <span class="hljs-number">6</span>: iload_2<br>         <span class="hljs-number">7</span>: ireturn<br>         <span class="hljs-number">8</span>: astore_2<br>         <span class="hljs-number">9</span>: iconst_2<br>        <span class="hljs-number">10</span>: istore_1<br>        <span class="hljs-number">11</span>: iload_1<br>        <span class="hljs-number">12</span>: istore_3<br>        <span class="hljs-number">13</span>: iconst_3<br>        <span class="hljs-number">14</span>: istore_1<br>        <span class="hljs-number">15</span>: iload_3<br>        <span class="hljs-number">16</span>: ireturn<br>        <span class="hljs-number">17</span>: astore        <span class="hljs-number">4</span><br>        <span class="hljs-number">19</span>: iconst_3<br>        <span class="hljs-number">20</span>: istore_1<br>        <span class="hljs-number">21</span>: aload         <span class="hljs-number">4</span><br>        <span class="hljs-number">23</span>: athrow<br>      Exception table:<br>         from    to  target type<br>             <span class="hljs-number">0</span>     <span class="hljs-number">4</span>     <span class="hljs-number">8</span>   Class java/lang/Exception<br>             <span class="hljs-number">0</span>     <span class="hljs-number">4</span>    <span class="hljs-number">17</span>   any<br>             <span class="hljs-number">8</span>    <span class="hljs-number">13</span>    <span class="hljs-number">17</span>   any<br>            <span class="hljs-number">17</span>    <span class="hljs-number">19</span>    <span class="hljs-number">17</span>   any<br>      LineNumberTable:<br>        line <span class="hljs-number">7</span>: <span class="hljs-number">0</span><br>        line <span class="hljs-number">8</span>: <span class="hljs-number">2</span><br>        line <span class="hljs-number">13</span>: <span class="hljs-number">4</span><br>        line <span class="hljs-number">8</span>: <span class="hljs-number">6</span><br>        line <span class="hljs-number">9</span>: <span class="hljs-number">8</span><br>        line <span class="hljs-number">10</span>: <span class="hljs-number">9</span><br>        line <span class="hljs-number">11</span>: <span class="hljs-number">11</span><br>        line <span class="hljs-number">13</span>: <span class="hljs-number">13</span><br>        line <span class="hljs-number">11</span>: <span class="hljs-number">15</span><br>        line <span class="hljs-number">13</span>: <span class="hljs-number">17</span><br>        line <span class="hljs-number">14</span>: <span class="hljs-number">21</span><br>      StackMapTable: number_of_entries = <span class="hljs-number">2</span><br>        frame_type = <span class="hljs-number">72</span> <span class="hljs-comment">/* same_locals_1_stack_item */</span><br>          stack = [ <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>/lang/Exception ]<br>        frame_type = <span class="hljs-number">72</span> <span class="hljs-comment">/* same_locals_1_stack_item */</span><br>          stack = [ <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>/lang/Throwable ]<br>&#125;<br></code></pre></td></tr></table></figure><p>编译器为这段Java源码生成了三条异常表记录，对应三条可能出现的代码执行路径。 从Java代码的语义上讲，这三条执行路径分别为：</p><ul><li>如果try语句块中出现属于Exception或其子类的异常，转到catch语句块处理；</li><li>如果try语句块中出现不属于Exception或其子类的异常，转到finally语句块处理；</li><li>如果catch语句块中出现任何异常，转到finally语句块处理。</li></ul><h1 id="字节码指令简介"><a href="#字节码指令简介" class="headerlink" title="字节码指令简介"></a>字节码指令简介</h1><p>Java虚拟机的指令由一个字节长度的、代表着某种特定操作含义的数字 （称为操作码， Opcode）以及跟随其后的零至多个代表此操作所需的参数（称为操作数，Operand）构成。 由于Java虚拟机采用面向操作数栈而不是面向寄存器的架构（这两种架构的执行过程、区别和影响将在第8章中探讨），所以大多数指令都不包含操作数，只有一个操作码，指令参数都存放在操作数栈中。</p><h2 id="字节码指令伪代码"><a href="#字节码指令伪代码" class="headerlink" title="字节码指令伪代码"></a>字节码指令伪代码</h2><p>如果不考虑异常处理的话，那Java虚拟机的解释器可以使用下面这段伪代码作为最基本的执行模型来理解，这个执行模型虽然很简单，但依然可以有效正确地工作：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">do</span> &#123;<br>    自动计算PC寄存器的值加<span class="hljs-number">1</span>;<br>根据PC寄存器指示的位置，从字节码流中取出操作码；<br><span class="hljs-keyword">if</span>(字节码存在操作数):<br>从字节码流中取出操作数；<br>执行操作码所定义的操作；<br>&#125; <span class="hljs-keyword">while</span>(字节码流长度＞<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h2 id="字节码与数据类型"><a href="#字节码与数据类型" class="headerlink" title="字节码与数据类型"></a>字节码与数据类型</h2><p>在Java虚拟机的指令集中，大多数指令都包含其操作所对应的数据类型信息。<br>例如iload指令用于从局部变量中加载int型的数据到操作数栈中，而fload指令加载的则是float类型的数据。<br>因为Java虚拟机的操作码长度只有一字节，所以包含了数据类型的操作码就为指令集的设计带来了很大压力：如果每一种与数据类型相关的指令都支持Java虚拟机所有运行时数据类型的话，那么指令的数量恐怕就会超出一字节所能表示的数量范围了 。<br><strong>理解</strong>：<br>每个数据类型都有对应的操作，例如byte类型，应该有push,const,load,store,increase,….非常多指令，同样，short、int、long都应该有对应的那么多指令，如果每个指令都有对应的操作码，那么操作码长度早就超过1字节了。<br>因此，Java虚拟机的指令集对于特定的操作只提供了优先的类型相关指令去支持它，换句话说，Java虚拟机会被故意设计成非完全独立的，也就是很多指令可以共用同一条指令。</p><h3 id="设计方法"><a href="#设计方法" class="headerlink" title="设计方法"></a>设计方法</h3><p>大部分指令都没有支持整数类型byte、char和short,甚至没有任何指令支持boolean类型。编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将boolean和char类型数据零位扩展（Zero-Extend）为相应的int类型数据。与之类似，在处理boolean,byte, short和char类型的数组时，也会转换为使用对应的int类型的字节码指令来处理。因此，大多数对于boolean, byte, short和char类型数据的操作，实际上都是使用相应的对int类型作为运算类型（Computational Type）来进行的。</p><h3 id="加载和存储指令"><a href="#加载和存储指令" class="headerlink" title="加载和存储指令"></a>加载和存储指令</h3><p>加载和存储指令用于将数据在栈帧中的局部变量表和操作数栈（见[[2 Java内存区域与内存溢出异常]]）之间来回传输，这类指令包括：</p><ul><li>将一个局部变量加载到操作栈：iload、iload_&lt;n&gt;、lload_&lt;n&gt;、fload、fload_&lt;n&gt;、dload、dload_&lt;n&gt;、aload、aload_&lt;n&gt;</li><li>将一个数值从操作数栈存储到局部变量表：istore、istore_&lt;n&gt;、Istore、lstore_&lt;n&gt;、fstore、fstore_&lt;n&gt;、dstore、dstore_&lt;n&gt;、astore、astore_&lt;n&gt; </li><li>将一个常量加载到操作数栈：bipush、sipush、Idc、ldc_w、ldc2_w、aconst_null、iconst_m1、iconst__&lt;i&gt;、Iconst_&lt;1&gt;、fconst_&lt;f&gt;、dconst_&lt;d&gt;</li><li>扩充局部变量表的访问索引的指令：wide</li></ul><p>存储数据的操作数栈和局部变量表主要由加载和存储指令进行操作，除此之外，还有少量指令，如访问对象的字段或数组元素的指令也会向操作数栈传输数据。</p><h3 id="运算指令"><a href="#运算指令" class="headerlink" title="运算指令"></a>运算指令</h3><p>算术指令用于对操作数栈上的两个值进行某种特定运算，并把结果重新存入到操作栈顶。</p><h4 id="运算指令分类"><a href="#运算指令分类" class="headerlink" title="运算指令分类"></a>运算指令分类</h4><p>大体上运算指令可以分为两种：</p><ol><li>对整型数据进行运算的指令</li><li>对浮点型数据进行运算的指令。</li></ol><p>整数与浮点数的算术指令在溢出和被零除的时候也有各自不同的行为表现。无论是哪种算术指令，均是使用Java虚拟机的算术类型来进行计算的，换句话说是不存在直接支持byte、short、char和boolean类型的算术指令，对于上述几种数据的运算，应使用操作 int类型的指令代替。</p><h3 id="类型转换指令"><a href="#类型转换指令" class="headerlink" title="类型转换指令"></a>类型转换指令</h3><p>类型转换指令可以将两种不同的数值类型相互转换，这些转换操作一般用于实现用户 代码中的显式类型转换操作，或者用来处理本节开篇所提到的字节码指令集中数据类型相关指令无法与数据类型一一对应的问题。</p><p>Java虚拟机直接支持(即转换时无须显式的转换指令)以下数值类型的宽化类型转换 (Widening Numeric Conversion,即小范围类型向大范围类型的安全转换)：</p><ul><li>int类型到long、float或者double类型</li><li>long 类型到 float、double 类型</li><li>float类型到double类型</li></ul><p>与之相对的，处理窄化类型转换(Narrowing Numeric Conversion)时，就必须显式地 使用转换指令来完成，这些转换指令包括i2b、i2c、i2s、12i、f2i、⑵、d2i、d21和d2f。<br>窄化类型转换可能会导致转换结果产生不同的正负号、不同的数量级的情况，转换过程很可能会导致数值的精度丢失。</p><h3 id="对象的创建于访问指令"><a href="#对象的创建于访问指令" class="headerlink" title="对象的创建于访问指令"></a>对象的创建于访问指令</h3><p>虽然类实例和数组都是对象，但Java虚拟机对类实例和数组的创建与操作使用了不同的字节码指令。对象创建后，就可以通过对象访问指令获取对象实例或者数组实例中的字段或者数组元素，</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/56a377fa23ad.html"/>
    <url>/2022/12/56a377fa23ad.html</url>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>《深入理解JVM》原话：</p><p>虚拟机把描述类的数据从Class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被直接使用的Java类型，这就是虚拟机的类加载机制。</p><p><strong>注意</strong>：<br>这里指的Class文件不一定是本地的.class文件，而应该是一串二进制的字节流，无论什么形式都可以。</p><h2 id="Java语言类型加载、连接和初始化特点"><a href="#Java语言类型加载、连接和初始化特点" class="headerlink" title="Java语言类型加载、连接和初始化特点"></a>Java语言类型加载、连接和初始化特点</h2><p>在 Java 语言里面，类型的加载、连接和初始化过程都是在程序运行期间完成的。</p><ul><li>缺点：让Java语言进行提前编译会面临额外的困难，也会让类加载时稍微增加一些性能开销</li><li>优点：为Java应用提供了极高的拓展性和灵活性，Java天生可以动态扩展的语言特性就是依赖运行期动态加载和动态连接这个特点实现的。</li></ul><p>理解：<br>也就是说，在编写一个面向接口的应用程序的时候，可以等到运行时再指定其实际的实现类，用户可以通过Java预置的或自定义类加载器，让某个本地的应用程序在运行时从网络或者其他地方加载一个二进制流作为其程序代码的一部分。<br>例如，我们有一个接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Phone</span>()&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后我们有对应的main方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">phoneClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;xxx&quot;</span>);<br>        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> (Phone) phoneClass.newInstance();<br>        phone.call();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，我们可以在运行时动态加载，通过一些自定义的类加载器可以在运行时再确认具体的类型。</p><h2 id="类加载器子系统作用"><a href="#类加载器子系统作用" class="headerlink" title="类加载器子系统作用"></a>类加载器子系统作用</h2><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211209133115.png" width = "50%">1. 类加载器子系统负责从文件系统或者网络中加载 Class 文件2. ClassLoader 只负责 class 文件的加载，至于是否它可以运行，则有 Execution Engine 决定3. 加载的类信息存放于一块成为**方法区**的内存空间。除了类的信息外，方法区中还会存放运行时常量池信息，可能还包括字符串字面量和数字常量（这部分常量信息是 Class 文件中常量池部分的内存映射）<h2 id="类加载器-ClassLoader-角色"><a href="#类加载器-ClassLoader-角色" class="headerlink" title="类加载器 ClassLoader 角色"></a>类加载器 ClassLoader 角色</h2><h1 id="类加载的时机"><a href="#类加载的时机" class="headerlink" title="类加载的时机"></a>类加载的时机</h1><p>这部分建议结合[[2 Java内存区域与内存溢出异常]]中的<strong>对象探秘</strong>章节来进行学习，能加深对这部分知识的理解。</p><h2 id="类的生命周期"><a href="#类的生命周期" class="headerlink" title="类的生命周期"></a>类的生命周期</h2><p>类的生命周期共分为7个阶段。</p><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210810140918.png height=260><p>图中黑色字体部分的顺序是确定的。其余字体（解析和使用）的顺序不一定，解析过程在某些情况下可以在初始化阶段之后再开始，这是为了支持Java语言的<strong>动态绑定</strong>。</p><p>对于加载开始的时机，虚拟机规范并没有给强制的要求，但是对于初始化阶段, 《Java虚拟机规范》则是严格规定了<strong>有且只有</strong>六种情况必须立即对类进行“初始化”(而加载、 验证、准备自然需要在此之前开始)：</p><ol><li>遇到new、getstatic、putstatic或invokestatic这四条字节码指令<br>能生成这四条指令的典型Java代码场景有：<br> 1 使用new关键字实例化对象<br> 2 读取或设置一个类型的静态字段（被final修饰、已在编译器把结果放入常量池的静态字段除外）的时候<br> 3 调用一个类型的静态方法的时候</li><li>使用java.lang.reflect包的方法对类型进行反射调用的时候</li><li>当初始化类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化</li><li>当虚拟机启动时，用户需要指定一个要执行的主类（包含main。方法的那个类） 虚拟机会先初始化这个主类。</li><li>当使用JDK 7新加入的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果为 REF_getStatic、REF_putStatic、REF invokeStatic、REF newInvokeSpecial四种类型的方法句柄，并且这个方法句柄对应的类没有进行过初始化，则需要先触发其初始化。</li><li>当一个接口中定义了 JDK 8新加入的默认方法（被default关键字修饰的接口方法）时，如果有这个接口的实现类发生了初始化，那该接口要在其之前被初始化。</li></ol><p>注意：<br><strong>有且仅有</strong>这六种情况的行为会触发类型进行初始化。也就是说，其他的任何情况都不会触发初始化。</p><h3 id="主动引用和被动引用"><a href="#主动引用和被动引用" class="headerlink" title="主动引用和被动引用"></a>主动引用和被动引用</h3><p>上面介绍的这六种初始化场景中的行为称为对一个类进行<strong>主动引用</strong>。除此之外，所有引用类型的方法都不会触发初始化，称为<strong>被动引用</strong>。<br>这里给出三个被动引用的例子。<br>举例1：<br>通过子类引用父类的静态方法，不会导致子类初始化。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 父类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperClass</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;SuperClass init&quot;</span>);<br>    &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;<br>&#125;<br><br><span class="hljs-comment">// 子类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SuperClass</span>&#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;SubClass init&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Main方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotInitialization</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(SubClass.value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210815162433.png height=200></p><p>分析：<br>在这里，我们看到只输出了SuperClass init，而没有输出SubClass init，这是因为对于静态字段，只有直接定义这个字段的类才会被初始化，因此通过其子类来引用父类中定义的静态字段，只会触发父类的初始化而不会触发子类的初始化。</p><p>举例2：<br>通过数组定义来引用类，不会触发此类的初始化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotInitialization2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SuperClass[] sca = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuperClass</span>[<span class="hljs-number">10</span>];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210815162910.png height=200><br>分析：<br>可以看到，这里没有输出，说明并没有出发类SuperClass的初始化阶段。</p><p>举例3：<br>常量在编译阶段会存储调用类的常量池中，本质上没有直接引用到定义常量的类，因此不会触发定义常量的类初始化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ConstClass类</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstClass</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ConstClass init&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Main方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotInitialization3</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(ConstClass.HELLOWORLD);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>结果：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210815163256.png height=200></p><p>分析：<br>只输出了”hello world”没有输出ConstClass init，这是因为虽然在Java源码中确实引用了ConstClass类的常量HELLOWORLD，但其实在编译阶段通过常量传播优化，已经将常量值（也就是被final修饰的值）”hello world”直接存储在NotInitialization3类的常量池中，所以以后NotInitialization3对ConstClass.HELLOWORLD的引用，实际都转化成对自己常量池的引用了。<br>也就是说，实际上Notlnitialization的Class文件之中并没有ConstClass类的符号引用入口,这两个类在编译成Class文件后就已不存在任何联系了。<br>用代码来表示就是：<br>对于用final修饰的常量，直接使用和引用是一样的效果。<br>在我们这里，<code>System.out.println(ConstClass.HELLOWORLD)</code>等价于<code>System.out.println(&quot;ConstClass init&quot;)</code>。</p><h1 id="类加载的过程"><a href="#类加载的过程" class="headerlink" title="类加载的过程"></a>类加载的过程</h1><h2 id="1-加载"><a href="#1-加载" class="headerlink" title="1. 加载"></a>1. 加载</h2><p>注意：这里的加载≠类加载，只是类加载的一个阶段。<br>在加载阶段，Java虚拟机需要完成以下三件事情：</p><ol><li>通过一个类的全限定名来获取定义此类的二进制字节流</li><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。</li><li>在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口。</li></ol><p>注意：<br>这个阶段是最灵活的一个阶段，也是开发人员可控性最强的阶段。<br>例如“通过一个类的全限定名来获取定义此类的二进制字节流”这条规则.它并没有指明二进制字节流必须得从某个Class文件中获取，确切地说是根本没有指明要从哪里获取、如何获取。仅仅这一点空隙，Java虚拟机的使用者们就可以在加载阶段搭构建出一个相当开放广阔的舞台，Java发展历程中，充满创造力的开发人员则在这个舞台上玩出了各种花样，许多举足轻重的Java技术都建立在这一基础之上，</p><ul><li>例如最典型的从ZIP压缩包中读取，也就是日后JAR格式的基础。</li><li>从网络中获取</li><li>运行时计算生成，这种场景用的最多的就是动态代理技术。</li><li>…</li></ul><p>加载阶段既可以使用Java虚拟机里内置的引导类加载器来完成，也可以由用户自定义的类加载器去完成，开发人员 通过定义自己的类加载器去控制字节流的获取方式（重写一个类加载器的findClass()或loadClass()方法），实现根据自己的想法来赋予应用程序获取运行代码的动态性。</p><p>也就是说，加载阶段完成之后，类加载器已经调用过loadClass方法来生成一个Class对象了（具体可以看[[Java反射浅析]])。</p><p>具体来说，加载阶段结束后，Java虚拟机外部的二进制字节流就按照虚拟机所设定的格式存储在方法区之中了，方法区中的数据存储格式完全由虚拟机实现自行定义，《Java虚拟机规范》未规定此区域的具体数据结构。类型数据妥善安置在方法区之后，会在Java堆内存中实例化一个java.lang.dass类的对象，这个对象将作为程序访问方法区中的类型数据的外部接口。加载阶段与连接阶段的部分动作（如一部分字节码文件格式验证动作）是交叉进行的，加载阶段尚未完成，连接阶段可能已经开始，但这些夹在加载阶段之中进行的动作，仍然属于连接阶段的一部分，这两个阶段的开始时间仍然保持着固定的先后顺序。</p><h2 id="2-验证"><a href="#2-验证" class="headerlink" title="2. 验证"></a>2. 验证</h2><p>首先我们介绍一下连接阶段，这个阶段公共分为三个部分：</p><ul><li>验证</li><li>准备</li><li>解析</li></ul><p>解析阶段的目的是确保Class文件的字节流包含的信息符合《Java虚拟机规范》的全部约束要求，保证这些信息被当成代码运行后不会危害虚拟机自身的安全。</p><p>验证阶段是非常重要的，这个阶段是否严谨，直接决定了Java虚拟机是否能承受恶意代码的攻击，从代码量和耗费的执行性能的角度上讲，验证阶段的工作量在虚拟机的类加载过程中占了相当大的比重。</p><h3 id="验证的几个阶段"><a href="#验证的几个阶段" class="headerlink" title="验证的几个阶段"></a>验证的几个阶段</h3><ol><li>文件格式验证</li><li>元数据验证</li><li>字节码验证</li><li>符号引用验证</li></ol><h2 id="3-准备"><a href="#3-准备" class="headerlink" title="3. 准备"></a>3. 准备</h2><p>准备阶段是正式为<strong>类中定义的变量</strong>（也就是静态变量，被static修饰的变量）分配内存并设置类变量初始值的阶段。</p><p>从概念上讲，这些变量所使用的内存都应当在方法区中分配，但必须注意到方法区本身是一个逻辑上的区域，&#x3D;&#x3D;在JDK8之后，类变量则会随着Class对象一起存放在Java堆中&#x3D;&#x3D;，这时候”类变量在方法区“已经完全是一种对逻辑概念的表述了。具体可以参考（[[4 虚拟机性能监控、故障处理工具]]）。</p><p>关于准备阶段，还有两个需要注意的：</p><ol><li>在这时候进行内存分配的仅包括类变量，而不包括实例变量，实例变量将会在对象实例化的时候随着对象一起分配在Java堆中。<br> 也就是说，只有用static修饰的变量才会分配内存并且设置初始值，实例变量在对象实例化的时候才会进行内存的分配。<br> 更加具体来说。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>&#123;<br>       <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;<br>       <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">456</span>;<br>   &#125;<br></code></pre></td></tr></table></figure> 对于这个类，被<code>static</code>修饰的变量<code>a</code>会在准备阶段被分配内存并且设置初始值(<code>0</code>)，但是没有被<code>static</code>修饰的变量<code>b</code>则不会在准备阶段被分配内存，只会在<code>new A()</code>的时候才会分配内存。</li><li>这里所说的初始值，<strong>通常情况下</strong>是数据类型的零值。<br> 还是上面的例子，变量<code>a</code>在准备阶段之后的初始值是0而不是123，因为这时候尚未开始执行任何Java方法，而把value赋值为123的<code>putstatic</code>指令是程序被编译后，存放于类构造器<code>&lt;clinit&gt;()</code>之中，所以把<code>value</code>赋值为123的动作要到类的初始化阶段才会被执行。<br> 再次回忆我们这个图： <img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210810140918.png height=200> 看到初始化在准备阶段之后，所以其不会那么快被赋值。</li></ol><p>还需要注意的一点是，上面提到的是在“通常情况”下初始值是零值，也就是说会有一些“特殊情况”：如果类字段的字段属性表中存在ConstantValue属性，那在准备阶段变量值就会被初始化为ConstantValue属性所指定的初始值，假设上面的类变量<code>a</code>的定义修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;<br></code></pre></td></tr></table></figure><p>编译时Javac将会为value生成ConstantValue属性，在准备阶段虚拟机就会根据ConstantValue的设置将value赋值为123。</p><h2 id="4-解析"><a href="#4-解析" class="headerlink" title="4. 解析"></a>4. 解析</h2><p>解析阶段是Java虚拟机将常量池内的符号引用替换为直接引用的过程。</p><p>回忆一下符号引用，在第6章（[[6 类文件结构]]）讲解Class文件格式的时候就已经出现了很多次，在Class文件中它以CONSTANT_Class_info、CONSTANT_Methodref_info等类型的常量出现。</p><h3 id="直接引用和符号引用的关系"><a href="#直接引用和符号引用的关系" class="headerlink" title="直接引用和符号引用的关系"></a>直接引用和符号引用的关系</h3><h4 id="符号引用"><a href="#符号引用" class="headerlink" title="符号引用"></a>符号引用</h4><p>符号引用以一组符号来描述所引用的目标，符号可以是任何形式的字面量，只要使用时能无歧义地定位到目标即可。<br>符号引用与虚拟机的实现的内存布局无关，引用的目标并不一定是已经加载到虚拟机内存当众的内容。各种虚拟机实现的内存布局可以各不相同，但是它们能接受的符号引用必须是一致的，因为符号引用的字面量形式明确定义在《Java虚拟机规范》的Class文件格式中。</p><h4 id="直接引用"><a href="#直接引用" class="headerlink" title="直接引用"></a>直接引用</h4><p>直接引用是可以直接指向目标的指针、相对偏移量或者是一个能间接定位到目标的句柄。直接引用是和虚拟机实现的内存布局直接相关的，同一个符号引用在不同虚拟机实例上翻译出来的直接引用一般不会相同。如果有了直接引用，要引用的目标必定已经在虚拟机的内存中存在。</p><h3 id="解析的时机"><a href="#解析的时机" class="headerlink" title="解析的时机"></a>解析的时机</h3><p>《Java虚拟机规范》之中并未规定解析阶段发生的具体时间，只要求了在执行<code>anewarray</code>、<code>checkcast</code>、 <code>getfield</code>、<code>getstatic</code>、<code>instanceof</code>、<code>invokedynamic</code>、<code>invokeinterface</code>、<code>invokespecial</code>、<code>invokestatic</code>、<code>invokevirtual</code>、<code>Idc</code>、<code>ldc_w</code>、<code>ldc2_w</code>、<code>multianewarray</code>、<code>new</code>、<code>putfield</code> 和 <code>putstatic</code>这17个用于操作符号引用的字节码指令之前，先对它们所使用的符号引用进行解析。所以虚拟机实现可以根据需要来<strong>自行判断</strong>，到底是在类被加载器加载时就对常量池中的符号引用进行解析，还是等到一个符号引用将要被使用前才去解析它。</p><p>对同一个符号引用进行多次解析请求是很常见的事情，除<code>invokedynamic</code>指令以外，虚拟机实现可以对第一次解析的结果进行缓存（在运行时常量池中记录直接引用，并把常量标识为已解析状态）从而避免解析动作重复进行。<br><strong>解释</strong>：除了invokedynamic之外，其他情况下多次解析的结果是相同的，因此可以将常量标识为已解析状态并且记录在运行时常量池中，下次可以直接使用。</p><p>不过对于<code>invokedynamic</code>指令，上面的规则就不成立了。当碰到某个前面已经由<code>invokedynamic</code>指令触发过解析的符号引用时，并不意味着这个解析结果对于其他<code>invokedynamic</code>指令也同样生效。<br>因为<code>invokedynamic</code>指令的目的本来就是用于动态语言支持，它对应的引用称为“动态调用点限定符(Dynamically-Computed Call Site Specifier)”</p><h4 id="动态的含义："><a href="#动态的含义：" class="headerlink" title="动态的含义："></a>动态的含义：</h4><p>“动态”的含义是指必须等到程序实际运行到这条指令时，解析动作才能进行。相对地，其余可触发解析的指令都是“静态”的，可以在刚刚完成加载阶段，还没有开始执行代码时就提前进行解析。</p><h3 id="解析的对象和对应常量类型"><a href="#解析的对象和对应常量类型" class="headerlink" title="解析的对象和对应常量类型"></a>解析的对象和对应常量类型</h3><p>解析动作主要针对类和接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符这7类符号引用进行，分别对应于常量池的的CONSTANT_Class_info、CONSTANT_Fieldref_info、CONSTANT_Methodref_info、CONSTANT_InterfaceMethodref_info、CONSTANT_MethodType_info、 CONSTANT_MethodHandle_info, CONSTANT_Dynamic_info和CONSTANT_InvokeDynamic_info 8种常量类型。</p><h3 id="解析过程"><a href="#解析过程" class="headerlink" title="解析过程"></a>解析过程</h3><h4 id="1-类和接口的解析"><a href="#1-类和接口的解析" class="headerlink" title="1. 类和接口的解析"></a>1. 类和接口的解析</h4><p>假设当前代码所处的类为D，如果要把一个从未解析过的符号引用N解析为一个类或接口C的直接引用，那虚拟机完成整个解析的过程需要包括以下3个步骤： </p><ol><li>如果C不是一个数组类型，那虚拟机将会把代表N的全限定名传递给D的类加载器去加载这个类C。在加载过程中，由于元数据验证、字节码验证的需要，又可能触发其他相关类的加载动作，例如加载这个类的父类或实现的接口。一旦这个加载过程出现了任何异常，解析过程就将宣告失败</li><li>如果C是一个数组类型，并且数组的元素类型为对象，也就是N的描述符会是类似<code>[Ljava/lang/Integer</code>的形式，那将会按照第一点的规则加载数组元素类型。如果N的描述符如前面所假设的形式，需要加载的元素类型就是“java.lang.Integer”，接着由虚拟机生成一个代表该数组维度和元素的数组对象C</li><li>如果上面两步没有出现任何异常，那么C在虚拟机中实际上已经成为一个有效的类或接口了，但在解析完成前还要进行符号引用验证，确认D是否具备对C的访问权限。如果发现不具备访问权限，将抛出java.lang.IllegalAccessError异常，</li></ol><p>总结一下，就是<strong>先加载，然后检查访问权限</strong>。</p><p>针对上面第3点访问权限验证，在JDK9引入了模块化以后，一个public类型也不再 意味着程序任何位置都有它的访问权限，我们还必须检查模块间的访问权限。<br>如果我们说一个D拥有C的访问权限，那就意味着以下3条规则中至少有其中一条成立：</p><ul><li>被访问类C是public的，并且与访问类D处于同一个模块。</li><li>被访问类C是public的，不与访问类D处于同一个模块，但是被访问类C的模块 允许被访问类D的模块进行访问。</li><li>被访问类C不是public的，但是它与访问类D处于同一个包中。</li></ul><h4 id="2-字段解析"><a href="#2-字段解析" class="headerlink" title="2. 字段解析"></a>2. 字段解析</h4><p>要解析一个未被解析过的字段符号引用，首先将会对字段表内<code>class_index</code>项中索引的<code>CONSTANT_Class_info</code>符号引用进行解析，也就是字段所属的类或接口的符号引用。如果在解析这个类或接口符号引用的过程中出现了任何异常，都会导致字段符号引用解析的失败如果解析成功完成，那把这个字段所属的类或接口用<code>C</code>表示，《Java虚拟机规范》要求按照如下步骤对<code>C</code>进行后续字段的搜索：</p><ol><li>如果<code>C</code>本身就包含了简单名称和字段描述符都与目标相匹配的字段，则返同这个字段的直接引用，查找结束。</li><li>否则，如果在<code>C</code>中实现了接口，将会按照继承关系从下往上递归搜索各个接口和它的父接口，如果接口中包含了简单名称和字段描述符都与目标相匹配的字段，则返回这个字段的直接引用，查找结束。</li><li>否则，如果<code>C</code>不是java.lang.Object的话，将会按照继承关系从下往上递归搜索其父类，如果在父类中包含了简单名称和字段描述符都与目标相匹配的字段，则返回这个字段的直接引用，查找结束。</li><li>否则,查找失败，抛出 java.lang.NoSuchFieldError 异常。</li></ol><p>如果查找过程成功返回了引用，将会对这个字段进行权限验证，如果发现不具备对字段的访问权限，将抛出java.lang.IllegalAccessError异常。</p><p>以上解析规则能够确保Java虚拟机获得字段唯一的解析结果，但在实际情况中，Javac编译器往往会采取比上述规范更加严格一些的约束，譬如有一个同名字段同时出现在某个类的接口和父类当中，或者同时在自己或父类的多个接口中出现，按照解析规则仍是可以确定唯一的访问字段，但Javac编译器就可能直接拒绝其编译为Class文件。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.第<span class="hljs-number">4</span>节_字段解析;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FieldResolution</span> &#123;<br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface0</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">A</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Interface0</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">A</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface2</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">A</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface1</span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">A</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface2</span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">A</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(Sub.A);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="3-方法解析"><a href="#3-方法解析" class="headerlink" title="3. 方法解析"></a>3. 方法解析</h4><p>方法解析的第一个步骤与字段解析一样，也是需要先解析出方法表的<code>class_index</code>项中索引的方法所属的类或接口的符号引用，如果解析成功，那么我们依然用<code>C</code>表示这个类，接下来虚拟机将会按照如下步骤进行后续的方法搜索：</p><ol><li>由于Class文件格式中类的方法和接口的方法符号引用的常量类型定义是分开的 ， 如果在类的方法表中发现class_index中索引的C是个接口的话，那就直接抛出java.lang. IncompatibleClassChangeError 异常。</li><li>如果通过了第一步，在类C中查找是否有简单名称和描述符都与目标相匹配的方 法，如果有则返回这个方法的直接引用，查找结束。</li><li>否则，在类C的父类中递归查找是否有简单名称和描述符都与目标相匹配的方法, 如果有则返回这个方法的直接引用，查找结束。</li><li>否则，在类C实现的接口列表及它们的父接口之中递归查找是否有简单名称和描述 符都与目标相匹配的方法，如果存在匹配的方法，说明类C是一个抽象类，这时候查找结 束，抛出 java.lang.AbstractMethodError 异常。</li><li>否则，宣告方法查找失败，抛出java.lang.NoSuchMethodErrorc</li></ol><p>最后，如果查找过程成功返回了直接引用，将会对这个方法进行权限验证，如果发现不具备对此方法的访问权限，将抛出java.lang.IllegalAccessError异常。</p><h4 id="4-接口方法解析"><a href="#4-接口方法解析" class="headerlink" title="4. 接口方法解析"></a>4. 接口方法解析</h4><p>接口方法也是需要先解析出接口方法表的<code>class_index</code>项中索引的方法所属的类或接口的符号引用，如果解析成功，依然用C表示这个接口，接下来虚拟机将会按照如下步骤</p><ol><li>与类的方法解析相反，如果在接口方法表中发现class_index中的索引C是个类而不是接口，那么就直接抛出 java.lang.IncompatibleClassChangeError 异常。</li><li>否则，在接口C中查找是否有简单名称和描述符都与目标相匹配的方法，如果有则返回这个方法的直接引用，查找结束。</li><li>否则，在接口C的父接口中递归查找，直到java.lang.Object类（接口方法的查找范围也会包括Object类中的方法）为止，看是否有简单名称和描述符都与目标相匹配的方法，如果有则返回这个方法的直接引用，查找结束。</li><li>对于规则3,由于Java的接口允许多重继承，如果C的不同父接口中存有多个简单名称和描述符都与目标相匹配的方法，那将会从这多个方法中返回其中一个并结束查找，（Java虚拟机规范》中并没有进一步规则约束应该返回哪一个接口方法。但与之前字段查找类似地，不同发行商实现的Javac编译器有可能会按照更严格的约束拒绝编译这种代码来避免不确定性。</li><li>否则，宣告方法查找失败，抛出java.lang.NoSuchMethodError异常。</li></ol><h3 id="5-初始化"><a href="#5-初始化" class="headerlink" title="5. 初始化"></a>5. 初始化</h3><p>类的初始化阶段是类加载过程的最后一个步骤，之前介绍的几个类加载的动作里，除了在加载阶段用户应用程序可以通过自定义类加载器的方式局部参与外，其余动作都完全由 Java 虚拟机来主导控制。直到初始化阶段，Java 虚拟机才真正开始执行类中编写的 Java 程序代码，将主导权移交给应用程序。</p><p>进行准备阶段时，变量已经赋过一次系统要求的初始零值，而在初始化阶段，则会根据程序员通过程序编码制定的主观计划去初始化类变量和其他资源。我们也可以从另外一种更直接的形式来表达：<br><strong>初始化阶段就是执行类构造器 <code>&lt;clinit＞()</code> 方法的过程。</strong></p><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p><code>＜clinit＞()</code> 并不是程序员在 Java 代码中直接编写的方法，它是 Javac 编译器的自动生成物，但我们非常有必要了解这个方法具体是如何产生的，以及 <code>&lt;clinit＞()</code> 方法执行过程中各种可能会影响程序运行行为的细节，这部分比起其他类加载过程更贴近于普通的程序开发人员的实际工作。</p><h4 id="1-Clinit-方法的产生"><a href="#1-Clinit-方法的产生" class="headerlink" title="1. Clinit 方法的产生"></a>1. Clinit 方法的产生</h4><p><code>&lt;clinit&gt;()</code> 方法是由编译器自动收集类中的所有类变量的赋值动作和静态语句块中的语句合并产生的<br>顺序：<br>编译器收集的顺序是由语句在源文件中出现的顺序决定的，静态语句块只能访问到定义在静态语句块之前的变量，定义在它之后的变量，在前面的静态语句块中可以赋值，（这是因为在前面的准备阶段中已经赋予了一个初值，因此可以进一步进行赋值，但是不能访问，因为实际上还没有被创建出来) 但是不能访问。</p><h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IllegalForwardReference</span> &#123;  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * 非法向前引用变量  </span><br><span class="hljs-comment">     * 在这里第一次打印i失败了，第二次打印i就成功了，这是因为在初始化过程中执行clinit方法，这个方法是顺序执行的，  </span><br><span class="hljs-comment">     * 第一次打印i时，还没有对i进行定义，因此打印失败了。  </span><br><span class="hljs-comment">     * 第二次打印i时，已经成功定义了，所以打印成功了  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-keyword">static</span> &#123;  <br>        i = <span class="hljs-number">0</span>; <span class="hljs-comment">//给变量赋值是可以正常编译通过的  </span><br><span class="hljs-comment">//        System.out.println(i); //这句编译器会提示&quot;非法向前引用&quot;,illegal forward reference  </span><br>    &#125;  <br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <br>    <span class="hljs-keyword">static</span> &#123;  <br>        System.out.println(i); <span class="hljs-comment">// 在这里就可以正常使用i这个值了  </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-父类构造器的执行"><a href="#2-父类构造器的执行" class="headerlink" title="2. 父类构造器的执行"></a>2. 父类构造器的执行</h4><p>Java 虚拟机会保证在子类的 <code>&lt;clinit&gt;()</code> 方法执行前，父类的 <code>&lt;clinit&gt;()</code> 方法已经执行完毕。因此在 Java 虚拟机中第一个被执行的 <code>&lt;clinit&gt;()</code> 方法一定是 <code>java.lang.object</code><br>父类的 <code>&lt;clinit&gt;()</code> 方法先执行，也就意味着父类中定义的静态语句块要优先于子类的变量赋值操作。</p><h5 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * clint方法执行顺序示例  </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">A</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <br>    <span class="hljs-keyword">static</span> &#123;  <br>        A = <span class="hljs-number">2</span>;  <br>    &#125;  <br>&#125;  <br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">B</span> <span class="hljs-operator">=</span> A;  <br>&#125;  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>    <span class="hljs-comment">// 在这里打印的是2，因为父类中的静态语句要优于子类的变量赋值操作  </span><br> System.out.println(Sub.B);  <br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211213125423.png"></p><h4 id="3-lt-clinit-gt-方法的必须性"><a href="#3-lt-clinit-gt-方法的必须性" class="headerlink" title="3.  &lt;clinit&gt;() 方法的必须性"></a>3.  <code>&lt;clinit&gt;()</code> 方法的必须性</h4><p> <code>&lt;clinit&gt;()</code> 方法不是必须的，如果一个类中没有静态语句块，也没有对变量的赋值操作，那么编译器可以不为这个类生成 <code>&lt;clinit&gt;()</code> 方法</p><h4 id="4-lt-clinit-gt-方法初始化加锁"><a href="#4-lt-clinit-gt-方法初始化加锁" class="headerlink" title="4.  &lt;clinit&gt;() 方法初始化加锁"></a>4.  <code>&lt;clinit&gt;()</code> 方法初始化加锁</h4><p>Java 虚拟机必须要保证一个类的 <code>&lt;clinit&gt;()</code> 方法在多线程环境中被正确地加锁同步，如果多个线程同时去初始化一个类，那么只会有其中一个线程去执行这个类的 <code>&lt;clinit&gt;()</code> 方法，其他线程都需要阻塞等待，知道活动线程执行完毕 <code>&lt;clinit&gt;()</code> 方法。如果一个类的 <code>&lt;clinit&gt;()</code> 方法中有耗时很长的操作，那就可能造成多个进程阻塞。</p><h5 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.coachhe.第<span class="hljs-number">5</span>节_初始化;  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * 当多个线程同时去初始化一个类时，只会有一个线程去执行这个类的&lt;clinit&gt;()方法，其他线程都需要阻塞等待  </span><br><span class="hljs-comment"> * 直到活动线程执行完毕&lt;clinit&gt;()方法。  </span><br><span class="hljs-comment"> * 因此，如果在一个类&lt;clinit&gt;()方法中有耗时很长的操作，那就可能造成多个进程阻塞  </span><br><span class="hljs-comment"> * 接下来进行展示：  </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLoopClass</span> &#123;  <br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DealLoopClassTest</span> &#123;  <br>        <span class="hljs-keyword">static</span> &#123;  <br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) &#123;  <br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;init DeadLoopClass&quot;</span>);  <br>                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;  <br>                &#125;  <br>            &#125;  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">Runnable</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> () -&gt; &#123;  <br>            System.out.println(<span class="hljs-string">&quot;Thread.currentThread() &quot;</span> + <span class="hljs-string">&quot;start&quot;</span>);  <br>            <span class="hljs-type">DealLoopClassTest</span> <span class="hljs-variable">dlc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DealLoopClassTest</span>();  <br>            System.out.println(<span class="hljs-string">&quot;Thread.currentThread() &quot;</span> + <span class="hljs-string">&quot;run over&quot;</span>);  <br>        &#125;;  <br>  <br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(script);  <br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(script);  <br>        thread1.start();  <br>        thread2.start();  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>运行结果为：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211213130235.png"></p><h1 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h1><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211213132247.png" width="70%"><p>可以看到，用户自定义类的默认类加载器就为系统类加载器，bootstrap 类加载器（引导类加载器）为 null（不是用 Java 语言实现，不是一个类），String 的类加载器也为 bootstrap 类加载器</p><h2 id="类加载器的分类"><a href="#类加载器的分类" class="headerlink" title="类加载器的分类"></a>类加载器的分类</h2><h3 id="启动类加载器（bootstrap-类加载器）"><a href="#启动类加载器（bootstrap-类加载器）" class="headerlink" title="启动类加载器（bootstrap 类加载器）"></a>启动类加载器（bootstrap 类加载器）</h3><ol><li>也叫引导类加载器，使用 C&#x2F;C++ 语言实现，嵌套在 JVM 内部。</li><li>用来将 Java 的核心库（ <code>&lt;JAVA_HOME&gt;\lib</code> 目录，或者被 <code>-Xbootclasspath</code> 参数所指定的路径中存放的，而且是 Java 虚拟机能够识别的类库) 加载到虚拟机的内存中，用于提供 JVM 自身需要的类。 </li><li>并不继承自 <code>java.lang.ClassLoader</code>，没有父加载器</li><li>加载拓展类和应用程序类加载器，并指定为他们的父类加载器</li><li>处于安全考虑，Bootstrap 启动类加载器只加载包名为 java、javax、sun 等开头的类<br>简单来说，就是加载核心类库和其他类加载器。</li></ol><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>用户在编写自定义类加载器时，如果需要把加载请求委托给启动类加载器去处理，那直接使用 null 代替即可。<br>下面是 <code>java.lang.Class.getClassLoader()</code> 方法的代码片段，其中的注释和代码实现都明确说明了以 null 值来代表启动类加载器的约定规则：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CallerSensitive</span>  <br><span class="hljs-meta">@ForceInline</span> <span class="hljs-comment">// to ensure Reflection.getCallerClass optimization  </span><br><span class="hljs-keyword">public</span> ClassLoader <span class="hljs-title function_">getClassLoader</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-comment">// 在这里，会去寻找类加载器，如果类加载器为空，则代表使用bootstrap类加载器，那么也会直接返回null  </span><br>    <span class="hljs-comment">// 其实就是主要说明了大家都约定好使用null代表bootstrap类加载器  </span><br> <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> getClassLoader0();  <br>    <span class="hljs-keyword">if</span> (cl == <span class="hljs-literal">null</span>)  <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <br>    <span class="hljs-type">SecurityManager</span> <span class="hljs-variable">sm</span> <span class="hljs-operator">=</span> System.getSecurityManager();  <br>    <span class="hljs-keyword">if</span> (sm != <span class="hljs-literal">null</span>) &#123;  <br>        ClassLoader.checkClassLoaderPermission(cl, Reflection.getCallerClass());  <br>    &#125;  <br>    <span class="hljs-keyword">return</span> cl;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="虚拟机自带加载器"><a href="#虚拟机自带加载器" class="headerlink" title="虚拟机自带加载器"></a>虚拟机自带加载器</h3><h4 id="拓展类加载器"><a href="#拓展类加载器" class="headerlink" title="拓展类加载器"></a>拓展类加载器</h4><ol><li>Java 语言编写，由 <code>sun.misc.Launcher$ExtClassLoader</code> 实现。</li><li>派生于 ClassLoader 类</li><li>父类加载器为启动类加载器</li><li>从 <code>java.ext.dirs</code> 系统属性所指定的目录中加载类库，或从 JDK 的安装目录的 <code>jre/lib/ext</code> 子目录（拓展目录）下加载类库。<br>注意：如果用户创建的 JAR 放在此目录下，也会自动由拓展类加载器加载。<br>理解：拓展类加载器就是负责加载除了核心包（核心包是由启动类加载器加载）之外的拓展类。</li></ol><h4 id="应用程序类加载器（系统加载器、AppClassLoader）"><a href="#应用程序类加载器（系统加载器、AppClassLoader）" class="headerlink" title="应用程序类加载器（系统加载器、AppClassLoader）"></a>应用程序类加载器（系统加载器、AppClassLoader）</h4><ol><li>Java 语言编写，由 <code>sun.misc.Launcher$AppClassLoader</code> 实现</li><li>派生于 ClassLoader 类</li><li>父类加载器为拓展类加载器</li><li>它负责加载环境变量 classpath 或系统属性 <code>java.class.path</code> 指定路径下的类库</li><li>该类加载器是程序中的默认类加载器，一般来说，Java 应用的类都是由它来完成加载</li><li>通过 <code>ClassLoader#getSystemClassLoader()</code> 方法可以获取到该类加载器</li></ol><h1 id="双亲委派模型"><a href="#双亲委派模型" class="headerlink" title="双亲委派模型"></a>双亲委派模型</h1><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211217102609.png" width = "50%" /><p>上图展示的各种类加载器之间的层次关系被称为<strong>双亲委派模型</strong>。<br>双亲委派模型要求除了顶层的启动类加载器外，其余的类加载器都应有自己的父类加载器。不过这里类加载器之间的父子一般不是用<strong>继承</strong>的关系来实现，而是通常使用<strong>组合</strong>关系来复用父加载器的代码。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/87bc3ee8fd56.html"/>
    <url>/2022/12/87bc3ee8fd56.html</url>
    
    <content type="html"><![CDATA[<img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20220615154502906.png" width = "40%" /><h2 id="sys-menu"><a href="#sys-menu" class="headerlink" title="sys_menu"></a>sys_menu</h2><table><thead><tr><th>menu_id</th><th>menu_name</th><th>title</th><th>menu_type</th><th>action</th><th>permission</th><th>parent_id</th><th>create_by</th></tr></thead><tbody><tr><td>2</td><td>Upms</td><td>系统管理</td><td>M</td><td>无</td><td></td><td>0</td><td>1</td></tr><tr><td>3</td><td>Sysuser</td><td>用户管理</td><td>C</td><td>无</td><td>system:sysuser:list</td><td>2</td><td>1</td></tr><tr><td>43</td><td>NULL</td><td>新增用户</td><td>F</td><td>POST</td><td>system:sysuser:add</td><td>3</td><td>1</td></tr><tr><td>44</td><td>NULL</td><td>查询用户</td><td>F</td><td>GET</td><td>system:sysuser:query</td><td>3</td><td>1</td></tr><tr><td>45</td><td>NULL</td><td>修改用户</td><td>F</td><td>PUT</td><td>system:sysuser:edit</td><td>3</td><td>1</td></tr><tr><td>46</td><td>NULL</td><td>删除用户</td><td>F</td><td>DELETE</td><td>system:sysuser:remove</td><td>3</td><td>1</td></tr><tr><td>51</td><td>Menu</td><td>菜单管理</td><td>C</td><td>无</td><td>system:sysmenu:list</td><td>2</td><td>1</td></tr><tr><td>52</td><td>Role</td><td>角色管理</td><td>C</td><td>无</td><td>system:sysrole:list</td><td>2</td><td>1</td></tr><tr><td>56</td><td>Dept</td><td>部门管理</td><td>C</td><td>无</td><td>system:sysdept:list</td><td>2</td><td>1</td></tr><tr><td>57</td><td>post</td><td>岗位管理</td><td>C</td><td>无</td><td>system:syspost:list</td><td>2</td><td>1</td></tr><tr><td>63</td><td></td><td>接口权限</td><td>M</td><td></td><td></td><td>0</td><td>1</td></tr><tr><td>64</td><td></td><td>用户管理</td><td>M</td><td></td><td></td><td>280</td><td>1</td></tr><tr><td>66</td><td></td><td>菜单管理</td><td>C</td><td></td><td></td><td>280</td><td>1</td></tr><tr><td>67</td><td></td><td>菜单列表</td><td>A</td><td>GET</td><td></td><td>66</td><td>1</td></tr><tr><td>68</td><td></td><td>新建菜单</td><td>A</td><td>POST</td><td></td><td>66</td><td>1</td></tr><tr><td>72</td><td></td><td>修改菜单</td><td>A</td><td>PUT</td><td></td><td>66</td><td>1</td></tr><tr><td>73</td><td></td><td>删除菜单</td><td>A</td><td>DELETE</td><td></td><td>66</td><td>1</td></tr><tr><td>74</td><td>NULL</td><td>管理员列表</td><td>A</td><td>GET</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>75</td><td>NULL</td><td>根据id获取管理员</td><td>A</td><td>GET</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>76</td><td>NULL</td><td>获取管理员</td><td>A</td><td>GET</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>77</td><td>NULL</td><td>创建管理员</td><td>A</td><td>POST</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>78</td><td>NULL</td><td>修改管理员</td><td>A</td><td>PUT</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>79</td><td>NULL</td><td>删除管理员</td><td>A</td><td>DELETE</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>80</td><td>NULL</td><td>当前用户个人信息</td><td>A</td><td>GET</td><td>NULL</td><td>267</td><td>1</td></tr><tr><td>81</td><td>NULL</td><td>角色列表</td><td>A</td><td>GET</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>82</td><td>NULL</td><td>获取角色信息</td><td>A</td><td>GET</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>83</td><td>NULL</td><td>创建角色</td><td>A</td><td>POST</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>84</td><td>NULL</td><td>修改角色</td><td>A</td><td>PUT</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>85</td><td>NULL</td><td>删除角色</td><td>A</td><td>DELETE</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>92</td><td>NULL</td><td>获取角色菜单</td><td>A</td><td>GET</td><td>NULL</td><td>256</td><td>1</td></tr><tr><td>93</td><td>NULL</td><td>根据角色id获取角色</td><td>A</td><td>GET</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>94</td><td>NULL</td><td>获取菜单树</td><td>A</td><td>GET</td><td>NULL</td><td>256</td><td>1</td></tr><tr><td>103</td><td>NULL</td><td>部门菜单列表</td><td>A</td><td>GET</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>104</td><td>NULL</td><td>根据id获取部门信息</td><td>A</td><td>GET</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>105</td><td>NULL</td><td>创建部门</td><td>A</td><td>POST</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>106</td><td>NULL</td><td>修改部门</td><td>A</td><td>PUT</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>107</td><td>NULL</td><td>删除部门</td><td>A</td><td>DELETE</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>119</td><td>NULL</td><td>获取岗位列表</td><td>A</td><td>GET</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>120</td><td>NULL</td><td>通过id获取岗位信息</td><td>A</td><td>GET</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>121</td><td>NULL</td><td>创建岗位</td><td>A</td><td>POST</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>122</td><td>NULL</td><td>修改岗位</td><td>A</td><td>PUT</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>123</td><td>NULL</td><td>删除岗位</td><td>A</td><td>DELETE</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>137</td><td>NULL</td><td>菜单列表</td><td>A</td><td>GET</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>138</td><td>NULL</td><td>获取根据id菜单信息</td><td>A</td><td>GET</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>139</td><td>NULL</td><td>创建菜单</td><td>A</td><td>POST</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>140</td><td>NULL</td><td>修改菜单</td><td>A</td><td>PUT</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>141</td><td>NULL</td><td>删除菜单</td><td>A</td><td>DELETE</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>142</td><td>NULL</td><td>获取角色对应的菜单id数组</td><td>A</td><td>GET</td><td>NULL</td><td>256</td><td>1</td></tr><tr><td>201</td><td></td><td>角色管理</td><td>C</td><td>GET</td><td></td><td>280</td><td>1</td></tr><tr><td>203</td><td></td><td>部门管理</td><td>C</td><td>POST</td><td></td><td>280</td><td>1</td></tr><tr><td>204</td><td></td><td>岗位管理</td><td>C</td><td></td><td></td><td>280</td><td>1</td></tr><tr><td>212</td><td>LoginLog</td><td>登录日志</td><td>C</td><td></td><td>system:sysloginlog:list</td><td>2</td><td>1</td></tr><tr><td>213</td><td>NULL</td><td>获取登录日志</td><td>A</td><td>GET</td><td>NULL</td><td>214</td><td>1</td></tr><tr><td>214</td><td></td><td>日志管理</td><td>M</td><td>GET</td><td></td><td>280</td><td>1</td></tr><tr><td>215</td><td></td><td>删除日志</td><td>A</td><td>DELETE</td><td></td><td>214</td><td>1</td></tr><tr><td>220</td><td></td><td>新增菜单</td><td>F</td><td></td><td>system:sysmenu:add</td><td>51</td><td>1</td></tr><tr><td>221</td><td></td><td>修改菜单</td><td>F</td><td></td><td>system:sysmenu:edit</td><td>51</td><td>1</td></tr><tr><td>222</td><td></td><td>查询菜单</td><td>F</td><td></td><td>system:sysmenu:query</td><td>51</td><td>1</td></tr><tr><td>223</td><td></td><td>删除菜单</td><td>F</td><td></td><td>system:sysmenu:remove</td><td>51</td><td>1</td></tr><tr><td>224</td><td></td><td>新增角色</td><td>F</td><td></td><td>system:sysrole:add</td><td>52</td><td>1</td></tr><tr><td>225</td><td></td><td>查询角色</td><td>F</td><td></td><td>system:sysrole:query</td><td>52</td><td>1</td></tr><tr><td>226</td><td></td><td>修改角色</td><td>F</td><td></td><td>system:sysrole:edit</td><td>52</td><td>1</td></tr><tr><td>227</td><td></td><td>删除角色</td><td>F</td><td></td><td>system:sysrole:remove</td><td>52</td><td>1</td></tr><tr><td>228</td><td></td><td>查询部门</td><td>F</td><td></td><td>system:sysdept:query</td><td>56</td><td>1</td></tr><tr><td>229</td><td></td><td>新增部门</td><td>F</td><td></td><td>system:sysdept:add</td><td>56</td><td>1</td></tr><tr><td>230</td><td></td><td>修改部门</td><td>F</td><td></td><td>system:sysdept:edit</td><td>56</td><td>1</td></tr><tr><td>231</td><td></td><td>删除部门</td><td>F</td><td></td><td>system:sysdept:remove</td><td>56</td><td>1</td></tr><tr><td>232</td><td></td><td>查询岗位</td><td>F</td><td></td><td>system:syspost:query</td><td>57</td><td>1</td></tr><tr><td>233</td><td></td><td>新增岗位</td><td>F</td><td></td><td>system:syspost:add</td><td>57</td><td>1</td></tr><tr><td>234</td><td></td><td>修改岗位</td><td>F</td><td></td><td>system:syspost:edit</td><td>57</td><td>1</td></tr><tr><td>235</td><td></td><td>删除岗位</td><td>F</td><td></td><td>system:syspost:remove</td><td>57</td><td>1</td></tr><tr><td>244</td><td></td><td>查询参数</td><td>F</td><td></td><td>system:sysconfig:query</td><td>62</td><td>1</td></tr><tr><td>245</td><td></td><td>新增参数</td><td>F</td><td></td><td>system:sysconfig:add</td><td>62</td><td>1</td></tr><tr><td>246</td><td></td><td>修改参数</td><td>F</td><td></td><td>system:sysconfig:edit</td><td>62</td><td>1</td></tr><tr><td>247</td><td></td><td>删除参数</td><td>F</td><td></td><td>system:sysconfig:remove</td><td>62</td><td>1</td></tr><tr><td>248</td><td></td><td>查询登录日志</td><td>F</td><td></td><td>system:sysloginlog:query</td><td>212</td><td>1</td></tr><tr><td>249</td><td></td><td>删除登录日志</td><td>F</td><td></td><td>system:sysloginlog:remove</td><td>212</td><td>1</td></tr><tr><td>250</td><td></td><td>查询操作日志</td><td>F</td><td></td><td>system:sysoperlog:query</td><td>216</td><td>1</td></tr><tr><td>251</td><td></td><td>删除操作日志</td><td>F</td><td></td><td>system:sysoperlog:remove</td><td>216</td><td>1</td></tr><tr><td>252</td><td></td><td>获取登录用户信息</td><td>A</td><td>GET</td><td></td><td>256</td><td>1</td></tr><tr><td>254</td><td></td><td>部门树接口【数据权限】</td><td>A</td><td>GET</td><td></td><td>256</td><td>1</td></tr><tr><td>255</td><td></td><td>部门树【用户列表】</td><td>A</td><td>GET</td><td></td><td>256</td><td>1</td></tr><tr><td>256</td><td></td><td>必开接口</td><td>M</td><td>GET</td><td></td><td>63</td><td>1</td></tr><tr><td>258</td><td></td><td>退出登录</td><td>A</td><td>POST</td><td></td><td>256</td><td>1</td></tr><tr><td>259</td><td></td><td>头像上传</td><td>A</td><td>POST</td><td></td><td>267</td><td>1</td></tr><tr><td>260</td><td></td><td>修改密码</td><td>A</td><td>PUT</td><td></td><td>256</td><td>1</td></tr><tr><td>267</td><td></td><td>个人中心</td><td>M</td><td></td><td></td><td>256</td><td>1</td></tr><tr><td>268</td><td>Process</td><td>工单系统</td><td>M</td><td></td><td></td><td>0</td><td>1</td></tr><tr><td>269</td><td>ApplyProcessList</td><td>工单申请</td><td>C</td><td></td><td>process:list:applyProcessList</td><td>268</td><td>1</td></tr><tr><td>270</td><td>ProcessUpcoming</td><td>我的待办</td><td>C</td><td></td><td>process:list:upcoming</td><td>268</td><td>1</td></tr><tr><td>271</td><td>ProcessMyCreate</td><td>我创建的</td><td>C</td><td></td><td>process:list:myCreate</td><td>268</td><td>1</td></tr><tr><td>272</td><td>ProcessRelated</td><td>我相关的</td><td>C</td><td></td><td>process:list:related</td><td>268</td><td>1</td></tr><tr><td>273</td><td>ProcessAll</td><td>所有工单</td><td>C</td><td></td><td>process:list:all</td><td>268</td><td>1</td></tr><tr><td>274</td><td>ProcessAdmin</td><td>后台管理</td><td>M</td><td></td><td></td><td>268</td><td>1</td></tr><tr><td>275</td><td>ProcessAdminClassify</td><td>流程分类</td><td>C</td><td></td><td>process:admin:classify</td><td>274</td><td>1</td></tr><tr><td>276</td><td>ProcessAdminTemplate</td><td>模版管理</td><td>C</td><td></td><td>process:admin:template</td><td>274</td><td>1</td></tr><tr><td>277</td><td>ProcessAdminManager</td><td>流程管理</td><td>C</td><td></td><td>process:admin:manager</td><td>274</td><td>1</td></tr><tr><td>278</td><td>ProcessAdminTask</td><td>任务管理</td><td>C</td><td></td><td>process:admin:task</td><td>274</td><td>1</td></tr><tr><td>280</td><td></td><td>系统管理</td><td>M</td><td></td><td></td><td>63</td><td>1</td></tr><tr><td>281</td><td></td><td>工单系统</td><td>M</td><td></td><td></td><td>63</td><td>1</td></tr><tr><td>282</td><td></td><td>后台管理</td><td>M</td><td></td><td></td><td>281</td><td>1</td></tr><tr><td>283</td><td></td><td>流程分类</td><td>M</td><td></td><td></td><td>282</td><td>1</td></tr><tr><td>284</td><td></td><td>新建分类</td><td>A</td><td>POST</td><td></td><td>283</td><td>1</td></tr><tr><td>285</td><td></td><td>分类列表</td><td>A</td><td>GET</td><td></td><td>283</td><td>1</td></tr><tr><td>287</td><td></td><td>编辑分类</td><td>A</td><td>PUT</td><td></td><td>283</td><td>1</td></tr><tr><td>288</td><td></td><td>删除分类</td><td>A</td><td>DELETE</td><td></td><td>283</td><td>1</td></tr><tr><td>290</td><td></td><td>查看分类</td><td>F</td><td></td><td>process:admin:classify:list</td><td>275</td><td>1</td></tr><tr><td>291</td><td></td><td>新增分类</td><td>F</td><td></td><td>process:admin:classify:add</td><td>275</td><td>1</td></tr><tr><td>292</td><td></td><td>编辑分类</td><td>F</td><td></td><td>process:admin:classify:edit</td><td>275</td><td>1</td></tr><tr><td>293</td><td></td><td>删除分类</td><td>F</td><td></td><td>process:admin:classify:delete</td><td>275</td><td>1</td></tr><tr><td>294</td><td></td><td>模版管理</td><td>M</td><td></td><td></td><td>282</td><td>1</td></tr><tr><td>295</td><td></td><td>新建模版</td><td>A</td><td>POST</td><td></td><td>294</td><td>1</td></tr><tr><td>296</td><td></td><td>模版列表</td><td>A</td><td>GET</td><td></td><td>294</td><td>1</td></tr><tr><td>297</td><td></td><td>编辑模版</td><td>A</td><td>PUT</td><td></td><td>294</td><td>1</td></tr><tr><td>298</td><td></td><td>删除模版</td><td>A</td><td>DELETE</td><td></td><td>294</td><td>1</td></tr><tr><td>299</td><td></td><td>模版详情</td><td>A</td><td>GET</td><td></td><td>294</td><td>1</td></tr><tr><td>300</td><td></td><td>查看模版</td><td>F</td><td></td><td>process:admin:template:list</td><td>276</td><td>1</td></tr><tr><td>301</td><td></td><td>新建模版</td><td>F</td><td></td><td>process:admin:template:add</td><td>276</td><td>1</td></tr><tr><td>302</td><td></td><td>编辑模版</td><td>F</td><td></td><td>process:admin:template:edit</td><td>276</td><td>1</td></tr><tr><td>303</td><td></td><td>删除模版</td><td>F</td><td></td><td>process:admin:template:delete</td><td>276</td><td>1</td></tr><tr><td>304</td><td></td><td>查看流程</td><td>F</td><td></td><td>process:admin:manager:list</td><td>277</td><td>1</td></tr><tr><td>305</td><td></td><td>新建流程</td><td>F</td><td></td><td>process:admin:manager:add</td><td>277</td><td>1</td></tr><tr><td>306</td><td></td><td>编辑流程</td><td>F</td><td></td><td>process:admin:manager:edit</td><td>277</td><td>1</td></tr><tr><td>307</td><td></td><td>删除流程</td><td>F</td><td></td><td>process:admin:manager:delete</td><td>277</td><td>1</td></tr><tr><td>309</td><td></td><td>流程管理</td><td>M</td><td></td><td></td><td>282</td><td>1</td></tr><tr><td>310</td><td></td><td>流程列表</td><td>A</td><td>GET</td><td></td><td>309</td><td>1</td></tr><tr><td>311</td><td></td><td>新建流程</td><td>A</td><td>POST</td><td></td><td>309</td><td>1</td></tr><tr><td>312</td><td></td><td>编辑流程</td><td>A</td><td>PUT</td><td></td><td>309</td><td>1</td></tr><tr><td>313</td><td></td><td>删除流程</td><td>A</td><td>DELETE</td><td></td><td>309</td><td>1</td></tr><tr><td>314</td><td></td><td>流程详情</td><td>A</td><td>GET</td><td></td><td>309</td><td>1</td></tr><tr><td>315</td><td></td><td>分类流程</td><td>A</td><td>GET</td><td></td><td>309</td><td>1</td></tr><tr><td>316</td><td></td><td>任务管理</td><td>M</td><td></td><td></td><td>282</td><td>1</td></tr><tr><td>317</td><td></td><td>任务列表</td><td>A</td><td>GET</td><td></td><td>316</td><td>1</td></tr><tr><td>318</td><td></td><td>新建任务</td><td>A</td><td>POST</td><td></td><td>316</td><td>1</td></tr><tr><td>319</td><td>&#x2F;api&#x2F;v1&#x2F;task</td><td>编辑任务</td><td>A</td><td>PUT</td><td></td><td>316</td><td>1</td></tr><tr><td>320</td><td></td><td>删除任务</td><td>A</td><td>DELETE</td><td></td><td>316</td><td>1</td></tr><tr><td>321</td><td></td><td>任务详情</td><td>A</td><td>GET</td><td></td><td>316</td><td>1</td></tr><tr><td>322</td><td></td><td>查看任务</td><td>F</td><td></td><td>process:admin:task:list</td><td>278</td><td>1</td></tr><tr><td>323</td><td></td><td>新增任务</td><td>F</td><td></td><td>process:admin:task:add</td><td>278</td><td>1</td></tr><tr><td>324</td><td></td><td>编辑任务</td><td>F</td><td></td><td>process:admin:task:edit</td><td>278</td><td>1</td></tr><tr><td>325</td><td></td><td>删除任务</td><td>F</td><td></td><td>process:admin:task:delete</td><td>278</td><td>1</td></tr><tr><td>326</td><td></td><td>工单申请</td><td>M</td><td></td><td></td><td>281</td><td>1</td></tr><tr><td>327</td><td></td><td>分类流程</td><td>A</td><td>GET</td><td></td><td>326</td><td>1</td></tr><tr><td>328</td><td>ProcessListCreate</td><td>新建工单</td><td>C</td><td></td><td>process:menu:list:create</td><td>268</td><td>1</td></tr><tr><td>329</td><td>ProcessListHandle</td><td>处理工单</td><td>C</td><td></td><td>process:menu:list:handle</td><td>268</td><td>1</td></tr><tr><td>330</td><td></td><td>新建工单</td><td>A</td><td>POST</td><td></td><td>326</td><td>1</td></tr><tr><td>331</td><td></td><td>处理工单</td><td>A</td><td>POST</td><td></td><td>326</td><td>1</td></tr><tr><td>332</td><td></td><td>流程数据</td><td>A</td><td>GET</td><td></td><td>326</td><td>1</td></tr><tr><td>333</td><td></td><td>工单列表</td><td>M</td><td></td><td></td><td>281</td><td>1</td></tr><tr><td>334</td><td></td><td>工单列表</td><td>A</td><td>GET</td><td></td><td>333</td><td>1</td></tr><tr><td>335</td><td></td><td>结束工单</td><td>A</td><td>GET</td><td></td><td>333</td><td>1</td></tr><tr><td>336</td><td></td><td>转交工单</td><td>A</td><td>POST</td><td></td><td>333</td><td>1</td></tr><tr><td>337</td><td></td><td>查看工单</td><td>F</td><td></td><td>process:list:all:select</td><td>273</td><td>1</td></tr><tr><td>338</td><td></td><td>转交工单</td><td>F</td><td></td><td>process:list:all:inversion</td><td>273</td><td>1</td></tr><tr><td>339</td><td></td><td>结束工单</td><td>F</td><td></td><td>process:list:all:end</td><td>273</td><td>1</td></tr><tr><td>340</td><td></td><td>查看工单</td><td>F</td><td></td><td>process:list:related:select</td><td>272</td><td>1</td></tr><tr><td>341</td><td></td><td>查看工单</td><td>F</td><td></td><td>process:list:myCreate:select</td><td>271</td><td>1</td></tr><tr><td>342</td><td></td><td>查看工单</td><td>F</td><td></td><td>process:list:upcoming:select</td><td>270</td><td>1</td></tr><tr><td>343</td><td></td><td>转交工单</td><td>F</td><td></td><td>process:list:upcoming:inversion</td><td>270</td><td>1</td></tr><tr><td>344</td><td></td><td>首页数据</td><td>A</td><td>GET</td><td></td><td>256</td><td>11</td></tr><tr><td>350</td><td></td><td>催办工单</td><td>F</td><td></td><td>process:list:upcoming:urge</td><td>270</td><td>11</td></tr><tr><td>351</td><td></td><td>催办工单</td><td>A</td><td>GET</td><td></td><td>333</td><td>11</td></tr><tr><td>352</td><td>Settings</td><td>系统配置</td><td>C</td><td></td><td>system:settings:index</td><td>2</td><td>1</td></tr><tr><td>353</td><td></td><td>系统配置</td><td>M</td><td></td><td></td><td>280</td><td>1</td></tr><tr><td>354</td><td></td><td>设置配置</td><td>A</td><td>POST</td><td></td><td>353</td><td>1</td></tr><tr><td>355</td><td></td><td>获取配置</td><td>A</td><td>GET</td><td></td><td>353</td><td>1</td></tr><tr><td>356</td><td></td><td>清空登陆日志</td><td>F</td><td></td><td>system:sysloginlog:clean</td><td>212</td><td>1</td></tr><tr><td>357</td><td></td><td>清空登陆日志</td><td>A</td><td>DELETE</td><td></td><td>214</td><td>1</td></tr><tr><td>360</td><td></td><td>主动接单</td><td>A</td><td>PUT</td><td></td><td>326</td><td>1</td></tr><tr><td>361</td><td></td><td>主动接单</td><td>F</td><td></td><td>process:list:handle:active</td><td>329</td><td>1</td></tr><tr><td>363</td><td></td><td>删除工单</td><td>A</td><td>DELETE</td><td></td><td>333</td><td>1</td></tr><tr><td>364</td><td></td><td>删除工单</td><td>F</td><td></td><td>process:list:all:delete</td><td>273</td><td>1</td></tr><tr><td>365</td><td></td><td>部门列表</td><td>A</td><td>GET</td><td></td><td>203</td><td>1</td></tr><tr><td>366</td><td></td><td>克隆模版</td><td>F</td><td></td><td>process:admin:template:clone</td><td>276</td><td>1</td></tr><tr><td>367</td><td></td><td>克隆模版</td><td>A</td><td>POST</td><td></td><td>294</td><td>1</td></tr><tr><td>368</td><td></td><td>克隆流程</td><td>F</td><td></td><td>process:admin:manager:clone</td><td>277</td><td>1</td></tr><tr><td>369</td><td></td><td>克隆流程</td><td>A</td><td>POST</td><td></td><td>309</td><td>1</td></tr><tr><td>370</td><td></td><td>重开工单</td><td>F</td><td></td><td>process:list:myCreate:reopen</td><td>271</td><td>1</td></tr><tr><td>371</td><td></td><td>重开工单</td><td>A</td><td>POST</td><td></td><td>333</td><td>1</td></tr></tbody></table><h3 id="A类型，为接口类型"><a href="#A类型，为接口类型" class="headerlink" title="A类型，为接口类型"></a>A类型，为接口类型</h3><table><thead><tr><th>menu_id</th><th>menu_name</th><th>title</th><th>menu_type</th><th>action</th><th>permission</th><th>parent_id</th><th>create_by</th></tr></thead><tbody><tr><td>67</td><td></td><td>菜单列表</td><td>A</td><td>GET</td><td></td><td>66</td><td>1</td></tr><tr><td>68</td><td></td><td>新建菜单</td><td>A</td><td>POST</td><td></td><td>66</td><td>1</td></tr><tr><td>72</td><td></td><td>修改菜单</td><td>A</td><td>PUT</td><td></td><td>66</td><td>1</td></tr><tr><td>73</td><td></td><td>删除菜单</td><td>A</td><td>DELETE</td><td></td><td>66</td><td>1</td></tr><tr><td>74</td><td>NULL</td><td>管理员列表</td><td>A</td><td>GET</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>75</td><td>NULL</td><td>根据id获取管理员</td><td>A</td><td>GET</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>76</td><td>NULL</td><td>获取管理员</td><td>A</td><td>GET</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>77</td><td>NULL</td><td>创建管理员</td><td>A</td><td>POST</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>78</td><td>NULL</td><td>修改管理员</td><td>A</td><td>PUT</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>79</td><td>NULL</td><td>删除管理员</td><td>A</td><td>DELETE</td><td>NULL</td><td>64</td><td>1</td></tr><tr><td>80</td><td>NULL</td><td>当前用户个人信息</td><td>A</td><td>GET</td><td>NULL</td><td>267</td><td>1</td></tr><tr><td>81</td><td>NULL</td><td>角色列表</td><td>A</td><td>GET</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>82</td><td>NULL</td><td>获取角色信息</td><td>A</td><td>GET</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>83</td><td>NULL</td><td>创建角色</td><td>A</td><td>POST</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>84</td><td>NULL</td><td>修改角色</td><td>A</td><td>PUT</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>85</td><td>NULL</td><td>删除角色</td><td>A</td><td>DELETE</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>92</td><td>NULL</td><td>获取角色菜单</td><td>A</td><td>GET</td><td>NULL</td><td>256</td><td>1</td></tr><tr><td>93</td><td>NULL</td><td>根据角色id获取角色</td><td>A</td><td>GET</td><td>NULL</td><td>201</td><td>1</td></tr><tr><td>94</td><td>NULL</td><td>获取菜单树</td><td>A</td><td>GET</td><td>NULL</td><td>256</td><td>1</td></tr><tr><td>103</td><td>NULL</td><td>部门菜单列表</td><td>A</td><td>GET</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>104</td><td>NULL</td><td>根据id获取部门信息</td><td>A</td><td>GET</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>105</td><td>NULL</td><td>创建部门</td><td>A</td><td>POST</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>106</td><td>NULL</td><td>修改部门</td><td>A</td><td>PUT</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>107</td><td>NULL</td><td>删除部门</td><td>A</td><td>DELETE</td><td>NULL</td><td>203</td><td>1</td></tr><tr><td>119</td><td>NULL</td><td>获取岗位列表</td><td>A</td><td>GET</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>120</td><td>NULL</td><td>通过id获取岗位信息</td><td>A</td><td>GET</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>121</td><td>NULL</td><td>创建岗位</td><td>A</td><td>POST</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>122</td><td>NULL</td><td>修改岗位</td><td>A</td><td>PUT</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>123</td><td>NULL</td><td>删除岗位</td><td>A</td><td>DELETE</td><td>NULL</td><td>204</td><td>1</td></tr><tr><td>137</td><td>NULL</td><td>菜单列表</td><td>A</td><td>GET</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>138</td><td>NULL</td><td>获取根据id菜单信息</td><td>A</td><td>GET</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>139</td><td>NULL</td><td>创建菜单</td><td>A</td><td>POST</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>140</td><td>NULL</td><td>修改菜单</td><td>A</td><td>PUT</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>141</td><td>NULL</td><td>删除菜单</td><td>A</td><td>DELETE</td><td>NULL</td><td>66</td><td>1</td></tr><tr><td>142</td><td>NULL</td><td>获取角色对应的菜单id数组</td><td>A</td><td>GET</td><td>NULL</td><td>256</td><td>1</td></tr><tr><td>213</td><td>NULL</td><td>获取登录日志</td><td>A</td><td>GET</td><td>NULL</td><td>214</td><td>1</td></tr><tr><td>215</td><td></td><td>删除日志</td><td>A</td><td>DELETE</td><td></td><td>214</td><td>1</td></tr><tr><td>252</td><td></td><td>获取登录用户信息</td><td>A</td><td>GET</td><td></td><td>256</td><td>1</td></tr><tr><td>254</td><td></td><td>部门树接口【数据权限】</td><td>A</td><td>GET</td><td></td><td>256</td><td>1</td></tr><tr><td>255</td><td></td><td>部门树【用户列表】</td><td>A</td><td>GET</td><td></td><td>256</td><td>1</td></tr><tr><td>258</td><td></td><td>退出登录</td><td>A</td><td>POST</td><td></td><td>256</td><td>1</td></tr><tr><td>259</td><td></td><td>头像上传</td><td>A</td><td>POST</td><td></td><td>267</td><td>1</td></tr><tr><td>260</td><td></td><td>修改密码</td><td>A</td><td>PUT</td><td></td><td>256</td><td>1</td></tr><tr><td>284</td><td></td><td>新建分类</td><td>A</td><td>POST</td><td></td><td>283</td><td>1</td></tr><tr><td>285</td><td></td><td>分类列表</td><td>A</td><td>GET</td><td></td><td>283</td><td>1</td></tr><tr><td>287</td><td></td><td>编辑分类</td><td>A</td><td>PUT</td><td></td><td>283</td><td>1</td></tr><tr><td>288</td><td></td><td>删除分类</td><td>A</td><td>DELETE</td><td></td><td>283</td><td>1</td></tr><tr><td>295</td><td></td><td>新建模版</td><td>A</td><td>POST</td><td></td><td>294</td><td>1</td></tr><tr><td>296</td><td></td><td>模版列表</td><td>A</td><td>GET</td><td></td><td>294</td><td>1</td></tr><tr><td>297</td><td></td><td>编辑模版</td><td>A</td><td>PUT</td><td></td><td>294</td><td>1</td></tr><tr><td>298</td><td></td><td>删除模版</td><td>A</td><td>DELETE</td><td></td><td>294</td><td>1</td></tr><tr><td>299</td><td></td><td>模版详情</td><td>A</td><td>GET</td><td></td><td>294</td><td>1</td></tr><tr><td>310</td><td></td><td>流程列表</td><td>A</td><td>GET</td><td></td><td>309</td><td>1</td></tr><tr><td>311</td><td></td><td>新建流程</td><td>A</td><td>POST</td><td></td><td>309</td><td>1</td></tr><tr><td>312</td><td></td><td>编辑流程</td><td>A</td><td>PUT</td><td></td><td>309</td><td>1</td></tr><tr><td>313</td><td></td><td>删除流程</td><td>A</td><td>DELETE</td><td></td><td>309</td><td>1</td></tr><tr><td>314</td><td></td><td>流程详情</td><td>A</td><td>GET</td><td></td><td>309</td><td>1</td></tr><tr><td>315</td><td></td><td>分类流程</td><td>A</td><td>GET</td><td></td><td>309</td><td>1</td></tr><tr><td>317</td><td></td><td>任务列表</td><td>A</td><td>GET</td><td></td><td>316</td><td>1</td></tr><tr><td>318</td><td></td><td>新建任务</td><td>A</td><td>POST</td><td></td><td>316</td><td>1</td></tr><tr><td>319</td><td>&#x2F;api&#x2F;v1&#x2F;task</td><td>编辑任务</td><td>A</td><td>PUT</td><td></td><td>316</td><td>1</td></tr><tr><td>320</td><td></td><td>删除任务</td><td>A</td><td>DELETE</td><td></td><td>316</td><td>1</td></tr><tr><td>321</td><td></td><td>任务详情</td><td>A</td><td>GET</td><td></td><td>316</td><td>1</td></tr><tr><td>327</td><td></td><td>分类流程</td><td>A</td><td>GET</td><td></td><td>326</td><td>1</td></tr><tr><td>330</td><td></td><td>新建工单</td><td>A</td><td>POST</td><td></td><td>326</td><td>1</td></tr><tr><td>331</td><td></td><td>处理工单</td><td>A</td><td>POST</td><td></td><td>326</td><td>1</td></tr><tr><td>332</td><td></td><td>流程数据</td><td>A</td><td>GET</td><td></td><td>326</td><td>1</td></tr><tr><td>334</td><td></td><td>工单列表</td><td>A</td><td>GET</td><td></td><td>333</td><td>1</td></tr><tr><td>335</td><td></td><td>结束工单</td><td>A</td><td>GET</td><td></td><td>333</td><td>1</td></tr><tr><td>336</td><td></td><td>转交工单</td><td>A</td><td>POST</td><td></td><td>333</td><td>1</td></tr><tr><td>344</td><td></td><td>首页数据</td><td>A</td><td>GET</td><td></td><td>256</td><td>11</td></tr><tr><td>351</td><td></td><td>催办工单</td><td>A</td><td>GET</td><td></td><td>333</td><td>11</td></tr><tr><td>354</td><td></td><td>设置配置</td><td>A</td><td>POST</td><td></td><td>353</td><td>1</td></tr><tr><td>355</td><td></td><td>获取配置</td><td>A</td><td>GET</td><td></td><td>353</td><td>1</td></tr><tr><td>357</td><td></td><td>清空登陆日志</td><td>A</td><td>DELETE</td><td></td><td>214</td><td>1</td></tr><tr><td>360</td><td></td><td>主动接单</td><td>A</td><td>PUT</td><td></td><td>326</td><td>1</td></tr><tr><td>363</td><td></td><td>删除工单</td><td>A</td><td>DELETE</td><td></td><td>333</td><td>1</td></tr><tr><td>365</td><td></td><td>部门列表</td><td>A</td><td>GET</td><td></td><td>203</td><td>1</td></tr><tr><td>367</td><td></td><td>克隆模版</td><td>A</td><td>POST</td><td></td><td>294</td><td>1</td></tr><tr><td>369</td><td></td><td>克隆流程</td><td>A</td><td>POST</td><td></td><td>309</td><td>1</td></tr><tr><td>371</td><td></td><td>重开工单</td><td>A</td><td>POST</td><td></td><td>333</td><td>1</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7c53f504774f.html"/>
    <url>/2022/12/7c53f504774f.html</url>
    
    <content type="html"><![CDATA[<p>&#x3D;&#x3D;⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠&#x3D;&#x3D;</p><h1 id="Text-Elements"><a href="#Text-Elements" class="headerlink" title="Text Elements"></a>Text Elements</h1><p>加载<br>Loading ^JZbLi5Z2</p><p>验证<br>Verification ^1OIaN8RT</p><p>准备<br>Preparation ^C52dJ2gJ</p><p>解析<br>Resolution ^Nf12EoYK</p><p>初始化<br>Initialization ^jBA7Mon7</p><p>使用<br>Using ^SEjoj7Ow</p><p>卸载<br>Unloading ^S5GIliky</p><p>连接（Linking） ^WX5HZII0</p><p>类的生命周期 ^JxjXkBEJ</p><p>加载<br>Loading ^tEsVLizX</p><p>初始化<br>Initialization ^Xv6sV27U</p><p>连接<br>（Linking） ^oLNCixkV</p><p>类加载器子系统的位置和作用 ^K5N35WwZ</p><p>class文件 ^1ZNXqo2w</p><p>类加载器子系统 ^RXr5kKLa</p><p>运行时数据区 ^MgYp7kja</p><p>%%</p><h1 id="Drawing"><a href="#Drawing" class="headerlink" title="Drawing"></a>Drawing</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;excalidraw&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://excalidraw.com&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;elements&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">58</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1094145317</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kI-HItr8or_FRd0hrPO5Z&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-223.82562255859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-321.8564147949219</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1265697989</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545565</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">275757995</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;l8T8qn8ASMjHJwcK7nb66&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-81.09378051757812</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-207.01968383789062</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1558184453</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;H-x5cPuRFY8O2PnAOExC0&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545565</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">108</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1010526341</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C7pgFfRvgm3ESVoSObMQm&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">92.13000149197049</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-206.89663696289062</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1025635211</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;kR5ukmuuTBXj33Libs6XV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;H-x5cPuRFY8O2PnAOExC0&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545565</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">175</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1173425739</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hbuDAI53aHd9KCnsSVzOr&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">254.59988403320312</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-210.58761596679688</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150.82440185546875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1854593477</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;kR5ukmuuTBXj33Libs6XV&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545565</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">118</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">405147621</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;iTWsOnuuW6QZXGPb6EivV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">248.31692504882812</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-325.3097229003906</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">647587115</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545565</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">98</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1894714603</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;88frjNLwEj7dv-soaixKw&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">82.38809204101562</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-322.8462829589844</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">289252421</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">104</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">587516741</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;e4vrB40DvV_85Wifw2oId&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-76.28109741210938</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-320.0886535644531</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120.1124267578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2040955269</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">118</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">351549323</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JZbLi5Z2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-208.18878173828125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-317.2455749511719</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">66</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1651406070</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;加载\nLoading&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;加载\nLoading&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">177</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">221584037</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1OIaN8RT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-72.51776123046875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-314.44757080078125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">113</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1336784810</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;PxcceIO5kC9K1s8SEsCoS&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;Q-SWFQjMJfPKGn05eaipZ&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;验证\nVerification&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;验证\nVerification&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1614482987</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C52dJ2gJ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">88.68048095703125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-315.6338195800781</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">103</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">339852534</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;Q-SWFQjMJfPKGn05eaipZ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;xM_tk1e_yFUD6JWSfQpkH&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;准备\nPreparation&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;准备\nPreparation&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">84</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">526679557</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Nf12EoYK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">257.50714111328125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-320.5705871582031</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">94</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">118368950</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;xM_tk1e_yFUD6JWSfQpkH&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;-tkwPSnaEY_pksZXBhBxK&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;解析\nResolution&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;解析\nResolution&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">90</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1437470923</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jBA7Mon7&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">265.55828857421875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-203.28411865234375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">131</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">376156278</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;-tkwPSnaEY_pksZXBhBxK&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;初始化\nInitialization&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;初始化\nInitialization&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">814773605</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SEjoj7Ow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">121.26910400390625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-199.31280517578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">47</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">324739638</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;使用\nUsing&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;使用\nUsing&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">102</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">921157483</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;S5GIliky&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-67.7628173828125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-201.29397583007812</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">84</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">667217194</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;卸载\nUnloading&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;卸载\nUnloading&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1543930053</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mTsgOnO38ttyeE6BfStEX&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-90.36859130859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-350.4639587402344</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">472.81854248046875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.03018188476562</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1183350187</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;PxcceIO5kC9K1s8SEsCoS&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">775068171</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WX5HZII0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">79.86218939887152</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-377.9677090115017</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">130</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">732169450</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;连接（Linking）&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;连接（Linking）&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">17</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">130</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2003050533</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PxcceIO5kC9K1s8SEsCoS&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-109.46320258246527</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-292.8833312988281</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">33.36195882161458</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.745452880859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2049988485</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mTsgOnO38ttyeE6BfStEX&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.22894598776795433</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19.09461127387152</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1OIaN8RT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.1448467609314642</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.583482530381943</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">33.36195882161458</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.745452880859375</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">948510891</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Q-SWFQjMJfPKGn05eaipZ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">45.4002685546875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-293.88201904296875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36.7486572265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3728366427951073</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1206676971</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1OIaN8RT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.026458698060836793</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.91802978515625</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C52dJ2gJ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.10528726507961463</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6.53155517578125</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">36.7486572265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.3728366427951073</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">72</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1217844101</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xM_tk1e_yFUD6JWSfQpkH&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">197.13153076171875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-293.9454040527344</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54.56104193793402</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.237043592664918</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">628910501</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C52dJ2gJ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.11444009366866291</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5.4510498046875</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Nf12EoYK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.17113785805463183</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5.8145684136284785</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">54.56104193793402</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-1.237043592664918</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">67</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1335219019</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-tkwPSnaEY_pksZXBhBxK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">305.339599609375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-265.5894775390625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.718505859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">57.206787109375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1950990763</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Nf12EoYK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.008451205122459886</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">13.981109619140625</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jBA7Mon7&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.3752983184663575</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5.09857177734375</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0.718505859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">57.206787109375</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2078022373</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kR5ukmuuTBXj33Libs6XV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">246.284912109375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-180.46539306640625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">38.12558322482636</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3824218866965623</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">255602629</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hbuDAI53aHd9KCnsSVzOr&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.062427468145622195</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8.314971923828125</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C7pgFfRvgm3ESVoSObMQm&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.0040886574060156455</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.841766357421875</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">-38.12558322482636</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.3824218866965623</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">58</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1404252651</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;H-x5cPuRFY8O2PnAOExC0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">87.40627712673611</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-181.09740719394813</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52.631435818142364</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.10951701464668417</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1304105419</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C7pgFfRvgm3ESVoSObMQm&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0668967104242036</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.723724365234375</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;l8T8qn8ASMjHJwcK7nb66&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.04940899358408329</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.681060791015625</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">-52.631435818142364</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.10951701464668417</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">155</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1505850949</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JxjXkBEJ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-239.72645229763452</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-487.3168504503036</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">168</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2000663851</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;类的生命周期&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;类的生命周期&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">66</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">904641675</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zBt0fuWfGwZWSKUkch9V6&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-244.30707295735675</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-444.82432725694423</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">695.8728705512153</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">321.92835489908856</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14207589</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027545566</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">235</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4926859</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LAgIyhA6vvKAeGzf5zzYT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-119.57116699218739</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">162.95791965060792</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">758078021</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;mxyw2O89E5WIeY2r0djb_&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027716651</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">431</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">69975653</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mOSk-1ikB_Pw578slOnkE&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">194.96456909179702</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">162.85132514105928</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150.82440185546875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2099302187</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;dI4BIYQq1m6MUqKF-6aPQ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;EK8noHMvWoQjFN50URrMR&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027710872</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">280</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">233365835</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jvvyDriqaNRT0RWLCBWF4&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">27.973358154297046</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">164.72568088107667</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120.1124267578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24208485</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;EK8noHMvWoQjFN50URrMR&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027638197</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">88566949</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tEsVLizX&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-103.93432617187489</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">167.56875949435792</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">66</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">336674923</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027637389</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;加载\nLoading&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;加载\nLoading&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">306</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1909089675</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Xv6sV27U&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">207.48167588975704</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">173.62948608398463</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">131</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1745248683</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;YcDxrXjn6ADj-t-0XVuYy&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;dI4BIYQq1m6MUqKF-6aPQ&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027677199</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;初始化\nInitialization&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;初始化\nInitialization&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">249</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1900233771</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;oLNCixkV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">35.18577745225713</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">170.25971137152808</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">98</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">44</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">596914923</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;Ur9FqUPTC3OUYH1ad-EeP&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;mxyw2O89E5WIeY2r0djb_&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027716651</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;连接\n（Linking）&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;连接\n（Linking）&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1250487525</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;EK8noHMvWoQjFN50URrMR&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">149.65472412109392</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">190.93231540256104</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36.7486572265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3728366427951073</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1141153163</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027638197</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jvvyDriqaNRT0RWLCBWF4&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.06890658421922606</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.568939208984375</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mOSk-1ikB_Pw578slOnkE&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.06314710446021032</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8.561187744140582</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">36.7486572265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.3728366427951073</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">248</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">228451205</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;K5N35WwZ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-247.62036641438786</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11.337951660156733</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">364</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">489353061</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027808892</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;类加载器子系统的位置和作用&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;类加载器子系统的位置和作用&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">242</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">750004133</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yOOZHknRxfgmx0-MNUQwA&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-363.8639238145614</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.58371649848135</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">804.2930094401042</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">321.9283548990886</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1388963179</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027738365</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">565</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">651162789</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XYBhDraA6VO4UyZfMEgf2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-152.02170647515146</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">110.56545003255249</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">528.9832763671875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">149.36106363932296</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2001452517</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;EK8noHMvWoQjFN50URrMR&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;dI4BIYQq1m6MUqKF-6aPQ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;Ur9FqUPTC3OUYH1ad-EeP&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;vokE_7zaF2wl4eh1BXKQT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;wlayf45PgdptH6hOj-Alb&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;Ooshv6Rle9Y1BRI_rk-gU&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027863191</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">444</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1601209509</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mxyw2O89E5WIeY2r0djb_&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-3.728493584526465</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">194.5797593858512</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">34.33783637152777</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3728366427951073</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">99560907</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027716651</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LAgIyhA6vvKAeGzf5zzYT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.12311000465057823</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.655112372504675</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;oLNCixkV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.14533137898710036</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.576434665255817</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">34.33783637152777</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.3728366427951073</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">351</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">285959659</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kknf5B2QQg5MA4GGKPfjD&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-324.24502393934426</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">164.82726372612885</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">114.18756103515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1497508549</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;mxyw2O89E5WIeY2r0djb_&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;vokE_7zaF2wl4eh1BXKQT&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027790487</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">152</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1742134469</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1ZNXqo2w&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-312.05297682020375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">178.39725409613754</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">79</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1497961131</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027762843</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;class文件&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;class文件&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">17</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">221</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1681293893</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vokE_7zaF2wl4eh1BXKQT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-204.76060397324775</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">185.5868471910117</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">49.72918044994316</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.16403578699788568</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">695207083</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027790487</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kknf5B2QQg5MA4GGKPfjD&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.23654889558432837</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5.29685893094026</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XYBhDraA6VO4UyZfMEgf2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.009338422536822854</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.0097170481531066</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">49.72918044994316</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-0.16403578699788568</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">393</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1370101163</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;RXr5kKLa&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.46315002441452</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">126.59019300672787</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#c92a2a&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">112</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">718566661</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027974297</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;类加载器子系统&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;类加载器子系统&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">17</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">462</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1030939973</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MwRjNx3WnRtGjZdrAQyVe&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.9772762722442394</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">306.826097276476</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">250.42926703559036</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.03936767578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1185358315</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;EK8noHMvWoQjFN50URrMR&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;Ooshv6Rle9Y1BRI_rk-gU&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027863190</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">362</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">820448293</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MgYp7kja&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">74.81114535861587</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">324.4489847819014</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">96</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1367548267</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;Ur9FqUPTC3OUYH1ad-EeP&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;mxyw2O89E5WIeY2r0djb_&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027849042</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;运行时数据区&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;运行时数据区&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">17</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">107</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1742542443</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wlayf45PgdptH6hOj-Alb&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">80.07864210340756</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">264.2138773600264</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.2546522352431566</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.66879611545136</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">799876939</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027857875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XYBhDraA6VO4UyZfMEgf2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.12048131908327676</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.287363688150961</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">-0.2546522352431566</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">42.66879611545136</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">864861579</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ooshv6Rle9Y1BRI_rk-gU&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">124.22299702962277</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">302.85923597547776</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3468153211805429</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39.49863009982636</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1291360549</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1639027863191</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MwRjNx3WnRtGjZdrAQyVe&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.029432144846598552</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.9668613009982323</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XYBhDraA6VO4UyZfMEgf2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.040431739716889674</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.434092203775961</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">-0.3468153211805429</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-39.49863009982636</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;appState&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;light&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;viewBackgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#ffffff&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#c92a2a&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemBackgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemRoughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemOpacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemTextAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStartArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemEndArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemLinearStrokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gridSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>%%</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
      <category>图示</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a3448465bfce.html"/>
    <url>/2022/12/a3448465bfce.html</url>
    
    <content type="html"><![CDATA[<!DOCTYPE html><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><base href="https://www.cxyzjd.com/article/qq_38762237/107815524"><style>body{margin-left:0;margin-right:0;margin-top:0}#bN015htcoyT__google-cache-hdr{background:#f8f9fa;font:13px arial,sans-serif;text-align:left;color:#202124;border:0;margin:0;border-bottom:1px solid #dadce0;line-height:16px;padding:16px 28px 24px 28px}#bN015htcoyT__google-cache-hdr *{display:inline;font:inherit;text-align:inherit;color:inherit;line-height:inherit;background:none;border:0;margin:0;padding:0;letter-spacing:0}#bN015htcoyT__google-cache-hdr a{text-decoration:none;color:#1a0dab}#bN015htcoyT__google-cache-hdr a:hover{text-decoration:underline}#bN015htcoyT__google-cache-hdr a:visited{color:#4b11a8}#bN015htcoyT__google-cache-hdr div{display:block;margin-top:4px}#bN015htcoyT__google-cache-hdr b{font-weight:bold;display:inline-block;direction:ltr}</style><div id="bN015htcoyT__google-cache-hdr"><div><span>这是 Google 对 <a href="https://www.cxyzjd.com/article/qq_38762237/107815524">https://www.cxyzjd.com/article/qq_38762237/107815524</a> 的缓存。</span>&nbsp;<span>这是该网页在 2021年11月5日 07:28:53 GMT 的快照。</span>&nbsp;<span><a href="https://www.cxyzjd.com/article/qq_38762237/107815524">当前页</a>在此期间可能已经更改。</span>&nbsp;<a href="http://support.google.com/websearch/bin/answer.py?hl=zh-CN&amp;p=cached&amp;answer=1687222"><span>了解详情</span>.</a></div><div><span style="display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap"><span style="margin-right:28px"><span style="font-weight:bold">完整版本</span></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:_iHifSFoEWsJ:https://www.cxyzjd.com/article/qq_38762237/107815524&amp;newwindow=1&amp;hl=zh-CN&amp;strip=1&amp;vwsrc=0"><span>纯文字版本</span></a></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:_iHifSFoEWsJ:https://www.cxyzjd.com/article/qq_38762237/107815524&amp;newwindow=1&amp;hl=zh-CN&amp;strip=0&amp;vwsrc=1"><span>查看源代码</span></a></span></span></div><span style="display:inline-block;margin-top:8px;color:#70757a"><span>提示：要在此页面上快速找到您的搜索字词，请按 <b>Ctrl+F</b> 或者 <b>⌘-F</b>（Mac），然后使用查找栏搜索。</span></span></div><div style="position:relative;"><!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><meta name="keywords" content="【Spring源码分析】1、IDEA导入spring-framework-5.2.8.RELEASE源码构建本地阅读环境_Tellsea-程序员宅基地" /><meta name="description" content="文章目录1、构建初始化工作2、构建spring源码到本地10、Spring-Framework 各个模块的作用1、构建初始化工作相关软件版本必须一致，否则会产生各种不必要的错误等JDK 1.8Gradle-5.6.4（可以查看gradle/wrapper/gradle-wrapper.properties文件中配置的版本，官方提供的是radle-5.6.4）IntelliJ IDEA 2019.1 x64 以上2、构建spring源码到本地最新源码地址最新稳定版源码地址（推荐）将源" /><!--[if IE]>    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    <![endif]--><title>【Spring源码分析】1、IDEA导入spring-framework-5.2.8.RELEASE源码构建本地阅读环境_Tellsea-程序员宅基地 - 程序员宅基地</title><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9066218177779829" crossorigin="anonymous"></script><script type="text/javascript" async="true">(function() {    var host = 'www.themoneytizer.com';    var element = document.createElement('script');    var firstScript = document.getElementsByTagName('script')[0];    var url = 'https://quantcast.mgr.consensu.org'        .concat('/choice/', '6Fv0cGNfc_bw8', '/', host, '/choice.js');    var uspTries = 0;    var uspTriesLimit = 3;    element.async = true;    element.type = 'text/javascript';    element.src = url;    firstScript.parentNode.insertBefore(element, firstScript);    function makeStub() {        var TCF_LOCATOR_NAME = '__tcfapiLocator';        var queue = [];        var win = window;        var cmpFrame;        function addFrame() {            var doc = win.document;            var otherCMP = !!(win.frames[TCF_LOCATOR_NAME]);            if (!otherCMP) {                if (doc.body) {                    var iframe = doc.createElement('iframe');                    iframe.style.cssText = 'display:none';                    iframe.name = TCF_LOCATOR_NAME;                    doc.body.appendChild(iframe);                } else {                    setTimeout(addFrame, 5);                }            }            return !otherCMP;        }        function tcfAPIHandler() {            var gdprApplies;            var args = arguments;            if (!args.length) {                return queue;            } else if (args[0] === 'setGdprApplies') {                if (                    args.length > 3 &&                    args[2] === 2 &&                    typeof args[3] === 'boolean'                ) {                    gdprApplies = args[3];                    if (typeof args[2] === 'function') {                        args[2]('set', true);                    }                }            } else if (args[0] === 'ping') {                var retr = {                    gdprApplies: gdprApplies,                    cmpLoaded: false,                    cmpStatus: 'stub'                };                if (typeof args[2] === 'function') {                    args[2](retr);                }            } else {                queue.push(args);            }        }        function postMessageEventHandler(event) {            var msgIsString = typeof event.data === 'string';            var json = {};            try {                if (msgIsString) {                    json = JSON.parse(event.data);                } else {                    json = event.data;                }            } catch (ignore) {}            var payload = json.__tcfapiCall;            if (payload) {                window.__tcfapi(                    payload.command,                    payload.version,                    function(retValue, success) {                        var returnMsg = {                            __tcfapiReturn: {                                returnValue: retValue,                                success: success,                                callId: payload.callId                            }                        };                        if (msgIsString) {                            returnMsg = JSON.stringify(returnMsg);                        }                        event.source.postMessage(returnMsg, '*');                    },                    payload.parameter                );            }        }        while (win) {            try {                if (win.frames[TCF_LOCATOR_NAME]) {                    cmpFrame = win;                    break;                }            } catch (ignore) {}            if (win === window.top) {                break;            }            win = win.parent;        }        if (!cmpFrame) {            addFrame();            win.__tcfapi = tcfAPIHandler;            win.addEventListener('message', postMessageEventHandler, false);        }    };    if (typeof module !== 'undefined') {        module.exports = makeStub;    } else {        makeStub();    }    var uspStubFunction = function() {        var arg = arguments;        if (typeof window.__uspapi !== uspStubFunction) {            setTimeout(function() {                if (typeof window.__uspapi !== 'undefined') {                    window.__uspapi.apply(window.__uspapi, arg);                }            }, 500);        }    };    var checkIfUspIsReady = function() {        uspTries++;        if (window.__uspapi === uspStubFunction && uspTries < uspTriesLimit) {            console.warn('USP is not accessible');        } else {            clearInterval(uspInterval);        }    };    if (typeof window.__uspapi === 'undefined') {        window.__uspapi = uspStubFunction;        var uspInterval = setInterval(checkIfUspIsReady, 6000);    }})();</script></head><body><header><script>var _hmt = _hmt || [];(function() {  var hm = document.createElement("script");  hm.src = "https://hm.baidu.com/hm.js?6cbb0b5c46d9c0d9f023dd022abfc71e";  var s = document.getElementsByTagName("script")[0];   s.parentNode.insertBefore(hm, s);})();</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JCH1CNWGFS"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'G-JCH1CNWGFS');</script><link href="/css/bootstrap.css" rel="stylesheet" /><link href="/css/style.css" rel="stylesheet" /><link href='/css/css.css' rel='stylesheet' type='text/css' /><script type="text/javascript" src="/js/jquery.min.js"></script><div id="header"><div class="container"><div class="row"><div class="col-md-4 logo-div"><div class="logo-inner"><div class="logo-name"><a href="/"><span>程序员宅基地</span><small>程序员宅基地，技术文章由你所想念有所思</small></a></div><br /><div class="links-home"><a href="/">首页 /</a><a href="#">联系我们 /</a><a href="/copyright" rel="nofollow,noindex" target="_blank">版权申明/</a><a href="/privacy-policy" rel="nofollow,noindex" target="_blank">隐私条款</a></div></div></div></div></div></div><div style="width: 100%;text-align: center"><a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?source=5176.11533457&amp;userCode=qy9bwd3g" target="_blank"><img src="https://www.cxyzjd.com/images/guanggao.jpg" style="width: 80% !important;height: 120px;"></a></div><div class="info-sec"><div class="container"><div class="row"><div class="col-md-2" style="width:100%;"><div class="social-link" style="float:right;"> <form id="searchForm" action="/searchArticle" method="post"><div><input type="text" name="qc" style="width:200px;" /> <input type="submit" value="搜索" style="color:black;" /></div></form></div></div><div style="clear:both;"></div></div></div></div></header><div class="container"><div class="row"><div style="text-align:center;" id="82741-31"><script src="//ads.themoneytizer.com/s/gen.js?type=31"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=31"></script></div><div style="clear:both;"></div><div class="col-md-8"><h2 style="line-height: 32px;"><span>【Spring源码分析】1、IDEA导入spring-framework-5.2.8.RELEASE源码构建本地阅读环境_Tellsea-程序员宅基地</span></h2><p style="margin-bottom:5px;">技术标签：&nbsp;<span><a href="/searchArticle?qc=Spring源码分析&amp;page=1" title="Spring源码分析">Spring源码分析</a>&nbsp;&nbsp;</span></p><div style="clear:both;"></div><div style="padding:5px 5px 5px 5px;word-wrap: break-word; word-break: normal;max-width: 850px;" id="article_content"><span><div id="content_views" class="markdown_views prism-atom-one-dark"><svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg><p></p><div class="toc"><h3>文章目录</h3><ul><li><a href="#1_1">1、构建初始化工作</a></li><li><a href="#2spring_8">2、构建spring源码到本地</a></li><li><ul><li><ul><li><a href="#1_9">（1）拉取项目源码</a></li><li><a href="#2gradle_15">（2）使用本地gradle</a></li><li><a href="#3gradlebat_19">（3）执行gradle.bat</a></li><li><a href="#3idea_22">（3）idea导入项目</a></li><li><a href="#4springoxm_27">（4）预编译spring-oxm</a></li><li><a href="#5doscgradle_30">（5）修改dosc.gradle</a></li><li><a href="#6AspectJ_33">（6）添加AspectJ编译</a></li><li><a href="#7springcorejar_54">（7）修改spring-core缺失jar</a></li><li><a href="#8SingletonTargetSource_63">（8）解决SingletonTargetSource找不到</a></li><li><a href="#9spring_73">（9）构建spring源码</a></li></ul> </li></ul> </li><li><a href="#3_87">3、创建测试模块</a></li><li><a href="#4_99">4、报错问题汇总</a></li><li><ul><li><ul><li><a href="#1CoroutinesUtils_100">（1）报错：找不到CoroutinesUtils</a></li><li><a href="#2springcglibrepack330jarspringobjenesisrepack31jar_104">（2）报错：缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar</a></li><li><a href="#3Error354_51_java____CoroutinesUtils_113">（3）报错：Error:(354, 51) java: 找不到符号 符号: 变量 CoroutinesUtils</a></li><li><a href="#4Aspectj_Error38_38_java_orgspringframeworkaoptarget_121">（4）报错：Aspectj Error:(38, 38) java: 程序包org.springframework.aop.target不存在</a></li><li><a href="#5_import_orgspringframeworkaoptargetSingletonTargetSource_142">（5）报错：找不到 import org.springframework.aop.target.SingletonTargetSource;</a></li></ul> </li></ul> </li><li><a href="#5_153">5、其他相关项目整理</a></li><li><ul><li><ul><li><a href="#1_154">（1）强迫症修改项目名与配置名相同</a></li><li><a href="#2github_162">（2）上传项目到github/码云</a></li></ul> </li></ul> </li><li><a href="#_179">微信公众号</a></li></ul></div><p></p><h1><a id="1_1"></a>1、构建初始化工作</h1><p>相关软件版本必须一致，否则会产生各种不必要的错误等</p><ul><li>JDK 1.8</li><li>Gradle-5.6.4（可以查看gradle/wrapper/gradle-wrapper.properties文件中配置的版本，官方提供的是radle-5.6.4）</li><li>IntelliJ IDEA 2019.1 x64 以上（其他版本没试过）</li></ul><h1><a id="2spring_8"></a>2、构建spring源码到本地</h1><h3><a id="1_9"></a>（1）拉取项目源码</h3><ul><li><a href="https://github.com/spring-projects/spring-framework">最新源码地址</a></li><li><a href="https://github.com/spring-projects/spring-framework/tree/v5.2.8.RELEASE">最新稳定版源码地址5.2.8.RELEASE（推荐）</a></li></ul><p>将源码拉取或下载到本地<br> <img src="https://img-blog.csdnimg.cn/2020081010181911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="2gradle_15"></a>（2）使用本地gradle</h3><p>目的是为了不需要再次下载gradle，我这里把<code>gradle-5.6.4-bin.zip</code>的安装包放在了gradle的安装目录下<br> <img src="https://img-blog.csdnimg.cn/20200810102124294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/2020081010201581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="3gradlebat_19"></a>（3）执行gradle.bat</h3><p>项目根目录输入cmd，执行gradle.bat命令<br> <img src="https://img-blog.csdnimg.cn/20200810100411163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="3idea_22"></a>（3）idea导入项目</h3><p>导入项目，使用本地gradle<br> <img src="https://img-blog.csdnimg.cn/20200810114342587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 导入之后，刷新gradle，应该要很长时间，一定要网很好的地方刷新，不然总是报错，多刷新几次<br> <img src="https://img-blog.csdnimg.cn/20200810100605751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="4springoxm_27"></a>（4）预编译spring-oxm</h3><p>这一步是官方给出的导入步骤，使用<code>./gradlew :spring-oxm:compileTestJava</code>预编译spring-oxm<br> <img src="https://img-blog.csdnimg.cn/20200810100538569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt=""></p><h3><a id="5doscgradle_30"></a>（5）修改dosc.gradle</h3><p>在编译之前还需要对<code>spring-framework-5.2.8.RELEASE/gradle/dosc.gradle</code>文档进行修改，因为有些注释，文件路径在编译时需要调整<br> <img src="https://img-blog.csdnimg.cn/20200810100824500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="6AspectJ_33"></a>（6）添加AspectJ编译</h3><p>问题原因是spring源码的AOP使用了aspectJ ，而java不识别aspectJ<br> 用迅雷下载（因为快）AspectJ：<a href="https://www.eclipse.org/aspectj/downloads.php">https://www.eclipse.org/aspectj/downloads.php</a><br> <img src="https://img-blog.csdnimg.cn/20200810104442940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810110815268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><code>java -jar aspectj-1.9.6.jar</code> 运行下载的jar进行安装<br> <img src="https://img-blog.csdnimg.cn/20200810104807466.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810104827727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/2020081010484764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> ctrl + alt + shift + s<br> <img src="https://img-blog.csdnimg.cn/20200810103707851.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 添加两个</p><ul><li>AspectJ(spring.spring-aop.main)</li><li>AspectJ(spring.spring-aspects.main)<br> <img src="https://img-blog.csdnimg.cn/20200810103850305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 添加之后的效果<br> <img src="https://img-blog.csdnimg.cn/20200810114728359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li></ul><p>修改AspectJ编译的方式<br> <img src="https://img-blog.csdnimg.cn/20200810104959814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="7springcorejar_54"></a>（7）修改spring-core缺失jar</h3><p>spring-core缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar<br> <img src="https://img-blog.csdnimg.cn/20200809110738854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 找到 Gradle&gt;spring-core&gt;Tasks&gt;other下面的两个工具，双击运行<img src="https://img-blog.csdnimg.cn/2020080913230020.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/2020080912244160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200809132505711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 把原来报错的两个jar删除，保留新导入的本地jar即可，效果图如下<br> <img src="https://img-blog.csdnimg.cn/20200810134650340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="8SingletonTargetSource_63"></a>（8）解决SingletonTargetSource找不到</h3><p>首先，打开类<code>spring-aop\src\main\java\org\springframework\aop\framework\AopProxyUtils.java</code>发现报错，<br> 报错找不到<code>import org.springframework.aop.target.SingletonTargetSource;</code>，网上没人解决这个问题，我是和同时讨论之间找到解决方法的。</p><p>在Windows下查看该目录<code>spring-aop\src\main\java\org\springframework\aop\target</code>是存在的，但是在idea中显示不出来</p><p>解决方法：File–&gt;Settings–&gt;Editor–&gt;File Types–&gt;右边Ignore files and folders找到target文件名去掉即可<br> <img src="https://img-blog.csdnimg.cn/20200810134007552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 这时，target目录出来了，但是变成了灰色，修改项目根目录下的<code>.gitignore</code>注释掉<code>target/</code>，文件则可正常使用<br> <img src="https://img-blog.csdnimg.cn/20200810134153608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="9spring_73"></a>（9）构建spring源码</h3><p>看侧边栏就知道，这个过程比较漫长，我时间短是因为clean之后构建过好几次<br> <img src="https://img-blog.csdnimg.cn/20200810110541162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 如果报错<br> <img src="https://img-blog.csdnimg.cn/2020081011061386.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 随便找一个maven项目，把下面的坐标放进去，刷新maven，让本地仓库有这个jar包即可</p><pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></code></pre><h1><a id="3_87"></a>3、创建测试模块</h1><p><img src="https://img-blog.csdnimg.cn/20200809110842499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="项目名邮件"><br> <img src="https://img-blog.csdnimg.cn/2020080911085673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200809110914956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200809110932206.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 添加spring核心依赖，<code>compile(project(":spring-context"))</code><br> <img src="https://img-blog.csdnimg.cn/20200809111030288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810135812669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200809111141692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810135906677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 如有报错，则根据以下报错汇总解决即可</p><h1><a id="4_99"></a>4、报错问题汇总</h1><h3><a id="1CoroutinesUtils_100"></a>（1）报错：找不到CoroutinesUtils</h3><p><img src="https://img-blog.csdnimg.cn/2020081011291695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 找到<code>spring-core\kotlin-coroutines\build\libs\kotlin-coroutines-5.2.8.RELEASE.jar</code>，右键 Add As Library，然后点开IDEA上方工具栏，Build - Rebuild Project，没有效果则关闭项目重新打开再点击Rebuild Project，简单粗暴<br> <img src="https://img-blog.csdnimg.cn/20200810112745870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="2springcglibrepack330jarspringobjenesisrepack31jar_104"></a>（2）报错：缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar</h3><p>spring-core缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar<br> <img src="https://img-blog.csdnimg.cn/20200809110738854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 找到 Gradle&gt;spring-core&gt;Tasks&gt;other下面的两个工具，双击运行<img src="https://img-blog.csdnimg.cn/2020080913230020.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/2020080912244160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200809132505711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 把原来报错的两个jar删除，保留新导入的本地jar即可，效果图如下<br> <img src="https://img-blog.csdnimg.cn/20200810134650340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="3Error354_51_java____CoroutinesUtils_113"></a>（3）报错：Error:(354, 51) java: 找不到符号 符号: 变量 CoroutinesUtils</h3><p><img src="https://img-blog.csdnimg.cn/20200809133428612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 找到<code>spring-core\kotlin-coroutines\build\libs\kotlin-coroutines-5.2.8.RELEASE.jar</code>，右键 Add As Library，然后点开IDEA上方工具栏，Build - Rebuild Project，没有效果则关闭项目重新打开再点击Rebuild Project，简单粗暴<br> <img src="https://img-blog.csdnimg.cn/20200810112745870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 或者执行以下操作，实际上是一样的效果， 就是将jar添加到模块中<br> <img src="https://img-blog.csdnimg.cn/2020080913365183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810111809215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="4Aspectj_Error38_38_java_orgspringframeworkaoptarget_121"></a>（4）报错：Aspectj Error:(38, 38) java: 程序包org.springframework.aop.target不存在</h3><p>问题原因是spring源码的AOP使用了aspectJ ，而java不识别aspectJ<br> 用迅雷下载（因为快）AspectJ：<a href="https://www.eclipse.org/aspectj/downloads.php">https://www.eclipse.org/aspectj/downloads.php</a><br> <img src="https://img-blog.csdnimg.cn/20200810104442940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810110815268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><code>java -jar aspectj-1.9.6.jar</code> 运行下载的jar进行安装<br> <img src="https://img-blog.csdnimg.cn/20200810104807466.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810104827727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/2020081010484764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> ctrl + alt + shift + s<br> <img src="https://img-blog.csdnimg.cn/20200810103707851.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 添加两个</p><ul><li>AspectJ(spring.spring-aop.main)</li><li>AspectJ(spring.spring-aspects.main)<br> <img src="https://img-blog.csdnimg.cn/20200810103850305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 添加之后的效果<br> <img src="https://img-blog.csdnimg.cn/20200810114728359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li></ul><p>修改AspectJ编译的方式<br> <img src="https://img-blog.csdnimg.cn/20200810104959814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="5_import_orgspringframeworkaoptargetSingletonTargetSource_142"></a>（5）报错：找不到 import org.springframework.aop.target.SingletonTargetSource;</h3><p><img src="https://img-blog.csdnimg.cn/20200810115627320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 首先，打开类<code>spring-aop\src\main\java\org\springframework\aop\framework\AopProxyUtils.java</code>发现报错，<br> 报错找不到<code>import org.springframework.aop.target.SingletonTargetSource;</code>，网上没人解决这个问题，我是和同时讨论之间找到解决方法的。</p><p>在Windows下查看该目录<code>spring-aop\src\main\java\org\springframework\aop\target</code>是存在的，但是在idea中显示不出来</p><p>解决方法：File–&gt;Settings–&gt;Editor–&gt;File Types–&gt;右边Ignore files and folders找到target文件名去掉即可<br> <img src="https://img-blog.csdnimg.cn/20200810134007552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 这时，target目录出来了，但是变成了灰色，修改项目根目录下的<code>.gitignore</code>注释掉<code>target/</code>，文件则可正常使用<br> <img src="https://img-blog.csdnimg.cn/20200810134153608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1><a id="5_153"></a>5、其他相关项目整理</h1><h3><a id="1_154"></a>（1）强迫症修改项目名与配置名相同</h3><p>我们这里可以看到，后面的名字和项目名字不同，这里统一处理以下，将右侧的rootProject.name修改为以下值</p><pre><code class="prism language-java">rootProject<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"spring-framework-5.2.8.RELEASE"</span></code></pre><p><img src="https://img-blog.csdnimg.cn/20200810141153490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 刷新完成之后，强迫症消失了<br> <img src="https://img-blog.csdnimg.cn/20200810141345207.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3><a id="2github_162"></a>（2）上传项目到github/码云</h3><p>先使用github/码云创建仓库地址，然后拿到仓库地址，例如：</p><pre><code class="prism language-java">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>Tellsea<span class="token operator">/</span>spring<span class="token operator">-</span>framework<span class="token operator">-</span><span class="token number">5.2</span><span class="token number">.8</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">.</span>git</code></pre><p>把项目构建成git仓库<br> <img src="https://img-blog.csdnimg.cn/20200810141622937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810141644336.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 现在所有文件为红色，然后通过右键项目名，git，add，把所有文件变成绿色<br> <img src="https://img-blog.csdnimg.cn/20200810141714103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 然后提交文件到缓存区，过程可能慢一点，因为文件数量有点大<br> <img src="https://img-blog.csdnimg.cn/2020081014195958.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20200810142050671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 提交到缓存区之后，本地文件变成白色，但是线上的代码仓库还没有代码，我们还需要将缓存区提交到线上<br> <img src="https://img-blog.csdnimg.cn/2020081014312813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 填写第一步创建的线上仓库地址，然后点击提交即可</p><h1><a id="_179"></a>微信公众号</h1><p><img src="https://img-blog.csdnimg.cn/20210317114147258.jpg#pic_center" alt="每天Get一个小技巧"></p></div></span></div><div style="float:right;"><div class="article-copyright"><span class="creativecommons"> <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"> </a> <span>版权声明：本文为博主原创文章，遵循<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。</span><div class="article-source-link2222">本文链接：<a href="https://blog.csdn.net/qq_38762237/article/details/107815524">https://blog.csdn.net/qq_38762237/article/details/107815524</a></div></span></div></div><div style="clear:both;"></div><div id="cprt" style="float:right;font-size:12px;padding-top:15px;"><a href="/copyright" rel="nofollow,noindex" target="_blank">原作者删帖</a>&nbsp;&nbsp;<a href="/copyright" rel="nofollow,noindex" target="_blank">不实内容删帖</a>&nbsp;&nbsp;<a href="/copyright" title="投诉本文含广告或垃圾信息">广告或垃圾文章投诉</a></div><div style="clear:both;"></div><hr><div id="82741-11"><script src="//ads.themoneytizer.com/s/gen.js?type=11"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=11"></script></div><h3><span>智能推荐</span></h3><div></div><div id="82741-11"><script src="//ads.themoneytizer.com/s/gen.js?type=11"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=11"></script></div><h3><span>随便推点</span></h3><div></div><div id="bottomads"></div></div><div class="col-md-4"><div id="82741-2"><script src="//ads.themoneytizer.com/s/gen.js?type=2"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=2"></script></div><h3><span>推荐文章</span></h3><div style="padding:5px 5px 0px 5px;word-wrap: break-word; word-break: normal;"><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_30344131/96876757">Springboot配置多数据源（Mysql和Orcale）--（Idea Maven JDBCTemplate支持下的）_weixin_30344131的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_34008933/90688715">Linux查找find命令详解_weixin_34008933的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/u010926630/9036633">【Linux基础】用Gdb调试有问题的程序_u010926630的专栏-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_33972649/93864403">毕业三年_weixin_33972649的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/Fu_Monkey/107406463">react 报错0.chunk.js:449884 Warning: Can‘t perform a React state update on an unmounted component. Thi_CSDN_Alisa的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/onlyyjco/52678964">java 8 新特性（4.Stream API）_onlyyjco的专栏-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/qq_42739591/109313050">十行Python代码写一个聊天机器人_柠檬味的cat的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/lostgdi/9392281">驱动精灵锁定www.duba.com首页无法更改_lostgdi的专栏-程序员宅基地</a></li></ul></div><div id="82741-3"><script src="//ads.themoneytizer.com/s/gen.js?type=3"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=3"></script></div><h3><span>热门文章</span></h3><div style="padding:5px 5px 0px 5px;word-wrap: break-word; word-break: normal;"><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_39831170/117655598">android x86debug,Debug HowTo | Android-x86_weixin_39831170的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/u013617144/79622930">【LINQ】Where 与TakeWhile的区别_NopDes1re的专栏-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/feixiangsmile/100810374">基于chatterbot的入门运行介绍_feixiangsmile的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_33882443/93613703">Thread.Sleep在WinRT中---uwp应用_weixin_33882443的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_30617695/99496416">模板库_weixin_30617695的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/Jun5008/118581011">gradle-7.1.1-all 百度网盘下载_Jun5008的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/weixin_48606170/116496643">SQL语句 逗号拆分与逗号拼接_扶de起的阿斗 的博客-程序员宅基地</a></li></ul><ul style="list-style: none;padding-left:0px;"><li style="padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;"><a href="/article/YiGE_snail/117978439">JavaWeb 后端 &lt;十一&gt; 之 DBUtils 框架 （基本使用 结果集 事务处理 对表读取）_YiGE_snail的专栏-程序员宅基地</a></li></ul></div><div id="82741-20"><script src="//ads.themoneytizer.com/s/gen.js?type=20"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=20"></script></div><h3><span>相关标签</span></h3><div style="padding:5px 5px 0px 5px;word-wrap: break-word; word-break: normal;"></div><div id="mbads-sider"></div><div id="82741-19"><script src="//ads.themoneytizer.com/s/gen.js?type=19"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=19"></script></div></div><div id="82741-28"><script src="//ads.themoneytizer.com/s/gen.js?type=28"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=28"></script></div><div id="82741-6"><script src="//ads.themoneytizer.com/s/gen.js?type=6"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=6"></script></div><div id="82741-5"><script src="//ads.themoneytizer.com/s/gen.js?type=5"></script><script src="//ads.themoneytizer.com/s/requestform.js?siteId=82741&formatId=5"></script></div></div></div><footer><div class="footer-sec" id="footer-sec"><div class="container"><div class="row"><script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279778326'%3E%3C/span%3E%3Cscript src='https://s9.cnzz.com/z_stat.php%3Fid%3D1279778326%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script><div class="col-md-12 foo-inner">Copyright &copy; 2018-2021 - All Rights Reserved - <a th:href="${domain}" th:text="${domain}" style="color:white;"></a> <span style="color:red;">网站内容人工审核和清理中！</span></div></div></div></div></footer></body></html>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>Spring源码编译</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a3448465bfce.html"/>
    <url>/2022/12/a3448465bfce.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cxyzjd.com/article/qq_38762237/107815524&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"><span class="hljs-selector-tag">body</span>&#123;<span class="hljs-attribute">margin-left</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">margin-right</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">margin-top</span>:<span class="hljs-number">0</span>&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span>&#123;<span class="hljs-attribute">background</span>:<span class="hljs-number">#f8f9fa</span>;<span class="hljs-attribute">font</span>:<span class="hljs-number">13px</span> arial,sans-serif;<span class="hljs-attribute">text-align</span><span class="hljs-selector-pseudo">:left</span>;<span class="hljs-attribute">color</span>:<span class="hljs-number">#202124</span>;<span class="hljs-attribute">border</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">border-bottom</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#dadce0</span>;<span class="hljs-attribute">line-height</span>:<span class="hljs-number">16px</span>;<span class="hljs-attribute">padding</span>:<span class="hljs-number">16px</span> <span class="hljs-number">28px</span> <span class="hljs-number">24px</span> <span class="hljs-number">28px</span>&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span> *&#123;<span class="hljs-attribute">display</span>:inline;<span class="hljs-attribute">font</span>:inherit;<span class="hljs-attribute">text-align</span>:inherit;<span class="hljs-attribute">color</span>:inherit;<span class="hljs-attribute">line-height</span>:inherit;<span class="hljs-attribute">background</span>:none;<span class="hljs-attribute">border</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">padding</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">letter-spacing</span>:<span class="hljs-number">0</span>&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span> <span class="hljs-selector-tag">a</span>&#123;<span class="hljs-attribute">text-decoration</span>:none;<span class="hljs-attribute">color</span>:<span class="hljs-number">#1a0dab</span>&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>&#123;<span class="hljs-attribute">text-decoration</span>:underline&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:visited</span>&#123;<span class="hljs-attribute">color</span>:<span class="hljs-number">#4b11a8</span>&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span> <span class="hljs-selector-tag">div</span>&#123;<span class="hljs-attribute">display</span>:block;<span class="hljs-attribute">margin-top</span>:<span class="hljs-number">4px</span>&#125;<span class="hljs-selector-id">#bN015htcoyT__google-cache-hdr</span> <span class="hljs-selector-tag">b</span>&#123;<span class="hljs-attribute">font-weight</span>:bold;<span class="hljs-attribute">display</span>:inline-block;<span class="hljs-attribute">direction</span>:ltr&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bN015htcoyT__google-cache-hdr&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>这是 Google 对 <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cxyzjd.com/article/qq_38762237/107815524&quot;</span>&gt;</span>https://www.cxyzjd.com/article/qq_38762237/107815524<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> 的缓存。<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>这是该网页在 2021年11月5日 07:28:53 GMT 的快照。<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cxyzjd.com/article/qq_38762237/107815524&quot;</span>&gt;</span>当前页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>在此期间可能已经更改。<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://support.google.com/websearch/bin/answer.py?hl=zh-CN<span class="hljs-symbol">&amp;amp;</span>p=cached<span class="hljs-symbol">&amp;amp;</span>answer=1687222&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>了解详情<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-right:28px&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-weight:bold&quot;</span>&gt;</span>完整版本<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-right:28px&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://webcache.googleusercontent.com/search?q=cache:_iHifSFoEWsJ:https://www.cxyzjd.com/article/qq_38762237/107815524<span class="hljs-symbol">&amp;amp;</span>newwindow=1<span class="hljs-symbol">&amp;amp;</span>hl=zh-CN<span class="hljs-symbol">&amp;amp;</span>strip=1<span class="hljs-symbol">&amp;amp;</span>vwsrc=0&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>纯文字版本<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-right:28px&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://webcache.googleusercontent.com/search?q=cache:_iHifSFoEWsJ:https://www.cxyzjd.com/article/qq_38762237/107815524<span class="hljs-symbol">&amp;amp;</span>newwindow=1<span class="hljs-symbol">&amp;amp;</span>hl=zh-CN<span class="hljs-symbol">&amp;amp;</span>strip=0<span class="hljs-symbol">&amp;amp;</span>vwsrc=1&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>查看源代码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:inline-block;margin-top:8px;color:#70757a&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>提示：要在此页面上快速找到您的搜索字词，请按 <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Ctrl+F<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> 或者 <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>⌘-F<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>（Mac），然后使用查找栏搜索。<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;position:relative;&quot;</span>&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keywords&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;【Spring源码分析】1、IDEA导入spring-framework-5.2.8.RELEASE源码构建本地阅读环境_Tellsea-程序员宅基地&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;文章目录1、构建初始化工作2、构建spring源码到本地10、Spring-Framework 各个模块的作用1、构建初始化工作相关软件版本必须一致，否则会产生各种不必要的错误等JDK 1.8Gradle-5.6.4（可以查看gradle/wrapper/gradle-wrapper.properties文件中配置的版本，官方提供的是radle-5.6.4）IntelliJ IDEA 2019.1 x64 以上2、构建spring源码到本地最新源码地址最新稳定版源码地址（推荐）将源&quot;</span> /&gt;</span><br><span class="hljs-comment">&lt;!--[if IE]&gt;</span><br><span class="hljs-comment">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;</span><br><span class="hljs-comment">    &lt;![endif]--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>【Spring源码分析】1、IDEA导入spring-framework-5.2.8.RELEASE源码构建本地阅读环境_Tellsea-程序员宅基地 - 程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9066218177779829&quot;</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">async</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> host = <span class="hljs-string">&#x27;www.themoneytizer.com&#x27;</span>;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;script&#x27;</span>);</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> firstScript = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&#x27;script&#x27;</span>)[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> url = <span class="hljs-string">&#x27;https://quantcast.mgr.consensu.org&#x27;</span></span><br><span class="language-javascript">        .<span class="hljs-title function_">concat</span>(<span class="hljs-string">&#x27;/choice/&#x27;</span>, <span class="hljs-string">&#x27;6Fv0cGNfc_bw8&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, host, <span class="hljs-string">&#x27;/choice.js&#x27;</span>);</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> uspTries = <span class="hljs-number">0</span>;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> uspTriesLimit = <span class="hljs-number">3</span>;</span><br><span class="language-javascript">    element.<span class="hljs-property">async</span> = <span class="hljs-literal">true</span>;</span><br><span class="language-javascript">    element.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;text/javascript&#x27;</span>;</span><br><span class="language-javascript">    element.<span class="hljs-property">src</span> = url;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    firstScript.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">insertBefore</span>(element, firstScript);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">makeStub</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">TCF_LOCATOR_NAME</span> = <span class="hljs-string">&#x27;__tcfapiLocator&#x27;</span>;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> queue = [];</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> win = <span class="hljs-variable language_">window</span>;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> cmpFrame;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">addFrame</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> doc = win.<span class="hljs-property">document</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> otherCMP = !!(win.<span class="hljs-property">frames</span>[<span class="hljs-variable constant_">TCF_LOCATOR_NAME</span>]);</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (!otherCMP) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (doc.<span class="hljs-property">body</span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">var</span> iframe = doc.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;iframe&#x27;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">                    iframe.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">&#x27;display:none&#x27;</span>;</span><br><span class="language-javascript">                    iframe.<span class="hljs-property">name</span> = <span class="hljs-variable constant_">TCF_LOCATOR_NAME</span>;</span><br><span class="language-javascript">                    doc.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);</span><br><span class="language-javascript">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-built_in">setTimeout</span>(addFrame, <span class="hljs-number">5</span>);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> !otherCMP;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">tcfAPIHandler</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> gdprApplies;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> args = <span class="hljs-variable language_">arguments</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (!args.<span class="hljs-property">length</span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> queue;</span><br><span class="language-javascript">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;setGdprApplies&#x27;</span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (</span><br><span class="language-javascript">                    args.<span class="hljs-property">length</span> &gt; <span class="hljs-number">3</span> &amp;&amp;</span><br><span class="language-javascript">                    args[<span class="hljs-number">2</span>] === <span class="hljs-number">2</span> &amp;&amp;</span><br><span class="language-javascript">                    <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">3</span>] === <span class="hljs-string">&#x27;boolean&#x27;</span></span><br><span class="language-javascript">                ) &#123;</span><br><span class="language-javascript">                    gdprApplies = args[<span class="hljs-number">3</span>];</span><br><span class="language-javascript">                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[<span class="hljs-number">2</span>] === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;</span><br><span class="language-javascript">                        args[<span class="hljs-number">2</span>](<span class="hljs-string">&#x27;set&#x27;</span>, <span class="hljs-literal">true</span>);</span><br><span class="language-javascript">                    &#125;</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;ping&#x27;</span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> retr = &#123;</span><br><span class="language-javascript">                    <span class="hljs-attr">gdprApplies</span>: gdprApplies,</span><br><span class="language-javascript">                    <span class="hljs-attr">cmpLoaded</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">                    <span class="hljs-attr">cmpStatus</span>: <span class="hljs-string">&#x27;stub&#x27;</span></span><br><span class="language-javascript">                &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[<span class="hljs-number">2</span>] === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;</span><br><span class="language-javascript">                    args[<span class="hljs-number">2</span>](retr);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">                queue.<span class="hljs-title function_">push</span>(args);</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">postMessageEventHandler</span>(<span class="hljs-params">event</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> msgIsString = <span class="hljs-keyword">typeof</span> event.<span class="hljs-property">data</span> === <span class="hljs-string">&#x27;string&#x27;</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> json = &#123;&#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (msgIsString) &#123;</span><br><span class="language-javascript">                    json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);</span><br><span class="language-javascript">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">                    json = event.<span class="hljs-property">data</span>;</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125; <span class="hljs-keyword">catch</span> (ignore) &#123;&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> payload = json.<span class="hljs-property">__tcfapiCall</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (payload) &#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">__tcfapi</span>(</span><br><span class="language-javascript">                    payload.<span class="hljs-property">command</span>,</span><br><span class="language-javascript">                    payload.<span class="hljs-property">version</span>,</span><br><span class="language-javascript">                    <span class="hljs-keyword">function</span>(<span class="hljs-params">retValue, success</span>) &#123;</span><br><span class="language-javascript">                        <span class="hljs-keyword">var</span> returnMsg = &#123;</span><br><span class="language-javascript">                            <span class="hljs-attr">__tcfapiReturn</span>: &#123;</span><br><span class="language-javascript">                                <span class="hljs-attr">returnValue</span>: retValue,</span><br><span class="language-javascript">                                <span class="hljs-attr">success</span>: success,</span><br><span class="language-javascript">                                <span class="hljs-attr">callId</span>: payload.<span class="hljs-property">callId</span></span><br><span class="language-javascript">                            &#125;</span><br><span class="language-javascript">                        &#125;;</span><br><span class="language-javascript">                        <span class="hljs-keyword">if</span> (msgIsString) &#123;</span><br><span class="language-javascript">                            returnMsg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(returnMsg);</span><br><span class="language-javascript">                        &#125;</span><br><span class="language-javascript">                        event.<span class="hljs-property">source</span>.<span class="hljs-title function_">postMessage</span>(returnMsg, <span class="hljs-string">&#x27;*&#x27;</span>);</span><br><span class="language-javascript">                    &#125;,</span><br><span class="language-javascript">                    payload.<span class="hljs-property">parameter</span></span><br><span class="language-javascript">                );</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">while</span> (win) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (win.<span class="hljs-property">frames</span>[<span class="hljs-variable constant_">TCF_LOCATOR_NAME</span>]) &#123;</span><br><span class="language-javascript">                    cmpFrame = win;</span><br><span class="language-javascript">                    <span class="hljs-keyword">break</span>;</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125; <span class="hljs-keyword">catch</span> (ignore) &#123;&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (win === <span class="hljs-variable language_">window</span>.<span class="hljs-property">top</span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">break</span>;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">            win = win.<span class="hljs-property">parent</span>;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (!cmpFrame) &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">addFrame</span>();</span><br><span class="language-javascript">            win.<span class="hljs-property">__tcfapi</span> = tcfAPIHandler;</span><br><span class="language-javascript">            win.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;message&#x27;</span>, postMessageEventHandler, <span class="hljs-literal">false</span>);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">module</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = makeStub;</span><br><span class="language-javascript">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">makeStub</span>();</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> uspStubFunction = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> arg = <span class="hljs-variable language_">arguments</span>;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span> !== uspStubFunction) &#123;</span><br><span class="language-javascript">            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span>, arg);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;, <span class="hljs-number">500</span>);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> checkIfUspIsReady = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        uspTries++;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span> === uspStubFunction &amp;&amp; uspTries &lt; uspTriesLimit) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;USP is not accessible&#x27;</span>);</span><br><span class="language-javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-built_in">clearInterval</span>(uspInterval);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span> === <span class="hljs-string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">window</span>.<span class="hljs-property">__uspapi</span> = uspStubFunction;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> uspInterval = <span class="hljs-built_in">setInterval</span>(checkIfUspIsReady, <span class="hljs-number">6000</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">&#125;)();</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">var</span> _hmt = _hmt || [];</span><br><span class="language-javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> hm = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);</span><br><span class="language-javascript">  hm.<span class="hljs-property">src</span> = <span class="hljs-string">&quot;https://hm.baidu.com/hm.js?6cbb0b5c46d9c0d9f023dd022abfc71e&quot;</span>;</span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> s = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;script&quot;</span>)[<span class="hljs-number">0</span>]; </span><br><span class="language-javascript">  s.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">insertBefore</span>(hm, s);</span><br><span class="language-javascript">&#125;)();</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://www.googletagmanager.com/gtag/js?id=G-JCH1CNWGFS&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-variable language_">window</span>.<span class="hljs-property">dataLayer</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">dataLayer</span> || [];</span><br><span class="language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">gtag</span>(<span class="hljs-params"></span>)&#123;dataLayer.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">arguments</span>);&#125;</span><br><span class="language-javascript">  <span class="hljs-title function_">gtag</span>(<span class="hljs-string">&#x27;js&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title function_">gtag</span>(<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;G-JCH1CNWGFS&#x27;</span>);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/css/bootstrap.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/css/style.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;/css/css.css&#x27;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&#x27;stylesheet&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text/css&#x27;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-4 logo-div&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-inner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-name&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>程序员宅基地，技术文章由你所想念有所思<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;links-home&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>首页 /<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span>&gt;</span>联系我们 /<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/copyright&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;nofollow,noindex&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>版权申明<br>/<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/privacy-policy&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;nofollow,noindex&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>隐私条款<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 100%;text-align: center&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://promotion.aliyun.com/ntms/yunparter/invite.html?source=5176.11533457<span class="hljs-symbol">&amp;amp;</span>userCode=qy9bwd3g&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://www.cxyzjd.com/images/guanggao.jpg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 80% !important;height: 120px;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info-sec&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-2&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-link&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:right;&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;searchForm&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/searchArticle&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;qc&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:200px;&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;搜索&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:black;&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;clear:both;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-31&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=31&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=31&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;clear:both;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;line-height: 32px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>【Spring源码分析】1、IDEA导入spring-framework-5.2.8.RELEASE源码构建本地阅读环境_Tellsea-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-bottom:5px;&quot;</span>&gt;</span>技术标签：<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/searchArticle?qc=Spring源码分析<span class="hljs-symbol">&amp;amp;</span>page=1&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Spring源码分析&quot;</span>&gt;</span>Spring源码分析<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;clear:both;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding:5px 5px 5px 5px;word-wrap: break-word; word-break: normal;max-width: 850px;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;article_content&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content_views&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;markdown_views prism-atom-one-dark&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">stroke-linecap</span>=<span class="hljs-string">&quot;round&quot;</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M5,0 0,2.5 5,5z&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;raphael-marker-block&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;toc&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>文章目录<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#1_1&quot;</span>&gt;</span>1、构建初始化工作<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#2spring_8&quot;</span>&gt;</span>2、构建spring源码到本地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#1_9&quot;</span>&gt;</span>（1）拉取项目源码<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#2gradle_15&quot;</span>&gt;</span>（2）使用本地gradle<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#3gradlebat_19&quot;</span>&gt;</span>（3）执行gradle.bat<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#3idea_22&quot;</span>&gt;</span>（3）idea导入项目<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#4springoxm_27&quot;</span>&gt;</span>（4）预编译spring-oxm<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#5doscgradle_30&quot;</span>&gt;</span>（5）修改dosc.gradle<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#6AspectJ_33&quot;</span>&gt;</span>（6）添加AspectJ编译<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#7springcorejar_54&quot;</span>&gt;</span>（7）修改spring-core缺失jar<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#8SingletonTargetSource_63&quot;</span>&gt;</span>（8）解决SingletonTargetSource找不到<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#9spring_73&quot;</span>&gt;</span>（9）构建spring源码<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#3_87&quot;</span>&gt;</span>3、创建测试模块<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#4_99&quot;</span>&gt;</span>4、报错问题汇总<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#1CoroutinesUtils_100&quot;</span>&gt;</span>（1）报错：找不到CoroutinesUtils<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#2springcglibrepack330jarspringobjenesisrepack31jar_104&quot;</span>&gt;</span>（2）报错：缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#3Error354_51_java____CoroutinesUtils_113&quot;</span>&gt;</span>（3）报错：Error:(354, 51) java: 找不到符号 符号: 变量 CoroutinesUtils<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#4Aspectj_Error38_38_java_orgspringframeworkaoptarget_121&quot;</span>&gt;</span>（4）报错：Aspectj Error:(38, 38) java: 程序包org.springframework.aop.target不存在<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#5_import_orgspringframeworkaoptargetSingletonTargetSource_142&quot;</span>&gt;</span>（5）报错：找不到 import org.springframework.aop.target.SingletonTargetSource;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#5_153&quot;</span>&gt;</span>5、其他相关项目整理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#1_154&quot;</span>&gt;</span>（1）强迫症修改项目名与配置名相同<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#2github_162&quot;</span>&gt;</span>（2）上传项目到github/码云<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#_179&quot;</span>&gt;</span>微信公众号<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;1_1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>1、构建初始化工作<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>相关软件版本必须一致，否则会产生各种不必要的错误等<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>JDK 1.8<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Gradle-5.6.4（可以查看gradle/wrapper/gradle-wrapper.properties文件中配置的版本，官方提供的是radle-5.6.4）<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>IntelliJ IDEA 2019.1 x64 以上（其他版本没试过）<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;2spring_8&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>2、构建spring源码到本地<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;1_9&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（1）拉取项目源码<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://github.com/spring-projects/spring-framework&quot;</span>&gt;</span>最新源码地址<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://github.com/spring-projects/spring-framework/tree/v5.2.8.RELEASE&quot;</span>&gt;</span>最新稳定版源码地址5.2.8.RELEASE（推荐）<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>将源码拉取或下载到本地<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081010181911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;2gradle_15&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（2）使用本地gradle<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>目的是为了不需要再次下载gradle，我这里把<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>gradle-5.6.4-bin.zip<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>的安装包放在了gradle的安装目录下<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810102124294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081010201581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;3gradlebat_19&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（3）执行gradle.bat<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>项目根目录输入cmd，执行gradle.bat命令<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810100411163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;3idea_22&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（3）idea导入项目<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>导入项目，使用本地gradle<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810114342587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 导入之后，刷新gradle，应该要很长时间，一定要网很好的地方刷新，不然总是报错，多刷新几次<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810100605751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;4springoxm_27&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（4）预编译spring-oxm<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这一步是官方给出的导入步骤，使用<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>./gradlew :spring-oxm:compileTestJava<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>预编译spring-oxm<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810100538569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;5doscgradle_30&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（5）修改dosc.gradle<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在编译之前还需要对<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-framework-5.2.8.RELEASE/gradle/dosc.gradle<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>文档进行修改，因为有些注释，文件路径在编译时需要调整<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810100824500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;6AspectJ_33&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（6）添加AspectJ编译<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>问题原因是spring源码的AOP使用了aspectJ ，而java不识别aspectJ<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 用迅雷下载（因为快）AspectJ：<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.eclipse.org/aspectj/downloads.php&quot;</span>&gt;</span>https://www.eclipse.org/aspectj/downloads.php<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104442940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810110815268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>java -jar aspectj-1.9.6.jar<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span> 运行下载的jar进行安装<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104807466.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104827727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081010484764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> ctrl + alt + shift + s<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810103707851.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 添加两个<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>AspectJ(spring.spring-aop.main)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>AspectJ(spring.spring-aspects.main)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810103850305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 添加之后的效果<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810114728359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>修改AspectJ编译的方式<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104959814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;7springcorejar_54&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（7）修改spring-core缺失jar<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>spring-core缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809110738854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 找到 Gradle<span class="hljs-symbol">&amp;gt;</span>spring-core<span class="hljs-symbol">&amp;gt;</span>Tasks<span class="hljs-symbol">&amp;gt;</span>other下面的两个工具，双击运行<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020080913230020.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020080912244160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809132505711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 把原来报错的两个jar删除，保留新导入的本地jar即可，效果图如下<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810134650340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;8SingletonTargetSource_63&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（8）解决SingletonTargetSource找不到<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>首先，打开类<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-aop\src\main\java\org\springframework\aop\framework\AopProxyUtils.java<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>发现报错，<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 报错找不到<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>import org.springframework.aop.target.SingletonTargetSource;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>，网上没人解决这个问题，我是和同时讨论之间找到解决方法的。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在Windows下查看该目录<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-aop\src\main\java\org\springframework\aop\target<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>是存在的，但是在idea中显示不出来<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>解决方法：File–<span class="hljs-symbol">&amp;gt;</span>Settings–<span class="hljs-symbol">&amp;gt;</span>Editor–<span class="hljs-symbol">&amp;gt;</span>File Types–<span class="hljs-symbol">&amp;gt;</span>右边Ignore files and folders找到target文件名去掉即可<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810134007552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 这时，target目录出来了，但是变成了灰色，修改项目根目录下的<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>.gitignore<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>注释掉<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>target/<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>，文件则可正常使用<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810134153608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;9spring_73&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（9）构建spring源码<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>看侧边栏就知道，这个过程比较漫长，我时间短是因为clean之后构建过好几次<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810110541162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 如果报错<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081011061386.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 随便找一个maven项目，把下面的坐标放进去，刷新maven，让本地仓库有这个jar包即可<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prism language-xml&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>dependency<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>groupId<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>groupId<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>artifactId<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>aspectjtools<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>artifactId<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>version<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>1.9.5<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>version<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token tag&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>dependency<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;3_87&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>3、创建测试模块<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809110842499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;项目名邮件&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020080911085673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809110914956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809110932206.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 添加spring核心依赖，<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>compile(project(&quot;:spring-context&quot;))<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809111030288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810135812669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809111141692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810135906677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 如有报错，则根据以下报错汇总解决即可<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;4_99&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>4、报错问题汇总<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;1CoroutinesUtils_100&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（1）报错：找不到CoroutinesUtils<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081011291695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 找到<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-core\kotlin-coroutines\build\libs\kotlin-coroutines-5.2.8.RELEASE.jar<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>，右键 Add As Library，然后点开IDEA上方工具栏，Build - Rebuild Project，没有效果则关闭项目重新打开再点击Rebuild Project，简单粗暴<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810112745870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;2springcglibrepack330jarspringobjenesisrepack31jar_104&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（2）报错：缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>spring-core缺少spring-cglib-repack-3.3.0.jar，spring-objenesis-repack-3.1.jar<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809110738854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 找到 Gradle<span class="hljs-symbol">&amp;gt;</span>spring-core<span class="hljs-symbol">&amp;gt;</span>Tasks<span class="hljs-symbol">&amp;gt;</span>other下面的两个工具，双击运行<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020080913230020.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020080912244160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809132505711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 把原来报错的两个jar删除，保留新导入的本地jar即可，效果图如下<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810134650340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;3Error354_51_java____CoroutinesUtils_113&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（3）报错：Error:(354, 51) java: 找不到符号 符号: 变量 CoroutinesUtils<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200809133428612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 找到<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-core\kotlin-coroutines\build\libs\kotlin-coroutines-5.2.8.RELEASE.jar<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>，右键 Add As Library，然后点开IDEA上方工具栏，Build - Rebuild Project，没有效果则关闭项目重新打开再点击Rebuild Project，简单粗暴<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810112745870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 或者执行以下操作，实际上是一样的效果， 就是将jar添加到模块中<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020080913365183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810111809215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;4Aspectj_Error38_38_java_orgspringframeworkaoptarget_121&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（4）报错：Aspectj Error:(38, 38) java: 程序包org.springframework.aop.target不存在<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>问题原因是spring源码的AOP使用了aspectJ ，而java不识别aspectJ<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 用迅雷下载（因为快）AspectJ：<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.eclipse.org/aspectj/downloads.php&quot;</span>&gt;</span>https://www.eclipse.org/aspectj/downloads.php<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104442940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810110815268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>java -jar aspectj-1.9.6.jar<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span> 运行下载的jar进行安装<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104807466.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104827727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081010484764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> ctrl + alt + shift + s<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810103707851.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 添加两个<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>AspectJ(spring.spring-aop.main)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>AspectJ(spring.spring-aspects.main)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810103850305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 添加之后的效果<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810114728359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>修改AspectJ编译的方式<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810104959814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;5_import_orgspringframeworkaoptargetSingletonTargetSource_142&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（5）报错：找不到 import org.springframework.aop.target.SingletonTargetSource;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810115627320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 首先，打开类<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-aop\src\main\java\org\springframework\aop\framework\AopProxyUtils.java<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>发现报错，<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 报错找不到<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>import org.springframework.aop.target.SingletonTargetSource;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>，网上没人解决这个问题，我是和同时讨论之间找到解决方法的。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在Windows下查看该目录<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>spring-aop\src\main\java\org\springframework\aop\target<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>是存在的，但是在idea中显示不出来<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>解决方法：File–<span class="hljs-symbol">&amp;gt;</span>Settings–<span class="hljs-symbol">&amp;gt;</span>Editor–<span class="hljs-symbol">&amp;gt;</span>File Types–<span class="hljs-symbol">&amp;gt;</span>右边Ignore files and folders找到target文件名去掉即可<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810134007552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 这时，target目录出来了，但是变成了灰色，修改项目根目录下的<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>.gitignore<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>注释掉<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>target/<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>，文件则可正常使用<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810134153608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;5_153&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>5、其他相关项目整理<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;1_154&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（1）强迫症修改项目名与配置名相同<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>我们这里可以看到，后面的名字和项目名字不同，这里统一处理以下，将右侧的rootProject.name修改为以下值<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prism language-java&quot;</span>&gt;</span>rootProject<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>name <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token string&quot;</span>&gt;</span>&quot;spring-framework-5.2.8.RELEASE&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810141153490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 刷新完成之后，强迫症消失了<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810141345207.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;2github_162&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>（2）上传项目到github/码云<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>先使用github/码云创建仓库地址，然后拿到仓库地址，例如：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prism language-java&quot;</span>&gt;</span>https<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>:<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>github<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>com<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>Tellsea<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>spring<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>framework<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token operator&quot;</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token number&quot;</span>&gt;</span>5.2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token number&quot;</span>&gt;</span>.8<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;token punctuation&quot;</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>git<br><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>把项目构建成git仓库<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810141622937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810141644336.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 现在所有文件为红色，然后通过右键项目名，git，add，把所有文件变成绿色<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810141714103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 然后提交文件到缓存区，过程可能慢一点，因为文件数量有点大<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081014195958.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20200810142050671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 提交到缓存区之后，本地文件变成白色，但是线上的代码仓库还没有代码，我们还需要将缓存区提交到线上<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/2020081014312813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NzYyMjM3,size_16,color_FFFFFF,t_70&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;在这里插入图片描述&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 填写第一步创建的线上仓库地址，然后点击提交即可<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_179&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>微信公众号<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://img-blog.csdnimg.cn/20210317114147258.jpg#pic_center&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;每天Get一个小技巧&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:right;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-copyright&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;creativecommons&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;license&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://creativecommons.org/licenses/by-sa/4.0/&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>版权声明：本文为博主原创文章，遵循<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://creativecommons.org/licenses/by-sa/4.0/&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;noopener&quot;</span>&gt;</span> CC 4.0 BY-SA <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>版权协议，转载请附上原文出处链接和本声明。<br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-source-link2222&quot;</span>&gt;</span><br>本文链接：<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://blog.csdn.net/qq_38762237/article/details/107815524&quot;</span>&gt;</span>https://blog.csdn.net/qq_38762237/article/details/107815524<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;clear:both;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cprt&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float:right;font-size:12px;padding-top:15px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/copyright&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;nofollow,noindex&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>原作者删帖<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/copyright&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;nofollow,noindex&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>不实内容删帖<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/copyright&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;投诉本文含广告或垃圾信息&quot;</span>&gt;</span>广告或垃圾文章投诉<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;clear:both;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-11&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=11&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=11&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>智能推荐<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-11&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=11&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=11&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>随便推点<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bottomads&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-4&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-2&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=2&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=2&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>推荐文章<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding:5px 5px 0px 5px;word-wrap: break-word; word-break: normal;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_30344131/96876757&quot;</span>&gt;</span>Springboot配置多数据源（Mysql和Orcale）--（Idea Maven JDBCTemplate支持下的）_weixin_30344131的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_34008933/90688715&quot;</span>&gt;</span>Linux查找find命令详解_weixin_34008933的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/u010926630/9036633&quot;</span>&gt;</span>【Linux基础】用Gdb调试有问题的程序_u010926630的专栏-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_33972649/93864403&quot;</span>&gt;</span>毕业三年_weixin_33972649的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/Fu_Monkey/107406463&quot;</span>&gt;</span>react 报错0.chunk.js:449884 Warning: Can‘t perform a React state update on an unmounted component. Thi_CSDN_Alisa的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/onlyyjco/52678964&quot;</span>&gt;</span>java 8 新特性（4.Stream API）_onlyyjco的专栏-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/qq_42739591/109313050&quot;</span>&gt;</span>十行Python代码写一个聊天机器人_柠檬味的cat的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/lostgdi/9392281&quot;</span>&gt;</span>驱动精灵锁定www.duba.com首页无法更改_lostgdi的专栏-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-3&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=3&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=3&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>热门文章<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding:5px 5px 0px 5px;word-wrap: break-word; word-break: normal;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_39831170/117655598&quot;</span>&gt;</span>android x86debug,Debug HowTo | Android-x86_weixin_39831170的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/u013617144/79622930&quot;</span>&gt;</span>【LINQ】Where 与TakeWhile的区别_NopDes1re的专栏-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/feixiangsmile/100810374&quot;</span>&gt;</span>基于chatterbot的入门运行介绍_feixiangsmile的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_33882443/93613703&quot;</span>&gt;</span>Thread.Sleep在WinRT中---uwp应用_weixin_33882443的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_30617695/99496416&quot;</span>&gt;</span>模板库_weixin_30617695的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/Jun5008/118581011&quot;</span>&gt;</span>gradle-7.1.1-all 百度网盘下载_Jun5008的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/weixin_48606170/116496643&quot;</span>&gt;</span>SQL语句 逗号拆分与逗号拼接_扶de起的阿斗 的博客-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;list-style: none;padding-left:0px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-top: 6px;padding-bottom: 6px;border-bottom:1px solid #EBEBEB;line-height:20px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/article/YiGE_snail/117978439&quot;</span>&gt;</span>JavaWeb 后端 <span class="hljs-symbol">&amp;lt;</span>十一<span class="hljs-symbol">&amp;gt;</span> 之 DBUtils 框架 （基本使用 结果集 事务处理 对表读取）_YiGE_snail的专栏-程序员宅基地<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-20&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=20&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=20&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>相关标签<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding:5px 5px 0px 5px;word-wrap: break-word; word-break: normal;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mbads-sider&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-19&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=19&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=19&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-28&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=28&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=28&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-6&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;82741-5&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/gen.js?type=5&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//ads.themoneytizer.com/s/requestform.js?siteId=82741&amp;formatId=5&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-sec&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;footer-sec&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">write</span>(<span class="hljs-built_in">unescape</span>(<span class="hljs-string">&quot;%3Cspan id=&#x27;cnzz_stat_icon_1279778326&#x27;%3E%3C/span%3E%3Cscript src=&#x27;https://s9.cnzz.com/z_stat.php%3Fid%3D1279778326%26online%3D1%26show%3Dline&#x27; type=&#x27;text/javascript&#x27;%3E%3C/script%3E&quot;</span>));</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-12 foo-inner&quot;</span>&gt;</span><br>Copyright <span class="hljs-symbol">&amp;copy;</span> 2018-2021 - All Rights Reserved - <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;$&#123;domain&#125;&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;domain&#125;&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:white;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:red;&quot;</span>&gt;</span>网站内容人工审核和清理中！<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>Spring源码编译</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/9a2b28c11e3d.html"/>
    <url>/2022/12/9a2b28c11e3d.html</url>
    
    <content type="html"><![CDATA[<h1 id="git和github的关系"><a href="#git和github的关系" class="headerlink" title="git和github的关系"></a>git和github的关系</h1><p>git是代码管理工具，gitHub是基于git打造的一个开源社区。</p><h1 id="git的使用"><a href="#git的使用" class="headerlink" title="git的使用"></a>git的使用</h1><h2 id="1-创建版本库"><a href="#1-创建版本库" class="headerlink" title="1. 创建版本库"></a>1. 创建版本库</h2><h3 id="版本库定义"><a href="#版本库定义" class="headerlink" title="版本库定义"></a>版本库定义</h3><p>版本库就是仓库，英文是repository，可以理解成其为一个目录，这个目录里所有文件都可以被git管理起来，每个文件的修改，删除，Git都能跟踪，以便任何时刻都可追踪历史，或者在将来某个时刻还可以将文件“还原”。</p><h3 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h3><p>在这里创建了名为testgit的仓库<br><img src="https://pic.downk.cc/item/5fc75027394ac523789cfd8d.png"></p><h3 id="通过git-init把这个目录变成git可以管理的仓库："><a href="#通过git-init把这个目录变成git可以管理的仓库：" class="headerlink" title="通过git init把这个目录变成git可以管理的仓库："></a>通过git init把这个目录变成git可以管理的仓库：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git init<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc75027394ac523789cfd7a.png"></p><h2 id="2-git使用"><a href="#2-git使用" class="headerlink" title="2. git使用"></a>2. git使用</h2><h3 id="先创建一个记事本文件readme-txt"><a href="#先创建一个记事本文件readme-txt" class="headerlink" title="先创建一个记事本文件readme.txt"></a>先创建一个记事本文件readme.txt</h3><p>内容为：This is my first git file.<br><img src="https://pic.downk.cc/item/5fc75027394ac523789cfd6e.png?ynotemdtimestamp=1617365973827" alt="img"></p><h3 id="第一步（将文件添加到git中）"><a href="#第一步（将文件添加到git中）" class="headerlink" title="第一步（将文件添加到git中）"></a>第一步（将文件添加到git中）</h3><p>使用命令git add readme.txt添加到暂存区里面去，如下： <img src="https://pic.downk.cc/item/5fc75027394ac523789cfd5d.png?ynotemdtimestamp=1617365973827" alt="img">没有任何提示说明添加成功</p><h3 id="第二步（将文件提交）"><a href="#第二步（将文件提交）" class="headerlink" title="第二步（将文件提交）"></a>第二步（将文件提交）</h3><p>用命令git commit告诉Git，把文件提交到仓库<br><img src="https://pic.downk.cc/item/5fc75027394ac523789cfd51.png?ynotemdtimestamp=1617365973827" alt="img">后面双引号内的内容为提交的注释<br>目前已经提交了一个readme.txt文件了，下面可以通过命令git.ststus来查看是否还有文件未提交，如下： <img src="https://pic.downk.cc/item/5fc75027394ac523789cfd46.png?ynotemdtimestamp=1617365973827" alt="img">说明没有任何文件未提交</p><h3 id="第三步（修改并提交修改文件）"><a href="#第三步（修改并提交修改文件）" class="headerlink" title="第三步（修改并提交修改文件）"></a>第三步（修改并提交修改文件）</h3><h4 id="1-修改文件"><a href="#1-修改文件" class="headerlink" title="1. 修改文件"></a>1. 修改文件</h4><p>现在继续修改readme.txt的内容，例如添加”This is the change I made”<br><img src="https://pic.downk.cc/item/5fc75027394ac523789cfd3b.png?ynotemdtimestamp=1617365973827" alt="img"></p><h4 id="2-查看修改"><a href="#2-查看修改" class="headerlink" title="2. 查看修改"></a>2. 查看修改</h4><p>如下，然后再用git status来查看结果。<br><img src="https://pic.downk.cc/item/5fc75026394ac523789cfd31.png?ynotemdtimestamp=1617365973827" alt="img">这里说明readme.txt已经被修改，但是还没提交。</p><h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><ul><li>对文本进行更改后，restore是回到没修改之前的版本，commit是提交还没提交过的文件。</li><li>git status能查看出文件被修改了看，但是不能查询被提交的修改。所有的版本控制系统，只能跟踪文件文本的改动，比如txt文件，程序代码等，git也不例外，版本控制系统可以告诉你每次的改动，但是图片、视频这些二进制文件，虽然可以通过版本控制系统管理，但没法跟踪文件的变化，也就是改了什么不知道。需要查询更改，可以使用以下命令：</li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">diff</span> xxx.xxx<br></code></pre></td></tr></table></figure><h4 id="3-修改后add需要被提交的部分来更新"><a href="#3-修改后add需要被提交的部分来更新" class="headerlink" title="3. 修改后add需要被提交的部分来更新"></a>3. 修改后add需要被提交的部分来更新</h4><p><img src="https://pic.downk.cc/item/5fc75026394ac523789cfd26.png?ynotemdtimestamp=1617365973827" alt="img"></p><h4 id="4-最后提交更改"><a href="#4-最后提交更改" class="headerlink" title="4. 最后提交更改"></a>4. 最后提交更改</h4><p><img src="https://pic.downk.cc/item/5fc75026394ac523789cfd1b.png?ynotemdtimestamp=1617365973827" alt="img"></p><h3 id="第四步（回退版本）"><a href="#第四步（回退版本）" class="headerlink" title="第四步（回退版本）"></a>第四步（回退版本）</h3><h4 id="1-再次进行修改"><a href="#1-再次进行修改" class="headerlink" title="1. 再次进行修改"></a>1. 再次进行修改</h4><p><img src="https://pic.downk.cc/item/5fc75026394ac523789cfd12.png?ynotemdtimestamp=1617365973827" alt="img"></p><h4 id="2-查看历史记录"><a href="#2-查看历史记录" class="headerlink" title="2. 查看历史记录"></a>2. 查看历史记录</h4><p>使用命令git log <img src="https://pic.downk.cc/item/5fc75026394ac523789cfcfa.png?ynotemdtimestamp=1617365973827" alt="img"><br>如果觉得显示的信息太多，那么可以使用命令</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git <span class="hljs-built_in">log</span> <span class="hljs-comment">--pretty=oneline</span><br></code></pre></td></tr></table></figure><h4 id="3-版本回退"><a href="#3-版本回退" class="headerlink" title="3. 版本回退"></a>3. 版本回退</h4><p>有两种命令：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard HEAD^</span><br></code></pre></td></tr></table></figure><p>若是要恢复之前几个版本，那么可以多使用几个（例如，HEAD^）</p><h5 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h5><p>回退版本之后git log也会相应减少</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard 版本号</span><br></code></pre></td></tr></table></figure><p>首先通过git reflog得到版本号<br><img src="https://pic.downk.cc/item/5fc75026394ac523789cfceb.png?ynotemdtimestamp=1617365973827" alt="img">然后通过</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard 版本号</span><br></code></pre></td></tr></table></figure><p>恢复到对应的版本</p><h2 id="3-工作区和暂存区的区别"><a href="#3-工作区和暂存区的区别" class="headerlink" title="3. 工作区和暂存区的区别"></a>3. 工作区和暂存区的区别</h2><p>工作区：电脑上看到的目录，例如目录testgit里的文件（除了隐藏的目录版本号）<br>版本库：工作区有一个隐藏目录.git，这个不属于工作区，这是版本库。其中版本库里存放了很多东西，最重要的是 <strong>stage（暂存区）</strong> ，还有Git为我们自动创建了第一个分支master，以及指向master的一个指针HEAD。</p><p>之前介绍过的，使用Git提交文件到版本库有两步，</p><ul><li>使用git add把文件添加进去，实际上就是把文件添加到暂存区</li><li>使用git commit提交更改，实际上就是把暂存区的所有内容提交到当前分支上。</li></ul><h2 id="4-删除文件"><a href="#4-删除文件" class="headerlink" title="4. 删除文件"></a>4. 删除文件</h2><p>假如现在版本库testgit目录添加一个文件b.txt，然后</p><h3 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h3><p>如下：<br><img src="https://pic.downk.cc/item/5fc75026394ac523789cfcc1.png"></p><h3 id="然后删除"><a href="#然后删除" class="headerlink" title="然后删除"></a>然后删除</h3><ul><li>方法1：直接从文件夹中删除</li><li>方法2：使用命令rm b.txt</li></ul><h3 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h3><p><img src="https://pic.downk.cc/item/5fc75026394ac523789cfcb4.png"><br>可以看到，b.txt文件已经被删除</p><h3 id="此时有两种选择"><a href="#此时有两种选择" class="headerlink" title="此时有两种选择"></a>此时有两种选择</h3><ol><li>直接commit掉<br><img src="https://pic.downk.cc/item/5fc75026394ac523789cfca7.png"></li><li>从版本库中恢复被删除的文件<br><img src="https://pic.downk.cc/item/5fc75026394ac523789cfc9e.png"></li></ol><h5 id="注意：-2"><a href="#注意：-2" class="headerlink" title="注意："></a>注意：</h5><p>当commit之后就不能恢复之前删除或者修改的文件了！</p><h1 id="github"><a href="#github" class="headerlink" title="github"></a>github</h1><h2 id="github介绍"><a href="#github介绍" class="headerlink" title="github介绍"></a>github介绍</h2><p>github是远程仓库，首先需要注册github账号：<br>CoachHe</p><h2 id="SSH设置"><a href="#SSH设置" class="headerlink" title="SSH设置"></a>SSH设置</h2><p>由于本地仓库和github仓库之间的传输是通过SSH加密的，所以需要一点设置：</p><h1 id="1-创建SSH-Key"><a href="#1-创建SSH-Key" class="headerlink" title="1. 创建SSH Key"></a>1. 创建SSH Key</h1><p>在用户主目录下，看看有没有.ssh目录，如果有，再看看有没有id_rsa和id_rsa.pub这两个文件，如果有，直接跳过此如下命令，如果没有，打开命令行输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -C &quot;youremail@example.com&quot;<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea675.png"></p><h2 id="注意：-3"><a href="#注意：-3" class="headerlink" title="注意："></a>注意：</h2><p>id_rsa是私钥，不能泄露出去，id_rsa.pub是公钥，可以放心告诉任何人。</p><h1 id="2-登录github"><a href="#2-登录github" class="headerlink" title="2. 登录github"></a>2. 登录github</h1><p>打开”settings”中的SSH Keys页面，然后点击”Add SSH Key”，填上任意title，在Key文本框中粘贴id_rsa.pub文件的内容，最后得到一个新的SSH Key<br><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea665.png">## 3 添加远程仓库</p><h2 id="目前"><a href="#目前" class="headerlink" title="目前"></a>目前</h2><p>本地已经有了个Git仓库，又想在github创建一个Git仓库，并且希望这两个仓库进行远程同步，这样github的仓库可以作为备份，又可以其他人通过该仓库来写作。</p><h2 id="在github上创建Git仓库"><a href="#在github上创建Git仓库" class="headerlink" title="在github上创建Git仓库"></a>在github上创建Git仓库</h2><p>点击create new repository，然后repository name是仓库名字，输入testgit，最后点击create repository。<br><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea65b.png"></p><h2 id="将github与本地仓库相关联"><a href="#将github与本地仓库相关联" class="headerlink" title="将github与本地仓库相关联"></a>将github与本地仓库相关联</h2><p>目前GitHub上的testgit仓库是空的，GitHub告诉我们，可以从这个仓库克隆出新的仓库，也可以把一个已有的本地仓库与之关联，然后，把本地仓库的内容推送到GitHub仓库。<br>根据 GitHub 提示，在本地的 testgit 仓库下运行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git remote add origin https://github.com/CoachHe/testgit.git<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea64d.png"></p><p>此时 github 仓库就已经和本地仓库关联了</p><h2 id="将-github-的内容推送到本地仓库"><a href="#将-github-的内容推送到本地仓库" class="headerlink" title="将 github 的内容推送到本地仓库"></a>将 github 的内容推送到本地仓库</h2><h3 id="a-将本地仓库内容推送到-GitHub-仓库"><a href="#a-将本地仓库内容推送到-GitHub-仓库" class="headerlink" title="a. 将本地仓库内容推送到 GitHub 仓库"></a>a. 将本地仓库内容推送到 GitHub 仓库</h3><p>使用git push命令，实际上是将当前分支master推到到远程。<br><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea63e.png"><br>结果如下：<br><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea633.png">  </p><h5 id="注意（-u参数）："><a href="#注意（-u参数）：" class="headerlink" title="注意（-u参数）："></a>注意（-u参数）：</h5><p>由于远程库是空的，我们第一次推送master分支时，加上了-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支与远程的master分支关联起来，在以后的推送或者拉取时就可以简化命令。推送成功后，可以立刻在github页面中看到远程库的内容已经和本地一模一样了。</p><h3 id="b-从远程GitHub仓库中克隆"><a href="#b-从远程GitHub仓库中克隆" class="headerlink" title="b. 从远程GitHub仓库中克隆"></a>b. 从远程GitHub仓库中克隆</h3><p>先有远程库的时候,如果远程库有了新内容,如何克隆到本地来呢?</p><h4 id="首先创建远程库"><a href="#首先创建远程库" class="headerlink" title="首先创建远程库"></a>首先创建远程库</h4><p><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea624.png"></p><h4 id="接着将远程库克隆到本地"><a href="#接着将远程库克隆到本地" class="headerlink" title="接着将远程库克隆到本地"></a>接着将远程库克隆到本地</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/CoachHe/</span>testgit2<br></code></pre></td></tr></table></figure><p>效果就是在本地目录中生成了testgit2目录，如下所示：<br><img src="https://pic.downk.cc/item/5fc752a0394ac523789ea607.png"></p><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>这里 testgit2 所生成的位置就是你终端所在的目录。</p><h2 id="删除远程库"><a href="#删除远程库" class="headerlink" title="删除远程库"></a>删除远程库</h2><p>如果添加的时候地址写错了，或者就是想删除远程库，可以用 <code>git remote rm &lt;name&gt;</code> 命令，建议先用 <code>git remote -v </code> 查看远程库信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@coachhe1616341555187-0 ~/company-working]# git remote -v<br>origin  git@43.154.34.118:/home/git/company-working (fetch)<br>origin  git@43.154.34.118:/home/git/company-working (push)<br></code></pre></td></tr></table></figure><p>然后根据名字删除，比如我们这里的仓库名是 origin，那就执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@coachhe1616341555187-0 ~/company-working]# git remote rm origin<br></code></pre></td></tr></table></figure><p>此处的“删除”其实是接触了本地和远程的绑定关系，并不是物理上删除了远程库。远程库本身并没有任何更改。要真正删除远程库，需要登录 github，在后台页面找到删除按钮再删除。</p><h1 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h1><h2 id="1-创建与合并分支"><a href="#1-创建与合并分支" class="headerlink" title="1. 创建与合并分支"></a>1. 创建与合并分支</h2><p>在版本回退里已经知道，每次提交，Git 都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在 Git 里，这个分支叫主分支，即 <code>master</code> 分支。<code>HEAD</code> 严格来说不是指向提交，而是指向 <code>master</code>，<code>master</code> 才是指向提交的，所以，<code>HEAD</code> 指向的就是当前分支。</p><p>一开始的时候，<code>master</code> 分支是一条线，Git 用 <code>master</code> 指向最新的提交，再用 <code>HEAD</code> 指向 <code>master</code>，就能确定当前分支，以及当前分支的提交点。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226145453.png" width = "30%" /><p>每次提交，<code>master</code> 分支都会向前移动一步，这样，随着你不断提交，<code>master</code> 分支的线越来越长。</p><p>当我们创建新的分支，例如 <code>dev</code> 时，Git 新建了一个指针叫 <code>dev</code>，指向 <code>master</code> 相同的提交，再把 <code>HEAD</code> 指向 <code>dev</code>，就表示当前分支在 <code>dev</code> 上。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226145914.png" width = "30%" /><p>可以看到，Git 创建一个分支很快，因为除了增加一个 <code>dev</code> 指针，改变 <code> Head</code> 指向，工作区的文件都没有任何变化！</p><p>不过从现在开始，对工作区的修改和提交就是针对 <code>dev</code> 分支了，比如新提交一次后，<code>dev</code> 指针往前移动一步，而 <code>master</code> 指针不变。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226151308.png" width = "30%" /><p>假如我们在 <code>dev</code> 上的工作完成了，就可以把 <code>dev</code> 合并到 <code>master</code> 上，Git 怎么合并呢？很简单的方法，就是直接把 <code>master</code> 指向 <code>dev</code> 的当前提交，就完成了合并。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226151502.png" width = "30%" /><p>所以 Git 合并分支也很快，就改改指针，工作区内容也不变！</p><p>合并完分支后，甚至可以删除 <code>dev</code> 分支。删除 <code>dev</code> 分支就是把 <code>dev</code> 指针给删掉，删掉后，我们就只剩下了一条 <code>master</code> ：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226151634.png" width = "30%" /><p>总结一下：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226151707.png"></p><h3 id="命令小结"><a href="#命令小结" class="headerlink" title="命令小结"></a>命令小结</h3><ul><li>查看分支：<code>git branch</code></li><li>创建分支：<code>git branch &lt;name&gt;</code></li><li>切换分支：<code>git checkout &lt;name&gt;</code> 或者 <code>git switch &lt;name&gt;</code></li><li>创建+切换分支：<code>git checkout -b &lt;name&gt;</code> 或者 <code>git switch -c &lt;name&gt;</code></li><li>合并某分支到当前分支：<code>git merge &lt;name&gt;</code></li><li>删除分支：<code>git branch -d &lt;name&gt;</code></li></ul><h2 id="2-冲突解决"><a href="#2-冲突解决" class="headerlink" title="2. 冲突解决"></a>2. 冲突解决</h2><p>我们来新建一个仓库 <code>learngit</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git init</span> <br>hint: Using &#x27;master&#x27; as the name for the initial branch. This default branch name<br>hint: is subject to change. To configure the initial branch name to use in all<br>hint: of your new repositories, which will suppress this warning, call:<br>hint:<br>hint: git config --global init.defaultBranch &lt;name&gt;<br>hint:<br>hint: Names commonly chosen instead of &#x27;master&#x27; are &#x27;main&#x27;, &#x27;trunk&#x27; and<br>hint: &#x27;development&#x27;. The just-created branch can be renamed via this command:<br>hint:<br>hint: git branch -m &lt;name&gt;<br>Initialized empty Git repository in /Users/heyizhi/Downloads/learngit/.git/<br></code></pre></td></tr></table></figure><p>然后创建并提交一个新文件README.txt<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226152829.png"></p><p>现在我到新建的分支 <code>feature1</code> 分支，修改 README. md 文件，然后进行提交：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226153159.png"></p><p>可以看到，将 READMD. md 文件的内容进行了更改。</p><p>此时再重新切换回 <code>master</code> 分支，然后修改并提交 README. md 文件：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226153440.png"></p><p>目前，<code>feature1</code> 分支里的 README. md 文件内容为 <code>Creating a new branch is quick and simple</code>，但是 master 分支里的 README. md 文件内容为 <code>Creating a new branch is quick &amp; simple</code>，并且他们都有各自的提交，变成了这样：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226153821.png" width = "30%" /><p>这种情况，Git 无法执行“快速合并”，只能视图把各自的修改合并起来，但是这种合并就可能会有冲突，我们试试看：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226153920.png"></p><p>果然冲突了，Git 告诉我们，<code>README.md</code> 文件存在冲突，必须手动解决冲突后再提交。</p><p>此时如果我们直接看文件内容，会是这样：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226154140.png"></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>Creating a new branch is quick &amp; simple<br>=======<br>Creating a new branch is quick and simple<br>&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature1<br></code></pre></td></tr></table></figure><p>Git 用 <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>, <code>=======</code> 和 <code>&gt;&gt;&gt;&gt;&gt;&gt;</code> 标记不同分支的内容，我们当前在 HEAD 分支下，所以我们要将文件进行修改：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226154624.png"></p><p>然后重新进行提交<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226160524.png"></p><p>可以看到，更改再重新提交之后都不需要对 feature1 进行 merge，因为此时 <code>feature1</code> 分支和 master 分支是一样的，所以是这样的：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211226160334.png" width = "30%" /><p>最后删除 <code>feature1</code> 分支，工作完成。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211226160634.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git branch -d feature1</span><br></code></pre></td></tr></table></figure><h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>如果两个不同的分支对同一个文件进行修改，但不同修改的同一行，此时是不算冲突的，可以直接合并分支。</p><h2 id="3-分支管理策略"><a href="#3-分支管理策略" class="headerlink" title="3. 分支管理策略"></a>3. 分支管理策略</h2><h3 id="–no-ff-参数"><a href="#–no-ff-参数" class="headerlink" title="–no-ff 参数"></a>–no-ff 参数</h3><p>通常，合并分支时，如果可能，Git会用<code>Fast forward</code>模式，但这种模式下，删除分支后，会丢掉分支信息。</p><p>如果要强制禁用 <code>Fast forward</code> 模式，Git 就会在 merge 时生成一个新的 commit，这样，从分支历史上就可以看出分支信息。</p><h2 id="4-多人协作"><a href="#4-多人协作" class="headerlink" title="4. 多人协作"></a>4. 多人协作</h2><h3 id="推送分支"><a href="#推送分支" class="headerlink" title="推送分支"></a>推送分支</h3><p>推送分支，就是把该分支上的所有本地提交推送到远程库。推送时，要指定本地分支，这样，Git就会把该分支推送到远程库对应的远程分支上：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin master</span><br></code></pre></td></tr></table></figure><p>如果要推送其他分支，比如<code>dev</code>，就改成：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git push origin dev</span><br></code></pre></td></tr></table></figure><p>但是，并不是一定要把本地分支往远程推送，那么，哪些分支需要推送，哪些不需要呢？</p><ul><li><code>master</code>分支是主分支，因此要时刻与远程同步；</li><li><code>dev</code> 分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步；</li><li><code>bug</code> 分支只用于在本地修复 bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个 bug；</li><li><code>feature</code> 分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发。</li></ul><h3 id="多人协作模式"><a href="#多人协作模式" class="headerlink" title="多人协作模式"></a>多人协作模式</h3><p>当你从远程仓库克隆时，实际上Git自动把本地的<code>master</code>分支和远程的<code>master</code>分支对应起来了，并且，远程仓库的默认名称是<code>origin</code>。</p><p>多人协作时，大家都会往 <code>master</code> 和 <code>dev</code> 分支上推送各自的修改。</p><p>现在，模拟一个你的小伙伴，可以在另一台电脑（注意要把 SSH Key 添加到 GitHub）或者同一台电脑的另一个目录下克隆：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">$ git clone git<span class="hljs-keyword">@github</span>. <span class="hljs-attribute">com</span>: michaelliao/learngit. git<br>Cloning into <span class="hljs-string">&#x27;learngit&#x27;</span>...<br><span class="hljs-attribute">remote</span>: Counting <span class="hljs-attribute">objects</span>: <span class="hljs-number">40</span>, done.<br><span class="hljs-attribute">remote</span>: Compressing <span class="hljs-attribute">objects</span>: <span class="hljs-number">100%</span> (<span class="hljs-number">21</span>/<span class="hljs-number">21</span>), done.<br><span class="hljs-attribute">remote</span>: Total <span class="hljs-number">40</span> (delta <span class="hljs-number">14</span>), reused <span class="hljs-number">40</span> (delta <span class="hljs-number">14</span>), pack-reused <span class="hljs-number">0</span><br>Receiving <span class="hljs-attribute">objects</span>: <span class="hljs-number">100%</span> (<span class="hljs-number">40</span>/<span class="hljs-number">40</span>), done.<br>Resolving <span class="hljs-attribute">deltas</span>: <span class="hljs-number">100%</span> (<span class="hljs-number">14</span>/<span class="hljs-number">14</span>), done.<br></code></pre></td></tr></table></figure><p>当你的小伙伴从远程库clone时，默认情况下，你的小伙伴只能看到本地的<code>master</code>分支。不信可以用<code>git branch</code>命令看看：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span> git branch<br><span class="hljs-comment">* master</span><br></code></pre></td></tr></table></figure><p>现在，你的小伙伴要在<code>dev</code>分支上开发，就必须创建远程<code>origin</code>的<code>dev</code>分支到本地，于是他用这个命令创建本地<code>dev</code>分支：</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">$ git checkout -b <span class="hljs-built_in">dev</span> origin/<span class="hljs-built_in">dev</span><br></code></pre></td></tr></table></figure><p>现在，他就可以在<code>dev</code>上继续修改，然后，时不时地把<code>dev</code>分支<code>push</code>到远程：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ git <span class="hljs-keyword">add</span> env.txt<br><br>$ git <span class="hljs-keyword">commit</span> -m &quot;add env&quot;<br>[dev <span class="hljs-number">7</span>a5e5dd] <span class="hljs-keyword">add</span> env<br> <span class="hljs-number">1</span> file changed, <span class="hljs-number">1</span> insertion(+)<br> <span class="hljs-keyword">create</span> mode <span class="hljs-number">100644</span> env.txt<br><br>$ git push origin dev<br>Counting objects: <span class="hljs-number">3</span>, done.<br>Delta compression <span class="hljs-keyword">using</span> up <span class="hljs-keyword">to</span> <span class="hljs-number">4</span> threads.<br>Compressing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">2</span>/<span class="hljs-number">2</span>), done.<br>Writing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), <span class="hljs-number">308</span> bytes | <span class="hljs-number">308.00</span> KiB/s, done.<br>Total <span class="hljs-number">3</span> (delta <span class="hljs-number">0</span>), reused <span class="hljs-number">0</span> (delta <span class="hljs-number">0</span>)<br><span class="hljs-keyword">To</span> github.com:michaelliao/learngit.git<br>   f52c633.<span class="hljs-number">.7</span>a5e5dd  dev -&gt; dev<br></code></pre></td></tr></table></figure><p>你的小伙伴已经向<code>origin/dev</code>分支推送了他的提交，而碰巧你也对同样的文件作了修改，并试图推送：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ cat env.txt<br>env<br><br>$ git <span class="hljs-keyword">add</span> env.txt<br><br>$ git <span class="hljs-keyword">commit</span> -m &quot;add new env&quot;<br>[dev <span class="hljs-number">7</span>bd91f1] <span class="hljs-keyword">add</span> <span class="hljs-built_in">new</span> env<br> <span class="hljs-number">1</span> file changed, <span class="hljs-number">1</span> insertion(+)<br> <span class="hljs-keyword">create</span> mode <span class="hljs-number">100644</span> env.txt<br><br>$ git push origin dev<br><span class="hljs-keyword">To</span> github.com:michaelliao/learngit.git<br> ! [rejected]        dev -&gt; dev (non-fast-forward)<br>error: failed <span class="hljs-keyword">to</span> push <span class="hljs-keyword">some</span> refs <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;git@github.com:michaelliao/learngit.git&#x27;</span><br>hint: Updates were rejected because the tip <span class="hljs-keyword">of</span> your <span class="hljs-keyword">current</span> branch <span class="hljs-keyword">is</span> behind<br>hint: its remote counterpart. Integrate the remote changes (e.g.<br>hint: <span class="hljs-string">&#x27;git pull ...&#x27;</span>) <span class="hljs-keyword">before</span> pushing again.<br>hint: See the <span class="hljs-string">&#x27;Note about fast-forwards&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;git push --help&#x27;</span> <span class="hljs-keyword">for</span> details.<br></code></pre></td></tr></table></figure><p>推送失败，因为你的小伙伴的最新提交和你试图推送的提交有冲突，解决办法也很简单，Git已经提示我们，先用<code>git pull</code>把最新的提交从<code>origin/dev</code>抓下来，然后，在本地合并，解决冲突，再推送：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim">$ git pull<br>There <span class="hljs-keyword">is</span> <span class="hljs-keyword">no</span> tracking information <span class="hljs-keyword">for</span> the current branch.<br>Please specify which branch you want <span class="hljs-keyword">to</span> merge with.<br>See git-pull(<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> details.<br><br>    git pull <span class="hljs-symbol">&lt;remote&gt;</span> <span class="hljs-symbol">&lt;branch&gt;</span><br><br>If you wish <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> tracking information <span class="hljs-keyword">for</span> this branch you can <span class="hljs-keyword">do</span> <span class="hljs-keyword">so</span> with:<br><br>    git branch --<span class="hljs-keyword">set</span>-upstream-<span class="hljs-keyword">to</span>=origin/<span class="hljs-symbol">&lt;branch&gt;</span> dev<br></code></pre></td></tr></table></figure><p><code>git pull</code>也失败了，原因是没有指定本地<code>dev</code>分支与远程<code>origin/dev</code>分支的链接，根据提示，设置<code>dev</code>和<code>origin/dev</code>的链接：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ git branch <span class="hljs-attribute">--set-upstream-to</span>=origin/dev dev<br>Branch <span class="hljs-string">&#x27;dev&#x27;</span> <span class="hljs-built_in">set</span> up <span class="hljs-keyword">to</span> track remote branch <span class="hljs-string">&#x27;dev&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;origin&#x27;</span>.<br></code></pre></td></tr></table></figure><p>再pull：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ git pull<br>Auto-merging env.txt<br><span class="hljs-keyword">CONFLICT</span> (<span class="hljs-keyword">add</span>/<span class="hljs-keyword">add</span>): Merge <span class="hljs-keyword">conflict</span> <span class="hljs-keyword">in</span> env.txt<br>Automatic merge failed; fix conflicts <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">commit</span> the result.<br></code></pre></td></tr></table></figure><p>这回<code>git pull</code>成功，但是合并有冲突，需要手动解决，解决的方法和分支管理中的<a href="http://www.liaoxuefeng.com/wiki/896043488029600/900004111093344">解决冲突</a>完全一样。解决后，提交，再push：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ git <span class="hljs-keyword">commit</span> -m &quot;fix env conflict&quot;<br>[dev <span class="hljs-number">57</span>c53ab] fix env <span class="hljs-keyword">conflict</span><br><br>$ git push origin dev<br>Counting objects: <span class="hljs-number">6</span>, done.<br>Delta compression <span class="hljs-keyword">using</span> up <span class="hljs-keyword">to</span> <span class="hljs-number">4</span> threads.<br>Compressing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">4</span>/<span class="hljs-number">4</span>), done.<br>Writing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">6</span>/<span class="hljs-number">6</span>), <span class="hljs-number">621</span> bytes | <span class="hljs-number">621.00</span> KiB/s, done.<br>Total <span class="hljs-number">6</span> (delta <span class="hljs-number">0</span>), reused <span class="hljs-number">0</span> (delta <span class="hljs-number">0</span>)<br><span class="hljs-keyword">To</span> github.com:michaelliao/learngit.git<br>   <span class="hljs-number">7</span>a5e5dd.<span class="hljs-number">.57</span>c53ab  dev -&gt; dev<br></code></pre></td></tr></table></figure><p>因此，多人协作的工作模式通常是这样：</p><ol><li>首先，可以试图用<code>git push origin &lt;branch-name&gt;</code>推送自己的修改；</li><li>如果推送失败，则因为远程分支比你的本地更新，需要先用 <code>git pull</code> 试图合并；</li><li>如果合并有冲突，则解决冲突，并在本地提交；</li><li>没有冲突或者解决掉冲突后，再用 <code>git push origin &lt;branch-name&gt;</code> 推送就能成功！</li></ol><p>如果<code>git pull</code>提示<code>no tracking information</code>，则说明本地分支和远程分支的链接关系没有创建，用命令<code>git branch --set-upstream-to &lt;branch-name&gt; origin/&lt;branch-name&gt;</code>。</p><p>这就是多人协作的工作模式，一旦熟悉了，就非常简单。</p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
      <category>Git</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/4a7c157115d9.html"/>
    <url>/2022/12/4a7c157115d9.html</url>
    
    <content type="html"><![CDATA[<h1 id="Docker学习过程"><a href="#Docker学习过程" class="headerlink" title="Docker学习过程"></a>Docker学习过程</h1><ul><li>Docker概述</li><li>Docker安装</li><li>Docker命令<ul><li>镜像命令</li><li>容器命令</li><li>操作命令</li><li>…</li></ul></li><li>Docker镜像！</li><li>容器数据卷！</li><li>DockerFile</li><li>Docker网络原理</li><li>IDEA整合Docker</li><li>Docker Compose</li><li>Docker Swarm</li><li>CI\CD Jenkins</li></ul><h1 id="为什么要有Docker"><a href="#为什么要有Docker" class="headerlink" title="为什么要有Docker"></a>为什么要有Docker</h1><p>java – apk – 发布（应用商店） – 张三使用apk – 安装即可用！</p><p>java – jar（环境） – 打包项目带上环境（镜像） – Docker仓库（商店） – 下载我们发布的镜像– 直接运行即可！</p><blockquote><p>之前的虚拟机技术</p></blockquote><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323004748.png"></p><p>可以看到，在一个内核Kernel上所有APP共用同一个Lib，导致Lib很大很繁杂，并且不同APP如果需要不同的环境则很麻烦。</p><p>此外，如果我需要部署集群，则需要完整的一套Kernel+Lib，以及非常多的APP，这会导致极大的资源浪费。</p><blockquote><p>容器化技术</p></blockquote><p>容器化技术不是模拟一个完整的操作系统</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323004650.png"></p><p>可以看到每个APP都有单独的Lib，这个Lib可以很独立很小，并且共用一个Kernel。</p><p>部署集群时可以不用重新搭建一套Kernel+Lib+App</p><h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="Docker基本组成"><a href="#Docker基本组成" class="headerlink" title="Docker基本组成"></a>Docker基本组成</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323005140.png"></p><blockquote><p>镜像（image）</p></blockquote><p>镜像就好比是一个模板，可以通过这个模板来创建容器服务。</p><p>通过这个镜像可以创建多个容器（最终运行或者项目运行都是在容器上）</p><blockquote><p>容器（container）</p></blockquote><p>Docker利用容器技术，独立运行一个或者一组运用，是通过镜像来创建的。</p><p>有启动，停止，删除等Linux基本指令</p><p>目前就可以把这个容器理解为一个简易的Linux系统</p><blockquote><p>仓库</p></blockquote><p>仓库就是存放镜像的地方</p><h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323005451.png"></p><h2 id="回顾HelloWorld流程"><a href="#回顾HelloWorld流程" class="headerlink" title="回顾HelloWorld流程"></a>回顾HelloWorld流程</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323005607.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323005908.png"></p><h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><h3 id="Docker是怎么工作的？"><a href="#Docker是怎么工作的？" class="headerlink" title="Docker是怎么工作的？"></a>Docker是怎么工作的？</h3><p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上，通过Socket从客户端访问！</p><p>DockerServer接收到Docker-Client的指令，就会执行这个命令！</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323010524.png"></p><h3 id="Docker为什么比VM快？"><a href="#Docker为什么比VM快？" class="headerlink" title="Docker为什么比VM快？"></a>Docker为什么比VM快？</h3><ol><li>Docker有着比虚拟机<strong>更少的抽象层</strong></li><li>Docker利用的是宿主机的内核，VM需要的是Guest OS</li></ol><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323010808.png"></p><p>所以说，新建一个容器的时候，docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载Guset OS , 分钟级别的，而docker是利用宿主机的操作系统，省略了这个复杂的过程，秒级。</p><h1 id="Docker的常用命令"><a href="#Docker的常用命令" class="headerlink" title="Docker的常用命令"></a>Docker的常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker version <span class="hljs-comment"># 显示docker的版本信息</span><br>docker info<span class="hljs-comment"># 显示docker的系统信息，包括镜像和容器的数量</span><br>docker 命令 --help <span class="hljs-comment"># 万能命令</span><br></code></pre></td></tr></table></figure><h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><h3 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a><strong>docker images</strong></h3><p>查看本地主机上的所有镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~]# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>hello-world         latest              bf756fb1ae65        14 months ago       13.3kB<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">解释</span><br>REPOSITORY 镜像的仓库源<br>TAG 镜像标签<br>IMAGE ID 镜像的id<br>CREATED 创建时间<br>SIZE 镜像大小<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">可选项</span><br>-a， --all# 列出所有镜像<br>-q， --quiet # 只显示镜像的id<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323235145.png"></p><h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a><strong>docker search</strong></h3><p>搜索镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~]# docker search mysql<br>NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED<br>mysql                             MySQL is a widely used, open-source relation…   10647               [OK]                <br>mariadb                           MariaDB Server is a high performing open sou…   3995                [OK]                <br>mysql/mysql-server                Optimized MySQL Server Docker images. Create…   779                                     [OK]<br>percona                           Percona Server is a fork of the MySQL relati…   528                 [OK]  <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">可选项</span><br>--filter=STARS=3000  # 搜索出来的镜像就是STARS&gt;3000的镜像<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210323235620.png"></p><h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a><strong>docker pull</strong></h3><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~]# docker pull mysql<br>Using default tag: latest## 如果不写tag，那就默认latest<br>latest: Pulling from library/mysql<br>a076a628af6f: Pull complete ## 分层下载，docker image的核心 联合文件系统<br>f6c208f3f991: Pull complete <br>88a9455a9165: Pull complete <br>406c9b8427c6: Pull complete <br>7c88599c0b25: Pull complete <br>25b5c6debdaf: Pull complete <br>43a5816f1617: Pull complete <br>1a8c919e89bf: Pull complete <br>9f3cf4bd1a07: Pull complete <br>80539cea118d: Pull complete <br>201b3cad54ce: Pull complete <br>944ba37e1c06: Pull complete <br>Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c## 签名信息<br>Status: Downloaded newer image for mysql:latest <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定版本下载</span><br>[root@VM-11-161-centos ~]# docker pull mysql:5.7<br>5.7: Pulling from library/mysql<br>a076a628af6f: Already exists ## 可以看到，和mysql共用了一个文件<br>f6c208f3f991: Already exists <br>88a9455a9165: Already exists <br>406c9b8427c6: Already exists <br>7c88599c0b25: Already exists <br>25b5c6debdaf: Already exists <br>43a5816f1617: Already exists <br>1831ac1245f4: Pull complete <br>37677b8c1f79: Pull complete <br>27e4ac3b0f6e: Pull complete <br>7227baa8c445: Pull complete <br>Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df<br>Status: Downloaded newer image for mysql:5.7<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324000100.png"></p><h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><p>docker rmi -f ID</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324000251.png"></p><h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p>说明：我们有了镜像才能创建容器，linux下载一个centos来测试学习。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull centos<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324000601.png"></p><h3 id="新建容器并启动"><a href="#新建容器并启动" class="headerlink" title="新建容器并启动"></a>新建容器并启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run [可选参数] image<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">参数说明</span><br>--name=&quot;name&quot;   容器名字 tomcat1 tomcat2用来区分容器<br>-d 后台方式运行<br>-it使用交互方式运行，进入容器查看内容<br>-p指定容器端口 -p 8080:8080<br>-p 主机端口:容器端口（常用）<br>-p 容器端口<br>容器短开口<br>-P大写的P，随机指定端口<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~]# docker run -it centos /bin/bash<br>[root@7be417555000 /]# ls#查看容器内的centos，基础版本，很多命令都是不完善的！<br>bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<br>[root@7be417555000 /]# exit# 退出容器<br>exit<br>[root@VM-11-161-centos ~]# <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324002628.png"></p><p>容器内部和外部没有任何关系！</p><h3 id="查看正在运行的容器"><a href="#查看正在运行的容器" class="headerlink" title="查看正在运行的容器"></a>查看正在运行的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324002929.png"></p><h3 id="列出历史运行过的容器"><a href="#列出历史运行过的容器" class="headerlink" title="列出历史运行过的容器"></a>列出历史运行过的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps -a<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324003025.png"></p><h3 id="只显示容器的编号"><a href="#只显示容器的编号" class="headerlink" title="只显示容器的编号"></a>只显示容器的编号</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps -q<br></code></pre></td></tr></table></figure><h3 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">exit # 直接容器停止并退出<br></code></pre></td></tr></table></figure><h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker rm ID # 删除镜像，不能删除正在运行的容器，如果需要强行删除需要参数-f<br>docker rm -f $(docker ps -aq)# 删除全部<br></code></pre></td></tr></table></figure><h3 id="启动和停止容器的操作"><a href="#启动和停止容器的操作" class="headerlink" title="启动和停止容器的操作"></a>启动和停止容器的操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker start 容器id# 启动容器<br>docker stop 容器id# 停止容器<br>docker kill 容器id# 杀死容器<br>docker restart 容器id# 重启容器<br></code></pre></td></tr></table></figure><h2 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h2><h3 id="后台启动容器"><a href="#后台启动容器" class="headerlink" title="后台启动容器"></a>后台启动容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">命令 docker run -d 镜像名！</span><br>[root@VM-11-161-centos ~]# docker run -d centos<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">问题docker ps 发现centos停止了</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">常见的坑，docker容器使用后台运行，就必须有一个前台进程，docker发现没有应用，就会自动停止</span><br></code></pre></td></tr></table></figure><h3 id="后台启动并执行程序"><a href="#后台启动并执行程序" class="headerlink" title="后台启动并执行程序"></a>后台启动并执行程序</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d centos /bin/sh -c &quot;while true;do echo coachhe;sleep 1; done&quot;<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324004406.png"></p><h3 id="查看日志命令"><a href="#查看日志命令" class="headerlink" title="查看日志命令"></a>查看日志命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker logs -f -t --tail 10 200e92dfefc1<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324005444.png"></p><h3 id="docker的top命令"><a href="#docker的top命令" class="headerlink" title="docker的top命令"></a>docker的top命令</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324005646.png"></p><h3 id="查看镜像的元数据"><a href="#查看镜像的元数据" class="headerlink" title="查看镜像的元数据"></a>查看镜像的元数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker inspect ID<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324010007.png"></p><h3 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">命令</span><br>docker exec -it 容器ID bashShell<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324010414.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">方式2</span><br>docker attach 容器ID<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324010821.png"></p><h3 id="拷贝"><a href="#拷贝" class="headerlink" title="拷贝"></a>拷贝</h3><h4 id="从容器内将文件拷贝到主机上"><a href="#从容器内将文件拷贝到主机上" class="headerlink" title="从容器内将文件拷贝到主机上"></a>从容器内将文件拷贝到主机上</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker cp 容器ID:PATH 主机PATH<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拷贝是一个手动过程，未来我们使用-v卷的技术，可以实现主机和容器的文件的自动同步</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210324011420.png"></p><h4 id="将主机上的文件拷贝进容器内"><a href="#将主机上的文件拷贝进容器内" class="headerlink" title="将主机上的文件拷贝进容器内"></a>将主机上的文件拷贝进容器内</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker cp 文件目录 容器ID:PATH<br></code></pre></td></tr></table></figure><h1 id="作业1-安装Nginx"><a href="#作业1-安装Nginx" class="headerlink" title="作业1 安装Nginx"></a>作业1 安装Nginx</h1><blockquote><p>Docker安装Nginx</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. 搜索镜像 search<br>2. 下载镜像 pull<br>3. 运行测试<br></code></pre></td></tr></table></figure><p>​        <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325002719.png"></p><h3 id="端口原理："><a href="#端口原理：" class="headerlink" title="端口原理："></a>端口原理：</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325003128.png"></p><h3 id="访问效果："><a href="#访问效果：" class="headerlink" title="访问效果："></a>访问效果：</h3><p>通过外网地址和3344端口访问到了Nginx</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325003254.png"></p><h3 id="进入交互模式："><a href="#进入交互模式：" class="headerlink" title="进入交互模式："></a>进入交互模式：</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325003431.png"></p><p>思考问题：</p><p>​我们每次改动nginx配置文件，都需要进入容器内部？非常麻烦，要是可以在容器外部提供一个映射路径，达到在容器修改文件名，容器内部就可以直接修改？</p><h1 id="作业2-使用docker装tomcat"><a href="#作业2-使用docker装tomcat" class="headerlink" title="作业2 使用docker装tomcat"></a>作业2 使用docker装tomcat</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">官方的使用</span><br>docker run -it --rm tomcat:9.0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">我们之前的启动都是后台，停止了容器之后，容器还是可以查到 docker run -it --<span class="hljs-built_in">rm</span> 一般用来测试，用完即删除</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325004100.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325004118.png"></p><h2 id="docker下载tomcat"><a href="#docker下载tomcat" class="headerlink" title="docker下载tomcat"></a>docker下载tomcat</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325004218.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325004254.png"></p><h3 id="访问效果"><a href="#访问效果" class="headerlink" title="访问效果"></a>访问效果</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325004348.png"></p><p>不能访问的原因是因为这里的tomcat是一个阉割版。阿里云镜像默认是最小的镜像，所有不必要的都剔除掉，保证最小的可运行环境。</p><p>此时我们将webapps.dist里面的文件全部拷贝进入webapps</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325005157.png"></p><p>可以看到最终的效果</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325005128.png"></p><h1 id="作业3：部署es-kibana"><a href="#作业3：部署es-kibana" class="headerlink" title="作业3：部署es+kibana"></a>作业3：部署es+kibana</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">es 暴露的端口很多</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">es 十分耗内存</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">es 的数据一般需要放置到安全目录</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">--net somenetwork ？ 网络配置</span><br>docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:tag<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325010624.png"></p><h3 id="内存占用情况"><a href="#内存占用情况" class="headerlink" title="内存占用情况"></a>内存占用情况</h3><p>命令 docker stats</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325010842.png"></p><h1 id="Docker镜像讲解"><a href="#Docker镜像讲解" class="headerlink" title="Docker镜像讲解"></a>Docker镜像讲解</h1><h2 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h2><h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><blockquote><p>UnionFs（联合文件系统）</p></blockquote><p>Union文件系统（UnionFs）是一种分层、轻量级并且高性能的文件系统，他支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（ unite several directories into a single virtual filesystem)。Union文件系统是 Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像<br>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p><p><img src="http://km.oa.com/files/photos/pictures/202010/1602687339_62_w754_h193.png"></p><p>如上图，从右侧以UFS的视角来看，lowerdir和upperdir是两个不同的目录，UFS将二者合并起来，得到merged层展示给调用方。从左侧的docker角度来理解，lowerdir就是镜像，upperdir就相当于是容器默认的可写层。在运行的容器中修改了文件，可以使用docker commit指令保存成为一个新镜像。</p><blockquote><p>Docker镜像加载原理 </p></blockquote><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。<br>boots(boot file system）主要包含 bootloader和 Kernel, bootloader主要是引导加 kernel, Linux刚启动时会加载bootfs文件系统，在 Docker镜像的最底层是 bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs转交给内核，此时系统也会卸载bootfs。<br>rootfs（root file system),在 bootfs之上。包含的就是典型 Linux系统中的&#x2F;dev,&#x2F;proc,&#x2F;bin,&#x2F;etc等标准目录和文件。 rootfs就是各种不同的操作系统发行版，比如 Ubuntu, Centos等等。</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210325012052.png"></p><p>对于一个精简的OS,rootfs可以很小，只需要包合最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。</p><p>由此可见对于不同的Linux发行版， boots基本是一致的， rootfs会有差別，因此不同的发行版可以公用bootfs.</p><p><strong>虚拟机是分钟级别，容器是秒级！</strong></p><h3 id="封层理解"><a href="#封层理解" class="headerlink" title="封层理解"></a>封层理解</h3><blockquote><p>分层的镜像</p></blockquote><p>我们可以去下载一个镜像，注意观察下载的日志输出，可以看到是一层层的在下载</p><p>![image-20210325145200076](&#x2F;Users&#x2F;coachhe&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210325145200076.png)</p><p><strong>思考：</strong></p><p>为什么Docker镜像要采用这种分层的结构呢？</p><p>最大的好处，我觉得莫过于<strong>资源共享</strong>了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p><p>查看镜像分层的方式可以通过</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker image inspect name<br></code></pre></td></tr></table></figure><p>命令</p><p><strong>理解：</strong></p><p> 所有的 Docker镜像都起始于一个基础镜像层，当进行修改或培加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p><p>举一个简单的例子，假如基于 Ubuntu Linux16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加 Python包，<br>就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创健第三个镜像层该像当前已经包含3个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。<br><img src="https://img-blog.csdnimg.cn/2020090520471054.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RERERlbmdf,size_16,color_FFFFFF,t_70#pic_center"></p><p> 在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像包含了来自两个镜像层的6个文件。</p><p><img src="https://img-blog.csdnimg.cn/20200905204721901.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RERERlbmdf,size_16,color_FFFFFF,t_70#pic_center"></p><p>上图中的镜像层跟之前图中的略有区別，主要目的是便于展示文件<br>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版</p><p><img src="https://img-blog.csdnimg.cn/20200905204732895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RERERlbmdf,size_16,color_FFFFFF,t_70#pic_center"></p><p> 这种情況下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</p><p>Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统</p><p>Linux上可用的存储引撃有AUFS、 Overlay2、 Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于 Linux中对应的件系统或者块设备技术，井且每种存储引擎都有其独有的性能特点。</p><p>Docker在 Windows上仅支持 windowsfilter 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW [1]。</p><p>下图展示了与系统显示相同的三层镜像。所有镜像层堆并合井，对外提供统一的视图</p><p><img src="https://img-blog.csdnimg.cn/20200905204745980.png#pic_center"></p><blockquote><p>特点</p></blockquote><p>Docker镜像都是只读的，当容器启动时，一个新的可写层加载到镜像的顶部！</p><p>这一层就是我们通常说的<strong>容器层</strong>，容器层之下都叫镜像层！</p><h1 id="commit-镜像"><a href="#commit-镜像" class="headerlink" title="commit 镜像"></a>commit 镜像</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker commit 提交容器成为一个新的副本<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">命令和git原理类似</span><br>docker commit -m=&quot;描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]<br></code></pre></td></tr></table></figure><h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">1、启动一个默认的tomcat</span><br>docker run -d -p 8080:8080 tomcat<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2、发现这个默认的tomcat 是没有webapps应用，官方的镜像默认webapps下面是没有文件的！</span><br>docker exec -it 容器id<br><span class="hljs-meta prompt_"># </span><span class="language-bash">3、拷贝文件进去</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">4、将操作过的容器通过commit调教为一个镜像！我们以后就使用我们修改过的镜像即可，这就是我们自己的一个修改的镜像。</span><br>docker commit -m=&quot;描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]<br>docker commit -a=&quot;kuangshen&quot; -m=&quot;add webapps app&quot; 容器id tomcat02:1.0<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210419092617.png"></p><h1 id="docker-启动命令"><a href="#docker-启动命令" class="headerlink" title="docker 启动命令"></a>docker 启动命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name tlinux --hostname tlinux -p 60001-60500:1-500 -p 60501:36000 -p 60502:8080 -p 60503-61000:10503-11000 --mount type=bind,source=/dockerVolume/,target=/root csighub.tencentyun.com/official/tlinux-2.2-base /bin/bash<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>Docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7078e64ff5ac.html"/>
    <url>/2022/12/7078e64ff5ac.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、Scala-简介"><a href="#一、Scala-简介" class="headerlink" title="一、Scala 简介"></a>一、Scala 简介</h1><p>Spark1.6 使用的是 Scala2.10，Spark2.0 版本以上使用的是 Scala2.11</p><h2 id="Scala-6-大特性"><a href="#Scala-6-大特性" class="headerlink" title="Scala 6 大特性"></a>Scala 6 大特性</h2><ul><li>Java 和 scala 可以混编<br> 可以在 Java 中调用 Scala 的包和类，也可以在 Scala 中调用 Java 的包和类</li><li>类型推测 (自动推测类型)<br> 不需要指定 int 或 double 等，会自动进行类型的推断。<br> <strong>注意：</strong><br> Scala 不是一种弱语言类型，只是类型会自动进行推断。</li><li>并发和分布式（Actor）<br> 在 Scala 编程中不需要考虑锁。</li><li>特质，特征 (类似 java 中 interfaces 和 abstract 结合)<br>  trait（特质）类似 interfaces 和 abstract 进行整合。</li><li>模式匹配（类似 java switch）<br> java 中的 switch 中只能匹配值，例如 1，2 等，或者’a’，’b’，而不能匹配 String，例如”aba”是不能放在 switch 中的 case 中的，而 Scala 可以。</li><li><strong>高阶函数</strong><br> <strong>至关重要</strong>，在方法中传递方法。</li></ul><h2 id="Scala-安装使用（MAC-版）"><a href="#Scala-安装使用（MAC-版）" class="headerlink" title="Scala 安装使用（MAC 版）"></a>Scala 安装使用（MAC 版）</h2><ol><li><p>下载 scala 安装包</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201215144723.png"></p></li><li><p>将解压之后的文件移动到&#x2F;usr&#x2F;local&#x2F;share 中</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201215145005.png" style="zoom:50%;" /></li><li><p>将 Scala 的 bin 目录加到~&#x2F;. bash_profile 的最后一行<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201215145512.png"></p></li><li><p>别忘了 source 一下</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201215150943.png" style="zoom:50%;" /></li><li><p>最后运行一下 scala，证明已经成功安装。<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201215151450.png"></p><p>注意：<br>最好还是在 linux 上安装和运行 scala，自己的 mac 也太折腾了…</p></li></ol><h2 id="IDE-和插件"><a href="#IDE-和插件" class="headerlink" title="IDE 和插件"></a>IDE 和插件</h2><p>IDE 选择 IDEA。<br>插件选择 Scala。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201215151644.png" style="zoom:50%;" /><h1 id="二、Scala-基础"><a href="#二、Scala-基础" class="headerlink" title="二、Scala 基础"></a>二、Scala 基础</h1><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><table><thead><tr><th><strong>数据类型</strong></th><th align="left"><strong>描述</strong></th></tr></thead><tbody><tr><td>Byte</td><td align="left">8位有符号补码整数。数值区间为 -128 到 127</td></tr><tr><td>Short</td><td align="left">16位有符号补码整数。数值区间为 -32768 到 32767</td></tr><tr><td>Int</td><td align="left">32位有符号补码整数。数值区间为 -2147483648 到 2147483647</td></tr><tr><td>Long</td><td align="left">64位有符号补码整数。数值区间为 -9223372036854775808 到 9223372036854775807</td></tr><tr><td>Float</td><td align="left">32 位, IEEE 754 标准的单精度浮点数</td></tr><tr><td>Double</td><td align="left">64 位 IEEE 754 标准的双精度浮点数</td></tr><tr><td>Char</td><td align="left">16位无符号Unicode字符, 区间值为 U+0000 到 U+FFFF</td></tr><tr><td>String</td><td align="left">字符序列</td></tr><tr><td>Boolean</td><td align="left">true或false</td></tr><tr><td>Unit</td><td align="left">表示无值，和其他语言中void等同。用作不返回任何结果的方法的结果类型。Unit只有一个实例值，写成()。</td></tr><tr><td>Null</td><td align="left">null 或空引用</td></tr><tr><td>Nothing</td><td align="left">Nothing类型在Scala的类层级的最底端；它是任何其他类型的子类型。</td></tr><tr><td>Any</td><td align="left">Any是所有其他类的超类</td></tr><tr><td>AnyRef</td><td align="left">AnyRef类是Scala里所有引用类(reference class)的基类</td></tr></tbody></table><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul><li>Byte，Short，Int，Long，Float，Double，Char，String 和 Boolean 和 Java 都一样，只是首字母大写了。</li><li>Unit &#x3D; void</li><li>Null &#x3D; null</li><li>Nothing 是所有类型的子类型，处于 Scala 的类层级的最低端。<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201216192436.png" style="zoom:50%;" /></li><li>Any 是所有类型的超类，任何实例都属于 Any 类型，类似 Java 中的 Object</li><li>AnyRef 是所有引用类型的超类</li><li>AnyVal 是所有值类型的超类，例如 Int 类</li></ul><h3 id="几个容易混淆的概念"><a href="#几个容易混淆的概念" class="headerlink" title="几个容易混淆的概念"></a>几个容易混淆的概念</h3><table><thead><tr><th align="left">类型</th><th>介绍</th></tr></thead><tbody><tr><td align="left">Null</td><td>Trait，其唯一实例是 null，是 AnyRef 的子类，不是 AnyVal 的子类</td></tr><tr><td align="left">Nothing</td><td>Trait，所有类型的子类，没有实例</td></tr><tr><td align="left">Unit</td><td>无返回值的函数类型，也就是 void</td></tr><tr><td align="left">Nil</td><td>长度为 0 的 List</td></tr><tr><td align="left"><strong>None</strong></td><td><strong>Option 的两个子类之一，另一个是 Some，用于安全的函数返回值</strong></td></tr></tbody></table><p>None 相当于 Java 中的 Map get 一个值但是不存在时的返回值。</p><h2 id="Scala-使用"><a href="#Scala-使用" class="headerlink" title="Scala 使用"></a>Scala 使用</h2><h3 id="1-新建一个项目"><a href="#1-新建一个项目" class="headerlink" title="1 新建一个项目"></a>1 新建一个项目</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201216173041.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201216173655.png"></p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201216174029.png"></p><h2 id="Scala-类和对象"><a href="#Scala-类和对象" class="headerlink" title="Scala 类和对象"></a>Scala 类和对象</h2><ul><li>Scala object 相当于 Java 中的单例，object 中定义的全是静态的</li><li>Scala 中定义变量使用 var，定义常量使用 val，变量可变常量不可变，变量和常量类型可以省略，会自动推断</li><li>Scala 中每行后面都会有分号自动推断机制，不用显式写出”;”</li><li>建议在 Scala 中命名使用驼峰命名法</li><li>Scala 类中可以传参，传参一定要指定类型，有了参数就有了默认构造，但是 object 不能传参，若需要传参则需要定义 apply 方法</li><li>类中重写构造，构造第一行必须先调用默认的构造</li><li>Scala 中当 new class 时，类中除了方法不执行（除了构造方法），其他的都执行</li><li>Object 一定会被加载，而 class 只有 new 了之后才会被加载</li><li>在同一个文件中 Object 和 class 的名称可以一样，一样时 class 叫做 object 的伴生类，object 叫做 class 的伴生对象，可以互相访问私有变量</li></ul><h2 id="解释代码"><a href="#解释代码" class="headerlink" title="解释代码"></a>解释代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br>object ClassAndObject &#123;<br>  <span class="hljs-type">val</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span><br>  println(price)<br><br>  <span class="hljs-comment">//若object需要传参则需要定义这个方法</span><br>  def <span class="hljs-title function_">apply</span><span class="hljs-params">(i:Int)</span>=&#123;<br>    println(<span class="hljs-string">&quot;Score is&quot;</span> + i)<br>  &#125;<br><br>  def <span class="hljs-title function_">main</span><span class="hljs-params">(args: Array[String])</span>: Unit = &#123;<br>    <span class="hljs-type">val</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;coachhe&quot;</span><br>    println(name)<br>    <span class="hljs-type">val</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;F&#x27;</span>)<br>    println(p.age)<br>    println(p.name)<br>    println(p.gender)<br><br>  &#125;<br><br>&#125;<br><br><span class="hljs-comment">// Java的类没有括号，不能传参，Scala可以</span><br><span class="hljs-comment">// 传递的参数xname和sage是Person私有的东西，不可见</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(xname :String, xage :Int)&#123;<br>  <span class="hljs-type">val</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> xname<br>  <span class="hljs-type">val</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> xage<br>  <span class="hljs-type">var</span> <span class="hljs-variable">gender</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;M&#x27;</span><br><br>  def <span class="hljs-title function_">sayName</span><span class="hljs-params">()</span>=&#123;<br>    println(<span class="hljs-string">&quot;Hello World_&quot;</span> + ClassAndObject.price)<br>  &#125;<br><br>  def <span class="hljs-title function_">this</span><span class="hljs-params">(yname :String, yage :Int, ygender: Char)</span>&#123;<br>    <span class="hljs-built_in">this</span>(yname, yage)<br>    <span class="hljs-built_in">this</span>.gender = gender<br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="if-else-语句"><a href="#if-else-语句" class="headerlink" title="if else 语句"></a>if else 语句</h2><p>和Java 一模一样。</p><h2 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h2><ul><li>1 to 10 就是 Range (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)</li><li>1 until 10 就是 Range (1, 2, 3, 4, 5, 6, 7, 8, 9)</li><li>1 to (10, 2) 就是 Range (1, 3, 5, 7, 9)</li></ul><h2 id="while-语法"><a href="#while-语法" class="headerlink" title="while 语法"></a>while 语法</h2><p>和 java 完全相同</p><h2 id="具体应用"><a href="#具体应用" class="headerlink" title="具体应用"></a>具体应用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><br>object Grammer &#123;<br>  def <span class="hljs-title function_">main</span> <span class="hljs-params">(args: Array[String])</span>: Unit = &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * if else</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">val</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br>    <span class="hljs-keyword">if</span> (age &lt; <span class="hljs-number">20</span>) &#123;<br>      println (<span class="hljs-string">&quot;age &lt; 20&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (age == <span class="hljs-number">20</span> )&#123;<br>      println (<span class="hljs-string">&quot;age = 20&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      println (<span class="hljs-string">&quot;age &gt; 20&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * for循环</span><br><span class="hljs-comment">     * 注意：在这里</span><br><span class="hljs-comment">     * 1 to 10 就是Range(1,2,3,4,5,6,7,8,9,10)</span><br><span class="hljs-comment">     * 1 until 10 就是Range(1,2,3,4,5,6,7,8,9)</span><br><span class="hljs-comment">     * 1 to (10,2) 就是Range(1,3,5,7,9)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">for</span> (i &lt;- <span class="hljs-number">1</span> to <span class="hljs-number">10</span>) &#123;<br>      print(i + <span class="hljs-string">&quot; &quot;</span>)<br>    &#125;<br>    println()<br>    <span class="hljs-keyword">for</span> (i &lt;- <span class="hljs-number">1</span> to (<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)) &#123;<br>      print(i + <span class="hljs-string">&quot; &quot;</span>)<br>    &#125;<br>    println()<br>    <span class="hljs-keyword">for</span> (i &lt;- <span class="hljs-number">1</span> to <span class="hljs-number">3</span>; j &lt;- <span class="hljs-number">1</span> to <span class="hljs-number">3</span>) &#123;<br>      <span class="hljs-comment">//在字符串之前加上s可以不用进行拼接</span><br>      println(s<span class="hljs-string">&quot;i =  $i  j = $j&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * while语法</span><br><span class="hljs-comment">     * 和java完全相同</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">var</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">3</span>) &#123;<br>      println(s<span class="hljs-string">&quot;hello $i&quot;</span>)<br>      i += <span class="hljs-number">1</span><br>    &#125;<br><br><br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20201216191447.png" style="zoom:50%;" /><h1 id="三、Scala方法与函数"><a href="#三、Scala方法与函数" class="headerlink" title="三、Scala方法与函数"></a>三、Scala方法与函数</h1><h2 id="方法定义"><a href="#方法定义" class="headerlink" title="方法定义"></a>方法定义</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210112204951.png" style="zoom:33%;" /><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul><li>方法体中最后返回值可以使用 return，如果使用 return，那么方法体的返回值类型一定要指定。</li><li>方法体返回值可以省略，默认将方法体中最后一行计算结果当做返回值返回</li><li>定义方法传入的参数一定要指定类型</li><li>方法体中内容如果一行可以写完，那么方法体的括号可以省略</li><li>如果定义方法时，省略了方法名称和方法体之间的”&#x3D;”，那么无论方法体最后一行计算的结果是什么，都会被丢弃，返回 Unit</li></ul><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210112205018.png" style="zoom:33%;" /><h3 id="输出-1"><a href="#输出-1" class="headerlink" title="输出"></a>输出</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210112205056.png" style="zoom:50%;" /><h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210108185937.png" style="zoom:33%;" /><h2 id="递归方法"><a href="#递归方法" class="headerlink" title="递归方法"></a>递归方法</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210108194250.png" style="zoom:33%;" /><h3 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h3><p>递归时需要显式指定返回类型。</p><h2 id="参数有默认值的方法"><a href="#参数有默认值的方法" class="headerlink" title="参数有默认值的方法"></a>参数有默认值的方法</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210108205604.png" style="zoom:33%;" /><h2 id="可变长参数的方法"><a href="#可变长参数的方法" class="headerlink" title="可变长参数的方法"></a>可变长参数的方法</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210108210353.png" style="zoom:33%;" /><h2 id="匿名函数（匿名方法）"><a href="#匿名函数（匿名方法）" class="headerlink" title="匿名函数（匿名方法）"></a>匿名函数（匿名方法）</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210108213019.png" style="zoom:33%;" /><h2 id="嵌套方法"><a href="#嵌套方法" class="headerlink" title="嵌套方法"></a>嵌套方法</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210108213236.png" style="zoom: 33%;" /><h2 id="偏应用函数"><a href="#偏应用函数" class="headerlink" title="偏应用函数"></a>偏应用函数</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210110165346.png" style="zoom:33%;" /><h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210110170624.png" style="zoom:33%;" /><h3 id="1-方法的参数是函数"><a href="#1-方法的参数是函数" class="headerlink" title="1. 方法的参数是函数"></a>1. 方法的参数是函数</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210110203813.png" style="zoom:33%;" /><h3 id="2-方法的返回是函数"><a href="#2-方法的返回是函数" class="headerlink" title="2. 方法的返回是函数"></a>2. 方法的返回是函数</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210110204934.png" style="zoom:33%;" /><h4 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210110205039.png" style="zoom:33%;" /><h3 id="3-方法的参数和返回值都是函数"><a href="#3-方法的参数和返回值都是函数" class="headerlink" title="3. 方法的参数和返回值都是函数"></a>3. 方法的参数和返回值都是函数</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210112201902.png" style="zoom:33%;" /><h2 id="柯里化函数（高阶函数）"><a href="#柯里化函数（高阶函数）" class="headerlink" title="柯里化函数（高阶函数）"></a>柯里化函数（高阶函数）</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210112202913.png" style="zoom:33%;" /><h1 id="4、Scala-collection"><a href="#4、Scala-collection" class="headerlink" title="4、Scala collection"></a>4、Scala collection</h1><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>字符串采用的就是 <code>java.lang.String</code>, 用法和 java 基本相同</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">StringAndArray</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 字符串</span><br><span class="hljs-comment">     * 采用的就是java.lang.String</span><br><span class="hljs-comment">     * 用法和java基本相同</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">val</span> s = <span class="hljs-string">&quot;Hello&quot;</span><br>    <span class="hljs-keyword">val</span> s1 = <span class="hljs-string">&quot;hello&quot;</span><br><br>    println(s)<br>    println(s1)<br>    println(s.equals(s1))<br>    println(s.equalsIgnoreCase(s1))<br>    println(s.indexOf(&#x27;<span class="hljs-type">H</span>&#x27;))<br><br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>集合分为可变集合和不可变集合</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">StringAndArray</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 集合</span><br><span class="hljs-comment">     */</span><br>      <span class="hljs-comment">//定义方法1</span><br>    <span class="hljs-keyword">val</span> arr = <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>](<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>);<br>    <span class="hljs-comment">//遍历方法1</span><br>    arr.foreach(println)<br>    <span class="hljs-comment">//遍历方法2</span><br>    <span class="hljs-keyword">for</span>(elem &lt;- arr) &#123;<br>      println(elem)<br>    &#125;<br>    <span class="hljs-comment">//定义方法2  默认的定义方式都是不可变的</span><br>    <span class="hljs-keyword">val</span> arr1 = <span class="hljs-keyword">new</span> <span class="hljs-type">Array</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">3</span>)<br>    <span class="hljs-comment">//赋值方法</span><br>    arr1(<span class="hljs-number">0</span>) = <span class="hljs-number">1</span><br>    arr1(<span class="hljs-number">1</span>) = <span class="hljs-number">1</span><br>    arr1(<span class="hljs-number">2</span>) = <span class="hljs-number">2</span><br>    <span class="hljs-comment">// 定义2维数组</span><br>    <span class="hljs-keyword">val</span> arr2 = <span class="hljs-keyword">new</span> <span class="hljs-type">Array</span>[<span class="hljs-type">Array</span>[<span class="hljs-type">Int</span>]](<span class="hljs-number">2</span>)<br>    arr2(<span class="hljs-number">0</span>) = <span class="hljs-type">Array</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<br>    arr2(<span class="hljs-number">1</span>) = <span class="hljs-type">Array</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)<br>    <span class="hljs-comment">//打印2维数组</span><br>    <span class="hljs-keyword">for</span> (arr &lt;- arr2) &#123;<br>      <span class="hljs-keyword">for</span> (elem &lt;- arr) &#123;<br>        println(elem)<br>      &#125;<br>    &#125;<br>    <span class="hljs-comment">//第2种方式打印2维数组</span><br>    <span class="hljs-keyword">for</span> (arr &lt;- arr2; elem &lt;- arr) &#123;<br>      println(elem)<br>    &#125;<br>    <span class="hljs-comment">//第3种方式打印2维数组</span><br>    arr2.foreach(arr=&gt;&#123;arr.foreach(println)&#125;)<br><br>    <span class="hljs-comment">//数组的合并</span><br>    <span class="hljs-keyword">val</span> arrays = <span class="hljs-type">Array</span>.concat(arr1, arr2)<br>    <span class="hljs-comment">//arrays.foreach(println)</span><br><br>    <span class="hljs-type">Array</span>.fill(<span class="hljs-number">5</span>)(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    <br>    <span class="hljs-comment">//可变数组</span><br>    <span class="hljs-keyword">import</span> scala.collection.mutable.<span class="hljs-type">ArrayBuffer</span><br>    <span class="hljs-keyword">val</span> arr_mut = <span class="hljs-type">ArrayBuffer</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<br>    arr_mut.+=(<span class="hljs-number">4</span>) <span class="hljs-comment">//往后追加</span><br>    arr_mut.+=:(<span class="hljs-number">100</span>)  <span class="hljs-comment">//往前追加</span><br>    arr_mut.append(<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>) <span class="hljs-comment">//往后追加</span><br><br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-keyword">import</span> scala.collection.mutable.<span class="hljs-type">ListBuffer</span><br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lesson_List</span> </span>&#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * List</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> list = <span class="hljs-type">List</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<br>    <span class="hljs-comment">//遍历的两种方法</span><br>    list.foreach(println)<br>    <span class="hljs-keyword">for</span> (elem &lt;- list) &#123;<br>      println(elem)<br>    &#125;<br>    <span class="hljs-keyword">val</span> list2 = <span class="hljs-type">List</span>[<span class="hljs-type">String</span>](<span class="hljs-string">&quot;hello scala&quot;</span>, <span class="hljs-string">&quot;hello java&quot;</span>)<br>    <span class="hljs-comment">//map和flatmap</span><br>    <span class="hljs-keyword">val</span> result: <span class="hljs-type">List</span>[<span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]] = list2.map(s =&gt; &#123;<br>      s.split(<span class="hljs-string">&quot; &quot;</span>)<br>    &#125;)<br>    result.foreach(arr =&gt; &#123;<br>      arr.foreach(println)<br>    &#125;)<br>    <span class="hljs-keyword">val</span> result2: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>] = list2.flatMap(s =&gt; &#123;<br>      s.split(<span class="hljs-string">&quot; &quot;</span>)<br>    &#125;)<br>    result2.foreach(println)<br>    <span class="hljs-comment">//filter 过滤掉不符合条件的内容</span><br>    <span class="hljs-keyword">val</span> result3: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>] = list2.filter(s =&gt; <span class="hljs-string">&quot;hello scala&quot;</span>.equals(s))<br>    result3.foreach(println)<br>    <span class="hljs-comment">//count 计算符合条件的数量</span><br>    <span class="hljs-keyword">val</span> result4: <span class="hljs-type">Int</span> = list2.count(s =&gt; &#123;<br>      s.length &lt; <span class="hljs-number">4</span><br>    &#125;)<br>    println(result4)<br><br>    <span class="hljs-comment">//可变的list</span><br>    <span class="hljs-keyword">val</span> list3 = <span class="hljs-type">ListBuffer</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    list3.append(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)<br>    list3.+=:(<span class="hljs-number">100</span>)<br>    list3.foreach(println)<br>    <br><br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="map-方法和-flatmap-方法的区别"><a href="#map-方法和-flatmap-方法的区别" class="headerlink" title="map 方法和 flatmap 方法的区别"></a>map 方法和 flatmap 方法的区别</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210113011604.png" style="zoom:50%;" /><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>用法和List很像</p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p><code>intersect</code></p><p><code>diff</code></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-keyword">import</span> scala.collection.immutable<br><span class="hljs-keyword">import</span> scala.collection.mutable<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_Set</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> set = <span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)<br>    println(<span class="hljs-string">&quot;----&quot;</span>)<br>    set.foreach(println)<br><br>    <span class="hljs-keyword">val</span> set1 = <span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)<br>    <span class="hljs-keyword">val</span> result: <span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>] = set1.intersect(set)  <span class="hljs-comment">// 合并</span><br>    <span class="hljs-keyword">val</span> result2: <span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>] = set1.diff(set)      <span class="hljs-comment">// 检查set1和set的不同之处(相当于是set1去掉set)</span><br>    <span class="hljs-keyword">val</span> result3 = set1 &amp; set1                   <span class="hljs-comment">// 交集</span><br>    println(<span class="hljs-string">&quot;----&quot;</span>)<br>    result.foreach(println)<br>    println(<span class="hljs-string">&quot;----&quot;</span>)<br>    result2.foreach(println)<br>    println(<span class="hljs-string">&quot;----&quot;</span>)<br>    result3.foreach(println)<br>    <span class="hljs-comment">// 此外，filter等方法和List一样使用</span><br><br>    <span class="hljs-comment">//可变的Set</span><br>    <span class="hljs-keyword">val</span> set2 = mutable.<span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">val</span> result4: set2.<span class="hljs-keyword">type</span> = set2.+=(<span class="hljs-number">100</span>)     <span class="hljs-comment">//此时返回的是新的集合</span><br>    println(<span class="hljs-string">&quot;----&quot;</span>)<br>    set2.foreach(println)<br>    set2.+=(<span class="hljs-number">100</span>)                              <span class="hljs-comment">//此时是往set2里新增元素</span><br>    println(<span class="hljs-string">&quot;----&quot;</span>)<br>    result4.foreach(println)<br>    <span class="hljs-comment">//重新定义一个不可变的Set</span><br>    <span class="hljs-keyword">val</span> set3 = immutable.<span class="hljs-type">Set</span>[<span class="hljs-type">String</span>](<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>)<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-keyword">import</span> scala.collection.mutable<br><span class="hljs-keyword">import</span> scala.collection.immutable<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_Map</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">//可以是&quot;a&quot; -&gt; 100，也可以是(&quot;c&quot;,300)</span><br>    <span class="hljs-keyword">val</span> map = <span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>](<span class="hljs-string">&quot;a&quot;</span> -&gt; <span class="hljs-number">100</span>, <span class="hljs-string">&quot;b&quot;</span> -&gt; <span class="hljs-number">200</span>, (<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">300</span>))<br>    map.foreach(println)<br>    <span class="hljs-keyword">val</span> result1: <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>] = map.get(<span class="hljs-string">&quot;a&quot;</span>)<br>    <span class="hljs-keyword">val</span> result2: <span class="hljs-type">Int</span> = result1.get<br>    println(result2)<br>    println(result2)<br>    <span class="hljs-comment">// getOrElse方法</span><br>    <span class="hljs-keyword">val</span> result3: <span class="hljs-type">Any</span> = map.get(<span class="hljs-string">&quot;aa&quot;</span>).getOrElse(<span class="hljs-string">&quot;no value&quot;</span>)<br>        <span class="hljs-comment">// 另一种方法</span><br>    <span class="hljs-keyword">val</span> result4: <span class="hljs-type">Any</span> = map.getOrElse(<span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-string">&quot;no value&quot;</span>)<br>    println(result3)<br>    println(result4)<br>    <span class="hljs-comment">// 获取所有的key</span><br>    <span class="hljs-keyword">val</span> keys: <span class="hljs-type">Iterable</span>[<span class="hljs-type">String</span>] = map.keys<br>    <span class="hljs-comment">// 获取所有value</span><br>      <span class="hljs-comment">// 原理是遍历所有key时去get对应map的value</span><br>    println(<span class="hljs-string">&quot;---遍历---&quot;</span>)<br>    keys.foreach(key =&gt; &#123;<br>      println(<span class="hljs-string">s&quot;key = <span class="hljs-subst">$key</span>, value = <span class="hljs-subst">$&#123;map.get(key)&#125;</span>&quot;</span>)<br>    &#125;)<br>    println(<span class="hljs-string">&quot;---遍历方法2---&quot;</span>)<br>    <span class="hljs-keyword">val</span> values: <span class="hljs-type">Iterable</span>[<span class="hljs-type">Int</span>] = map.values<br>    values.foreach(println)<br><br>    <span class="hljs-comment">// Map之间的操作</span><br>    <span class="hljs-keyword">val</span> map1 = <span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>](<span class="hljs-string">&quot;a&quot;</span> -&gt; <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span> -&gt; <span class="hljs-number">200</span>)<br>    <span class="hljs-keyword">val</span> map2 = <span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>](<span class="hljs-string">&quot;a&quot;</span> -&gt; <span class="hljs-number">100</span>, <span class="hljs-string">&quot;c&quot;</span> -&gt; <span class="hljs-number">300</span> )<br>      <span class="hljs-comment">//map的合并1</span><br>    <span class="hljs-keyword">val</span> result5: <span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>] = map1.++(map2)  <span class="hljs-comment">//map1和map2合并，并且用map2中的值替换map1的值</span><br>      <span class="hljs-comment">//map的合并2</span><br>      <span class="hljs-keyword">val</span> result6: <span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>] = map1.++:(map2)  <span class="hljs-comment">//map1和map2合并，并且用map1中的值替换map2的值</span><br>    println(<span class="hljs-string">&quot;---map1.++map2---&quot;</span>)<br>    result5.foreach(println)   <span class="hljs-comment">//此时a的value为100</span><br>    println(<span class="hljs-string">&quot;---map1.++:map2---&quot;</span>)<br>    result6.foreach(println)   <span class="hljs-comment">//此时a的value为100</span><br><br>    <span class="hljs-comment">//可变map</span><br>    <span class="hljs-keyword">val</span> map3 = mutable.<span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>]()<br>    map3.put(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">1</span>)<br>    map3.put(<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-number">2</span>)<br>    map3.put(<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">3</span>)<br>    println(<span class="hljs-string">&quot;--打印map3--&quot;</span>)<br>    map3.foreach(println)<br>    <span class="hljs-comment">// filter方法</span><br>    println(<span class="hljs-string">&quot;--filter--&quot;</span>)<br>    <span class="hljs-keyword">val</span> result7: mutable.<span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>] = map3.filter(tp =&gt; &#123;<br>      <span class="hljs-keyword">val</span> key = tp._1<br>      <span class="hljs-keyword">val</span> value = tp._2<br>      value == <span class="hljs-number">200</span><br>    &#125;)<br>    result7.foreach(println)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="元祖（Tuple）"><a href="#元祖（Tuple）" class="headerlink" title="元祖（Tuple）"></a>元祖（Tuple）</h2><ol><li>元祖可以new也可以不new</li><li>元祖最多支持22个元素</li><li>Tuple不能for和foreach</li><li>取值用”_5”</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_Tuple</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-comment">// 一堆元素放在一个括号里就是元祖</span><br>    <span class="hljs-comment">// 和列表很像，只是放入了不同类型的元素</span><br>    <span class="hljs-keyword">val</span> tuple1: <span class="hljs-type">Tuple1</span>[<span class="hljs-type">String</span>] = <span class="hljs-keyword">new</span> <span class="hljs-type">Tuple1</span>(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    <span class="hljs-keyword">val</span> tuple2: (<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>) = <span class="hljs-keyword">new</span> <span class="hljs-type">Tuple2</span>(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">100</span>)<br>    <span class="hljs-keyword">val</span> tuple3: (<span class="hljs-type">Int</span>, <span class="hljs-type">Boolean</span>, <span class="hljs-type">Char</span>) = <span class="hljs-keyword">new</span> <span class="hljs-type">Tuple3</span>(<span class="hljs-number">1</span>, <span class="hljs-literal">true</span>, &#x27;<span class="hljs-type">C</span>&#x27;)<br>      <span class="hljs-comment">//也可以不用new</span><br>    <span class="hljs-keyword">val</span> tuple4: (<span class="hljs-type">Int</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Boolean</span>) = <span class="hljs-type">Tuple4</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3.4</span>, <span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-literal">false</span>)<br>      <span class="hljs-comment">//甚至可以不用Tuple</span><br>    <span class="hljs-keyword">val</span> tuple5: (<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>) = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)<br>      <span class="hljs-comment">//Tuple最多可以写到22个，23个时已经不是元祖了</span><br>    <span class="hljs-keyword">val</span> tuple22: (<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>) = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>, <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>)<br>    <span class="hljs-comment">//数量为23时不能识别元素类型了，运行时会报错</span><br>    <span class="hljs-comment">//val tuple23 = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23)</span><br><br>    <span class="hljs-comment">// 取元素</span><br>    println(tuple1._1)<br>    println(tuple2._2)<br>    println(tuple22._21)<br>    <span class="hljs-comment">//遍历,元祖没有for和foreach</span><br>    println(<span class="hljs-string">&quot;--循环遍历1--&quot;</span>)<br>    <span class="hljs-keyword">val</span> iterator: <span class="hljs-type">Iterator</span>[<span class="hljs-type">Any</span>] = tuple5.productIterator<br>    iterator.foreach(println)<br>    println(<span class="hljs-string">&quot;--循环遍历2--&quot;</span>)<br>    <span class="hljs-keyword">val</span> iterator2: <span class="hljs-type">Iterator</span>[<span class="hljs-type">Any</span>] = tuple5.productIterator<br>    <span class="hljs-keyword">while</span> (iterator2.hasNext) &#123;<br>      println(iterator2.next())<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="五、Scala-Trait、Match-Case-Class-和偏函数"><a href="#五、Scala-Trait、Match-Case-Class-和偏函数" class="headerlink" title="五、Scala Trait、Match Case Class 和偏函数"></a>五、Scala Trait、Match Case Class 和偏函数</h1><h2 id="Trait"><a href="#Trait" class="headerlink" title="Trait"></a>Trait</h2><ol><li><p>Trait 无法传参，没有括号</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210115014248.png" style="zoom:33%;" /></li><li><p>当继承多个 Trait 时第一个关键字用 extends，后面全都是 with</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210115014225.png" style="zoom:33%;" /></li><li><p>当类继承 Trait 时需要实现没有实现的方法</p><img src="/Users/heyizhi/Library/Application Support/typora-user-images/image-20210115014602817.png" alt="image-20210115014602817" style="zoom:33%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210115014355.png" style="zoom:33%;" /></li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_Trait</span> </span>&#123;<br>  <span class="hljs-comment">// 相当于接口和抽象类的整合</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br><br>    <span class="hljs-keyword">val</span> human = <span class="hljs-keyword">new</span> <span class="hljs-type">Human</span>()<br>    human.read(<span class="hljs-string">&quot;Zhang San&quot;</span>)<br><br>    <span class="hljs-keyword">val</span> point1 = <span class="hljs-keyword">new</span> <span class="hljs-type">Point</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">val</span> point2 = <span class="hljs-keyword">new</span> <span class="hljs-type">Point</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>    println(point1.isEqu(point2))<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Read</span> </span>&#123;<br>  <span class="hljs-comment">// trait无法传参，也就是没有括号</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span></span>(name:<span class="hljs-type">String</span>) = &#123;<br>    println(<span class="hljs-string">s&quot;<span class="hljs-subst">$name</span> is reading...&quot;</span>)<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Listen</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">listen</span></span>(name:<span class="hljs-type">String</span>) = &#123;<br>    println(<span class="hljs-string">s&quot;<span class="hljs-subst">$name</span> is listening...&quot;</span>)<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span>(<span class="hljs-params"></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Read</span> <span class="hljs-keyword">with</span> <span class="hljs-title">Listen</span> </span>&#123;<br>  <span class="hljs-comment">// 继承多个trait时第一个关键字用extends,后面全都是with</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">IsEqual</span></span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">isEqu</span></span>(o:<span class="hljs-type">Any</span>):<span class="hljs-type">Boolean</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">isNotEqu</span></span>(o:<span class="hljs-type">Any</span>):<span class="hljs-type">Boolean</span> = &#123;<br>    !isEqu(o)<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span>(<span class="hljs-params">x:<span class="hljs-type">Int</span>, y:<span class="hljs-type">Int</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">IsEqual</span> </span>&#123;<br>  <span class="hljs-keyword">val</span> xx = x<br>  <span class="hljs-keyword">val</span> yy = y<br><br>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">isEqu</span></span>(o: <span class="hljs-type">Any</span>): <span class="hljs-type">Boolean</span> = &#123;<br>    o.isInstanceOf[<span class="hljs-type">Point</span>] &amp;&amp; o.asInstanceOf[<span class="hljs-type">Point</span>].xx == <span class="hljs-keyword">this</span>.xx<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Match"><a href="#Match" class="headerlink" title="Match"></a>Match</h2><ol><li>case _ 什么默认匹配，放在最后一个</li><li>match 可以匹配值还可以匹配类型</li><li>从上往下匹配，匹配上之后就不会往下匹配了</li><li>匹配过程中会有数值的转换，例如Double转换为Int</li><li>模式匹配中外部的”{}”可以省略</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Match 模式匹配</span><br><span class="hljs-comment"> * 1. case _ 表示默认匹配，放在最后一个</span><br><span class="hljs-comment"> * 2. match 可以匹配值还可以匹配类型</span><br><span class="hljs-comment"> * 3. 从上往下匹配，匹配上之后就不会往下匹配了</span><br><span class="hljs-comment"> * 4. 匹配过程中会有数值的转换，例如Double转换为Int</span><br><span class="hljs-comment"> * 5. 模式匹配中外部的&quot;&#123;&#125;&quot;可以省略</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_Match</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> tp = (<span class="hljs-number">1</span>,<span class="hljs-number">1.0</span>,<span class="hljs-string">&quot;abc&quot;</span>,&#x27;a&#x27;, <span class="hljs-literal">true</span>)<br>    <span class="hljs-keyword">val</span> iterator: <span class="hljs-type">Iterator</span>[<span class="hljs-type">Any</span>] = tp.productIterator<br>    iterator.foreach(<span class="hljs-type">MathTest</span>)<br>  &#125;<br><br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">MathTest</span></span>(o:<span class="hljs-type">Any</span>): <span class="hljs-type">Unit</span> = &#123;<br>    o <span class="hljs-keyword">match</span> &#123;<br>      <span class="hljs-keyword">case</span> i:<span class="hljs-type">Int</span>=&gt;println(<span class="hljs-string">s&quot;type is Int, value = <span class="hljs-subst">$i</span>&quot;</span>) <span class="hljs-comment">//类型匹配，查看是否符合Int类型</span><br>      <span class="hljs-keyword">case</span> d:<span class="hljs-type">Double</span>=&gt;println(<span class="hljs-string">s&quot;type is Double, value = <span class="hljs-subst">$d</span>&quot;</span>) <span class="hljs-comment">//类型匹配，查看是否符合Double类型</span><br>      <span class="hljs-keyword">case</span> s:<span class="hljs-type">String</span>=&gt;println(<span class="hljs-string">s&quot;type is String, value = <span class="hljs-subst">$s</span>&quot;</span>) <span class="hljs-comment">//类型匹配，查看是否符合String类型</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>=&gt; println(<span class="hljs-string">&quot;value is 1&quot;</span>) <span class="hljs-comment">//值匹配,查看值是否为1</span><br>      <span class="hljs-keyword">case</span> &#x27;a&#x27;=&gt; println(<span class="hljs-string">&quot;value is a&quot;</span>)<br>      <span class="hljs-keyword">case</span> _=&gt; println(<span class="hljs-string">&quot;no match&quot;</span>) <span class="hljs-comment">//相当于default，必须放在最后一个</span><br>    &#125;<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="输出-2"><a href="#输出-2" class="headerlink" title="输出"></a>输出</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210115020456.png" style="zoom:33%;" /><h3 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h3><p>如果一个方法没有match只有case，这个函数就可以定义成PartialFunction偏函数。</p><p>偏函数定义时，不能使用括号传参，默认定义PartialFunction中传入一个值，匹配上了对应的case，返回一个值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * PartitionFunction 偏函数</span><br><span class="hljs-comment"> * 只能匹配一个值，匹配上了返回某个值</span><br><span class="hljs-comment"> * PartitionFunction[A,B]，A是匹配的类型，B是匹配上返回的类型</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_Match</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> result: <span class="hljs-type">Int</span> = <span class="hljs-type">PartialFunctionTest</span>(<span class="hljs-string">&quot;abc&quot;</span>)<br>    println(result)<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">PartialFunctionTest</span> </span>: <span class="hljs-type">PartialFunction</span>[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>] = &#123;  <span class="hljs-comment">//进来只能是String，出去是Int</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;abc&quot;</span> =&gt; <span class="hljs-number">2</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;a&quot;</span> =&gt; <span class="hljs-number">1</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;100&quot;</span> =&gt; <span class="hljs-number">200</span><br>    <span class="hljs-keyword">case</span> _=&gt; <span class="hljs-number">0</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="样例类"><a href="#样例类" class="headerlink" title="样例类"></a>样例类</h2><p>用case关键字定义的类就是样例类，样例类是种特殊的类，实现了类构造参数的getter方法（构造参数默认被声明为val），当构造参数是声明为var类型时，它将帮你实现setter和getter方法。</p><ul><li><p>样例类帮你实现了toString，equals，copy和hashCode等方法</p></li><li><p>样例类可以new，也可以不new</p></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lession_CaseClass</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-type">Persion11</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">10</span>)<br>    <span class="hljs-keyword">val</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-type">Persion11</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">10</span>)<br>    println(p1.equals(p2))<br>    println(p1.hashCode())<br>    println(p1.toString)<br>  &#125;<br>&#125;<br><span class="hljs-comment">// 用case修饰的就是样例类</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Persion11</span>(<span class="hljs-params">var name:<span class="hljs-type">String</span>, age:<span class="hljs-type">Int</span></span>)</span>&#123;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="输出-3"><a href="#输出-3" class="headerlink" title="输出"></a>输出</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210115022015.png" style="zoom:33%;" /><h1 id="六、Scala隐式转换"><a href="#六、Scala隐式转换" class="headerlink" title="六、Scala隐式转换"></a>六、Scala隐式转换</h1><h2 id="隐式转换定义"><a href="#隐式转换定义" class="headerlink" title="隐式转换定义"></a>隐式转换定义</h2><p>隐式转换是在 Scala 编译器进行类型匹配时，如果找不到合适的类型，那么隐式转换会让编译器在作用范围内自动推导出来合适的类型。</p><h2 id="1-隐式值与隐式函数"><a href="#1-隐式值与隐式函数" class="headerlink" title="1. 隐式值与隐式函数"></a>1. 隐式值与隐式函数</h2><p>隐式值是指在定义参数时前面加上 implicit，隐式函数是指在定义方法时，方法中的部分参数是由 implicit 修饰。</p><h4 id="隐式转换作用"><a href="#隐式转换作用" class="headerlink" title="隐式转换作用"></a>隐式转换作用</h4><p>当调用方法时，不必手动传入方法中隐式参数，Scala 会自动在作用域范围内寻找隐式值自动传入</p><h4 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h4><ol><li>如果在定义隐式函数时部分参数需要隐式指定，那么需要使用柯里化函数形式<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sayName2</span></span>(age:<span class="hljs-type">Int</span>)(<span class="hljs-keyword">implicit</span> name:<span class="hljs-type">String</span>) = &#123;<br>  println(<span class="hljs-string">s&quot;name is <span class="hljs-subst">$name</span>, age is <span class="hljs-subst">$age</span>&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li><li>同类型的参数的隐式值只能在作用域内出现一次，同一个作用域内不能定义多个类型一样的隐式值</li><li>implicit 关键字必须放在隐式参数定义的开头</li><li>一个方法只能有一个参数是隐式转换时，直接定义 implicit 关键字修饰的参数，调用时直接创建类型不传入参数即可<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210116024713.png" style="zoom:50%;" /></li></ol><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210116024414.png"></p><h2 id="2-隐式转换函数"><a href="#2-隐式转换函数" class="headerlink" title="2. 隐式转换函数"></a>2. 隐式转换函数</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>隐式转换函数是使用关键字implicit修饰的方法。当Scala运行时，假设如果A类型变量调用了method()这个方法，发现A类型的变量没有method()方法，而B类型有次method()方法，会在作用域中寻找有没有隐式转换将A类型转换成B类型，如果有隐式转换函数，那么A类型就可以调用method这个方法</p><h3 id="注意-4"><a href="#注意-4" class="headerlink" title="注意"></a>注意</h3><p>隐式转换函数只与函数的参数类型和返回类型有关，与函数名称无关，所以作用于内不能有相同的参数类型和返回类型的不同名称隐式转换函数</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.coachhe.scala<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>(<span class="hljs-params">name:<span class="hljs-type">String</span></span>)</span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">canFly</span></span>()=&#123;<br>    println(<span class="hljs-string">s&quot;<span class="hljs-subst">$name</span> can fly&quot;</span>)<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rabbit</span>(<span class="hljs-params">xname:<span class="hljs-type">String</span></span>)</span>&#123;<br>  <span class="hljs-keyword">val</span> name = xname<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Lesson_ImplicitTrans2</span> </span>&#123;<br>  <br>  <span class="hljs-comment">// 隐式转换</span><br>  <span class="hljs-keyword">implicit</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">RabbitToAnimal</span></span>(r:<span class="hljs-type">Rabbit</span>): <span class="hljs-type">Animal</span> = &#123;<br>    <span class="hljs-comment">// 分析：传进来一个Rabbit出去一个Animal</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-type">Animal</span>(r.name)<br>  &#125;<br>  <br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = &#123;<br>    <span class="hljs-keyword">val</span> rabbit = <span class="hljs-keyword">new</span> <span class="hljs-type">Rabbit</span>(<span class="hljs-string">&quot;rabbit&quot;</span>)    <br>    <span class="hljs-comment">//此时就能调用rabbit没有的canFly方法了</span><br>    rabbit.canFly()<br>    <br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Scala</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/898da9aca3db.html"/>
    <url>/2022/12/898da9aca3db.html</url>
    
    <content type="html"><![CDATA[<h1 id="引言-异步事件处理的两种方式"><a href="#引言-异步事件处理的两种方式" class="headerlink" title="引言-异步事件处理的两种方式"></a>引言-异步事件处理的两种方式</h1><h2 id="异步事件的处理"><a href="#异步事件的处理" class="headerlink" title="异步事件的处理"></a>异步事件的处理</h2><ol><li>查询法</li><li>通知法</li></ol><h3 id="一、信号实现并发"><a href="#一、信号实现并发" class="headerlink" title="一、信号实现并发"></a>一、信号实现并发</h3><ol><li>信号的概念<br>   信号是软件中断。</li><li>signal();</li><li>信号的不可靠</li><li>可重入函数</li><li>信号的响应过程（重点）</li><li>常用函数<ul><li>kill();</li><li>raise();</li><li>alarm();</li><li>pause();</li><li>abort();</li><li>system();</li><li>sleep问题</li></ul></li><li>信号集</li><li>信号屏蔽字&#x2F;pending集的处理</li><li>扩展：<ul><li>sigsuspend();</li><li>sigaction();</li><li>setitimer();</li></ul></li><li>实时信号</li></ol><h3 id="二、多线程实现并发"><a href="#二、多线程实现并发" class="headerlink" title="二、多线程实现并发"></a>二、多线程实现并发</h3><h1 id="系统日志"><a href="#系统日志" class="headerlink" title="系统日志"></a>系统日志</h1><h2 id="系统日志所在位置："><a href="#系统日志所在位置：" class="headerlink" title="系统日志所在位置："></a>系统日志所在位置：</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/var/log<br></code></pre></td></tr></table></figure><h2 id="syslog设施"><a href="#syslog设施" class="headerlink" title="syslog设施"></a>syslog设施</h2><p>简单来说，就是所有文件（包括守护进程等）都将信息全部发送给syslogd，然后让其控制格式进行统一的输出。</p><h2 id="3种产生日志消息的方法"><a href="#3种产生日志消息的方法" class="headerlink" title="3种产生日志消息的方法"></a>3种产生日志消息的方法</h2><ol><li>内核例程可以调用log函数</li><li>大多数用户进程（守护进程）调用syslog(3)函数来产生日志消息</li><li>将日志信息发送给UDP端口514</li></ol><h3 id="syslog系列函数"><a href="#syslog系列函数" class="headerlink" title="syslog系列函数"></a>syslog系列函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;syslog.h&gt;</span>        <span class="hljs-comment">//可选的，如果不调用，则会第一次调用syslog时调用。</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">openlog</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ident, <span class="hljs-type">int</span> option, <span class="hljs-type">int</span> facility)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">syslog</span><span class="hljs-params">(<span class="hljs-type">int</span> priority, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *format, ...)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">closelog</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;    <span class="hljs-comment">//也是可选的，因为它只是关闭层被用于与syslogd的守护进程进行通信的描述符</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setlogmask</span><span class="hljs-params">(<span class="hljs-type">int</span> maskpri)</span>;<br></code></pre></td></tr></table></figure><h1 id="信号的基本概念"><a href="#信号的基本概念" class="headerlink" title="信号的基本概念"></a>信号的基本概念</h1><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h2><p>信号是软件中断。<br>信号提供了一种处理异步事件的方法。<br>也就是说，系统有很多时刻会产生的情况是无法预料的，通过信号机制可以随时对突发事件进行处理。</p><h2 id="2-信号概念"><a href="#2-信号概念" class="headerlink" title="2 信号概念"></a>2 信号概念</h2><p>信号是异步事件的经典实例。产生信号的时间对进程而言是随机出现。</p><h3 id="内核对信号的处理操作"><a href="#内核对信号的处理操作" class="headerlink" title="内核对信号的处理操作"></a>内核对信号的处理操作</h3><ol><li>忽略此信号<br>大多数信号都可以使用这种方式进行处理，但有两种信号却绝不能被忽略。它们是SIGKILL和SIGSTOP。</li><li>捕捉信号</li><li>执行系统默认动作</li></ol><h3 id="core文件"><a href="#core文件" class="headerlink" title="core文件"></a>core文件</h3><p>注意到，系统的默认动作大部分都是终止或者终止+core。那么这个core文件是什么呢？<br>core文件其实就是程序的某个现场（大部分都是出错现场）</p><h2 id="3-函数signal"><a href="#3-函数signal" class="headerlink" title="3 函数signal"></a>3 函数signal</h2><p>UNIX系统信号机制最简单的接口是signal函数。形式如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">void</span> (*signal(<span class="hljs-type">int</span> signo, <span class="hljs-type">void</span> (*func)(<span class="hljs-type">int</span>)))(<span class="hljs-type">int</span>);<br></code></pre></td></tr></table></figure><p>参数解释：<br>在这里，signo是函数名，参考图10-1。<br>func的值有三种情况：</p><ol><li>SIG_IGN（signal ignore)，表示忽略该信号</li><li>SIG_DFL (signal default)，表示系统默认动作</li><li>指定函数地址：则在信号发生时，调用该函数，这种处理被称为<strong>捕捉信号</strong>，称此函数为信号处理程序或信号捕捉程序。</li></ol><h3 id="等价替换"><a href="#等价替换" class="headerlink" title="等价替换"></a>等价替换</h3><p>可将上面的表达式替换为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-type">void</span> <span class="hljs-title function_">Sigfunc</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span>;<br><br>Sigfunc *<span class="hljs-title function_">signal</span><span class="hljs-params">(<span class="hljs-type">int</span>, Sigfunc *)</span>;<br></code></pre></td></tr></table></figure><p>解释：<br>这里的形式和常规的不太一样，在常规的typedef中，更类似于：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-type">double</span> wage;    <span class="hljs-comment">//创建一个叫wage的别名，其实wage就是double的意思</span><br></code></pre></td></tr></table></figure><p>但是在这里，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-type">void</span> <span class="hljs-title function_">Sigfunc</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span>;<br></code></pre></td></tr></table></figure><p>在这里的意思是定义一种指针类型Sigfunc，它是一种指向函数void (int) 的指针，也就是说Sigfunc表示的是这种类型的函数的地址，因为：<br>函数名不是其类型的一部分，函数的类型只由它的返回值和参数表决定.<br>因此在这里，我们可以通过Sigfunc来指向不同的类型为void (int)的函数，例如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">abs</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-built_in">abs</span>)</span>&#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span> &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>;<br>  &#125; <span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> -<span class="hljs-built_in">abs</span>;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-keyword">typedef</span> <span class="hljs-title function_">int</span> <span class="hljs-params">(*Sigfunc)</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span>;<br>  Sigfunc my_abs = <span class="hljs-built_in">abs</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, my_abs(<span class="hljs-number">-1</span>));<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="举例1（忽略中断信号）"><a href="#举例1（忽略中断信号）" class="headerlink" title="举例1（忽略中断信号）"></a>举例1（忽略中断信号）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-type">int</span> i;<br><br>  signal(SIGINT, SIG_IGN);<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br>    write(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">1</span>);<br>    sleep(<span class="hljs-number">1</span>);<br>  &#125;<br><br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，在这里我们使用了signal信号，设定了接收到SIGINT（signal interrupt）时处理的动作是SIG_IGN（signal ignore），那么当接受到（CTRL+C）的时候程序就不会中断了，会继续输出直到结束。<br>输出：<br>![IMAGE](resources&#x2F;1DD53AD6BEF2155AE6D59D83D2B57A4F.jpg &#x3D;208x49)<br>就像我们预期的那样，中间那个^C即使出现了也不会又反应。</p><h3 id="举例2（执行函数地址来处理信号）"><a href="#举例2（执行函数地址来处理信号）" class="headerlink" title="举例2（执行函数地址来处理信号）"></a>举例2（执行函数地址来处理信号）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">int_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span>&#123;<br>  write(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-type">int</span> i;<br><br>  signal(SIGINT, int_handler);       <span class="hljs-comment">//给入口地址</span><br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br>    write(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">1</span>);<br>    sleep(<span class="hljs-number">1</span>);<br>  &#125;<br><br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，当SIGINT信号到时，指定了一个函数的入口地址来处理，处理方式是打印一个1.<br>输出：<br>![IMAGE](resources&#x2F;D211813D0F7E0ED70777180DAA7744D5.jpg &#x3D;194x51)</p><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p><strong>信号会打断阻塞的系统调用</strong></p><h3 id="书中例子（fig10-2）"><a href="#书中例子（fig10-2）" class="headerlink" title="书中例子（fig10.2）"></a>书中例子（fig10.2）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">sig_usr</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span>;<span class="hljs-comment">/* one handler for both signals */</span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-keyword">if</span> (signal(SIGUSR1, sig_usr) == SIG_ERR)<br>err_sys(<span class="hljs-string">&quot;can&#x27;t catch SIGUSR1&quot;</span>);<br><span class="hljs-keyword">if</span> (signal(SIGUSR2, sig_usr) == SIG_ERR)<br>err_sys(<span class="hljs-string">&quot;can&#x27;t catch SIGUSR2&quot;</span>);<br><span class="hljs-keyword">for</span> ( ; ; )<br>pause();<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">sig_usr</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span><span class="hljs-comment">/* argument is signal number */</span><br>&#123;<br><span class="hljs-keyword">if</span> (signo == SIGUSR1)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;received SIGUSR1\n&quot;</span>);<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (signo == SIGUSR2)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;received SIGUSR2\n&quot;</span>);<br><span class="hljs-keyword">else</span><br>err_dump(<span class="hljs-string">&quot;received signal %d\n&quot;</span>, signo);<br>&#125;<br></code></pre></td></tr></table></figure><p>解释：<br>当信号来临时，signal会自动进行捕捉，然后将交给sig_usr进行处理，如果处理结果是SIG_ERR，那么打印不能捕捉，如果是其他信号则按照默认方式处理。<br>输出：<br>![IMAGE](resources&#x2F;3F816E69971AA60325437504C2D5EB13.jpg &#x3D;432x343)</p><p>可以看到，我们发送SIGUSR信号1和2时，会打印接收到信号，但是不会结束，而直接kill的时候会结束，这是因为没有对kill信号（SIGTEAM）设置相应的捕捉方式，而是按照默认方式进行操作，所以就直接终止了。</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>exec函数将原先设置为要捕捉的信号都更改为默认动作，其他信号的状态则保持不变。</p><h2 id="4-不可靠信号"><a href="#4-不可靠信号" class="headerlink" title="4 不可靠信号"></a>4 不可靠信号</h2><h3 id="不可靠概念"><a href="#不可靠概念" class="headerlink" title="不可靠概念"></a>不可靠概念</h3><p>信号可能会丢失：<br>一个信号发生了，但进程却可能一直不知道这一点。</p><h1 id="2-可重入函数"><a href="#2-可重入函数" class="headerlink" title="2 可重入函数"></a>2 可重入函数</h1><p>所有的系统调用都是可重入的。<br>一部分库函数是可重入的。如：memcpy<br>进程捕捉到信号并对其进行处理时，进程正在执行的正常指令序列就被信号处理程序临时中断，它首先执行该信号处理程序中的指令。<br>如果从信号处理程序返回（例如没有调用 exit 或longjmp），则继续执行在捕捉到信号时进程正在执行的正常指令序列（这类似于发生硬件中断时所做的）。<br>但在信号处理程序中，不能判断捕捉到信号时进程执行到何处。如果进程正在执行malloc，在其堆中分配另外的存储空间，而此时由于捕捉到信号而插入执行该信号处理程序，其中又调用malloc，这时会发生什么？又例如，若进程正在执行getpwnam（见6.2节）这种将其结果存放在静态存储单元中的函数，其间插入执行信号处理程序，它又调用这样的函数，这时又会发生什么呢？在malloc例子中，可能会对进程造成破坏，因为malloc通常为它所分配的存储区维护一个链表，而插入执行信号处理程序时，进程可能正在更改此链表。在getpwnam的例子中，返回给正常调用者的信息可能会被返回给信号处理程序的信息覆盖。<br><img src="https://pic.downk.cc/item/5fc636d9f81f7e3bd97f4929.jpg"></p><p>Single UNIX Specification说明了在信号处理程序中保证调用安全的函数。这些函数是可重入的并被称为是异步信号安全的（async-signal safe）。<br>除了可重入以外，在信号处理操作期间，它会阻塞任何会引起不一致的信号发送。图10-4列出了这些异步信号安全的函数。没有列入图10-4中的大多数函数是不可重入的，<br>因为</p><ul><li>已知它们使用静态数据结构；</li><li>它们调用 malloc 或free；</li><li>它们是标准I&#x2F;O函数。标准I&#x2F;O库的很多实现都以不可重入方式使用全局数据结构。注意，虽然在本书的某些实例中，信号处理程序也调用了printf函数，但这并不保证产生所期望的结果，信号处理程序可能中断主程序中的printf函数调用。</li></ul><p>应当了解，即使信号处理程序调用的是图10-4中的函数，但是由于每个线程只有一个errno变量（回忆1.7节对errno和线程的讨论），所以信号处理程序可能会修改其原先值。考虑一个信号处理程序，它恰好在main刚设置errno之后被调用。如果该信号处理程序调用read这类函数，则它可能更改errno的值，从而取代了刚由main设置的值。因此，作为一个通用的规则，当在信号处理程序中调用图10-4中的函数时，应当在调用前保存errno，在调用后恢复errno。（应当了解，经常被捕捉到的信号是SIGCHLD，其信号处理程序通常要调用一种wait函数，而各种wait函数都能改变errno。）</p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pwd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">my_alarm</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">passwd</span> *<span class="hljs-title">rootptr</span>;</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;in signal handler\n&quot;</span>);<br>    <span class="hljs-keyword">if</span>((rootptr = getpwnam(<span class="hljs-string">&quot;root&quot;</span>)) == <span class="hljs-literal">NULL</span>)&#123;<br>        err_sys(<span class="hljs-string">&quot;getpwnam(root) error&quot;</span>);<br>    &#125;<br>    alarm(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">passwd</span> *<span class="hljs-title">ptr</span>;</span><br><br>    signal(SIGALRM, my_alarm);<br>    alarm(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(; ;)&#123;<br>        <span class="hljs-keyword">if</span>((ptr = getpwnam(<span class="hljs-string">&quot;sar&quot;</span>)) == <span class="hljs-literal">NULL</span>)&#123;<br>            err_sys(<span class="hljs-string">&quot;getpwnam error&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(ptr-&gt;pw_name,<span class="hljs-string">&quot;sar&quot;</span>) != <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;return value corrupted, pw_name = %s\n&quot;</span>,ptr-&gt;pw_name);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>解析：<br>在这里，main进程调用alarm函数使得每秒产生一次SIGALAM信号，并且被signal函数定向到my_alarm进程中，但是my_alarm中有petpwnam这个不可重入函数，因此执行的结果是异常的。（不可预测）<br>输出：<br><img src="https://pic.downk.cc/item/5fc6369df81f7e3bd97f3888.jpg"></p><h1 id="3-1-守护进程"><a href="#3-1-守护进程" class="headerlink" title="3.1 守护进程"></a>3.1 守护进程</h1><p>守护进程(daemon)是生存期长的一种进程。它们常常在系统引导装入时启动，仅在系统关闭时才终止。<br>因为它们没有控制终端，所以说它们是在后台进行的。UNIX系统有很多守护进程，它们执行日常事务活动。</p><h2 id="守护进程的特征"><a href="#守护进程的特征" class="headerlink" title="守护进程的特征"></a>守护进程的特征</h2><p>我们执行</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ps -axj</span><br></code></pre></td></tr></table></figure><p>命令。<br>参数说明：<br>-a：显示由其他用户所拥有的进程的状态<br>-x：显示没有控制终端的进程状态<br>-j：显示与作业有关的信息。<br>部分输出：<br><img src="https://pic.downk.cc/item/5fc6371af81f7e3bd97f56b0.jpg"><br>解释：<br>USER是用户，PID是进程ID，PPID是父进程ID，PGID是组ID，SESS是会话ID，TT是表明是否由控制终端控制。</p><ol><li>守护进程脱离控制终端（因此TT应该是？）</li><li>守护进程的父进程一定得是init进程（因为守护进程一直在运行，因此若让父进程一直等待则会造成很多资源损耗，因此直接让父进程fork之后setsid，然后销毁父进程，将守护进程托管给init进程）</li><li>守护进程PID&#x3D;PGID&#x3D;SESS</li></ol><h3 id="编程规则"><a href="#编程规则" class="headerlink" title="编程规则"></a>编程规则</h3><ol><li>调用umask将文件模式创建屏蔽字设置为一个已知值（通常是0）；</li><li>调用fork然后使父进程exit</li><li>调用setsid创建一个新会话。然后执行9.5节中列出的三个步骤：</li></ol><ul><li>成为新会话的首进程</li><li>成为一个新进程组的组长进程</li><li>没有控制终端</li></ul><ol start="4"><li>将当前目录更改为根目录。</li><li>关闭不再需要的文件描述符</li></ol><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/resource.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FNAME <span class="hljs-string">&quot;/tmp/out&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">daemonize</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>&#123;<br>  <span class="hljs-type">pid_t</span> pid;<br>  <span class="hljs-type">int</span> fd;<br>  <span class="hljs-comment">//实现守护进程</span><br>  pid = fork();<br>  <span class="hljs-keyword">if</span>(pid &lt; <span class="hljs-number">0</span>)&#123;<br>  perror(<span class="hljs-string">&quot;fork()&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br> &#125;<br>  <span class="hljs-keyword">if</span>(pid &gt; <span class="hljs-number">0</span>)&#123;<br>   <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br> &#125;<br>  fd = open(<span class="hljs-string">&quot;/dev/null&quot;</span>,O_RDWR);<br>  <span class="hljs-keyword">if</span>(fd &lt; <span class="hljs-number">0</span>)&#123;<br>    perror(<span class="hljs-string">&quot;1&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br><br>  dup2(fd,<span class="hljs-number">0</span>);<br>  dup2(fd,<span class="hljs-number">1</span>);<br>  dup2(fd,<span class="hljs-number">2</span>);<br>  <span class="hljs-keyword">if</span>(fd &gt; <span class="hljs-number">2</span>)&#123;<br>    close(fd);<br>  &#125;<br><br>  setsid();<br>  chdir(<span class="hljs-string">&quot;/&quot;</span>);     <span class="hljs-comment">//设置到根目录位置</span><br><br>  umask(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  FILE *fp;<br><br>  <span class="hljs-keyword">if</span>(daemonize())&#123;  <span class="hljs-comment">//表示自己的函数名字，用它来实现daemon</span><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br><br> fp = fopen(FNAME,<span class="hljs-string">&quot;w&quot;</span>);<br> <span class="hljs-keyword">if</span>(fp == <span class="hljs-literal">NULL</span>)&#123;<br>   perror(<span class="hljs-string">&quot;&quot;</span>);<br>   <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br> &#125;<br>  <span class="hljs-comment">//做任务，目的是不间断每秒钟往文件打印一个数字</span><br> <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; ; i++)&#123;<br>   <span class="hljs-built_in">fprintf</span>(fp,<span class="hljs-string">&quot;%d&quot;</span>,i);<br>   sleep(<span class="hljs-number">1</span>);<br> &#125;<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc6367bf81f7e3bd97f069d.jpg"><br><img src="https://pic.downk.cc/item/5fc63659f81f7e3bd97ee582.jpg"><br><img src="https://pic.downk.cc/item/5fc636fdf81f7e3bd97f4fc7.jpg"><br>解释：<br>可以看到，这里PID和PGID都是15252，是相等的，其实其SID也相等，但是并没有显示出来，并且没有控制终端，所以其是一个标准的守护进程。<br>查看我们重定向到的&#x2F;tmp&#x2F;out文件</p><h1 id="3-2-kill-raise-alarm和pause函数"><a href="#3-2-kill-raise-alarm和pause函数" class="headerlink" title="3.2 kill,raise,alarm和pause函数"></a>3.2 kill,raise,alarm和pause函数</h1><h2 id="1-函数kill和raise"><a href="#1-函数kill和raise" class="headerlink" title="1. 函数kill和raise"></a>1. 函数kill和raise</h2><p>kill函数将信号发送给进程或进程组。raise函数则允许进程向自身发送信号。</p><h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>kill只发送信号，不杀死信号，很多情况下进程会因为收到kill信号终止是因为很多信号处理的默认行为就是终止线程。</p><p>raise最初是由ISO C定义的。后来，为了与ISO C标准保持一致，POSIX.1也包括了该函数。但是POSIX.1扩展了raise的规范，使其可处理线程（12.8中讨论线程如何与信号交互）。<br>因为ISO C并不涉及多进程，所以它不能定义以进程ID作为其参数（如kill函数）的函数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">kill</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid, <span class="hljs-type">int</span> signo)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">raise</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span>;<br><span class="hljs-comment">//两个函数返回值：若成功，返回0；若出错，返回−1</span><br></code></pre></td></tr></table></figure><p>调用<br>raise(signo);<br>等价于调用<br>kill(getpid(), signo);</p><h3 id="kill的pid参数有以下4种不同的情况。"><a href="#kill的pid参数有以下4种不同的情况。" class="headerlink" title="kill的pid参数有以下4种不同的情况。"></a>kill的pid参数有以下4种不同的情况。</h3><ul><li>pid &gt; 0 将该信号发送给进程ID为pid的进程。</li><li>pid &#x3D;&#x3D; 0 将该信号发送给与发送进程属于同一进程组的所有进程（这些进程的进程组 ID等于发送进程的进程组ID），而且发送进程具有权限向这些进程发送信号。这里用的术语“所有进程”不包括实现定义的系统进程集。对于大多数UNIX系统，系统进程集包括内核进程和init（pid为1）。</li><li>pid &lt; 0 将该信号发送给其进程组ID等于pid绝对值，而且发送进程具有权限向其发送信号的所有进程。如前所述，所有进程并不包括系统进程集中的进程。</li><li>pid &#x3D;&#x3D; −1 将该信号发送给发送进程有权限向它们发送信号的所有进程。如前所述，所有进程不包括系统进程集中的进程。</li></ul><p>如前所述，进程将信号发送给其他进程需要权限。超级用户可将信号发送给任一进程。对于非超级用户，其基本规则是发送者的实际用户 ID 或有效用户 ID 必须等于接收者的实际用户 ID或有效用户ID。<br>如果实现支持_POSIX_SAVED_IDS（如POSIX.1现在要求的那样），则检查接收者的保存设置用户ID（而不是有效用户ID）。在对权限进行测试时也有一个特例：如果被发送的信号是SIGCONT，则进程可将它发送给属于同一会话的任一其他进程。<br>POSIX.1将信号编号0定义为空信号。如果signo参数是0，则kill仍执行正常的错误检查，但不发送信号。这常被用来确定一个特定进程是否仍然存在。如果向一个并不存在的进程发送空信号，则kill返回−1，errno被设置为ESRCH。但是，应当注意，UNIX系统在经过一定时间后会重新使用进程ID，所以一个现有的具有所给定进程ID的进程并不一定就是你所想要的进程。<br>还应理解的是，测试进程是否存在的操作不是原子操作。在kill向调用者返回测试结果时，原来已存在的被测试进程此时可能已经终止，所以这种测试并无多大价值。<br>?: 如果调用kill为调用进程产生信号，而且此信号是不被阻塞的，那么在kill返回之前， signo或者某个其他未决的、非阻塞信号被传送至该进程。（对于线程而言，还有一些附加条件；详细情况见12.8节。）</p><h2 id="2-alarm"><a href="#2-alarm" class="headerlink" title="2. alarm"></a>2. alarm</h2><p>使用alarm函数可以设置一个定时器（闹钟时间），在将来的某个时刻该定时器会超时。当定时器超时时，产生 SIGALRM信号。如果忽略或不捕捉此信号，则其默认动作是<strong>终止调用该alarm函数的进程</strong>。</p><h3 id="函数形式"><a href="#函数形式" class="headerlink" title="函数形式"></a>函数形式</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">alarm</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> seconds)</span>;<br><span class="hljs-comment">//返回值：0或以前设置的闹钟时间的余留秒数</span><br></code></pre></td></tr></table></figure><p>每个进程只能有一个闹钟时间。如果在调用alarm时，之前已为该进程注册的闹钟时间还没有超时，则该闹钟时间的余留值作为本次alarm函数调用的值返回。以前注册的闹钟时间则被新值代替。<br>如果有以前注册的尚未超过的闹钟时间，而且本次调用的seconds值是0，则取消以前的闹钟时间，其余留值仍作为alarm函数的返回值。<br>虽然 SIGALRM 的默认动作是终止进程，但是大多数使用闹钟的进程捕捉此信号。如果此时进程要终止，则在终止之前它可以执行所需的清理操作。如果我们想捕捉 SIGALRM 信号，则必须在调用 alarm 之前安装该信号的处理程序。如果我们先调用alarm，然后在我们能够安装SIGALRM处理程序之前已接到该信号，那么进程将终止。</p><h3 id="alarm举例"><a href="#alarm举例" class="headerlink" title="alarm举例"></a>alarm举例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  alarm(<span class="hljs-number">5</span>);<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);    <span class="hljs-comment">//不让进程直接终止了</span><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：<br>运行5s之后出现：</p><h3 id="alarm举例2"><a href="#alarm举例2" class="headerlink" title="alarm举例2"></a>alarm举例2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  alarm(<span class="hljs-number">10</span>);<br>  alarm(<span class="hljs-number">1</span>);<br>  alarm(<span class="hljs-number">5</span>);<br>  <span class="hljs-comment">//alarm(1)和alarm(5)都是无效的</span><br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-pause函数"><a href="#3-pause函数" class="headerlink" title="3. pause函数"></a>3. pause函数</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>pause函数使调用进程挂起直至捕捉到一个信号。</p><h3 id="函数形式-1"><a href="#函数形式-1" class="headerlink" title="函数形式"></a>函数形式</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pause</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-comment">//返回值：−1，errno设置为EINTR</span><br></code></pre></td></tr></table></figure><p>只有执行了一个信号处理程序并从其返回时，pause才返回。在这种情况下，pause返回−1， errno设置为EINTR。</p><h2 id="举例：自己实现一个sleep（fig10-7"><a href="#举例：自己实现一个sleep（fig10-7" class="headerlink" title="举例：自己实现一个sleep（fig10.7)"></a>举例：自己实现一个sleep（fig10.7)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">sig_alrm</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span><br>&#123;<br><span class="hljs-comment">/* nothing to do, just return to wake up the pause */</span><br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span><br><span class="hljs-title function_">sleep1</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> seconds)</span><br>&#123;<br><span class="hljs-keyword">if</span> (signal(SIGALRM, sig_alrm) == SIG_ERR)<br><span class="hljs-keyword">return</span>(seconds);<br>alarm(seconds);<span class="hljs-comment">/* start the timer */</span><br>pause();<span class="hljs-comment">/* next caught signal wakes us up */</span><br><span class="hljs-keyword">return</span>(alarm(<span class="hljs-number">0</span>));<span class="hljs-comment">/* turn off timer, return unslept time */</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="存在问题"><a href="#存在问题" class="headerlink" title="存在问题"></a>存在问题</h3><ol><li>如果在调用sleep1之前，调用者已设置了闹钟，则它被sleep1函数中的第一次alarm调用擦除。可用下列方法更正这一点：检查第一次调用 alarm 的返回值，如其值小于本次调用alarm的参数值，则只应等到已有的闹钟超时。如果之前设置的闹钟超时时间晚于本次设置值，则在sleep1函数返回之前，重置此闹钟，使其在之前闹钟的设定时间再次发生超时。</li><li>该程序中修改了对 SIGALRM 的配置。如果编写了一个函数供其他函数调用，则在该函数被调用时先要保存原配置，在该函数返回前再恢复原配置。更正这一点的方法是：保存signal函数的返回值，在返回前重置原配置。</li><li>在第一次调用alarm和pause之间有一个竞争条件。在一个繁忙的系统中，可能alarm在调用pause之前超时，并调用了信号处理程序。如果发生了这种情况，则在调用pause后，如果没有捕捉到其他信号，调用者将永远被挂起。</li></ol><h2 id="举例：自己实现一个sleep（改进：fig10-8）"><a href="#举例：自己实现一个sleep（改进：fig10-8）" class="headerlink" title="举例：自己实现一个sleep（改进：fig10.8）"></a>举例：自己实现一个sleep（改进：fig10.8）</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;setjmp.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">static</span> jmp_bufenv_alrm;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">sig_alrm</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span><br>&#123;<br>longjmp(env_alrm, <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span><br><span class="hljs-title function_">sleep2</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> seconds)</span><br>&#123;<br><span class="hljs-keyword">if</span> (signal(SIGALRM, sig_alrm) == SIG_ERR)<br><span class="hljs-keyword">return</span>(seconds);<br><span class="hljs-keyword">if</span> (setjmp(env_alrm) == <span class="hljs-number">0</span>) &#123;<br>alarm(seconds);<span class="hljs-comment">/* start the timer */</span><br>pause();<span class="hljs-comment">/* next caught signal wakes us up */</span><br>&#125;<br><span class="hljs-keyword">return</span>(alarm(<span class="hljs-number">0</span>));<span class="hljs-comment">/* turn off timer, return unslept time */</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-信号集"><a href="#4-信号集" class="headerlink" title="4 信号集"></a>4 信号集</h1><h2 id="函数形式-2"><a href="#函数形式-2" class="headerlink" title="函数形式"></a>函数形式</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigaddset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> signo)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigdelset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> signo)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigemptyset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigfillset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigismember</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> signo)</span>;<br></code></pre></td></tr></table></figure><p>这里的set就是信号集<br>注意：<br>这里假定一种实现有31种信号和32位整型。也就是说通过sigset_t定义得到的对象都是一个由31个信号，每种信号有32位整型的对象。不同之处在于整型的设置：</p><ol><li>sigaddset：将某一位整型设置为1</li><li>sigdelset：将某一位整型设置为0</li><li>sigemptyset：将所有位的整型都设置为0</li><li>sigfillset：将所有位都设置为1</li><li>sigismember：测试一个指定的位</li></ol><h2 id="函数实现"><a href="#函数实现" class="headerlink" title="函数实现"></a>函数实现</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;errno.h&gt;</span></span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * &lt;signal.h&gt; usually defines NSIG to include signal number 0.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>SIGBAD(signo)((signo) <span class="hljs-string">&lt;= 0 || (signo) &gt;</span>= NSIG)</span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">sigaddset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> signo)</span><br>&#123;<br><span class="hljs-keyword">if</span> (SIGBAD(signo)) &#123;<br>errno = EINVAL;<br><span class="hljs-keyword">return</span>(<span class="hljs-number">-1</span>);<br>&#125;<br>*<span class="hljs-built_in">set</span> |= <span class="hljs-number">1</span> &lt;&lt; (signo - <span class="hljs-number">1</span>);<span class="hljs-comment">/* turn bit on */</span><br><span class="hljs-keyword">return</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">sigdelset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> signo)</span><br>&#123;<br><span class="hljs-keyword">if</span> (SIGBAD(signo)) &#123;<br>errno = EINVAL;<br><span class="hljs-keyword">return</span>(<span class="hljs-number">-1</span>);<br>&#125;<br>*<span class="hljs-built_in">set</span> &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; (signo - <span class="hljs-number">1</span>));<span class="hljs-comment">/* turn bit off */</span><br><span class="hljs-keyword">return</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">sigismember</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> signo)</span><br>&#123;<br><span class="hljs-keyword">if</span> (SIGBAD(signo)) &#123;<br>errno = EINVAL;<br><span class="hljs-keyword">return</span>(<span class="hljs-number">-1</span>);<br>&#125;<br><span class="hljs-keyword">return</span>((*<span class="hljs-built_in">set</span> &amp; (<span class="hljs-number">1</span> &lt;&lt; (signo - <span class="hljs-number">1</span>))) != <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="sigprocmask"><a href="#sigprocmask" class="headerlink" title="sigprocmask"></a>sigprocmask</h2><p>参考<a href="https://zhuanlan.zhihu.com/p/137364536">补充-重点：信号的响应过程</a>，这个其实就是修改位图中的masks函数：</p><h3 id="函数形式如下"><a href="#函数形式如下" class="headerlink" title="函数形式如下"></a>函数形式如下</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigprocmaks</span><span class="hljs-params">(<span class="hljs-type">int</span> how, <span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *<span class="hljs-keyword">restrict</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">sigset_t</span> *<span class="hljs-keyword">restrict</span> oset)</span>;<br></code></pre></td></tr></table></figure><p>参数说明：<br>oset：若oset是非空指针，那么进程的当前信号屏蔽字(也就是masks)通过oset返回。<br>set：若set是一个非空指针，那么how参数指示如何修改当前信号屏蔽字。<br>注意：<br>不能阻塞SIGKILL和SIGSTOP信号。<br>SIG_BLOCK是或操作，SIG_SETMASK是赋值操作。<br>若set是个空指针，则不能改变进程的信号屏蔽字，此时how无意义。</p><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><p>更改star.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  signal(SIGINT, SIG_IGN);<br><br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)&#123;<br>      write(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">1</span>);<br>      sleep(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="输出："><a href="#输出：" class="headerlink" title="输出："></a>输出：</h4><p><img src="https://pic.downk.cc/item/5fc63669f81f7e3bd97eec0f.jpg"><br>每5个星都换行。并且CTRL+C不会中断进程。</p><h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><p>CTRL+C虽说不会中断进程，但是会中断系统调用，也就是说会中断等待的那一秒钟，从而直接输出下一个※</p><h4 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h4><p>若需要中断键入CTRL+\</p><h3 id="更改要求："><a href="#更改要求：" class="headerlink" title="更改要求："></a>更改要求：</h3><p>在行内输出的时候不被CTRL+C的影响，但是一行输出完之后可以。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">int_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span>&#123;<br>  write(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;!&quot;</span>,<span class="hljs-number">1</span>);<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-type">sigset_t</span> <span class="hljs-built_in">set</span>;<br><br>  signal(SIGINT, int_handler);<br>  sigemptyset(&amp;<span class="hljs-built_in">set</span>);<br>  sigaddset(&amp;<span class="hljs-built_in">set</span>,SIGINT);<br><br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>    sigprocmask(SIG_BLOCK, &amp;<span class="hljs-built_in">set</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)&#123;<br>      write(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">1</span>);<br>      sleep(<span class="hljs-number">1</span>);<br>    &#125;<br>    write(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-number">1</span>);<br>    sigprocmask(SIG_UNBLOCK,&amp;<span class="hljs-built_in">set</span>, <span class="hljs-literal">NULL</span>);<br>  &#125;<br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="输出：-1"><a href="#输出：-1" class="headerlink" title="输出："></a>输出：</h4><p><img src="https://pic.downk.cc/item/5fc63722f81f7e3bd97f5881.jpg"></p><h4 id="解释："><a href="#解释：" class="headerlink" title="解释："></a>解释：</h4><p>在每行的打印期间阻塞了信号，只有当每行结束之后换行之前解除阻塞，此时才会开始进行信号的处理。</p><h4 id="注意：-2"><a href="#注意：-2" class="headerlink" title="注意："></a>注意：</h4><ol><li>无论打多少次CTRL+C都只响应一次，因为pending只能被置为一次。</li><li>这里的set是一个sigset_t类型的集合，第12行到第16行都是对该集合进行初始化和添加信号等操作。</li></ol><h3 id="继续改进"><a href="#继续改进" class="headerlink" title="继续改进"></a>继续改进</h3><p>因为若在搭建工程的时候，需要确保进入的状态和出去的状态是相同的，也就是说进入状态若是阻塞的，就需要保证出去的状态是阻塞的。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">int_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> signo)</span>&#123;<br>  write(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;!&quot;</span>,<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-type">sigset_t</span> <span class="hljs-built_in">set</span>;<br>  <span class="hljs-type">sigset_t</span> saveset;<br><br>  signal(SIGINT, int_handler);<br>  sigemptyset(&amp;<span class="hljs-built_in">set</span>);<br>  sigaddset(&amp;<span class="hljs-built_in">set</span>,SIGINT);<br>  sigprocmask(SIG_UNBLOCK,&amp;<span class="hljs-built_in">set</span>,&amp;saveset);       <span class="hljs-comment">//保存状态</span><br><br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>    sigprocmask(SIG_BLOCK, &amp;<span class="hljs-built_in">set</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)&#123; write(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">1</span>);<br>      sleep(<span class="hljs-number">1</span>);<br>    &#125;<br>    write(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-number">1</span>);<br>    sigprocmask(SIG_UNBLOCK,&amp;<span class="hljs-built_in">set</span>, <span class="hljs-literal">NULL</span>);<br>  &#125;<br>  sigprocmask(SIG_SETMASK, &amp;saveset, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">//恢复状态</span><br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="补充：信号的响应过程"><a href="#补充：信号的响应过程" class="headerlink" title="补充：信号的响应过程"></a>补充：信号的响应过程</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>信号的响应机制非常重要，必须首先理解信号的响应机制才能进一步研究，在这里非常详细地给出了信号的响应机制！</p><h2 id="以之前给出的例子为例："><a href="#以之前给出的例子为例：" class="headerlink" title="以之前给出的例子为例："></a>以之前给出的例子为例：</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">int_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span>&#123;<br>  write(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-type">int</span> i;<br><br>  signal(SIGINT, int_handler);       <span class="hljs-comment">//给入口地址</span><br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br>    write(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">1</span>);<br>    sleep(<span class="hljs-number">1</span>);<br>  &#125;<br><br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc63669f81f7e3bd97eec35.jpg"></p><p>解释：</p><p>按下ctrl+c时不会中断，此时会打印出1并且继续打印*，直到打印完</p><h2 id="内核为进程维护的两个位图"><a href="#内核为进程维护的两个位图" class="headerlink" title="内核为进程维护的两个位图"></a>内核为进程维护的两个位图</h2><p>要理解信号的响应过程，我们需要先知道内核会为进程自动维护两个位图，一个是pending，一个是masks。其中masks是信号的标志位，代表该信号是否会被忽略。pending是信号的待定位，用来提示接受到了信号。并且masks默认设置为1，pending默认设置为0，如下所示：<br><img src="https://pic.downk.cc/item/5fc6364bf81f7e3bd97ee217.jpg"></p><h2 id="不同函数的入口地址"><a href="#不同函数的入口地址" class="headerlink" title="不同函数的入口地址"></a>不同函数的入口地址</h2><p>并且在我们的例子中，主要包含两个函数，一个是main函数，一个是int_handeler函数，它们的入口地址都存放在内存的代码段中。如图所示：<br><img src="https://pic.downk.cc/item/5fc63707f81f7e3bd97f522e.jpg"></p><h2 id="UNIX系统的进程状态"><a href="#UNIX系统的进程状态" class="headerlink" title="UNIX系统的进程状态"></a>UNIX系统的进程状态</h2><p>而在UNIX操作系统中，进程主要有两种状态，一种是用户态，一种是内核态，用户态权限很少，并且在发生系统中断时会立刻从用户态进入内核态。如下：<br><img src="https://pic.downk.cc/item/5fc6364cf81f7e3bd97ee222.jpg"></p><h2 id="信号的响应过程"><a href="#信号的响应过程" class="headerlink" title="信号的响应过程"></a>信号的响应过程</h2><ol><li>当我们在键盘上键入CTRL+C时，进程会中断，从用户态进入内核态排队等待。此时pending中相应的信号位会置位1，如下所示：<br><img src="https://pic.downk.cc/item/5fc636f5f81f7e3bd97f4ddd.jpg"></li><li>排队结束之后，内核态会重新变为用户态，重定向的地址为main函数的地址，但是此时会做一个非常重要的操作！将masks按位与pending。此时会发现在第3的位置按位与的结果为1，表明收到了该信号，通过signal函数发现处理函数的入口地址变为了int_handler，所以将地址重定向为int_handler的地址，并且此时会将masks和pending为上的值都变为0，如下所示：<br><img src="https://pic.downk.cc/item/5fc63661f81f7e3bd97ee75b.jpg"></li><li>处理结束之后会重新将masks的值置为1，pending的值置为0，并且最终的地址被重定向为main函数。<br><img src="https://pic.downk.cc/item/5fc63661f81f7e3bd97ee75b.jpg"><br>这就是个完整的信号响应过程。</li></ol><h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><ol><li>信号从收到到相应有一个不可避免的延迟</li><li>如何忽略掉一个信号的？</li><li>标准信号为什么要丢失？</li><li>标准信号的响应没有严格的顺序。</li></ol><h3 id="回答"><a href="#回答" class="headerlink" title="回答"></a>回答</h3><ol><li>因为并不是一有信号发送就马上会进入内核态，只有中断之后进入内核态，并且内核态重新回到用户态时才会进行信号的检查。</li><li>将masks置为0，那么masks与pending的按位与永远都是0了，也就不会有信号响应了。</li><li>pending无论收到多少个信号也就只能置为1，因为丢失不会带来影响<br>注意：如果是实时信号就不能丢失，必须每个信号都响应。</li><li>当同时收到多个信号时，pending的多个位都会被置为1，在没有明确确定优先级的情况下，类似优先级的标准信号相应是没有固定顺序的。</li></ol>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a7750b9777b0.html"/>
    <url>/2022/12/a7750b9777b0.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-线程的概念"><a href="#1-线程的概念" class="headerlink" title="1 线程的概念"></a>1 线程的概念</h1><p>线程就是一个正在运行的函数。</p><p>每个线程都包含有标识执行环境所必须的信息，其中包括进程中标识的线程ID、一组寄存器值、栈、调度优先级和策略、信号屏蔽字、errno变量以及线程私有数据。<br>一个进程的所有信息对该进程的所有线程都是共享的，包括可执行程序的代码、程序的全局内存和堆内存、栈以及文件描述符。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>会话就是一个承载进程组的容器<br>进程组是承载更多进程的容器<br>进程是承载线程的容器</p><h2 id="线程标准"><a href="#线程标准" class="headerlink" title="线程标准"></a>线程标准</h2><p>线程有两种标准，一种是posix线程，一种是openmp线程。</p><h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>线程标准是一套标准，而不是实现，例如posix线程标准的线程标识pthread_t，这个线程标识没有确定的类型，在不同的系统上实现形式是不同的（例如windows和macos上的实现标准有可能就不相同，有可能是链表或者数组），因此我们可以直接使用，但是不能用类似”%d”的标准将其打印。</p><h2 id="线程标识"><a href="#线程标识" class="headerlink" title="线程标识"></a>线程标识</h2><p>就像每个进程都有一个进程ID一样，每个线程也有一个线程ID。进程ID在整个系统中是唯一的，但线程ID却不同，线程ID只有在它所属的进程上下文中才有意义。<br>使用pthread_equal函数来对进程ID进行比较：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_equal</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> tid1, <span class="hljs-type">pthread_t</span> tid2)</span>;<br></code></pre></td></tr></table></figure><p>线程可以通过调用pthread_self函数获得自身的线程ID</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">pthread_t</span> <span class="hljs-title function_">pthread_self</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure><h2 id="编译和链接"><a href="#编译和链接" class="headerlink" title="编译和链接"></a>编译和链接</h2><p>编译和链接需要加上-pthreadls</p><h1 id="2-线程的创建、取消和终止、栈的清理"><a href="#2-线程的创建、取消和终止、栈的清理" class="headerlink" title="2 线程的创建、取消和终止、栈的清理"></a>2 线程的创建、取消和终止、栈的清理</h1><h2 id="1-线程创建"><a href="#1-线程创建" class="headerlink" title="1 线程创建"></a>1 线程创建</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_create</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> *<span class="hljs-keyword">restrict</span> tidp, </span><br><span class="hljs-params">         <span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span> *<span class="hljs-keyword">restrict</span> attr,</span><br><span class="hljs-params">         <span class="hljs-type">void</span> *(*star_rtn)(<span class="hljs-type">void</span> *) <span class="hljs-type">void</span> *<span class="hljs-keyword">restrict</span> arg)</span>;<br>         <span class="hljs-comment">// 返回值：若成功返回0，否则返回错误编号</span><br></code></pre></td></tr></table></figure><p>参数解析：<br>tidp：当pthread_create成功返回后，新创建线程的线程ID会被设置成tidp指向的内存单元。<br>attr：用于定制不同的线程属性（在第12章会详细讨论），将其设置为NULL将会拥有默认的属性<br>start_rtn：新创建的线程开始的地址，其实就是兄弟线程。这里其实暴露了最好的结构，因为这是一个返回值为任意类型，参数为任意类型的指针函数。因此非常开放，可以是任何类型。<br>arg：结构体的地址</p><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>pthread函数在调用失败后通常会返回错误码。在线程中，从函数中返回错误码更为清晰整洁，不需要依赖那些随着函数执行不断变化的全局状态，这样可以把错误的范围限制在引起出错的函数中。</p><h3 id="举例-书中）"><a href="#举例-书中）" class="headerlink" title="举例(书中）"></a>举例(书中）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">pthread_t</span> ntid;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">printids</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *s)</span><br>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><span class="hljs-type">pthread_t</span>tid;<br><br>pid = getpid();<br>tid = pthread_self();<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s pid %lu tid %lu (0x%lx)\n&quot;</span>, s, (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)pid,<br>  (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)tid, (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)tid);<br>&#125;<br><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">thr_fn</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br>printids(<span class="hljs-string">&quot;new thread: &quot;</span>);<br><span class="hljs-keyword">return</span>((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>err;<br><br>err = pthread_create(&amp;ntid, <span class="hljs-literal">NULL</span>, thr_fn, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t create thread&quot;</span>);<br>printids(<span class="hljs-string">&quot;main thread:&quot;</span>);<br>sleep(<span class="hljs-number">1</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc63645f81f7e3bd97ee11d.jpg"></p><p>解释：</p><p>在这里，main进程先是创建了一个新的线程，其中线程id是ntid，属性默认，兄弟线程设置为thr_fn，其余参数设置为NULL。<br>最终输出创建出来的线程的各种参数和main线程的各种参数。</p><h2 id="举例2"><a href="#举例2" class="headerlink" title="举例2"></a>举例2</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">func</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Thread is workding&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><br>    <span class="hljs-type">pthread_t</span> tid;<br>    <span class="hljs-type">int</span> errno;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Begin@&quot;</span>);<br><br><br>    errno = pthread_create(&amp;tid, <span class="hljs-literal">NULL</span>, func, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span>(errno)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<span class="hljs-string">&quot;pthread_create():%s&quot;</span>,strerror(errno));<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello world\n&quot;</span>);<br><br><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;End!&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>解析：<br>在这里，可以看到首先输出Begin，然后创建一个线程，最后输出Hello world。<br>创建线程的时候会执行兄弟线程。<br>注意：<br>因为兄弟线程和main线程的执行线程是不确定的，因此如下图所示，兄弟线程的语句什么时候输出以及是否输出都是不确定的。<br><img src="https://pic.downk.cc/item/5fc63673f81f7e3bd97efa4e.jpg"></p><h2 id="2-线程的终止"><a href="#2-线程的终止" class="headerlink" title="2 线程的终止"></a>2 线程的终止</h2><h3 id="3种终止线程的方式"><a href="#3种终止线程的方式" class="headerlink" title="3种终止线程的方式"></a>3种终止线程的方式</h3><ol><li>线程可以简单地从启动例程中返回，返回值是线程的退出码</li><li>线程可以被同一进程中的其他线程取消</li><li>线程调用pthread_exit<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">pthread_exit</span><span class="hljs-params">(<span class="hljs-type">void</span> *rval_ptr)</span>;<br></code></pre></td></tr></table></figure>参数：<br>rval_ptr参数是一个无类型指针，与传给启动例程的单个参数类似。进程中的其他线程也可以通过调用pthread_join函数访问到这个指针。<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_join</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> thread, <span class="hljs-type">void</span> **rval_ptr)</span>;<br><span class="hljs-comment">//若成功返回0，否则返回错误编号</span><br></code></pre></td></tr></table></figure></li></ol><h4 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h4><p>其中pthread_exit的参数和pthread_join函数的第二个参数是相同的，pthread_join函数的含义是将调用点成阻塞，直到指定的线程（也就是thread参数指定的）从它的启动例程返回，rval_ptr包含返回码。如果线程被取消，由rval_ptr指定的内存单元就被设置为PTHREAD_CANCELED。</p><h3 id="pthread-create和pthread-join线程举例"><a href="#pthread-create和pthread-join线程举例" class="headerlink" title="pthread_create和pthread_join线程举例"></a>pthread_create和pthread_join线程举例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">func</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Thread is workding&quot;</span>);<br>    <span class="hljs-comment">/* return NULL;                    //注意：这句话必不可少，因为返回的是void *，泛指任何类型，并不只是void */</span><br>    pthread_exit(<span class="hljs-literal">NULL</span>);         <span class="hljs-comment">//表示线程终止，若采用之前方式则不能实现线程栈清理。</span><br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><br>    <span class="hljs-type">pthread_t</span> tid;<br>    <span class="hljs-type">int</span> errno;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Begin@&quot;</span>);<br><br><br>    errno = pthread_create(&amp;tid, <span class="hljs-literal">NULL</span>, func, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span>(errno)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<span class="hljs-string">&quot;pthread_create():%s&quot;</span>,strerror(errno));<br>    &#125;<br><br>    pthread_join(tid,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;End!&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><img src="https://pic.downk.cc/item/5fc636c3f81f7e3bd97f43b2.jpg" style="zoom:50%;" /><p>解释：</p><p>main线程首先创建了一个子线程，线程号被指向tid，属性是默认属性，兄弟线程是func。创建线程之后用pthread_join来等待这个线程退出，最后执行End！<br>注意：若没有pthread_join则输出顺序是不确定的。就和例1一样。</p><h3 id="我的例子"><a href="#我的例子" class="headerlink" title="我的例子"></a>我的例子</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">func</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Thread is workding&quot;</span>);<br>    <span class="hljs-type">pthread_t</span> pid = pthread_self();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pthread_id = %d\n&quot;</span>, pid);<br>    pthread_exit(<span class="hljs-literal">NULL</span>);         <br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><br>    <span class="hljs-type">pthread_t</span> tid;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;thread_init = %d\n&quot;</span>, tid);<br>    <span class="hljs-type">int</span> errno;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Begin@&quot;</span>);<br>    errno = pthread_create(&amp;tid, <span class="hljs-literal">NULL</span>, func, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, tid);<br>    <span class="hljs-keyword">if</span>(errno)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<span class="hljs-string">&quot;pthread_create():%s&quot;</span>,strerror(errno));<br>    &#125;<br>    pthread_join(tid,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;End!&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，我们首先创建了一个pthread_t类型的变量tid，初始值是-407197560.然后打印Begin，调用pthread_create来创建一个线程，指向tid，属性为NULL，兄弟线程是func，可以看到，线程号在调用期间被初始化成了141393920.然后结束之后打印End。</p><h3 id="例11-3（获取已终止线程的退出码）"><a href="#例11-3（获取已终止线程的退出码）" class="headerlink" title="例11.3（获取已终止线程的退出码）"></a>例11.3（获取已终止线程的退出码）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">thr_fn1</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;thread 1 returning\n&quot;</span>);<br><span class="hljs-keyword">return</span>((<span class="hljs-type">void</span> *)<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">thr_fn2</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;thread 2 exiting\n&quot;</span>);<br>pthread_exit((<span class="hljs-type">void</span> *)<span class="hljs-number">2</span>);<br>&#125;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>err;<br><span class="hljs-type">pthread_t</span>tid1, tid2;<br><span class="hljs-type">void</span>*tret;<br><br>err = pthread_create(&amp;tid1, <span class="hljs-literal">NULL</span>, thr_fn1, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t create thread 1&quot;</span>);<br>err = pthread_create(&amp;tid2, <span class="hljs-literal">NULL</span>, thr_fn2, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t create thread 2&quot;</span>);<br>err = pthread_join(tid1, &amp;tret);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t join with thread 1&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;thread 1 exit code %ld\n&quot;</span>, (<span class="hljs-type">long</span>)tret);<br>err = pthread_join(tid2, &amp;tret);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t join with thread 2&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;thread 2 exit code %ld\n&quot;</span>, (<span class="hljs-type">long</span>)tret);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc6363cf81f7e3bd97edefc.jpg"></p><h2 id="不要传递临时变量"><a href="#不要传递临时变量" class="headerlink" title="不要传递临时变量"></a>不要传递临时变量</h2><p>pthread_create和pthread_exit函数的无类型指针参数可以传递的值可以是结构体等一系列类型，但是这个结构所使用的内存在调用之后必须仍然是有效的。也就是说，不要是临时变量（存放在栈上），需要是存放在堆上的常量或者其他数据。参考<a href="https://zhuanlan.zhihu.com/p/136880546">指针函数和函数指针</a>。里面有详细的介绍。</p><h3 id="用自动变量（分配在栈上）作为pthread-exit的参数时出现的问题。"><a href="#用自动变量（分配在栈上）作为pthread-exit的参数时出现的问题。" class="headerlink" title="用自动变量（分配在栈上）作为pthread_exit的参数时出现的问题。"></a>用自动变量（分配在栈上）作为pthread_exit的参数时出现的问题。</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span> &#123;</span><br><span class="hljs-type">int</span> a, b, c, d;<br>&#125;;<br><span class="hljs-type">void</span><br><span class="hljs-title function_">printfoo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *s, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> foo *fp)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, s);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  structure at 0x%lx\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)fp);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  foo.a = %d\n&quot;</span>, fp-&gt;a);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  foo.b = %d\n&quot;</span>, fp-&gt;b);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  foo.c = %d\n&quot;</span>, fp-&gt;c);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  foo.d = %d\n&quot;</span>, fp-&gt;d);<br>&#125;<br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">thr_fn1</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span><span class="hljs-title">foo</span> =</span> &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;;<br><br>printfoo(<span class="hljs-string">&quot;thread 1:\n&quot;</span>, &amp;foo);<br>pthread_exit((<span class="hljs-type">void</span> *)&amp;foo);<br>&#125;<br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">thr_fn2</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;thread 2: ID is %lu\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)pthread_self());<br>pthread_exit((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>err;<br><span class="hljs-type">pthread_t</span>tid1, tid2;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span>*<span class="hljs-title">fp</span>;</span><br><br>err = pthread_create(&amp;tid1, <span class="hljs-literal">NULL</span>, thr_fn1, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t create thread 1&quot;</span>);<br>err = pthread_join(tid1, (<span class="hljs-type">void</span> *)&amp;fp);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t join with thread 1&quot;</span>);<br>sleep(<span class="hljs-number">1</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;parent starting second thread\n&quot;</span>);<br>err = pthread_create(&amp;tid2, <span class="hljs-literal">NULL</span>, thr_fn2, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br>err_exit(err, <span class="hljs-string">&quot;can&#x27;t create thread 2&quot;</span>);<br>sleep(<span class="hljs-number">1</span>);<br>printfoo(<span class="hljs-string">&quot;parent:\n&quot;</span>, fp);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc63633f81f7e3bd97eddaa.jpg"></p><h4 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h4><p>这是macos上的输出，每个操作系统的输出不一定相同。<br>在这里，在第41行调用tid1线程时将fp进行了初始化，但是调用结束之后内存就回收了，因此被覆盖了。在第50行再次被调用时已经没有办法显示原来的值了。</p><h2 id="3-线程的取消"><a href="#3-线程的取消" class="headerlink" title="3 线程的取消"></a>3 线程的取消</h2><p>函数：pthread_cancel();</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cancel</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> tid)</span>;<br></code></pre></td></tr></table></figure><p>在默认情况下，pthread_cancel函数会使得tid表示的线程的行为表现为如同调用了PTHREAD_CANCELED和pthread_exit函数，但是，线程可以选择忽略取消或者控制如何被取消。<br>注意：pthread_cancel并不等于线程终止，它仅仅提出请求。</p><h3 id="取消两种状态"><a href="#取消两种状态" class="headerlink" title="取消两种状态"></a>取消两种状态</h3><p>1.允许<br>   允许取消也分为两种：</p><ul><li>异步cancel，推迟cancel（默认）-&gt;推迟至cancel点在响应，也就是说不到cancel点是不会直接取消的。<br> cancel点：就是允许cancel的位置</li><li>同步cancel</li></ul><p>2.不允许</p><h2 id="3-线程清理处理程序"><a href="#3-线程清理处理程序" class="headerlink" title="3 线程清理处理程序"></a>3 线程清理处理程序</h2><p>线程可以安排它推出时需要调用的函数，这与进程在退出时可以用atexit函数安排退出是类似的。这样的函数称为线程清理处理程序。<br>一个线程可以建立多个线程处理程序，处理程序记录在栈中，也就是说，它们的执行顺序与它们注册时相反。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">pthread_cleanup_push</span><span class="hljs-params">(<span class="hljs-type">void</span> (*rtn)(<span class="hljs-type">void</span> *), <span class="hljs-type">void</span> *arg)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">pthread_cleanup_pop</span><span class="hljs-params">(<span class="hljs-type">int</span> execute)</span>;<br></code></pre></td></tr></table></figure><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">cleanup_func</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-built_in">puts</span>(p);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">func</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Thread is woking&quot;</span>);<br>    pthread_cleanup_push(cleanup_func, <span class="hljs-string">&quot;Cleanup:1&quot;</span>);<br>    pthread_cleanup_push(cleanup_func, <span class="hljs-string">&quot;Cleanup:2&quot;</span>);<br>    pthread_cleanup_push(cleanup_func, <span class="hljs-string">&quot;Cleanup:3&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;push over\n&quot;</span>) ;<br>    pthread_cleanup_pop(<span class="hljs-number">1</span>);<br>    pthread_cleanup_pop(<span class="hljs-number">1</span>);<br>    pthread_cleanup_pop(<span class="hljs-number">1</span>);<br>    pthread_exit(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">pthread_t</span> tid;<br>    <span class="hljs-type">int</span> err;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Begin&quot;</span>);<br>    err = pthread_create(&amp;tid,<span class="hljs-literal">NULL</span>,func,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span>(err)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-string">&quot;stderr,pthread_create():%s\n&quot;</span>, strerror(err));<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    pthread_join(tid,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;End&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><img src="https://pic.downk.cc/item/5fc63694f81f7e3bd97f2e70.jpg" style="zoom:50%;" />  可以看到，退出时会依次执行三个退出时我们所需要调用的函数。并且执行顺序与注册时相反。<h3 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h3><p>来看两种特殊情况，</p><ol><li>我们将弹出栈pop的三行设置如下：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">pthread_cleanup_pop(<span class="hljs-number">1</span>);<br>pthread_cleanup_pop(<span class="hljs-number">0</span>);<br>pthread_cleanup_pop(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>此时会只有一个输出，如下：<br><img src="https://pic.downk.cc/item/5fc636fdf81f7e3bd97f4fbb.jpg"><br>可以看到只有最后一次push的值输出的。其余的都没有输出</li><li>若我们将上面的三行放到pthread_exit(NULL)之后，那么理论上是看不到的，但是因为线程没办法看到，所以pop值全部默认为1！！<br><img src="https://pic.downk.cc/item/5fc6361ff81f7e3bd97eda2f.jpg"><br>此时的输出为：<br><img src="https://pic.downk.cc/item/5fc63616f81f7e3bd97ed8a2.jpg"><br>并且即使看不见，也必须在程序里体现，因为在宏定义中push里有一个{，而}在pop中，因此必须得成对出现，数量相同。</li></ol><h3 id="cancel点"><a href="#cancel点" class="headerlink" title="cancel点"></a>cancel点</h3><p>在POSIX标准中，只有在cancel点才会执行阻塞系统调用</p><h1 id="3-线程竞争"><a href="#3-线程竞争" class="headerlink" title="3 线程竞争"></a>3 线程竞争</h1><h2 id="竞争示例"><a href="#竞争示例" class="headerlink" title="竞争示例"></a>竞争示例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LEFT 30000000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> RIGHT 30000200</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> THRNUM (RIGHT - LEFT + 1)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">the_primer</span> <span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>;     <span class="hljs-comment">//这行必不可少，否则第17行会报错，因为无法检测到该函数</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">pthread_t</span> tid[THRNUM];<br>    <span class="hljs-type">int</span> err;<br>    <span class="hljs-keyword">for</span>(i = LEFT; i &lt;= RIGHT; i++)&#123;<br>        err = pthread_create(tid + i - LEFT,<span class="hljs-literal">NULL</span>, the_primer, &amp;i);<br>        <span class="hljs-keyword">if</span>(err)&#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;pthread_create(): %s\n&quot;</span>, strerror(err));<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//上面创建了200个进程来进行运算</span><br>    <span class="hljs-keyword">for</span>(i = LEFT; i &lt;= RIGHT; i++)<br>        pthread_join(tid[i - LEFT], <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">the_primer</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-type">int</span> i,j,mark;<br>    i = *(<span class="hljs-type">int</span> *)p;<br>    mark = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">2</span>; j &lt; i/<span class="hljs-number">2</span>; j++)&#123;<br>        <span class="hljs-keyword">if</span>(i % j == <span class="hljs-number">0</span>)&#123;<br>            mark = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(mark)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d is a primer\n&quot;</span>, i);<br>    &#125;<br>    pthread_exit(<span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc636c3f81f7e3bd97f43ae.jpg"></p><p>解析：</p><p>可以看到，这个函数的目的是将30000000到30000200中的所有质数打印。但是出来的结果却是完全不同的，这是因为多个线程出现了竞争。200个进程有共享的数据，并且没有加以保护。200个指针都指向了同一个地址空间。</p><h3 id="程序改进方法1"><a href="#程序改进方法1" class="headerlink" title="程序改进方法1"></a>程序改进方法1</h3><p>我们知道，这个程序错误的原因是我们用的是引用传递，也就是传入的是i的引用，所以有可能让多个线程同时指向i的地址。那么我们就不用引用传递，而采用值传递。<br>注意：这个方法不好，多次采用强制转换</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LEFT 30000000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> RIGHT 30000200</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> THRNUM (RIGHT - LEFT + 1)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">the_primer</span> <span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">pthread_t</span> tid[THRNUM];<br>    <span class="hljs-type">int</span> err;<br><br>    <span class="hljs-keyword">for</span>(i = LEFT; i &lt;= RIGHT; i++)&#123;<br>        err = pthread_create(tid + i - LEFT,<span class="hljs-literal">NULL</span>, the_primer, i);<br>        <span class="hljs-keyword">if</span>(err)&#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;pthread_create(): %s\n&quot;</span>, strerror(err));<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(i = LEFT; i &lt;= RIGHT; i++)<br>        pthread_join(tid[i - LEFT], <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">the_primer</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-type">int</span> i,j,mark;<br>    i = (<span class="hljs-type">int</span>)p;<br>    mark = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">2</span>; j &lt; i/<span class="hljs-number">2</span>; j++)&#123;<br>        <span class="hljs-keyword">if</span>(i % j == <span class="hljs-number">0</span>)&#123;<br>            mark = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(mark)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d is a primer\n&quot;</span>, i);<br>    &#125;<br>    pthread_exit(<span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc6371af81f7e3bd97f56a3.jpg"></p><h3 id="方法2（结构体）"><a href="#方法2（结构体）" class="headerlink" title="方法2（结构体）"></a>方法2（结构体）</h3><p>让201个i指向不同的空间，方法是定义一个结构体。值得注意的是，最后应该将malloc产生的指针释放掉，避免内存泄露</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LEFT 30000000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> RIGHT 30000200</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> THRNUM (RIGHT - LEFT + 1)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">the_primer</span> <span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">thr_args_st</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int</span> n;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">pthread_t</span> tid[THRNUM];<br>    <span class="hljs-type">int</span> err;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">thr_args_st</span> *<span class="hljs-title">p</span>;</span><br>    <span class="hljs-type">void</span> *ptr;          <span class="hljs-comment">//作用是用来接收返回的指针，并且进行销毁。保证malloc和free在一个模块中</span><br><br>    <span class="hljs-keyword">for</span>(i = LEFT; i &lt;= RIGHT; i++)&#123;<br>        p = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(*p));<br>        <span class="hljs-keyword">if</span>(p == <span class="hljs-literal">NULL</span>)&#123;<br>            perror(<span class="hljs-string">&quot;malloc()&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        p-&gt;n=i;<br><br><br>        err = pthread_create(tid + i - LEFT,<span class="hljs-literal">NULL</span>, the_primer,p);<br>        <span class="hljs-keyword">if</span>(err)&#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;pthread_create(): %s\n&quot;</span>, strerror(err));<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(i = LEFT; i &lt;= RIGHT; i++)<br>    &#123;<br>        pthread_join(tid[i - LEFT], ptr);<br>        <span class="hljs-built_in">free</span>(ptr);<br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">the_primer</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    <span class="hljs-type">int</span> i,j,mark;<br><br>    i = ((<span class="hljs-keyword">struct</span> thr_args_st *)p)-&gt;n;<br>    <span class="hljs-built_in">free</span>(p);<br>    mark = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">2</span>; j &lt; i/<span class="hljs-number">2</span>; j++)&#123;<br>        <span class="hljs-keyword">if</span>(i % j == <span class="hljs-number">0</span>)&#123;<br>            mark = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(mark)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d is a primer\n&quot;</span>, i);<br>    &#125;<br>    pthread_exit(&amp;p);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc63645f81f7e3bd97ee139.jpg"></p><p>解析：</p><p>最终返回了一个指针并且在返回之后free，目的就是让malloc和free一一对应，能在同一个模块中。</p><h2 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h2><p>因为这块涉及大量C++的知识，我还掌握不是很好，打算今天下午开始学习C++这方面的内容，给出更详细的解释。</p><h1 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h1><h2 id="互斥量"><a href="#互斥量" class="headerlink" title="互斥量"></a>互斥量</h2><p>可以用互斥接口来保护数据，确保同一时间只有一个线程访问数据。互斥量从本质来说就是一把锁，在访问数据的时候进行加锁，阻止其他线程的访问，在访问完成后释放互斥量。</p><p>互斥变量是用pthread_mutex_t数据类型表示的。在使用互斥变量之前先进行初始化<br>如下所示：</p><h3 id="pthread-mutex-init-和-pthread-mutex-destory"><a href="#pthread-mutex-init-和-pthread-mutex-destory" class="headerlink" title="pthread_mutex_init 和 pthread_mutex_destory"></a>pthread_mutex_init 和 pthread_mutex_destory</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutex_init</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span> *<span class="hljs-keyword">restrict</span> mutex,</span><br><span class="hljs-params">                     <span class="hljs-type">const</span> <span class="hljs-type">pthread_mutexattr_t</span> *<span class="hljs-keyword">restrict</span> attr)</span>;<br>                     <span class="hljs-comment">//初始化</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutex_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span> *mutex)</span>;<br>                     <span class="hljs-comment">//销毁</span><br></code></pre></td></tr></table></figure><h4 id="注意-4"><a href="#注意-4" class="headerlink" title="注意"></a>注意</h4><p>如果动态分配内存（malloc），在释放内存前需要调用detroy</p><h3 id="加锁和解锁互斥变量"><a href="#加锁和解锁互斥变量" class="headerlink" title="加锁和解锁互斥变量"></a>加锁和解锁互斥变量</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutex_lock</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span> *mutex)</span>;       <span class="hljs-comment">//加锁</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutex_trylock</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span> *mutex)</span>;    <span class="hljs-comment">//尝试加锁</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutex_unlock</span><span class="hljs-params">(<span class="hljs-type">pthread_mutex_t</span> *mutex)</span>;     <span class="hljs-comment">//解锁</span><br></code></pre></td></tr></table></figure><h3 id="举例（自己）"><a href="#举例（自己）" class="headerlink" title="举例（自己）"></a>举例（自己）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> res = <span class="hljs-number">0</span>;<br><span class="hljs-type">pthread_t</span> ntid;<br><span class="hljs-type">pthread_t</span> tid[<span class="hljs-number">5</span>];<br><span class="hljs-type">pthread_mutex_t</span> f_lock[<span class="hljs-number">5</span>];<br><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span>&#123;<br>    res++;<br>    <span class="hljs-keyword">return</span> ((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>);<br>&#125;<br><br><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">thr_fun</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>&#123;<br>    <span class="hljs-keyword">return</span> ((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">int</span> err;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i= <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)&#123;<br>        pthread_mutex_init(f_lock + i, <span class="hljs-literal">NULL</span>);<br>        pthread_mutex_lock(f_lock + i);<br>        err = pthread_create(&amp;ntid, <span class="hljs-literal">NULL</span>, add, <span class="hljs-literal">NULL</span>);<br>        <span class="hljs-keyword">if</span>(err != <span class="hljs-number">0</span>)&#123;<br>            err_exit(err, <span class="hljs-string">&quot;can&#x27;t create thread&quot;</span>);<br>        &#125;<br>        pthread_mutex_unlock(f_lock + i);<br>    &#125;<br>    sleep(<span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;res=%d\n&quot;</span>, res);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc63669f81f7e3bd97eec50.jpg"></p><p>解析：</p><p>第33行的sleep(1)比不可少，否则可能会导致main进程先结束，main进程一旦结束所有线程都会摧毁。<br>思路是在调动add函数来进行res的+1操作时先初始化一个互斥变量并且加锁，这样别人就不能对add的地址进行操作的，操作完成之后再释放互斥量锁。</p><h2 id="举例（书11-10）"><a href="#举例（书11-10）" class="headerlink" title="举例（书11.10）"></a>举例（书11.10）</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span> &#123;</span><br><span class="hljs-type">int</span>             f_count;<br><span class="hljs-type">pthread_mutex_t</span> f_lock;<br><span class="hljs-type">int</span>             f_id;<br><span class="hljs-comment">/* ... more stuff here ... */</span><br>&#125;;<br><br><span class="hljs-keyword">struct</span> foo *<br><span class="hljs-title function_">foo_alloc</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> <span class="hljs-comment">/* allocate the object */</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span> *<span class="hljs-title">fp</span>;</span><br><br><span class="hljs-keyword">if</span> ((fp = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> foo))) != <span class="hljs-literal">NULL</span>) &#123;<br>fp-&gt;f_count = <span class="hljs-number">1</span>;<br>fp-&gt;f_id = id;<br><span class="hljs-keyword">if</span> (pthread_mutex_init(&amp;fp-&gt;f_lock, <span class="hljs-literal">NULL</span>) != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">free</span>(fp);<br><span class="hljs-keyword">return</span>(<span class="hljs-literal">NULL</span>);<br>&#125;<br><span class="hljs-comment">/* ... continue initialization ... */</span><br>&#125;<br><span class="hljs-keyword">return</span>(fp);<br>&#125;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">foo_hold</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> foo *fp)</span> <span class="hljs-comment">/* add a reference to the object */</span><br>&#123;<br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br>fp-&gt;f_count++;<br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>&#125;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">foo_rele</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> foo *fp)</span> <span class="hljs-comment">/* release a reference to the object */</span><br>&#123;<br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br><span class="hljs-keyword">if</span> (--fp-&gt;f_count == <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">/* last reference */</span><br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>pthread_mutex_destroy(&amp;fp-&gt;f_lock);<br><span class="hljs-built_in">free</span>(fp);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>引用计数是一种古老的内存管理计数，很简单，但是非常有效，性能也很高，上面就是一种C语言下的引用计数，当然，我们可以将函数以函数指针的形式放置在结构体中，这里就不弄了。<br>可以看到，结构体非常简单，就一个引用计数成员、互斥量和数据成员，使用foo_alloc函数分配空间，并且在其中初始化互斥量，在foo_alloc函数中我们并没有使用互斥量，因为初始化完毕前分配线程是唯一的能使用的线程。但是在这里例子中，如果一个线程调用foo_rele释放引用，但是在此期间另一个线程使用foo_hold阻塞了，等第一个线程调用完毕，引用变为0，并且内存被回收，然后就会导致崩溃。<br>这里参考了<a href="https://segmentfault.com/a/1190000004579921">网上的资料</a>。</p><h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>线程试图对同一个互斥量加锁两次，那么它就会陷入死锁循环。</p><h3 id="产生条件"><a href="#产生条件" class="headerlink" title="产生条件"></a>产生条件</h3><ol><li>线程对同一个互斥量加锁两次</li><li>A和B的锁相互占用。</li></ol><h3 id="如何避免"><a href="#如何避免" class="headerlink" title="如何避免"></a>如何避免</h3><p>方法1：多次上锁时让上锁的顺序需要和加锁的顺序相同。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NHASH 29</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH(id) (((unsigned long)id)%NHASH)</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span> *<span class="hljs-title">fh</span>[<span class="hljs-title">NHASH</span>];</span><br><br><span class="hljs-type">pthread_mutex_t</span> hashlock = PTHREAD_MUTEX_INITIALIZER;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span> &#123;</span><br><span class="hljs-type">int</span>             f_count;<br><span class="hljs-type">pthread_mutex_t</span> f_lock;<br><span class="hljs-type">int</span>             f_id;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span>     *<span class="hljs-title">f_next</span>;</span> <span class="hljs-comment">/* protected by hashlock */</span><br><span class="hljs-comment">/* ... more stuff here ... */</span><br>&#125;;<br><br><span class="hljs-keyword">struct</span> foo *<br><span class="hljs-title function_">foo_alloc</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> <span class="hljs-comment">/* allocate the object */</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span>*<span class="hljs-title">fp</span>;</span><br><span class="hljs-type">int</span>idx;<br><br><span class="hljs-keyword">if</span> ((fp = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> foo))) != <span class="hljs-literal">NULL</span>) &#123;<br>fp-&gt;f_count = <span class="hljs-number">1</span>;<br>fp-&gt;f_id = id;<br><span class="hljs-keyword">if</span> (pthread_mutex_init(&amp;fp-&gt;f_lock, <span class="hljs-literal">NULL</span>) != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">free</span>(fp);<br><span class="hljs-keyword">return</span>(<span class="hljs-literal">NULL</span>);<br>&#125;<br>idx = HASH(id);<br>pthread_mutex_lock(&amp;hashlock);<br>fp-&gt;f_next = fh[idx];<br>fh[idx] = fp;<br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br>pthread_mutex_unlock(&amp;hashlock);<br><span class="hljs-comment">/* ... continue initialization ... */</span><br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>&#125;<br><span class="hljs-keyword">return</span>(fp);<br>&#125;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">foo_hold</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> foo *fp)</span> <span class="hljs-comment">/* add a reference to the object */</span><br>&#123;<br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br>fp-&gt;f_count++;<br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>&#125;<br><br><span class="hljs-keyword">struct</span> foo *<br><span class="hljs-title function_">foo_find</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> <span class="hljs-comment">/* find an existing object */</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span>*<span class="hljs-title">fp</span>;</span><br><br>pthread_mutex_lock(&amp;hashlock);<br><span class="hljs-keyword">for</span> (fp = fh[HASH(id)]; fp != <span class="hljs-literal">NULL</span>; fp = fp-&gt;f_next) &#123;<br><span class="hljs-keyword">if</span> (fp-&gt;f_id == id) &#123;<br>foo_hold(fp);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>pthread_mutex_unlock(&amp;hashlock);<br><span class="hljs-keyword">return</span>(fp);<br>&#125;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">foo_rele</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> foo *fp)</span> <span class="hljs-comment">/* release a reference to the object */</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">foo</span>*<span class="hljs-title">tfp</span>;</span><br><span class="hljs-type">int</span>idx;<br><br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br><span class="hljs-keyword">if</span> (fp-&gt;f_count == <span class="hljs-number">1</span>) &#123; <span class="hljs-comment">/* last reference */</span><br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>pthread_mutex_lock(&amp;hashlock);<br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br><span class="hljs-comment">/* need to recheck the condition */</span><br><span class="hljs-keyword">if</span> (fp-&gt;f_count != <span class="hljs-number">1</span>) &#123;<br>fp-&gt;f_count--;<br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>pthread_mutex_unlock(&amp;hashlock);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-comment">/* remove from list */</span><br>idx = HASH(fp-&gt;f_id);<br>tfp = fh[idx];<br><span class="hljs-keyword">if</span> (tfp == fp) &#123;<br>fh[idx] = fp-&gt;f_next;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">while</span> (tfp-&gt;f_next != fp)<br>tfp = tfp-&gt;f_next;<br>tfp-&gt;f_next = fp-&gt;f_next;<br>&#125;<br>pthread_mutex_unlock(&amp;hashlock);<br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>pthread_mutex_destroy(&amp;fp-&gt;f_lock);<br><span class="hljs-built_in">free</span>(fp);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fp-&gt;f_count--;<br>pthread_mutex_unlock(&amp;fp-&gt;f_lock);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，在函数foo_alloc中，有这样一段：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">pthread_mutex_lock(&amp;hashlock);<br>fp-&gt;f_next = fh[idx];<br>fh[idx] = fp;<br>pthread_mutex_lock(&amp;fp-&gt;f_lock);<br>pthread_mutex_unlock(&amp;hashlock);<br>pthread_mutex_unlock[&amp;fp-&gt;f_lock);<br></code></pre></td></tr></table></figure><p>在这里对同一个互斥量上了两次锁，因此解锁时两次锁的顺序需要是相同的。<br>比较图 11-11 和图 11-10，可以看出，分配函数现在锁住了散列列表锁，把新的结构添加到了散列桶中，而且在对散列列表的锁解锁之前，先锁定了新结构中的互斥量。因为新的结构是放在全局列表中的，其他线程可以找到它，所以在初始化完成之前，需要阻塞其他线程试图访问新结构。<br>foo_find函数锁住散列列表锁，然后搜索被请求的结构。如果找到了，就增加其引用计数并返回指向该结构的指针。注意，加锁的顺序是，先在foo_find函数中锁定散列列表锁，然后再在foo_hold函数中锁定foo结构中的f_lock互斥量。<br>现在有了两个锁以后，foo_rele函数就变得更加复杂了。如果这是最后一个引用，就需要对这个结构互斥量进行解锁，因为我们需要从散列列表中删除这个结构，这样才可以获取散列列表锁，然后重新获取结构互斥量。从上一次获得结构互斥量以来我们可能被阻塞着，所以需要重新检查条件，判断是否还需要释放这个结构。如果另一个线程在我们为满足锁顺序而阻塞时发现了这个结构并对其引用计数加1，那么只需要简单地对整个引用计数减1，对所有的东西解锁，然后返回。</p><p>这种锁方法很复杂，所以我们需要重新审视原来的设计。我们也可以使用散列列表锁来保护结构引用计数，使事情大大简化。结构互斥量可以用于保护foo结构中的其他任何东西。图11-12反映了这种变化。</p><h1 id="5-条件变量"><a href="#5-条件变量" class="headerlink" title="5 条件变量"></a>5 条件变量</h1><p>条件变量是线程可用的另一种同步机制。条件变量给多个线程提供了一个会合的场所。条件变量与互斥量一起使用时，允许线程以无竞争的方式等待特定的条件发生。</p><p>条件本身是由互斥量保护的。线程在改变条件状态之前必须首先锁住互斥量。其他线程在获得互斥量之前不会察觉到这种改变，因为互斥量必须在锁定以后才能计算条件。</p><p>在使用条件变量之前，必须先对它进行初始化。由pthread_cond_t数据类型表示的条件变量可以用两种方式进行初始化，可以把常量PTHREAD_COND_INITIALIZER赋给静态分配的条件变量，但是如果条件变量是动态分配的，则需要使用pthread_cond_init函数对它进行初始化。</p><p>在释放条件变量底层的内存空间之前，可以使用pthread_cond_destroy函数对条件变量进行反初始化（deinitialize）。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cond_init</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span> *<span class="hljs-keyword">restrict</span> cond, <span class="hljs-type">const</span> <span class="hljs-type">pthread_condattr_t</span> *<span class="hljs-keyword">restrict</span> attr)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cond_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span> *cond)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>除非需要创建一个具有非默认属性的条件变量，否则pthread_cond_init函数的attr参数可以设置为NULL。我们将在12.4.3节中讨论条件变量属性。</p><p>我们使用pthread_cond_wait等待条件变量变为真。如果在给定的时间内条件不能满足，那么会生成一个返回错误码的变量。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cond_wait</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span> *<span class="hljs-keyword">restrict</span> cond, <span class="hljs-type">pthread_mutex_t</span> *<span class="hljs-keyword">restrict</span> mutex)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cond_timedwait</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span> *restrictcond, <span class="hljs-type">pthread_mutex_t</span> *<span class="hljs-keyword">restrict</span> mutex,<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> timespec *<span class="hljs-keyword">restrict</span> tsptr)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>传递给pthread_cond_wait的互斥量对条件进行保护。调用者把锁住的互斥量传给函数，函数然后自动把调用线程放到等待条件的线程列表上，对互斥量解锁。这就关闭了条件检查和线程进入休眠状态等待条件改变这两个操作之间的时间通道，这样线程就不会错过条件的任何变化。pthread_cond_wait返回时，互斥量再次被锁住。</p><p>pthread_cond_timedwait函数的功能与pthread_cond_wait函数相似，只是多了一个超时（tsptr）。超时值指定了我们愿意等待多长时间，它是通过timespec结构指定的。</p><p>如图11-13所示，需要指定愿意等待多长时间，这个时间值是一个绝对数而不是相对数。例如，假设愿意等待3分钟。那么，并不是把3分钟转换成timespec结构，而是需要把当前时间加上3分钟再转换成timespec结构。</p><p>可以使用clock_gettime函数（见6.10节）获取timespec结构表示的当前时间。但是目前并不是所有的平台都支持这个函数，因此，也可以用另一个函数 gettimeofday 获取timeval结构表示的当前时间，然后把这个时间转换成timespec结构。要得到超时值的绝对时间，可以使用下面的函数（假设阻塞的最大时间使用分来表示的）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">maketimeout</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> timespec *tsp, <span class="hljs-type">long</span> minutes)</span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">now</span>;</span><br>    <span class="hljs-comment">/* get the current time */</span><br>    gettimeofday(&amp;now, <span class="hljs-literal">NULL</span>);<br>    tsp-&gt;tv_sec = now.tv_sec;<br>    tsp-&gt;tv_nsec = now.tv_usec * <span class="hljs-number">1000</span>; <span class="hljs-comment">/* usec to nsec*/</span><br>    <span class="hljs-comment">/* add the offset to get timeout value */</span><br>    tsp-&gt;tv_sec += minutes * <span class="hljs-number">60</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>如果超时到期时条件还是没有出现，pthread_cond_timewait 将重新获取互斥量，然后返回错误ETIMEDOUT。从pthread_cond_wait或者pthread_cond_timedwait调用成功返回时，线程需要重新计算条件，因为另一个线程可能已经在运行并改变了条件。</p><p>有两个函数可以用于通知线程条件已经满足。pthread_cond_signal函数至少能唤醒一个等待该条件的线程，而pthread_cond_broadcast函数则能唤醒等待该条件的所有线程。</p><p>POSIX 规范为了简化pthread_cond_signal的实现，允许它在实现的时候唤醒一个以上的线程。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cond_signal</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span> *cond)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_cond_broadcast</span><span class="hljs-params">(<span class="hljs-type">pthread_cond_t</span> *cond)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>在调用pthread_cond_signal或者pthread_cond_broadcast时，我们说这是在给线程或者条件发信号。必须注意，一定要在改变条件状态以后再给线程发信号。</p><h2 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg</span> *<span class="hljs-title">m_next</span>;</span><br><span class="hljs-comment">/* ... more stuff here ... */</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg</span> *<span class="hljs-title">workq</span>;</span><br><br><span class="hljs-type">pthread_cond_t</span> qready = PTHREAD_COND_INITIALIZER;<br><br><span class="hljs-type">pthread_mutex_t</span> qlock = PTHREAD_MUTEX_INITIALIZER;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">process_msg</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg</span> *<span class="hljs-title">mp</span>;</span><br><br><span class="hljs-keyword">for</span> (;;) &#123;<br>pthread_mutex_lock(&amp;qlock);<br><span class="hljs-keyword">while</span> (workq == <span class="hljs-literal">NULL</span>)<br>pthread_cond_wait(&amp;qready, &amp;qlock);<br>mp = workq;<br>workq = mp-&gt;m_next;<br>pthread_mutex_unlock(&amp;qlock);<br><span class="hljs-comment">/* now process the message mp */</span><br>&#125;<br>&#125;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">enqueue_msg</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> msg *mp)</span><br>&#123;<br>pthread_mutex_lock(&amp;qlock);<br>mp-&gt;m_next = workq;<br>workq = mp;<br>pthread_mutex_unlock(&amp;qlock);<br>pthread_cond_signal(&amp;qready);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/11fa974cf90d.html"/>
    <url>/2022/12/11fa974cf90d.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-线程属性"><a href="#1-线程属性" class="headerlink" title="1 线程属性"></a>1 线程属性</h1><p>回顾一下创建线程的函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_create</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> *<span class="hljs-keyword">restrict</span> tidp, </span><br><span class="hljs-params">         <span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span> *<span class="hljs-keyword">restrict</span> attr,</span><br><span class="hljs-params">         <span class="hljs-type">void</span> *(*star_rtn)(<span class="hljs-type">void</span> *) <span class="hljs-type">void</span> *<span class="hljs-keyword">restrict</span> arg)</span>;<br>         <span class="hljs-comment">// 返回值：若成功返回0，否则返回错误编号</span><br></code></pre></td></tr></table></figure><p>这里的第二个参数attr我们之前是默认的NULL，但是我们可以通过设置来确定自己所需要的属性。</p><h2 id="初始化和反初始化"><a href="#初始化和反初始化" class="headerlink" title="初始化和反初始化"></a>初始化和反初始化</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_init</span><span class="hljs-params">(<span class="hljs-type">pthread_attr_t</span> *attr)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_attr_t</span> *attr)</span>;<br></code></pre></td></tr></table></figure><p>在这里，pthread_attr_t是一个类，我们在需要设置自己的属性时，需要首先实例化，然后将这个对象进行初始化。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">pthread_attr_t</span> attr;<br><br>err = pthread_attr_init(&amp;attr);<br></code></pre></td></tr></table></figure><p>这样之后，我们就可以通过后面的相应函数设置attr，最后将attr放入create函数中就可以创建一个我们所需要的线程了。</p><h2 id="线程的分离状态属性"><a href="#线程的分离状态属性" class="headerlink" title="线程的分离状态属性"></a>线程的分离状态属性</h2><p>在之前我们学到过将线程分离。也就是说如果我们想要创建一个和原来线程没有任何关系的新线程，我们就需要将线程进行分离。之前的做法是先用默认属性构建一个新线程，后再调用函数。现在可以通过设置分离状态属性来直接创建一个分离状态的线程。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_getdetachstate</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span>*<span class="hljs-keyword">restrict</span> attr,<span class="hljs-type">int</span> *detachstate)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_setdetachstate</span><span class="hljs-params">(<span class="hljs-type">pthread_attr_t</span> *attr,<span class="hljs-type">int</span> *detachstate)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>可以调用pthread_attr_getdetachstate函数获取当前的detachstate线程属性。第二个参数所指向的整数要么设置成PTHREAD_CREATE_DETACHED，要么设置成 PTHREAD_CREATE_JOINABLE，具体要取决于给定pthread_attr_t结构中的属性值。</p><h3 id="直接创建分离状态的新线程（fig12-4"><a href="#直接创建分离状态的新线程（fig12-4" class="headerlink" title="直接创建分离状态的新线程（fig12.4)"></a>直接创建分离状态的新线程（fig12.4)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">makethread</span><span class="hljs-params">(<span class="hljs-type">void</span> *(*fn)(<span class="hljs-type">void</span> *), <span class="hljs-type">void</span> *arg)</span><br>&#123;<br><span class="hljs-type">int</span>err;<br><span class="hljs-type">pthread_t</span>tid;<br><span class="hljs-type">pthread_attr_t</span>attr;<br><br>err = pthread_attr_init(&amp;attr);<br><span class="hljs-keyword">if</span> (err != <span class="hljs-number">0</span>)<br><span class="hljs-keyword">return</span>(err);<br>err = pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);<br><span class="hljs-keyword">if</span> (err == <span class="hljs-number">0</span>)<br>err = pthread_create(&amp;tid, &amp;attr, fn, arg);<br>pthread_attr_destroy(&amp;attr);<br><span class="hljs-keyword">return</span>(err);<br>&#125;<br></code></pre></td></tr></table></figure><p>解释：可以看到，在这里先初始化并实例化了一个attr对象，然后通过pthread_attr_setdetachstate()来设置属性，最后通过这个属性进行实例化，这样就可以得到一个新的处于分离状态的线程了。</p><h2 id="栈相关"><a href="#栈相关" class="headerlink" title="栈相关"></a>栈相关</h2><p>可以通过下面两个函数来对线程栈进行管理</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_getstack</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span> *<span class="hljs-keyword">restrict</span> attr, </span><br><span class="hljs-params">         <span class="hljs-type">void</span> **<span class="hljs-keyword">restrict</span> stackaddr,<span class="hljs-type">size_t</span> *<span class="hljs-keyword">restrict</span> stacksize)</span>;<br>         <br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_setstack</span><span class="hljs-params">(<span class="hljs-type">pthread_attr_t</span> *attr,</span><br><span class="hljs-params">                <span class="hljs-type">void</span> *stackaddr, <span class="hljs-type">size_t</span> stacksize)</span>;<br>                <br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>对于进程来说，虚地址空间的大小是固定的。因为进程中只有一个栈，所以它的大小通常不是问题。但对于线程来说，同样大小的虚地址空间必须被所有的线程栈共享。如果应用程序使用了许多线程，以致这些线程栈的累计大小超过了可用的虚地址空间，就需要减少默认的线程栈大小。另一方面，如果线程调用的函数分配了大量的自动变量，或者调用的函数涉及许多很深的栈帧（stack frame），那么需要的栈大小可能要比默认的大。</p><p>应用程序也可以通过pthread_attr_getstacksize和pthread_attr_setstacksize函数读取或设置线程属性stacksize。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_getstacksize</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span>*<span class="hljs-keyword">restrict</span> attr, <span class="hljs-type">size_t</span> *<span class="hljs-keyword">restrict</span> stacksize)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_setstacksize</span> <span class="hljs-params">(<span class="hljs-type">pthread_attr_t</span> *attr,<span class="hljs-type">size_t</span> stacksize)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>如果希望改变默认的栈大小，但又不想自己处理线程栈的分配问题，这时使用pthread_attr_setstacksize函数就非常有用。设置stacksize属性时，选择的stacksize不能小于PTHREAD_STACK_MIN。<br>线程属性guardsize控制着线程栈末尾之后用以避免栈溢出的扩展内存的大小。这个属性默认值是由具体实现来定义的，但常用值是系统页大小。可以把guardsize线程属性设置为0，不允许属性的这种特征行为发生：在这种情况下，不会提供警戒缓冲区。同样，如果修改了线程属性stackaddr，系统就认为我们将自己管理栈，进而使栈警戒缓冲区机制无效，这等同于把guardsize线程属性设置为0。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_getguardsize</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_attr_t</span>*<span class="hljs-keyword">restrict</span> attr,<span class="hljs-type">size_t</span> *<span class="hljs-keyword">restrict</span> guardsize)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_attr_setguardsize</span><span class="hljs-params">(<span class="hljs-type">pthread_attr_t</span> *attr,<span class="hljs-type">size_t</span> guardsize)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>如果guardsize线程属性被修改了，操作系统可能会把它取为页大小的整数倍。如果线程的栈指针溢出到警戒区域，应用程序就可能通过信号接收到出错信息。<br>Single UNIX Specification还定义了一些其他的可选线程属性供实时应用程序使用，但在这里不讨论这些属性。<br>线程还有一些其他的pthread_attr_t结构中没有表示的属性：可撤销状态和可撤销类型。我们将在12.7节中讨论它们。</p><h1 id="2-线程同步的属性"><a href="#2-线程同步的属性" class="headerlink" title="2 线程同步的属性"></a>2 线程同步的属性</h1><h2 id="互斥量属性"><a href="#互斥量属性" class="headerlink" title="互斥量属性"></a>互斥量属性</h2><p>互斥量属性是用pthread_mutexattr_t结构表示的。和线程属性是很类似的。</p><h3 id="初始化和反初始化-1"><a href="#初始化和反初始化-1" class="headerlink" title="初始化和反初始化"></a>初始化和反初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_init</span><span class="hljs-params">(<span class="hljs-type">pthread_mutexattr_t</span> *attr)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_mutexattr_t</span>*attr)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><h3 id="值得注意的属性"><a href="#值得注意的属性" class="headerlink" title="值得注意的属性"></a>值得注意的属性</h3><ol><li>进程共享属性:确定是否进程间可以共享该互斥量</li><li>健壮属性</li><li>类型属性</li></ol><h4 id="1-共享属性"><a href="#1-共享属性" class="headerlink" title="1. 共享属性"></a>1. 共享属性</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_getpshared</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_mutexattr_t</span>*<span class="hljs-keyword">restrict</span> attr,<span class="hljs-type">int</span> *<span class="hljs-keyword">restrict</span> pshared)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_setpshared</span><span class="hljs-params">(pthread_mutex-<span class="hljs-type">attr_t</span> *attr,<span class="hljs-type">int</span> pshared)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>进程共享互斥量属性设置为PTHREAD_PROCESS_PRIVATE时，允许pthread线程库提供更有效的互斥量实现，这在多线程应用程序中是默认的情况。在多个进程共享多个互斥量的情况下， pthread线程库可以限制开销较大的互斥量实现。<br>互斥量健壮属性与在多个进程间共享的互斥量有关。这意味着，当持有互斥量的进程终止时，需要解决互斥量状态恢复的问题。这种情况发生时，互斥量处于锁定状态，恢复起来很困难。其他阻塞在这个锁的进程将会一直阻塞下去。</p><h4 id="2-健壮属性"><a href="#2-健壮属性" class="headerlink" title="2. 健壮属性"></a>2. 健壮属性</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_getrobust</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_mutexattr_t</span>*<span class="hljs-keyword">restrict</span> attr,<span class="hljs-type">int</span> *<span class="hljs-keyword">restrict</span> robust)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_setrobust</span><span class="hljs-params">(pthread_mutex-<span class="hljs-type">attr_t</span> *attr,<span class="hljs-type">int</span> robust)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>健壮属性取值有两种可能的情况。</p><ol><li>默认值是 PTHREAD_MUTEX_STALLED，这意味着持有互斥量的进程终止时不需要采取特别的动作。这种情况下，使用互斥量后的行为是未定义的，等待该互斥量解锁的应用程序会被有效地“拖住”。</li><li>另一个取值是PTHREAD_MUTEX_ROBUST。这个值将导致线程调用pthread_mutex_lock获取锁，而该锁被另一个进程持有，但它终止时并没有对该锁进行解锁，此时线程会阻塞，从pthread_mutex_lock返回的值为EOWNERDEAD而不是0。应用程序可以通过这个特殊的返回值获知，若有可能（要保护状态的细节以及如何进行恢复会因不同的应用程序而异），不管它们保护的互斥量状态如何，都需要进行恢复。</li></ol><p>使用健壮的互斥量改变了我们使用pthread_mutex_lock的方式，因为现在必须检查3个返回值而不是之前的两个：不需要恢复的成功、需要恢复的成功以及失败。但是，即使不用健壮的互斥量，也可以只检查成功或者失败。</p><h4 id="3-类型属性"><a href="#3-类型属性" class="headerlink" title="3. 类型属性"></a>3. 类型属性</h4><p>POSIX.1定义了4中类型：</p><ul><li>PTHREAD_MUTEX_NORMAL:一种标准互斥量类型，不做任何特殊的错误检查或死锁检测。.</li><li>PTHREAD_MUTEX_ERRORCHECK:此互斥量类型提供错误检查。</li><li>PTHREAD_MUTEX_RECURSIVE:此互斥量类型允许同一线程在互斥量解锁之前对该互斥量进行多次加锁。递归互斥量维护锁的计数，在解锁次数和加锁次数不相同的情况下，不会释放锁。所以，如果对一个递归互斥量加锁两次，然后解锁一次，那么这个互斥量将依然处于加锁状态，对它再次解锁以前不能释放该锁。</li><li>PTHREAD_MUTEX_DEFAULT:此互斥量类型可以提供默认特性和行为。操作系统在实现它的时候可以把这种类型自由地映射到其他互斥量类型中的一种。例如，Linux3.2.0把这种类型映射为普通的互斥量类型，而FreeBSD 8.0则把它映射为错误检查互斥量类型。</li></ul><h4 id="总结如下图："><a href="#总结如下图：" class="headerlink" title="总结如下图："></a>总结如下图：</h4><p><img src="https://pic.downk.cc/item/5fc636a7f81f7e3bd97f3e3a.jpg"><br>“不占用时解锁”这一栏指的是，一个线程对被另一个线程加锁的互斥量进行解锁的情况。“在已解锁时解锁”这一栏指的是，当一个线程对已经解锁的互斥量进行解锁时将会发生什么，这通常是编码错误引起的。</p><p>得到和修改互斥量类型属性：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_gettype</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_mutexattr_t</span>*<span class="hljs-keyword">restrict</span> attr, <span class="hljs-type">int</span>*<span class="hljs-keyword">restrict</span> type)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_mutexattr_settype</span><span class="hljs-params">(<span class="hljs-type">pthread_mutexattr_t</span>*attr, <span class="hljs-type">int</span> type)</span>;<br><span class="hljs-comment">//两个函数的返回值: 若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>得到的修改的方式和之前进程属性完全相同。</p><h2 id="读写锁属性"><a href="#读写锁属性" class="headerlink" title="读写锁属性"></a>读写锁属性</h2><p>读写锁与互斥量类似，也是有属性的。可以用pthread_rwlockattr_init 初始化pthread_rwlockattr_t结构，用pthread_rwlockattr_destroy反初始化该结构。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_rwlockattr_init</span><span class="hljs-params">(<span class="hljs-type">pthread_rwlockattr_t</span> *attr)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_rwlockattr_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_rwlockattr_t</span>*attr)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>读写锁支持的唯一属性是进程共享属性。它与互斥量的进程共享属性是相同的。就像互斥量的进程共享属性一样，有一对函数用于读取和设置读写锁的进程共享属性。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_rwlockattr_getpshared</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_rwlockattr_t</span> *<span class="hljs-keyword">restrict</span> attr,<span class="hljs-type">int</span> *<span class="hljs-keyword">restrict</span> pshared)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_rwlockattr_setpshared</span><span class="hljs-params">(pthread_rwlock-<span class="hljs-type">attr_t</span> *attr,<span class="hljs-type">int</span> pshared)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>虽然POSIX只定义了一个读写锁属性，但不同平台的实现可以自由地定义额外的、非标准的属性。</p><h2 id="条件标量属性"><a href="#条件标量属性" class="headerlink" title="条件标量属性"></a>条件标量属性</h2><p>Single UNIX Specification目前定义了条件变量的两个属性：进程共享属性和时钟属性。与其他的属性对象一样，有一对函数用于初始化和反初始化条件变量属性。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_condattr_init</span><span class="hljs-params">(<span class="hljs-type">pthread_condattr_t</span> *attr)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_condattr_destroy</span><span class="hljs-params">(<span class="hljs-type">pthread_condattr_t</span> *attr)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>与其他的同步属性一样，条件变量支持进程共享属性。它控制着条件变量是可以被单进程的多个线程使用，还是可以被多进程的线程使用。要获取进程共享属性的当前值，可以用pthread_condattr_getpshared函数。设置该值可以用pthread_condattr_setpshared函数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_condattr_getpshared</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_condattr_t</span> *<span class="hljs-keyword">restrict</span> attr, <span class="hljs-type">int</span> *<span class="hljs-keyword">restrict</span> pshared)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_condattr_setpshared</span><span class="hljs-params">(<span class="hljs-type">pthread_condattr_t</span>*attr,<span class="hljs-type">int</span> pshared)</span>;<br><span class="hljs-comment">//两个函数的返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>时钟属性控制计算pthread_cond_timedwait函数的超时参数（tsptr）时采用的是哪个时钟。合法值取自图 6-8 中列出的时钟 ID。可以使用 pthread_condattr_getclock 函数获取可被用于pthread_cond_timedwait 函数的时钟 ID，在使用pthread_cond_timedwait 函数前需要用pthread_condattr_t对象对条件变量进行初始化。可以用pthread_condattr_setclock函数对时钟ID进行修改。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_condattr_getclock</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">pthread_condattr_t</span> *<span class="hljs-keyword">restrict</span> attr, <span class="hljs-type">clockid_t</span> *<span class="hljs-keyword">restrict</span> clock_id)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_condattr_setclock</span><span class="hljs-params">(<span class="hljs-type">pthread_condattr_t</span> *attr, <span class="hljs-type">clockid_t</span> clock_id)</span>;<br><span class="hljs-comment">//两个函数的返回值:若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>奇怪的是，Single UNIX Specification并没有为其他有超时等待函数的属性对象定义时钟属性。</p><h1 id="重入、线程与信号、线程与for循环"><a href="#重入、线程与信号、线程与for循环" class="headerlink" title="重入、线程与信号、线程与for循环"></a>重入、线程与信号、线程与for循环</h1><h2 id="线程与信号"><a href="#线程与信号" class="headerlink" title="线程与信号"></a>线程与信号</h2><p><img src="https://pic.downk.cc/item/5fc63673f81f7e3bd97efa1c.jpg"><br>这里将之前信号响应过程的图进行了拓展。我们可以看到，其实之前我们的版本是单进程单线程的版本。<br>在多线程中，我们其实需要进行两次按位与，也就是先将masks1和mask2按位与之后再和pending按位与。</p><h3 id="相应函数"><a href="#相应函数" class="headerlink" title="相应函数"></a>相应函数</h3><p>在这里我们所需要用到的函数都是和之前信号差不多的，主要就是修改masks值和pending值（pending值修改用的很少）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_sigmask</span><span class="hljs-params">(<span class="hljs-type">int</span> how, <span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *<span class="hljs-keyword">restrict</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">sigset_t</span> *<span class="hljs-keyword">restrict</span> oset)</span>;<br><span class="hljs-comment">//返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>pthread_sigmask函数与sigprocmask函数基本相同，不过pthread_sigmask工作在线程中，而且失败时返回错误码，不再像sigprocmask中那样设置errno并返回−1。set参数包含线程用于修改信号屏蔽字的信号集。<br>how参数可以取下列3个值之一：</p><ul><li>SIG_BLOCK，把信号集添加到线程信号屏蔽字中</li><li>SIG_SETMASK，用信号集替换线程的信号屏蔽字；</li><li>SIG_UNBLOCK，从线程信号屏蔽字中移除信号集。</li></ul><p>如果oset参数不为空，线程之前的信号屏蔽字就存储在它指向的sigset_t结构中。线程可以通过把set参数设置为NULL，并把oset参数设置为sigset_t结构的地址，来获取当前的信号屏蔽字。这种情况中的how参数会被忽略。</p><h4 id="sigwait"><a href="#sigwait" class="headerlink" title="sigwait"></a>sigwait</h4><p>线程可以通过调用sigwait等待一个或多个信号的出现。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">sigwait</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *<span class="hljs-keyword">restrict</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">int</span> *<span class="hljs-keyword">restrict</span> signop)</span>;<br><span class="hljs-comment">//返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>set参数指定了线程等待的信号集。返回时，signop指向的整数将包含发送信号的数量。<br>如果信号集中的某个信号在sigwait调用的时候处于挂起状态，那么sigwait将无阻塞地返回。在返回之前，sigwait将从进程中移除那些处于挂起等待状态的信号。如果具体实现支持排队信号，并且信号的多个实例被挂起，那么sigwait将会移除该信号的一个实例，其他的实例还要继续排队。<br>为了避免错误行为发生，线程在调用sigwait之前，必须阻塞那些它正在等待的信号。sigwait函数会原子地取消信号集的阻塞状态，直到有新的信号被递送。在返回之前，sigwait将恢复线程的信号屏蔽字。如果信号在sigwait被调用的时候没有被阻塞，那么在线程完成对sigwait的调用之前会出现一个时间窗，在这个时间窗中，信号就可以被发送给线程。<br>使用sigwait的好处在于它可以简化信号处理，允许把异步产生的信号用同步的方式处理。为了防止信号中断线程，可以把信号加到每个线程的信号屏蔽字中。然后可以安排专用线程处理信号。这些专用线程可以进行函数调用，不需要担心在信号处理程序中调用哪些函数是安全的，因为这些函数调用来自正常的线程上下文，而非会中断线程正常执行的传统信号处理程序。<br>如果多个线程在sigwait的调用中因等待同一个信号而阻塞，那么在信号递送的时候，就只有一个线程可以从sigwait中返回。如果一个信号被捕获（例如进程通过使用sigaction建立了一个信号处理程序），而且一个线程正在sigwait调用中等待同一信号，那么这时将由操作系统实现来决定以何种方式递送信号。操作系统实现可以让sigwait返回，也可以激活信号处理程序，但这两种情况不会同时发生。</p><h4 id="信号传递pthread-kill"><a href="#信号传递pthread-kill" class="headerlink" title="信号传递pthread_kill"></a>信号传递pthread_kill</h4><p>要把信号发送给进程，可以调用kill（见10.9节）。要把信号发送给线程，可以调用pthread_kill。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">pthread_kill</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span> thread, <span class="hljs-type">int</span> signo)</span>;<br><span class="hljs-comment">//返回值：若成功，返回0；否则，返回错误编号</span><br></code></pre></td></tr></table></figure><p>可以传一个0值的signo来检查线程是否存在。如果信号的默认处理动作是终止该进程，那么把信号传递给某个线程仍然会杀死整个进程。<br>注意，闹钟定时器是进程资源，并且所有的线程共享相同的闹钟。所以，进程中的多个线程不可能互不干扰（或互不合作）地使用闹钟定时器（这是习题12.6的内容）。</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/50c9bb7d4a7d.html"/>
    <url>/2022/12/50c9bb7d4a7d.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-进程环境简介"><a href="#1-进程环境简介" class="headerlink" title="1 进程环境简介"></a>1 进程环境简介</h1><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h2><h3 id="学习内容："><a href="#学习内容：" class="headerlink" title="学习内容："></a>学习内容：</h3><ol><li>程序执行时，其main函数是如何被调用的</li><li>命令行参数是如何传递给新程序的</li><li>典型的存储空间布局是怎么样的</li><li>如何分配另外的存储空间</li><li>进程如何使用环境变量</li><li>进程的各种不同终止方式</li></ol><h2 id="2-main函数"><a href="#2-main函数" class="headerlink" title="2 main函数"></a>2 main函数</h2><p>C程序总是从main函数开始执行的。</p><h3 id="main函数的原型"><a href="#main函数的原型" class="headerlink" title="main函数的原型"></a>main函数的原型</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span>;<br></code></pre></td></tr></table></figure><p>当我们在bash下输入命令执行某一个ELF文件的时候，首先bash进程调用fork()系统调用创建一个新的进程，然后新的进程调用execve()系统调用执行的ELF文件。<br>注意：<br>在linux中，gcc编译之后的文件就是ELF文件，但是在macos系统中，我们执行出来的文件叫做Mach-O文件，这是一种更好的形式。<br><img src="https://pic.downk.cc/item/5fc636e5f81f7e3bd97f4b59.jpg"></p><p>在内核使用exec函数执行C程序时，在调用main函数之前先调用一个特殊的启动例程。可执行程序文件将启动例程指定为程序的起始地址-这是由连接编辑器设置的，而连接编辑器由C编译器调用。启动例程从内核取得命令行参数和环境变量值，然后为按上述方式调用main函数做好准备。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li>C编译器调用连接编辑器</li><li>连接编辑器设置可执行文件将启动例程指定为程序的起始地址，</li><li>启动main函数</li></ol><h2 id="3-进程终止"><a href="#3-进程终止" class="headerlink" title="3 进程终止"></a>3 进程终止</h2><h3 id="8种进程终止的方式"><a href="#8种进程终止的方式" class="headerlink" title="8种进程终止的方式"></a>8种进程终止的方式</h3><ol><li><p>从main返回<br>main执行完毕即可。</p></li><li><p>调用exit<br>exit(main(argc,argv));</p></li><li><p>调用_exit或_Exit</p></li><li><p>最后一个线程从其启动例程返回(11.5节)</p></li><li><p>从最后一个线程调用pthread_exit(11.5节)</p></li><li><p>调用abort(10.17节)</p></li><li><p>街道一个信号(10.2节）</p></li><li><p>最后一个线程对取消请求作出响应(11.5节12.7节)<br>前五种是正常终止，后三种是一场终止。</p></li></ol><h4 id="1-退出函数"><a href="#1-退出函数" class="headerlink" title="1 退出函数"></a>1 退出函数</h4><p>前三种的区别：<br>   _exit和_Exit立即进入内核，exit则先执行一些清理处理，然后返回内核。<br>函数形式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">exit</span><span class="hljs-params">(<span class="hljs-type">int</span> status)</span>;<br><br><span class="hljs-type">void</span> _Exit(<span class="hljs-type">int</span> status);<br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd,h&gt;</span></span><br><br><span class="hljs-type">void</span> _exit(<span class="hljs-type">int</span> status);<br></code></pre></td></tr></table></figure><p>对fig7.1中的程序进行编译，并且打印其终止码。<br><img src="https://pic.downk.cc/item/5fc6367cf81f7e3bd97f06de.jpg"><br>在不同机器上可能会得到不同的终止码，这取决于main函数返回栈的寄存器的内容。<br>现在使用1990 ISO C编译器扩展，则可以见到终止码改变了：<br><img src="https://pic.downk.cc/item/5fc636c3f81f7e3bd97f43a0.jpg"></p><h4 id="2-函数atexit"><a href="#2-函数atexit" class="headerlink" title="2 函数atexit"></a>2 函数atexit</h4><p>按照ISO C的规定，一个进程可以登记多至32个函数，这些函数将由exit自动调用。我们称这些函数为终止处理程序，并调用atexit函数来登记这些函数。<br>atexit函数形式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">atexit</span><span class="hljs-params">(<span class="hljs-type">void</span> (*func)(<span class="hljs-type">void</span>))</span>;<br></code></pre></td></tr></table></figure><p>其中，atexit的参数是一个函数地址，当调用此函数时无需向它传递任何参数，也不期望它返回一个值。exit调用这些函数的顺序与它们登记的顺序相反，同一函数若被登记多次，也会被调用多次。</p><h4 id="C程序的启动和终止"><a href="#C程序的启动和终止" class="headerlink" title="C程序的启动和终止"></a>C程序的启动和终止</h4><p><img src="https://pic.downk.cc/item/5fc63689f81f7e3bd97f1e40.jpg"></p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">my_exit1</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">my_exit2</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-keyword">if</span> (atexit(my_exit2) != <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;can&#x27;t register my_exit2&quot;</span>);<br><br><span class="hljs-keyword">if</span> (atexit(my_exit1) != <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;can&#x27;t register my_exit1&quot;</span>);<br><span class="hljs-keyword">if</span> (atexit(my_exit1) != <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;can&#x27;t register my_exit1&quot;</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;main is done\n&quot;</span>);<br><span class="hljs-keyword">return</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">my_exit1</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;first exit handler\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">my_exit2</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;second exit handler\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：<br><img src="https://pic.downk.cc/item/5fc636cef81f7e3bd97f463c.jpg"><br>可以看到，输出的顺序和注册的顺序是相反的。</p><h2 id="4-命令行参数"><a href="#4-命令行参数" class="headerlink" title="4 命令行参数"></a>4 命令行参数</h2><p>当执行一个程序时，调用exec的进程可将命令行参数传递给该新程序。这是UNIX shell的一部分常规操作。在前几章的很多实例中，我们已经看到了这一点。</p><h3 id="实例7-4"><a href="#实例7-4" class="headerlink" title="实例7.4"></a>实例7.4</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br><span class="hljs-type">int</span>i;<br><br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; argc; i++)<span class="hljs-comment">/* echo all command-line args */</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;argv[%d]: %s\n&quot;</span>, i, argv[i]);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>其中argc是参数的数量，argv[]是参数的数组。<br>输出：<br><img src="https://pic.downk.cc/item/5fc636e5f81f7e3bd97f4b5f.jpg"></p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>argv[argc]是一个空指针。因此循环还可以如下表示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; argv[i] != <span class="hljs-literal">NULL</span>; i++)&#123; ... &#125;<br></code></pre></td></tr></table></figure><h2 id="5-环境表"><a href="#5-环境表" class="headerlink" title="5 环境表"></a>5 环境表</h2><p>每个程序都接收到一张环境表。与参数表，环境表也是一个字符指针数组，其中每个指针包含一个以null结束的C字符串的地址。全局变量environ则包含了该指针数组的地址：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> ** environ;<br></code></pre></td></tr></table></figure><p>例如，如果该环境包含5个字符串，那么它看起来如图7-5所示：<br>![IMAGE](resources&#x2F;1699E50E83653925D4D19D38049F423C.jpg &#x3D;1189x503)<br>其中，每个字符串的结尾处都显式地有一个null字节。我们称environ为<strong>环境指针</strong>，指针数组为环境表，其中各指针指向的字符串为环境字符串。</p><p>历史上，大多数UNIX系统支持main函数带3个参数，其中第3个参数就是环境表地址：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[], <span class="hljs-type">char</span> *envp[])</span>;<br></code></pre></td></tr></table></figure><p>如果要查看整个环境，则必须使用environ指针。</p><h2 id="6-C程序的存储空间布局"><a href="#6-C程序的存储空间布局" class="headerlink" title="6 C程序的存储空间布局"></a>6 C程序的存储空间布局</h2><p>共分为5个部分。</p><h3 id="段部分："><a href="#段部分：" class="headerlink" title="段部分："></a>段部分：</h3><h4 id="1-正文段。"><a href="#1-正文段。" class="headerlink" title="1. 正文段。"></a>1. 正文段。</h4><p>   CPU执行的机器指令部分。<br>   特点：<br>   a.通常正文段是可共享的，所以即使是频繁执行的程序（如文本编辑器，C编译器和shell等）在存储器中也只需有一个副本。<br>   b.正文段常常是只读的，以防止程序由于意外而修改其指令。</p><h4 id="2-初始化数据段"><a href="#2-初始化数据段" class="headerlink" title="2. 初始化数据段"></a>2. 初始化数据段</h4><p>   通常称为数据段。包含了程序中需明确地赋初值的变量。例如，C程序中任何<strong>函数之外</strong>的声明：<br>   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> maxcount = <span class="hljs-number">99</span>;<br></code></pre></td></tr></table></figure><br>   使此变量以其初值存放在初始化数据段中。</p><h4 id="3-未初始化数据段"><a href="#3-未初始化数据段" class="headerlink" title="3. 未初始化数据段"></a>3. 未初始化数据段</h4><p>   通常称为bss段，在程序开始执行之前，内核将此段中的数据初始化为0或空指针。<br>   注意：也在函数外。</p><h4 id="段错误的几个直接原因："><a href="#段错误的几个直接原因：" class="headerlink" title="段错误的几个直接原因："></a>段错误的几个直接原因：</h4><p>a. 解引用一个包含非法值的指针<br>b. 解引用一个空指针<br>c. 未经授权访问<br>d. 用完了堆栈空间</p><h3 id="堆和栈"><a href="#堆和栈" class="headerlink" title="堆和栈"></a>堆和栈</h3><h4 id="1-栈"><a href="#1-栈" class="headerlink" title="1. 栈"></a>1. 栈</h4><p>栈又称堆栈，由编译器自动分配释放，行为类似数据结构中的栈(先进后出)。堆栈主要有三个用途：</p><ul><li>为函数内部声明的非静态局部变量(C语言中称“自动变量”)提供存储空间。</li><li>记录函数调用过程相关的维护性信息，称为栈帧(Stack Frame)或过程活动记录(Procedure Activation Record)。它包括函数返回地址，不适合装入寄存器的函数参数及一些寄存器值的保存。除递归调用外，堆栈并非必需。因为编译时可获知局部变量，参数和返回地址所需空间，并将其分配于BSS段。</li><li>临时存储区，用于暂存长算术表达式部分计算结果或alloca()函数分配的栈内内存。</li></ul><p>持续地重用栈空间有助于使活跃的栈内存保持在CPU缓存中，从而加速访问。进程中的每个线程都有属于自己的栈。向栈中不断压入数据时，若超出其容量就会耗尽栈对应的内存区域，从而触发一个页错误。此时若栈的大小低于堆栈最大值RLIMIT_STACK(通常是8M)，则栈会动态增长，程序继续运行。映射的栈区扩展到所需大小后，不再收缩。<br>Linux中ulimit -s命令可查看和设置堆栈最大值，当程序使用的堆栈超过该值时, 发生栈溢出(Stack Overflow)，程序收到一个段错误(Segmentation Fault)。<br><img src="https://pic.downk.cc/item/5fc63694f81f7e3bd97f2e63.jpg"><br>在macos中堆栈的最大值也是8M。</p><h5 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h5><ul><li>调高堆栈容量可能会增加内存开销和启动时间。</li><li>堆栈既可向下增长(向内存低地址)也可向上增长,这依赖于具体的实现。本文所述堆栈向下增长。</li><li>堆栈的大小在运行时由内核动态调整。</li></ul><h4 id="2-堆"><a href="#2-堆" class="headerlink" title="2. 堆"></a>2. 堆</h4><p>堆用于存放进程运行时动态分配的内存段，可动态扩张或缩减。堆中内容是匿名的，不能按名字直接访问，只能通过指针间接访问。当进程调用malloc(C)&#x2F;new(C++)等函数分配内存时，新分配的内存动态添加到堆上(扩张)；当调用free(C)&#x2F;delete(C++)等函数释放内存时，被释放的内存从堆中剔除(缩减) 。<br>分配的堆内存是经过字节对齐的空间，以适合原子操作。堆管理器通过链表管理每个申请的内存，由于堆申请和释放是无序的，最终会产生内存碎片。堆内存一般由应用程序分配释放，回收的内存可供重新使用。若程序员不释放，程序结束时操作系统可能会自动回收。<br>堆的末端由break指针标识，当堆管理器需要更多内存时，可通过系统调用brk()和sbrk()来移动break指针以扩张堆，一般由系统自动调用。  </p><h5 id="使用堆时经常出现两种问题："><a href="#使用堆时经常出现两种问题：" class="headerlink" title="使用堆时经常出现两种问题："></a>使用堆时经常出现两种问题：</h5><ul><li>释放或改写仍在使用的内存(“内存破坏”)；</li><li>未释放不再使用的内存(“内存泄漏”)。当释放次数少于申请次数时，可能已造成内存泄漏。泄漏的内存往往比忘记释放的数据结构更大，因为所分配的内存通常会圆整为下个大于申请数量的2的幂次(如申请212B，会圆整为256B)。</li></ul><h5 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h5><p>堆不同于数据结构中的”堆”，其行为类似链表。</p><h4 id="6-内存映射块"><a href="#6-内存映射块" class="headerlink" title="6. 内存映射块"></a>6. 内存映射块</h4><p>此处，内核将硬盘文件的内容直接映射到内存,任何应用程序都可通过Linux的mmap()系统调用或Windows的CreateFileMapping()&#x2F;MapViewOfFile()请求这种映射。<br>内存映射是一种方便高效的文件I&#x2F;O方式，因而被用于装载动态共享库。用户也可创建匿名内存映射，该映射没有对应的文件,可用于存放程序数据。在Linux中，若通过malloc()请求一大块内存，C运行库将创建一个匿名内存映射，而不使用堆内存。”大块” 意味着比阈值MMAP_THRESHOLD还大，缺省为128KB，可通过mallopt()调整。</p><p>该区域用于映射可执行文件用到的动态链接库。在Linux2.4版本中，若可执行文件依赖共享库，则系统会为这些动态库在从0x40000000开始的地址分配相应空间，并在程序装载时将其载入到该空间。在Linux2.6内核中，共享库的起始地址被往上移动至更靠近栈区的位置。</p><p>从进程地址空间的布局可以看到，在有共享库的情况下，留给堆的可用空间还有两处：</p><ul><li>从.bss段到0x40000000，约不到1GB的空间；</li><li>另一处是从共享库到栈之间的空间，约不到2GB。</li></ul><p>这两块空间大小取决于栈、共享库的大小和数量。这样来看，是否应用程序可申请的最大堆空间只有2GB？事实上，这与Linux内核版本有关。在上面给出的进程地址空间经典布局图中，共享库的装载地址为0x40000000，这实际上是Linux kernel 2.6版本之前的情况了，在2.6版本里，共享库的装载地址已经被挪到靠近栈的位置，即位于0xBFxxxxxx附近，因此，此时的堆范围就不会被共享库分割成2个“碎片”，故kernel 2.6的32位Linux系统中，malloc申请的最大内存理论值在2.9GB左右。</p><h1 id="共享库和存储空间分配"><a href="#共享库和存储空间分配" class="headerlink" title="共享库和存储空间分配"></a>共享库和存储空间分配</h1><h2 id="共享库"><a href="#共享库" class="headerlink" title="共享库"></a>共享库</h2><p>程序第一次执行或者第一次调用某个库函数时，用动态链接方法将程序与共享库函数相链接。<br>这减少了每个可执行文件的长度，但增加了一些运行时间开销。<br>这种时间开销发生在该程序第一次被执行时，或者每个共享库函数第一次被调用时。</p><p>使用共享库编译程序：<br><img src="https://pic.downk.cc/item/5fc63694f81f7e3bd97f2e57.jpg"></p><h2 id="3个用于存储空间动态分配的函数"><a href="#3个用于存储空间动态分配的函数" class="headerlink" title="3个用于存储空间动态分配的函数"></a>3个用于存储空间动态分配的函数</h2><ol><li>malloc，分配指定字节数的存储区。此存储区中的初始值不确定。</li><li>calloc，为指定数量指定长度的对象分配存储空间。该空间的每一位（bit）都初始化为0</li><li>realloc，增加或减少以前分配区的长度。当增加长度时，可能需将以前分配区的内容移到另一个足够长的区域，以便在尾端提供增加的存储区，而新增区域内的初始值则不确定。</li></ol><h4 id="函数形式"><a href="#函数形式" class="headerlink" title="函数形式"></a>函数形式</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">void</span> *<span class="hljs-title function_">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>;<br><span class="hljs-type">void</span> *<span class="hljs-title function_">calloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> nobj, <span class="hljs-type">size_t</span> size)</span>;<br><span class="hljs-type">void</span> *<span class="hljs-title function_">realloc</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">size_t</span> newsize)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr)</span>;<br></code></pre></td></tr></table></figure><p>这些分配例程通常用sbrk(2)系统调用实现。该系统调用扩充（或缩小）进程的堆。<br>虽然sbrk可以扩充或缩小进程的存储空间，但是大多数malloc和free的实现都不减小进程的存储空间。释放后的空间可供以后再分配，但将他们保持在malloc池中而不返回给内核。</p><h1 id="函数setjump和longjump的去呗"><a href="#函数setjump和longjump的去呗" class="headerlink" title="函数setjump和longjump的去呗"></a>函数setjump和longjump的去呗</h1><h1 id="10-函数setjmp和longjmp"><a href="#10-函数setjmp和longjmp" class="headerlink" title="10 函数setjmp和longjmp"></a>10 函数setjmp和longjmp</h1><p>在C中，goto语句是不能跨越函数的，而执行这种类型跳转功能的是函数setjmp和longjmp。这两个函数对于处理发生在很深层嵌套函数调用中的出错情况是非常有用的。</p><h3 id="常规栈帧演示"><a href="#常规栈帧演示" class="headerlink" title="常规栈帧演示"></a>常规栈帧演示</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>TOK_ADD   5</span><br><span class="hljs-type">void</span><span class="hljs-title function_">do_line</span><span class="hljs-params">(<span class="hljs-type">char</span> *)</span>;<br><span class="hljs-type">void</span><span class="hljs-title function_">cmd_add</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-type">int</span><span class="hljs-title function_">get_token</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">char</span>line[MAXLINE];<br><span class="hljs-keyword">while</span> (fgets(line, MAXLINE, <span class="hljs-built_in">stdin</span>) != <span class="hljs-literal">NULL</span>)<br>do_line(line);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-type">char</span>*tok_ptr;<span class="hljs-comment">/* global pointer for get_token() */</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">do_line</span><span class="hljs-params">(<span class="hljs-type">char</span> *ptr)</span><span class="hljs-comment">/* process one line of input */</span><br>&#123;<br><span class="hljs-type">int</span>cmd;<br>tok_ptr = ptr;<br><span class="hljs-keyword">while</span> ((cmd = get_token()) &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">switch</span> (cmd) &#123;<span class="hljs-comment">/* one case for each command */</span><br><span class="hljs-keyword">case</span> TOK_ADD:<br>cmd_add();<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-type">void</span><br><span class="hljs-title function_">cmd_add</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>token;<br><br>token = get_token();<br><span class="hljs-comment">/* rest of processing for this command */</span><br>&#125;<br><span class="hljs-type">int</span><br><span class="hljs-title function_">get_token</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-comment">/* fetch next token from line pointed to by tok_ptr */</span><br>&#125;<br></code></pre></td></tr></table></figure><p>在这里栈帧的主要变化情况为：<br><img src="https://pic.downk.cc/item/5fc6367bf81f7e3bd97f06c7.jpg"><br>可以看到，每个函数对应一个栈帧，并且从上往下依次扩展。<br>如上所诉，这种形式的栈安排是非常典型的。</p><h3 id="遇见问题"><a href="#遇见问题" class="headerlink" title="遇见问题"></a>遇见问题</h3><p>而我们在编写上面程序时会经常遇到一个问题，如何处理非致命的错误。例如若cmd_add函数发现一个错误（例如一个无效的数），那么它可能先打印一个错误信息，然后忽略输入行的剩余部分返回main，再读取下一行、但是如这种情况如果出现在main函数中的深层嵌套中时，用C语言难以做到，那就回变得很麻烦。<br>理解：<br>如果有多达5、6个嵌套，那么可能返回到的位置并不确定，例如返回到第3层或者第2层。</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>用非局部goto-setjmp和Longjmp函数。非局部的意思是不是由普通C语言goto语句在一个函数内实施的跳转，而是在栈上跳过若干调用帧，返回到当前函数调用路径上的某一函数中。</p><h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4><p>例如在第6层嵌套时发现输入了一个无效的数，那么我们就可以用setjmp和longjmpm直接回调到第3层嵌套。而C语言没办法做到这点。</p><h3 id="setjmp和longjmp"><a href="#setjmp和longjmp" class="headerlink" title="setjmp和longjmp"></a>setjmp和longjmp</h3><h4 id="函数形式-1"><a href="#函数形式-1" class="headerlink" title="函数形式"></a>函数形式</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;setjmp.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">setjmp</span><span class="hljs-params">(jmp_buf env)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">longjmp</span><span class="hljs-params">(jmp_buf env, <span class="hljs-type">int</span> val)</span>;<br></code></pre></td></tr></table></figure><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>env：是一个特殊类型jmp_buf。这一数据类型是某种形式的数组，其中存放在调用longjmp时能用来恢复栈状态的所有信息。因为需要在另一个函数中引用env变量，所以通常将env变量定义为全局变量。<br>val：非0值，它将成为从setjmp处返回的值。使用这个参数的原因是对于一个setjmp可以有多个longjmp。</p><h3 id="经过修改的main和cmd-add"><a href="#经过修改的main和cmd-add" class="headerlink" title="经过修改的main和cmd_add"></a>经过修改的main和cmd_add</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;setjmp.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>TOK_ADD   5</span><br><br>jmp_bufjmpbuffer;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">char</span>line[MAXLINE];<br><br><span class="hljs-keyword">if</span> (setjmp(jmpbuffer) != <span class="hljs-number">0</span>)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;error&quot;</span>);<br><span class="hljs-keyword">while</span> (fgets(line, MAXLINE, <span class="hljs-built_in">stdin</span>) != <span class="hljs-literal">NULL</span>)<br>do_line(line);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br> . . .<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">cmd_add</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>token;<br><br>token = get_token();<br><span class="hljs-keyword">if</span> (token &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">/* an error has occurred */</span><br>longjmp(jmpbuffer, <span class="hljs-number">1</span>);<br><span class="hljs-comment">/* rest of processing for this command */</span><br>&#125;<br></code></pre></td></tr></table></figure><p>首先执行main函数，调用setjmp，它将所需信息记入变量jmpbuffer中并返回0（初次调用返回0）.然后调用do_line，最后do_line调用cmd_add，假设此时检测到一个错误。在cmd_add中调用了longjmp之前，就如上图7.10，但是longjmp使栈反绕到执行main函数时的情况，也就是抛弃了cmd_add和do_line的栈帧，如下图：<br><img src="https://pic.downk.cc/item/5fc63659f81f7e3bd97ee586.jpg"><br>调用longjmp造成main函数中setjmp的返回，但是这次返回值为1.</p><h3 id="自动变量、寄存器变量和易失变量"><a href="#自动变量、寄存器变量和易失变量" class="headerlink" title="自动变量、寄存器变量和易失变量"></a>自动变量、寄存器变量和易失变量</h3><p>问题：<br>在main函数中，自动变量（临时变量）和寄存器变量的状态如何？<br>当longjmp返回到main函数时，这些变量的值是否能恢复到调用setjmp时的值？<br>答案：<br>看情况！！ 这是不确定的。如果有一个自动变量而又不想使其回滚，则可定义其为有volatile属性。声明为全局变量或静态变量的值在执行longjmp时保持不变。</p><h4 id="举例-fig7-13"><a href="#举例-fig7-13" class="headerlink" title="举例(fig7.13)"></a>举例(fig7.13)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;setjmp.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">f1</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">f2</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><br><span class="hljs-type">static</span> jmp_bufjmpbuffer;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span>globval;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>autoval;<br><span class="hljs-keyword">register</span> <span class="hljs-type">int</span>regival;<br><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span>volaval;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span>statval;<br><br>globval = <span class="hljs-number">1</span>; autoval = <span class="hljs-number">2</span>; regival = <span class="hljs-number">3</span>; volaval = <span class="hljs-number">4</span>; statval = <span class="hljs-number">5</span>;<br><br><span class="hljs-keyword">if</span> (setjmp(jmpbuffer) != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;after longjmp:\n&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;globval = %d, autoval = %d, regival = %d,&quot;</span><br>    <span class="hljs-string">&quot; volaval = %d, statval = %d\n&quot;</span>,<br>    globval, autoval, regival, volaval, statval);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Change variables after setjmp, but before longjmp.</span><br><span class="hljs-comment"> */</span><br>globval = <span class="hljs-number">95</span>; autoval = <span class="hljs-number">96</span>; regival = <span class="hljs-number">97</span>; volaval = <span class="hljs-number">98</span>;<br>statval = <span class="hljs-number">99</span>;<br><br>f1(autoval, regival, volaval, statval);<span class="hljs-comment">/* never returns */</span><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">f1</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j, <span class="hljs-type">int</span> k, <span class="hljs-type">int</span> l)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;in f1():\n&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;globval = %d, autoval = %d, regival = %d,&quot;</span><br>    <span class="hljs-string">&quot; volaval = %d, statval = %d\n&quot;</span>, globval, i, j, k, l);<br>f2();<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">f2</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>longjmp(jmpbuffer, <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>解析：</p><ol><li>先在main函数中初始化jmpbuffer。<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(setjmp(jmpbuffer) != <span class="hljs-number">0</span>&#125;&#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure></li><li>接着在调用longjmp之前改变所有变量的值。</li><li>调用f1</li><li>通过f1调用f2</li><li>最后f2调用longjmp返回setjmp处，此时进行打印。看所有的变量值是否会改变。</li></ol><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>理论上若使用带优化和不带优化选项对此程序进行编译的时候运行结果是不同的，但是我的macos系统上好像没有gcc -0这个参数，因此我没办法输出，这里给出书上的结果：<br><img src="https://pic.downk.cc/item/5fc636f5f81f7e3bd97f4dd9.jpg"><br>但是我的系统第二种方式输出时报错：<br><img src="https://pic.downk.cc/item/5fc63669f81f7e3bd97eec24.jpg"><br>不知道原因是什么，希望大家可以指正。</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/33802ba634f8.html"/>
    <url>/2022/12/33802ba634f8.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h1><p>本章介绍UNIX系统的进程控制，包括：</p><ol><li>创建新进程</li><li>执行进程</li><li>进程终止</li><li>介绍进程属性的各种ID-实际、有效的用户ID和组ID，以及它们如何受到进程控制原语的影响。</li><li>解释器文件和system函数</li><li>UNIX系统提供的进程会计机制。</li></ol><h2 id="进程表示"><a href="#进程表示" class="headerlink" title="进程表示"></a>进程表示</h2><p>每个进程都有一个非负整型表示的唯一进程ID。因为进程ID标识符是唯一的，常将其用作其他标识符的一部分以保证唯一性（例如，文件名）</p><p>系统的一些专用进程：</p><ol><li>ID&#x3D;0为调度进程，也称交换进程，也被称为系统进程。因为它是内核的一部分，并不执行任何磁盘上的程序。</li><li>ID&#x3D;1为init进程，在自举过程结束时由内核调用。它是一个普通的用户进程，但是它以超级用户特权运行，它绝不会终止。init通常读取与系统有关的初始化文件，并将系统引导到一个状态（如多用户）。<br><strong>注意</strong><br>在MacOS中，init进程被lauchd进程替代，执行的任务集与init相同，但扩展了功能。</li></ol><h1 id="2-函数fork系列讲解"><a href="#2-函数fork系列讲解" class="headerlink" title="2 函数fork系列讲解"></a>2 函数fork系列讲解</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">pid_t</span> <span class="hljs-title function_">fork</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure><p>由fork创建的进程被称为子进程。<br><strong>重要</strong>：</p><ol><li>fork函数被调用一次，但返回两次。<br>两次返回的区别是子进程的返回值为0，而父进程的返回值则是新建子进程的进程ID。<br>理由：<br>父进程的子进程可以拥有很多个，因此需要子进程ID。<br>子进程总是能够查看父进程的进程ID，因此没必要。并且进程ID 0总是由内核交换进程使用，所以一个子进程的进程不可能是0.</li><li>子进程和父进程继续执行fork调用之后的指令。子进程是父进程的副本。<br>例如，子进程获得父进程数据空间、堆和栈的副本。<br>注意：<br>这是子进程的副本，只是一个副本，父进程若改变子进程不会一起改变。</li></ol><h2 id="fork函数举例-标准I-x2F-O"><a href="#fork函数举例-标准I-x2F-O" class="headerlink" title="fork函数举例(标准I&#x2F;O)"></a>fork函数举例(标准I&#x2F;O)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-type">int</span> i;<br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++)&#123;<br>    fork();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-&quot;</span>);<br>  &#125;<br><br>  wait(<span class="hljs-literal">NULL</span>);<br>  wait(<span class="hljs-literal">NULL</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>共输出8个“-”符号。<br>解释：<br>如果你对fork()的机制比较熟悉的话，这个题并不难，输出应该是6个“-”，但是，实际上这个程序会很tricky地输出8个“-”。<br>要讲清这个题，我们首先需要知道fork()系统调用的特性，<br>fork()系统调用是Unix下以自身进程创建子进程的系统调用，一次调用，两次返回，如果返回是0，则是子进程，如果返回值&gt;0，则是父进程（返回值是子进程的pid），这是众为周知的。<br>还有一个很重要的东西是，在fork()的调用处，整个父进程空间会原模原样地复制到子进程中，包括指令，变量值，程序调用栈，环境变量，缓冲区，等等。<br>所以，上面的那个程序为什么会输入8个“-”，这是因为printf(“-”);语句有buffer，所以，对于上述程序，printf(“-”);把“-”放到了缓存中，并没有真正的输出，在fork的时候，缓存被复制到了子进程空间，所以，就多了两个，就成了8个，而不是6个。<br>另外，多说一下，我们知道，Unix下的设备有“块设备”和“字符设备”的概念，所谓块设备，就是以一块一块的数据存取的设备，字符设备是一次存取一个字符的设备。磁盘、内存都是块设备，字符设备如键盘和串口。块设备一般都有缓存，而字符设备一般都没有缓存。</p><h2 id="fork函数举例-无缓存I-x2F-O"><a href="#fork函数举例-无缓存I-x2F-O" class="headerlink" title="fork函数举例(无缓存I&#x2F;O)"></a>fork函数举例(无缓存I&#x2F;O)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;apue.h&gt;</span></span><br><br><span class="hljs-type">char</span> buf[] = <span class="hljs-string">&quot;-&quot;</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-type">int</span> i;<br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++)&#123;<br>    fork();<br>    write(STDOUT_FILENO, buf, <span class="hljs-keyword">sizeof</span>(buf)<span class="hljs-number">-1</span>);<br>  &#125;<br><br>  wait(<span class="hljs-literal">NULL</span>);<br>  wait(<span class="hljs-literal">NULL</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：（只有6个-）<br>![IMAGE](resources&#x2F;21A31C21C0C8B67A8C98C99D17CAE1B0.jpg &#x3D;574x47)</p><h2 id="fork函数子进程不影响父进程的演示"><a href="#fork函数子进程不影响父进程的演示" class="headerlink" title="fork函数子进程不影响父进程的演示"></a>fork函数子进程不影响父进程的演示</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">int</span>globvar = <span class="hljs-number">6</span>;<span class="hljs-comment">/* external variable in initialized data */</span><br><span class="hljs-type">char</span>buf[] = <span class="hljs-string">&quot;a write to stdout\n&quot;</span>;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>var;<span class="hljs-comment">/* automatic variable on the stack */</span><br><span class="hljs-type">pid_t</span>pid;<br><br>var = <span class="hljs-number">88</span>;<br><span class="hljs-keyword">if</span> (write(STDOUT_FILENO, buf, <span class="hljs-keyword">sizeof</span>(buf)<span class="hljs-number">-1</span>) != <span class="hljs-keyword">sizeof</span>(buf)<span class="hljs-number">-1</span>)<br>err_sys(<span class="hljs-string">&quot;write error&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;before fork\n&quot;</span>);<span class="hljs-comment">/* we don&#x27;t flush stdout */</span><br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* child */</span><br>globvar++;<span class="hljs-comment">/* modify variables */</span><br>var++;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>sleep(<span class="hljs-number">2</span>);<span class="hljs-comment">/* parent */</span><br>&#125;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pid = %ld, glob = %d, var = %d\n&quot;</span>, (<span class="hljs-type">long</span>)getpid(), globvar,<br>  var);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：<br>![IMAGE](resources&#x2F;2EEAAB236513511BEBD696B5CDAF6C68.jpg &#x3D;694x264)</p><p>注意：<br>一般来说，在fork之后是父进程先执行还是子进程先执行时不确定的，这取决于内核所使用的调度算法。</p><h2 id="fork失败的两个主要原因"><a href="#fork失败的两个主要原因" class="headerlink" title="fork失败的两个主要原因"></a>fork失败的两个主要原因</h2><ol><li>系统中已经有了太多的进程</li><li>该实际用户ID的进程总数超过了系统限制</li></ol><h2 id="fork的两种用法"><a href="#fork的两种用法" class="headerlink" title="fork的两种用法"></a>fork的两种用法</h2><ol><li>一个父进程希望复制自己<br>使父进程和子进程同时执行不同的代码段，也就是父进程用来调用fork生成子进程来执行请求。</li><li>一个进程要执行一个不同的程序。<br>这种情况下子进程从fork返回后立即调用exec。</li></ol><h2 id="函数vfork"><a href="#函数vfork" class="headerlink" title="函数vfork"></a>函数vfork</h2><p>vfork函数的调用序列和返回值与fork相同，但两者语义不同。<br>vfork用来创建一个新进程，而该进程的目的就是执行一个新程序（就是fork的第二种用法）</p><h2 id="vfork和fork的区别"><a href="#vfork和fork的区别" class="headerlink" title="vfork和fork的区别"></a>vfork和fork的区别</h2><ol><li>vfork不将父进程的地址空间完全复制到子进程中，因为子进程会立即调用exec，于是也就不会引用该地址。</li><li>vfork保证子进程先运行，在它调用exec或exit之后父进程才可能被调度运行，当子进程调用者两个函数中的任意一个时，父进程会恢复运行。</li></ol><h2 id="vfork函数实例"><a href="#vfork函数实例" class="headerlink" title="vfork函数实例"></a>vfork函数实例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">int</span>globvar = <span class="hljs-number">6</span>;<span class="hljs-comment">/* external variable in initialized data */</span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>var;<span class="hljs-comment">/* automatic variable on the stack */</span><br><span class="hljs-type">pid_t</span>pid;<br><br>var = <span class="hljs-number">88</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;before vfork\n&quot;</span>);<span class="hljs-comment">/* we don&#x27;t flush stdio */</span><br><span class="hljs-keyword">if</span> ((pid = vfork()) &lt; <span class="hljs-number">0</span>) &#123;<br>err_sys(<span class="hljs-string">&quot;vfork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* child */</span><br>globvar++;<span class="hljs-comment">/* modify parent&#x27;s variables */</span><br>var++;<br>_exit(<span class="hljs-number">0</span>);<span class="hljs-comment">/* child terminates */</span><br>&#125;<br><br><span class="hljs-comment">/* parent continues here */</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pid = %ld, glob = %d, var = %d\n&quot;</span>, (<span class="hljs-type">long</span>)getpid(), globvar,<br>  var);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p><img src="https://pic.downk.cc/item/5fc636fdf81f7e3bd97f4fca.jpg"></p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>可以看到，我们先定义了一个变量var&#x3D;88和全局变量globvar&#x3D;6，然后该进程调用了子进程来处理接下来进程（通过判断pid是否等于0，因为父进程得到的返回值不是0，但是子进程返回值是0，因此可以处理）。最后通过输出发现子进程改变了父进程的var和glob。<br>这是因为子进程在父进程的空间中运行。</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>在这里我们调用了_exit而不是exit，因为_exit不执行标准I&#x2F;O缓冲区的冲洗操作，如果调用exit，则输出是不确定的，因为它依赖于标准I&#x2F;O库的实现，有可能发现输出没有变化。</p><h1 id="3-exit系列函数与wait系列函数"><a href="#3-exit系列函数与wait系列函数" class="headerlink" title="3 exit系列函数与wait系列函数"></a>3 exit系列函数与wait系列函数</h1><h2 id="exit函数、-exit函数和-Exit函数。"><a href="#exit函数、-exit函数和-Exit函数。" class="headerlink" title="exit函数、_exit函数和_Exit函数。"></a>exit函数、_exit函数和_Exit函数。</h2><p>在7.3节中介绍了5中进程的正常终止和3种异常终止的方法。 但是无论进程如何终止，最后都会执行内核中的同一段代码。折断代码为相应进程关闭所有打开描述符，释放它所使用的存储器。 并且对于任意一种终止情形，我们都希望终止进程能通知其父进程它是<strong>如何终止</strong>的。 对于三个终止函数（exit、_exit和_Exit），实现将终止进程通知其父类的方法是将其<strong>退出状态</strong>作为参数传送给函数，然后该终止进程的父进程调用wait和waitpid函数取得其<strong>终止状态</strong>。</p><h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>退出状态不等于终止状态 退出状态：是一个<strong>参数</strong>，是传递给三个终止函数的参数，或者main的返回值 终止状态：是一个状态，表明进程已经结束。在最后调用_exit时，内核将退出状态转换为终止状态</p><h3 id="几种场景"><a href="#几种场景" class="headerlink" title="几种场景"></a>几种场景</h3><ol><li>子进程是父进程调用fork后生成的，子进程还会将其终止状态返回给父进程。但是如果父进程在子进程之前终止，又将如何？ 答案： 所有父进程终止的子进程读改变为init（PID&#x3D;1）的子进程，自身变成<strong>孤儿进程</strong>，被init进程收养。 收养过程： 当一个进程终止时，内核逐个检查所有活动进程，以判断它是否是正要终止进程的子进程，如果是，则该进程的父进程ID就更改为1.</li><li>如果子进程在父进程之前小时，那么父进程又如何能在做相应检查时得到子进程的终止状态呢？ 答案： 如果子进程完全小时了额，那么父进程是无法立即知道的，内核会为每个终止进程保存了一定量的信息（例如CPU时间总量等），当终止进程的父进程调用时会得到。这种终止的进程称为<strong>僵死进程</strong>。</li><li>一个由init进程收养的进程终止时会发生什么？ 答案： init被编写为无论何时只要有一个子进程终止，init就会调用一个wait函数取得终止状态，这样也就放置了系统塞满僵死进程。</li></ol><h2 id="函数wait和waitpid"><a href="#函数wait和waitpid" class="headerlink" title="函数wait和waitpid"></a>函数wait和waitpid</h2><p>当一个进程正常或异常终止时，内核就向其父进程发送SIGCHLD信号。父进程此时可以选择忽略该信号或者调用wait和waitpid来处理这个进程。 调用wait和waitpid所做的事情：</p><ol><li>如果其所有子进程都还在运行，则阻塞</li><li>如果一个子进程已终止，整等待父进程获取其终止状态，则取得该子进程的终止状态立即返回。</li><li>如果它没有收到任何子进程，则立即出错返回</li></ol><p>注意： 如果接收到信号立即调用wait，那么一定会有返回值，如果在随机时间点调用，则进程可能会阻塞。</p><h3 id="wait和waitpid"><a href="#wait和waitpid" class="headerlink" title="wait和waitpid"></a>wait和waitpid</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">include &lt;sys/wait.h&gt;<br><br>pid_t wait(int *stattloc);<br><br>pid_t waitpid(pid_t pid, int *staloc, int options);<br></code></pre></td></tr></table></figure><h3 id="两个函数的区别："><a href="#两个函数的区别：" class="headerlink" title="两个函数的区别："></a>两个函数的区别：</h3><ol><li>一个子进程终止前，wait使其调用者阻塞，而waitpid有一选项，可使调用者不阻塞。</li><li>waitpid并不等待在其调用之后的第一个终止子进程，它有若干个选项，可以控制它所等待的进程。</li></ol><p>其中staloc是一个指向终止状态的指针，若不需要终止状态则可以设置为空。</p><h3 id="两个函数的返回值"><a href="#两个函数的返回值" class="headerlink" title="两个函数的返回值"></a>两个函数的返回值</h3><p><img src="https://pic.downk.cc/item/5fc63645f81f7e3bd97ee145.jpg?ynotemdtimestamp=1617478207624" alt="img">实例： 在这里定义了一个pr_exit函数，使用上图来打印进程终止状态（以后会多次使用）</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span><br>#<span class="hljs-keyword">include</span> &lt;sys/wait.h&gt;<br><br>void<br>pr<span class="hljs-constructor">_exit(<span class="hljs-params">int</span> <span class="hljs-params">status</span>)</span><br>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-constructor">WIFEXITED(<span class="hljs-params">status</span>)</span>)<br>printf(<span class="hljs-string">&quot;normal termination, exit status = %d\n&quot;</span>,<br><span class="hljs-constructor">WEXITSTATUS(<span class="hljs-params">status</span>)</span>);<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-constructor">WIFSIGNALED(<span class="hljs-params">status</span>)</span>)<br>printf(<span class="hljs-string">&quot;abnormal termination, signal number = %d%s\n&quot;</span>,<br><span class="hljs-constructor">WTERMSIG(<span class="hljs-params">status</span>)</span>,<br>#ifdefWCOREDUMP<br><span class="hljs-constructor">WCOREDUMP(<span class="hljs-params">status</span>)</span> ? <span class="hljs-string">&quot; (core file generated)&quot;</span> : <span class="hljs-string">&quot;&quot;</span>);<br>#<span class="hljs-keyword">else</span><br><span class="hljs-string">&quot;&quot;</span>);<br>#endif<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-constructor">WIFSTOPPED(<span class="hljs-params">status</span>)</span>)<br>printf(<span class="hljs-string">&quot;child stopped, signal number = %d\n&quot;</span>,<br><span class="hljs-constructor">WSTOPSIG(<span class="hljs-params">status</span>)</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到针对不同的宏打印出了不同的值。</p><h4 id="演示不同的exit值"><a href="#演示不同的exit值" class="headerlink" title="演示不同的exit值"></a>演示不同的exit值</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#include &quot;apue.h&quot;</span><br><span class="hljs-comment">#include &lt;sys/wait.h&gt;</span><br><br>int<br>main(void)<br>&#123;<br>pid_tpid;<br>intstatus;<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>)<span class="hljs-regexp">/* child */</span><br><span class="hljs-keyword">exit</span>(<span class="hljs-number">7</span>);<br><br><span class="hljs-keyword">if</span> (wait(&amp;status) != pid)<span class="hljs-regexp">/* wait for child */</span><br>err_sys(<span class="hljs-string">&quot;wait error&quot;</span>);<br>pr_exit(status);<span class="hljs-regexp">/* and print its status */</span><br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>)<span class="hljs-regexp">/* child */</span><br>abort();<span class="hljs-regexp">/* generates SIGABRT */</span><br><br><span class="hljs-keyword">if</span> (wait(&amp;status) != pid)<span class="hljs-regexp">/* wait for child */</span><br>err_sys(<span class="hljs-string">&quot;wait error&quot;</span>);<br>pr_exit(status);<span class="hljs-regexp">/* and print its status */</span><br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>)<span class="hljs-regexp">/* child */</span><br>status <span class="hljs-regexp">/= 0;/</span>* divide by <span class="hljs-number">0</span> generates SIGFPE */<br><br><span class="hljs-keyword">if</span> (wait(&amp;status) != pid)<span class="hljs-regexp">/* wait for child */</span><br>err_sys(<span class="hljs-string">&quot;wait error&quot;</span>);<br>pr_exit(status);<span class="hljs-regexp">/* and print its status */</span><br><br><span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出： <img src="https://pic.downk.cc/item/5fc63616f81f7e3bd97ed89a.jpg?ynotemdtimestamp=1617478207624" alt="img">解释图如下： <img src="https://pic.downk.cc/item/5fc6369df81f7e3bd97f38a6.jpg?ynotemdtimestamp=1617478207624" alt="img"></p><h3 id="使用wait函数的缺陷和改进-waitpid"><a href="#使用wait函数的缺陷和改进-waitpid" class="headerlink" title="使用wait函数的缺陷和改进-waitpid"></a>使用wait函数的缺陷和改进-waitpid</h3><p>wait函数不管共有几个子进程，只要有一个子进程终止就马上终止了，如果要等待一个指定的进程终止（如果知道要等待进程的ID），就没有办法了，此时应该使用waitpid。 回顾一下waitpid函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">waitpid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid, <span class="hljs-type">int</span> *statloc, <span class="hljs-type">int</span> options)</span></span>;<br></code></pre></td></tr></table></figure><h4 id="参数解释"><a href="#参数解释" class="headerlink" title="参数解释"></a>参数解释</h4><p>其中statloc用法和wait相同，pid是我们需要等待的进程。作用如下：</p><h5 id="参数pid"><a href="#参数pid" class="headerlink" title="参数pid"></a>参数pid</h5><ol><li>pid&#x3D;&#x3D;-1 等待任一进程，这种情况waitpid和wait相同</li><li>pid&gt;0 等待进程ID与pid相等的子进程</li><li>pid&#x3D;&#x3D;0 等待组ID等于调用进程组ID的任一子进程。</li><li>pid&lt;-1 等待组ID等于pid绝对值的任一子进程</li></ol><h5 id="参数options"><a href="#参数options" class="headerlink" title="参数options"></a>参数options</h5><p>options参数使我们能进一步控制waitpid操作 <img src="https://pic.downk.cc/item/5fc6360cf81f7e3bd97ed72e.jpg?ynotemdtimestamp=1617478207624" alt="img"></p><h5 id="返回值："><a href="#返回值：" class="headerlink" title="返回值："></a>返回值：</h5><p>函数的返回值是终止子进程的进程ID，并将该子进程的终止状态存放在由statloc指向的存储单元中。</p><h3 id="fork一个子进程但是不等待僵死进程的办法"><a href="#fork一个子进程但是不等待僵死进程的办法" class="headerlink" title="fork一个子进程但是不等待僵死进程的办法"></a>fork一个子进程但是不等待僵死进程的办法</h3><p>回忆之前介绍的<strong>僵死进程</strong>：<br>在UNIX属于中，一个已经终止、但是其父进程尚未对其进行善后处理的进程的进程被称为僵死进程。</p><h4 id="僵尸进程的危害："><a href="#僵尸进程的危害：" class="headerlink" title="僵尸进程的危害："></a>僵尸进程的危害：</h4><p>太多的僵尸进程会导致系统不能产生新的进程。 如果一个进程fork一个子进程但是不要它等待子进程终止，也不希望子进程处于僵死状态直到父进程终止，实现这一要求的诀窍：<strong>调用fork两次</strong></p><h4 id="举例："><a href="#举例：" class="headerlink" title="举例："></a>举例：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span></span><br><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">err_sys</span>(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* first child */</span><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>)<br><span class="hljs-built_in">err_sys</span>(<span class="hljs-string">&quot;fork error&quot;</span>);<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>)<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">/* parent from second fork == first child */</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * We&#x27;re the second child; our parent becomes init as soon</span><br><span class="hljs-comment"> * as our real parent calls exit() in the statement above.</span><br><span class="hljs-comment"> * Here&#x27;s where we&#x27;d continue executing, knowing that when</span><br><span class="hljs-comment"> * we&#x27;re done, init will reap our status.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;second child, parent pid = %ld\n&quot;</span>, (<span class="hljs-type">long</span>)<span class="hljs-built_in">getppid</span>());<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">waitpid</span>(pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>) != pid)<span class="hljs-comment">/* wait for first child */</span><br><span class="hljs-built_in">err_sys</span>(<span class="hljs-string">&quot;waitpid error&quot;</span>);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * We&#x27;re the parent (the original process); we continue executing,</span><br><span class="hljs-comment"> * knowing that we&#x27;re not the parent of the second child.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>执行结果： <img src="https://pic.downk.cc/item/5fc63689f81f7e3bd97f1e25.jpg?ynotemdtimestamp=1617478207624" alt="img">解释： 如果了解上一个例题之后这个例题其实很简单 <img src="https://pic.downk.cc/item/5fc63616f81f7e3bd97ed895.jpg?ynotemdtimestamp=1617478207624" alt="img">可以看到，子进程2打印的parent ID是1，也就是init进程，这个时候直接是由init进程托管的，不会出现僵死进程。</p><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>子进程1 fork之后子进程1和子进程2的执行顺序是不确定的。因此若是先执行子进程2，那么马上调用了sleep，执行到子进程1时马上终止。若是先执行子进程1则马上终止，执行到子进程2时sleep，这样可以确保无论什么顺序子进程2 sleep结束之后子进程1已经终止</p><h2 id="函数waitid"><a href="#函数waitid" class="headerlink" title="函数waitid"></a>函数waitid</h2><p>waitid函数类似waitpid，但是提供了更多的灵活性。</p><h3 id="函数形式："><a href="#函数形式：" class="headerlink" title="函数形式："></a>函数形式：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">waitid</span><span class="hljs-params">(<span class="hljs-type">idtype_t</span> idtype, <span class="hljs-type">id_t</span> id, <span class="hljs-type">siginfo_t</span> *infop, <span class="hljs-type">int</span> options)</span></span>;<br></code></pre></td></tr></table></figure><h3 id="返回值：-1"><a href="#返回值：-1" class="headerlink" title="返回值："></a>返回值：</h3><p>若成功返回0，出错返回-1.</p><p>与waitpid相似，waitid允许一个进程指定要等待的子进程，但它使用两个单独的参数表示要等待的子进程所属的类型，而不是将此与进程ID或进程组ID组成一个参数。id参数的作用于idtype的值相关。<br><img src="https://pic.downk.cc/item/5fc63673f81f7e3bd97efa40.jpg?ynotemdtimestamp=1617478207624" alt="img"></p><h2 id="竞争条件"><a href="#竞争条件" class="headerlink" title="竞争条件"></a>竞争条件</h2><p>先来了解两个名词：</p><h3 id="竞争条件-1"><a href="#竞争条件-1" class="headerlink" title="竞争条件"></a>竞争条件</h3><p>多个进程都企图对共享数据进行某种处理，而最后的结果又取决于进程运行的顺序时，就认为发生了<strong>竞争条件</strong>。</p><h3 id="轮询"><a href="#轮询" class="headerlink" title="轮询"></a>轮询</h3><p>如果一个进程需要等待其父进程终止，则可以使用下列形式的循环：</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">while</span>(<span class="hljs-title">getppid</span>()<span class="hljs-variable">!</span>=<span class="hljs-number">1</span>)&#123;</span><br><span class="hljs-function">   <span class="hljs-title"><span class="hljs-built_in">sleep</span></span>(<span class="hljs-number">1</span>);</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>这种形式的循环称为轮询。它的问题是浪费了CPU时间（因为CPU不断在进行条件测试）。 注意： 若一个进程希望等待其子进程终止，则必须调用wait系列函数中的一个，这里没有用到轮询机制。</p><h3 id="避免竞争条件和轮询的办法"><a href="#避免竞争条件和轮询的办法" class="headerlink" title="避免竞争条件和轮询的办法"></a>避免竞争条件和轮询的办法</h3><p>为了避免竞争条件，在多个进程之间需要有某种形式的信号发送和接收的方法：</p><ol><li>UNIX系统可以使用信号机制</li><li>各种形式的进程间通信（IPU）也可以使用 具体的在后面的章节会介绍。</li></ol><h3 id="竞争条件实例"><a href="#竞争条件实例" class="headerlink" title="竞争条件实例"></a>竞争条件实例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">charatatime</span><span class="hljs-params">(<span class="hljs-type">char</span> *)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span></span><br><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">err_sys</span>(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">charatatime</span>(<span class="hljs-string">&quot;output from child\n&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">charatatime</span>(<span class="hljs-string">&quot;output from parent\n&quot;</span>);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span></span><br><span class="hljs-function"><span class="hljs-title">charatatime</span><span class="hljs-params">(<span class="hljs-type">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">char</span>*ptr;<br><span class="hljs-type">int</span>c;<br><br><span class="hljs-built_in">setbuf</span>(stdout, <span class="hljs-literal">NULL</span>);<span class="hljs-comment">/* set unbuffered */</span><br><span class="hljs-keyword">for</span> (ptr = str; (c = *ptr++) != <span class="hljs-number">0</span>; )<br><span class="hljs-built_in">putc</span>(c, stdout);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出： 不知为何我的macos系统一直执行结果都是output from parent先。 <img src="https://pic.downk.cc/item/5fc636b8f81f7e3bd97f4146.jpg?ynotemdtimestamp=1617478207624" alt="img">（可能是因为我电脑性能太好？ 哈哈哈） 理论上的输出： <img src="https://pic.downk.cc/item/5fc63645f81f7e3bd97ee140.jpg?ynotemdtimestamp=1617478207624" alt="img" style="zoom:50%;" /></p><h3 id="解决竞争问题实例"><a href="#解决竞争问题实例" class="headerlink" title="解决竞争问题实例"></a>解决竞争问题实例</h3><p>例如需要先让parent进程执行，那么就可以在子进程的执行语句中加上WAIT_PARENT()：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">charatatime</span><span class="hljs-params">(<span class="hljs-type">char</span> *)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span></span><br><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><br><span class="hljs-built_in">TELL_WAIT</span>();<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">err_sys</span>(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">WAIT_PARENT</span>();<span class="hljs-comment">/* parent goes first */</span><br><span class="hljs-built_in">charatatime</span>(<span class="hljs-string">&quot;output from child\n&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">charatatime</span>(<span class="hljs-string">&quot;output from parent\n&quot;</span>);<br><span class="hljs-built_in">TELL_CHILD</span>(pid);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span></span><br><span class="hljs-function"><span class="hljs-title">charatatime</span><span class="hljs-params">(<span class="hljs-type">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">char</span>*ptr;<br><span class="hljs-type">int</span>c;<br><br><span class="hljs-built_in">setbuf</span>(stdout, <span class="hljs-literal">NULL</span>);<span class="hljs-comment">/* set unbuffered */</span><br><span class="hljs-keyword">for</span> (ptr = str; (c = *ptr++) != <span class="hljs-number">0</span>; )<br><span class="hljs-built_in">putc</span>(c, stdout);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到在15行输入了WAIT_PARENT();并在19行TELL_CHILD()。 因此每次可以等待父进程先执行。</p><h3 id="输出："><a href="#输出：" class="headerlink" title="输出："></a>输出：</h3><p><img src="https://pic.downk.cc/item/5fc636d9f81f7e3bd97f4935.jpg?ynotemdtimestamp=1617478207624" alt="img">可以看到每次都是parent先。 这里因为效果和上面的相同，我将其改为先让子进程执行，那么就应该是在父进程中加入WAIT_CHILD();并在子进程结束之后加上TELL_PARENT(); 如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">charatatime</span><span class="hljs-params">(<span class="hljs-type">char</span> *)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span></span><br><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><br><span class="hljs-built_in">TELL_WAIT</span>();<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">err_sys</span>(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">charatatime</span>(<span class="hljs-string">&quot;output from child\n&quot;</span>);<br>    <span class="hljs-built_in">TELL_PARENT</span>(pid);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">WAIT_CHILD</span>();<br><span class="hljs-built_in">charatatime</span>(<span class="hljs-string">&quot;output from parent\n&quot;</span>);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span></span><br><span class="hljs-function"><span class="hljs-title">charatatime</span><span class="hljs-params">(<span class="hljs-type">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">char</span>*ptr;<br><span class="hljs-type">int</span>c;<br><br><span class="hljs-built_in">setbuf</span>(stdout, <span class="hljs-literal">NULL</span>);<span class="hljs-comment">/* set unbuffered */</span><br><span class="hljs-keyword">for</span> (ptr = str; (c = *ptr++) != <span class="hljs-number">0</span>; )<br><span class="hljs-built_in">putc</span>(c, stdout);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出： <img src="https://pic.downk.cc/item/5fc63610f81f7e3bd97ed7af.jpg?ynotemdtimestamp=1617478207624" alt="img"></p><h1 id="4-exec系列函数"><a href="#4-exec系列函数" class="headerlink" title="4 exec系列函数"></a>4 exec系列函数</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>用fork函数创建新的子进程后，子进程往往要调用一种exec函数以执行另一个程序。当进程调用一种exec函数时，该进程执行的程序完全替换为新程序，而新程序则从其main函数开始执行。</p><h2 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h2><ol><li>调用exec函数并不创建新进程，所以前后的进程ID并未改变</li><li>exec用磁盘上的一个新程序替换了当前进程的正文段、数据段、堆段和栈段</li></ol><h2 id="函数形式"><a href="#函数形式" class="headerlink" title="函数形式"></a>函数形式</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">execl</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *arg0, ... <span class="hljs-comment">/* (char *)0 */</span>;  <span class="hljs-comment">//l代表列表list</span></span><br><span class="hljs-params"></span><br><span class="hljs-params"><span class="hljs-type">int</span> execv(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[]);,       <span class="hljs-comment">//v表示矢量vector</span></span><br><span class="hljs-params"></span><br><span class="hljs-params"><span class="hljs-type">int</span> execle(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *arg0, ... <span class="hljs-comment">/* (char *)0, char *const envp[] */</span> );          <span class="hljs-comment">//e代表environment，表明可以导入环境变量</span></span><br><span class="hljs-params"> </span><br><span class="hljs-params"><span class="hljs-type">int</span> execve(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[]);</span><br><span class="hljs-params"></span><br><span class="hljs-params"><span class="hljs-type">int</span> execlp(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *arg0, ... <span class="hljs-comment">/* (char *)0 */</span>;</span><br><span class="hljs-params"></span><br><span class="hljs-params"><span class="hljs-type">int</span> execvp(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[]];,</span><br><span class="hljs-params"></span><br><span class="hljs-params"><span class="hljs-type">int</span> fexecve(<span class="hljs-type">int</span> fd, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[]);</span><br></code></pre></td></tr></table></figure><p>返回值：<br>若出错则返回-1，若成功则不返回。</p><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><p>pathname</p><p>前4个函数参数为路径名</p><p>filename</p><p>两个以filename为参数的函数（execlp和execvp），如果包含“&#x2F;”，则就将其视为路径名.则就按PATH环境变量，在它所指定的各目录中搜寻可执行文件,</p><h4 id="PATH介绍"><a href="#PATH介绍" class="headerlink" title="PATH介绍"></a>PATH介绍</h4><p>PATH变量包含了一张目录表（称为路径前缀），目录之间用冒号（:）分隔。例如：<br>PATH&#x3D;&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:.<br>因为大部分的可执行文件都放在bin中，因此默认为bin文件夹下，并且最后的.表示当前文件夹。</p><h5 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h5><p>若execlp或exevcvp使用路径前缀中的一个找到了一个可执行文件，但是该文件不是由连接编辑器产生的机器可执行文件，则就认为该文件时一个shell脚本，于是尝试调用&#x2F;bin&#x2F;sh，并以该filename作为shell的输入。</p><h4 id="args介绍"><a href="#args介绍" class="headerlink" title="args介绍"></a>args介绍</h4><p>execl、execlp和execle是l（列表）系列：输入参数args就是新可执行二进制文件的输入参数。例如我们选中的可执行二进制文件为date，命令为date +%s，那么arg0就是”date”，arg1就是”+%s”，并且以<strong>NULL结尾</strong>。<br>另外四个函数则应该先构造一个指向各参数的指针数组，然后将该数组地址作为这四个函数的参数。</p><h4 id="环境表介绍"><a href="#环境表介绍" class="headerlink" title="环境表介绍"></a>环境表介绍</h4><p>e表示环境，以e结尾的3个函数（execle、execve和fexecve）都可以传递一个指向环境字符串指针数组的指针。其他四个函数则使用调用进程中的environ变量为新程序复制现有的环境。</p><h5 id="注意：-2"><a href="#注意：-2" class="headerlink" title="注意："></a>注意：</h5><p>这7个函数只有execve是内核的系统调用。另外6个只是库函数，它们最终都要调用该系统调用。它们的关系如下：<br><img src="https://pic.downk.cc/item/5fc636cef81f7e3bd97f462c.jpg"></p><h3 id="基本实现举例"><a href="#基本实现举例" class="headerlink" title="基本实现举例"></a>基本实现举例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-type">int</span> pid;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Begin!&quot;</span>);<br>  fflush(<span class="hljs-literal">NULL</span>);<br>  pid=fork();<br>  <span class="hljs-keyword">if</span>(pid &lt; <span class="hljs-number">0</span>)&#123;<br>    perror(<span class="hljs-string">&quot;fork()&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>)&#123;<br>    execl(<span class="hljs-string">&quot;/bin/date&quot;</span>,<span class="hljs-string">&quot;date&quot;</span>,<span class="hljs-string">&quot;+%s&quot;</span>,<span class="hljs-literal">NULL</span>);<br>    perror(<span class="hljs-string">&quot;execl()&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  wait(<span class="hljs-literal">NULL</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;End!&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>解释：<br><img src="https://pic.downk.cc/item/5fc63729f81f7e3bd97f5a02.jpg"></p><p>fig8.16.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><br><span class="hljs-type">char</span>*env_init[] = &#123; <span class="hljs-string">&quot;USER=unknown&quot;</span>, <span class="hljs-string">&quot;PATH=/tmp&quot;</span>, <span class="hljs-literal">NULL</span> &#125;;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* specify pathname, specify environment */</span><br><span class="hljs-keyword">if</span> (execle(<span class="hljs-string">&quot;/home/sar/bin/echoall&quot;</span>, <span class="hljs-string">&quot;echoall&quot;</span>, <span class="hljs-string">&quot;myarg1&quot;</span>,<br><span class="hljs-string">&quot;MY ARG2&quot;</span>, (<span class="hljs-type">char</span> *)<span class="hljs-number">0</span>, env_init) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;execle error&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (waitpid(pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;wait error&quot;</span>);<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* specify filename, inherit environment */</span><br><span class="hljs-keyword">if</span> (execlp(<span class="hljs-string">&quot;echoall&quot;</span>, <span class="hljs-string">&quot;echoall&quot;</span>, <span class="hljs-string">&quot;only 1 arg&quot;</span>, (<span class="hljs-type">char</span> *)<span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;execlp error&quot;</span>);<br>&#125;<br><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>解释：</p><p><img src="https://pic.downk.cc/item/5fc636e5f81f7e3bd97f4b5c.jpg"></p><h3 id="注意：-3"><a href="#注意：-3" class="headerlink" title="注意："></a>注意：</h3><p>这里的echoall是任意命令行的意思</p><h1 id="5-更改用户ID和更改组ID"><a href="#5-更改用户ID和更改组ID" class="headerlink" title="5 更改用户ID和更改组ID"></a>5 更改用户ID和更改组ID</h1><h2 id="文件权限、用户权限和组权限介绍"><a href="#文件权限、用户权限和组权限介绍" class="headerlink" title="文件权限、用户权限和组权限介绍"></a>文件权限、用户权限和组权限介绍</h2><p>文件权限有三种：<br>r：可写<br>w：可读<br>x：可执行<br>当我们执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l /usr/bin/passwd<br></code></pre></td></tr></table></figure><p>时，我们可以看到<br><img src="https://pic.downk.cc/item/5fc6361ff81f7e3bd97eda23.jpg"><br>以三个为一组，分别是用户权限、组权限和其他用户权限。<br>以用户权限为例，有两种用户权限，一种是real用户权限，一种是effective用户权限，一种是saved set-user-ID（保存的设置用户ID）。<br>执行命令判断的时候判断的是effective用户权限。在这里用户权限对应的前三个为-rw，代表该文件可以读写，但是不能执行。</p><h3 id="若当我们执行一个passwd命令行。"><a href="#若当我们执行一个passwd命令行。" class="headerlink" title="若当我们执行一个passwd命令行。"></a>若当我们执行一个passwd命令行。</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">passwd;     //更改密码<br></code></pre></td></tr></table></figure><p>查看其权限：<br><img src="https://pic.downk.cc/item/5fc6361ff81f7e3bd97eda23.jpg"></p><p>执行该命令时，shell首先fork出一个子进程，然后马上让子进程变成passwd新进程，此时passwd和进程和原来的终端进程的用户ID和组ID都是完全相同的。并且pawwd设置成了u+s权限。</p><h4 id="u-s权限"><a href="#u-s权限" class="headerlink" title="u+s权限"></a>u+s权限</h4><p>一个文件若有u+s权限。针对某个程序任何用户都有读写这个程序的权限，可以像root用户一样操作，这个指令只对程序有效，如果用此权限放在路径上是无效的。</p><h4 id="g-s权限"><a href="#g-s权限" class="headerlink" title="g+s权限"></a>g+s权限</h4><p>一个文件若有g+s权限。它的意思是强制将此群组里的目录下文件编入到此群组中，无论是哪个用户创建的文件。</p><h2 id="Linux-shell执行过程"><a href="#Linux-shell执行过程" class="headerlink" title="Linux shell执行过程"></a>Linux shell执行过程</h2><p><img src="https://pic.downk.cc/item/5fc63707f81f7e3bd97f521a.jpg"></p><h2 id="设置实际和有效用户-x2F-组ID"><a href="#设置实际和有效用户-x2F-组ID" class="headerlink" title="设置实际和有效用户&#x2F;组ID"></a>设置实际和有效用户&#x2F;组ID</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setuid</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> uid)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setgid</span><span class="hljs-params">(<span class="hljs-type">gid_t</span> gid)</span>;<br></code></pre></td></tr></table></figure><h2 id="设置用户ID的规则（和组ID完全相同）"><a href="#设置用户ID的规则（和组ID完全相同）" class="headerlink" title="设置用户ID的规则（和组ID完全相同）"></a>设置用户ID的规则（和组ID完全相同）</h2><ol><li>若进程具有超级用户特权，则setuid函数将实际用户ID、有效用于ID以及保存的设置用户ID(saved set-user-ID）设置为uid。</li><li>若进程没有超级用户特权，但是uid等于实际用户ID或保存的设置用户ID，则setuid只将有效ID设置为uid。不更改实际用户ID和保存的设置用户ID。</li><li>如果上面两个条件都不满足，则errno设置为EPERM，并返回-1.</li></ol><h3 id="关于r，e和s三种ID，需要注意："><a href="#关于r，e和s三种ID，需要注意：" class="headerlink" title="关于r，e和s三种ID，需要注意："></a>关于r，e和s三种ID，需要注意：</h3><p>只有超级用户进程可以更改实际用户ID。通常实际用户ID是在用户登录时由login(1)程序设置的，而且绝不会改变它。因为login是一个超级用户进程，当它调用setuid时，设置所有的3个用户ID（具体看上面的Linux shell执行过程图）<br>总结：<br><img src="https://pic.downk.cc/item/5fc636a7f81f7e3bd97f3e2f.jpg"></p><h2 id="函数setreuid和setregid"><a href="#函数setreuid和setregid" class="headerlink" title="函数setreuid和setregid"></a>函数setreuid和setregid</h2><p>功能是交换实际用户ID和有效用户ID</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setreuid</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> ruid, <span class="hljs-type">uid_t</span> euid)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setregid</span><span class="hljs-params">(<span class="hljs-type">gid_t</span> rgid, <span class="hljs-type">gid_t</span> egid)</span>;<br></code></pre></td></tr></table></figure><p>若其中任一参数为-1，则表示相应的ID应该保持不变</p><h2 id="函数seteuid和setegid"><a href="#函数seteuid和setegid" class="headerlink" title="函数seteuid和setegid"></a>函数seteuid和setegid</h2><p>功能是改变有效用户ID和有效组ID</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">seteuid</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> uid)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setegid</span><span class="hljs-params">(<span class="hljs-type">gid_t</span> gid)</span>;<br></code></pre></td></tr></table></figure><h2 id="组ID"><a href="#组ID" class="headerlink" title="组ID"></a>组ID</h2><p>上面所介绍的所有函数将u改成g就可以了。</p><h1 id="5-函数system"><a href="#5-函数system" class="headerlink" title="5 函数system"></a>5 函数system</h1><p>在程序中执行一个命令字符串。也就是在一个C程序中调用一行命令行。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">system</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *cmdstring)</span><br></code></pre></td></tr></table></figure><h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p>因为system在其实现中调用了fork、exec、waitpid，其实就是few的一个简单封装，因此有3种返回值。</p><ol><li>fork失败或者waitpid返回除ENTER以外的错误，则system返回-1，并设置errno以指示错误类型</li><li>如果exec失败（表示不能执行shell），则返回时如同shell执行了exit(127)</li><li>否则所有3个函数都成功，那么system的返回值时shell的终止状态，其格式已在waitpid中说明。</li></ol><h2 id="system函数（不对信号处理）"><a href="#system函数（不对信号处理）" class="headerlink" title="system函数（不对信号处理）"></a>system函数（不对信号处理）</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">system</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *cmdstring)</span><span class="hljs-comment">/* version without signal handling */</span><br>&#123;<br><span class="hljs-type">pid_t</span>pid;<br><span class="hljs-type">int</span>status;<br><br><span class="hljs-keyword">if</span> (cmdstring == <span class="hljs-literal">NULL</span>)<br><span class="hljs-keyword">return</span>(<span class="hljs-number">1</span>);<span class="hljs-comment">/* always a command processor with UNIX */</span><br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>status = <span class="hljs-number">-1</span>;<span class="hljs-comment">/* probably out of processes */</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* child */</span><br>execl(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmdstring, (<span class="hljs-type">char</span> *)<span class="hljs-number">0</span>);<br>_exit(<span class="hljs-number">127</span>);<span class="hljs-comment">/* execl error */</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">/* parent */</span><br><span class="hljs-keyword">while</span> (waitpid(pid, &amp;status, <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">if</span> (errno != EINTR) &#123;<br>status = <span class="hljs-number">-1</span>; <span class="hljs-comment">/* error other than EINTR from waitpid() */</span><br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">return</span>(status);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，其实就是一个简单的对fork、exec和waitpid的一个封装，从而让其执行命令行。</p><h2 id="举例：调用system函数"><a href="#举例：调用system函数" class="headerlink" title="举例：调用system函数"></a>举例：调用system函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>status;<br><br><span class="hljs-keyword">if</span> ((status = system(<span class="hljs-string">&quot;date&quot;</span>)) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;system() error&quot;</span>);<br><br>pr_exit(status);<br><br><span class="hljs-keyword">if</span> ((status = system(<span class="hljs-string">&quot;nosuchcommand&quot;</span>)) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;system() error&quot;</span>);<br><br>pr_exit(status);<br><br><span class="hljs-keyword">if</span> ((status = system(<span class="hljs-string">&quot;who; exit 44&quot;</span>)) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;system() error&quot;</span>);<br><br>pr_exit(status);<br><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：<br><img src="https://pic.downk.cc/item/5fc63658f81f7e3bd97ee576.jpg"></p><h1 id="6-进程调度"><a href="#6-进程调度" class="headerlink" title="6 进程调度"></a>6 进程调度</h1><h2 id="友好值"><a href="#友好值" class="headerlink" title="友好值"></a>友好值</h2><p>进程可以通过调整友好值选择以更低优先级哦运行（通过调整友好值降低它对CPU的战友，因此该进程是“友好的”）。只有特权进程允许提高调度权限。</p><h2 id="调整友好值"><a href="#调整友好值" class="headerlink" title="调整友好值"></a>调整友好值</h2><p>进程可以通过nice函数获取或者更改它的友好值。使用这个函数，进程只能影响自己的友好值，不能影响其他任何进程的友好值</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">nice</span><span class="hljs-params">(<span class="hljs-type">int</span> incr)</span>;<br></code></pre></td></tr></table></figure><p>若成功则返回新的友好值，若出错则返回-1.<br>参数incr被增加到调用进程的友好值上，如果incr太大，系统会直接把它降到最大合法值，不给出提示；如果太小会直接把它升到最小合法值</p><p>函数getpriority可以像nice那样获取进程的友好值，此外，它还可以获取一组相关进程的友好值。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/resource.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">getpriority</span><span class="hljs-params">(<span class="hljs-type">int</span> which, <span class="hljs-type">id_t</span> who)</span>;<br></code></pre></td></tr></table></figure><p>若成功返回友好值，失败返回-1.<br>参数选择：<br>which：PRIO_PROCESS代表进程，PRIO_PGRP表示进程组，PRIO_USER表示用户ID。</p><p>函数setpriority可以为进程、进程组和属于特定用户ID的所有进程设置优先级。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/resource.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setpriority</span><span class="hljs-params">(<span class="hljs-type">int</span> which, <span class="hljs-type">id_t</span> who)</span>;<br></code></pre></td></tr></table></figure><h1 id="7-进程时间"><a href="#7-进程时间" class="headerlink" title="7 进程时间"></a>7 进程时间</h1><p>最开始就说明了，我们可以度量3个时间：墙上时钟时间、用户CPU时间和系统CPU时间。任一进程都可调用times函数获得它自己以及已终止子进程的上述值。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/times.h&gt;</span></span><br><br><span class="hljs-type">clock_t</span> <span class="hljs-title function_">times</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> tms *buf)</span>;<br></code></pre></td></tr></table></figure><p>返回值：<br>若成功返回时钟滴答数，若出错返回-1<br>tms结构体：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tms</span> &#123;</span><br>   <span class="hljs-type">clock_t</span> tms_utimes;        <span class="hljs-comment">/* user CPU time  */</span><br>   <span class="hljs-type">clock_t</span> tms_stime;         <span class="hljs-comment">/* system CPU time */</span><br>   <span class="hljs-type">clock_t</span> tms_cutime;        <span class="hljs-comment">/* user CPU time, terminated children */</span><br>   <span class="hljs-type">clock_t</span> tms_cstime;        <span class="hljs-comment">/* system CPU time, terminated childern */</span><br>&#125;<br></code></pre></td></tr></table></figure><p>注意：<br>此结构体没有包含墙上时钟时间。times函数返回墙上时钟时间作为函数值。此值时相对于过去某一个时刻度量的，所以不能用其绝对值而必须使用其相对值。<br>例如：<br>调用times，保存其返回值。以后某个时间再次调用times，从新返回的值中减去以前返回的值，这个差值就是墙上时钟时间。<br>所有由times函数返回的clock_t值都用_SC_CLK_TCK(由sysconf函数返回的每秒时钟滴答数）转换成秒数。</p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/times.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">pr_times</span><span class="hljs-params">(<span class="hljs-type">clock_t</span>, <span class="hljs-keyword">struct</span> tms *, <span class="hljs-keyword">struct</span> tms *)</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">void</span><span class="hljs-title function_">do_cmd</span><span class="hljs-params">(<span class="hljs-type">char</span> *)</span>;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br><span class="hljs-type">int</span>i;<br><br>setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; argc; i++)<br>do_cmd(argv[i]);<span class="hljs-comment">/* once for each command-line arg */</span><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">do_cmd</span><span class="hljs-params">(<span class="hljs-type">char</span> *cmd)</span><span class="hljs-comment">/* execute and time the &quot;cmd&quot; */</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tms</span><span class="hljs-title">tmsstart</span>, <span class="hljs-title">tmsend</span>;</span><br><span class="hljs-type">clock_t</span>start, end;<br><span class="hljs-type">int</span>status;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\ncommand: %s\n&quot;</span>, cmd);<br><br><span class="hljs-keyword">if</span> ((start = times(&amp;tmsstart)) == <span class="hljs-number">-1</span>)<span class="hljs-comment">/* starting values */</span><br>err_sys(<span class="hljs-string">&quot;times error&quot;</span>);<br><br><span class="hljs-keyword">if</span> ((status = system(cmd)) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">/* execute command */</span><br>err_sys(<span class="hljs-string">&quot;system() error&quot;</span>);<br><br><span class="hljs-keyword">if</span> ((end = times(&amp;tmsend)) == <span class="hljs-number">-1</span>)<span class="hljs-comment">/* ending values */</span><br>err_sys(<span class="hljs-string">&quot;times error&quot;</span>);<br><br>pr_times(end-start, &amp;tmsstart, &amp;tmsend);<br>pr_exit(status);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">pr_times</span><span class="hljs-params">(<span class="hljs-type">clock_t</span> real, <span class="hljs-keyword">struct</span> tms *tmsstart, <span class="hljs-keyword">struct</span> tms *tmsend)</span><br>&#123;<br><span class="hljs-type">static</span> <span class="hljs-type">long</span>clktck = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span> (clktck == <span class="hljs-number">0</span>)<span class="hljs-comment">/* fetch clock ticks per second first time */</span><br><span class="hljs-keyword">if</span> ((clktck = sysconf(_SC_CLK_TCK)) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;sysconf error&quot;</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  real:  %7.2f\n&quot;</span>, real / (<span class="hljs-type">double</span>) clktck);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  user:  %7.2f\n&quot;</span>,<br>  (tmsend-&gt;tms_utime - tmsstart-&gt;tms_utime) / (<span class="hljs-type">double</span>) clktck);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  sys:   %7.2f\n&quot;</span>,<br>  (tmsend-&gt;tms_stime - tmsstart-&gt;tms_stime) / (<span class="hljs-type">double</span>) clktck);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  child user:  %7.2f\n&quot;</span>,<br>  (tmsend-&gt;tms_cutime - tmsstart-&gt;tms_cutime) / (<span class="hljs-type">double</span>) clktck);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  child sys:   %7.2f\n&quot;</span>,<br>  (tmsend-&gt;tms_cstime - tmsstart-&gt;tms_cstime) / (<span class="hljs-type">double</span>) clktck);<br>&#125;<br></code></pre></td></tr></table></figure><p>执行结果：<br><img src="https://pic.downk.cc/item/5fc6367bf81f7e3bd97f06ad.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7fd33155413e.html"/>
    <url>/2022/12/7fd33155413e.html</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>我们平时在写java程序时免不得要进行调试，并且在学习例如反射等知识时，对源码的一些关键信息我们需要写一写注解，但如果使用下载的jdk，我们不能编译，只能把注释写在行尾，不能写多行注释，非常难受。<br>并且做了这么久Java程序员，难道不想拥有一个属于自己的（装逼用的）jdk吗？你甚至能在每次<code>System.out.println(&quot;&quot;)</code>时输出的都是<code>xxx最帅</code>。</p><h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>该教程的目的是利用MacOS编译openjdk11。<br>讲述了编译的过程以及遇到了一大堆坑</p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul><li><p>操作系统版本</p>  <img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809182736.png height=300></li><li><p>bootJDK<br>  编译新的jdk需要本身有一个jdk存在。这个版本需要<code>≥ 你所需要编译的jdk版本 -1</code><br>  我的电脑有两个jdk环境（jdk1.8和jdk11），编译时可以指定安装的jdk版本，注意，在这里只能用jdk11，不能用jdk1.8</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ls</span></span><br>jaotc       javap       jfr         jmap        jstat       rmiregistry<br>jar         jcmd        jhsdb       jmod        jstatd      serialver<br>jarsigner   jconsole    jimage      jps         keytool     unpack200<br>java        jdb         jinfo       jrunscript  pack200<br>javac       jdeprscan   jjs         jshell      rmic<br>javadoc     jdeps       jlink       jstack      rmid<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">./java -version</span><br>openjdk version &quot;11.0.8-vectorapi&quot; 2019-03-30<br>OpenJDK Runtime Environment TencentKonaJDK (build 11.0.8-vectorapi+3-20210106)<br>OpenJDK 64-Bit Server VM TencentKonaJDK (build 11.0.8-vectorapi+3-20210106, mixed mode)<br></code></pre></td></tr></table></figure><p>  注：我这里用的不是官方的jdk，用的是我们公司内部的jdk，不过没有影响，同样可以进行编译</p></li><li><p>clang版本</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">clang --version</span> <br>Apple clang version 12.0.5 (clang-1205.0.22.9)<br>Target: x86_64-apple-darwin20.6.0<br>Thread model: posix<br>InstalledDir: /Library/Developer/CommandLineTools/usr/bin<br></code></pre></td></tr></table></figure></li><li><p>clang++版本</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">clang++ --version</span><br>Apple clang version 12.0.5 (clang-1205.0.22.9)<br>Target: x86_64-apple-darwin20.6.0<br>Thread model: posix<br>InstalledDir: /Library/Developer/CommandLineTools/usr/bin<br></code></pre></td></tr></table></figure></li><li><p>autoconf<br>  没有安装autoconf，可以通过<code>brew install autoconf</code>安装</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">autoconf --version</span><br>autoconf (GNU Autoconf) 2.71<br>Copyright (C) 2021 Free Software Foundation, Inc.<br>License GPLv3+/Autoconf: GNU GPL version 3 or later<br>&lt;https://gnu.org/licenses/gpl.html&gt;, &lt;https://gnu.org/licenses/exceptions.html&gt;<br>This is free software: you are free to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.<br>Written by David J. MacKenzie and Akim Demaille.<br></code></pre></td></tr></table></figure></li><li><p>make版本</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make --version</span><br>GNU Make 3.81<br>Copyright (C) 2006  Free Software Foundation, Inc.<br>This is free software; see the source for copying conditions.<br>There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A<br>PARTICULAR PURPOSE.<br>This program built for i386-apple-darwin11.3.0<br></code></pre></td></tr></table></figure></li><li><p>freetype版本<br>  同样通过<code>brew install freetype</code></p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">freetype-config --version</span><br>24.0.18<br></code></pre></td></tr></table></figure></li><li><p>xcodebuild工具安装<br>直接在App Store上安装Xcode（大概11个g，安装也要很久，请耐心等待）。若是不安装，在执行configure脚本检查环境时系统报错：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">configure: error: No xcodebuild tool and no system framework headers found, use --with-sysroot or --with-sdk-name to provide a path to a valid SDK<br>/Users/coachhe/Tools/jdk-compile/openjdk11/build/.configure-support/generated-configure.sh: line 84: 5: Bad file descriptor<br>configure exiting with result code 1<br></code></pre></td></tr></table></figure><p>  解决方法是：</p><ol><li><p>安装xcode工具</p> <img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809193244.png height=200></li><li><p>执行以下命令</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer</span><br></code></pre></td></tr></table></figure></li></ol></li></ul><h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><h2 id="1-解压源码"><a href="#1-解压源码" class="headerlink" title="1. 解压源码"></a>1. 解压源码</h2><p>直接去下载源码压缩包是最快的，<a href="https://github.com/openjdk/jdk/releases/tag/jdk-11%2B28">openjdk11源码下载链接</a>， 当然，也可以直接在<a href="https://github.com/openjdk/jdk">openjdk github仓库</a>clone 参考文章<a href="https://segmentfault.com/a/1190000038268721">【openJDK系列1】macos编译openJDK 8</a></p><p>然后将其安装在某个本地文件夹并解压：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">pwd</span></span><br>/Users/coachhe/Tools/jdk-compile/openjdk11<br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ls</span></span><br>ADDITIONAL_LICENSE_INFO README                  make<br>ASSEMBLY_EXCEPTION      bin                     src<br>LICENSE                 configure               test<br>Makefile                doc<br></code></pre></td></tr></table></figure><h2 id="2-执行configure脚本检查环境"><a href="#2-执行configure脚本检查环境" class="headerlink" title="2. 执行configure脚本检查环境"></a>2. 执行configure脚本检查环境</h2><p>在该目录下执行configure脚本。<br>注意：如果bootjdk版本已经是系统的java环境那就不需要额外执行，直接<code>bash configure</code>即可，但是因为我的本地环境有两个jdk版本，并且默认的是jdk11，所以需要指定bootjdk版本。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bash configure --with-target-bits=64 --with-boot-jdk=/Library/Java/JavaVirtualMachines/tencent_jdk11</span><br></code></pre></td></tr></table></figure><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809193653.png><h2 id="3-开始编译"><a href="#3-开始编译" class="headerlink" title="3. 开始编译"></a>3. 开始编译</h2><p>编译过程中一共改了4个文件才最终编译成功。<br>执行make：</p><h3 id="第1个错误"><a href="#第1个错误" class="headerlink" title="第1个错误"></a>第1个错误</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"> make</span><br>Building target &#x27;default (exploded-image)&#x27; in configuration &#x27;macosx-x86_64-normal-server-release&#x27;<br>Warning: No mercurial configuration present and no .src-rev<br>Compiling 8 files for BUILD_TOOLS_LANGTOOLS<br><br>/Users/coachhe/Documents/jdk/jdk11/src/hotspot/share/runtime/arguments.cpp:1461:35: error: result of comparison against a string literal is unspecified (use an explicit string comparison function instead) [-Werror,-Wstring-compare]<br>      if (old_java_vendor_url_bug != DEFAULT_VENDOR_URL_BUG) &#123;<br>                                  ^  ~~~~~~~~~~~~~~~~~~~~~~<br>1 error generated.<br>make[3]: *** [/Users/coachhe/Documents/jdk/jdk11/build/macosx-x86_64-normal-server-release/hotspot/variant-server/libjvm/objs/arguments.o] Error 1<br>make[3]: *** Waiting for unfinished jobs....<br>Compiling 90 properties into resource bundles for java.desktop<br>Compiling 2961 files for java.base<br>make[2]: *** [hotspot-server-libs] Error 2<br>make[2]: *** Waiting for unfinished jobs....<br><br>ERROR: Build failed for target &#x27;default (exploded-image)&#x27; in configuration &#x27;macosx-x86_64-normal-server-release&#x27; (exit code 2) <br>Stopping sjavac server<br><br>=== Output from failing command(s) repeated here ===<br>* For target hotspot_variant-server_libjvm_objs_arguments.o:<br>/Users/coachhe/Documents/jdk/jdk11/src/hotspot/share/runtime/arguments.cpp:1461:35: error: result of comparison against a string literal is unspecified (use an explicit string comparison function instead) [-Werror,-Wstring-compare]<br>      if (old_java_vendor_url_bug != DEFAULT_VENDOR_URL_BUG) &#123;<br>                                  ^  ~~~~~~~~~~~~~~~~~~~~~~<br>1 error generated.<br><br>* All command lines available in /Users/coachhe/Documents/jdk/jdk11/build/macosx-x86_64-normal-server-release/make-support/failure-logs.<br>=== End of repeated output ===<br><br>No indication of failed target found.<br>Hint: Try searching the build log for &#x27;] Error&#x27;.<br>Hint: See doc/building.html#troubleshooting for assistance.<br><br>make[1]: *** [main] Error 2<br>make: *** [default] Error 2<br></code></pre></td></tr></table></figure><p>根据提示，需要修改<code>src/hotspot/share/runtime/arguments.cpp</code>文件的源码：<br>将第1461行的常量从<code>DEFAULT_VENDOR_URL_BUG</code>更改为<code>0</code><br>更改前：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">1461       if (old_java_vendor_url_bug != DEFAULT_VENDOR_URL_BUG) &#123;<br></code></pre></td></tr></table></figure><p>更改后：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">1461       if (old_java_vendor_url_bug != 0) &#123;<br></code></pre></td></tr></table></figure><h3 id="第2个错误"><a href="#第2个错误" class="headerlink" title="第2个错误"></a>第2个错误</h3><p>更改源码之后，重新make clean，然后make</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"> make clean</span><br>Building target &#x27;clean&#x27; in configuration &#x27;macosx-x86_64-normal-server-release&#x27;<br>... ...<br><span class="hljs-meta prompt_">$ </span><span class="language-bash"> make</span><br>... ...<br><br>=== Output from failing command(s) repeated here ===<br>* For target hotspot_variant-server_libjvm_objs_sharedRuntime.o:<br>/Users/coachhe/Documents/jdk/jdk11/src/hotspot/share/runtime/sharedRuntime.cpp:2798:85: error: expression does not compute the number of elements in this array; element type is &#x27;double&#x27;, not &#x27;relocInfo&#x27; [-Werror,-Wsizeof-array-div]<br>      buffer.insts()-&gt;initialize_shared_locs((relocInfo*)locs_buf, sizeof(locs_buf) / sizeof(relocInfo));<br>                                                                          ~~~~~~~~  ^<br>/Users/coachhe/Documents/jdk/jdk11/src/hotspot/share/runtime/sharedRuntime.cpp:2797:14: note: array &#x27;locs_buf&#x27; declared here<br>      double locs_buf[20];<br>             ^<br>/Users/coachhe/Documents/jdk/jdk11/src/hotspot/share/runtime/sharedRuntime.cpp:2798:85: note: place parentheses around the &#x27;sizeof(relocInfo)&#x27; expression to silence this warning<br>      buffer.insts()-&gt;initialize_shared_locs((relocInfo*)locs_buf, sizeof(locs_buf) / sizeof(relocInfo));<br>                                                                                    ^<br>1 error generated.<br><br>* All command lines available in /Users/coachhe/Documents/jdk/jdk11/build/macosx-x86_64-normal-server-release/make-support/failure-logs.<br>=== End of repeated output ===<br><br>No indication of failed target found.<br>Hint: Try searching the build log for &#x27;] Error&#x27;.<br>Hint: See doc/building.html#troubleshooting for assistance.<br><br>make[1]: *** [main] Error 2<br>make: *** [default] Error 2<br></code></pre></td></tr></table></figure><p>根据，提示，我们需要修改<code>src/hotspot/share/runtime/sharedRuntime.cpp</code>这个文件的源码。<br>更改前：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">2798</span>       buffer.insts()-&gt;initialize_shared_locs((relocInfo*)locs_buf, sizeof(locs_buf) / sizeof(relocInfo));<br></code></pre></td></tr></table></figure><p>更改后：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">2798</span>       buffer.insts()-&gt;initialize_shared_locs((relocInfo*)locs_buf, (sizeof(locs_buf)) / (sizeof(relocInfo)));<br></code></pre></td></tr></table></figure><p>你没看错。。就是增加了两个括号而已，但是就是这么神奇，不加就报错，加了就不报错</p><h3 id="第3个错误"><a href="#第3个错误" class="headerlink" title="第3个错误"></a>第3个错误</h3><p>重新make clean后，再次make，这时候出现了第三个编译错误。。。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"> make clean</span><br>Building target &#x27;clean&#x27; in configuration &#x27;macosx-x86_64-normal-server-release&#x27;<br>... ...<br><span class="hljs-meta prompt_">$ </span><span class="language-bash"> make</span><br>... ... <br><br>=== Output from failing command(s) repeated here ===<br>* For target support_native_java.desktop_libawt_lwawt_CSystemColors.o:<br>/Users/coachhe/Documents/jdk/jdk11/src/java.desktop/macosx/native/libawt_lwawt/awt/CSystemColors.m:134:9: error: converting the result of &#x27;?:&#x27; with integer constants to a boolean always evaluates to &#x27;true&#x27; [-Werror,-Wtautological-constant-compare]<br>    if (colorIndex &lt; (useAppleColor) ? sun_lwawt_macosx_LWCToolkit_NUM_APPLE_COLORS : java_awt_SystemColor_NUM_COLORS) &#123;<br>        ^<br>1 error generated.<br><br>* All command lines available in /Users/coachhe/Documents/jdk/jdk11/build/macosx-x86_64-normal-server-release/make-support/failure-logs.<br>=== End of repeated output ===<br><br>No indication of failed target found.<br>Hint: Try searching the build log for &#x27;] Error&#x27;.<br>Hint: See doc/building.html#troubleshooting for assistance.<br><br>make[1]: *** [main] Error 2<br>make: *** [default] Error 2<br></code></pre></td></tr></table></figure><p>从错误信息里面可以看出，我们这里需要修改<code>src/java.desktop/macosx/native/libawt_lwawt/awt/CSystemColors.m</code>这个文件，修改方式和第2个错误基本相同，也是加括号&#x3D;_&#x3D;</p><p>修改前：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">134</span>     <span class="hljs-keyword">if</span> (colorIndex &lt; (useAppleColor) ? sun_lwawt_macosx_LWCToolkit_NUM_APPLE_COLORS : java_awt_SystemColor_NUM_COLORS) &#123;<br></code></pre></td></tr></table></figure><p>修改后：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">134</span>     <span class="hljs-keyword">if</span> (colorIndex &lt; ((useAppleColor) ? sun_lwawt_macosx_LWCToolkit_NUM_APPLE_COLORS : java_awt_SystemColor_NUM_COLORS)) &#123;<br></code></pre></td></tr></table></figure><p>基本没啥差别，就是加了个括号。</p><h3 id="第4个错误"><a href="#第4个错误" class="headerlink" title="第4个错误"></a>第4个错误</h3><p>这时再次make，还会出现一个错误（最后一个了。。。）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make clean</span><br>... ...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make</span><br>... ...<br><br>ERROR: Build failed for target &#x27;default (exploded-image)&#x27; in configuration &#x27;macosx-x86_64-normal-server-release&#x27; (exit code 2)<br>Stopping sjavac server<br><br>=== Output from failing command(s) repeated here ===<br>* For target support_native_java.desktop_libjsound_PLATFORM_API_MacOSX_MidiUtils.o:<br>/Users/coachhe/Tools/jdk-compile/openjdk11/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_MidiUtils.c:263:31: error: cast to smaller integer type &#x27;MIDIClientRef&#x27; (aka &#x27;unsigned int&#x27;) from &#x27;void *&#x27; [-Werror,-Wvoid-pointer-to-int-cast]<br>static MIDIClientRef client = (MIDIClientRef) NULL;<br>                              ^~~~~~~~~~~~~~~~~~~~<br>/Users/coachhe/Tools/jdk-compile/openjdk11/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_MidiUtils.c:264:29: error: cast to smaller integer type &#x27;MIDIPortRef&#x27; (aka &#x27;unsigned int&#x27;) from &#x27;void *&#x27; [-Werror,-Wvoid-pointer-to-int-cast]<br>static MIDIPortRef inPort = (MIDIPortRef) NULL;<br>                            ^~~~~~~~~~~~~~~~~~<br>/Users/coachhe/Tools/jdk-compile/openjdk11/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_MidiUtils.c:265:30: error: cast to smaller integer type &#x27;MIDIPortRef&#x27; (aka &#x27;unsigned int&#x27;) from &#x27;void *&#x27; [-Werror,-Wvoid-pointer-to-int-cast]<br>static MIDIPortRef outPort = (MIDIPortRef) NULL;<br>                             ^~~~~~~~~~~~~~~~~~<br>/Users/coachhe/Tools/jdk-compile/openjdk11/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_MidiUtils.c:471:32: error: cast to smaller integer type &#x27;MIDIEndpointRef&#x27; (aka &#x27;unsigned int&#x27;) from &#x27;void *&#x27; [-Werror,-Wvoid-pointer-to-int-cast]<br>    MIDIEndpointRef endpoint = (MIDIEndpointRef) NULL;<br>                               ^~~~~~~~~~~~~~~~~~~~~~<br>   ... (rest of output omitted)<br><br>* All command lines available in /Users/coachhe/Tools/jdk-compile/openjdk11/build/macosx-x86_64-normal-server-release/make-support/failure-logs.<br>=== End of repeated output ===<br><br>No indication of failed target found.<br>Hint: Try searching the build log for &#x27;] Error&#x27;.<br>Hint: See doc/building.html#troubleshooting for assistance.<br><br>make[1]: *** [main] Error 2<br>make: *** [default] Error 2<br></code></pre></td></tr></table></figure><p>可以看到，这里需要修改<code>src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_MidiUtils.c</code>文件的4个地方。但是修改方式是统一的，都是将括号里的内容（<code>MIDIClientRef</code>,<code>MIDIPortRef</code>,<code>MIDIEndpointRef</code>）修改为<code>unsigned long</code>。</p><p>修改前：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">263</span> <span class="hljs-type">static</span> MIDIClientRef client = (MIDIClientRef) <span class="hljs-literal">NULL</span>;<br><span class="hljs-number">264</span> <span class="hljs-type">static</span> MIDIPortRef inPort = (MIDIPortRef) <span class="hljs-literal">NULL</span>;<br><span class="hljs-number">265</span> <span class="hljs-type">static</span> MIDIPortRef outPort = (MIDIPortRef) <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-number">471</span> MIDIEndpointRef endpoint = (MIDIEndpointRef) <span class="hljs-literal">NULL</span>;<br></code></pre></td></tr></table></figure><p>修改后：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">263</span> <span class="hljs-type">static</span> MIDIClientRef client = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) <span class="hljs-literal">NULL</span>;<br><span class="hljs-number">264</span> <span class="hljs-type">static</span> MIDIPortRef inPort = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) <span class="hljs-literal">NULL</span>;<br><span class="hljs-number">265</span> <span class="hljs-type">static</span> MIDIPortRef outPort = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-number">471</span> MIDIEndpointRef endpoint = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) <span class="hljs-literal">NULL</span>;<br></code></pre></td></tr></table></figure><p>编译过程中会出现这些警告，可以忽视</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">注: 某些输入文件使用或覆盖了已过时的 API。<br>注: 有关详细信息, 请使用 -Xlint:deprecation 重新编译。<br>注: 某些输入文件使用或覆盖了已过时的 API。<br>注: 有关详细信息, 请使用 -Xlint:deprecation 重新编译。<br>注: 某些输入文件使用了未经检查或不安全的操作。<br>注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。<br><br><br>Warning: generation and use of skeletons and static stubs for JRMP<br><br><br>ld: warning: directory not found for option &#x27;-F/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.3.sdk/System/Library/Frameworks/JavaVM.framework/Frameworks&#x27;<br></code></pre></td></tr></table></figure><h3 id="4-编译成功"><a href="#4-编译成功" class="headerlink" title="4. 编译成功"></a>4. 编译成功</h3><p>终于终于终于编译成功了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Compiling 4 files for BUILD_JIGSAW_TOOLS<br>Stopping sjavac server<br>Finished building target &#x27;default (exploded-image)&#x27; in configuration &#x27;macosx-x86_64-normal-server-release&#x27;<br></code></pre></td></tr></table></figure><p>我们进入对应目录：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809202548.png height=100></p><p>至此我们终于编译完成了，可以在IDEA中选择我们编译成功的jdk版本：</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>首先在IDEA中，点击<code>File-&gt;Project Structure</code>，删除现有的SDKs<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203004.png height=500></p><p>然后重新添加我们目录下的SDK<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203150.png height=500><br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203248.png height=500></p><p>此时源码还是只读的，无法进行更改，这是因为这里的源码我们还是默认去系统<code>$JAVA_HOME</code>目录下的src里面找的Java源代码，因为我们还需要将Sourcepath里面的src文件的目录进行修改：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203445.png height=500><br>点击加号之后添加我们自己的openjdk目录：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203537.png height = 500><br>添加之后确认：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203646.png height = 500></p><p>此时我们就可以进入源码进行修改了，例如最基础的<code>System.out.println()</code>，我们可以进入查看：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809204047.png height=500></p><p>修改之后对应文件目录下的src文件就会被更改了，然后重新在源文件目录下<code>make images</code>就可以更新了<br>注意：<code>make images</code>会在原来的基础上增量编译，不会重新编译了</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>jdk</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/3223a79b8303.html"/>
    <url>/2022/12/3223a79b8303.html</url>
    
    <content type="html"><![CDATA[<h1 id="MapReduce工作原理"><a href="#MapReduce工作原理" class="headerlink" title="MapReduce工作原理"></a>MapReduce工作原理</h1><h2 id="1-Map阶段工作大纲"><a href="#1-Map阶段工作大纲" class="headerlink" title="1 Map阶段工作大纲"></a>1 Map阶段工作大纲</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211014540.png"></p><h2 id="2-Reduce阶段工作大纲"><a href="#2-Reduce阶段工作大纲" class="headerlink" title="2 Reduce阶段工作大纲"></a>2 Reduce阶段工作大纲</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211014624.png"></p><h1 id="Shuffle机制"><a href="#Shuffle机制" class="headerlink" title="Shuffle机制"></a>Shuffle机制</h1><h2 id="1-Shuffle机制简介"><a href="#1-Shuffle机制简介" class="headerlink" title="1 Shuffle机制简介"></a>1 Shuffle机制简介</h2><p>上面的流程是整个MapReduce最全工作流程，但是Shuffle过程只是从第7步开始到第16步结束，具体Shuffle过程详解，如下： </p><p>1）MapTask收集我们的map()方法输出的kv对，放到内存缓冲区中 </p><p>2）从内存缓冲区不断溢出本地磁盘文件，可能会溢出多个文件 </p><p>3）多个溢出文件会被合并成大的溢出文件 </p><p>4）在溢出过程及合并的过程中，都要调用Partitioner进行分区和针对key进行排序 </p><p>5）ReduceTask根据自己的分区号，去各个MapTask机器上取相应的结果分区数据 </p><p>6）ReduceTask会取到同一个分区的来自不同MapTask的结果文件，ReduceTask会将这些文件再进行合并（归并排序） </p><p>7）合并成大文件后，Shuffle的过程也就结束了，后面进入ReduceTask的逻辑运算过程（从文件中取出一个一个的键值对Group，调用用户自定义的reduce()方法） </p><h2 id="2-Partition分区"><a href="#2-Partition分区" class="headerlink" title="2 Partition分区"></a>2 Partition分区</h2><h3 id="①-简介和默认分区方法"><a href="#①-简介和默认分区方法" class="headerlink" title="① 简介和默认分区方法"></a>① 简介和默认分区方法</h3><h4 id="问题引出"><a href="#问题引出" class="headerlink" title="问题引出"></a>问题引出</h4><p>要求将统计结果按照条件输出到不同文件中（分区）。<br>比如：<br>统计京东9月10号某商品top10排行<br>统计京东9月11号某商品top10排行<br>因此需要根据时间来进行分区，有几个文件就有几个区。（简单来说，就是有多少reduce就有多少分区） </p><h3 id="默认Partitioner分区是HashPartitioner"><a href="#默认Partitioner分区是HashPartitioner" class="headerlink" title="默认Partitioner分区是HashPartitioner"></a>默认Partitioner分区是HashPartitioner</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Public <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashPartitioner</span>&lt;K, V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Partitioner</span>&lt;K,V&gt;&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPartition</span><span class="hljs-params">(K key, V value, <span class="hljs-type">int</span> numReduceTasks)</span>&#123; <br>        <span class="hljs-keyword">return</span> (key.hashCode() &amp; Integer.MAX_VALUE) % numReduceTasks; <br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>默认分区方式下，根据key的hashCode对ReduceTasks个数取模得到，用户没法控制哪个key在哪个分区。 </p><p>这个就是分区数量，也就是输出文件的数量。默认为1，因为默认的输出文件数量就为1 </p><h3 id="②-源码查看"><a href="#②-源码查看" class="headerlink" title="② 源码查看"></a>② 源码查看</h3><p>使用的程序案例是wordcount。<br>首先在map中的context.write(k,v);打上断点，然后进行调试，可以看到，程序会<strong>首先进入map中</strong>。<br> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211015313.png" style="zoom:25%;" /><br>进入之后可以看到：<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211015357.png"><br>在这里key是coachhe，value是1<br>再进入会进入收集器中：<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211015505.png"><br>参数为key，value和partition的值。<br>这个收集器会循环将文件输出到环形缓冲区中，然后缓冲区满了80%之后就会往外写数据到不同的文件中（根据分区）。<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211015425.png" style="zoom:25%;" /><br>进入getPartition中可以看到：<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211015524.png"></p><p>通过当前key的hashCode和numReduceTasks进行求余可以得到分区号（因为若我们设置的numReduceTasks为n那么求余的可能性就只有n种，所以可以将其区分开）。 </p><p>得到分区号之后进入collect： </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211015617.png"></p><h2 id="3-WritableComparable排序"><a href="#3-WritableComparable排序" class="headerlink" title="3 WritableComparable排序"></a>3 WritableComparable排序</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>排序是MapReduce框架中<strong>最重要的操作</strong>之一。</p><p>MapTask和ReduceTask均会对数据<strong>按照key</strong>进行排序，该操作属于Hadoop的默认行为。任何应用中的数据均会被排序，而不管逻辑上是否需要。</p><p>默认排序是按照<strong>字典顺序排序</strong>，且实现该排序的方法是<strong>快速排序</strong>。</p><p>对于MapTask，它会将处理的结果暂时放到环形缓冲区中，<strong>当环形缓冲区使用率达到一定阈值后，再对缓冲区中的数据进行一次快速排序</strong>，并将这些有序数据溢写到磁盘上，而当数据处理完毕后，它会<strong>对磁盘上所有文件进行归并排序</strong>。</p><p>对于ReduceTask，它从每个MapTask上远程拷贝相应的数据文件，如果文件大小超过一定阈值，则溢写到磁盘上，否则存储在内存中。如果磁盘上文件数目达到一定阈值，则进行一次归并排序以生成一个更大文件；如果内存中文件带下或者数目超过一定阈值，则进行一次合并后将数据溢写到磁盘上。当所有数据拷贝完毕后，<strong>ReduceTask统一对内存和磁盘上所有的数据进行一次归并排序</strong>。</p><h3 id="排序的分类"><a href="#排序的分类" class="headerlink" title="排序的分类"></a>排序的分类</h3><ol><li><p>部分排序</p><p>MapReduce根据输入记录的键对数据集排序。保证输出的<strong>每个文件都有序</strong>。</p></li><li><p>全排序</p><p>最终输出结果只有一个文件，且文件内部有序。实现方式是只设置一个ReduceTask。但该方法在处理大型文件时效率极低，因为一台机器处理所有文件，完全丧失了MapReduce所提供的并行架构。</p></li><li><p>辅助排序（GroupingComparable分组）</p><p>在Reduce端对key进行分组。</p><p>应用于：在接收的key为bean对象时，想让一个或几个字段相同（全部字段比较不相同）的key进入到同一个reduce方法时，可以使用分组排序。</p></li><li><p>二次排序</p><p>在自定义排序过程中，如果compareTo中的判断条件为两个即为二次排序</p></li></ol><h3 id="WritableComparable排序案例"><a href="#WritableComparable排序案例" class="headerlink" title="WritableComparable排序案例"></a>WritableComparable排序案例</h3><h4 id="全排序案例"><a href="#全排序案例" class="headerlink" title="全排序案例"></a>全排序案例</h4><h5 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h5><p>根据序列化案例实操产生的结果进行流量的倒叙排序 </p><h5 id="输入数据"><a href="#输入数据" class="headerlink" title="输入数据"></a>输入数据</h5><p>&#x2F;Users&#x2F;heyizhi&#x2F;BigData&#x2F;hadoop&#x2F;my_project&#x2F;WritableComparable自定义排序&#x2F;phone_data<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021156.png" style="zoom:25%;" /></p><h5 id="期望输出数据"><a href="#期望输出数据" class="headerlink" title="期望输出数据"></a>期望输出数据</h5><p>135XXXX 1234 1234 555 </p><p>135XXXX 1234 1234 554 </p><p>135XXXX 1234 1234 553 </p><p>135XXXX 1234 1234 552 </p><h5 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h5><p>因为MapTask一定会对key进行排序，因此不能像之前那样用手机号作为key，而是一定要用流量作为key。 </p><h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><p>FlowBean实现WritableComparable接口重写compareTo方法。 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span> <br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(FlowBean o)</span>&#123; <br>    <span class="hljs-comment">//倒叙排列，按照总流量从大到小 </span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="具体分析"><a href="#具体分析" class="headerlink" title="具体分析"></a>具体分析</h5><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021241.png" style="zoom:25%;" /><h3 id="全排序代码实现"><a href="#全排序代码实现" class="headerlink" title="全排序代码实现"></a>全排序代码实现</h3><h5 id="FlowBean"><a href="#FlowBean" class="headerlink" title="FlowBean"></a>FlowBean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.WritableComparable; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.WritableComparable; <br>  <br><span class="hljs-keyword">import</span> java.io.DataInput; <br><span class="hljs-keyword">import</span> java.io.DataOutput; <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WritableComparable</span>&lt;FlowBean&gt; &#123; <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> upFlow; <span class="hljs-comment">//上行流量 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> downFlow; <span class="hljs-comment">//下行流量 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> sumFlow; <span class="hljs-comment">//总流量 </span><br>  <br>    <span class="hljs-comment">//空参构造，为了后续反射用 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FlowBean</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-built_in">super</span>(); <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FlowBean</span><span class="hljs-params">(<span class="hljs-type">long</span> upFlow, <span class="hljs-type">long</span> downFlow)</span> &#123; <br>        <span class="hljs-built_in">super</span>(); <br>        <span class="hljs-built_in">this</span>.upFlow = upFlow; <br>        <span class="hljs-built_in">this</span>.downFlow = downFlow; <br>        <span class="hljs-built_in">this</span>.sumFlow = upFlow + downFlow; <br>    &#125; <br>  <br>    <span class="hljs-comment">//序列化方法 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(DataOutput dataOutput)</span> <span class="hljs-keyword">throws</span> IOException &#123; <br>        dataOutput.writeLong(upFlow); <br>        dataOutput.writeLong(downFlow); <br>        dataOutput.writeLong(sumFlow); <br>    &#125; <br>  <br>    <span class="hljs-comment">//反序列化方法,顺序跟序列化方法顺序必须一致 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFields</span><span class="hljs-params">(DataInput dataInput)</span> <span class="hljs-keyword">throws</span> IOException &#123; <br>        upFlow = dataInput.readLong(); <br>        downFlow = dataInput.readLong(); <br>        sumFlow = dataInput.readLong(); <br>    &#125; <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span>  upFlow + <span class="hljs-string">&quot;\t&quot;</span> + downFlow + <span class="hljs-string">&quot;\t&quot;</span> + sumFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getUpFlow</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> upFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUpFlow</span><span class="hljs-params">(<span class="hljs-type">long</span> upFlow)</span> &#123; <br>        <span class="hljs-built_in">this</span>.upFlow = upFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDownFlow</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> downFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDownFlow</span><span class="hljs-params">(<span class="hljs-type">long</span> downFlow)</span> &#123; <br>        <span class="hljs-built_in">this</span>.downFlow = downFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getSumFlow</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> sumFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSumFlow</span><span class="hljs-params">(<span class="hljs-type">long</span> sumFlow)</span> &#123; <br>        <span class="hljs-built_in">this</span>.sumFlow = sumFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(FlowBean bean)</span> &#123; <br>        <span class="hljs-comment">//核心比较条件判断 </span><br>        <span class="hljs-keyword">if</span> (sumFlow == bean.getSumFlow()) &#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <br>        &#125; <br>        <span class="hljs-keyword">return</span> sumFlow &gt; bean.getSumFlow() ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>; <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.WritableComparable; <br><br> <br><br><span class="hljs-keyword">import</span> org.apache.hadoop.io.LongWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Mapper; <br><br> <br><br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowCountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span>&lt;LongWritable, Text, FlowBean, Text&gt; &#123; <br>  <br>    <span class="hljs-type">FlowBean</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowBean</span>(); <br>    <span class="hljs-type">Text</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(); <br><br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(LongWritable key, Text value, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>        String[] line = value.toString().split(<span class="hljs-string">&quot;\t&quot;</span>); <br>  <br>        <span class="hljs-type">long</span> <span class="hljs-variable">upFlow</span> <span class="hljs-operator">=</span> Long.parseLong(line[<span class="hljs-number">1</span>]); <br>        <span class="hljs-type">long</span> <span class="hljs-variable">downFlow</span> <span class="hljs-operator">=</span> Long.parseLong(line[<span class="hljs-number">2</span>]); <br>        <span class="hljs-type">long</span> <span class="hljs-variable">sumFlow</span> <span class="hljs-operator">=</span> upFlow + downFlow; <br>        k.setUpFlow(upFlow); <br>        k.setDownFlow(downFlow); <br>        k.setSumFlow(sumFlow); <br>        v.set(line[<span class="hljs-number">0</span>]); <br>        <span class="hljs-comment">// 4写出 </span><br>        context.write(k, v); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.WritableComparable; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Reducer; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowCountReducer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;FlowBean, Text, Text, FlowBean&gt; &#123; <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reduce</span><span class="hljs-params">(FlowBean key, Iterable&lt;Text&gt; values, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>        <span class="hljs-comment">// bean 138XXXX </span><br>        <span class="hljs-keyword">for</span> (Text phone_num : values) &#123; <br>            context.write(phone_num, key); <br>        &#125; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.WritableComparable; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration; <br><span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Job; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowCountDriver</span> &#123; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, InterruptedException &#123; <br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">0</span>) &#123; <br>            args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/Users/heyizhi/BigData/hadoop/my_project/WritableComparable自定义排序/phone_data&quot;</span>, <br>            <span class="hljs-string">&quot;/Users/heyizhi/BigData/hadoop/my_project/WritableComparable自定义排序/Output&quot;</span>&#125;; <br>        &#125; <br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(); <br>        <span class="hljs-comment">// 1 获取job对象 </span><br>        <span class="hljs-type">Job</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> Job.getInstance(conf); <br>  <br>        <span class="hljs-comment">// 2 设置jar路径 </span><br>        job.setJarByClass(FlowCountDriver.class); <br>  <br>        <span class="hljs-comment">// 3 关联mapper和reducer </span><br>        job.setMapperClass(FlowCountMapper.class); <br>        job.setReducerClass(FlowCountReducer.class); <br>  <br>        <span class="hljs-comment">// 4 设置mapper输出的key和value类型 </span><br>        job.setMapOutputKeyClass(FlowBean.class); <br>        job.setMapOutputValueClass(Text.class); <br>  <br>        <span class="hljs-comment">// 5 设置最终输出的key和value类型 </span><br>        job.setOutputKeyClass(Text.class); <br>        job.setOutputValueClass(FlowBean.class); <br>  <br>        <span class="hljs-comment">// 6 设置输入输出路径 </span><br>        FileInputFormat.setInputPaths(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">0</span>])); <br>        FileOutputFormat.setOutputPath(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">1</span>])); <br> <br>        <span class="hljs-comment">// 7 提交job </span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> job.waitForCompletion(<span class="hljs-literal">true</span>); <br>  <br>        System.exit(result ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>); <br>  <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021500.png" style="zoom:25%;" /><h3 id="分区内排序案例"><a href="#分区内排序案例" class="headerlink" title="分区内排序案例"></a>分区内排序案例</h3><h5 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h5><p>将每个号码前三位相同的进行分区，然后每个分区按照降序进行排序。 </p><h5 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h5><p>基于前一个需求，增加自定义分区类，分区按照省份手机号设置。 </p><h5 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h5><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021549.png" style="zoom:25%;" /><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021620.png"></p><p>在驱动里面加上这个</p><h3 id="FlowBean-1"><a href="#FlowBean-1" class="headerlink" title="FlowBean"></a>FlowBean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.WritableComparable.分区排序; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Partitioner; <br>  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProvincePartitioner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Partitioner</span>&lt;FlowBean, Text&gt; &#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPartition</span><span class="hljs-params">(FlowBean flowBean, Text text, <span class="hljs-type">int</span> i)</span> &#123; <br>  <br>        <span class="hljs-comment">//按照手机号前三位分区 </span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">prePhoneNum</span> <span class="hljs-operator">=</span> text.toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>); <br>   <br>        <span class="hljs-type">int</span> <span class="hljs-variable">partition</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;136&quot;</span>.equals(prePhoneNum)) &#123; <br>            partition = <span class="hljs-number">0</span>; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;137&quot;</span>.equals(prePhoneNum)) &#123; <br>            partition = <span class="hljs-number">1</span>; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;138&quot;</span>.equals(prePhoneNum)) &#123; <br>            partition = <span class="hljs-number">2</span>; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;139&quot;</span>.equals(prePhoneNum)) &#123; <br>            partition = <span class="hljs-number">3</span>; <br>        &#125; <br>  <br>        <span class="hljs-keyword">return</span> partition; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="GroupingComparator分组"><a href="#GroupingComparator分组" class="headerlink" title="GroupingComparator分组"></a>GroupingComparator分组</h2><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>对Reduce阶段的数据根据某一个或几个字段进行分组。 </p><h4 id="分组排序步骤："><a href="#分组排序步骤：" class="headerlink" title="分组排序步骤："></a>分组排序步骤：</h4><p>（1）自定义类继承WritableComparator<br>（2）重写compare()方法 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span> <br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(WritableComparable a, WritableComparable b)</span> &#123; <br>        <span class="hljs-comment">// 比较的业务逻辑 </span><br>        <span class="hljs-keyword">return</span> result; <br>&#125; <br></code></pre></td></tr></table></figure><p>（3）创建一个构造将比较对象的类传给父类 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-title function_">OrderGroupingComparator</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-built_in">super</span>(OrderBean.class, <span class="hljs-literal">true</span>); <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="GroupingComparator分组案例"><a href="#GroupingComparator分组案例" class="headerlink" title="GroupingComparator分组案例"></a>GroupingComparator分组案例</h3><h5 id="需求-2"><a href="#需求-2" class="headerlink" title="需求"></a>需求</h5><p>有如下订单数据 </p><h5 id="订单"><a href="#订单" class="headerlink" title="订单"></a>订单</h5><table><thead><tr><th>订单id</th><th>商品id</th><th>成交金额</th></tr></thead><tbody><tr><td>0000001</td><td>Pdt_01</td><td>222.8</td></tr><tr><td></td><td>Pdt_02</td><td>33.8</td></tr><tr><td>0000002</td><td>Pdt_03</td><td>522.8</td></tr><tr><td></td><td>Pdt_04</td><td>122.4</td></tr><tr><td></td><td>Pdt_05</td><td>722.8</td></tr><tr><td>0000003</td><td>Pdt_06</td><td>232.8</td></tr><tr><td></td><td>Pdt_07</td><td>33.8</td></tr></tbody></table><p>现在需要求出每一个订单中最贵的商品。 </p><h5 id="输入数据-1"><a href="#输入数据-1" class="headerlink" title="输入数据"></a>输入数据</h5><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021855.png" style="zoom:25%;" /><h5 id="期望输出数据-1"><a href="#期望输出数据-1" class="headerlink" title="期望输出数据"></a>期望输出数据</h5><p>1 222.8<br>2 722.4<br>3 232.8 </p><h5 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h5><p>（1）利用“订单id和成交金额”作为key，可以将Map阶段读取到的所有订单数据按照id升序排序，如果id相同再按照金额降序排序，发送到Reduce。<br>（2）在Reduce端利用groupingComparator将订单id相同的kv聚合成组，然后取第一个即是该订单中最贵商品<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211021921.png" style="zoom:25%;" /></p><h4 id="分组原因"><a href="#分组原因" class="headerlink" title="分组原因"></a>分组原因</h4><p>对上面的需求进行分析，因为只有key相同才会进入同一个reduce中，但是前面定义的key是OrderBean，比较的是OrderBean里面的价格和id，因此不同的价格和id就会对应不同的OrderBean，因此所有的结果都会进行输出，因此我们需要进行分组排序，目的是让id相同的key就能进入同一个reduce中，那我们就不循环直接输出即可得到价格最大的那个订单！ </p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p>根据简介中的方法，我们可以得到GroupingComparator的代码为</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.order; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.WritableComparable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.WritableComparator; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderGroupingComparator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WritableComparator</span> &#123; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderGroupingComparator</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-built_in">super</span>(OrderBean.class, <span class="hljs-literal">true</span>); <br>    &#125; <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(WritableComparable a, WritableComparable b)</span> &#123; <br>        <span class="hljs-comment">//要求只要id相同，就认为是相同的key </span><br>  <br>        <span class="hljs-type">OrderBean</span> <span class="hljs-variable">aBean</span> <span class="hljs-operator">=</span> (OrderBean) a; <br>        <span class="hljs-type">OrderBean</span> <span class="hljs-variable">bBean</span> <span class="hljs-operator">=</span> (OrderBean) b; <br>        <span class="hljs-type">int</span> result; <br>        <span class="hljs-keyword">if</span> (aBean.getOrder_id() &gt; bBean.getOrder_id()) &#123; <br>            result = <span class="hljs-number">1</span>; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (aBean.getOrder_id() &lt; bBean.getOrder_id()) &#123; <br>            result = -<span class="hljs-number">1</span>; <br>        &#125; <span class="hljs-keyword">else</span> &#123; <br>            result = <span class="hljs-number">0</span>; <br>        &#125; <br>  <br>        <span class="hljs-keyword">return</span> result; <br>        <span class="hljs-comment">// 在这里，如果是0则表示为同一个key </span><br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="map-1"><a href="#map-1" class="headerlink" title="map"></a>map</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.order; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.LongWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.NullWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Mapper; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span>&lt;LongWritable, Text, OrderBean, NullWritable&gt; &#123; <br>  <br>    <span class="hljs-type">OrderBean</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBean</span>(); <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(LongWritable key, Text value, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>        <span class="hljs-comment">// 0000001 Pdt_01 222.8 输入数据 </span><br>        <span class="hljs-comment">// 将0000001和222.8封装到bean对象之后输出就行了，不需要value </span><br>        String[] line = value.toString().split(<span class="hljs-string">&quot; &quot;</span>); <br>        k.setOrder_id(Integer.parseInt(line[<span class="hljs-number">0</span>])); <br>        k.setPrice(Double.parseDouble(line[<span class="hljs-number">2</span>])); <br>        context.write(k, NullWritable.get()); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="reduce-1"><a href="#reduce-1" class="headerlink" title="reduce"></a>reduce</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.order; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.LongWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.NullWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Mapper; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span>&lt;LongWritable, Text, OrderBean, NullWritable&gt; &#123; <br>  <br>    <span class="hljs-type">OrderBean</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBean</span>(); <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(LongWritable key, Text value, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>        <span class="hljs-comment">// 0000001 Pdt_01 222.8 输入数据 </span><br>        <span class="hljs-comment">// 将0000001和222.8封装到bean对象之后输出就行了，不需要value </span><br>        String[] line = value.toString().split(<span class="hljs-string">&quot; &quot;</span>); <br>        k.setOrder_id(Integer.parseInt(line[<span class="hljs-number">0</span>])); <br>        k.setPrice(Double.parseDouble(line[<span class="hljs-number">2</span>])); <br>        context.write(k, NullWritable.get()); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.order; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.WritableComparable; <br>  <br><span class="hljs-keyword">import</span> java.io.DataInput; <br><span class="hljs-keyword">import</span> java.io.DataOutput; <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WritableComparable</span>&lt;OrderBean&gt; &#123; <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> order_id;       <span class="hljs-comment">//订单ID </span><br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder_id</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> order_id; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrder_id</span><span class="hljs-params">(<span class="hljs-type">int</span> order_id)</span> &#123; <br>        <span class="hljs-built_in">this</span>.order_id = order_id; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> price; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> &#123; <br>        <span class="hljs-built_in">this</span>.price = price; <br>    &#125; <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;       <span class="hljs-comment">//订单价格 </span><br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderBean</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-built_in">super</span>(); <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderBean</span><span class="hljs-params">(<span class="hljs-type">int</span> order_id, <span class="hljs-type">double</span> price)</span> &#123; <br>        <span class="hljs-built_in">super</span>(); <br>        <span class="hljs-built_in">this</span>.order_id = order_id; <br>        <span class="hljs-built_in">this</span>.price = price; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(OrderBean o)</span> &#123; <br>        <span class="hljs-comment">// 先按照订单id进行排序，如果相同按照价格降序排序 </span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <br>        <span class="hljs-keyword">if</span> (order_id &gt; o.getOrder_id()) &#123; <br>            res = <span class="hljs-number">1</span>; <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (order_id &lt; o.getOrder_id()) &#123; <br>            res = -<span class="hljs-number">1</span>; <br>        &#125; <span class="hljs-keyword">else</span> &#123; <br>            <span class="hljs-keyword">if</span> (price &gt; o.getPrice()) &#123; <br>                res = -<span class="hljs-number">1</span>; <br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (price &lt; o.getPrice()) &#123; <br>                res = <span class="hljs-number">1</span>; <br>            &#125; <span class="hljs-keyword">else</span> &#123; <br>                res = <span class="hljs-number">0</span>; <br>            &#125; <br>        &#125; <br>        <span class="hljs-keyword">return</span> res; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(DataOutput dataOutput)</span> <span class="hljs-keyword">throws</span> IOException &#123; <br>        dataOutput.writeInt(order_id); <br>        dataOutput.writeDouble(price); <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFields</span><span class="hljs-params">(DataInput dataInput)</span> <span class="hljs-keyword">throws</span> IOException &#123; <br>        order_id = dataInput.readInt(); <br>        price = dataInput.readDouble(); <br>    &#125; <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;order_id=&quot;</span> + order_id + <span class="hljs-string">&quot;\t&quot;</span> + <span class="hljs-string">&quot;price=&quot;</span> + price; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h5 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.order; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration; <br><span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.NullWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Job; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDriver</span> &#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, InterruptedException &#123; <br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">0</span>) &#123; <br>            args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123; <br>                    <span class="hljs-string">&quot;/Users/heyizhi/BigData/hadoop/my_project/GroupingComparator分组操作/GroupingData&quot;</span>, <br>                    <span class="hljs-string">&quot;/Users/heyizhi/BigData/hadoop/my_project/GroupingComparator分组操作/Output_Grouping&quot;</span>&#125;; <br>        &#125; <br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(); <br>        <span class="hljs-comment">// 1 获取job对象 </span><br>        <span class="hljs-type">Job</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> Job.getInstance(conf); <br>  <br>        <span class="hljs-comment">// 2 设置jar路径 </span><br>        job.setJarByClass(OrderDriver.class); <br>  <br>        <span class="hljs-comment">// 3 关联mapper和reducer </span><br>        job.setMapperClass(OrderMapper.class); <br>        job.setReducerClass(OrderReducer.class); <br>  <br>        <span class="hljs-comment">// 4 设置mapper输出的key和value类型 </span><br>        job.setMapOutputKeyClass(OrderBean.class); <br>        job.setMapOutputValueClass(NullWritable.class); <br>  <br>        <span class="hljs-comment">// 5 设置最终输出的key和value类型 </span><br>        job.setOutputKeyClass(OrderBean.class); <br>        job.setOutputValueClass(NullWritable.class); <br>  <br>        <span class="hljs-comment">// 6 设置输入输出路径 </span><br>        FileInputFormat.setInputPaths(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">0</span>])); <br>        FileOutputFormat.setOutputPath(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">1</span>])); <br>  <br>        job.setGroupingComparatorClass(OrderGroupingComparator.class); <br>  <br>        <span class="hljs-comment">// 7 提交job </span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> job.waitForCompletion(<span class="hljs-literal">true</span>); <br>  <br>        System.exit(result ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>3 MR介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/06f10ec84b24.html"/>
    <url>/2022/12/06f10ec84b24.html</url>
    
    <content type="html"><![CDATA[<p>&#x3D;&#x3D;⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠&#x3D;&#x3D;</p><h1 id="Text-Elements"><a href="#Text-Elements" class="headerlink" title="Text Elements"></a>Text Elements</h1><p>javac Person.class  ^wvRTe8zv</p><p>Person.class ^5WyyRodU</p><p>ClassLoader加载进内存 ^zjWexb3x</p><p>生成Class对象<br>Class<Person>对象 ^xjkmmhgm</p><p>栈 ^fyc9ZiFN</p><p>堆 ^mNMekWrK</p><p>Person ^Q2Aix7OQ</p><p>创建实例对象 ^RfuoL2T2</p><p>UserController类 ^nw0NXMiM</p><p>@RequestMapping(“&#x2F;getUser”)<br>public User getUserById(Integer id){<br>    &#x2F;&#x2F;…<br>} ^zJVnkqx9</p><p>private String name;              &#x2F;&#x2F; 方法名：getUserById<br>private Class<?> returnType;      // 返回类型：User类private byte[]   annotations;     // 注解：@RequestMapping("/getUser")private Class<?> parameterType;   &#x2F;&#x2F; 参数类型：Integer ^jVxqnIoI</p><p>Method类 ^qwbrfulX</p><p>引入需要的“包类”名称 ^wHt9xMsF</p><p>通过new实例化 ^BR8lwOMT</p><p>取得实例化对象 ^CZKnT5XI</p><p>实例化对象 ^rX4kpCTw</p><p>getClass()方法 ^tgqBa8Hk</p><p>得到完整的“包类”名称 ^vlPITteT</p><p>正常方式： ^IrlnJElv</p><p>反射方式： ^pawAwWxL</p><p>%%</p><h1 id="Drawing"><a href="#Drawing" class="headerlink" title="Drawing"></a>Drawing</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;excalidraw&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://excalidraw.com&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;elements&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1222106560</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wvRTe8zv&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-412.2489929199219</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-326.4451904296875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">223</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">166374976</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;javac Person.class &quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;javac Person.class &quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">707726784</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5WyyRodU&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-364.21820068359375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-218.6739501953125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">141</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1752024512</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Person.class&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Person.class&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">140</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">660512192</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IydbLtTgwrUDWwHZXC8Lr&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-377.0843505859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-239.65142822265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">176.69287109375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">66.55279541015624</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">881284544</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;oad6891qk5rvmzt7a1rDW&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">107</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">548357568</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;oad6891qk5rvmzt7a1rDW&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-194.29132080078125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-170.30902099609375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">287.5745890378952</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">246.53950116238556</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1230216640</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IydbLtTgwrUDWwHZXC8Lr&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.4118982899314304</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6.10015869140625</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xjkmmhgm&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.7748099609225201</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12.45336506366732</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">287.5745890378952</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">246.53950116238556</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">96</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1972260416</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zjWexb3x&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-277.02838134765625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-41.449432373046875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1631157696</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ClassLoader加载进内存&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ClassLoader加载进内存&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">109</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">152683968</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MVwsRFcPuGje0spYTYdoc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">51.10418701171875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-361.9535827636719</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">503.86920166015625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">506.7070007324219</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">630597056</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;HwhtKm5jqhrzgqzkVlKiE&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">70</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43939392</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uqvNrmmwpd5T5kzUj6oWB&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52.6639404296875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-8.054443359375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">503.060546875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.33251953125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1126860352</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;HwhtKm5jqhrzgqzkVlKiE&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">503.060546875</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">4.33251953125</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1432030656</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;49N6vuNmi1MnYVsWpvBUC&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">190.293701171875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-362.39532470703125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.09326171875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">355.56500244140625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2085367360</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;HwhtKm5jqhrzgqzkVlKiE&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">-0.09326171875</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">355.56500244140625</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">92</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">320181696</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xjkmmhgm&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">105.73663330078125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55.74560546875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">192</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">56</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">439571904</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;oad6891qk5rvmzt7a1rDW&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;vP7sMEQJHowEDXlsglpI_&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;生成Class对象\nClass&lt;Person&gt;对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">49</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;生成Class对象\nClass&lt;Person&gt;对象&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">35</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1451030080</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;fyc9ZiFN&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">95.4697265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-246.84405517578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1837655616</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;栈&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;栈&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1159685696</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mNMekWrK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">359.8896484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-251.72442626953125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">963329472</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;堆&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;堆&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1331486144</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Q2Aix7OQ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">340.0452575683594</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-141.8488006591797</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">70</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1084937792</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;vP7sMEQJHowEDXlsglpI_&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Person&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;middle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Person&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50832960</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vP7sMEQJHowEDXlsglpI_&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">263.6002197265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">47.0919189453125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">98.843994140625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">160.619873046875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1607398976</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xjkmmhgm&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3471422523838603</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8.6536865234375</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Q2Aix7OQ&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.06033652001320405</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.3208465576171875</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">98.843994140625</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-160.619873046875</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1044950592</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;RfuoL2T2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">343.692138671875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-57</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1284533696</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;创建实例对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;创建实例对象&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1780166050</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XklJ4qDM65dF1mK-25VzV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-407.5082244873047</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">337.4739685058594</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">451.889892578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">141.2425885881696</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">403977406</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">534768318</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nw0NXMiM&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-404.51658630371094</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">294.7929992675781</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">184</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">269044066</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UserController类&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UserController类&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">152</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">540622818</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zJVnkqx9&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-392.10033525739425</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">363.70468139648506</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">422</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">96</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">906861502</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@RequestMapping(\&quot;/getUser\&quot;)\npublic User getUserById(Integer id)&#123;\n    //...\n&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">91</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@RequestMapping(\&quot;/getUser\&quot;)\npublic User getUserById(Integer id)&#123;\n    //...\n&#125;&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">407</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1840864738</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jVxqnIoI&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65.14915902273958</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">356.01843697684103</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">810</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">112</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">459876706</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;private String name;              // 方法名：getUserById\nprivate Class&lt;?&gt; returnType;      // 返回类型：User类\nprivate byte[]   annotations;     // 注解：@RequestMapping(\&quot;/getUser\&quot;)\nprivate Class&lt;?&gt; parameterType;   // 参数类型：Integer&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">105</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;private String name;              // 方法名：getUserById\nprivate Class&lt;?&gt; returnType;      // 返回类型：User类\nprivate byte[]   annotations;     // 注解：@RequestMapping(\&quot;/getUser\&quot;)\nprivate Class&lt;?&gt; parameterType;   // 参数类型：Integer&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">214</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1669389730</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;KcXCyqoMTo1u6aqWDa2qd&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">49.21950639997169</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">339.77629307338134</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">838.3215332031251</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">138.23141915457586</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1058844094</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">78</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">707606562</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qwbrfulX&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54.373838152203916</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">297.9753112792964</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">90</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">57053666</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Method类&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Method类&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">117</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">68197758</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bpw8Mj9ar3V82lm-UAqD1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-278.0477937970844</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">729.39139011928</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">254.90057373046875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.577972412109375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1441582818</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;onWMbNfwxRGBsIYERIB_u&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">77</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1995715810</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wHt9xMsF&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-253.41879599435003</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">738.28933933803</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">203</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1535096674</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;引入需要的“包类”名称&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;引入需要的“包类”名称&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">62</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1343257954</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XyDA0UcgVSu73E-grn1Y3&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9.534090677897098</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">729.6000591459724</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">166.78009033203125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41.627410888671875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">236931234</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;D6IB5iASYXHY1FWt3Vq9d&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">761019838</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BR8lwOMT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">26.061068216959598</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">737.6907573881599</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">135</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1382091326</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;onWMbNfwxRGBsIYERIB_u&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;通过new实例化&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;通过new实例化&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1668891774</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;f4dGoRJpvo1fmzvMLWnBz&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">206.6492029825846</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">730.1932903471443</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">185.9287109375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39.286834716796875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">437492002</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1964788514</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CZKnT5XI&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">230.1698328653971</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">736.2439495268318</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">140</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">434515490</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;取得实例化对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;取得实例化对象&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">44</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2029027682</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;onWMbNfwxRGBsIYERIB_u&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-18.165372212727902</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">743.7343670073005</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">31.00665283203125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.88507080078125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">862623458</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bpw8Mj9ar3V82lm-UAqD1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.5164823575290661</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.981847853887757</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BR8lwOMT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.06429094371007761</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">13.21978759765625</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">31.00665283203125</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">1.88507080078125</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1734795646</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;D6IB5iASYXHY1FWt3Vq9d&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180.53512827555335</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">746.4449993315193</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">26.49212646484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.16217041015625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">333317410</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;XyDA0UcgVSu73E-grn1Y3&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.1609655944227172</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.220947265625</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">26.49212646484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-0.16217041015625</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">269</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1063242786</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3bT2lz1gJNa902xVdRmh5&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-280.80812109084366</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">809.0614696684333</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">138.3551025390625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.577972412109375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1407970878</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;R5KGXlyJ0ICSyaGdIrjTK&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">164</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1424467170</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rX4kpCTw&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-256.1791232881093</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">817.9594188871833</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">599760034</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;实例化对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;实例化对象&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">255</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28323106</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;q2ZNjRHlZn7qF2Fg0nzd0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-78.84140995570587</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">809.2701386951258</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.80963134765622</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">41.627410888671875</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">789542526</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;sITHLIduauI4Fcv6L-TRK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;R5KGXlyJ0ICSyaGdIrjTK&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">224</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">673618622</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tgqBa8Hk&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-65.7245886666434</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">814.9903230212976</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">157</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">614971490</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;sITHLIduauI4Fcv6L-TRK&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;getClass()方法&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;getClass()方法&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">261</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1883280126</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1gxNPv-sTZoJ5L7XdA6Ps&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">128.0583703177316</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">809.8633698962976</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">261.75921630859375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36.52450561523437</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">622327486</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;sITHLIduauI4Fcv6L-TRK&quot;</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">163</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">134808766</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vlPITteT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.5962121146066</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">816.2792939685633</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">203</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1368808482</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;得到完整的“包类”名称&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;得到完整的“包类”名称&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">671</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">315332030</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;R5KGXlyJ0ICSyaGdIrjTK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-137.04305623622744</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">828.865375080391</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54.729829850280694</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.5646129809035756</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2124836606</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3bT2lz1gJNa902xVdRmh5&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5.4099623155537415</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.027650026827319502</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;q2ZNjRHlZn7qF2Fg0nzd0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.471816430240864</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.23092399622626433</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">54.729829850280694</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-1.5646129809035756</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">352</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1194588194</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sITHLIduauI4Fcv6L-TRK&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100.40218135288785</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">826.3395940334944</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24.437499163299805</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6104453953950042</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2021296098</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tgqBa8Hk&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.30321773205896285</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9.12677001953125</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1gxNPv-sTZoJ5L7XdA6Ps&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.1009759214671233</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2186898015439454</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">24.437499163299805</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.6104453953950042</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1115080290</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IrlnJElv&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-373.830167134603</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">738.2439495268318</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1960332798</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;正常方式：&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;正常方式：&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">900343330</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pawAwWxL&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-370.08022816975927</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">818.2439495268318</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1012798946</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;反射方式：&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;反射方式：&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;appState&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;light&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;viewBackgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#ffffff&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemBackgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemRoughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemOpacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemTextAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStartArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemEndArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemLinearStrokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gridSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>%%</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java反射</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/1def517f677d.html"/>
    <url>/2022/12/1def517f677d.html</url>
    
    <content type="html"><![CDATA[<h2 id="接口："><a href="#接口：" class="headerlink" title="接口："></a>接口：</h2><p><code>/api/v1/work-order/create</code></p><h2 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h2><p>POST</p><p>例1：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/create&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI4Njc3MTgsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNzgxMzE4LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.OXFVzdKVLCT2QTsIN6hUe-DqrKQjw6PsPD8Y30N-8SE&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.47&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  --data-raw &#x27;&#123;&quot;title&quot;:&quot;111&quot;,&quot;priority&quot;:1,&quot;process&quot;:1,&quot;classify&quot;:2,&quot;state&quot;:[&#123;&quot;id&quot;:&quot;receiveTask1651725819812&quot;,&quot;process_method&quot;:&quot;person&quot;,&quot;processor&quot;:[5],&quot;label&quot;:&quot;处理节点&quot;&#125;],&quot;source&quot;:&quot;start1651725870775&quot;,&quot;source_state&quot;:&quot;22&quot;,&quot;process_method&quot;:&quot;&quot;,&quot;tpls&quot;:&#123;&quot;form_structure&quot;:[&#123;&quot;list&quot;:[&#123;&quot;key&quot;:&quot;1651725342000_58443&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;],&quot;config&quot;:&#123;&quot;size&quot;:&quot;small&quot;,&quot;labelWidth&quot;:100,&quot;customClass&quot;:&quot;&quot;,&quot;labelPosition&quot;:&quot;right&quot;&#125;,&quot;id&quot;:1&#125;],&quot;form_data&quot;:[&#123;&quot;input_1651725342000_58443&quot;:&quot;111&quot;&#125;]&#125;,&quot;tasks&quot;:[&quot;echo_test-4171bc7f4a05-admin.sh&quot;]&#125;&#x27; \<br>  --compressed<br></code></pre></td></tr></table></figure><p>例2：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/create&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTMwNDc0OTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyOTYxMDk1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.luHkyKXx9kZ3lrPEAtQjJxJxZPefFFKRo6dpg7kLmng&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652961091; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTMwNDc0OTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyOTYxMDk1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.luHkyKXx9kZ3lrPEAtQjJxJxZPefFFKRo6dpg7kLmng; sidebarStatus=0&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.47&#x27; \<br>  --data-raw &#x27;&#123;&quot;title&quot;:&quot;测试工单111&quot;,&quot;priority&quot;:3,&quot;process&quot;:1,&quot;classify&quot;:2,&quot;state&quot;:[&#123;&quot;id&quot;:&quot;receiveTask1651725819812&quot;,&quot;process_method&quot;:&quot;person&quot;,&quot;processor&quot;:[5],&quot;label&quot;:&quot;处理节点&quot;&#125;],&quot;source&quot;:&quot;start1651725870775&quot;,&quot;source_state&quot;:&quot;22&quot;,&quot;process_method&quot;:&quot;&quot;,&quot;tpls&quot;:&#123;&quot;form_structure&quot;:[&#123;&quot;list&quot;:[&#123;&quot;key&quot;:&quot;1652843023000_87184&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1651725342000_58443&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843028000_70959&quot;,&quot;icon&quot;:&quot;icon-wenjianshangchuan&quot;,&quot;name&quot;:&quot;文件&quot;,&quot;type&quot;:&quot;file&quot;,&quot;model&quot;:&quot;file_1652843028000_70959&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;tip&quot;:&quot;&quot;,&quot;token&quot;:&quot;&quot;,&quot;width&quot;:&quot;&quot;,&quot;action&quot;:&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;length&quot;:9,&quot;headers&quot;:&#123;&#125;,&quot;disabled&quot;:false,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843028000_70959&quot;,&quot;defaultValue&quot;:[],&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843032000_79963&quot;,&quot;icon&quot;:&quot;icon-tupian&quot;,&quot;name&quot;:&quot;图片&quot;,&quot;type&quot;:&quot;imgupload&quot;,&quot;model&quot;:&quot;imgupload_1652843032000_79963&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;min&quot;:0,&quot;size&quot;:&#123;&quot;width&quot;:100,&quot;height&quot;:100&#125;,&quot;token&quot;:&quot;&quot;,&quot;width&quot;:&quot;&quot;,&quot;action&quot;:&quot;https://jsonplaceholder.typicode.com/photos/&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;isEdit&quot;:false,&quot;length&quot;:8,&quot;isQiniu&quot;:false,&quot;disabled&quot;:false,&quot;isDelete&quot;:false,&quot;multiple&quot;:false,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843032000_79963&quot;,&quot;defaultValue&quot;:[],&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843040000_1662&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;分割线&quot;,&quot;type&quot;:&quot;divider&quot;,&quot;model&quot;:&quot;divider_1652843040000_1662&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;direction&quot;:&quot;horizontal&quot;,&quot;font_size&quot;:&quot;15px&quot;,&quot;font_color&quot;:&quot;#606266&quot;,&quot;remoteFunc&quot;:&quot;func_1652843040000_1662&quot;,&quot;font_family&quot;:&quot;&quot;,&quot;font_weight&quot;:&quot;500&quot;,&quot;defaultValue&quot;:&quot;分割线&quot;,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;content_position&quot;:&quot;center&quot;&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843043000_29667&quot;,&quot;icon&quot;:&quot;icon-table&quot;,&quot;name&quot;:&quot;子表单&quot;,&quot;type&quot;:&quot;subform&quot;,&quot;model&quot;:&quot;subform_1652843043000_29667&quot;,&quot;rules&quot;:[],&quot;columns&quot;:[&#123;&quot;list&quot;:[],&quot;span&quot;:12&#125;,&#123;&quot;list&quot;:[],&quot;span&quot;:12&#125;],&quot;options&quot;:&#123;&quot;align&quot;:&quot;top&quot;,&quot;gutter&quot;:0,&quot;justify&quot;:&quot;start&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843043000_29667&quot;,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;],&quot;config&quot;:&#123;&quot;size&quot;:&quot;small&quot;,&quot;labelWidth&quot;:100,&quot;customClass&quot;:&quot;&quot;,&quot;labelPosition&quot;:&quot;right&quot;&#125;,&quot;id&quot;:1&#125;],&quot;form_data&quot;:[&#123;&quot;input_1651725342000_58443&quot;:&quot;文本2&quot;,&quot;file_1652843028000_70959&quot;:[],&quot;imgupload_1652843032000_79963&quot;:[],&quot;divider_1652843040000_1662&quot;:&quot;分割线&quot;,&quot;subform_1652843043000_29667&quot;:[]&#125;]&#125;,&quot;tasks&quot;:[&quot;echo_test-4171bc7f4a05-admin.sh&quot;]&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>Keys:</p><ol><li>JWT_TOKEN</li><li>JWT_PAYLOAD<ol><li>rolekey –&gt; admin</li><li>rolename –&gt; 系统管理员</li><li>exp  –&gt; 165xxxx</li><li>identity  –&gt; 5</li><li>nice –&gt; coachhe</li><li>orig_iat –&gt; 16522xxx</li><li>roleid –&gt; 1</li></ol></li><li>identity<ol><li>identityKey –&gt; 5</li><li>userName –&gt; coachhe</li><li>RoleKey –&gt; admin</li><li>UserId –&gt; 5</li><li>RoleIds –&gt; 1</li></ol></li><li>role<ol><li>“”</li></ol></li><li>roleIds<ol><li>0</li></ol></li><li>userId<ol><li>0</li></ol></li><li>userName<ol><li>“”</li></ol></li></ol><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220515152901.png"></p><h2 id="body"><a href="#body" class="headerlink" title="body"></a>body</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;工单1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;priority&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;process&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;classify&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receiveTask1651725819812&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;process_method&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;person&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;processor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">5</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;处理节点&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start1651725870775&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;source_state&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;22&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;process_method&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tpls&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;form_structure&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-input&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                            <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本格式不正确&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;100%&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;pattern&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;dataType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;showPassword&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                                    <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;small&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;customClass&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelPosition&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;right&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;form_data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;input_1651725342000_58443&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;测试工单1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tasks&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;echo_test-4171bc7f4a05-admin.sh&quot;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>workOrderValue: </p><p>http请求映射得到的工单信息</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">workOrderValue <span class="hljs-keyword">struct</span> &#123;<br>    process.WorkOrderInfo <span class="hljs-comment">// 工单基本信息</span><br>    Tpls        <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>][]<span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:&quot;tpls&quot;`</span><br>    SourceState <span class="hljs-type">string</span>                   <span class="hljs-string">`json:&quot;source_state&quot;`</span><br>    Tasks       json.RawMessage          <span class="hljs-string">`json:&quot;tasks&quot;`</span><br>    Source      <span class="hljs-type">string</span>                   <span class="hljs-string">`json:&quot;source&quot;`</span><br>    IsExecTask  <span class="hljs-type">bool</span>                     <span class="hljs-string">`json:&quot;is_exec_task&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><p>variableValue: </p><p>是workOrderValue的State字段所得，类型是一个json.RawMessage</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">State         json.RawMessage <span class="hljs-string">`gorm:&quot;column:state; type:json&quot; json:&quot;state&quot; form:&quot;state&quot;`</span><br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-string">&quot;state&quot;</span>:[<br>    &#123;<br>        <span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;receiveTask1651725819812&quot;</span>,<br>        <span class="hljs-string">&quot;process_method&quot;</span>:<span class="hljs-string">&quot;person&quot;</span>,<br>        <span class="hljs-string">&quot;processor&quot;</span>:[<br>            <span class="hljs-number">5</span><br>        ],<br>        <span class="hljs-string">&quot;label&quot;</span>:<span class="hljs-string">&quot;处理节点&quot;</span><br>    &#125;<br>],<br></code></pre></td></tr></table></figure><p>processValue:是workOrderValue的Process字段从<strong>mysql表</strong>中查找所得，是一个流程Info：<br>原始：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">Process  <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:&quot;column:process; type:int(11)&quot; json:&quot;process&quot; form:&quot;process&quot;`</span>                  <span class="hljs-comment">// 流程ID</span><br></code></pre></td></tr></table></figure><p>转换：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">err = tx.Model(&amp;processValue).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, workOrderValue.Process).Find(&amp;processValue).Error<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Info 流程</span><br><span class="hljs-keyword">type</span> Info <span class="hljs-keyword">struct</span> &#123;<br>        base.Model<br>        Name <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:name; type:varchar(128)&quot; json:&quot;name&quot; form:&quot;name&quot;`</span> <span class="hljs-comment">// 流程名称</span><br>        <span class="hljs-comment">// 图标名称</span><br>        Icon <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:icon; type:varchar(128)&quot; json:&quot;icon&quot; form:&quot;icon&quot;`</span> <span class="hljs-comment">// 流程标签</span><br>        <span class="hljs-comment">// 结构内容，包括edges和nodes还有groups</span><br>        Structure   json.RawMessage <span class="hljs-string">`gorm:&quot;column:structure; type:json&quot; json:&quot;structure&quot; form:&quot;structure&quot;`</span>                        <span class="hljs-comment">// 流程结构</span><br>        Classify    <span class="hljs-type">int</span>             <span class="hljs-string">`gorm:&quot;column:classify; type:int(11)&quot; json:&quot;classify&quot; form:&quot;classify&quot;`</span>                        <span class="hljs-comment">// 分类ID</span><br>        Tpls        json.RawMessage <span class="hljs-string">`gorm:&quot;column:tpls; type:json&quot; json:&quot;tpls&quot; form:&quot;tpls&quot;`</span>                                       <span class="hljs-comment">// 模版</span><br>        Task        json.RawMessage <span class="hljs-string">`gorm:&quot;column:task; type:json&quot; json:&quot;task&quot; form:&quot;task&quot;`</span>                                       <span class="hljs-comment">// 任务ID, array, 可执行多个任务，可以当成通知任务，每个节点都会去执行</span><br>        SubmitCount <span class="hljs-type">int</span>             <span class="hljs-string">`gorm:&quot;column:submit_count; type:int(11); default:0&quot; json:&quot;submit_count&quot; form:&quot;submit_count&quot;`</span> <span class="hljs-comment">// 提交统计</span><br>        Creator     <span class="hljs-type">int</span>             <span class="hljs-string">`gorm:&quot;column:creator; type:int(11)&quot; json:&quot;creator&quot; form:&quot;creator&quot;`</span>                           <span class="hljs-comment">// 创建者</span><br>        Notice      json.RawMessage <span class="hljs-string">`gorm:&quot;column:notice; type:json&quot; json:&quot;notice&quot; form:&quot;notice&quot;`</span>                                 <span class="hljs-comment">// 绑定通知</span><br>        Remarks     <span class="hljs-type">string</span>          <span class="hljs-string">`gorm:&quot;column:remarks; type:varchar(1024)&quot; json:&quot;remarks&quot; form:&quot;remarks&quot;`</span>                     <span class="hljs-comment">// 流程备</span><br>&#125;<br></code></pre></td></tr></table></figure><p>processState是通过processValue的Structure所得：<br>定义：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 作用：获取节点数据</span><br><span class="hljs-keyword">type</span> ProcessState <span class="hljs-keyword">struct</span> &#123;<br>    Structure <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>][]<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-comment">// 是一个map，key是string，value是一个map</span><br>&#125;<br></code></pre></td></tr></table></figure><p>共有这么几个方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// GetNode 获取节点信息,包括开始节点、审批节点、处理节点和结束节点</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *ProcessState)</span></span> GetNode(stateId <span class="hljs-type">string</span>) (nodeValue <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;, err <span class="hljs-type">error</span>) &#123;&#125;<br><br><span class="hljs-comment">// GetEdge 获取流转信息,也就是节点之间的流转关系（简单来说就是线）</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *ProcessState)</span></span> GetEdge(stateId <span class="hljs-type">string</span>, classify <span class="hljs-type">string</span>) (edgeValue []<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;, err <span class="hljs-type">error</span>) &#123;&#125;<br></code></pre></td></tr></table></figure><p>nodeValue：是一个流程信息</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// variableValue是一个list，找到index为0的数据的id对应的节点</span><br>nodeValue, err := processState.GetNode(variableValue[<span class="hljs-number">0</span>].(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)[<span class="hljs-string">&quot;id&quot;</span>].(<span class="hljs-type">string</span>))<br></code></pre></td></tr></table></figure><p>相当于从mysql表中得到对应的流程信息processValue，然后从http请求参数中得到第一个参数的id，得到匹配的流程信息nodeValue</p><p>demo:<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220515181630.png"></p><h1 id="流转"><a href="#流转" class="headerlink" title="流转"></a>流转</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/handle&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ1OTI3NjMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDUwNjM2Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.qYVyiBf_0-c2rD28Zp5iU984JHKF4z81PqXu-C_-DqM&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  --data-raw &#x27;&#123;&quot;tasks&quot;:[&quot;echo_test-4171bc7f4a05-admin.sh&quot;],&quot;source_state&quot;:&quot;start1651725870775&quot;,&quot;target_state&quot;:&quot;receiveTask1651725819812&quot;,&quot;circulation&quot;:&quot;44&quot;,&quot;flow_properties&quot;:1,&quot;work_order_id&quot;:10,&quot;remarks&quot;:&quot;13241234&quot;,&quot;tpls&quot;:[&#123;&quot;tplDataId&quot;:10,&quot;tplId&quot;:1,&quot;tplValue&quot;:&#123;&quot;input_1651725342000_58443&quot;:&quot;测试工单单行文本1&quot;,&quot;file_1652843028000_70959&quot;:[],&quot;imgupload_1652843032000_79963&quot;:[&#123;&quot;key&quot;:&quot;1653151766934_82696&quot;,&quot;url&quot;:&quot;data:image/jpeg;base64,/9j/4AAQS&quot;,&quot;percent&quot;:100,&quot;status&quot;:&quot;uploading&quot;&#125;],&quot;divider_1652843040000_1662&quot;:&quot;分割线&quot;,&quot;subform_1652843043000_29667&quot;:[]&#125;&#125;]&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/process-structure?processId=1&amp;workOrderId=10&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ1OTI3NjMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDUwNjM2Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.qYVyiBf_0-c2rD28Zp5iU984JHKF4z81PqXu-C_-DqM&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1653038287,1653203054,1654327189,1654506358; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654506358; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ1OTI3NjMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDUwNjM2Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.qYVyiBf_0-c2rD28Zp5iU984JHKF4z81PqXu-C_-DqM&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36 Edg/102.0.1245.33&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20220606200949596.png" alt="image-20220606200949596"></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">INSERT INTO `sys_user`(`user_id`, `phone`, `role_id`, `salt`, `avatar`, `sex`, `email`, `dept_id`, `post_id`, `create_by`, `update_by`, `remark`, `status`, `username`, `password`) VALUES (<span class="hljs-number">1</span>, &#x27;<span class="hljs-number">13818888888</span>&#x27;, <span class="hljs-number">1</span>, NULL, &#x27;&#x27;, &#x27;<span class="hljs-number">0</span>&#x27;, &#x27;<span class="hljs-number">1</span>@qq.com&#x27;, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, &#x27;<span class="hljs-number">1</span>&#x27;, &#x27;<span class="hljs-number">1</span>&#x27;, NULL, <span class="hljs-number">0</span>, &#x27;admin&#x27;, &#x27;$<span class="hljs-number">2</span>a$<span class="hljs-number">10</span>$cKFFTCzGOvaIHHJY2K45Zuwt8TD6oPzYi4s5MzYIBAWCLL6ZhouP2&#x27;)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7332d387b222.html"/>
    <url>/2022/12/7332d387b222.html</url>
    
    <content type="html"><![CDATA[<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>POST</p><h2 id="模板页面："><a href="#模板页面：" class="headerlink" title="模板页面："></a>模板页面：</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520171827.png"></p><h2 id="模板内容"><a href="#模板内容" class="headerlink" title="模板内容"></a>模板内容</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520171852.png"></p><h2 id="对应mysql："><a href="#对应mysql：" class="headerlink" title="对应mysql："></a>对应mysql：</h2><p>表：p_tpl_info</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520172015.png"></p><p>form_structure:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1652843023000_87184&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-input&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本格式不正确&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;100%&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;pattern&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dataType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;showPassword&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-input&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本格式不正确&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;100%&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;pattern&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;dataType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;showPassword&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1652843028000_70959&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-wenjianshangchuan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;文件&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;file&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;file_1652843028000_70959&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;tip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;length&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;tokenFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;funcGetToken&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1652843028000_70959&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1652843032000_79963&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-tupian&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;图片&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;imgupload&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;imgupload_1652843032000_79963&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;min&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/photos/&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;isEdit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;length&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;isQiniu&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;isDelete&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;multiple&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;tokenFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;funcGetToken&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1652843032000_79963&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1652843040000_1662&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-input&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;分割线&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;divider&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;divider_1652843040000_1662&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;direction&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;horizontal&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;font_size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;15px&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;font_color&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;#606266&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1652843040000_1662&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;font_family&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;font_weight&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;500&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;分割线&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content_position&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;center&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1652843043000_29667&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-table&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;子表单&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;subform&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;subform_1652843043000_29667&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;columns&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;span&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">12</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;span&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">12</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;align&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;top&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;gutter&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;justify&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1652843043000_29667&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                        <span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;small&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;customClass&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;labelPosition&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;right&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="提交模板"><a href="#提交模板" class="headerlink" title="提交模板"></a>提交模板</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/tpl&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI5NjUxMzUsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1Mjg3ODczNSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.lU2ENfUuT13iXvw65Jfk96OdmjpC-8JzTfvc28d6ytU&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; sidebarStatus=1; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652878730; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI5NjUxMzUsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1Mjg3ODczNSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.lU2ENfUuT13iXvw65Jfk96OdmjpC-8JzTfvc28d6ytU&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.47&#x27; \<br>  --data-raw &#x27;&#123;&quot;name&quot;:&quot;模板1&quot;,&quot;remarks&quot;:&quot;模板1的备注&quot;,&quot;form_structure&quot;:&#123;&quot;list&quot;:[&#123;&quot;type&quot;:&quot;input&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;required&quot;:false,&quot;dataType&quot;:&quot;string&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;disabled&quot;:false,&quot;showPassword&quot;:false,&quot;labelWidth&quot;:100,&quot;labelWidthDisabled&quot;:false,&quot;labelWidthStatus&quot;:true,&quot;displayVerifiy&quot;:&#123;&quot;type&quot;:&quot;hide&quot;,&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;]&#125;,&quot;remoteFunc&quot;:&quot;func_1652887993000_6006&quot;&#125;,&quot;name&quot;:&quot;单行文本&quot;,&quot;key&quot;:&quot;1652887993000_6006&quot;,&quot;model&quot;:&quot;input_1652887993000_6006&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;]&#125;,&#123;&quot;type&quot;:&quot;file&quot;,&quot;icon&quot;:&quot;icon-wenjianshangchuan&quot;,&quot;options&quot;:&#123;&quot;defaultValue&quot;:[],&quot;width&quot;:&quot;&quot;,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;token&quot;:&quot;&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;disabled&quot;:false,&quot;length&quot;:9,&quot;headers&quot;:&#123;&#125;,&quot;tip&quot;:&quot;&quot;,&quot;action&quot;:&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;,&quot;labelWidth&quot;:100,&quot;labelWidthDisabled&quot;:false,&quot;labelWidthStatus&quot;:true,&quot;displayVerifiy&quot;:&#123;&quot;type&quot;:&quot;hide&quot;,&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;]&#125;,&quot;remoteFunc&quot;:&quot;func_1652887997000_87629&quot;&#125;,&quot;name&quot;:&quot;文件&quot;,&quot;key&quot;:&quot;1652887997000_87629&quot;,&quot;model&quot;:&quot;file_1652887997000_87629&quot;,&quot;rules&quot;:[]&#125;],&quot;config&quot;:&#123;&quot;labelWidth&quot;:100,&quot;labelPosition&quot;:&quot;right&quot;,&quot;size&quot;:&quot;small&quot;,&quot;customClass&quot;:&quot;&quot;&#125;&#125;&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h1 id="多行文本-图片-文件"><a href="#多行文本-图片-文件" class="headerlink" title="多行文本+图片+文件"></a>多行文本+图片+文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/tpl&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ1OTI3NjMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDUwNjM2Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.qYVyiBf_0-c2rD28Zp5iU984JHKF4z81PqXu-C_-DqM&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1653038287,1653203054,1654327189,1654506358; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ1OTI3NjMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDUwNjM2Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.qYVyiBf_0-c2rD28Zp5iU984JHKF4z81PqXu-C_-DqM; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654570065; sidebarStatus=1&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36 Edg/102.0.1245.33&#x27; \<br>  --data-raw &#x27;&#123;&quot;name&quot;:&quot;模板3&quot;,&quot;remarks&quot;:&quot;新增模板3&quot;,&quot;form_structure&quot;:&#123;&quot;list&quot;:[&#123;&quot;type&quot;:&quot;textarea&quot;,&quot;icon&quot;:&quot;icon-diy-com-textarea&quot;,&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;required&quot;:false,&quot;disabled&quot;:false,&quot;pattern&quot;:&quot;&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;labelWidth&quot;:100,&quot;labelWidthDisabled&quot;:false,&quot;labelWidthStatus&quot;:true,&quot;displayVerifiy&quot;:&#123;&quot;type&quot;:&quot;hide&quot;,&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;]&#125;,&quot;remoteFunc&quot;:&quot;func_1654570370000_41555&quot;&#125;,&quot;name&quot;:&quot;多行文本&quot;,&quot;key&quot;:&quot;1654570370000_41555&quot;,&quot;model&quot;:&quot;textarea_1654570370000_41555&quot;,&quot;rules&quot;:[]&#125;,&#123;&quot;type&quot;:&quot;file&quot;,&quot;icon&quot;:&quot;icon-wenjianshangchuan&quot;,&quot;options&quot;:&#123;&quot;defaultValue&quot;:[],&quot;width&quot;:&quot;&quot;,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;token&quot;:&quot;&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;disabled&quot;:false,&quot;length&quot;:9,&quot;headers&quot;:&#123;&#125;,&quot;tip&quot;:&quot;&quot;,&quot;action&quot;:&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;,&quot;labelWidth&quot;:100,&quot;labelWidthDisabled&quot;:false,&quot;labelWidthStatus&quot;:true,&quot;displayVerifiy&quot;:&#123;&quot;type&quot;:&quot;hide&quot;,&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;]&#125;,&quot;remoteFunc&quot;:&quot;func_1654570386000_29018&quot;&#125;,&quot;name&quot;:&quot;文件&quot;,&quot;key&quot;:&quot;1654570386000_29018&quot;,&quot;model&quot;:&quot;file_1654570386000_29018&quot;,&quot;rules&quot;:[]&#125;,&#123;&quot;type&quot;:&quot;imgupload&quot;,&quot;icon&quot;:&quot;icon-tupian&quot;,&quot;options&quot;:&#123;&quot;defaultValue&quot;:[],&quot;size&quot;:&#123;&quot;width&quot;:100,&quot;height&quot;:100&#125;,&quot;width&quot;:&quot;&quot;,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;token&quot;:&quot;&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;disabled&quot;:false,&quot;length&quot;:8,&quot;multiple&quot;:false,&quot;isQiniu&quot;:false,&quot;isDelete&quot;:false,&quot;min&quot;:0,&quot;isEdit&quot;:false,&quot;action&quot;:&quot;https://jsonplaceholder.typicode.com/photos/&quot;,&quot;labelWidth&quot;:100,&quot;labelWidthDisabled&quot;:false,&quot;labelWidthStatus&quot;:true,&quot;displayVerifiy&quot;:&#123;&quot;type&quot;:&quot;hide&quot;,&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;]&#125;,&quot;remoteFunc&quot;:&quot;func_1654570389000_68958&quot;&#125;,&quot;name&quot;:&quot;图片&quot;,&quot;key&quot;:&quot;1654570389000_68958&quot;,&quot;model&quot;:&quot;imgupload_1654570389000_68958&quot;,&quot;rules&quot;:[]&#125;],&quot;config&quot;:&#123;&quot;labelWidth&quot;:100,&quot;labelPosition&quot;:&quot;right&quot;,&quot;size&quot;:&quot;small&quot;,&quot;customClass&quot;:&quot;&quot;&#125;&#125;&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h2 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;模板3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;remarks&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;新增模板3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;form_structure&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;textarea&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-diy-com-textarea&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;100%&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;pattern&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                            <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">]</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1654570370000_41555&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;多行文本&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1654570370000_41555&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;textarea_1654570370000_41555&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;file&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-wenjianshangchuan&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tokenFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;funcGetToken&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;length&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                            <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">]</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1654570386000_29018&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;文件&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1654570386000_29018&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;file_1654570386000_29018&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;imgupload&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-tupian&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;tokenFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;funcGetToken&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;length&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;multiple&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;isQiniu&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;isDelete&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;min&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;isEdit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;action&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/photos/&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                            <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">]</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1654570389000_68958&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;图片&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1654570389000_68958&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;imgupload_1654570389000_68958&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;labelPosition&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;right&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;small&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;customClass&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/ba6bc25da20d.html"/>
    <url>/2022/12/ba6bc25da20d.html</url>
    
    <content type="html"><![CDATA[<h1 id="从一个最简单的实例开始："><a href="#从一个最简单的实例开始：" class="headerlink" title="从一个最简单的实例开始："></a>从一个最简单的实例开始：</h1><p>这里有两个 POJO：MyTestBean 和 MyTestBean2</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/basicSpring" width="100%"/><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//MyTestBean</span><br><span class="hljs-keyword">package</span> com.coachhe.spring.Bean;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestBean</span> &#123;  <br> String testStr;  <br> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTestStr</span><span class="hljs-params">()</span> &#123;  <br>      <span class="hljs-keyword">return</span> testStr;  <br> &#125;  <br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTestStr</span><span class="hljs-params">(String testStr)</span> &#123;  <br>      <span class="hljs-built_in">this</span>.testStr = testStr;  <br> &#125;  <br> <span class="hljs-comment">//为了debug方便，确认什么时候创建了这个bean</span><br> <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyTestBean</span><span class="hljs-params">()</span> &#123;  <br>      System.out.println(<span class="hljs-string">&quot;Bean myTestBean is creating&quot;</span>);  <br> &#125;<br>&#125;<br><br><span class="hljs-comment">//MyTestBean2</span><br><span class="hljs-keyword">package</span> com.coachhe.spring.Bean;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestBean2</span> &#123;  <br> <span class="hljs-type">String</span> <span class="hljs-variable">testStr2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;  <br> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTestStr2</span><span class="hljs-params">()</span> &#123;  <br>      <span class="hljs-keyword">return</span> testStr2;  <br> &#125;  <br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTestStr2</span><span class="hljs-params">(String testStr2)</span> &#123;  <br>      <span class="hljs-built_in">this</span>.testStr2 = testStr2;  <br> &#125;  <br> <span class="hljs-comment">//为了debug方便，确认什么时候创建了这个bean</span><br> <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyTestBean2</span><span class="hljs-params">()</span> &#123;  <br>      System.out.println(<span class="hljs-string">&quot;Bean myTestBean2 is creating&quot;</span>);  <br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- applicationContext.xml --&gt;</span><br>&lt;? xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testStr1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.coachhe.spring.Bean.MyTestBean&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;testStr&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;testStr1&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testStr2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.coachhe.spring.Bean.MyTestBean2&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;testStr2&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;testStr2&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Main.java</span><br><span class="hljs-keyword">package</span> com.coachhe.spring;<br><span class="hljs-keyword">import</span> com.coachhe.spring.Bean.MyTestBean;<br><span class="hljs-keyword">import</span> com.coachhe.spring.Bean.MyTestBean2;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br><span class="hljs-type">MyTestBean</span> <span class="hljs-variable">myTestBean1</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">&quot;testStr1&quot;</span>, MyTestBean.class);<br><span class="hljs-type">MyTestBean2</span> <span class="hljs-variable">myTestBean2</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">&quot;testStr2&quot;</span>, MyTestBean2.class);<br>System.out.println(myTestBean1.getTestStr());<br>System.out.println(myTestBean2.getTestStr2());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>就这样，无需什么额外操作，即可输出最终的结果：在 <code>applicationContext.xml </code> 中赋值的 testStr1 和 testStr2<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/spring3.png"></p><p>可以看到，两个实例的属性正常输出，并且两个构造函数中的语句也被正常输出，说明两个实例都被正常创建了。<br>本节的目的是确认何时创建了 bean，因为在 debug 时只要控制台输出了构造函数中的语句，则表名 bean 已经被创建了。</p><h1 id="开始-Debug"><a href="#开始-Debug" class="headerlink" title="开始 Debug"></a>开始 Debug</h1><p>直接在 <code>ApplicationContext context = new ClassPathXmlApplicationContext (&quot;applicationContext. Xml&quot;); </code> 这里打上断点，开始 debug。<br>直接进入，可以看到最开始调用的是 ClassPathXmlApplicationContext 的单参构造方法，但是最终实际调用的是三个参数的构造方法。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/spring4.png"></p><p>实际调用的是这个：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211130004515.png"></p><p><code>super(parent)</code> 作用就是设置父类，没有实质作用，<code>setConfigLocation()</code> 作用是继承于 <code>AbstractRefreshableConfigApplicationContexta. java</code> 类的一个方法，作用是设置当前配置文件的位置。</p><p>最重要的是 <code>refresh()</code> 类，这个类是真正创建实例的类。</p><p>打上断点，进入 <code>refresh()</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException &#123;<br><span class="hljs-comment">//首先是同步锁，目的是保证多线程情况下ioc容器只会被创建一次</span><br><span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.startupShutdownMonitor) &#123;<br><span class="hljs-type">StartupStep</span> <span class="hljs-variable">contextRefresh</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.context.refresh&quot;</span>);<br><br><span class="hljs-comment">// Prepare this context for refreshing.</span><br><span class="hljs-comment">// 准备容器刷新</span><br>prepareRefresh();<br><br><span class="hljs-comment">// Tell the subclass to refresh the internal bean factory.</span><br><span class="hljs-comment">// 解析XML配置文件，将要创建了所有bean的配置信息保存起来</span><br><span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> obtainFreshBeanFactory();<br><br><span class="hljs-comment">// Prepare the bean factory for use in this context.</span><br>prepareBeanFactory(beanFactory);<br><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// Allows post-processing of the bean factory in context subclasses.</span><br>postProcessBeanFactory(beanFactory);<br><br><span class="hljs-type">StartupStep</span> <span class="hljs-variable">beanPostProcess</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.context.beans.post-process&quot;</span>);<br><span class="hljs-comment">// Invoke factory processors registered as beans in the context.</span><br><span class="hljs-comment">// 用来支持国际化功能</span><br>invokeBeanFactoryPostProcessors(beanFactory);<br><br><span class="hljs-comment">// Register bean processors that intercept bean creation.</span><br>registerBeanPostProcessors(beanFactory);<br>beanPostProcess.end();<br><br><span class="hljs-comment">// Initialize message source for this context.</span><br>initMessageSource();<br><br><span class="hljs-comment">// Initialize event multicaster for this context.</span><br>initApplicationEventMulticaster();<br><br><span class="hljs-comment">// Initialize other special beans in specific context subclasses.</span><br><span class="hljs-comment">// 专门给子类的，可以自己实现</span><br>onRefresh();<br><br><span class="hljs-comment">// Check for listener beans and register them.</span><br>registerListeners();<br><br><span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span><br><span class="hljs-comment">// 重要！ 在这里创建了所有实例</span><br>finishBeanFactoryInitialization(beanFactory);<br><br><span class="hljs-comment">// Last step: publish corresponding event.</span><br>finishRefresh();<br>&#125;<br><br><span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br><span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;<br>logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - &quot;</span> +<br><span class="hljs-string">&quot;cancelling refresh attempt: &quot;</span> + ex);<br>&#125;<br><br><span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span><br>destroyBeans();<br><br><span class="hljs-comment">// Reset &#x27;active&#x27; flag.</span><br>cancelRefresh(ex);<br><br><span class="hljs-comment">// Propagate exception to caller.</span><br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br><br><span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-comment">// Reset common introspection caches in Spring&#x27;s core, since we</span><br><span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span><br>resetCommonCaches();<br>contextRefresh.end();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在执行完 <code>finishBeanFactoryInitialization(beanFactory);</code> 方法之后，实例全部被创建了，因此我们来看这个方法，还是在 <code>AbstractApplicationContext.java</code> 类中。</p><p>来看看 <code>finishBeanFactoryInitialization</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Finish the initialization of this context&#x27;s bean factory,</span><br><span class="hljs-comment"> * initializing all remaining singleton beans.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finishBeanFactoryInitialization</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br><span class="hljs-comment">// Initialize conversion service for this context.</span><br><span class="hljs-keyword">if</span> (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;<br>beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123;<br>beanFactory.setConversionService(<br>beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));<br>&#125;<br><br><span class="hljs-comment">// Register a default embedded value resolver if no BeanFactoryPostProcessor</span><br><span class="hljs-comment">// (such as a PropertySourcesPlaceholderConfigurer bean) registered any before:</span><br><span class="hljs-comment">// at this point, primarily for resolution in annotation attribute values.</span><br><span class="hljs-keyword">if</span> (!beanFactory.hasEmbeddedValueResolver()) &#123;<br>beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));<br>&#125;<br><br><span class="hljs-comment">// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.</span><br>String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br><span class="hljs-keyword">for</span> (String weaverAwareName : weaverAwareNames) &#123;<br>getBean(weaverAwareName);<br>&#125;<br><br><span class="hljs-comment">// Stop using the temporary ClassLoader for type matching.</span><br>beanFactory.setTempClassLoader(<span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// Allow for caching all bean definition metadata, not expecting further changes.</span><br>beanFactory.freezeConfiguration();<br><br><span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span><br><span class="hljs-comment">// 初始化所有单实例bean 不能方形</span><br>beanFactory.preInstantiateSingletons();<br>&#125;<br></code></pre></td></tr></table></figure><p>其余都是一些判断，最重要的方法其实就是最后一行 <code>beanFactory.preInstantiateSingletons();</code> 所以我们打上断点，进入其中：</p><p>可以发现，进入了一个 <code>DefaultListableBeanFactory</code> 类中，方法具体为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">preInstantiateSingletons</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br><span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>logger.trace(<span class="hljs-string">&quot;Pre-instantiating singletons in &quot;</span> + <span class="hljs-built_in">this</span>);<br>&#125;<br><br><span class="hljs-comment">// Iterate over a copy to allow for init methods which in turn register new bean definitions.</span><br><span class="hljs-comment">// While this may not be part of the regular factory bootstrap, it does otherwise work fine.</span><br><span class="hljs-comment">// 得到所有要创建的bean名，放入beanNames这个List中。</span><br>List&lt;String&gt; beanNames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-built_in">this</span>.beanDefinitionNames);<br><br><span class="hljs-comment">// Trigger initialization of all non-lazy singleton beans...</span><br><span class="hljs-comment">// 增强for循环，按顺序创建bean</span><br><span class="hljs-keyword">for</span> (String beanName : beanNames) &#123;<br><span class="hljs-comment">// 根据beanid获取到bean的定义信息(保存在xml文件中，就是解析到AbstractBeanFactory的mergedBeanDefinitions里保存）</span><br><span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">bd</span> <span class="hljs-operator">=</span> getMergedLocalBeanDefinition(beanName);<br><span class="hljs-comment">// 判断bean是单实例的，不是抽象的并且不是懒加载的，则进行加载</span><br><span class="hljs-keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;<br><span class="hljs-comment">// 判断是否为工厂bean（也就是调用工厂方法创建的bean），我们的就是普通bean，不是factory bean，因此判断为false</span><br><span class="hljs-keyword">if</span> (isFactoryBean(beanName)) &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> getBean(FACTORY_BEAN_PREFIX + beanName);<br><span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> FactoryBean) &#123;<br>FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean;<br><span class="hljs-type">boolean</span> isEagerInit;<br><span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-literal">null</span> &amp;&amp; factory <span class="hljs-keyword">instanceof</span> SmartFactoryBean) &#123;<br>isEagerInit = AccessController.doPrivileged(<br>(PrivilegedAction&lt;Boolean&gt;) ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit,<br>getAccessControlContext());<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>isEagerInit = (factory <span class="hljs-keyword">instanceof</span> SmartFactoryBean &amp;&amp;<br>((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());<br>&#125;<br><span class="hljs-keyword">if</span> (isEagerInit) &#123;<br>getBean(beanName);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//最终执行的实际上为这个方法,bean创建的细节</span><br>getBean(beanName);<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// Trigger post-initialization callback for all applicable beans...</span><br><span class="hljs-keyword">for</span> (String beanName : beanNames) &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">singletonInstance</span> <span class="hljs-operator">=</span> getSingleton(beanName);<br><span class="hljs-keyword">if</span> (singletonInstance <span class="hljs-keyword">instanceof</span> SmartInitializingSingleton) &#123;<br><span class="hljs-type">StartupStep</span> <span class="hljs-variable">smartInitialize</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getApplicationStartup().start(<span class="hljs-string">&quot;spring.beans.smart-initialize&quot;</span>)<br>.tag(<span class="hljs-string">&quot;beanName&quot;</span>, beanName);<br><span class="hljs-type">SmartInitializingSingleton</span> <span class="hljs-variable">smartSingleton</span> <span class="hljs-operator">=</span> (SmartInitializingSingleton) singletonInstance;<br><span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-literal">null</span>) &#123;<br>AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123;<br>smartSingleton.afterSingletonsInstantiated();<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;, getAccessControlContext());<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>smartSingleton.afterSingletonsInstantiated();<br>&#125;<br>smartInitialize.end();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>过程就是首先将 bean 的名称封装到一个 List 中，然后按顺序创建 bean，最终实际调用的是 <code>getBean()</code> 这个方法，进入 getBean 中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br><span class="hljs-keyword">return</span> doGetBean(name, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，实际调用的是 <code>AbstractBeanFactory</code>  类中四个参数的 <code>doGetBean()</code> 方法，继续进入：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> &lt;T&gt; T <span class="hljs-title function_">doGetBean</span><span class="hljs-params">(</span><br><span class="hljs-params">String name, <span class="hljs-meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="hljs-meta">@Nullable</span> Object[] args, <span class="hljs-type">boolean</span> typeCheckOnly)</span><br><span class="hljs-keyword">throws</span> BeansException &#123;<br><br><span class="hljs-type">String</span> <span class="hljs-variable">beanName</span> <span class="hljs-operator">=</span> transformedBeanName(name);<br>Object beanInstance;<br><br><span class="hljs-comment">// Eagerly check singleton cache for manually registered singletons.</span><br><span class="hljs-comment">// 先从已经注册的所有单实例bean中检查是否有这个bean，如果没有则创建</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">sharedInstance</span> <span class="hljs-operator">=</span> getSingleton(beanName);<br><span class="hljs-keyword">if</span> (sharedInstance != <span class="hljs-literal">null</span> &amp;&amp; args == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br><span class="hljs-keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;<br>logger.trace(<span class="hljs-string">&quot;Returning eagerly cached instance of singleton bean &#x27;&quot;</span> + beanName +<br><span class="hljs-string">&quot;&#x27; that is not fully initialized yet - a consequence of a circular reference&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>logger.trace(<span class="hljs-string">&quot;Returning cached instance of singleton bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br>&#125;<br>beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="hljs-literal">null</span>);<br>&#125;<br><span class="hljs-comment">// 第一次创建时直接来到这里</span><br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// Fail if we&#x27;re already creating this bean instance:</span><br><span class="hljs-comment">// We&#x27;re assumably within a circular reference.</span><br><span class="hljs-keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCurrentlyInCreationException</span>(beanName);<br>&#125;<br><br><span class="hljs-comment">// Check if bean definition exists in this factory.</span><br><span class="hljs-type">BeanFactory</span> <span class="hljs-variable">parentBeanFactory</span> <span class="hljs-operator">=</span> getParentBeanFactory();<br><span class="hljs-keyword">if</span> (parentBeanFactory != <span class="hljs-literal">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;<br><span class="hljs-comment">// Not found -&gt; check parent.</span><br><span class="hljs-type">String</span> <span class="hljs-variable">nameToLookup</span> <span class="hljs-operator">=</span> originalBeanName(name);<br><span class="hljs-keyword">if</span> (parentBeanFactory <span class="hljs-keyword">instanceof</span> AbstractBeanFactory) &#123;<br><span class="hljs-keyword">return</span> ((AbstractBeanFactory) parentBeanFactory).doGetBean(<br>nameToLookup, requiredType, args, typeCheckOnly);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// Delegation to parent with explicit args.</span><br><span class="hljs-keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (requiredType != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// No args -&gt; delegate to standard getBean method.</span><br><span class="hljs-keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// 这个就是传过来的最后一个参数，为false，因此需要调用markBeanAsCreated方法，标记已经创建了这个bean</span><br><span class="hljs-keyword">if</span> (!typeCheckOnly) &#123;<br>markBeanAsCreated(beanName);<br>&#125;<br><br><span class="hljs-type">StartupStep</span> <span class="hljs-variable">beanCreation</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.beans.instantiate&quot;</span>)<br>.tag(<span class="hljs-string">&quot;beanName&quot;</span>, name);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (requiredType != <span class="hljs-literal">null</span>) &#123;<br>beanCreation.tag(<span class="hljs-string">&quot;beanType&quot;</span>, requiredType::toString);<br>&#125;<br><br><span class="hljs-comment">// 获取当前bean的定义信息,例如class类型，是否有dependsOn等（也就是该bean的创建是否依赖于其他bean）</span><br><span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">mbd</span> <span class="hljs-operator">=</span> getMergedLocalBeanDefinition(beanName);<br>checkMergedBeanDefinition(mbd, beanName, args);<br><br><span class="hljs-comment">// Guarantee initialization of beans that the current bean depends on.</span><br><span class="hljs-comment">// 先拿到dependsOn的Bean，是一个字符串数组，然后会先创建这些dependsOn的Bean，最后再创建自己这个bean（循环创建）</span><br>String[] dependsOn = mbd.getDependsOn();<br><span class="hljs-keyword">if</span> (dependsOn != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">for</span> (String dep : dependsOn) &#123;<br><span class="hljs-keyword">if</span> (isDependent(beanName, dep)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,<br><span class="hljs-string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br>registerDependentBean(dep, beanName);<br><span class="hljs-keyword">try</span> &#123;<br>getBean(dep);<br>&#125;<br><span class="hljs-keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,<br><span class="hljs-string">&quot;&#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="hljs-string">&quot;&#x27;&quot;</span>, ex);<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// Create bean instance.</span><br><span class="hljs-comment">// 如果mbd为单例，则创建bean实例</span><br><span class="hljs-keyword">if</span> (mbd.isSingleton()) &#123;<br>sharedInstance = getSingleton(beanName, () -&gt; &#123;<br><span class="hljs-comment">// getSingleton这个方法我们在之前判断bean是否创建的时候调用过</span><br><span class="hljs-comment">// Object sharedInstance = getSingleton(beanName);</span><br><span class="hljs-comment">// 结果为null，表示没有创建过</span><br><span class="hljs-comment">// 不过在这里调用的是有两个参数的getSingleton方法，</span><br><span class="hljs-comment">// 其中第二个参数是一个匿名内部类，作用是调用createBean方法，创建一个Bean</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>&#125;<br><span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br><span class="hljs-comment">// Explicitly remove instance from singleton cache: It might have been put there</span><br><span class="hljs-comment">// eagerly by the creation process, to allow for circular reference resolution.</span><br><span class="hljs-comment">// Also remove any beans that received a temporary reference to the bean.</span><br>destroySingleton(beanName);<br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br>&#125;);<br>beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);<br>&#125;<br><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mbd.isPrototype()) &#123;<br><span class="hljs-comment">// It&#x27;s a prototype -&gt; create a new instance.</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">prototypeInstance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">try</span> &#123;<br>beforePrototypeCreation(beanName);<br>prototypeInstance = createBean(beanName, mbd, args);<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>afterPrototypeCreation(beanName);<br>&#125;<br>beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);<br>&#125;<br><br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">scopeName</span> <span class="hljs-operator">=</span> mbd.getScope();<br><span class="hljs-keyword">if</span> (!StringUtils.hasLength(scopeName)) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;No scope name defined for bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br><span class="hljs-type">Scope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.scopes.get(scopeName);<br><span class="hljs-keyword">if</span> (scope == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">scopedInstance</span> <span class="hljs-operator">=</span> scope.get(beanName, () -&gt; &#123;<br>beforePrototypeCreation(beanName);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>afterPrototypeCreation(beanName);<br>&#125;<br>&#125;);<br>beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);<br>&#125;<br><span class="hljs-keyword">catch</span> (IllegalStateException ex) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScopeNotActiveException</span>(beanName, scopeName, ex);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>beanCreation.tag(<span class="hljs-string">&quot;exception&quot;</span>, ex.getClass().toString());<br>beanCreation.tag(<span class="hljs-string">&quot;message&quot;</span>, String.valueOf(ex.getMessage()));<br>cleanupAfterBeanCreationFailure(beanName);<br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br>beanCreation.end();<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">return</span> adaptBeanInstance(name, beanInstance, requiredType);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>可以看到，最重要的方法是 <code>getSingleton</code><br>值得注意的是，这里的 <code>getSingleton</code> 方法是第二次调用的方法，该方法总共被调用了两次，第一次是用来判断 bean 是否创建过，只有一个参数，返回了 null，表示没有创建过。<br>在第二次调用时有两个参数，第二个参数是一个匿名内部类，这个类作为参数被传入 <code>getSingleton()</code> 方法中，作用是调用 <code>createBean()</code> 方法，创建一个 Bean，由此可见，真正创建 bean 的方法是 <code>createBean(beanName, mbd, args)</code>.</p><p>在这里需要解释一下的是 <code>createBean()</code> 为什么会被调用。<br>这就需要了解一下用 Lambda 表达式表示匿名内部类的方法了：</p><h3 id="用-lambda-表达式表示匿名内部类"><a href="#用-lambda-表达式表示匿名内部类" class="headerlink" title="用 lambda 表达式表示匿名内部类"></a>用 lambda 表达式表示匿名内部类</h3><p>用 Lambda 表达式表达匿名内部类时， Lambda 不需要接口名和方法名，写出实现方法体即可，编译器会自动去识别。但是前提是接口为函数接口，即只有一个抽象方法。<br>具体的，我们可以看下 <code>getSingleton()</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getSingleton</span> <span class="hljs-params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> &#123;<br>Assert.notNull (beanName, <span class="hljs-string">&quot;Bean name must not be null&quot;</span>);<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.singletonObjects) &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">singletonObject</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);<br><span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.singletonsCurrentlyInDestruction) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationNotAllowedException</span>(beanName,<br><span class="hljs-string">&quot;Singleton bean creation not allowed while singletons of this factory are in destruction &quot;</span> +<br><span class="hljs-string">&quot;(Do not request a bean from a BeanFactory in a destroy method implementation!)&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>logger.debug(<span class="hljs-string">&quot;Creating shared instance of singleton bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>&#125;<br>beforeSingletonCreation(beanName);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">newSingleton</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">recordSuppressedExceptions</span> <span class="hljs-operator">=</span> (<span class="hljs-built_in">this</span>.suppressedExceptions == <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">if</span> (recordSuppressedExceptions) &#123;<br><span class="hljs-built_in">this</span>.suppressedExceptions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// 在这里真正创建了bean</span><br>singletonObject = singletonFactory.getObject();<br>newSingleton = <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">catch</span> (IllegalStateException ex) &#123;<br><span class="hljs-comment">// Has the singleton object implicitly appeared in the meantime -&gt;</span><br><span class="hljs-comment">// if yes, proceed with it since the exception indicates that state.</span><br>singletonObject = <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);<br><span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br>&#125;<br><span class="hljs-keyword">catch</span> (BeanCreationException ex) &#123;<br><span class="hljs-keyword">if</span> (recordSuppressedExceptions) &#123;<br><span class="hljs-keyword">for</span> (Exception suppressedException : <span class="hljs-built_in">this</span>.suppressedExceptions) &#123;<br>ex.addRelatedCause(suppressedException);<br>&#125;<br>&#125;<br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br><span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-keyword">if</span> (recordSuppressedExceptions) &#123;<br><span class="hljs-built_in">this</span>.suppressedExceptions = <span class="hljs-literal">null</span>;<br>&#125;<br>afterSingletonCreation(beanName);<br>&#125;<br><span class="hljs-keyword">if</span> (newSingleton) &#123;<br><span class="hljs-comment">// 在这里将bean放入ioc容器中</span><br>addSingleton(beanName, singletonObject);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> singletonObject;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这里，传入的对象自动被向上转型成 <code>ObjectFactory&lt;?&gt; singletonFactory</code>，我们来看看这个类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObjectFactory</span>&lt;T&gt; &#123;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Return an instance (possibly shared or independent)</span><br><span class="hljs-comment"> * of the object managed by this factory.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the resulting instance</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> BeansException in case of creation errors</span><br><span class="hljs-comment"> */</span><br>T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>可以看到，这个类只有一个方法，getObject 方法，所以我们相当于用 lambda 表达式生成了一个匿名内部类，这个匿名内部类只有一个方法，就是重写的 getObject 方法，相当于：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">lambdaClass</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>&#125;<br><span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br><span class="hljs-comment">// Explicitly remove instance from singleton cache: It might have been put there</span><br><span class="hljs-comment">// eagerly by the creation process, to allow for circular reference resolution.</span><br><span class="hljs-comment">// Also remove any beans that received a temporary reference to the bean.</span><br>destroySingleton(beanName);<br><span class="hljs-keyword">throw</span> ex;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>所以在 getSingleton 方法执行到</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// 在这里真正创建了bean</span><br>singletonObject = singletonFactory.getObject();<br>newSingleton = <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里的时候，我们执行了 getObject 方法，也就执行了 createBean 方法，所以 Bean 就被创建了！</p><h3 id="Ioc-容器的含义以及将-bean-放入-ioc-容器的方法"><a href="#Ioc-容器的含义以及将-bean-放入-ioc-容器的方法" class="headerlink" title="Ioc 容器的含义以及将 bean 放入 ioc 容器的方法"></a>Ioc 容器的含义以及将 bean 放入 ioc 容器的方法</h3><p>在之后会执行一个 <code>addSingleton(beanName, singletonObejct)</code> 方法，作用是将创建好的对象会保存在一个 Map 中，也就是 ioc 容器中。<br>我们来看一下 <code>addSingleton</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addSingleton</span><span class="hljs-params">(String beanName, Object singletonObject)</span> &#123;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.singletonObjects) &#123;<br><span class="hljs-built_in">this</span>.singletonObjects.put(beanName, singletonObject);<br><span class="hljs-built_in">this</span>.singletonFactories.remove(beanName);<br><span class="hljs-built_in">this</span>.earlySingletonObjects.remove(beanName);<br><span class="hljs-built_in">this</span>.registeredSingletons.add(beanName);<br>&#125;<br></code></pre></td></tr></table></figure><p>而 singletonObjects 的定义是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** Cache of singleton objects: bean name to bean instance. */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">256</span>);<br></code></pre></td></tr></table></figure><p>可以看到，这其实就是一个 ConcurrentHashMap，也就是我们的 ioc 容器之一！<br>注意，这里的之一是因为在这里只是单例的 ioc 容器，还有其他的容器。</p><h1 id="BeanFactory-和-ApplicationContext-的区别"><a href="#BeanFactory-和-ApplicationContext-的区别" class="headerlink" title="BeanFactory 和 ApplicationContext 的区别"></a>BeanFactory 和 ApplicationContext 的区别</h1><p><code>ApplicationContext</code> 是 <code>BeanFactory</code> 的子接口；<br><code>BeanFactory</code> ：bean 的工厂接口；负责创建 bean 实例。<br><code>ApplicationContext</code> ：是容器接口；更多的负责容器功能的实现；可以基于 <code>beanFactory</code> 创建好的对象智商完成强大的容器。<br>    容器可以从 map 获取这个 bean，并且 aop、di 等等功能都在 <code>ApplicationContext</code> 接口下的这些类里面。</p><p>总的来说，<code>BeanFactory</code> 是最底层的接口，<code>ApplicationContext</code> 是留给程序员的 ioc 容器接口； <code>ApplicationContext</code> 是 <code>BeanFactory</code> 的子接口；</p><p>Spring 最大的模式就是工厂模式。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>Spring源码解析-coachhe</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/ea51fb3f3b99.html"/>
    <url>/2022/12/ea51fb3f3b99.html</url>
    
    <content type="html"><![CDATA[<p>&#x3D;&#x3D;⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠&#x3D;&#x3D;</p><h1 id="Text-Elements"><a href="#Text-Elements" class="headerlink" title="Text Elements"></a>Text Elements</h1><p>interface UserDao{<br>    public void login()<br>} ^beAQcED1</p><p>class UserDaoImpl implements UserDao {<br>    public void login(){<br>        &#x2F;&#x2F;登陆实现过程<br>    }<br>} ^aX7myl5c</p><p>JDK动态代理 ^bjcbHSW4</p><ol><li>创建UserDao接口实现类代理对象 ^Tt3VvD89</li></ol><p>代理对象 ^CUWymEWo</p><p>动态代理有接口 ^OFkC7Ruu</p><p>动态代理没有接口 ^27ft48kc</p><p>xml ^jTcG82tV</p><p>注释 ^iP6yIm4e</p><p>BeanDefinition<br>保留原始值 ^TtXJNUBX</p><p>最终的BD对象 ^SQTyLy1H</p><p>BeanFactoryBeanPostProcessor ^yo88GmqG</p><p>创建对象 ^b7llipli</p><p>使用 ^vuQK3UUY</p><p>销毁 ^7H8yZe1P</p><p>BeanFactory ^mvEmCpLv</p><p>反射 ^rrLL8DZ3</p><p>bean的定义信息 ^UXKsBC8Q</p><p>%%</p><h1 id="Drawing"><a href="#Drawing" class="headerlink" title="Drawing"></a>Drawing</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;excalidraw&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://excalidraw.com&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;elements&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">187</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1823102407</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;beAQcED1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-451.29052734375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-273.6344451904297</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">270</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">72</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1566737543</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952086</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;interface UserDao&#123;\n    public void login()\n&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;interface UserDao&#123;\n    public void login()\n&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">67</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2034181511</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aX7myl5c&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-448.54833984375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-165.9742431640625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">445</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">124</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">518443015</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952086</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;class UserDaoImpl implements UserDao &#123;\n    public void login()&#123;\n        //登陆实现过程\n    &#125;\n&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;class UserDaoImpl implements UserDao &#123;\n    public void login()&#123;\n        //登陆实现过程\n    &#125;\n&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1911850983</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bjcbHSW4&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-245</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">115</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">752529351</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JDK动态代理&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JDK动态代理&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">80</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">450060295</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Tt3VvD89&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">175</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-207</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">337</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1970857193</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1. 创建UserDao接口实现类代理对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1. 创建UserDao接口实现类代理对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4655559</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CUWymEWo&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">185.6837158203125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-164.07208251953125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">80</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1166166599</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;代理对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;代理对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">67</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2072990601</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Xn08mZiS0c7n7JBobnMtn&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-452.839599609375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-278.25201416015625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">284.148681640625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">77.89923095703125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1248868583</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;l7HDWeDznMOz-BZIE2-2d&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">156</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">82180455</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2UlHZ_FIJn3VAk7LxIs8F&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-452.89019775390625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-169.555908203125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">462.5889892578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">129.42971801757812</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2088882537</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">152</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1733163625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6frTuOMjg6Z5cPdfJTE6l&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.0716552734375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-247.74319458007812</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">374.5478515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">112.76889038085938</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">684733575</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;l7HDWeDznMOz-BZIE2-2d&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1181238663</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;l7HDWeDznMOz-BZIE2-2d&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-162.0648193359375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-253.02328491210938</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">301.3424072265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.983001708984375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1480843753</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Xn08mZiS0c7n7JBobnMtn&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.644357777492803</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6.6260986328125</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6frTuOMjg6Z5cPdfJTE6l&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.4221132922802554</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19.7940673828125</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">301.3424072265625</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">59.983001708984375</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">73</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">941479721</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OFkC7Ruu&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-633.4743041992188</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-236.08453369140625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">140</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1255626953</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;动态代理有接口&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;动态代理有接口&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">157</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1083310377</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;27ft48kc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-675.8885359330617</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">84.46453996138149</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">160</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">118044423</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;动态代理没有接口&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;动态代理没有接口&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">157695529</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3kqZ8cjF31p3sLMiCl5ir&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-407.5541159889917</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">374.0019004128196</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193.64852905273438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.681396484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1887982057</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1212514983</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jTcG82tV&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-333.38068459250735</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">392.08864662863994</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">35</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">236206759</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xml&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xml&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;left&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">520380007</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dz9humoAHb_xMM4OSkbHg&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-410.1731345436792</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">494.19694588401103</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">196.91078186035156</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">62.50091552734375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1802264519</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1770374919</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;iP6yIm4e&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-335.9870002053003</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">512.4256446144798</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">570525289</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;注释&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;注释&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;middle&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">110</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1755055465</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;gaXimlatuDYg9QUyO6QBT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-212.37307045676516</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">403.83290932395244</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">79.26200866699219</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.24631500244140625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32282055</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">79.26200866699219</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.24631500244140625</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">104</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">183267879</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3nLhywAB3WUobJdmnpx35&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-132.19248268821048</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">403.7037436745384</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6851959228515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">122.62157440185547</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1470722121</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0.6851959228515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">122.62157440185547</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">39</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">605025929</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Cf9sGlQ5IPuUJRZ3dLExu&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-211.9821402809839</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">529.7211997292259</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">80.52421569824219</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.0503768920898438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1234725865</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">80.52421569824219</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-1.0503768920898438</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1346762599</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GscEqj3NGeLasknpZEwNL&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-130.85253212668704</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">461.24440834738994</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">129.9395751953125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.1863174438476562</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">499268969</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8v07jSQfw4R6mnFDGjzXC&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.022022354326335102</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.8125457763671875</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">129.9395751953125</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-2.1863174438476562</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">83</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">548877225</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8v07jSQfw4R6mnFDGjzXC&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.8995888449926497</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">426.814247824929</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193.64852905273438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.681396484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1438831847</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;GscEqj3NGeLasknpZEwNL&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;Slad-EKRoU_X3C072-XTS&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">80</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1980023367</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ud2v3Q4Kua6471Xw8NnfR&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.119727394797337</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">238.30304787375712</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193.64852905273438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.681396484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">940312775</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-string">&quot;Slad-EKRoU_X3C072-XTS&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-string">&quot;n6rbcbHZAB7aQkdf9CfjY&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">76</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1536416649</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VlpW3hWIOuwAN7HwOfySq&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">383.447776100852</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">235.12071297385478</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193.64852905273438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.681396484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">943736009</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">71</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1652791431</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;QJqreTVIGwf0z_BCtxDl1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">384.09734275124265</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">337.21650765158915</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193.64852905273438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.681396484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1702986345</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">78</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1132491399</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Slad-EKRoU_X3C072-XTS&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">92.88829296519955</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">425.8139579079368</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.37082989723775484</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">126.27349853515625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1968709193</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8v07jSQfw4R6mnFDGjzXC&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.08177932381446106</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.0002899169921875</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ud2v3Q4Kua6471Xw8NnfR&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.05770876232911238</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.5560150146484375</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0.37082989723775484</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-126.27349853515625</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">87</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1376285545</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;gX1YKimrqSDWWkCV-_1qw&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">382.7072670676489</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">462.4727408669212</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193.64852905273438</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59.681396484375</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1001189287</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">244</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">737013065</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;c-sDHz6DM5qniXMMLhQSk&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-75.53865883567141</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">353.23796913840556</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">338.89434814453125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36.583213806152344</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1887222153</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">193</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">874887273</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;TtXJNUBX&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18.28130271218015</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">431.24948952414775</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">164</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2063300359</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BeanDefinition\n保留原始值&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BeanDefinition\n保留原始值&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">45</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">72</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">682449255</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SQTyLy1H&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">36.4404213645239</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">256.17807839133525</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">123</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1082094121</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;最终的BD对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;最终的BD对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">103</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1776604711</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yo88GmqG&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-66.90941689231204</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">359.88298866965556</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">328</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1735748519</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BeanFactoryBeanPostProcessor&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BeanFactoryBeanPostProcessor&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">99</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">908148137</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b7llipli&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">439.80771567604734</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">248.19124672629619</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">80</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">115390953</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;创建对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;创建对象&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">71</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1051750663</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vuQK3UUY&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">459.5131447531958</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">355.42654488303447</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">238110855</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;使用&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;使用&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">907916393</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;7H8yZe1P&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">464.64612509987546</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">478.07417366721415</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">806296391</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;销毁&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;销毁&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">57</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1876658121</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;t0L2fvGEI8V6KiWA6SfHW&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-108.24526283957766</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">197.5063102028587</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">739.9559020996094</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">376.82445526123047</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">119357257</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">166</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1379776585</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PIri3X9gbn7dEn--Hwbu7&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">194.69129111550046</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">170.89242623069075</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.67605590820312</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">47.406063079833956</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">295730665</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">287</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">882672455</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mvEmCpLv&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hachure&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">210.5082161643286</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">182.40229103781965</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">129</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">533784969</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BeanFactory&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BeanFactory&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">79</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">478866121</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;n6rbcbHZAB7aQkdf9CfjY&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">198.0611946799536</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">267.6892249367454</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.43142700195312</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.20954132080078125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1576699561</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;elementId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ud2v3Q4Kua6471Xw8NnfR&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;focus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-0.018895955019474102</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.292938232421875</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">186.43142700195312</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.20954132080078125</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">87</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1549727975</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;TtQ6591yfLBC7ItDPc-KT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">199.3905403830786</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">457.3206488869407</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.67144775390625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6640625</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">551739751</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">101.67144775390625</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0.6640625</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;line&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">93</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1082269801</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;QUmsEGcDMMhBRRcDLa2g1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300.8614876487036</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">457.7439658425071</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.577392578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">189.51587677001953</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1486405961</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endBinding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;lastCommittedPoint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;startArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;endArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;points&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">0</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-number">0.577392578125</span><span class="hljs-punctuation">,</span><br><span class="hljs-number">-189.51587677001953</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">97</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">132595335</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rrLL8DZ3&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">280.25266196510984</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">329.88726113059306</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1622392521</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;反射&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;反射&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rectangle&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">91</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1415853607</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;QbCQtkHbR4NkYJ5tuccOc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-398.123268821023</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">287.35959694602275</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yellow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yellow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">176.85867309570312</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">47.67719268798828</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1183806569</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">97</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versionNonce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40558377</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UXKsBC8Q&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;roughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;opacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;angle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-383.808327414773</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">296.2812659523704</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;backgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;white&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">147</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;seed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">17860807</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;groupIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;strokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;boundElementIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;updated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1638980952087</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;fontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bean的定义信息&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;rawText&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bean的定义信息&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;baseline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;textAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;verticalAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;top&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;appState&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;light&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;viewBackgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#ffffff&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#000000&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemBackgroundColor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;transparent&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFillStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeWidth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeStyle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;solid&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemRoughness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemOpacity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFontFamily&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemFontSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemTextAlign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;center&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStrokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sharp&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemStartArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemEndArrowhead&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrow&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;currentItemLinearStrokeSharpness&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;round&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;gridSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>%%</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>《Spring源码深度解析》</category>
      
      <category>图示</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/f00739992f10.html"/>
    <url>/2022/12/f00739992f10.html</url>
    
    <content type="html"><![CDATA[<p>目标：过年前完成Flink的学习</p><h1 id="视频部分"><a href="#视频部分" class="headerlink" title="视频部分"></a>视频部分</h1><p>一共171个视频，每天完成5个&#x2F;每周完成25个&#x2F;每月完成100个，过年前完成。</p><ul><li><input checked="" disabled="" type="checkbox"> 002_第一章_Flink简介（一）_Flink起源和设计理念</li><li><input checked="" disabled="" type="checkbox"> 003_第一章_Flink简介（二）_Flink在企业的应用</li><li><input checked="" disabled="" type="checkbox"> 004_第一章_Flink简介（三）_Flink的优势</li><li><input checked="" disabled="" type="checkbox"> 005_第一章_Flink简介（四）_数据处理框架的演变</li><li><input checked="" disabled="" type="checkbox"> 006_第一章_Flink简介（五）_流处理的应用场景</li><li><input checked="" disabled="" type="checkbox"> 007_第一章_Flink简介（六）_Flink的分层API</li><li><input checked="" disabled="" type="checkbox"> 008_第一章_Flink简介（七）_Flink和Spark的区别</li><li><input checked="" disabled="" type="checkbox"> 009_第二章_Flink快速上手（一）_环境准备和创建项目</li><li><input checked="" disabled="" type="checkbox"> 010_第二章_Flink快速上手（二）_批处理_Word Count（一）</li><li><input checked="" disabled="" type="checkbox"> 011_第二章_Flink快速上手（二）_批处理_Word Count（二）</li><li><input checked="" disabled="" type="checkbox"> 012_第二章_Flink快速上手（三）_流处理（一）_有界流处理Word Count（一）</li><li><input checked="" disabled="" type="checkbox"> 013_第二章_Flink快速上手（三）_流处理（一）_有界流处理Word Count（二）</li><li><input checked="" disabled="" type="checkbox"> 014_第二章_Flink快速上手（三）_流处理（二）无界流处理Word Count</li><li><input checked="" disabled="" type="checkbox"> 015_第三章_Flink部署（一）_快速启动一个集群（一）_环境配置和基本介绍</li><li><input checked="" disabled="" type="checkbox"> 016_第三章_Flink部署（一）_快速启动一个集群（二）_集群启动</li><li><input checked="" disabled="" type="checkbox"> 017_第三章_Flink部署（一）_快速启动一个集群（三）_提交作业（一）_Web UI提交</li><li><input checked="" disabled="" type="checkbox"> 018_第三章_Flink部署（一）_快速启动一个集群（三）_提交作业（二）_命令行提交</li><li><input checked="" disabled="" type="checkbox"> 019_第三章_Flink部署（二）_部署模式</li><li><input checked="" disabled="" type="checkbox"> 020_第三章_Flink部署（三）_独立模式的部署</li><li><input checked="" disabled="" type="checkbox"> 021_第三章_Flink部署（四）_Yarn模式的部署</li><li><input checked="" disabled="" type="checkbox"> 022_第四章_Flink运行时架构（一）_Flink系统架构</li><li><input checked="" disabled="" type="checkbox"> 023_第四章_Flink运行时架构（二）_作业提交流程</li><li><input checked="" disabled="" type="checkbox"> 024_第四章_Flink运行时架构（三）_一些重要概念（一）_数据流图</li><li><input checked="" disabled="" type="checkbox"> 025_第四章_Flink运行时架构（三）_一些重要概念（二）_并行度</li><li><input checked="" disabled="" type="checkbox"> 026_第四章_Flink运行时架构（三）_一些重要概念（三）_算子链</li><li><input checked="" disabled="" type="checkbox"> 027_第四章_Flink运行时架构（三）_一些重要概念（四）_执行图</li><li><input checked="" disabled="" type="checkbox"> 028_第四章_Flink运行时架构（三）_一些重要概念（五）_Task Slots</li><li><input checked="" disabled="" type="checkbox"> 029_第四章_Flink运行时架构（四）_Flink的任务调度</li></ul><p>[[5.DataStream API（1.7版本）]]</p><ul><li><p><input checked="" disabled="" type="checkbox"> 030_第五章_DataStream API（基础篇）（一）_整体介绍</p></li><li><p><input checked="" disabled="" type="checkbox"> 031_第五章_DataStream API（基础篇）（二）_执行环境</p></li><li><p><input checked="" disabled="" type="checkbox"> 032_第五章_DataStream API（基础篇）（三）_源算子（一）_整体介绍</p></li><li><p><input checked="" disabled="" type="checkbox"> 033_第五章_DataStream API（基础篇）（三）_源算子（二）_准备工作</p></li><li><p><input checked="" disabled="" type="checkbox"> 034_第五章_DataStream API（基础篇）（三）_源算子（三）_读取有界流</p></li><li><p><input checked="" disabled="" type="checkbox"> 035_第五章_DataStream API（基础篇）（三）_源算子（四）_读取Socket文本流</p></li><li><p><input checked="" disabled="" type="checkbox"> 036_第五章_DataStream API（基础篇）（三）_源算子（五）_读取Kafka</p></li><li><p><input checked="" disabled="" type="checkbox"> 037_第五章_DataStream API（基础篇）（三）_源算子（六）_自定义Source</p></li><li><p><input checked="" disabled="" type="checkbox"> 038_第五章_DataStream API（基础篇）（三）_源算子（七）_自定义并行Source</p></li><li><p><input checked="" disabled="" type="checkbox"> 039_第五章_DataStream API（基础篇）（三）_源算子（八）_Flink支持的数据类型（一）</p></li><li><p><input checked="" disabled="" type="checkbox"> 040_第五章_DataStream API（基础篇）（三）_源算子（八）_Flink支持的数据类型（二）</p></li><li><p><input checked="" disabled="" type="checkbox"> 041_第五章_DataStream API（基础篇）（四）_Transform（一）_Map</p></li><li><p><input checked="" disabled="" type="checkbox"> 042_第五章_DataStream API（基础篇）（四）_Transform（二）_Filter</p></li><li><p><input checked="" disabled="" type="checkbox"> 043_第五章_DataStream API（基础篇）（四）_Transform（三）_FlatMap</p></li><li><p><input checked="" disabled="" type="checkbox"> 044_第五章_DataStream API（基础篇）（四）_Transform（五）_KeyBy</p></li><li><p><input checked="" disabled="" type="checkbox"> 045_第五章_DataStream API（基础篇）（四）_Transform（六）_简单聚合</p></li><li><p><input checked="" disabled="" type="checkbox"> 046_第五章_DataStream API（基础篇）（四）_Transform（七）_归约聚合</p></li><li><p><input checked="" disabled="" type="checkbox"> 047_第五章_DataStream API（基础篇）（四）_Transform（八）_UDF（一）_函数类和匿名函数</p></li><li><p><input checked="" disabled="" type="checkbox"> 048_第五章_DataStream API（基础篇）（四）_Transform（八）_UDF（二）_富函数类</p></li><li><p><input checked="" disabled="" type="checkbox"> 049_第五章_DataStream API（基础篇）（四）_Transform（九）_物理分区（一）_随机和轮询分区</p></li><li><p><input checked="" disabled="" type="checkbox"> 050_第五章_DataStream API（基础篇）（四）_Transform（十）_物理分区（二）_Rescale</p></li><li><p><input checked="" disabled="" type="checkbox"> 051_第五章_DataStream API（基础篇）（四）_Transform（十）_物理分区（三）_广播、全局及自定义分区</p></li><li><p><input checked="" disabled="" type="checkbox"> 052_第五章_DataStream API（基础篇）（五）_Sink（一）_连接到外部系统</p></li><li><p><input checked="" disabled="" type="checkbox"> 053_第五章_DataStream API（基础篇）（五）_Sink（二）_输出到文件</p></li><li><p><input checked="" disabled="" type="checkbox"> 054_第五章_DataStream API（基础篇）（五）_Sink（三）_输出到Kafka</p></li><li><p><input checked="" disabled="" type="checkbox"> 055_第五章_DataStream API（基础篇）（五）_Sink（四）_输出到Redis</p></li><li><p><input checked="" disabled="" type="checkbox"> 056_第五章_DataStream API（基础篇）（五）_Sink（五）_输出到Elasticsearch</p></li><li><p><input checked="" disabled="" type="checkbox"> 057_第五章_DataStream API（基础篇）（五）_Sink（六）_输出到MySQL</p></li><li><p><input checked="" disabled="" type="checkbox"> 058_第五章_DataStream API（基础篇）（五）_Sink（七）_自定义Sink输出</p></li><li><p><input checked="" disabled="" type="checkbox"> 059_第六章_Flink 中的时间和窗口（一）_时间语义</p></li><li><p><input checked="" disabled="" type="checkbox"> 060_第六章_Flink 中的时间和窗口（二）_水位线（一）_水位线的概念</p></li><li><p><input checked="" disabled="" type="checkbox"> 061_第六章_Flink中的时间和窗口（二）_水位线（二）_水位线的原理和特性</p></li><li><p><input checked="" disabled="" type="checkbox"> 062_第六章_Flink中的时间和窗口（二）_水位线（三）_水位线在代码中的生成（一）</p></li><li><p><input checked="" disabled="" type="checkbox"> 063_第六章_Flink中的时间和窗口（二）_水位线（三）_水位线在代码中的生成（二）</p></li><li><p><input disabled="" type="checkbox"> 064_第六章_Flink中的时间和窗口（二）_水位线（四）_自定义水位线的生成</p></li><li><p><input disabled="" type="checkbox"> 065_第六章_Flink中的时间和窗口（二）_水位线（五）_水位线的传递</p></li><li><p><input disabled="" type="checkbox"> 066_第六章_Flink中的时间和窗口（三）_窗口（一）_窗口的基本概念</p></li><li><p><input disabled="" type="checkbox"> 067_第六章_Flink中的时间和窗口（三）_窗口（二）_窗口的分类</p></li><li><p><input disabled="" type="checkbox"> 068_第六章_Flink中的时间和窗口（三）_窗口（三）_窗口API概览</p></li><li><p><input disabled="" type="checkbox"> 069_第六章_Flink中的时间和窗口（三）_窗口（四）_窗口分配器</p></li><li><p><input disabled="" type="checkbox"> 070_第六章_Flink中的时间和窗口（三）_窗口（五）_窗口函数整体介绍</p></li><li><p><input disabled="" type="checkbox"> 071_第六章_Flink中的时间和窗口（三）_窗口（六）_窗口函数分类</p></li><li><p><input disabled="" type="checkbox"> 072_第六章_Flink中的时间和窗口（三）_窗口（七）_增量聚合函数（一）_ReduceFunction</p></li><li><p><input disabled="" type="checkbox"> 073_第六章_Flink中的时间和窗口（三）_窗口（七）_增量聚合函数（二）_AggregateFunction</p></li><li><p><input disabled="" type="checkbox"> 074_第六章_Flink中的时间和窗口（三）_窗口（七）_增量聚合函数（三）_应用实例</p></li><li><p><input disabled="" type="checkbox"> 075_第六章_Flink中的时间和窗口（三）_窗口（八）_全窗口函数</p></li><li><p><input disabled="" type="checkbox"> 076_第六章_Flink中的时间和窗口（三）_窗口（九）_两种窗口函数结合</p></li><li><p><input disabled="" type="checkbox"> 077_第六章_Flink中的时间和窗口（三）_窗口（十）_窗口函数综合应用实例</p></li><li><p><input disabled="" type="checkbox"> 078_第六章_Flink中的时间和窗口（三）_窗口（十一）_窗口其它API</p></li><li><p><input disabled="" type="checkbox"> 079_第六章_Flink中的时间和窗口（四）_处理迟到数据（一）_代码实现</p></li><li><p><input disabled="" type="checkbox"> 080_第六章_Flink中的时间和窗口（四）_处理迟到数据（二）_测试</p></li><li><p><input disabled="" type="checkbox"> 081_第七章_处理函数（一）_处理函数的概念和分类</p></li><li><p><input disabled="" type="checkbox"> 082_第七章_处理函数（二）_ProcessFunction</p></li><li><p><input disabled="" type="checkbox"> 083_第七章_处理函数（三）_KeyedProcessFunction（一）_处理时间定时器</p></li><li><p><input disabled="" type="checkbox"> 084_第七章_处理函数（三）_KeyedProcessFunction（二）_事件时间定时器</p></li><li><p><input disabled="" type="checkbox"> 085_第七章_处理函数（四）_ProcessWindowFunction</p></li><li><p><input disabled="" type="checkbox"> 086_第七章_处理函数（五）_Top N（一）_使用ProcessAllWindowFunction（一）_基本思路</p></li><li><p><input disabled="" type="checkbox"> 087_第七章_处理函数（五）_Top N（一）_使用ProcessAllWindowFunction（二）_代码实现和测试</p></li><li><p><input disabled="" type="checkbox"> 088_第七章_处理函数（五）_Top N（二）_使用KeyedProcessFunction</p></li><li><p><input disabled="" type="checkbox"> 089_第八章_多流转换（一）_分流</p></li><li><p><input disabled="" type="checkbox"> 090_第八章_多流转换（二）_合流（一）_ 联合（Union）</p></li><li><p><input disabled="" type="checkbox"> 091_第八章_多流转换（二）_合流（二）_ 连接（Connect）</p></li><li><p><input disabled="" type="checkbox"> 092_第八章_多流转换（二）_合流（三）_ 应用实例（一）_程序架构和实现思路</p></li><li><p><input disabled="" type="checkbox"> 093_第八章_多流转换（二）_合流（三）_ 应用实例（二）_具体代码实现</p></li><li><p><input disabled="" type="checkbox"> 094_第八章_多流转换（二）_合流（四）_ 广播连接流</p></li><li><p><input disabled="" type="checkbox"> 095_第八章_多流转换（三）_双流Join（一）_ 窗口联结</p></li><li><p><input disabled="" type="checkbox"> 096_第八章_多流转换（三）_双流Join（二）_ 间隔联结</p></li><li><p><input disabled="" type="checkbox"> 097_第八章_多流转换（三）_双流Join（三）_ 窗口同组联结</p></li><li><p><input disabled="" type="checkbox"> 098_第九章_状态编程（一）_Flink中的状态（一）_ 状态的定义</p></li><li><p><input disabled="" type="checkbox"> 099_第九章_状态编程（一）_Flink中的状态（二）_ 状态的管理</p></li><li><p><input disabled="" type="checkbox"> 100_第九章_状态编程（一）_Flink中的状态（三）_ 状态的分类</p></li><li><p><input disabled="" type="checkbox"> 101_第九章_状态编程（二）_按键分区状态（一）_ 基本概念和类型</p></li><li><p><input disabled="" type="checkbox"> 102_第九章_状态编程（二）_按键分区状态（二）_ 代码中的使用（一）_基本方式和值状态</p></li><li><p><input disabled="" type="checkbox"> 103_第九章_状态编程（二）_按键分区状态（二）_ 代码中的使用（二）_其它状态</p></li><li><p><input disabled="" type="checkbox"> 104_第九章_状态编程（二）_按键分区状态（三）_ 应用实例（一）_值状态</p></li><li><p><input disabled="" type="checkbox"> 105_第九章_状态编程（二）_按键分区状态（三）_ 应用实例（二）_列表状态</p></li><li><p><input disabled="" type="checkbox"> 106_第九章_状态编程（二）_按键分区状态（三）_ 应用实例（三）_映射状态</p></li><li><p><input disabled="" type="checkbox"> 107_第九章_状态编程（二）_按键分区状态（三）_ 应用实例（四）_聚合状态</p></li><li><p><input disabled="" type="checkbox"> 108_第九章_状态编程（二）_按键分区状态（四）_ 状态生存时间</p></li><li><p><input disabled="" type="checkbox"> 109_第九章_状态编程（三）_算子状态（一）_ 基本概念和类型</p></li><li><p><input disabled="" type="checkbox"> 110_第九章_状态编程（三）_算子状态（二）_应用实例（一）_基本思路和框架</p></li><li><p><input disabled="" type="checkbox"> 111_第九章_状态编程（三）_算子状态（二）_应用实例（二）_具体实现和测试</p></li><li><p><input disabled="" type="checkbox"> 112_第九章_状态编程（四）_广播状态（一）_基本概念和用法</p></li><li><p><input disabled="" type="checkbox"> 113_第九章_状态编程（四）_广播状态（二）_应用实例</p></li><li><p><input disabled="" type="checkbox"> 114_第九章_状态编程（五）_状态持久化（一）_检查点</p></li><li><p><input disabled="" type="checkbox"> 115_第九章_状态编程（五）_状态持久化（二）_状态后端</p></li><li><p><input disabled="" type="checkbox"> 116_第十章_容错机制（一）_检查点（一）_检查点的保存原理（一）_周期性的保存</p></li><li><p><input disabled="" type="checkbox"> 117_第十章_容错机制（一）_检查点（一）_检查点的保存原理（二）_保存的时间点</p></li><li><p><input disabled="" type="checkbox"> 118_第十章_容错机制（一）_检查点（二）_从检查点恢复状态</p></li><li><p><input disabled="" type="checkbox"> 119_第十章_容错机制（一）_检查点（三）_检查点算法（一）_分界线</p></li><li><p><input disabled="" type="checkbox"> 120_第十章_容错机制（一）_检查点（三）_检查点算法（二）_分布式快照算法</p></li><li><p><input disabled="" type="checkbox"> 121_第十章_容错机制（一）_检查点（四）_检查点配置</p></li><li><p><input disabled="" type="checkbox"> 122_第十章_容错机制（一）_检查点（五）_保存点</p></li><li><p><input disabled="" type="checkbox"> 123_第十章_容错机制（二）_状态一致性（一）_一致性的概念和级别</p></li><li><p><input disabled="" type="checkbox"> 124_第十章_容错机制（二）_状态一致性（二）_端到端状态一致性（一）</p></li><li><p><input disabled="" type="checkbox"> 125_第十章_容错机制（二）_状态一致性（二）_端到端状态一致性（二）</p></li><li><p><input disabled="" type="checkbox"> 126_第十章_容错机制（二）_状态一致性（三）_端到端精确一次</p></li><li><p><input disabled="" type="checkbox"> 127_第十一章_Table API和SQL（一）_整体介绍</p></li><li><p><input disabled="" type="checkbox"> 128_第十一章_Table API和SQL（二）_快速上手</p></li><li><p><input disabled="" type="checkbox"> 129_第十一章_Table API和SQL（三）_基本API（一）_程序架构</p></li><li><p><input disabled="" type="checkbox"> 130_第十一章_Table API和SQL（三）_基本API（二）_表环境</p></li><li><p><input disabled="" type="checkbox"> 131_第十一章_Table API和SQL（三）_基本API（三）_创建表</p></li><li><p><input disabled="" type="checkbox"> 132_第十一章_Table API和SQL（三）_基本API（四）_表的查询和输出（一）</p></li><li><p><input disabled="" type="checkbox"> 133_第十一章_Table API和SQL（三）_基本API（四）_表的查询和输出（二）</p></li><li><p><input disabled="" type="checkbox"> 134_第十一章_Table API和SQL（三）_基本API（五）_表和流的转换（一）_表转换成流</p></li><li><p><input disabled="" type="checkbox"> 135_第十一章_Table API和SQL（三）_基本API（五）_表和流的转换（二）_流转换成表</p></li><li><p><input disabled="" type="checkbox"> 136_第十一章_Table API和SQL（四）_流处理中的表（一）_动态表和持续查询</p></li><li><p><input disabled="" type="checkbox"> 137_第十一章_Table API和SQL（四）_流处理中的表（二）_流转换成动态表做动态查询</p></li><li><p><input disabled="" type="checkbox"> 138_第十一章_Table API和SQL（四）_流处理中的表（三）_动态表编码成数据流</p></li><li><p><input disabled="" type="checkbox"> 139_第十一章_Table API和SQL（五）_时间属性和窗口（一）_时间属性（一）_在DDL中定义</p></li><li><p><input disabled="" type="checkbox"> 140_第十一章_Table API和SQL（五）_时间属性和窗口（一）_时间属性（二）_流转换成表时定义</p></li><li><p><input disabled="" type="checkbox"> 141_第十一章_Table API和SQL（五）_时间属性和窗口（二）_窗口</p></li><li><p><input disabled="" type="checkbox"> 142_第十一章_Table API和SQL（六）_聚合查询（一）_分组聚合</p></li><li><p><input disabled="" type="checkbox"> 143_第十一章_Table API和SQL（六）_聚合查询（二）_窗口聚合</p></li><li><p><input disabled="" type="checkbox"> 144_第十一章_Table API和SQL（六）_聚合查询（三）_开窗聚合</p></li><li><p><input disabled="" type="checkbox"> 145_第十一章_Table API和SQL（六）_聚合查询（四）_TopN（一）_普通TopN</p></li><li><p><input disabled="" type="checkbox"> 146_第十一章_Table API和SQL（六）_聚合查询（四）_TopN（二）_窗口TopN</p></li><li><p><input disabled="" type="checkbox"> 147_第十一章_Table API和SQL（七）_联结查询</p></li><li><p><input disabled="" type="checkbox"> 148_第十一章_Table API和SQL（八）_函数（一）_系统函数</p></li><li><p><input disabled="" type="checkbox"> 149_第十一章_Table API和SQL（八）_函数（二）_UDF（一）_整体介绍和分类</p></li><li><p><input disabled="" type="checkbox"> 150_第十一章_Table API和SQL（八）_函数（二）_UDF（二）_标量函数</p></li><li><p><input disabled="" type="checkbox"> 151_第十一章_Table API和SQL（八）_函数（二）_UDF（三）_表函数</p></li><li><p><input disabled="" type="checkbox"> 152_第十一章_Table API和SQL（八）_函数（二）_UDF（四）_聚合函数</p></li><li><p><input disabled="" type="checkbox"> 153_第十一章_Table API和SQL（八）_函数（二）_UDF（五）_表聚合函数</p></li><li><p><input disabled="" type="checkbox"> 154_第十一章_Table API和SQL（九）_SQL客户端</p></li><li><p><input disabled="" type="checkbox"> 155_第十一章_Table API和SQL（十）_连接到外部系统（一）_常见的外部存储</p></li><li><p><input disabled="" type="checkbox"> 156_第十一章_Table API和SQL（十）_连接到外部系统（二）_Hive</p></li><li><p><input disabled="" type="checkbox"> 157_第十二章_Flink CEP（一）_基本概念和应用</p></li><li><p><input disabled="" type="checkbox"> 158_第十二章_Flink CEP（二）_快速上手（一）_需求分析和定义模式</p></li><li><p><input disabled="" type="checkbox"> 159_第十二章_Flink CEP（二）_快速上手（二）_检测处理代码实现和测试</p></li><li><p><input disabled="" type="checkbox"> 160_第十二章_Flink CEP（三）_模式API（一）_个体模式（一）_量词</p></li><li><p><input disabled="" type="checkbox"> 161_第十二章_Flink CEP（三）_模式API（一）_个体模式（二）_条件</p></li><li><p><input disabled="" type="checkbox"> 162_第十二章_Flink CEP（三）_模式API（二）_组合模式</p></li><li><p><input disabled="" type="checkbox"> 163_第十二章_Flink CEP（三）_模式API（三）_模式组</p></li><li><p><input disabled="" type="checkbox"> 164_第十二章_Flink CEP（三）_模式API（四）_匹配后跳过策略</p></li><li><p><input disabled="" type="checkbox"> 165_第十二章_Flink CEP（四）_模式的检测处理（一）_处理匹配事件</p></li><li><p><input disabled="" type="checkbox"> 166_第十二章_Flink CEP（四）_模式的检测处理（二）_处理超时事件（一）_需求分析和准备工作</p></li><li><p><input disabled="" type="checkbox"> 167_第十二章_Flink CEP（四）_模式的检测处理（二）_处理超时事件（二）_代码实现和测试</p></li><li><p><input disabled="" type="checkbox"> 168_第十二章_Flink CEP（四）_模式的检测处理（三）_处理迟到数据</p></li><li><p><input disabled="" type="checkbox"> 169_第十二章_Flink CEP（五）_CEP状态机实现（一）_思路分析和程序框架</p></li><li><p><input disabled="" type="checkbox"> 170_第十二章_Flink CEP（五）_CEP状态机实现（二）_定义状态机</p></li><li><p><input disabled="" type="checkbox"> 171_第十二章_Flink CEP（五）_CEP状态机实现（三）_实现处理逻辑及测试</p></li></ul><h1 id="项目部分"><a href="#项目部分" class="headerlink" title="项目部分"></a>项目部分</h1><p>并行完成项目部分学习。</p>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>大数据</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/94d4277a997a.html"/>
    <url>/2022/12/94d4277a997a.html</url>
    
    <content type="html"><![CDATA[<h1 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h1><p>一共有5个文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# ll<br>total 24<br>-rw-r--r-- 1 coachhe users 2442 Oct 31 00:44 flink-configuration-configmap.yaml<br>-rw-r--r-- 1 coachhe users  225 Oct 31 00:36 jobmanager-rest-service.yaml<br>-rw-r--r-- 1 coachhe users  247 Oct 31 00:44 jobmanager-service.yaml<br>-rw-r--r-- 1 coachhe users 1165 Oct 31 00:41 jobmanager-session-deployment.yaml<br>-rw-r--r-- 1 coachhe users  241 Oct 31 00:40 taskmanager-query-state-service.yaml<br>-rw-r--r-- 1 coachhe users 1119 Oct 31 00:38 taskmanager-session-deployment.yaml<br></code></pre></td></tr></table></figure><p>现在我们来一个个看。</p><h2 id="configmap"><a href="#configmap" class="headerlink" title="configmap"></a>configmap</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul><li>用于存储<code>flink-conf.yaml</code>，<code>log4j-console.properties</code>等配置信息。</li><li>Flink JobManager和TaskManager启动时会自动获取配置</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># flink-configuration-configmap.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">flink-conf.yaml:</span> <span class="hljs-string">|+</span><br><span class="hljs-string">    jobmanager.rpc.address: flink-jobmanager</span><br><span class="hljs-string">    taskmanager.numberOfTaskSlots: 2</span><br><span class="hljs-string">    blob.server.port: 6124</span><br><span class="hljs-string">    jobmanager.rpc.port: 6123</span><br><span class="hljs-string">    taskmanager.rpc.port: 6122</span><br><span class="hljs-string">    queryable-state.proxy.ports: 6125</span><br><span class="hljs-string">    jobmanager.memory.process.size: 1600m</span><br><span class="hljs-string">    taskmanager.memory.process.size: 1728m</span><br><span class="hljs-string">    parallelism.default: 2</span><br><span class="hljs-string"></span>  <span class="hljs-attr">log4j-console.properties:</span> <span class="hljs-string">|+</span><br><span class="hljs-string">    # This affects logging for both user code and Flink</span><br><span class="hljs-string">    rootLogger.level = INFO</span><br><span class="hljs-string">    rootLogger.appenderRef.console.ref = ConsoleAppender</span><br><span class="hljs-string">    rootLogger.appenderRef.rolling.ref = RollingFileAppender</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    # Uncomment this if you want to _only_ change Flink&#x27;s logging</span><br><span class="hljs-string">    #logger.flink.name = org.apache.flink</span><br><span class="hljs-string">    #logger.flink.level = INFO</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    # The following lines keep the log level of common libraries/connectors on</span><br><span class="hljs-string">    # log level INFO. The root logger does not override this. You have to manually</span><br><span class="hljs-string">    # change the log levels here.</span><br><span class="hljs-string">    logger.akka.name = akka</span><br><span class="hljs-string">    logger.akka.level = INFO</span><br><span class="hljs-string">    logger.kafka.name= org.apache.kafka</span><br><span class="hljs-string">    logger.kafka.level = INFO</span><br><span class="hljs-string">    logger.hadoop.name = org.apache.hadoop</span><br><span class="hljs-string">    logger.hadoop.level = INFO</span><br><span class="hljs-string">    logger.zookeeper.name = org.apache.zookeeper</span><br><span class="hljs-string">    logger.zookeeper.level = INFO</span><br><span class="hljs-string"></span>    <br>    <span class="hljs-comment"># Log all infos to the console</span><br>    <span class="hljs-string">appender.console.name</span> <span class="hljs-string">=</span> <span class="hljs-string">ConsoleAppender</span><br>    <span class="hljs-string">appender.console.type</span> <span class="hljs-string">=</span> <span class="hljs-string">CONSOLE</span><br>    <span class="hljs-string">appender.console.layout.type</span> <span class="hljs-string">=</span> <span class="hljs-string">PatternLayout</span><br>    <span class="hljs-string">appender.console.layout.pattern</span> <span class="hljs-string">=</span> <span class="hljs-string">%d&#123;yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss,SSS&#125;</span> <span class="hljs-string">%-5p</span> <span class="hljs-string">%-60c</span> <span class="hljs-string">%x</span> <span class="hljs-bullet">-</span> <span class="hljs-string">%m%n</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Log all infos in the given rolling file</span><br>    <span class="hljs-string">appender.rolling.name</span> <span class="hljs-string">=</span> <span class="hljs-string">RollingFileAppender</span><br>    <span class="hljs-string">appender.rolling.type</span> <span class="hljs-string">=</span> <span class="hljs-string">RollingFile</span><br>    <span class="hljs-string">appender.rolling.append</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span><br>    <span class="hljs-string">appender.rolling.fileName</span> <span class="hljs-string">=</span> <span class="hljs-string">$&#123;sys:log.file&#125;</span><br>    <span class="hljs-string">appender.rolling.filePattern</span> <span class="hljs-string">=</span> <span class="hljs-string">$&#123;sys:log.file&#125;.%i</span><br>    <span class="hljs-string">appender.rolling.layout.type</span> <span class="hljs-string">=</span> <span class="hljs-string">PatternLayout</span><br>    <span class="hljs-string">appender.rolling.layout.pattern</span> <span class="hljs-string">=</span> <span class="hljs-string">%d&#123;yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss,SSS&#125;</span> <span class="hljs-string">%-5p</span> <span class="hljs-string">%-60c</span> <span class="hljs-string">%x</span> <span class="hljs-bullet">-</span> <span class="hljs-string">%m%n</span><br>    <span class="hljs-string">appender.rolling.policies.type</span> <span class="hljs-string">=</span> <span class="hljs-string">Policies</span><br>    <span class="hljs-string">appender.rolling.policies.size.type</span> <span class="hljs-string">=</span> <span class="hljs-string">SizeBasedTriggeringPolicy</span><br>    <span class="hljs-string">appender.rolling.policies.size.size=100MB</span><br>    <span class="hljs-string">appender.rolling.strategy.type</span> <span class="hljs-string">=</span> <span class="hljs-string">DefaultRolloverStrategy</span><br>    <span class="hljs-string">appender.rolling.strategy.max</span> <span class="hljs-string">=</span> <span class="hljs-number">10</span><br>    <br>    <span class="hljs-comment"># Suppress the irrelevant (wrong) warnings from the Netty channel handler</span><br>    <span class="hljs-string">logger.netty.name</span> <span class="hljs-string">=</span> <span class="hljs-string">org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline</span><br>    <span class="hljs-string">logger.netty.level</span> <span class="hljs-string">=</span> <span class="hljs-string">OFF%</span><br></code></pre></td></tr></table></figure><p>可以看到，这里就是通过data属性定义了两个配置信息flink-conf.yaml和log4j-console.properties，在这里值得注意的是，因为deployment使用configmap之后，是会将对应内容转换成文件挂载在对应的目录下，和我们的需求整好是符合的，我们需要将这两个配置信息转换为文件进行存储和使用。</p><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><h3 id="功能-1"><a href="#功能-1" class="headerlink" title="功能"></a>功能</h3><p>通过 <code>Service Name</code> 和 <code>Port</code> 暴露 <code>JobManager</code> 服务，让 <code>TaskManager</code> 能够连接到 <code>JobManager</code> 。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># jobmanager-service.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6123</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">blob-server</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6124</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">webui</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>    <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br></code></pre></td></tr></table></figure><p>可以看到，这是个ClusterIP类型的Service，作用是将6123、6124、8081三个端口对外暴露并且实现负载均衡。</p><h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><h3 id="1-jobmanager-session-deployment-yaml"><a href="#1-jobmanager-session-deployment-yaml" class="headerlink" title="1. jobmanager-session-deployment.yaml"></a>1. jobmanager-session-deployment.yaml</h3><h4 id="功能-2"><a href="#功能-2" class="headerlink" title="功能"></a>功能</h4><p>定义 <code>JobManager Pod</code> 副本数量，版本等，保证在Pods中至少有一个副本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>      <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>        <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">jobmanager</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">flink:1.13-scala_2.12</span><br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;jobmanager&quot;</span>]<br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6123</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6124</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">blob-server</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8081</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">webui</span><br>        <span class="hljs-attr">livenessProbe:</span><br>          <span class="hljs-attr">tcpSocket:</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">6123</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span><br>          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">60</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/conf</span><br>        <span class="hljs-attr">securityContext:</span><br>          <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">9999</span>  <span class="hljs-comment"># refers to user _flink_ from official flink image, change if necessary</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>        <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config</span><br>          <span class="hljs-attr">items:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">flink-conf.yaml</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">flink-conf.yaml</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">log4j-console.properties</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">log4j-console.properties</span><br></code></pre></td></tr></table></figure><p>针对上面的字段我们展开分析：</p><h4 id="apiVersion"><a href="#apiVersion" class="headerlink" title="apiVersion"></a>apiVersion</h4><p>版本号，这个没什么好说的。</p><h4 id="kind"><a href="#kind" class="headerlink" title="kind"></a>kind</h4><p>Api类型，表明这是一个Deployment</p><h4 id="metadata"><a href="#metadata" class="headerlink" title="metadata"></a>metadata</h4><p>元数据，表明该deployment的名字为 <code>flink-jobmanager</code> ，一般还会有一个label字段，</p><h4 id="spec-specification"><a href="#spec-specification" class="headerlink" title="spec(specification)"></a>spec(specification)</h4><p>表明部署所需行为的<strong>规范</strong></p><h5 id="replicas"><a href="#replicas" class="headerlink" title="replicas"></a>replicas</h5><p>副本数量，这就是指定的 <code>Kubernetes</code> 集群里须要运行多少个 <code>Pod</code> 实例。当Pod异常退出或者挂掉的时候可以自动重启。</p><h5 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h5><p>它的作用是“筛选”出要被 <code>Deployment</code> 管理的 <code>Pod</code> 对象，下属字段“matchLabels”定义了 Pod 对象应该携带的 label，它必须和“template”里 Pod 定义的“labels”完全相同，否则 <code>Deployment</code> 就会找不到要控制的 <code>Pod</code> 对象，apiserver 也会告诉你 YAML 格式校验错误无法创建。</p><p><code>selector</code> 和  <code>template</code> 里都需要写一遍 <code>Pod</code> 的原因:<br><code>Deployment</code> 和 <code>Pod</code> 实际上是一种松散的组合关系，<code>Deployment</code> 实际上并不“持有” <code>Pod</code> 对象，它只是帮助 <code>Pod</code> 对象能够有足够的副本数量运行，仅此而已。如果像 <code>Job</code> 那样，把 <code>Pod</code> 在模板里“写死”，那么其他的对象再想要去管理这些 <code>Pod</code> 就无能为力了。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221116235751.png" width = "50%" /><p>可以看到，通过 <code>selector</code> 的 <code>label</code> 中的 <code>app</code> 标签，选中了 <code>template</code> 中的 <code>ngx-dep</code> 这个 <code>Pod</code> ，在我们这里就是选中了 <code>jobmanager</code> 这个 <code>Pod</code> 。如下图：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221117004230.png" width = "30%" /><p>所以这里就是创建了一个名为 <code>flink-jobmanager</code> 的 <code>Deployment</code> ，维持 <code>Pod</code> 的数量为1个，通过 <code>selector</code> 选择了 <code>template</code> 中 <code>component</code> 为 <code>jobmanager</code> 的 <code>Pod</code> ，<code>Pod</code> 中选择的 <code>image</code> 版本是 <code>flink:1.13-scala_2.12</code>，<code>args</code> 是 <code>jobmanager</code>，也就是通过参数来启动了 <code>flink</code> 中的 <code>JobManager</code> 。并且对外打开了几个端口，将 <code>ConfigMap</code> 中定义的两个配置文件挂载在了 <code>/opt/flink/conf</code> 目录下，作为 <code>flink</code> 的参数</p><h3 id="2-taskmanager-session-deployment-yaml"><a href="#2-taskmanager-session-deployment-yaml" class="headerlink" title="2. taskmanager-session-deployment.yaml"></a>2. taskmanager-session-deployment.yaml</h3><p>定义了 <code>TaskManager Pod</code> 副本数目，版本等，保证在 <code>Pods</code> 中至少有两个副本。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-taskmanager</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>      <span class="hljs-attr">component:</span> <span class="hljs-string">taskmanager</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>        <span class="hljs-attr">component:</span> <span class="hljs-string">taskmanager</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">taskmanager</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">flink:1.13-scala_2.12</span><br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;taskmanager&quot;</span>]<br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6122</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6125</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">query-state</span><br>        <span class="hljs-attr">livenessProbe:</span><br>          <span class="hljs-attr">tcpSocket:</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">6122</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span><br>          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">60</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/conf/</span><br>        <span class="hljs-attr">securityContext:</span><br>          <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">9999</span>  <span class="hljs-comment"># refers to user _flink_ from official flink image, change if necessary</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>        <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config</span><br>          <span class="hljs-attr">items:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">flink-conf.yaml</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">flink-conf.yaml</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">log4j-console.properties</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">log4j-console.properties</span><br></code></pre></td></tr></table></figure><p>这里其实和 <code>JobManager</code> 几乎完全相同，不同之处首先有 <code>replicas</code> 为2， 也就是副本有两个，还有就是启动参数为 <code>taskmanager</code>，也就是通过指定参数启动了一个 <code>TaskManager</code>， 这样一个有JobManager和TaskManager的集群就启动了。</p><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建configmap</span><br>[coachhe@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# kubectl apply -f flink-configuration-configmap.yaml <br>configmap/flink-config created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建service</span><br>[coachhe@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# kubectl apply -f jobmanager-service.yaml <br>service/flink-jobmanager created<br>[coachhe@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# kubectl apply -f jobmanager-rest-service.yaml<br>service/flink-jobmanager-rest created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建jobmanager deployment</span><br>[coachhe@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# kubectl apply -f jobmanager-session-deployment.yaml <br>deployment.apps/flink-jobmanager created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建taskmanager deployment</span><br>[coachhe@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# kubectl apply -f taskmanager-session-deployment.yaml <br>deployment.apps/flink-taskmanager created<br></code></pre></td></tr></table></figure><p>然后就可以正常访问页面了：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20221117005919.png" width = "80%" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>极客时间</category>
      
      <category>flink on k8s配置说明</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/828dc358309c.html"/>
    <url>/2022/12/828dc358309c.html</url>
    
    <content type="html"><![CDATA[<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><h2 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h2><p>和 <code>Session Mode</code> 的 <code>configmap</code> 完全相同。这里就不赘述了</p><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><h3 id="rest-service"><a href="#rest-service" class="headerlink" title="rest service"></a>rest service</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># jobmanager-rest-service.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager-rest-per-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rest</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8081</span><br>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30086</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>    <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br></code></pre></td></tr></table></figure><p>这里可以看到，和 <code>Session Mode</code> 的 <code>rest-service</code> 完全相同，目的是为了将 <code>rest</code> 服务的端口向外暴露，让外部可以通过访问 <code>30086</code> 端口来访问 <code>flink</code> 的 <code>rest</code> 服务。</p><h3 id="jobmanager-service"><a href="#jobmanager-service" class="headerlink" title="jobmanager service"></a>jobmanager service</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># jobmanager-service.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager-per-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6123</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">blob-server</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6124</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">webui</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>    <span class="hljs-attr">component:</span> <span class="hljs-string">flink-jobmanager-per-job</span><br></code></pre></td></tr></table></figure><p>可以看到，和 <code>Session Mode</code> 的也完全相同。</p><h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><h3 id="job-manager-deployment"><a href="#job-manager-deployment" class="headerlink" title="job manager deployment"></a>job manager deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># jobmanager-job-deployment.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager-per-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>        <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">jobmanager</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">flink:1.11.1-scala_2.11</span><br>          <span class="hljs-attr">env:</span><br>          <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;standalone-job&quot;</span>, <span class="hljs-string">&quot;--job-classname&quot;</span>, <span class="hljs-string">&quot;org.apache.flink.streaming.examples.windowing.TopSpeedWindowing&quot;</span>, <span class="hljs-string">--allowNonRestoredState</span>, <span class="hljs-string">--output</span> <span class="hljs-string">hdfs://node02:8020/flink-training/wordcount-output</span>] <br>          <span class="hljs-comment"># optional arguments: [&quot;--job-id&quot;, &quot;&lt;job id&gt;&quot;, &quot;--fromSavepoint&quot;, &quot;/path/to/savepoint&quot;, &quot;--allowNonRestoredState&quot;]</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6123</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6124</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">blob-server</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8081</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">webui</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">tcpSocket:</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">6123</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">60</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/conf</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">job-artifacts-volume</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/usrlib/</span><br>          <span class="hljs-attr">securityContext:</span><br>            <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">9999</span>  <span class="hljs-comment"># refers to user _flink_ from official flink image, change if necessary</span><br>      <span class="hljs-attr">volumes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>          <span class="hljs-attr">configMap:</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-per-job</span><br>            <span class="hljs-attr">items:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">flink-conf.yaml</span><br>                <span class="hljs-attr">path:</span> <span class="hljs-string">flink-conf.yaml</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">log4j-console.properties</span><br>                <span class="hljs-attr">path:</span> <span class="hljs-string">log4j-console.properties</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">job-artifacts-volume</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/home/flink-training/flink-1.11.1/examples/streaming/</span><br></code></pre></td></tr></table></figure><p>在这里附上和 <code>Session Mode</code> 的比较结果：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221120235431.png"></p><p>可以看到，最主要的区别首先是 <code>Kind</code> ，<code>Session Mode</code> 的类型是 <code>Deployment</code> ，这是一个常驻进程，会一直保证有一个 <code>Pod</code> 的存在，而 <code>Perjob Mode</code> 的类型是 <code>Job</code> ，这是一个只生成一次的任务，每次调用生成一个镜像。</p><h3 id="task-manager-deployment"><a href="#task-manager-deployment" class="headerlink" title="task manager deployment"></a>task manager deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># taskmanager-job-deployment.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-taskmanager-per-job</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>      <span class="hljs-attr">component:</span> <span class="hljs-string">taskmanager</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>        <span class="hljs-attr">component:</span> <span class="hljs-string">taskmanager</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">taskmanager</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">flink:1.11.1-scala_2.11</span> <span class="hljs-comment">#镜像可以自定义镜像</span><br>        <span class="hljs-attr">env:</span><br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;taskmanager&quot;</span>] <span class="hljs-comment"># 指定TaskManager类型实例</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6122</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6125</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">query-state</span><br>        <span class="hljs-attr">livenessProbe:</span><br>          <span class="hljs-attr">tcpSocket:</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">6122</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span><br>          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">60</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span> <span class="hljs-comment">#flink configuration 路径挂载</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/conf/</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">job-artifacts-volume</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/usrlib</span><br>        <span class="hljs-attr">securityContext:</span><br>          <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">9999</span>  <span class="hljs-comment"># refers to user _flink_ from official flink image, change if necessary</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span> <span class="hljs-comment"># 从configmap中获取</span><br>        <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-per-job</span><br>          <span class="hljs-attr">items:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">flink-conf.yaml</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">flink-conf.yaml</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">log4j-console.properties</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">log4j-console.properties</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">job-artifacts-volume</span> <span class="hljs-comment"># 指定宿主机路径</span><br>        <span class="hljs-attr">hostPath:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">/home/flink-training/flink-1.11.1/examples/streaming/</span><br></code></pre></td></tr></table></figure><p>这里附带上和 <code>Session Mode</code> 的比较：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221121004245.png"></p><p>可以看到，这里和 <code>Session Mode</code> 几乎是完全相同的。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>实时计算</category>
      
      <category>Flink</category>
      
      <category>极客时间</category>
      
      <category>flink on k8s配置说明</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a7de7996f5af.html"/>
    <url>/2022/12/a7de7996f5af.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-Spring"><a href="#1-Spring" class="headerlink" title="1. Spring"></a>1. Spring</h1><h2 id="1-1-优点"><a href="#1-1-优点" class="headerlink" title="1.1 优点"></a>1.1 优点</h2><ul><li>Spring是一个开源的免费的框架（容器）！</li><li>Spring是一个轻量级的、非入侵式的框架！</li><li>控制反转（IOC），面向切面编程（AOP）</li><li>支持事务的处理，对框架整合的支持！</li></ul><p>&#x3D;&#x3D;总结一句话：Spring就是一个轻量级的控制反转（IOC）和面向切面编程（AOP）的框架！&#x3D;&#x3D;</p><h1 id="2-IOC理论推导"><a href="#2-IOC理论推导" class="headerlink" title="2. IOC理论推导"></a>2. IOC理论推导</h1><h2 id="之前的实现方式"><a href="#之前的实现方式" class="headerlink" title="之前的实现方式"></a>之前的实现方式</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210708000602515.png" alt="image-20210708000602515"></p><p>为了方便把多个代码放在一起：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// MyTest.java</span><br><span class="hljs-keyword">import</span> com.coachhe.spring.service.impl.UserServiceImpl;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">// 用户实际调用的是业务层，DAO层他们不需要调用</span><br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        userService.getUser();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// UserDao.java</span><br><span class="hljs-keyword">package</span> com.coachhe.spring.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// UserDaoImpl.java</span><br><span class="hljs-keyword">package</span> com.coachhe.spring.dao.impl;<br><br><span class="hljs-keyword">import</span> com.coachhe.spring.dao.UserDao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;获取默认用户的数据&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// UserService.java</span><br><span class="hljs-keyword">package</span> com.coachhe.spring.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">// UserServiceImpl.java</span><br><span class="hljs-keyword">package</span> com.coachhe.spring.service.impl;<br><br><span class="hljs-keyword">import</span> com.coachhe.spring.dao.UserDao;<br><span class="hljs-keyword">import</span> com.coachhe.spring.dao.impl.UserDaoImpl;<br><span class="hljs-keyword">import</span> com.coachhe.spring.service.UserService;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">UserDao</span> <span class="hljs-variable">userDao</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDaoImpl</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        userDao.getUser();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>在这里，UserDaoImpl是UserDao的实现类，实现的功能是获取默认用户的数据。</p><p>UserServiceImpl是UserService的实现类，实现的功能是调用UserDaoImpl，获取默认用户的数据（查）。</p><p>运行结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210708001602430.png" alt="image-20210708001602430" style="zoom:50%;" /><p>现在新增一种Dao实现类</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210708001958090.png" alt="image-20210708001958090" style="zoom:50%;" /><p>新增一种通过mysql获取用户数据的实现类之后，用户希望通过myslq方式来获取数据，那么我们需要改动Service方法，也就是说，通过改变源代码来实现，这显然是一种糟糕的方式。</p><h2 id="改变"><a href="#改变" class="headerlink" title="改变"></a>改变</h2><p>因此，我们在UserServiceImpl中加入了set方法：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210708002257119.png" alt="image-20210708002257119"></p><p>加入set方法之后，我们就可以直接让用户来选择需要的获取数据方式，而不是通过源代码来实现。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210708002438027.png" alt="image-20210708002438027" style="zoom:50%;" /><p>注意，这里是用户界面，利用set动态实现值的注入。</p><p>用户可以直接选择需要的获取数据方式，而不是需要我们被动去更改源代码。</p><h1 id="3-Hello-Spring"><a href="#3-Hello-Spring" class="headerlink" title="3. Hello Spring"></a>3. Hello Spring</h1><p>pojo中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hou.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>resource中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--bean = 对象--&gt;</span><br>    <span class="hljs-comment">&lt;!--id = 变量名--&gt;</span><br>    <span class="hljs-comment">&lt;!--class = new的对象--&gt;</span><br>    <span class="hljs-comment">&lt;!--property 相当于给对象中的属性设值--&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.pojo.Hello&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Spring&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>test</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.hou.pojo.Hello;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mytest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//获取spring上下文对象</span><br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-comment">//我们的对象下能在都在spring·中管理了，我们要使用，直接取出来就可以了</span><br>        <span class="hljs-type">Hello</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> (Hello) context.getBean(<span class="hljs-string">&quot;hello&quot;</span>);<br>        System.out.println(hello.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>bean &#x3D; 对象<br>id &#x3D; 变量名<br>class &#x3D; new的对象<br>property 相当于给对象中的属性设值</p><p>核心用set注入</p><p>第一个文件中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userdaomysql&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.dao.UserDaoMysqlImpl&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userServiceImpl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.service.UserServiceImp&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ref引用spring中已经创建很好的对象--&gt;</span><br>        <span class="hljs-comment">&lt;!--value是一个具体的值--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userdaomysql&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="4-IOC生成对象的方式"><a href="#4-IOC生成对象的方式" class="headerlink" title="4. IOC生成对象的方式"></a>4. IOC生成对象的方式</h1><ol><li>使用无参构造创建对象，默认。</li><li>使用有参构造</li></ol><p>下标赋值</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.pojo.User&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;hou&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>类型赋值（不建议使用）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.pojo.User&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;dong&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>直接通过参数名</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.pojo.User&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;hou&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Spring类似于婚介网站！</p><p>你想不想要，对象都在里面。注册bean之后用不用被实例化。</p><h1 id="5-Spring配置说明"><a href="#5-Spring配置说明" class="headerlink" title="5. Spring配置说明"></a>5. Spring配置说明</h1><p><strong>别名</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hou.pojo.User&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;hou&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">alias</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;user2aaa&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p><strong>Bean的配置</strong></p><ul><li>id：bean的id标识符</li><li>class：bean对象所对应的类型</li><li>name：别名，更高级，可以同时取多个别名。</li></ul><p><strong>import</strong></p><p>一般用于团队开发，它可以将多个配置文件，导入合并为一个</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;beans.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;beans2.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;beans3.xml&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h1 id="10-代理模式"><a href="#10-代理模式" class="headerlink" title="10. 代理模式"></a>10. 代理模式</h1><h2 id="10-1-静态代理"><a href="#10-1-静态代理" class="headerlink" title="10.1 静态代理"></a>10.1 静态代理</h2><h3 id="角色分析："><a href="#角色分析：" class="headerlink" title="角色分析："></a>角色分析：</h3><ul><li>抽象角色：一般会使用接口或者抽象类来解决</li><li>真实角色：被代理的角色</li><li>代理角色：代理真实角色，代理真实角色后，我们一般会做一些附属操作</li><li>客户：访问代理对象的人</li></ul><h3 id="代码步骤："><a href="#代码步骤：" class="headerlink" title="代码步骤："></a>代码步骤：</h3><ul><li><p>抽象角色（接口）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rent</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>真实角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 房东</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Host</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;房东租房子&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>代理角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 代理</span><br><span class="hljs-keyword">package</span> com.coachhe.demo01;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span>&#123;<br>    <span class="hljs-keyword">private</span> Host host;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">()</span>&#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seeHouse</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;中介带你看房&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">(Host host)</span> &#123;<br>        <span class="hljs-built_in">this</span>.host = host;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sign</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;中介签合同&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        seeHouse();<br>        System.out.println(<span class="hljs-string">&quot;中介带你去看房&quot;</span>);<br>        sign();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>客户</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.demo01;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Host</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Host</span>();<br><br>        <span class="hljs-comment">// 代理</span><br>        <span class="hljs-type">Proxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(host);<br><br>        <span class="hljs-comment">// 通过房东租房</span><br>        <span class="hljs-comment">// host.rent();</span><br><br>        <span class="hljs-comment">// 通过代理租房</span><br>        proxy.rent();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h3 id="代理模式的好处："><a href="#代理模式的好处：" class="headerlink" title="代理模式的好处："></a>代理模式的好处：</h3><ul><li>可以使真实角色的操作更加纯粹，不用去关注一些公共业务</li><li>公共也就交给代理角色，实现和业务的分工</li><li>公共业务发生拓展的时候，方便集中管理</li></ul><h3 id="代理模式的缺点："><a href="#代理模式的缺点：" class="headerlink" title="代理模式的缺点："></a>代理模式的缺点：</h3><ul><li>一个真实角色就会产生一个代理角色，代码量会翻倍，开发效率会变低</li></ul><h2 id="10-2-静态代理-加深理解"><a href="#10-2-静态代理-加深理解" class="headerlink" title="10.2 静态代理-加深理解"></a>10.2 静态代理-加深理解</h2><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><ul><li><p>抽象角色：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 抽象类，实现增删改查</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>真实角色：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 真实的UserService，做增删改查的人</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;使用了add方法&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;增加了一个用户&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;使用了delete&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;删除了一个用户&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;使用了change方法&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;修改了一个用户&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;使用了search方法&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;查询了一个用户&quot;</span>);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure></li><li><p>代理角色：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 代理</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span>&#123;<br><br>    <span class="hljs-keyword">private</span> UserServiceImpl userService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserService</span><span class="hljs-params">(UserServiceImpl userService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userService = userService;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;proxy的add方法&quot;</span>);<br>        userService.add();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;proxy的delete方法&quot;</span>);<br>        userService.delete();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;proxy的change方法&quot;</span>);<br>        userService.change();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;proxy的search方法&quot;</span>);<br>        userService.search();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>客户：访问代理对象的人</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 客户</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        <span class="hljs-comment">// 使用代理</span><br>        <span class="hljs-type">UserServiceProxy</span> <span class="hljs-variable">userServiceProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>();<br>        userServiceProxy.setUserService(userService);<br>        userServiceProxy.add();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="10-3-动态代理"><a href="#10-3-动态代理" class="headerlink" title="10.3 动态代理"></a>10.3 动态代理</h2><ul><li>动态代理和静态代理角色一样</li><li>动态代理的代理类是动态生成的，不是我们直接写好的</li><li>动态代理分为两大类：<ul><li>基于接口的动态代理—JDK动态代理</li><li>基于类的动态代理：cglib</li><li>Java字节码实现：JAVAssist</li></ul></li></ul><h3 id="需要了解两个类："><a href="#需要了解两个类：" class="headerlink" title="需要了解两个类："></a>需要了解两个类：</h3><ul><li>Proxy：代理</li><li>InvocationHandler：调用处理程序</li></ul>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e1b1acdb3148.html"/>
    <url>/2022/12/e1b1acdb3148.html</url>
    
    <content type="html"><![CDATA[<ol><li>首先下载最新版的centos</li></ol><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326003243.png"></p><p>此时的 centos 是最简版本，很多基本命令都没有。</p><ol start="2"><li>写一个Dockerfile，通过centos，设置密码为123456，安装ssh服务并启动</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">FROM centos<br>MAINTAINER mwf<br><br>RUN yum install -y openssh-server sudo<br>RUN sed -i &#x27;s/UsePAM yes/UsePAM no/g&#x27; /etc/ssh/sshd_config<br>RUN yum  install -y openssh-clients<br><br>RUN echo &quot;root:123456&quot; | chpasswd<br>RUN echo &quot;root   ALL=(ALL)       ALL&quot; &gt;&gt; /etc/sudoers<br>RUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key<br>RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key<br><br>RUN mkdir /var/run/sshd<br>EXPOSE 22<br>CMD [&quot;/usr/sbin/sshd&quot;, &quot;-D&quot;]<br></code></pre></td></tr></table></figure><ol start="3"><li>通过Dockerfile创建镜像centos7-ssh</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos /home/docker/centos]# docker build -t=&quot;centos7-ssh&quot; .<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326003750.png"></p><ol start="4"><li>通过该镜像进一步生成带有我们所需要的工作环境的镜像</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">base image</span><br>FROM centos7-ssh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">MainTainer</span><br>MAINTAINER CoachHe &lt;coachhe@tencent.com&gt;<br><br><br>RUN yum -y install vim<br>RUN yum -y install net-tools<br>RUN mkdir /opt/module<br>RUN mkdir /opt/software<br>RUN yum install ncurses<br>RUN yum install rsync<br><br><br>ADD jdk-8u144-linux-x64.tar.gz /opt/module<br>ADD hadoop-2.7.2.tar.gz /opt/module<br>ADD apache-hive-1.2.1-bin.tar.gz /opt/module<br>COPY mysql-libs.zip /opt/software<br><br><br>ENV JAVA_HOME /opt/module/jdk1.8.0_144<br>ENV HADOOP_HOME /opt/module/hadoop-2.7.2<br>ENV HIVE_HOME /opt/module/apache-hive-1.2.1-bin<br>ENV PATH $JAVA_HOME/bin:$HADOOP_HOME/bin:$HIVE_HOME/bin:$PATH<br><br>RUN yum install -y which sudo<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326010435.png"></p><p>执行结果</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326010948.png"></p><ol start="5"><li>配置网络</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --network bridge --name chadoop1 -p 50070:50070 -p 8088:8088 chadoop<br>docker run -itd --network bridge --name chadoop2 chadoop<br>docker run -itd --network bridge --name chadoop3 chadoop<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326011132.png"></p><p>查看网络情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker network inspect bridge<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326011255.png"></p><p>可以看到，分别分配了三个IP地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">chadoop1 192.168.10.2<br>chadoop2 192.168.10.3<br>chadoop3 192.168.10.4<br></code></pre></td></tr></table></figure><ol start="6"><li>登录docker容器</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it chadoop1 bash<br>docker exec -it chadoop2 bash<br>docker exec -it chadoop3 bash<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326011503.png"></p><ol start="7"><li>配置hosts以及ssh免密</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/hosts<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326011748.png"></p><p>ssh免密</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen # 一路回车<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326012056.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-copy-id -i /root/.ssh/id_rsa -p 22 root@chadoop1<br>ssh-copy-id -i /root/.ssh/id_rsa -p 22 root@chadoop2<br>ssh-copy-id -i /root/.ssh/id_rsa -p 22 root@chadoop3<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326012249.png"></p><ol start="8"><li>创建集群同步脚本xsync</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /home/bin<br>vim /home/bin/xsync<br>chmod u+x /home/bin/xsync<br></code></pre></td></tr></table></figure><p>脚本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">1 获取输入参数个数，如果没有参数则直接退出</span> <br>pcount=$# <br><br>if((pcount==0)); then <br>    echo no args; <br>    exit; <br>fi <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2 获取文件名称</span> <br>p1=$1 <br>fname=`basename $p1` #这里就是拿到最终文件的名称，/opt/module就是module <br>echo fname=$fname <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3 获取上级目录到绝对路径</span> <br>pdir=`cd -P $(dirname $p1); pwd` #这里是得到文件的路径 <br>echo pdir=$pdir <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4 获取当前用户名称</span> <br>user=`whoami`  #也就是coachhe <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">5 循环</span> <br>for((host=1;host&lt;4;host++)); do    <br>    echo -------- hadoop$host ---------<br>    rsync -rvl $pdir/$fname root@chadoop$host:$pdir<br>done<br></code></pre></td></tr></table></figure><p>同步实例</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326012916.png"></p><p>启动</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210326014924.png"></p><h1 id="指定容器的hostname"><a href="#指定容器的hostname" class="headerlink" title="指定容器的hostname"></a>指定容器的hostname</h1><h2 id="chadoop01"><a href="#chadoop01" class="headerlink" title="chadoop01"></a>chadoop01</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --network bridge -v module01:/opt/module --name chadoop01 --hostname chadoop01 -p 50080:50080 -p 8088:8088 coachhe/chadoop:2.0<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210419094542.png"></p><h2 id="chadoop02"><a href="#chadoop02" class="headerlink" title="chadoop02"></a>chadoop02</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --network bridge -v module02:/opt/module --name chadoop02 --hostname chadoop02 -p 50081:50081 coachhe/chadoop:2.1<br></code></pre></td></tr></table></figure><h2 id="chadoop03"><a href="#chadoop03" class="headerlink" title="chadoop03"></a>chadoop03</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --network bridge -v module03:/opt/module --name chadoop03 --hostname chadoop03 -p 50082:50082 coachhe/chadoop:2.1<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --network bridge -v pulsar:/root --name pulsar01 --hostname pulsar01 -p 50090:50090 apachepulsar/pulsar<br></code></pre></td></tr></table></figure><p>最新版：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~]# docker run -itd --name clinux01 --hostname clinux01  -p 60122:22 -p 60123:36000 -p 60124:80 -p 60125:8080 --mount type=bind,source=/cbs/dockerVolume/clinux01,target=/root centos7-ssh<br>896ef5a69b1352d085cfe6e66b0803621c10e77844dc48f76c99d892892b48ba<br>[root@VM-11-161-centos ~]# docker run -itd --name clinux02 --hostname clinux02  -p 60222:22 -p 60223:36000 -p 60224:80 -p 60225:8080 --mount type=bind,source=/cbs/dockerVolume/clinux01,target=/root centos7-ssh<br>f9e7377a0612c10abdd8995a1283423927200b6bd471efcf209b2f8f6351403e<br>[root@VM-11-161-centos ~]# docker run -itd --name clinux03 --hostname clinux03  -p 60322:22 -p 60323:36000 -p 60324:80 -p 60325:8080 --mount type=bind,source=/cbs/dockerVolume/clinux01,target=/root centos7-ssh<br>1581f4a90b50fe0ac113b7e600464333f3d98e20a0b7a3d9e0dacbf7a8f6bd13<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name springcloud2022 --hostname coachhe -p 50001-60000:1-10000  --mount type=bind, source=/cbs/dockerVolume/springcloud2022, target=/root centos7-ssh<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>Docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/815addbb4231.html"/>
    <url>/2022/12/815addbb4231.html</url>
    
    <content type="html"><![CDATA[<h1 id="工单协议"><a href="#工单协议" class="headerlink" title="工单协议"></a>工单协议</h1><h2 id="通用协议"><a href="#通用协议" class="headerlink" title="通用协议"></a>通用协议</h2><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><table><thead><tr><th>参数</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td>code</td><td>string</td><td>返回代码， 成功：0， 其他失败</td></tr><tr><td>message</td><td>string</td><td>如果是失败，返回对应的错误信息</td></tr><tr><td>data</td><td>object</td><td>返回的数据，可能是数组或者直接是对象</td></tr></tbody></table><ul><li><p>demo</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;taskUniqueId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;taskName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>失败demo</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;taskUniqueId is duplicate!&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><h3 id="默认角色"><a href="#默认角色" class="headerlink" title="默认角色"></a>默认角色</h3><p>默认角色有两种：管理员和游客。</p><ol><li><p>游客</p><p>有权限查询工单，并且有权限处理当前处理人为自己的工单（但是无法结单），但是没有权限处理其余工单。</p></li><li><p>管理员</p><p>管理员有权限处理所有工单。</p></li></ol><h3 id="创建角色"><a href="#创建角色" class="headerlink" title="创建角色"></a>创建角色</h3><p>管理员有权限创建角色，创建时可以选择需要赋予的权限</p><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p><code>/api/v1/role</code></p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>POST</p><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table><thead><tr><th>参数名</th><th>参数类型</th><th>是否必须</th><th>参数描述</th><th>demo</th></tr></thead><tbody><tr><td>nowUserName</td><td>string</td><td>Y</td><td>登录人用户名（必须为企业微信英文名）</td><td>coachhe</td></tr><tr><td>roleId</td><td>int</td><td>N（默认递增）</td><td>角色Id</td><td>0(只有管理员是0，可以通过是否为0来判断是否为管理员)</td></tr><tr><td>roleName</td><td>string</td><td>Y</td><td>角色名称</td><td>管理员</td></tr><tr><td>roleKey</td><td>string</td><td>Y</td><td>角色使用代码</td><td>admin</td></tr><tr><td>remark</td><td>string</td><td>N</td><td>备注</td><td>创建工单备注</td></tr><tr><td>munuIds</td><td>list</td><td>Y</td><td>角色的菜单列表（也用来鉴权）</td><td>[0,1,3]</td></tr></tbody></table><h3 id="菜单列表"><a href="#菜单列表" class="headerlink" title="菜单列表"></a>菜单列表</h3><p>这里列出几个demo：</p><table><thead><tr><th>menu_id</th><th>menu_name</th><th>title</th><th>icon</th><th>path</th><th>paths</th><th>menu_type</th><th>action</th><th>permission</th><th>parent_id</th><th>no_cache</th><th>breadcrumb</th><th>component</th><th>sort</th><th>visible</th><th>create_by</th><th>update_by</th><th>is_frame</th><th>create_time</th><th>update_time</th><th>delete_time</th></tr></thead><tbody><tr><td>2</td><td>Upms</td><td>系统管理</td><td>example</td><td>&#x2F;upms</td><td>&#x2F;0&#x2F;2</td><td>M</td><td>无</td><td></td><td>0</td><td>1</td><td></td><td>Layout</td><td>20</td><td>0</td><td>1</td><td>11</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr><tr><td>3</td><td>Sysuser</td><td>用户管理</td><td>user</td><td>sysuser</td><td>&#x2F;0&#x2F;2&#x2F;3</td><td>C</td><td>无</td><td>system:sysuser:list</td><td>2</td><td>NULL</td><td>NULL</td><td>&#x2F;system&#x2F;sysuser&#x2F;index</td><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr><tr><td>43</td><td>NULL</td><td>新增用户</td><td>NULL</td><td>&#x2F;api&#x2F;v1&#x2F;sysuser</td><td>&#x2F;0&#x2F;2&#x2F;3&#x2F;43</td><td>F</td><td>POST</td><td>system:sysuser:add</td><td>3</td><td>NULL</td><td>NULL</td><td>NULL</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr><tr><td>44</td><td>NULL</td><td>查询用户</td><td>NULL</td><td>&#x2F;api&#x2F;v1&#x2F;sysuser</td><td>&#x2F;0&#x2F;2&#x2F;3&#x2F;44</td><td>F</td><td>GET</td><td>system:sysuser:query</td><td>3</td><td>NULL</td><td>NULL</td><td>NULL</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr><tr><td>45</td><td>NULL</td><td>修改用户</td><td>NULL</td><td>&#x2F;api&#x2F;v1&#x2F;sysuser&#x2F;</td><td>&#x2F;0&#x2F;2&#x2F;3&#x2F;45</td><td>F</td><td>PUT</td><td>system:sysuser:edit</td><td>3</td><td>NULL</td><td>NULL</td><td>NULL</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr><tr><td>46</td><td>NULL</td><td>删除用户</td><td>NULL</td><td>&#x2F;api&#x2F;v1&#x2F;sysuser&#x2F;</td><td>&#x2F;0&#x2F;2&#x2F;3&#x2F;46</td><td>F</td><td>DELETE</td><td>system:sysuser:remove</td><td>3</td><td>NULL</td><td>NULL</td><td>NULL</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr><tr><td>67</td><td></td><td>菜单列表</td><td>tree-table</td><td>&#x2F;api&#x2F;v1&#x2F;menulist</td><td>&#x2F;0&#x2F;63&#x2F;66&#x2F;67</td><td>A</td><td>GET</td><td></td><td>66</td><td>0</td><td></td><td></td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>2020-07-26 21:51:44</td><td>2020-07-26 21:52:10</td><td>NULL</td></tr></tbody></table><p>需要重点注意的参数有几个：</p><ol><li><p>title：描述了菜单内容</p></li><li><p>path：菜单对应的请求url</p></li><li><p>menu_type：菜单类型，若&#x3D;&#x3D;类型为A&#x3D;&#x3D;则需要插入到casbin规则表中</p></li><li><p>parent_id：对应的母菜单id，展示时可以使用层级模式</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20220616111628539.png" width = "30%" /></li><li><p>action：请求方式</p><p>注意：path+action可以组成casbin规则，从而进行权限控制</p></li></ol><h3 id="casbin介绍"><a href="#casbin介绍" class="headerlink" title="casbin介绍"></a>casbin介绍</h3><p>用来做权限管理，简单可以用一个表来表示</p><table><thead><tr><th>p_type</th><th>v0</th><th>v1</th><th>v2</th><th>v3</th><th>v4</th><th>v5</th><th>id</th><th>create_time</th><th>update_time</th><th>delete_time</th></tr></thead><tbody><tr><td>p</td><td>admin</td><td>&#x2F;api&#x2F;v1&#x2F;menulist</td><td>GET</td><td>NULL</td><td>NULL</td><td>NULL</td><td>1</td><td>NULL</td><td>NULL</td><td>NULL</td></tr><tr><td>p</td><td>admin</td><td>&#x2F;api&#x2F;v1&#x2F;menu</td><td>POST</td><td>NULL</td><td>NULL</td><td>NULL</td><td>2</td><td>NULL</td><td>NULL</td><td>NULL</td></tr><tr><td>p</td><td>admin</td><td>&#x2F;api&#x2F;v1&#x2F;menu</td><td>PUT</td><td>NULL</td><td>NULL</td><td>NULL</td><td>3</td><td>NULL</td><td>NULL</td><td>NULL</td></tr><tr><td>p</td><td>admin</td><td>&#x2F;api&#x2F;v1&#x2F;menu&#x2F;:id</td><td>DELETE</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4</td><td>NULL</td><td>NULL</td><td>NULL</td></tr></tbody></table><p>可以看到，v0列是我们的角色名，v1列是我们对应的接口，v2列是接口方法，只有这样纪录的一条，我们在鉴权的时候才会判定通过，若没有对应的权限，则接口不允许访问。</p><h3 id="请求demo"><a href="#请求demo" class="headerlink" title="请求demo"></a>请求demo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/role&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  --data-raw &#x27;&#123;&quot;nowUserName&quot;:&quot;coachhe&quot;,&quot;roleName&quot;:&quot;游客&quot;,&quot;roleId&quot;:&quot;tourist&quot;,&quot;menuIds&quot;:[269,328,329,361,270,342,343,350,271,341,370,272,340,273,337,338,339,364,256,258,260,267,259,80,344,92,94,142,252,254,255,326,327,330,331,332,360,333,334,335,336,351,363,371,268,63,281],&quot;remark&quot;:&quot;创建一个游客角色&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure><h3 id="返回"><a href="#返回" class="headerlink" title="返回"></a>返回</h3><h4 id="成功返回"><a href="#成功返回" class="headerlink" title="成功返回"></a>成功返回</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;roleId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;roleName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;测试工单fds&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;roleKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;fsadfasfsdf&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;roleSort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;createBy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;updateBy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;remark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;admin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;menuIds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-number">268</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-number">325</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;create_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-06-16T11:42:15.224502054+08:00&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;update_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-06-16T11:42:15.224502054+08:00&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;添加成功&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="失败返回"><a href="#失败返回" class="headerlink" title="失败返回"></a>失败返回</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色名称或者角色标识已经存在！&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><p>用户和角色是多对一的关系，一个角色可以绑定多个用户，一个用户只能属于一个角色。</p><p>用户的权限和所属角色完全相同。</p><h3 id="默认用户"><a href="#默认用户" class="headerlink" title="默认用户"></a>默认用户</h3><p>默认情况下为游客，游客有权限查询工单，但是没有权限流转和结单。</p><p>管理员拥有所有权限，包括查询工单、流转工单、删除工单、结单、创建用户、创建角色、更改用户所属角色等。</p><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>管理员有权限创建用户，创建时需要指定用户属于什么角色</p><h4 id="接口-1"><a href="#接口-1" class="headerlink" title="接口"></a>接口</h4><p><code>/api/v1/sysUser</code></p><h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><p>POST</p><h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><table><thead><tr><th>参数名</th><th>参数类型</th><th>是否必须</th><th>参数描述</th><th>demo</th></tr></thead><tbody><tr><td>nowUserName</td><td>string</td><td>Y</td><td>登录人用户名（必须为企业微信英文名）</td><td>coachhe</td></tr><tr><td>userId</td><td>int</td><td>N（默认递增）</td><td>用户Id</td><td>1</td></tr><tr><td>password</td><td>string</td><td>Y</td><td>用户密码</td><td>123456</td></tr><tr><td>phone</td><td>string</td><td>N</td><td>用户手机号</td><td>13823282927</td></tr><tr><td>roleId</td><td>int</td><td>Y</td><td>用户所属角色号</td><td>0（管理员）</td></tr><tr><td>sex</td><td>string</td><td>N</td><td>用户性别</td><td>male</td></tr><tr><td>remark</td><td>string</td><td>N</td><td>备注</td><td>创建工单备注</td></tr><tr><td>extends</td><td>string</td><td>N</td><td>拓展字段，以备不时之需</td><td>{“aaa”:”bbb”}</td></tr></tbody></table><h4 id="返回-1"><a href="#返回-1" class="headerlink" title="返回"></a>返回</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;添加成功&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/94d31cbd3cde.html"/>
    <url>/2022/12/94d31cbd3cde.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/create&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTU4MDEwMDIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTcxNDYwMiwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.lqVCNsllHlJxfn3v6gC6TeYM8I54cHfR3d83RS6imRE&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189,1654506358,1655168971,1655714600; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1655714600; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTU4MDEwMDIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTcxNDYwMiwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.lqVCNsllHlJxfn3v6gC6TeYM8I54cHfR3d83RS6imRE&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.124 Safari/537.36 Edg/102.0.1245.44&#x27; \<br>  --data-raw &#x27;&#123;&quot;title&quot;:&quot;fffff&quot;,&quot;priority&quot;:1,&quot;process&quot;:1,&quot;classify&quot;:2,&quot;state&quot;:[&#123;&quot;id&quot;:&quot;receiveTask1651725819812&quot;,&quot;process_method&quot;:&quot;person&quot;,&quot;processor&quot;:[5],&quot;label&quot;:&quot;处理节点&quot;&#125;],&quot;source&quot;:&quot;start1651725870775&quot;,&quot;source_state&quot;:&quot;22&quot;,&quot;process_method&quot;:&quot;&quot;,&quot;tpls&quot;:&#123;&quot;form_structure&quot;:[&#123;&quot;list&quot;:[&#123;&quot;key&quot;:&quot;1652843023000_87184&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1651725342000_58443&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843028000_70959&quot;,&quot;icon&quot;:&quot;icon-wenjianshangchuan&quot;,&quot;name&quot;:&quot;文件&quot;,&quot;type&quot;:&quot;file&quot;,&quot;model&quot;:&quot;file_1652843028000_70959&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;tip&quot;:&quot;&quot;,&quot;token&quot;:&quot;&quot;,&quot;width&quot;:&quot;&quot;,&quot;action&quot;:&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;length&quot;:9,&quot;headers&quot;:&#123;&#125;,&quot;disabled&quot;:false,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843028000_70959&quot;,&quot;defaultValue&quot;:[],&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843032000_79963&quot;,&quot;icon&quot;:&quot;icon-tupian&quot;,&quot;name&quot;:&quot;图片&quot;,&quot;type&quot;:&quot;imgupload&quot;,&quot;model&quot;:&quot;imgupload_1652843032000_79963&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;min&quot;:0,&quot;size&quot;:&#123;&quot;width&quot;:100,&quot;height&quot;:100&#125;,&quot;token&quot;:&quot;&quot;,&quot;width&quot;:&quot;&quot;,&quot;action&quot;:&quot;https://jsonplaceholder.typicode.com/photos/&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;isEdit&quot;:false,&quot;length&quot;:8,&quot;isQiniu&quot;:false,&quot;disabled&quot;:false,&quot;isDelete&quot;:false,&quot;multiple&quot;:false,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843032000_79963&quot;,&quot;defaultValue&quot;:[],&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843040000_1662&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;分割线&quot;,&quot;type&quot;:&quot;divider&quot;,&quot;model&quot;:&quot;divider_1652843040000_1662&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;direction&quot;:&quot;horizontal&quot;,&quot;font_size&quot;:&quot;15px&quot;,&quot;font_color&quot;:&quot;#606266&quot;,&quot;remoteFunc&quot;:&quot;func_1652843040000_1662&quot;,&quot;font_family&quot;:&quot;&quot;,&quot;font_weight&quot;:&quot;500&quot;,&quot;defaultValue&quot;:&quot;分割线&quot;,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;content_position&quot;:&quot;center&quot;&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843043000_29667&quot;,&quot;icon&quot;:&quot;icon-table&quot;,&quot;name&quot;:&quot;子表单&quot;,&quot;type&quot;:&quot;subform&quot;,&quot;model&quot;:&quot;subform_1652843043000_29667&quot;,&quot;rules&quot;:[],&quot;columns&quot;:[&#123;&quot;list&quot;:[],&quot;span&quot;:12&#125;,&#123;&quot;list&quot;:[],&quot;span&quot;:12&#125;],&quot;options&quot;:&#123;&quot;align&quot;:&quot;top&quot;,&quot;gutter&quot;:0,&quot;justify&quot;:&quot;start&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843043000_29667&quot;,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;],&quot;config&quot;:&#123;&quot;size&quot;:&quot;small&quot;,&quot;labelWidth&quot;:100,&quot;customClass&quot;:&quot;&quot;,&quot;labelPosition&quot;:&quot;right&quot;&#125;,&quot;id&quot;:1&#125;],&quot;form_data&quot;:[&#123;&quot;input_1651725342000_58443&quot;:&quot;bbb&quot;,&quot;file_1652843028000_70959&quot;:[],&quot;imgupload_1652843032000_79963&quot;:[],&quot;divider_1652843040000_1662&quot;:&quot;分割线&quot;,&quot;subform_1652843043000_29667&quot;:[]&#125;]&#125;,&quot;tasks&quot;:[&quot;echo_test-4171bc7f4a05-admin.sh&quot;]&#125;&#x27; \<br>  --compressed \<br>  --insecure ;<br></code></pre></td></tr></table></figure><p>curl ‘<a href="http://9.135.11.161:60780/api/v1/work-order/create&#39;">http://9.135.11.161:60780/api/v1/work-order/create&#39;</a> <br>  -H ‘Accept: application&#x2F;json, text&#x2F;plain, <em>&#x2F;</em>‘ <br>  -H ‘Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6’ <br>  -H ‘Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTU4MDEwMDIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTcxNDYwMiwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.lqVCNsllHlJxfn3v6gC6TeYM8I54cHfR3d83RS6imRE’ <br>  -H ‘Connection: keep-alive’ <br>  -H ‘Content-Type: application&#x2F;json’ <br>  -H ‘Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d&#x3D;1654327189,1654506358,1655168971,1655714600; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d&#x3D;1655714600; Admin-Token&#x3D;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTU4MDEwMDIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTcxNDYwMiwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.lqVCNsllHlJxfn3v6gC6TeYM8I54cHfR3d83RS6imRE’ <br>  -H ‘Origin: <a href="http://9.135.11.161:60780&#39;">http://9.135.11.161:60780&#39;</a> <br>  -H ‘Referer: <a href="http://9.135.11.161:60780/&#39;">http://9.135.11.161:60780/&#39;</a> <br>  -H ‘User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;102.0.5005.124 Safari&#x2F;537.36 Edg&#x2F;102.0.1245.44’ <br>  –data-raw ‘’ <br>  –compressed <br>  –insecure</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/48e3e1bca145.html"/>
    <url>/2022/12/48e3e1bca145.html</url>
    
    <content type="html"><![CDATA[<h2 id="常见注解"><a href="#常见注解" class="headerlink" title="常见注解"></a>常见注解</h2><h3 id="Override"><a href="#Override" class="headerlink" title="@Override"></a><code>@Override</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.annotation;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// 什么是注解</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test01</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>只能用在父类已经有的方法上，否则会报错。</p><h3 id="Deprecated"><a href="#Deprecated" class="headerlink" title="@Deprecated"></a><code>@Deprecated</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.annotation;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test01</span> &#123;<br><br>    <span class="hljs-comment">// Deprecated，不推荐程序员使用，但是可以使用，或者存在更好的方式</span><br>    <span class="hljs-meta">@Deprecated</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Deprecated&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        test();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>不推荐程序员使用，但是可以使用，或者存在更好的方式。</p><h3 id="SuppressWarnings"><a href="#SuppressWarnings" class="headerlink" title="@SuppressWarnings"></a><code>@SuppressWarnings</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.annotation;  <br><span class="hljs-keyword">import</span> java.util.List;  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test01</span> &#123;  <br>   <span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span>  <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test02</span><span class="hljs-params">()</span>&#123;  <br>        List list;  <br>   &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>@SuppressWarning</code>注解，可以忽视警告，有以下几种方式：</p><ul><li><code>@SuppressWarnings(&quot;all&quot;)</code>:忽略所有警告</li><li><code>@SuppressWarnings(&quot;unchecked&quot;)</code>:忽略未检查的错误</li><li><code>@SuppressWarnings(value=&#123;&quot;unchecked&quot;,&quot;deprecation&quot;&#125;)</code>:忽略未检查的错误和不推荐的错误</li></ul><p>效果：<br>使用前：<br><img src='https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210806000259.png' width = "300" height = "100" ><br>使用后：<br><img src='https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210806002305.png' width = "300" height = "100"></p><h4 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> java.lang;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.lang.annotation.ElementType.*;<br><br><span class="hljs-meta">@Target(&#123;TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.SOURCE)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SuppressWarnings &#123;<br>    String[] value();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ElementType的源代码"><a href="#ElementType的源代码" class="headerlink" title="ElementType的源代码"></a>ElementType的源代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ElementType</span> &#123;  <br>    <span class="hljs-comment">/** Class, interface (including annotation type), or enum declaration */</span>  <br>    TYPE,  <br>  <br>    <span class="hljs-comment">/** Field declaration (includes enum constants) */</span>  <br>    FIELD,  <br>  <br>    <span class="hljs-comment">/** Method declaration */</span>  <br>    METHOD,  <br>  <br> <span class="hljs-comment">/** Formal parameter declaration */</span>  <br> PARAMETER,  <br>  <br> <span class="hljs-comment">/** Constructor declaration */</span>  <br> CONSTRUCTOR,  <br>  <br> <span class="hljs-comment">/** Local variable declaration */</span>  <br> LOCAL_VARIABLE,  <br>  <br> <span class="hljs-comment">/** Annotation type declaration */</span>  <br> ANNOTATION_TYPE,  <br>  <br> <span class="hljs-comment">/** Package declaration */</span>  <br> PACKAGE,  <br>  <br> <span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * Type parameter declaration </span><br><span class="hljs-comment">* </span><br><span class="hljs-comment">* <span class="hljs-doctag">@since</span> 1.8  </span><br><span class="hljs-comment"> */</span> <br>TYPE_PARAMETER,  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * Use of a type </span><br><span class="hljs-comment">* </span><br><span class="hljs-comment">* <span class="hljs-doctag">@since</span> 1.8  </span><br><span class="hljs-comment"> */</span> <br>TYPE_USE  <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java注解</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/374ef54fd326.html"/>
    <url>/2022/12/374ef54fd326.html</url>
    
    <content type="html"><![CDATA[<h2 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.annotation;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-comment">// 自定义注解</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test03</span> &#123;<br>    <span class="hljs-comment">// 必须给name赋值</span><br>    <span class="hljs-meta">@MyAnnotation2(name=&quot;coachhe&quot;,schools=&#123;&quot;HIT&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-comment">// 这里name的有默认值，为空</span><br>    <span class="hljs-meta">@MyAnnotation2(schools = &#123;&quot;HIT&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span>&#123;&#125;<br>    <br>    <span class="hljs-meta">@MyAnnotation3(&quot;hi&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span>&#123;&#125;;<br>&#125;<br><br><span class="hljs-meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> MyAnnotation2&#123;<br><br>    <span class="hljs-comment">// 注解的参数：参数类型+参数名();</span><br>    String <span class="hljs-title function_">name</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">id</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// 如果默认值为-1，代表不存在</span><br><br>    String[] schools();<br><br>&#125;<br><br><span class="hljs-meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> MyAnnotation3 &#123;<br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java注解</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/2034168a5db1.html"/>
    <url>/2022/12/2034168a5db1.html</url>
    
    <content type="html"><![CDATA[<h1 id="工单"><a href="#工单" class="headerlink" title="工单"></a>工单</h1><h2 id="创建工单"><a href="#创建工单" class="headerlink" title="创建工单"></a>创建工单</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;111&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;priority&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;process&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;classify&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receiveTask1651725819812&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;process_method&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;person&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;processor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">5</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;处理节点&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start1651725870775&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;source_state&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;22&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;process_method&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tpls&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;form_structure&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;icon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;icon-input&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;input_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                            <span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;单行文本格式不正确&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><br>                        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                            <span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;100%&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;pattern&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;dataType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;remoteFunc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func_1651725342000_58443&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;placeholder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;defaultValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;showPassword&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;displayVerifiy&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                                <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                                    <span class="hljs-punctuation">&#123;</span><br>                                        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段标识&quot;</span><span class="hljs-punctuation">,</span><br>                                        <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;字段值&quot;</span><br>                                    <span class="hljs-punctuation">&#125;</span><br>                                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hide&quot;</span><br>                            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;labelWidthStatus&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                            <span class="hljs-attr">&quot;labelWidthDisabled&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>                        <span class="hljs-punctuation">&#125;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;small&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelWidth&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;customClass&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;labelPosition&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;right&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;form_data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;input_1651725342000_58443&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;111&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tasks&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;echo_test-4171bc7f4a05-admin.sh&quot;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e2af6ffd3191.html"/>
    <url>/2022/12/e2af6ffd3191.html</url>
    
    <content type="html"><![CDATA[<h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://localhost:8080/api/v1/sysUser&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTUyNTUzNzIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTE2ODk3Miwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.CCKTOq43Dq0m6T7OCe6L0wE-NhjmX-w86yQEUmJfS74&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  --data-raw &#x27;&#123;&quot;username&quot;:&quot;test_user_mingcheng&quot;,&quot;nickName&quot;:&quot;test_user_nicheng&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;phone&quot;:&quot;13823282927&quot;,&quot;email&quot;:&quot;test@qq.com&quot;,&quot;status&quot;:&quot;0&quot;,&quot;remark&quot;:&quot;用户备注&quot;,&quot;roleId&quot;:1,&quot;postId&quot;:1&#125;&#x27; \<br></code></pre></td></tr></table></figure><p>curl ‘<a href="http://9.135.11.161:60780/api/v1/role&#39;">http://9.135.11.161:60780/api/v1/role&#39;</a> <br>  -H ‘Accept: application&#x2F;json, text&#x2F;plain, <em>&#x2F;</em>‘ <br>  -H ‘Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6’ <br>  -H ‘Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTUyNTUzNzIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTE2ODk3Miwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.CCKTOq43Dq0m6T7OCe6L0wE-NhjmX-w86yQEUmJfS74’ <br>  -H ‘Connection: keep-alive’ <br>  -H ‘Content-Type: application&#x2F;json’ <br>  -H ‘Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d&#x3D;1653203054,1654327189,1654506358,1655168971; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d&#x3D;1655168971; Admin-Token&#x3D;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTUyNTUzNzIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTE2ODk3Miwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.CCKTOq43Dq0m6T7OCe6L0wE-NhjmX-w86yQEUmJfS74’ <br>  -H ‘Origin: <a href="http://9.135.11.161:60780&#39;">http://9.135.11.161:60780&#39;</a> <br>  -H ‘Referer: <a href="http://9.135.11.161:60780/&#39;">http://9.135.11.161:60780/&#39;</a> <br>  -H ‘User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;102.0.5005.63 Safari&#x2F;537.36 Edg&#x2F;102.0.1245.39’ <br>  –data-raw ‘{“roleName”:”fsafsad”,”roleKey”:”fasdfas”,”roleSort”:0,”status”:”0”,”menuIds”:[269,328,329,361,270,342,343,350,268],”deptIds”:[]}’ <br>  –compressed <br>  –insecure</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/05851b7c822d.html"/>
    <url>/2022/12/05851b7c822d.html</url>
    
    <content type="html"><![CDATA[<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/sysUser&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1653038287,1653203054,1654327189,1654506358; sidebarStatus=1; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654841944; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ5MjgzNDMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDg0MTk0Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.ISU5tv090YpGwNbT4LkcR8XukpgfJH5Wzci3pckr3u4&#x27; \<br>  --data-raw &#x27;&#123;&quot;deptId&quot;:1,&quot;username&quot;:&quot;test&quot;,&quot;nickName&quot;:&quot;testnicheng&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;phone&quot;:&quot;13111111111&quot;,&quot;email&quot;:&quot;a@qq.com&quot;,&quot;status&quot;:&quot;0&quot;,&quot;remark&quot;:&quot;beizhu &quot;,&quot;roleId&quot;:4,&quot;postId&quot;:1&#125;&#x27;<br></code></pre></td></tr></table></figure><h2 id="角色管理"><a href="#角色管理" class="headerlink" title="角色管理"></a>角色管理</h2><h3 id="新建角色"><a href="#新建角色" class="headerlink" title="新建角色"></a>新建角色</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/role&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1653038287,1653203054,1654327189,1654506358; sidebarStatus=1; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654841944; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ5MjgzNDMsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDg0MTk0Mywicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.ISU5tv090YpGwNbT4LkcR8XukpgfJH5Wzci3pckr3u4&#x27; \<br>  --data-raw &#x27;&#123;&quot;roleName&quot;:&quot;工单管理员&quot;,&quot;roleKey&quot;:&quot;aaa&quot;,&quot;roleSort&quot;:0,&quot;status&quot;:&quot;0&quot;,&quot;menuIds&quot;:[268,269,328,329,361,270,342,343,350,271,341,370,272,340,273,337,338,339,364,274,275,290,291,292,293,276,300,301,302,303,366,277,304,305,306,307,368,278,322,323,324,325,2,3,43,44,45,46,52,224,225,226,227,57,232,233,234,235,56,230,231,228,229,51,220,221,222,223,212,356,248,249,352,63,256,258,260,267,259,80,344,92,94,142,252,254,255,281,326,327,330,331,332,360,333,334,335,336,351,363,371,282,283,284,285,287,288,294,295,296,297,298,299,367,309,310,311,312,313,314,315,369,316,317,318,319,320,321,280,64,74,75,76,77,78,79,66,137,138,139,140,141,67,68,72,73,201,81,82,83,84,85,93,203,103,104,105,106,107,365,204,119,120,121,122,123,214,357,213,215,353,355,354],&quot;deptIds&quot;:[],&quot;remark&quot;:&quot;工单管理&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/55831a2f03a8.html"/>
    <url>/2022/12/55831a2f03a8.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/create&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTMyODk0NTYsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1MzIwMzA1Niwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.et5FY8xaQgx6u1FNKVSJesjAwGKOcgD6x4jN8kdAHAM&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1653203054; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTMyODk0NTYsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1MzIwMzA1Niwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.et5FY8xaQgx6u1FNKVSJesjAwGKOcgD6x4jN8kdAHAM&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --data-raw &#x27;&#123;&quot;title&quot;:&quot;文件工单&quot;,&quot;priority&quot;:1,&quot;process&quot;:1,&quot;classify&quot;:2,&quot;state&quot;:[&#123;&quot;id&quot;:&quot;receiveTask1651725819812&quot;,&quot;process_method&quot;:&quot;person&quot;,&quot;processor&quot;:[5],&quot;label&quot;:&quot;处理节点&quot;&#125;],&quot;source&quot;:&quot;start1651725870775&quot;,&quot;source_state&quot;:&quot;22&quot;,&quot;process_method&quot;:&quot;&quot;,&quot;tpls&quot;:&#123;&quot;form_structure&quot;:[&#123;&quot;list&quot;:[&#123;&quot;key&quot;:&quot;1652843023000_87184&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1651725342000_58443&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;单行文本&quot;,&quot;type&quot;:&quot;input&quot;,&quot;model&quot;:&quot;input_1651725342000_58443&quot;,&quot;rules&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;message&quot;:&quot;单行文本格式不正确&quot;&#125;],&quot;options&quot;:&#123;&quot;width&quot;:&quot;100%&quot;,&quot;pattern&quot;:&quot;&quot;,&quot;dataType&quot;:&quot;string&quot;,&quot;disabled&quot;:false,&quot;required&quot;:false,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1651725342000_58443&quot;,&quot;placeholder&quot;:&quot;&quot;,&quot;defaultValue&quot;:&quot;&quot;,&quot;showPassword&quot;:false,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843028000_70959&quot;,&quot;icon&quot;:&quot;icon-wenjianshangchuan&quot;,&quot;name&quot;:&quot;文件&quot;,&quot;type&quot;:&quot;file&quot;,&quot;model&quot;:&quot;file_1652843028000_70959&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;tip&quot;:&quot;&quot;,&quot;token&quot;:&quot;&quot;,&quot;width&quot;:&quot;&quot;,&quot;action&quot;:&quot;http://ipaddress:port/api/v1/public/uploadFile&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;length&quot;:9,&quot;headers&quot;:&#123;&#125;,&quot;disabled&quot;:false,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843028000_70959&quot;,&quot;defaultValue&quot;:[],&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843032000_79963&quot;,&quot;icon&quot;:&quot;icon-tupian&quot;,&quot;name&quot;:&quot;图片&quot;,&quot;type&quot;:&quot;imgupload&quot;,&quot;model&quot;:&quot;imgupload_1652843032000_79963&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;min&quot;:0,&quot;size&quot;:&#123;&quot;width&quot;:100,&quot;height&quot;:100&#125;,&quot;token&quot;:&quot;&quot;,&quot;width&quot;:&quot;&quot;,&quot;action&quot;:&quot;https://jsonplaceholder.typicode.com/photos/&quot;,&quot;domain&quot;:&quot;http://pfp81ptt6.bkt.clouddn.com/&quot;,&quot;isEdit&quot;:false,&quot;length&quot;:8,&quot;isQiniu&quot;:false,&quot;disabled&quot;:false,&quot;isDelete&quot;:false,&quot;multiple&quot;:false,&quot;tokenFunc&quot;:&quot;funcGetToken&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843032000_79963&quot;,&quot;defaultValue&quot;:[],&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843040000_1662&quot;,&quot;icon&quot;:&quot;icon-input&quot;,&quot;name&quot;:&quot;分割线&quot;,&quot;type&quot;:&quot;divider&quot;,&quot;model&quot;:&quot;divider_1652843040000_1662&quot;,&quot;rules&quot;:[],&quot;options&quot;:&#123;&quot;direction&quot;:&quot;horizontal&quot;,&quot;font_size&quot;:&quot;15px&quot;,&quot;font_color&quot;:&quot;#606266&quot;,&quot;remoteFunc&quot;:&quot;func_1652843040000_1662&quot;,&quot;font_family&quot;:&quot;&quot;,&quot;font_weight&quot;:&quot;500&quot;,&quot;defaultValue&quot;:&quot;分割线&quot;,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;content_position&quot;:&quot;center&quot;&#125;&#125;,&#123;&quot;key&quot;:&quot;1652843043000_29667&quot;,&quot;icon&quot;:&quot;icon-table&quot;,&quot;name&quot;:&quot;子表单&quot;,&quot;type&quot;:&quot;subform&quot;,&quot;model&quot;:&quot;subform_1652843043000_29667&quot;,&quot;rules&quot;:[],&quot;columns&quot;:[&#123;&quot;list&quot;:[],&quot;span&quot;:12&#125;,&#123;&quot;list&quot;:[],&quot;span&quot;:12&#125;],&quot;options&quot;:&#123;&quot;align&quot;:&quot;top&quot;,&quot;gutter&quot;:0,&quot;justify&quot;:&quot;start&quot;,&quot;labelWidth&quot;:100,&quot;remoteFunc&quot;:&quot;func_1652843043000_29667&quot;,&quot;displayVerifiy&quot;:&#123;&quot;list&quot;:[&#123;&quot;model&quot;:&quot;字段标识&quot;,&quot;value&quot;:&quot;字段值&quot;&#125;],&quot;type&quot;:&quot;hide&quot;&#125;,&quot;labelWidthStatus&quot;:true,&quot;labelWidthDisabled&quot;:false&#125;&#125;],&quot;config&quot;:&#123;&quot;size&quot;:&quot;small&quot;,&quot;labelWidth&quot;:100,&quot;customClass&quot;:&quot;&quot;,&quot;labelPosition&quot;:&quot;right&quot;&#125;,&quot;id&quot;:1&#125;],&quot;form_data&quot;:[&#123;&quot;input_1651725342000_58443&quot;:&quot;&quot;,&quot;file_1652843028000_70959&quot;:[],&quot;imgupload_1652843032000_79963&quot;:[],&quot;divider_1652843040000_1662&quot;:&quot;分割线&quot;,&quot;subform_1652843043000_29667&quot;:[]&#125;]&#125;,&quot;tasks&quot;:[&quot;echo_test-4171bc7f4a05-admin.sh&quot;]&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/0216882860c9.html"/>
    <url>/2022/12/0216882860c9.html</url>
    
    <content type="html"><![CDATA[<h2 id="创建角色"><a href="#创建角色" class="headerlink" title="创建角色"></a>创建角色</h2><h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location --request POST &#x27;http://localhost:8080/api/v1/role&#x27; \<br>--header &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTUxNzYzNjIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTE3Mjc2Miwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.uqTFEMDrp4DzVHNQIvyaDZBBTxjqHTnlCE41AhAIHX8&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data-raw &#x27;&#123;&quot;roleName&quot;:&quot;测试角色aaaaa&quot;,&quot;roleKey&quot;:&quot;aaaaa&quot;,&quot;roleSort&quot;:0,&quot;status&quot;:&quot;0&quot;,&quot;menuIds&quot;:[329,361,268],&quot;deptIds&quot;:[],&quot;remark&quot;:&quot;角色备注&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure><p>创建角色时会往sys_role_menu里插入数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `sys_role_menu` (`role_id`,`menu_id`,`role_name`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>,<span class="hljs-number">268</span>,<span class="hljs-string">&#x27;aaaaa&#x27;</span>),(<span class="hljs-number">4</span>,<span class="hljs-number">329</span>,<span class="hljs-string">&#x27;aaaaa&#x27;</span>),(<span class="hljs-number">4</span>,<span class="hljs-number">361</span>,<span class="hljs-string">&#x27;aaaaa&#x27;</span>);<br></code></pre></td></tr></table></figure><p>还会往casbin_rule里插入数据：(只有menuType&#x3D;A的才需要插入)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> casbin_rule  (`p_type`,`v0`,`v1`,`v2`) <span class="hljs-keyword">VALUES</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>coachhe工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/01960bbe6839.html"/>
    <url>/2022/12/01960bbe6839.html</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>因为工作需要新建一个工单系统，参考了很多开源的工单系统，发现github上有一个很不错的工单项目：<a href="https://github.com/lanyulei/ferry">lanyulei&#x2F;ferry</a><br>在这里我们就仿照这个项目进行学习，并且根据工作场景单独构建一套适合我们使用的工单系统。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/aaf7648cbe54.html"/>
    <url>/2022/12/aaf7648cbe54.html</url>
    
    <content type="html"><![CDATA[<h2 id="我的待办"><a href="#我的待办" class="headerlink" title="我的待办"></a>我的待办</h2><p>方法：GET</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?classify=1&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h3 id="待办查询"><a href="#待办查询" class="headerlink" title="待办查询"></a>待办查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?page=1&amp;per_page=10&amp;classify=1&amp;title=111&amp;startTime=&amp;endTime=&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h2 id="我创建的工单"><a href="#我创建的工单" class="headerlink" title="我创建的工单"></a>我创建的工单</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?classify=2&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h3 id="创建的工单查询"><a href="#创建的工单查询" class="headerlink" title="创建的工单查询"></a>创建的工单查询</h3><p>方法：GET</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?page=1&amp;per_page=10&amp;classify=2&amp;title=11&amp;startTime=&amp;endTime=&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h2 id="我相关的"><a href="#我相关的" class="headerlink" title="我相关的"></a>我相关的</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?classify=3&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h3 id="相关工单查询"><a href="#相关工单查询" class="headerlink" title="相关工单查询"></a>相关工单查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?page=1&amp;per_page=10&amp;classify=3&amp;title=11&amp;startTime=&amp;endTime=&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h2 id="所有工单"><a href="#所有工单" class="headerlink" title="所有工单"></a>所有工单</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?classify=4&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h3 id="工单查询"><a href="#工单查询" class="headerlink" title="工单查询"></a>工单查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/work-order/list?page=1&amp;per_page=10&amp;classify=4&amp;title=111&amp;startTime=&amp;endTime=&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054,1654327189; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1654327189; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTQ0MTM1OTEsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NDMyNzE5MSwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.eXUH3e5lXgah6igsmNgZvl0G9Z3iDkhv5lde0bObCj4&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/f41529da5112.html"/>
    <url>/2022/12/f41529da5112.html</url>
    
    <content type="html"><![CDATA[<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>POST</p><h2 id="流程分类："><a href="#流程分类：" class="headerlink" title="流程分类："></a>流程分类：</h2><p>图：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520170424.png" width = "100%" /><br>对应mysql：<br>表名：p_process_classify<br>内容：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520171425.png" width = "80%" /></p><h2 id="提交流程"><a href="#提交流程" class="headerlink" title="提交流程"></a>提交流程</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/classify&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI4Njc3MTgsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNzgxMzE4LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.OXFVzdKVLCT2QTsIN6hUe-DqrKQjw6PsPD8Y30N-8SE&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; sidebarStatus=1; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI4Njc3MTgsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNzgxMzE4LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.OXFVzdKVLCT2QTsIN6hUe-DqrKQjw6PsPD8Y30N-8SE; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652841986&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.47&#x27; \<br>  --data-raw &#x27;&#123;&quot;name&quot;:&quot;渠道外部对账&quot;&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>demo2:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/process&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTMyODk0NTYsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1MzIwMzA1Niwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.et5FY8xaQgx6u1FNKVSJesjAwGKOcgD6x4jN8kdAHAM&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1652293272,1653038287,1653203054; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1653203054; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTMyODk0NTYsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1MzIwMzA1Niwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.et5FY8xaQgx6u1FNKVSJesjAwGKOcgD6x4jN8kdAHAM&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53&#x27; \<br>  --data-raw &#x27;&#123;&quot;name&quot;:&quot;流程11&quot;,&quot;tpls&quot;:[2],&quot;structure&quot;:&#123;&quot;nodes&quot;:[&#123;&quot;clazz&quot;:&quot;start&quot;,&quot;size&quot;:[30,30],&quot;label&quot;:&quot;12&quot;,&quot;shape&quot;:&quot;start-node&quot;,&quot;x&quot;:135.46426391601562,&quot;y&quot;:95.99996948242188,&quot;id&quot;:&quot;start1653205588731&quot;,&quot;sort&quot;:&quot;1&quot;&#125;,&#123;&quot;clazz&quot;:&quot;end&quot;,&quot;size&quot;:[30,30],&quot;label&quot;:&quot;11&quot;,&quot;shape&quot;:&quot;end-node&quot;,&quot;x&quot;:279.4642639160156,&quot;y&quot;:98.99996948242188,&quot;id&quot;:&quot;end1653205592595&quot;,&quot;sort&quot;:&quot;1&quot;&#125;],&quot;edges&quot;:[&#123;&quot;clazz&quot;:&quot;flow&quot;,&quot;source&quot;:&quot;start1653205588731&quot;,&quot;target&quot;:&quot;end1653205592595&quot;,&quot;sourceAnchor&quot;:1,&quot;targetAnchor&quot;:2,&quot;shape&quot;:&quot;flow-polyline-round&quot;,&quot;startPoint&quot;:&#123;&quot;x&quot;:150.96426391601562,&quot;y&quot;:95.99996948242188,&quot;index&quot;:1&#125;,&quot;endPoint&quot;:&#123;&quot;x&quot;:263.9642639160156,&quot;y&quot;:98.99996948242188,&quot;index&quot;:2&#125;,&quot;label&quot;:&quot;111&quot;,&quot;style&quot;:&#123;&#125;,&quot;sort&quot;:&quot;111&quot;,&quot;flowProperties&quot;:&quot;1&quot;&#125;],&quot;groups&quot;:[]&#125;,&quot;classify&quot;:7,&quot;task&quot;:[&quot;echo_test-4171bc7f4a05-admin.sh&quot;],&quot;notice&quot;:[1],&quot;icon&quot;:&quot;fa fa-slack&quot;,&quot;remarks&quot;:&quot;创建流程11&quot;&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h2 id="展示流程："><a href="#展示流程：" class="headerlink" title="展示流程："></a>展示流程：</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/classify?page=1&amp;per_page=10&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI4Njc3MTgsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNzgxMzE4LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.OXFVzdKVLCT2QTsIN6hUe-DqrKQjw6PsPD8Y30N-8SE&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; sidebarStatus=1; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI4Njc3MTgsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNzgxMzE4LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.OXFVzdKVLCT2QTsIN6hUe-DqrKQjw6PsPD8Y30N-8SE; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652841986&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.47&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><h2 id="流程管理"><a href="#流程管理" class="headerlink" title="流程管理"></a>流程管理</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520172321.png"></p><h2 id="流程内容"><a href="#流程内容" class="headerlink" title="流程内容"></a>流程内容</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520172346.png"></p><p>mysql：<br>表：p_process_info<br>内容：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220520172505.png"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;edges&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;5&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;flow&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;44&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;flow-polyline-round&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;style&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start1651725870775&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receiveTask1651725819812&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;endPoint&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">184.3046875</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">3</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;startPoint&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">112.3046875</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sourceAnchor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;targetAnchor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;flowProperties&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;111&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;flow&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;11&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;flow-polyline-round&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;style&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receiveTask1651725819812&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userTask1652844280606&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;endPoint&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">387.8046875</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">140</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;startPoint&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">224.8046875</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">96.5</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sourceAnchor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;targetAnchor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;flowProperties&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;5&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;flow&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;5&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;flow-polyline-round&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;style&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;source&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userTask1652844280606&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;end1651725896495&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;endPoint&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">485.3046875</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">118</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;startPoint&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">428.3046875</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">117.5</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sourceAnchor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;targetAnchor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;flowProperties&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;nodes&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">224.8046875</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receiveTask1651725819812&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">80</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-number">44</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;2&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receiveTask&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;处理节点&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;receive-task-node&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assignType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;person&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;activeOrder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assignValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">5</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;isCounterSign&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">96.8046875</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">119</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start1651725870775&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">30</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-number">30</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;task&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;echo_test-4171bc7f4a05-admin.sh&quot;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;22&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;start-node&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;hideIcon&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">500.8046875</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">118</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;end1651725896495&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">30</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-number">30</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;end&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;33&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;end-node&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">387.8046875</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">117.5</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userTask1652844280606&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">80</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-number">44</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;userTask&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;label&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;审批节点&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;shape&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;user-task-node&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assignType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;person&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;activeOrder&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;assignValue&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>                <span class="hljs-number">5</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;isCounterSign&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;groups&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7343f176e183.html"/>
    <url>/2022/12/7343f176e183.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;https://jsonplaceholder.typicode.com/photos/&#x27; \<br>  -H &#x27;authority: jsonplaceholder.typicode.com&#x27; \<br>  -H &#x27;accept: */*&#x27; \<br>  -H &#x27;accept-language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;content-type: multipart/form-data; boundary=----WebKitFormBoundarydfCk3pfdvwNoBj7c&#x27; \<br>  -H &#x27;origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;101&quot;, &quot;Microsoft Edge&quot;;v=&quot;101&quot;&#x27; \<br>  -H &#x27;sec-ch-ua-mobile: ?0&#x27; \<br>  -H &#x27;sec-ch-ua-platform: &quot;macOS&quot;&#x27; \<br>  -H &#x27;sec-fetch-dest: empty&#x27; \<br>  -H &#x27;sec-fetch-mode: cors&#x27; \<br>  -H &#x27;sec-fetch-site: cross-site&#x27; \<br>  -H &#x27;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39&#x27; \<br>  --data-raw $&#x27;------WebKitFormBoundarydfCk3pfdvwNoBj7c\r\nContent-Disposition: form-data; name=&quot;file&quot;; filename=&quot;CoachHe_Logo.jpg&quot;\r\nContent-Type: image/jpeg\r\n\r\n\r\n------WebKitFormBoundarydfCk3pfdvwNoBj7c--\r\n&#x27; \<br>  --compressed<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/44c4490eec7a.html"/>
    <url>/2022/12/44c4490eec7a.html</url>
    
    <content type="html"><![CDATA[<h2 id="getCaptcha"><a href="#getCaptcha" class="headerlink" title="getCaptcha"></a>getCaptcha</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/getCaptcha&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652688282&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>返回：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220516161228.png"></p><h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/login&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652688282&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39&#x27; \<br>  --data-raw &#x27;&#123;&quot;username&quot;:&quot;coachhe&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;rememberMe&quot;:false,&quot;code&quot;:&quot;&quot;,&quot;uuid&quot;:&quot;hHODHrVNmVJsofXxNXFe&quot;,&quot;loginType&quot;:0&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>返回：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220516161248.png"></p><h2 id="getinfo"><a href="#getinfo" class="headerlink" title="getinfo"></a>getinfo</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/getinfo&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI3NzQ3MTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNjg4MzE1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.6GfHDWdseRrtAmm_uOJl_mgXuwBPy9R5BQTzRniSvs8&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652688282; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI3NzQ3MTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNjg4MzE1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.6GfHDWdseRrtAmm_uOJl_mgXuwBPy9R5BQTzRniSvs8&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>返回：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220516161312.png"></p><h2 id="menurole"><a href="#menurole" class="headerlink" title="menurole"></a>menurole</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/menurole&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI3NzQ3MTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNjg4MzE1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.6GfHDWdseRrtAmm_uOJl_mgXuwBPy9R5BQTzRniSvs8&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652688282; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI3NzQ3MTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNjg4MzE1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.6GfHDWdseRrtAmm_uOJl_mgXuwBPy9R5BQTzRniSvs8&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>返回：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220516161333.png"></p><h2 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/dashboard&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI3NzQ3MTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNjg4MzE1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.6GfHDWdseRrtAmm_uOJl_mgXuwBPy9R5BQTzRniSvs8&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1650806151,1652688282; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1652688282; Admin-Token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTI3NzQ3MTUsImlkZW50aXR5Ijo1LCJuaWNlIjoiY29hY2hoZSIsIm9yaWdfaWF0IjoxNjUyNjg4MzE1LCJyb2xlaWQiOjEsInJvbGVrZXkiOiJhZG1pbiIsInJvbGVuYW1lIjoi57O757uf566h55CG5ZGYIn0.6GfHDWdseRrtAmm_uOJl_mgXuwBPy9R5BQTzRniSvs8&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure><p>返回：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220516161402.png"></p><h2 id="失败的登录测试（普通角色）"><a href="#失败的登录测试（普通角色）" class="headerlink" title="失败的登录测试（普通角色）"></a>失败的登录测试（普通角色）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/login&#x27; \<br>  -H &#x27;Accept: application/json, text/plain, */*&#x27; \<br>  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27; \<br>  -H &#x27;Connection: keep-alive&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  -H &#x27;Cookie: Hm_lvt_1d2d61263f13e4b288c8da19ad3ff56d=1653203054,1654327189,1654506358,1655168971; Hm_lpvt_1d2d61263f13e4b288c8da19ad3ff56d=1655275383; Admin-Token=&#x27; \<br>  -H &#x27;Origin: http://9.135.11.161:60780&#x27; \<br>  -H &#x27;Referer: http://9.135.11.161:60780/&#x27; \<br>  -H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36 Edg/102.0.1245.39&#x27; \<br>  --data-raw &#x27;&#123;&quot;username&quot;:&quot;coachhe&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;rememberMe&quot;:false,&quot;code&quot;:&quot;&quot;,&quot;uuid&quot;:&quot;fA3FdH4Qr66FCKf83qce&quot;,&quot;loginType&quot;:0&#125;&#x27; \<br>  --compressed \<br>  --insecure<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/c4e5ca7c9b51.html"/>
    <url>/2022/12/c4e5ca7c9b51.html</url>
    
    <content type="html"><![CDATA[<table><thead><tr><th>英文名</th><th>中文名</th><th>描述</th></tr></thead><tbody><tr><td>Subject</td><td>主体</td><td>用户或者用户组</td></tr><tr><td>Action</td><td>操作</td><td>对Object的操作，比如增删改查</td></tr><tr><td>Object</td><td>对象</td><td>权限所作用的对象，通常指各类资源</td></tr><tr><td>Effect</td><td>效力</td><td>限规则匹配后的操作，比如Allow&#x2F;Deny</td></tr><tr><td>Condition</td><td>限制条件</td><td>权限生效的条件</td></tr><tr><td>Permission</td><td>权限</td><td>用来指代是否允许某人在某种条件下对某种资源做某种操作</td></tr><tr><td>Role</td><td>角色</td><td>权限集合，包含一个或者多个权限（Permission）</td></tr><tr><td>Policy</td><td>策略</td><td>一组规则&#x2F;声明，在特定用户尝试执行特定操作时进行评估，然后将策略应用于用户、组和角色</td></tr></tbody></table><p>权限模型中最重要的代码如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (  <br>   <span class="hljs-string">&quot;fmt&quot;</span>  <br>   <span class="hljs-string">&quot;github.com/casbin/casbin/v2&quot;</span>   <br>   gormAdapter <span class="hljs-string">&quot;github.com/casbin/gorm-adapter/v2&quot;</span>  <br>   <span class="hljs-string">&quot;github.com/go-kit/kit/endpoint&quot;</span>   <br>   _ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span>  <br>   <span class="hljs-string">&quot;workOrder/global/orm&quot;</span>   <br>   myConfig <span class="hljs-string">&quot;workOrder/tools/config&quot;</span>  <br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Casbin</span><span class="hljs-params">()</span></span> (*casbin.Enforcer, <span class="hljs-type">error</span>) &#123;  <br>   conn := orm.MysqlConn  <br>   Apter, err := gormAdapter.NewAdapter(myConfig.DatabaseConfig.DbType, conn, <span class="hljs-literal">true</span>)  <br>   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;  <br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err  <br>   &#125;  <br>   e, err := casbin.NewEnforcer(<span class="hljs-string">&quot;config/rbac_model.conf&quot;</span>, Apter)  <br>   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;  <br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err  <br>   &#125;  <br>   <span class="hljs-keyword">if</span> err := e.LoadPolicy(); err == <span class="hljs-literal">nil</span> &#123;  <br>      <span class="hljs-keyword">return</span> e, err  <br>   &#125; <span class="hljs-keyword">else</span> &#123;  <br>      fmt.Printf(<span class="hljs-string">&quot;casbin rbac_model or policy init error, message: %v \r\n&quot;</span>, err.Error())  <br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err  <br>   &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，这里先通过gormAdapter新建出一个Adapter，该Adapter需要满足以下规范：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> CasbinRule <span class="hljs-keyword">struct</span> &#123;<br>ID    <span class="hljs-type">uint</span>   <span class="hljs-string">`gorm:&quot;primaryKey;autoIncrement&quot;`</span><br>Ptype <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>V0    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>V1    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>V2    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>V3    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>V4    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>V5    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;size:512;uniqueIndex:unique_index&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure><p>在这里我们将对应规则放在数据库casbin_rule中：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220517144842.png"></p><p>在这里可以看到，比如第一行，admin对&#x2F;api&#x2F;v1&#x2F;menulist有GET权限。</p><p>model.conf文件如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs conf">[request_definition]  <br>r = sub, obj, act  <br>  <br>[policy_definition]  <br>p = sub, obj, act  <br>  <br>[policy_effect]  <br>e = some(where (p.eft == allow))  <br>  <br>[matchers]  <br>m = r.sub == p.sub &amp;&amp; (keyMatch2(r.obj, p.obj) || keyMatch(r.obj, p.obj)) &amp;&amp; (r.act == p.act || p.act == &quot;*&quot;)<br></code></pre></td></tr></table></figure><h2 id="检查权限的代码："><a href="#检查权限的代码：" class="headerlink" title="检查权限的代码："></a>检查权限的代码：</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">res, err := e.Enforce(v[<span class="hljs-string">&quot;rolekey&quot;</span>], c.Request.URL.Path, c.Request.Method)<br></code></pre></td></tr></table></figure><p>可以看到，如果rolekey是admin，URL路径是&#x2F;api&#x2F;v1&#x2F;sysUser，Method是POST，我们可以看到是存在权限的，那么我们就判断权限通过</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/33b770698f6d.html"/>
    <url>/2022/12/33b770698f6d.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-SpringBoot和SpringCloud的版本选型"><a href="#1-SpringBoot和SpringCloud的版本选型" class="headerlink" title="1. SpringBoot和SpringCloud的版本选型"></a>1. SpringBoot和SpringCloud的版本选型</h1><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220109162414.png"></p><p>可以看到，对应版本有很高的要求，因此如果我需要使用最新的 <code>2021.0.x</code> 版本，那么 springboot 的版本就需要是 <code>2.6.x</code></p><p>更加具体的版本对应：<br><a href="https://start.spring.io/actuator/info">spring 版本对应关系</a></p><p>得到的是一个 json 串，进行解析后可以看到：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;git&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;branch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;af724b5c27a7317a2f111739cf810d9cb526c1e0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;commit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;af724b5&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-01-07T09:27:13Z&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0.1-SNAPSHOT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;artifact&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;start-site&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;versions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;spring-boot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.6.2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;initializr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.12.0-SNAPSHOT&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;start.spring.io website&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-01-07T09:28:11.771Z&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;io.spring.start&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;bom-ranges&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;azure&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;3.2.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.5.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0.M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.10.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0.M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;codecentric-spring-boot-admin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;2.4.3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.5.5&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0.M1 and &lt;2.6.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.6.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0.M1 and &lt;2.7.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;solace-spring-boot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;1.1.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;solace-spring-cloud&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;1.1.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.1.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0.M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;spring-cloud&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;Hoxton.SR12&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.2.0.RELEASE and &lt;2.4.0.M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2020.0.5&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0.M1 and &lt;2.6.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2021.0.0-M1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0-M1 and &lt;2.6.0-M3&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2021.0.0-M3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0-M3 and &lt;2.6.0-RC1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2021.0.0-RC1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0-RC1 and &lt;2.6.1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2021.0.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.1 and &lt;2.6.3-SNAPSHOT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2021.0.1-SNAPSHOT&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.3-SNAPSHOT and &lt;2.7.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;spring-cloud-gcp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;2.0.7&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0-M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;spring-cloud-services&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;2.3.0.RELEASE&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.RELEASE and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.4.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0-M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.3.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;spring-geode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;1.3.12.RELEASE&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;1.4.13&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0-M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;1.5.7&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1 and &lt;2.6.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;1.6.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0-M1 and &lt;2.7.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;vaadin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;14.8.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.1.0.RELEASE and &lt;2.8.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;wavefront&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;2.0.2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.1.0.RELEASE and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.1.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0-M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.2.2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1 and &lt;2.7.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;dependency-ranges&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;native&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;0.9.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.3 and &lt;2.4.4&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.9.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.4 and &lt;2.4.5&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.9.2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.5 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1 and &lt;2.5.2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.2 and &lt;2.5.3&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.3 and &lt;2.5.4&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.3&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.4 and &lt;2.5.5&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.5 and &lt;2.5.6&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.5&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.6 and &lt;2.5.9-SNAPSHOT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.10.6-SNAPSHOT&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.9-SNAPSHOT and &lt;2.6.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.11.0-M1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0-M1 and &lt;2.6.0-RC1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.11.0-M2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0-RC1 and &lt;2.6.0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.11.0-RC1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.6.1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.11.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.1 and &lt;2.6.2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.11.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.2 and &lt;2.6.3-SNAPSHOT&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;0.11.2-SNAPSHOT&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.3-SNAPSHOT and &lt;2.7.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;okta&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;1.4.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.2.0.RELEASE and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;1.5.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0-M1 and &lt;2.4.1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.0.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.1.4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;mybatis&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;2.1.4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.1.0.RELEASE and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;2.2.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;camel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;3.5.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.10.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0.M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.13.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0.M1 and &lt;2.6.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.14.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.6.0.M1 and &lt;2.7.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;picocli&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;4.6.2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0.RELEASE and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;open-service-broker&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;3.2.0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.3.0.M1 and &lt;2.4.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.3.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.4.0-M1 and &lt;2.5.0-M1&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;3.4.0-M2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Spring Boot &gt;=2.5.0-M1 and &lt;2.6.0-M1&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220109163342.png"></p><p>如果我要使用 springcloud 的 <code>2021.0.0</code> 版本，那么我的 springboot 版本需要在 2.6.1 版本到 2.6.3 版本之间。</p><p>那么我们直接上最新的稳定版</p><pre><code class=" mermaid">graph LRid1(Version Control)--&gt;id2(SpringCloud)--&gt;id7(2021.0.1)id1--&gt;id3(SpringBoot)--&gt;id8(2.6.1)id1--&gt;id4(SpringCloud Alibaba)--&gt;id9(2.1.0.RELEASE)id1--&gt;id5(Java)--&gt;id6(Java8)id1--&gt;id10(Maven)--&gt;id11(3.5及以上)id1--&gt;id12(Mysql)--&gt;id13(5.7及以上)</code></pre><h1 id="2-组件选型"><a href="#2-组件选型" class="headerlink" title="2. 组件选型"></a>2. 组件选型</h1><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20220109210943.png" width = "80%" /><p>可以看到，红色的是已经不更新的并且不维护了的组件，黄色的是可以使用的但是不是最好的组件，绿色的是最推荐使用的组件，也是我们本次学习的重点组件。</p><h1 id="3-新建工程"><a href="#3-新建工程" class="headerlink" title="3. 新建工程"></a>3. 新建工程</h1><h2 id="字符编码设置为UTF-8"><a href="#字符编码设置为UTF-8" class="headerlink" title="字符编码设置为UTF-8"></a>字符编码设置为UTF-8</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220109221457.png"></p><h2 id="配置注解生效"><a href="#配置注解生效" class="headerlink" title="配置注解生效"></a>配置注解生效</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220109221242.png"></p><h2 id="父工程pom-xml文件"><a href="#父工程pom-xml文件" class="headerlink" title="父工程pom.xml文件"></a>父工程pom.xml文件</h2><h3 id="dependencyManagement和dependencies的区别"><a href="#dependencyManagement和dependencies的区别" class="headerlink" title="dependencyManagement和dependencies的区别"></a>dependencyManagement和dependencies的区别</h3><p>使用<code>pom.xml</code>中的dependencyManagement元素能让所有在子项目中引用一个依赖而不用显式的列出版本号。Maven会沿着父子层次向上走，知道找到一个拥有dependencyManagement元素的项目，然后它就会使用这个dependencyManagement元素中指定的版本号。</p><ul><li>dependencyManagement里只是声名依赖，&#x3D;&#x3D;并不实现引入&#x3D;&#x3D;，因此子项目需要显式地声名需要的依赖（也就是需要在<code>&lt;dependencies&gt;</code>中引入<code>&lt;dependency&gt;</code>） </li><li>如果不在子项目中声明依赖，是不会从父项目中继承下来的；只有在子项目中写了该依赖项，并且没有指定具体版本，才会从父项目中继承该项，并且version和scope都读取自父pom</li><li>如果子项目中指定了版本号，那么会使用子项目中指定的jar版本</li></ul><p>最终的 pom 文件如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SpringCloud2021<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.coachhe.springcloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>cloud-provider-payment8001<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>cloud-consumer-order80<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>cloud-api-commons<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 统一管理jar包版本 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">lombok.version</span>&gt;</span>1.16.18<span class="hljs-tag">&lt;/<span class="hljs-name">lombok.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">druid.version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">druid.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.boot.version</span>&gt;</span>2.6.1<span class="hljs-tag">&lt;/<span class="hljs-name">spring.boot.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.version</span>&gt;</span>2021.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span>2021.1<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mybatis.spring.boot.version</span>&gt;</span>1.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">mybatis.spring.boot.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 子模块继承之后，提供作用：锁定版本+子modlue不用写groupId和version  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--spring boot 2.6.1--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--spring cloud 2021.0.0--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--spring cloud alibaba 2021.1--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.alibaba.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">fork</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">fork</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">addResources</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">addResources</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="构建Rest微服务工程"><a href="#构建Rest微服务工程" class="headerlink" title="构建Rest微服务工程"></a>构建Rest微服务工程</h2><p>在这里我们搭建的是一个微服务消费订单模块</p><h3 id="cloud-provider-payment8001"><a href="#cloud-provider-payment8001" class="headerlink" title="cloud-provider-payment8001"></a>cloud-provider-payment8001</h3><p>这是一个微服务提供者支付模块<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20220110000152.png" width = "50%" /><br>此时我们来观察一下父工程的pom文件：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20220110000302.png" width = "80%" /><p>可以看到，父工程下多了一个modules模块，里面的内容就是我们新建的子模块</p><p>建表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">MySQL [(none)]&gt; use cloudLearn;<br>Database changed<br>MySQL [cloudLearn]&gt; create table payment ( id bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ID&#x27;, serial varchar(200) DEFAULT &#x27;&#x27;, PRIMARY KEY(id) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="自动热部署"><a href="#自动热部署" class="headerlink" title="自动热部署"></a>自动热部署</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220113004057.png"></p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringCloud</category>
      
      <category>尚硅谷SpringCloud</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/03cb4f138856.html"/>
    <url>/2022/12/03cb4f138856.html</url>
    
    <content type="html"><![CDATA[<p>有了 <a href="https://coachhe.studio/11.html">Spring1-IOC容器启动创建bean - CoachHe-Blog</a> 的基础，我们现在更加深入地对整个 spring 的核心，也就是 bean 做更加深入的理解。</p><p>还是从</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span> (<span class="hljs-string">&quot;applicationContext.Xml&quot;</span>);<br></code></pre></td></tr></table></figure><p>这里开始 debug，进入的第一个方法就是 <code>ClassPathXmlApplicationContext()</code> 的构造器，其中最重要的是 <code>refresh()</code> 这个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ClassPathXmlApplicationContext</span><span class="hljs-params">(</span><br><span class="hljs-params">String[] configLocations, <span class="hljs-type">boolean</span> refresh, <span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span><br><span class="hljs-keyword">throws</span> BeansException &#123;<br><br><span class="hljs-built_in">super</span>(parent);<br>setConfigLocations(configLocations);<br><span class="hljs-keyword">if</span> (refresh) &#123;<br><span class="hljs-comment">// 最重要的一个方法</span><br>refresh();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>进入其中，一共有 13 个方法，每个方法都需要了解，我们一个个看：<br>首先第一个方法：</p><h2 id="1-prepareRefresh"><a href="#1-prepareRefresh" class="headerlink" title="1. prepareRefresh()"></a>1. prepareRefresh()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Prepare this context for refreshing.  </span><br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * 做容器刷新前的准备工作  </span><br><span class="hljs-comment"> * 1. 设置容器的启动时间  </span><br><span class="hljs-comment"> * 2. 设置活跃状态为true  </span><br><span class="hljs-comment"> * 3. 设置关闭状态为false  </span><br><span class="hljs-comment"> * 4. 获取Environment对象，并加载当前系统的属性值到Environment中  </span><br><span class="hljs-comment"> * 5. 准备监听和事件的集合对象，默认为空的集合  </span><br><span class="hljs-comment"> */</span>  <br>prepareRefresh();<br></code></pre></td></tr></table></figure><p>可以看到，这里是做一些容器刷新前的准备工作。</p><h2 id="2-ConfigurableListableBeanFactory-beanFactory-x3D-obtainFreshBeanFactory"><a href="#2-ConfigurableListableBeanFactory-beanFactory-x3D-obtainFreshBeanFactory" class="headerlink" title="2. ConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory ();"></a>2. ConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory ();</h2><p>接着是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Tell the subclass to refresh the internal bean factory.</span><br><span class="hljs-comment">// 解析 XML 配置文件，加载 xml 配置文件的属性值到当前工厂中，最重要的就是 BeanDefinition</span><br><span class="hljs-comment">// 在这里创建了一个beanFactory对象，用来装载具体后续的bean对象</span><br><span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> obtainFreshBeanFactory();<br></code></pre></td></tr></table></figure><p>这是个很重要的方法，他创建了一个 beanFactory 对象，后面创建的对象都会装进去。点击进入 <code>obtainFreshBeanFactory()</code> 方法之中，可以看到：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> ConfigurableListableBeanFactory <span class="hljs-title function_">obtainFreshBeanFactory</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">// 初始化BeanFactory，并进行XML文件读取，并将得到的BeanFactory记录在当前实体的属性中</span><br>refreshBeanFactory();<br><span class="hljs-comment">// 返回当前实体的beanFactory属性</span><br><span class="hljs-keyword">return</span> getBeanFactory();<br>&#125;<br></code></pre></td></tr></table></figure><p>也就是说，他先初始化 BeanFactory，进行了 XML 文件的读取，并且将得到的 BeanFactory 记录在当前实体的属性中，最终将 beanFactory 进行返回。具体的，再往里走，看到 <code>refreshBeanFactory()</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * 在AbstractRefreshableApplicationContext类中</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br><span class="hljs-comment">// 如果存在beanFactory，则销毁beanFactory</span><br><span class="hljs-keyword">if</span> (hasBeanFactory()) &#123;<br>destroyBeans();<br>closeBeanFactory();<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// 创建DefaultListableBeanFactory对象</span><br><span class="hljs-type">DefaultListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> createBeanFactory();<br><span class="hljs-comment">// 为了序列化指定id，可以从id反序列化到beanFactory对象</span><br>beanFactory.setSerializationId(getId());<br><span class="hljs-comment">// 定制beanFactory，设置相关属性，包括是否允许覆盖同名称的不同定义的对象以及循环依赖</span><br>customizeBeanFactory(beanFactory);<br><span class="hljs-comment">// 初始化documentReader，并进行XML文件读取以及解析，默认命名空间的解析，自定义标签的解析</span><br><span class="hljs-comment">// 注意，此时beanFactory中的属性beanDefinitionMap和beanDefinitionNames还是XML中的默认值，并不会去对应的配置文件中得到具体的属性值</span><br>loadBeanDefinitions(beanFactory);<br><span class="hljs-built_in">this</span>.beanFactory = beanFactory;<br>&#125;<br><span class="hljs-keyword">catch</span> (IOException ex) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextException</span>(<span class="hljs-string">&quot;I/O error parsing bean definition source for &quot;</span> + getDisplayName(), ex);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这里有一个需要注意的，也就是我们是在这里创建了 beanFactory，当第一次创建完成时，里面有两个属性：BeanDefinitionMap 和 BeanDefinitionNames，大小都为 0。但是当执行完 <code>customizeBeanFactory(beanFactory)</code> 这个方法之后，会被赋值。具体的可以看下面：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211203005125.png"><br>此时刚创建完 beanFactory，两个属性的 size 都为 0，但是我们继续往下执行两行，当执行完 <code>loadBeanDefinitions(beanFactory)</code> 之后：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211203005545.png"><br>可以看到，我们在 XML 中配置的文件内容都已经被加载到了 beanFactory 之中，其中 beanDefinitionMap 是一个 Map，key 是我们定义的 bean 名称，value 是 bean 的内容，例如类信息，范围，是否 abstract 等等。</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>值得注意的是，这里执行完之后，我们只是很单纯地解析完了 XML 文件，但是并没有对 XML 文件的内容进行进一步的解析，比如我们如果定义某个 bean 的 value 是 <code>$&#123;user.db&#125;</code>，这时在 beanDefinitionMap 中对应 bean 的 value 值就是 <code>$&#123;user.db&#125;</code>，而不会去另一个配置文件中将这部分信息解析出来。具体解析步骤我们在后面分析。</p><h2 id="3-prepareBeanFactory-beanFactory"><a href="#3-prepareBeanFactory-beanFactory" class="headerlink" title="3. prepareBeanFactory(beanFactory)"></a>3. prepareBeanFactory(beanFactory)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Prepare the bean factory for use in this context.</span><br><span class="hljs-comment">// beanFactory 的准备工作，对各种属性进行填充</span><br>prepareBeanFactory (beanFactory);<br></code></pre></td></tr></table></figure><h2 id="4-postProcessBeanFactory-beanFactory"><a href="#4-postProcessBeanFactory-beanFactory" class="headerlink" title="4. postProcessBeanFactory(beanFactory)"></a>4. postProcessBeanFactory(beanFactory)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Allows post-processing of the bean factory in context subclasses.  </span><br><span class="hljs-comment">// 子类覆盖方法做额外的处理，此处我们一般不做任何拓展工作，但是可以查看web中的代码，是有具体实现的  </span><br>postProcessBeanFactory(beanFactory);<br></code></pre></td></tr></table></figure><h2 id="5-invokeBeanFactoryPostProcessors-beanFactory"><a href="#5-invokeBeanFactoryPostProcessors-beanFactory" class="headerlink" title="5. invokeBeanFactoryPostProcessors (beanFactory);"></a>5. invokeBeanFactoryPostProcessors (beanFactory);</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Invoke factory processors registered as beans in the context.  </span><br><span class="hljs-comment">// 调用各种beanFactory处理器  </span><br>invokeBeanFactoryPostProcessors(beanFactory);<br></code></pre></td></tr></table></figure><p>这是个很重要的方法，他调用了各种 BeanFactory 的增强处理器。<br>对应一下 bean 的定义信息图：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211203130517.png" width="50%" /><p>对应的就是 BeanDefinition 到最终的 BeanDefinition 对象中的 BeanFactoryBeanPostProcessor 这一个环节。</p><p>这个环节有一个非常重要的作用，在上面执行完第二个方法 <code>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory ();</code> 后，我们得到了一个保留原始值的 BeanFactory，这个 BeanFactory 是保留从 XML 解析来的原始值的（例如 db 的 value 是 <code>$&#123;jdbc.db&#125;</code> ），这个原始值需要去更加具体的配置文件中读取，才会得到最终的具体值，这一步就是在这个方法中完成的。</p><h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>我们如果需要对 bean 有一些自定义的操作，可以在这一步来完成。只需要定义一个类继承 BeanFactoryPostProcessor 接口就可以。<br>例如我们定义了一个类 MyBFPP：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBFPP</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>System.out.println(<span class="hljs-string">&quot;Here is a post process bean factory&quot;</span>);<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>这个类继承了 BeanFactoryPostProcessor 接口，并且在执行接口的方法 <code>postProcessBeanFactory</code> 时打印了一行，我们在 XML 文件中配置好这个 bean：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.coachhe.spring.BeanFactoryPostProcessor.MyBFPP&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>然后不对 main 方法做任何改动，直接输出，可以看到：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211203131723.png"><br>在没有对 main 方法做任何改动的情况下，将刚才实现的方法中打印的数据打印了，这些方法就是在执行 <code>invokeBeanFactoryPostProcessors (beanFactory);</code> 这个方法时一起执行的。</p><h1 id="Bean-的生命周期"><a href="#Bean-的生命周期" class="headerlink" title="Bean 的生命周期"></a>Bean 的生命周期</h1><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211219173353.png" width = "100%" /><h1 id="BeanFactory-和-FactoryBean-的联系和区别"><a href="#BeanFactory-和-FactoryBean-的联系和区别" class="headerlink" title="BeanFactory 和 FactoryBean 的联系和区别"></a>BeanFactory 和 FactoryBean 的联系和区别</h1><h2 id="联系"><a href="#联系" class="headerlink" title="联系"></a>联系</h2><p>都是用来创建对象的</p><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>FactoryBean 在 BeanFactory 的基础上进行了拓展，例如增加了这些方法:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">isSingleton: 判断是否是单例对象<br>getObjectType: 获取对象类型<br>getObject: 用户可以按照自己任意的方式来创建对象<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>Spring源码解析-coachhe</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/062e48fbe44a.html"/>
    <url>/2022/12/062e48fbe44a.html</url>
    
    <content type="html"><![CDATA[<h1 id="什么是循环依赖"><a href="#什么是循环依赖" class="headerlink" title="什么是循环依赖"></a>什么是循环依赖</h1><p>循环依赖简图：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211221011419.png" width = "50%" /><p>通俗易懂来说，循环依赖就是 A 对象包含 b 属性，B 对象包含 a 属性，对 b 属性进行赋值依赖于 B 对象的实例化和初始化，对 a 属性进行赋值依赖于 A 对象的实例化和初始化。<br>假设最开始先创建 A 对象，那么对 b 属性的赋值需要创建 B 对象，创建 B 对象时需要对 a 属性赋值，又需要创建 A 对象，这就导致了一个死循环。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>Spring源码解析-coachhe</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/815be8edc723.html"/>
    <url>/2022/12/815be8edc723.html</url>
    
    <content type="html"><![CDATA[<h2 id="角色创建"><a href="#角色创建" class="headerlink" title="角色创建"></a>角色创建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/role&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTUyNTUzNzIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTE2ODk3Miwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.CCKTOq43Dq0m6T7OCe6L0wE-NhjmX-w86yQEUmJfS74&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  --data-raw &#x27;&#123;&quot;roleName&quot;:&quot;测试工单&quot;,&quot;roleKey&quot;:&quot;aaaaa&quot;,&quot;roleSort&quot;:0,&quot;status&quot;:&quot;0&quot;,&quot;menuIds&quot;:[329,361,268],&quot;deptIds&quot;:[],&quot;remark&quot;:&quot;角色备注&quot;&#125;&#x27;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/d96d81d48d77.html"/>
    <url>/2022/12/d96d81d48d77.html</url>
    
    <content type="html"><![CDATA[<h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://9.135.11.161:60780/api/v1/sysUser&#x27; \<br>  -H &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NTUyNTUzNzIsImlkZW50aXR5IjoxLCJuaWNlIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY1NTE2ODk3Miwicm9sZWlkIjoxLCJyb2xla2V5IjoiYWRtaW4iLCJyb2xlbmFtZSI6Iuezu-e7n-euoeeQhuWRmCJ9.CCKTOq43Dq0m6T7OCe6L0wE-NhjmX-w86yQEUmJfS74&#x27; \<br>  -H &#x27;Content-Type: application/json&#x27; \<br>  --data-raw &#x27;&#123;&quot;deptId&quot;:1,&quot;username&quot;:&quot;test_user_mingcheng&quot;,&quot;nickName&quot;:&quot;test_user_nicheng&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;phone&quot;:&quot;13823282927&quot;,&quot;email&quot;:&quot;a@qq.com&quot;,&quot;status&quot;:&quot;0&quot;,&quot;remark&quot;:&quot;用户备注&quot;,&quot;roleId&quot;:1,&quot;postId&quot;:1&#125;&#x27; \<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/5db48ab00e87.html"/>
    <url>/2022/12/5db48ab00e87.html</url>
    
    <content type="html"><![CDATA[<h1 id="1、创建一个工程，导入-spring-parent"><a href="#1、创建一个工程，导入-spring-parent" class="headerlink" title="1、创建一个工程，导入 spring parent"></a>1、创建一个工程，导入 spring parent</h1><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211223003722.png" width = "100%" /><p>可以看到，第一步我们先创建了一个 springboot-helloworld 项目（上面的 mysql-to-cos 是我之前创建的父工程，可以直接忽略）<br>接着就在 <code>pom.xml</code> 中导入了 parent 标签，内容为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--    第一步 导入parent   --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>此为固定写法。</p><h1 id="2、导入-springboot-starter-web-场景启动器"><a href="#2、导入-springboot-starter-web-场景启动器" class="headerlink" title="2、导入 springboot-starter-web 场景启动器"></a>2、导入 springboot-starter-web 场景启动器</h1><p>接下来我们导入 web 场景的开发器，需要在 <code>pom.xml</code> 中添加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--    第2步 导入web场景启动器 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    &lt;/dependencies<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211223004328.png" width = "100%" /><p>在图中可以看到，导入 web 场景启动器之后，web 相关的 maven 依赖就全部被导入进来了。</p><h1 id="3、创建-Main-方法"><a href="#3、创建-Main-方法" class="headerlink" title="3、创建 Main 方法"></a>3、创建 Main 方法</h1><p>接下来可以直接进行代码的开发了，首先创建 main 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.boot;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;  <br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@SpringBootApplication</span>: 这是一个SpringBoot应用  </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-meta">@SpringBootApplication</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        SpringApplication.run(Main.class, args);  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>没错，就是这么简单，用一个 <code>@SpringBootApplication</code> 注解表示这是一个 SpringBoot 应用，然后固定格式，在 main 方法里面写上 <code>SpringApplication.run(Main.class, args); </code> 就可以了。然后就可以进行 controller 层的开发了！</p><h1 id="4、写-controller-层代码"><a href="#4、写-controller-层代码" class="headerlink" title="4、写 controller 层代码"></a>4、写 controller 层代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.boot.controller;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;  <br>  <br><span class="hljs-meta">@Controller</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;  <br>  <br>    <span class="hljs-meta">@ResponseBody</span>  <br>    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handle01</span><span class="hljs-params">()</span>&#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello Spring Boot&quot;</span>;  <br>    &#125;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>没错，在上面标记了一下 <code>@Controller</code> 就可以了。</p><h2 id="几个注解的含义"><a href="#几个注解的含义" class="headerlink" title="几个注解的含义"></a>几个注解的含义</h2><ul><li>RequestMapping<br>这个注解大家应该都很熟悉了，就是请求服务器的地址所在，我们会根据 <code>ip:端口/hello</code> 的方式来访问 handle01 方法</li><li>ResponseBody<br>这个注解表示这个方法返回的类型会被以字符串的方式返回给浏览器</li><li>Controller<br>这个大家应该更熟悉了，代表这是 Controller 层的类。</li></ul><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>在这里，可以将 <code>@ResponseBody</code> 写在 HelloController 类的上面，也就是 <code>@Controller</code> 下方，代表这个类中的所有方法都以字符串的方式进行返回。<br>尤其值得注意的是，<code>@ResponseBody</code> + <code>@Controller</code> &#x3D; <code>@RestController</code>，可以直接用这个注解代替，变为：</p><h1 id="5、运行"><a href="#5、运行" class="headerlink" title="5、运行"></a>5、运行</h1><p>什么？？这就运行了，看到这里很多同学可能很震惊，因为在使用传统的 SpringMVC 时，还需要安装 tomcat，还需要写 web. xml，还有一堆配置文件，但是的确，这就是 SpringBoot 的牛逼之处，可以直接运行了！</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211223010303.png"></p><p>看到了吗，运行结果就是输出了我们在 handle01 方法中返回的”Hello Spring Boot”！</p><h1 id="6、打包"><a href="#6、打包" class="headerlink" title="6、打包"></a>6、打包</h1><p>当然，一个程序不可能一直通过 IDEA 来运行，还需要打包到服务器上进行运行，那么在传统的 SpringMVC 中，我们必须得将程序打包成一个 war 包，然后在服务器上安装 tomcat ，在 tomcat 上运行，但是 SpringBoot 可以直接将程序打包成一个可执行的 jar 包。只需要在 <code>pom.xml</code> 中加上对应的插件配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--      这个插件安装之后，将可以程序打包成jar包       --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211223011239.png"></p><p>可以看到，我们首先 clean 这个项目，然后打包（package），接着在 target 中就会出现对应的 jar 包，我们将 jar 包在服务器上进行执行：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211223011630.png"></p><p>可以看到，我们在服务器上执行了对应的 jar 包，然后进行访问，也是可以得到对应的结果的！</p><h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h2><p>如果是 windows 系统，用 cmd 命令执行 jar 包，那么一定要取消 cmd 的快速编辑模式，超级强烈推荐新上的 jetbrains 全家桶中的新软件 jetbrains gateway，可以远程服务器上进行开发，非常非常方便！</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringBoot</category>
      
      <category>尚硅谷Springboot</category>
      
      <category>SpringBoot1-基础入门</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/71ad7679cec1.html"/>
    <url>/2022/12/71ad7679cec1.html</url>
    
    <content type="html"><![CDATA[<h1 id="了解自动配置原理"><a href="#了解自动配置原理" class="headerlink" title="了解自动配置原理"></a>了解自动配置原理</h1><h2 id="1-SpringBoot-特点"><a href="#1-SpringBoot-特点" class="headerlink" title="1. SpringBoot 特点"></a>1. SpringBoot 特点</h2><h3 id="1-1-依赖管理"><a href="#1-1-依赖管理" class="headerlink" title="1.1 依赖管理"></a>1.1 依赖管理</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>可以看到，在父项目中引入了版本号之后，子项目中就无需再次声明版本号了。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211224010449.png" width = "70%" /><p>在父任务中几乎声明了所有开发中常用的依赖版本</p><ul><li>开发导入 starter 场景启动器</li><li>无需导入版本号，自动版本仲裁</li><li>可以修改版本号</li></ul><p>修改版本号的步骤：</p><ol><li>查看 spring-boot-dependencies 里面对顶的当前依赖的版本，这不刚好结合时事给大家分析一下，我们在日志里常用的 log4j，之前爆出了大 bug，需要我们对版本进行更新，那我们先看到，自动导入的 log4j 版本为 4.12.1，这个版本是很危险的！<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211224011912.png"></li></ol><p>那么我们怎么进行版本的修改呢？</p><ol start="2"><li>在当前项目里面重写配置<br>为了进行版本的修改，我们需要修改 log4j 的配置，官方声明将 log4j 升级到 2.17.0 之后就是安全的，我们只需要在 properties 中对版本进行修改，这个版本会自动覆盖父类的版本。</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">log4j2.version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">log4j2.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure><p>添加之后重新刷新配置，可以看到所有 log4j 的版本全都更改了。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224114418.png"></p><p>看到了吗，Springboot 管理依赖版本就是这么简单！</p><p>我们先看 parent 模块：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>他的父项目为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在父项目中，几乎声明了所有开发中常用的依赖版本号</p><h4 id="Springboot-starter"><a href="#Springboot-starter" class="headerlink" title="Springboot-starter"></a>Springboot-starter</h4><ul><li>我们见到过很多的 Springboot-starter，每个 starter 都代表一个对应的开发场景。</li><li>只要引入 starter，这个场景的所有常规需要的依赖我们都会自动引入<br>  例如我们这里：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>会自动将所有 web 开发常规需要的依赖自动导入<br>包括 spring-webmvc、spring-web、spring-boot-starter、spring-boot-starter-tomcat、spring-boot-starter-json。<br>这里特别关注一下 <code>spring-boot-starter</code>，这是最底层的依赖，也是 springboot 自动配置的核心依赖。</li><li>Springboot-starter 一般都是官方提供的 starter，我们之后如果见到 <code>*-spring-boot-starter</code> 一般都是第三方为我们提供的简化开发的场景启动</li></ul><h3 id="1-2-自动配置"><a href="#1-2-自动配置" class="headerlink" title="1.2 自动配置"></a>1.2 自动配置</h3><p>以 <code>spring-boot-web-starter</code> 为例</p><ul><li>自动配置好 SpringMVC<ul><li>引入 SPringMVC 全套组件</li><li>自动配好 SpringMVC 常用组件（功能）</li></ul></li><li>自动配好 Web 常用功能，如字符编码功能<ul><li>SpringBoot 帮我们配置好了所有 web 开发的常见场景</li></ul></li></ul><p>具体来看一下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.boot;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;  <br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;  <br><span class="hljs-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@SpringBootApplication</span>: 这是一个SpringBoot应用  </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-meta">@SpringBootApplication</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>  <br>        <span class="hljs-comment">// 1.返回我们的IOC容器  </span><br> <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(Main.class, args);  <br>  <br> <span class="hljs-comment">// 2. 查看容器里的组件  </span><br> String[] beanDefinitionNames = run.getBeanDefinitionNames();  <br>        <span class="hljs-keyword">for</span> (String name : beanDefinitionNames) &#123;  <br>            System.out.println(name);  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>在上面的程序中，我们执行了一个 SpringBoot 项目之后返回了 IOC 容器，然后通过 <code>getBeanDefinitionNames()</code> 来查看容器里的组件。</p><p>结果：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211227004823.png" width = "100%" />这是一个做字符编码的组件，已经自动创建了。<p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211227005102.png"></p><p>这是一个做文件上传的组件，已经自动创建了。</p><h4 id="默认的包结构"><a href="#默认的包结构" class="headerlink" title="默认的包结构"></a>默认的包结构</h4><ul><li>SpringBoot 默认扫描<strong>主程序所在包以及下面所有子包</strong>里面的组件都会被默认扫描出来。</li><li>无需配置以前的包扫描</li><li>若一定需要扫描其他包下的组件，那么需要在 <code>SpringBootApplication</code> 里配置 <code>scanBasePackage=&quot;com.coachhe.springboot&quot;</code>。或者直接在 Main 上面配置 <code>ComponentScan(&quot;com.coachhe.springboot&quot;)</code>。</li></ul>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringBoot</category>
      
      <category>尚硅谷Springboot</category>
      
      <category>SpringBoot1-基础入门</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/ee226c467de4.html"/>
    <url>/2022/12/ee226c467de4.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、SpringBoot-介绍"><a href="#一、SpringBoot-介绍" class="headerlink" title="一、SpringBoot 介绍"></a>一、SpringBoot 介绍</h1><h2 id="1、SpringBoot-优点"><a href="#1、SpringBoot-优点" class="headerlink" title="1、SpringBoot 优点"></a>1、SpringBoot 优点</h2><ul><li>Create stand-alone Spring applications<ul><li>创建独立 Spring 应用</li></ul></li><li>Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files)<ul><li>内嵌 web 服务器：也就是说，避免了还需要单独安装 Tomcat 服务器等复杂操作，Springboot 直接内嵌好了</li></ul></li><li>Provide opinionated ‘starter’ dependencies to simplify your build configuration<ul><li>自动 starter 依赖，简化构建配置：例如之前开发一个 Web 项目时，需要写大量 SpringMVC、webxml、mybatis 等很多配置，使用 SpringBoot 之后可以直接用一个 starter 配置好所有的依赖。</li></ul></li><li>Automatically configure Spring and 3rd party libraries whenever possible<ul><li>自动配置 Spring 以及第三方功能</li></ul></li><li>Provide production-ready features such as metrics, health checks, and externalized configuration<ul><li>提供生产级别的监控、健康检查及外部化配置</li></ul></li><li>Absolutely no code generation and no requirement for XML configuration<ul><li>无代码生成、无需编写 XML</li></ul></li></ul><h2 id="2、SpringBoot-缺点"><a href="#2、SpringBoot-缺点" class="headerlink" title="2、SpringBoot 缺点"></a>2、SpringBoot 缺点</h2><ul><li>人称版本帝，迭代快，需要时刻关注变化 (但是这恰恰说明受到欢迎)</li><li>封装太深，内部原理复杂，不容易精通：也就是说，SpringBoot 底层是 Spring，需要对 Spring 有着较为深入的理解。</li></ul><h1 id="二、微服务和分布式"><a href="#二、微服务和分布式" class="headerlink" title="二、微服务和分布式"></a>二、微服务和分布式</h1><h2 id="1、什么是微服务"><a href="#1、什么是微服务" class="headerlink" title="1、什么是微服务"></a>1、什么是微服务</h2><ul><li>微服务是一种架构风格</li><li>一个应用拆分为一组小型服务</li><li>每个服务运行在自己的进程内，也就是可独立部署和升级</li><li>服务之间使用轻量级 HTTP 交互</li><li>服务围绕业务功能拆分</li><li>可以由全自动部署机制独立部署</li><li>去中心化，服务自治。服务可以使用不同的语言、不同的存储技术</li></ul><h2 id="2、分布式"><a href="#2、分布式" class="headerlink" title="2、分布式"></a>2、分布式</h2><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/20211222005048.png" width = "100%" /><p>可以看到，每一列代表一个微服务，由于每个服务所需要的资源不同，因此某个服务有可能分布在单个节点上（最左边的节点），也有可能分布在多个节点上（例如第二列）。</p><p>但是从用户的角度来说，既然是访问同一个服务，那么无论访问哪个节点，都应该得到相同的访问结果，例如淘宝的购买信息微服务可能部署在很多个节点上，但是无论从哪个节点访问，都应该得到相同的购买信息（不然可能出现你在北京查看价格是 A，但是在广州查看价格是 B 的情况，那就乱套了）。</p><p>因此，同一个服务之间如何保持消息的一致性就很值得考虑了，在 SpringBoot 中给出了解决方案，</p><p>总结一下，分布式目前存在着这些问题：</p><ul><li>远程调用</li><li>服务发现</li><li>负载均衡</li><li>服务容错</li><li>配置管理</li><li>服务监控</li><li>链路追踪</li><li>日志管理</li><li>任务调度</li></ul><h2 id="SpringBoot-的解决方案"><a href="#SpringBoot-的解决方案" class="headerlink" title="SpringBoot 的解决方案"></a>SpringBoot 的解决方案</h2><p>Spring 利用 SpringBoot+SpringCloud 来解决分布式的问题。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringBoot</category>
      
      <category>尚硅谷Springboot</category>
      
      <category>SpringBoot1-基础入门</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/0245f92a2f6d.html"/>
    <url>/2022/12/0245f92a2f6d.html</url>
    
    <content type="html"><![CDATA[<h1 id="Spring-的结构组成"><a href="#Spring-的结构组成" class="headerlink" title="Spring 的结构组成"></a>Spring 的结构组成</h1><h2 id="1-核心类介绍"><a href="#1-核心类介绍" class="headerlink" title="1. 核心类介绍"></a>1. 核心类介绍</h2><h3 id="1-1-DefaultListableBeanFactory"><a href="#1-1-DefaultListableBeanFactory" class="headerlink" title="1.1 DefaultListableBeanFactory"></a>1.1 DefaultListableBeanFactory</h3><p>DefaultListableBeanFactory 是整个 bean 加载的核心部分。<br><strong>作用</strong>： 是 Spring 注册及加载 bean 的默认实现。<br>来看下 DefaultListableBeanFactory 的层次结构图（提示，打开层次结构图的方式是 IDEA -&gt; Navigate -&gt; Type Hierarchy）</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211128183849.png" width = "50%" /><h2 id="容器的基础-XmlBeanFactory"><a href="#容器的基础-XmlBeanFactory" class="headerlink" title="容器的基础 XmlBeanFactory"></a>容器的基础 XmlBeanFactory</h2><p>首先来看最基本的 spring 代码：</p><p>结构：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211125130810.png"></p><p>Bean：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com. coachhe. spring. Bean;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestBean</span> &#123;<br>String testStr;<br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTestStr</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> testStr;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTestStr</span><span class="hljs-params">(String testStr)</span> &#123;<br><span class="hljs-built_in">this</span>.testStr = testStr;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>applicationContext.xml：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>   xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>   xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span><br><span class="hljs-string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;<br>&lt;bean id=<span class="hljs-string">&quot;pet1&quot;</span> class=<span class="hljs-string">&quot;com.coachhe.spring.Bean.MyTestBean&quot;</span>&gt;<br>&lt;property name=<span class="hljs-string">&quot;testStr&quot;</span> value=<span class="hljs-string">&quot;pet1&quot;</span>/&gt;<br>&lt;/bean&gt;<br>&lt;/beans&gt;<br>`` `<br><br>Main：<br>```java<br><span class="hljs-keyword">package</span> com.coachhe.spring;<br><br><br><span class="hljs-keyword">import</span> com.coachhe.spring.Bean.MyTestBean;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.BeanFactory;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.xml.XmlBeanFactory;<br><span class="hljs-keyword">import</span> org.springframework.core.io.ClassPathResource;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="hljs-type">BeanFactory</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XmlBeanFactory</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>));<br><br><span class="hljs-type">MyTestBean</span> <span class="hljs-variable">pet</span> <span class="hljs-operator">=</span> (MyTestBean) context.getBean(<span class="hljs-string">&quot;pet1&quot;</span>);<br><br>System.out.println(pet.getTestStr());<br><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>运行结果：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211125132205.png"></p><p>可以看到，在没有<code>new MyTestBean()</code>的情况下，也将属性值输出了。</p><p>因为XmlBeanFactory已经被废弃了，所以在这里我们换一种方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="hljs-comment">//BeanFactory context = new XmlBeanFactory(new ClassPathResource(&quot;applicationContext.xml&quot;));</span><br><span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br><span class="hljs-type">BeanFactory</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultListableBeanFactory</span>();<br><span class="hljs-type">BeanDefinitionReader</span> <span class="hljs-variable">bdr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XmlBeanDefinitionReader</span>((BeanDefinitionRegistry) context);<br>bdr.loadBeanDefinitions(resource);<br><span class="hljs-type">MyTestBean</span> <span class="hljs-variable">pet</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">&quot;pet1&quot;</span>, MyTestBean.class);<br>System.out.println(pet.getTestStr());<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>输出的结果是这样的：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/springMain.png"></p><p>通过上面的例子我们可以看到，第一行为</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br></code></pre></td></tr></table></figure><p>可以看到，Spring的配置文件读取是通过ClassPathResource进行封装的。</p><p>那么ClassPathResource完成了什么功能呢？</p><h2 id="ClassPathResource"><a href="#ClassPathResource" class="headerlink" title="ClassPathResource"></a>ClassPathResource</h2>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>《Spring源码深度解析》</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/869e3eb944e9.html"/>
    <url>/2022/12/869e3eb944e9.html</url>
    
    <content type="html"><![CDATA[<h1 id="什么是-AOP"><a href="#什么是-AOP" class="headerlink" title="什么是 AOP"></a>什么是 AOP</h1><ol><li>面向切面编程<br>利用 AOP 可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提供程序的可重用性，同时提高了开发的效率</li></ol><h1 id="AOP-底层原理"><a href="#AOP-底层原理" class="headerlink" title="AOP 底层原理"></a>AOP 底层原理</h1><ol><li>AOP 底层使用动态代理<ol><li>有两种情况的动态代理<ol><li>有接口情况，使用 JDK 动态代理<br> <img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211201094229.png"></li><li>没有接口情况，使用 CJLIB 动态代理<br> 创建子类的代理对象，增强类的方法</li></ol></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>《Spring源码深度解析》</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/25e3d654cf90.html"/>
    <url>/2022/12/25e3d654cf90.html</url>
    
    <content type="html"><![CDATA[<h1 id="Configuration-详解"><a href="#Configuration-详解" class="headerlink" title="@Configuration 详解"></a>@Configuration 详解</h1><h1 id="Import-注解"><a href="#Import-注解" class="headerlink" title="@Import 注解"></a>@Import 注解</h1>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringBoot</category>
      
      <category>尚硅谷Springboot</category>
      
      <category>SpringBoot2-底层注解</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/54ea138fe60f.html"/>
    <url>/2022/12/54ea138fe60f.html</url>
    
    <content type="html"><![CDATA[<h1 id="一-引导加载自动配置类"><a href="#一-引导加载自动配置类" class="headerlink" title="一 引导加载自动配置类"></a>一 引导加载自动配置类</h1><p>最重要的一个注解：<code>@SpringBootApplication</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="hljs-meta">@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication &#123;<br></code></pre></td></tr></table></figure><p>可以看到，这是一个组合注解，将其逐个进行分析。</p><h2 id="1-SpringBootConfiguration"><a href="#1-SpringBootConfiguration" class="headerlink" title="1. @SpringBootConfiguration"></a>1. @SpringBootConfiguration</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，这其实就表明这就是一个配置类。没什么好说的</p><h2 id="2-EnableAutoConfiguration"><a href="#2-EnableAutoConfiguration" class="headerlink" title="2 @EnableAutoConfiguration"></a>2 @EnableAutoConfiguration</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import(AutoConfigurationImportSelector.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，这还是一个组合注解。</p><h3 id="1-1-AutoConfigurationPackage"><a href="#1-1-AutoConfigurationPackage" class="headerlink" title="1.1 @AutoConfigurationPackage"></a>1.1 @AutoConfigurationPackage</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import(AutoConfigurationPackages.Registrar.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>看到这里导入了一个组件：<code>AutoConfigurationPackages.Registar.class</code></p><p>点进去，可以看到：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Registrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImportBeanDefinitionRegistrar</span>, DeterminableImports &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;<br>      register(registry, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageImport</span>(metadata).getPackageName());<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title function_">determineImports</span><span class="hljs-params">(AnnotationMetadata metadata)</span> &#123;<br>      <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageImport</span>(metadata));<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringBoot</category>
      
      <category>尚硅谷Springboot</category>
      
      <category>SpringBoot3-自动配置</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/49662bc4dbed.html"/>
    <url>/2022/12/49662bc4dbed.html</url>
    
    <content type="html"><![CDATA[<h1 id="环境和工具准备"><a href="#环境和工具准备" class="headerlink" title="环境和工具准备"></a>环境和工具准备</h1><h2 id="虚拟机环境准备"><a href="#虚拟机环境准备" class="headerlink" title="虚拟机环境准备"></a>虚拟机环境准备</h2><p>准备三台虚拟机 </p><p>关闭防火墙等步骤和之前一样 </p><h2 id="集群分发脚本scp"><a href="#集群分发脚本scp" class="headerlink" title="集群分发脚本scp"></a>集群分发脚本scp</h2><h3 id="scp功能"><a href="#scp功能" class="headerlink" title="scp功能"></a>scp功能</h3><p>scp可以实现服务器与服务器之间的数据拷贝（from server1 to server2） </p><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r $pdir/$fname  $user@hadoop$host:$pdir/$fname <br></code></pre></td></tr></table></figure><h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210194648.png"></p><h3 id="三种用法："><a href="#三种用法：" class="headerlink" title="三种用法："></a>三种用法：</h3><ol><li>本机数据拷贝到别的服务器 </li><li>从别的服务器将数据拷贝到本机 </li><li>将某台非本机的服务器的数据拷贝到另一台主机</li></ol><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><p>在hadoop100上，将hadoop100中&#x2F;home&#x2F;hadoop_learning目录下的软件拷贝到hadoop102上。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r hadoop_learning/ root@hadoop101:/home/hadoop_learning <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210194735.png" style="zoom: 67%;" /><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210194820.png" style="zoom:80%;" /><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210194842.png" style="zoom:80%;" /><h3 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h3><p>在hadoop102上从hadoop100处拉取&#x2F;home&#x2F;hadoop_learning下的数据 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo scp -r coachhe@hadoop100:/home/hadoop_learning /home/hadoop_learning <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210194924.png" style="zoom:67%;" /><h2 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210154825.png" style="zoom:80%;" /><h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210154916.png" style="zoom:80%;" /><h1 id="案例3"><a href="#案例3" class="headerlink" title="案例3"></a>案例3</h1><p>在hadoop101上将hadoop100的数据拷贝到hadoop102 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r coachhe@hadoop100:/home/hadoop_learning root@hadoop102:/home/hadoop_learning2 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210154931.png" style="zoom:80%;" /><h2 id="远程同步工具rsync"><a href="#远程同步工具rsync" class="headerlink" title="远程同步工具rsync"></a>远程同步工具rsync</h2><h3 id="rsync和scp的区别"><a href="#rsync和scp的区别" class="headerlink" title="rsync和scp的区别"></a>rsync和scp的区别</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>rsync主要用于备份和镜像。具有速度快，避免复制相同内容和支持符号链接的优点。</p><h4 id="和scp的区别"><a href="#和scp的区别" class="headerlink" title="和scp的区别"></a>和scp的区别</h4><p>用rsync做文件的复制要比scp速度快，rsync只对差异文件做更新，scp是把所有文件都复制过去。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rsync -rvl $pdir/$fname $user@hadoop$host:$host:$pdir/$fname<br></code></pre></td></tr></table></figure><h3 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h3><table><thead><tr><th>选项</th><th>功能</th></tr></thead><tbody><tr><td>-r</td><td>递归</td></tr><tr><td>-v</td><td>显示复制过程</td></tr><tr><td>-l</td><td>拷贝符号连接</td></tr></tbody></table><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>将hadoop100机器上的&#x2F;home&#x2F;newdisk目录同步到hadoop101服务器root目录下的&#x2F;home&#x2F;newdisk下。 </p><h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo rsync -rvl /home/newdisk/ root@hadoop101:/home/newdisk <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210154955.png" style="zoom:80%;" /><h2 id="编写集群分发脚本xsync"><a href="#编写集群分发脚本xsync" class="headerlink" title="编写集群分发脚本xsync"></a>编写集群分发脚本xsync</h2><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">1 获取输入参数个数，如果没有参数则直接退出</span> <br>pcount=$# <br><br>if((pcount==0)); then <br>    echo no args; <br>    exit; <br>fi <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2 获取文件名称</span> <br>p1=$1 <br>fname=`basename $p1` #这里就是拿到最终文件的名称，/opt/module就是module <br>echo fname=$fname <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3 获取上级目录到绝对路径</span> <br>pdir=`cd -P $(dirname $p1); pwd` #这里是得到文件的路径 <br>echo pdir=$pdir <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4 获取当前用户名称</span> <br>user=`whoami`  #也就是coachhe <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">5 循环</span> <br>for((host=101;host&lt;103;host++)); do <br>    echo -------- hadoop$host --------- <br>    rsync -rvl $pdir/$fname root@hadoop$host:$pdir <br>done <br></code></pre></td></tr></table></figure><h3 id="脚本执行"><a href="#脚本执行" class="headerlink" title="脚本执行"></a>脚本执行</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155018.png" style="zoom:80%;" /><h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155031.png" style="zoom:80%;" /><h3 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h3><p>将这个脚本放在coachhe的bin目录下。方便以后查看和执行<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155057.png" style="zoom:80%;" /></p><h3 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h3><p>因为&#x2F;home&#x2F;coachhe&#x2F;bin的是在全局PATH中的，因此可以在任意位置直接执行xsync这个脚本 </p><h1 id="集群配置和启动"><a href="#集群配置和启动" class="headerlink" title="集群配置和启动"></a>集群配置和启动</h1><h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><h3 id="1-大纲"><a href="#1-大纲" class="headerlink" title="1 大纲"></a>1 大纲</h3><table><thead><tr><th></th><th>hadoop100</th><th>hadoop101</th><th>hadoop102</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode <br> DataNode</td><td>DataNode</td><td>SecondaryNameNode <br> DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager <br> NodeManager</td><td>NodeManager</td></tr></tbody></table><h4 id="解释-1"><a href="#解释-1" class="headerlink" title="解释"></a>解释</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155147.png"></p><h3 id="2-核心配置文件"><a href="#2-核心配置文件" class="headerlink" title="2 核心配置文件"></a>2 核心配置文件</h3><ol><li>配置core-site.xml，指定HDFS中的NameNode的地址为hadoop100<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155208.png"></li><li>配置hadoop-env.sh，设置JAVA_HOME<br>这一步之前就做过，就是将JAVA_HOME设置为本机jdk </li><li>配置hdfs-site.xml，将备份数设置为3（默认值），并且指定Hadoop辅助名称节点主机配置<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155227.png"></li></ol><h3 id="3-YARN配置文件"><a href="#3-YARN配置文件" class="headerlink" title="3 YARN配置文件"></a>3 YARN配置文件</h3><ol><li><p>yarn-env.sh配置JAVA_HOME<br>已经配置过了。 </p></li><li><p>yarn-site.xml添加Reducer获取数据的方式和ResourceManager的地址<br>在这里指定为resourmanager为hadoop101（根据大纲）   </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Site specific YARN configuration properties --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>mapreduce_shuffle<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>clinux02<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="4-MapReduce配置文件"><a href="#4-MapReduce配置文件" class="headerlink" title="4 MapReduce配置文件"></a>4 MapReduce配置文件</h3><ol><li><p>配置mapred-senv.sh的JAVA_HOME<br>已经配置过了 </p></li><li><p>配置mapred-site.xml，增加指定MR运行在YARN上的配置   </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>mapreduce.framework.name<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>yarn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="2-集群单点启动"><a href="#2-集群单点启动" class="headerlink" title="2 集群单点启动"></a>2 集群单点启动</h2><ol><li>格式化namenode<br>注意：格式化之前需要删除logs和data </li><li>启动所有节点的namenode和datanode<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155338.png"><br>注意：<br>hadoop101和hadoop102的Namenode不用启动<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155347.png"><br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155400.png"></li></ol><h2 id="3-SSH无密登录配置"><a href="#3-SSH无密登录配置" class="headerlink" title="3 SSH无密登录配置"></a>3 SSH无密登录配置</h2><h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><p>如果节点增加到1000个，那么不可能给一个个启动，怎么办呢？ </p><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>ssh可以直接访问其他服务器 </p><h3 id="免密登录原理"><a href="#免密登录原理" class="headerlink" title="免密登录原理"></a>免密登录原理</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210201558.png" style="zoom:50%;" /><h3 id="生成公钥和私钥"><a href="#生成公钥和私钥" class="headerlink" title="生成公钥和私钥"></a>生成公钥和私钥</h3><p>在.ssh目录下执行 </p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ssh-keygen -t rsa</span> <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155445.png" style="zoom: 67%;" /><h3 id="将公钥复制到其他服务器"><a href="#将公钥复制到其他服务器" class="headerlink" title="将公钥复制到其他服务器"></a>将公钥复制到其他服务器</h3><h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-copy-id hadoop101 <br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155503.png" style="zoom:67%;" /><h4 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h4><p>本机也需要拷贝！！ </p><h3 id="需要配置-ssh的具体服务器"><a href="#需要配置-ssh的具体服务器" class="headerlink" title="需要配置.ssh的具体服务器"></a>需要配置.ssh的具体服务器</h3><h4 id="1-配置hadoop100"><a href="#1-配置hadoop100" class="headerlink" title="1. 配置hadoop100"></a>1. 配置hadoop100</h4><h5 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h5><p>hadoop100上有NodeManager，用来控制不同节点的任务，因此需要配置hadoop100的.ssh，从而能控制其他节点。 </p><h4 id="2-配置hadoop101"><a href="#2-配置hadoop101" class="headerlink" title="2. 配置hadoop101"></a>2. 配置hadoop101</h4><h5 id="原因：-1"><a href="#原因：-1" class="headerlink" title="原因："></a>原因：</h5><p>hadoop101上有YARN的ResourceManager，也需要控制不同的节点，因此也需要对ssh进行配置。 </p><h3 id="对hadoop101也进行配置"><a href="#对hadoop101也进行配置" class="headerlink" title="对hadoop101也进行配置"></a>对hadoop101也进行配置</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155523.png" style="zoom: 80%;" /><h3 id="对hadoop102的root用户配置"><a href="#对hadoop102的root用户配置" class="headerlink" title="对hadoop102的root用户配置"></a>对hadoop102的root用户配置</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155534.png" style="zoom:80%;" /><h1 id="群起集群"><a href="#群起集群" class="headerlink" title="群起集群"></a>群起集群</h1><h2 id="配置slaves-md"><a href="#配置slaves-md" class="headerlink" title="配置slaves.md"></a>配置slaves.md</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155552.png"></p><h3 id="注意！！"><a href="#注意！！" class="headerlink" title="注意！！"></a>注意！！</h3><p>不允许有空格，不允许有空行！ </p><h2 id="关闭所有NameNode和DataNode"><a href="#关闭所有NameNode和DataNode" class="headerlink" title="关闭所有NameNode和DataNode"></a>关闭所有NameNode和DataNode</h2><h3 id="hadoop100"><a href="#hadoop100" class="headerlink" title="hadoop100"></a>hadoop100</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155618.png" style="zoom:80%;" /><h3 id="hadoop101"><a href="#hadoop101" class="headerlink" title="hadoop101"></a>hadoop101</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155629.png" style="zoom:80%;" />没有namenode<h3 id="hadoop102"><a href="#hadoop102" class="headerlink" title="hadoop102"></a>hadoop102</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155642.png" style="zoom:80%;" />没有NameNode<h2 id="执行群起脚本"><a href="#执行群起脚本" class="headerlink" title="执行群起脚本"></a>执行群起脚本</h2><h3 id="1-在hadoop100上执行start-dfs-sh脚本执行hdfs"><a href="#1-在hadoop100上执行start-dfs-sh脚本执行hdfs" class="headerlink" title="1 在hadoop100上执行start-dfs.sh脚本执行hdfs"></a>1 在hadoop100上执行start-dfs.sh脚本执行hdfs</h3><table><thead><tr><th></th><th>hadoop100</th><th>hadoop101</th><th>hadoop102</th></tr></thead><tbody><tr><td>jps</td><td><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155931.png"></td><td><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155943.png"></td><td><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155955.png"></td></tr></tbody></table><h3 id="2-启动YARN"><a href="#2-启动YARN" class="headerlink" title="2 启动YARN"></a>2 启动YARN</h3><h3 id="注意-4"><a href="#注意-4" class="headerlink" title="注意"></a>注意</h3><p>必须在hadoop101上启动，不能在其他节点上！（也就是必须在ResourceManager所在的节点启动！！）</p><table><thead><tr><th></th><th>hadoop100</th><th>hadoop101</th><th>hadoop102</th></tr></thead><tbody><tr><td>jps</td><td><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160008.png"></td><td><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160027.png"></td><td><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160051.png"></td></tr></tbody></table><table><thead><tr><th></th><th>hadoop100</th><th>hadoop101</th><th>hadoop102</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode <br> DataNode</td><td>DataNode</td><td>SecondaryNameNode <br> DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager <br> NodeManager</td><td>NodeManager</td></tr></tbody></table><h1 id="集群基本测试"><a href="#集群基本测试" class="headerlink" title="集群基本测试"></a>集群基本测试</h1><h3 id="1-上传大小文件"><a href="#1-上传大小文件" class="headerlink" title="1 上传大小文件"></a>1 上传大小文件</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155833.png"></p><h5 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h5><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155847.png" style="zoom:80%;" /><h4 id="对小文件"><a href="#对小文件" class="headerlink" title="对小文件"></a>对小文件</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155857.png" style="zoom:67%;" /><h4 id="对大文件"><a href="#对大文件" class="headerlink" title="对大文件"></a>对大文件</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210155907.png" style="zoom:67%;" /><h3 id="2-文件存储位置"><a href="#2-文件存储位置" class="headerlink" title="2 文件存储位置"></a>2 文件存储位置</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160119.png" style="zoom:67%;" /><h4 id="注意-5"><a href="#注意-5" class="headerlink" title="注意"></a>注意</h4><p>  多个block拼接起来就是我们所需要的文件！ </p><h2 id="6-集群启动停止方式总结"><a href="#6-集群启动停止方式总结" class="headerlink" title="6 集群启动停止方式总结"></a>6 集群启动停止方式总结</h2><h3 id="各个模块分开启动停止"><a href="#各个模块分开启动停止" class="headerlink" title="各个模块分开启动停止"></a>各个模块分开启动停止</h3><h4 id="注意-6"><a href="#注意-6" class="headerlink" title="注意"></a>注意</h4><p>配置ssh是前提 </p><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><h5 id="1-整体启动-x2F-停止HDFS"><a href="#1-整体启动-x2F-停止HDFS" class="headerlink" title="1. 整体启动&#x2F;停止HDFS"></a>1. 整体启动&#x2F;停止HDFS</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">start-dfs.sh / stop-dfs.sh <br></code></pre></td></tr></table></figure><h5 id="2-整体启动-x2F-停止YARN"><a href="#2-整体启动-x2F-停止YARN" class="headerlink" title="2. 整体启动&#x2F;停止YARN"></a>2. 整体启动&#x2F;停止YARN</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">start-yarn.sh / stop-yarn.sh <br></code></pre></td></tr></table></figure><h3 id="各一组件逐一停止"><a href="#各一组件逐一停止" class="headerlink" title="各一组件逐一停止"></a>各一组件逐一停止</h3><h4 id="1-分别启动停止HDFS组件"><a href="#1-分别启动停止HDFS组件" class="headerlink" title="1. 分别启动停止HDFS组件"></a>1. 分别启动停止HDFS组件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hadoop-daemon.sh start/stop namenode/datanode/secondarynamenode <br></code></pre></td></tr></table></figure><h4 id="2-启动-x2F-停止YARN"><a href="#2-启动-x2F-停止YARN" class="headerlink" title="2. 启动&#x2F;停止YARN"></a>2. 启动&#x2F;停止YARN</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yarn-daemon.sh start/stop resourcemanager/nodemanager <br></code></pre></td></tr></table></figure><h1 id="crontab和集群时间同步"><a href="#crontab和集群时间同步" class="headerlink" title="crontab和集群时间同步"></a>crontab和集群时间同步</h1><h2 id="crond服务管理"><a href="#crond服务管理" class="headerlink" title="crond服务管理"></a>crond服务管理</h2><h4 id="使用前需要打开crond服务"><a href="#使用前需要打开crond服务" class="headerlink" title="使用前需要打开crond服务"></a>使用前需要打开crond服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jps">service crontad restart <br></code></pre></td></tr></table></figure><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><p>crontab [选项] </p><h5 id="选项说明-1"><a href="#选项说明-1" class="headerlink" title="选项说明"></a>选项说明</h5><p>-e：编辑crontab定时任务<br>-l：查询crontab任务<br>-r：删除当前用户所有crontab任务 </p><h2 id="集群时间同步"><a href="#集群时间同步" class="headerlink" title="集群时间同步"></a>集群时间同步</h2><h3 id="时间同步的方式："><a href="#时间同步的方式：" class="headerlink" title="时间同步的方式："></a>时间同步的方式：</h3><p>找一个机器，作为时间服务器，所有的机器与这台集群时间进行定时的同步，比如，每隔十分钟，同步一次时间。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160146.png" style="zoom:67%;" /><h3 id="具体步骤1-服务时间配置（以hadoop100为例）"><a href="#具体步骤1-服务时间配置（以hadoop100为例）" class="headerlink" title="具体步骤1 服务时间配置（以hadoop100为例）"></a>具体步骤1 服务时间配置（以hadoop100为例）</h3><h4 id="注意-7"><a href="#注意-7" class="headerlink" title="注意"></a>注意</h4><p>  所有步骤都采用root权限安装。 </p><h4 id="1-检查ntp是否安装"><a href="#1-检查ntp是否安装" class="headerlink" title="1. 检查ntp是否安装"></a>1. 检查ntp是否安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -qa | grep ntp <br></code></pre></td></tr></table></figure><p>如果出现上面的三个文件则表示安装了ntp </p><h4 id="2-修改ntp配置文件"><a href="#2-修改ntp配置文件" class="headerlink" title="2. 修改ntp配置文件"></a>2. 修改ntp配置文件</h4><h5 id="a-授权192-168-137-0-192-168-137-255的所有机器可以从这台机器上查询和同步时间"><a href="#a-授权192-168-137-0-192-168-137-255的所有机器可以从这台机器上查询和同步时间" class="headerlink" title="a. 授权192.168.137.0-192.168.137.255的所有机器可以从这台机器上查询和同步时间"></a>a. 授权192.168.137.0-192.168.137.255的所有机器可以从这台机器上查询和同步时间</h5><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160207.png"><br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160215.png">  </p><h5 id="b-修改集群在局域网中，不使用其他互联网的时间"><a href="#b-修改集群在局域网中，不使用其他互联网的时间" class="headerlink" title="b.修改集群在局域网中，不使用其他互联网的时间"></a>b.修改集群在局域网中，不使用其他互联网的时间</h5><h6 id="注释前"><a href="#注释前" class="headerlink" title="注释前"></a>注释前</h6><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160233.png"></p><h6 id="注释后"><a href="#注释后" class="headerlink" title="注释后"></a>注释后</h6><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160244.png"></p><h5 id="c-当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中的其他节点提供时间同步"><a href="#c-当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中的其他节点提供时间同步" class="headerlink" title="c.当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中的其他节点提供时间同步"></a>c.当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中的其他节点提供时间同步</h5><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160254.png"></p><h4 id="3-配置-x2F-etc-x2F-sysconfig-x2F-ntpd文件"><a href="#3-配置-x2F-etc-x2F-sysconfig-x2F-ntpd文件" class="headerlink" title="3. 配置&#x2F;etc&#x2F;sysconfig&#x2F;ntpd文件"></a>3. 配置&#x2F;etc&#x2F;sysconfig&#x2F;ntpd文件</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160304.png"></p><h4 id="4-重新启动ntps服务"><a href="#4-重新启动ntps服务" class="headerlink" title="4. 重新启动ntps服务"></a>4. 重新启动ntps服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">service ntps restart <br></code></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160316.png"></p><h3 id="具体步骤2-其他服务器配置"><a href="#具体步骤2-其他服务器配置" class="headerlink" title="具体步骤2 其他服务器配置"></a>具体步骤2 其他服务器配置</h3><h4 id="在其他机器上配置1分钟与服务器时间一致"><a href="#在其他机器上配置1分钟与服务器时间一致" class="headerlink" title="在其他机器上配置1分钟与服务器时间一致"></a>在其他机器上配置1分钟与服务器时间一致</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">crontab -e: <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160331.png"><br>然后用date -s XXX来随意将时间进行设置<br>然后等待1分钟之后看时间是否会恢复<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160346.png" style="zoom:67%;" /></p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>1 Hadoop介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e1ff3872c29e.html"/>
    <url>/2022/12/e1ff3872c29e.html</url>
    
    <content type="html"><![CDATA[<h1 id="编译源码的原因"><a href="#编译源码的原因" class="headerlink" title="编译源码的原因"></a>编译源码的原因</h1><p>例如我们从Apache官网下载的文件为默认32位，但我们是64位的系统，因此我们可以先编译，编译之后让其支持64位系统，从而能够使用。 </p><p>大概意思就是我们原来缺少什么功能，现在进行编译之后让其满足那个功能。！ </p><p>例如我们经过编译后可以得到一个支持64位的hadoop，可以得到支持snappy的hadoop，这些东西可以在网上直接下载，但是也可以自己编译。！ </p><h1 id="源码编译步骤"><a href="#源码编译步骤" class="headerlink" title="源码编译步骤"></a>源码编译步骤</h1><h2 id="1-前期准备"><a href="#1-前期准备" class="headerlink" title="1 前期准备"></a>1 前期准备</h2><h3 id="CentOS联网"><a href="#CentOS联网" class="headerlink" title="CentOS联网"></a>CentOS联网</h3><p>配置CentOS能连接外网。Linux虚拟机ping <a href="http://www.baidu.com/">www.baidu.com</a> 是畅通的  </p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>采用root角色编译，减少文件夹权限出现问题 </p><h2 id="jar包准备-hadoop源码、JDK8、maven、ant-、protobuf"><a href="#jar包准备-hadoop源码、JDK8、maven、ant-、protobuf" class="headerlink" title="jar包准备(hadoop源码、JDK8、maven、ant 、protobuf)"></a>jar包准备(hadoop源码、JDK8、maven、ant 、protobuf)</h2><p>（1）hadoop-2.7.2-src.tar.gz </p><p>（2）jdk-8u144-linux-x64.tar.gz </p><p>（3）apache-ant-1.9.9-bin.tar.gz（build工具，打包用的） </p><p>（4）apache-maven-3.0.5-bin.tar.gz </p><p>（5）protobuf-2.5.0.tar.gz（序列化的框架） </p><h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h2><p>所有操作必须在root用户下完成</p><h2 id="2-jar包安装"><a href="#2-jar包安装" class="headerlink" title="2 jar包安装"></a>2 jar包安装</h2><h3 id="JDK解压、配置环境变量-JAVA-HOME和PATH，验证java-version-如下都需要验证是否配置成功"><a href="#JDK解压、配置环境变量-JAVA-HOME和PATH，验证java-version-如下都需要验证是否配置成功" class="headerlink" title="JDK解压、配置环境变量 JAVA_HOME和PATH，验证java-version(如下都需要验证是否配置成功)"></a>JDK解压、配置环境变量 JAVA_HOME和PATH，验证java-version(如下都需要验证是否配置成功)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software] # tar -zxf jdk-8u144-linux-x64.tar.gz -C /opt/module/ <br>[root@hadoop101 software]# vi /etc/profile <br><span class="hljs-meta prompt_">#</span><span class="language-bash">JAVA_HOME：</span> <br>export JAVA_HOME=/opt/module/jdk1.8.0_144 <br>export PATH=$PATH:$JAVA_HOME/bin <br>[root@hadoop101 software]#source /etc/profile <br></code></pre></td></tr></table></figure><p><strong>验证命令</strong>：java -version </p><h3 id="Maven解压、配置-MAVEN-HOME和PATH"><a href="#Maven解压、配置-MAVEN-HOME和PATH" class="headerlink" title="Maven解压、配置  MAVEN_HOME和PATH"></a>Maven解压、配置  MAVEN_HOME和PATH</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software]# tar -zxvf apache-maven-3.0.5-bin.tar.gz -C /opt/module/ <br>[root@hadoop101 apache-maven-3.0.5]# vi conf/settings.xml <br>&lt;mirrors&gt; <br>    &lt;!-- mirror <br>     | Specifies a repository mirror site to use instead of a given repository. The repository that <br>     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used <br>     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors. <br>     | <br>&lt;mirror&gt; <br>       &lt;id&gt;mirrorId&lt;/id&gt; <br>       &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt; <br>       &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; <br>       &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt; <br>&lt;/mirror&gt; <br>     --&gt; <br>        &lt;mirror&gt; <br>                &lt;id&gt;nexus-aliyun&lt;/id&gt; <br>                &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; <br>                &lt;name&gt;Nexus aliyun&lt;/name&gt; <br>                &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt; <br>        &lt;/mirror&gt; <br>&lt;/mirrors&gt; <br>[root@hadoop101 apache-maven-3.0.5]# vi /etc/profile <br><span class="hljs-meta prompt_">#</span><span class="language-bash">MAVEN_HOME</span> <br>export MAVEN_HOME=/opt/module/apache-maven-3.0.5 <br>export PATH=$PATH:$MAVEN_HOME/bin <br>[root@hadoop101 software]#source /etc/profile <br></code></pre></td></tr></table></figure><p><strong>验证命令</strong>：mvn -version </p><h3 id="ant解压、配置ANT-HOME和PATH"><a href="#ant解压、配置ANT-HOME和PATH" class="headerlink" title="ant解压、配置ANT _HOME和PATH"></a>ant解压、配置ANT _HOME和PATH</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software]# tar -zxvf apache-ant-1.9.9-bin.tar.gz -C /opt/module/ <br>[root@hadoop101 apache-ant-1.9.9]# vi /etc/profile <br><span class="hljs-meta prompt_">#</span><span class="language-bash">ANT_HOME</span> <br>export ANT_HOME=/opt/module/apache-ant-1.9.9 <br>export PATH=$PATH:$ANT_HOME/bin <br>[root@hadoop101 software]#source /etc/profile <br></code></pre></td></tr></table></figure><p><strong>验证命令</strong>：ant -version </p><h3 id="安装glibc-headers和g-命令如下"><a href="#安装glibc-headers和g-命令如下" class="headerlink" title="安装glibc-headers和g++ 命令如下"></a>安装glibc-headers和g++ 命令如下</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 apache-ant-1.9.9]# yum install glibc-headers <br>[root@hadoop101 apache-ant-1.9.9]# yum install gcc-c++ <br></code></pre></td></tr></table></figure><h3 id="安装make和cmake"><a href="#安装make和cmake" class="headerlink" title="安装make和cmake"></a>安装make和cmake</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 apache-ant-1.9.9]# yum install make <br>[root@hadoop101 apache-ant-1.9.9]# yum install cmake <br></code></pre></td></tr></table></figure><h3 id="解压protobuf-，进入到解压后protobuf主目录，-x2F-opt-x2F-module-x2F-protobuf-2-5-0，然后相继执行命令"><a href="#解压protobuf-，进入到解压后protobuf主目录，-x2F-opt-x2F-module-x2F-protobuf-2-5-0，然后相继执行命令" class="headerlink" title="解压protobuf ，进入到解压后protobuf主目录，&#x2F;opt&#x2F;module&#x2F;protobuf-2.5.0，然后相继执行命令"></a>解压protobuf ，进入到解压后protobuf主目录，&#x2F;opt&#x2F;module&#x2F;protobuf-2.5.0，然后相继执行命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software]# tar -zxvf protobuf-2.5.0.tar.gz -C /opt/module/ <br>[root@hadoop101 opt]# cd /opt/module/protobuf-2.5.0/ <br>[root@hadoop101 protobuf-2.5.0]#./configure<br>[root@hadoop101 protobuf-2.5.0]# make<br>[root@hadoop101 protobuf-2.5.0]# make check<br>[root@hadoop101 protobuf-2.5.0]# make install<br>[root@hadoop101 protobuf-2.5.0]# ldconfig<br>[root@hadoop101 hadoop-dist]# vi /etc/profile <br><span class="hljs-meta prompt_">#</span><span class="language-bash">LD_LIBRARY_PATH</span> <br>export LD_LIBRARY_PATH=/opt/module/protobuf-2.5.0 <br>export PATH=$PATH:$LD_LIBRARY_PATH <br>[root@hadoop101 software]#source /etc/profile <br></code></pre></td></tr></table></figure><p><strong>验证命令</strong>：protoc –version </p><h3 id="安装openssl库"><a href="#安装openssl库" class="headerlink" title="安装openssl库"></a>安装openssl库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software]#yum install openssl-devel <br></code></pre></td></tr></table></figure><h3 id="安装ncurses-devel库"><a href="#安装ncurses-devel库" class="headerlink" title="安装ncurses-devel库"></a>安装ncurses-devel库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software]#yum install ncurses-devel <br></code></pre></td></tr></table></figure><p>到此，编译工具安装基本完成。 </p><h1 id="3-源码编译"><a href="#3-源码编译" class="headerlink" title="3 源码编译"></a>3 源码编译</h1><h2 id="解压源码到-x2F-opt-x2F-目录"><a href="#解压源码到-x2F-opt-x2F-目录" class="headerlink" title="解压源码到&#x2F;opt&#x2F;目录"></a>解压源码到&#x2F;opt&#x2F;目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 software]# tar -zxvf hadoop-2.7.2-src.tar.gz -C /opt/ <br></code></pre></td></tr></table></figure><h2 id="进入到hadoop源码主目录"><a href="#进入到hadoop源码主目录" class="headerlink" title="进入到hadoop源码主目录"></a>进入到hadoop源码主目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 hadoop-2.7.2-src]# pwd <br>/opt/hadoop-2.7.2-src <br></code></pre></td></tr></table></figure><h2 id="通过maven执行编译命令"><a href="#通过maven执行编译命令" class="headerlink" title="通过maven执行编译命令"></a>通过maven执行编译命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 hadoop-2.7.2-src]#mvn package -Pdist,native -DskipTests -Dtar <br></code></pre></td></tr></table></figure><p>等待时间30分钟左右，最终成功是全部SUCCESS.</p><h2 id="成功的64位hadoop包在-x2F-opt-x2F-hadoop-2-7-2-src-x2F-hadoop-dist-x2F-target下"><a href="#成功的64位hadoop包在-x2F-opt-x2F-hadoop-2-7-2-src-x2F-hadoop-dist-x2F-target下" class="headerlink" title="成功的64位hadoop包在&#x2F;opt&#x2F;hadoop-2.7.2-src&#x2F;hadoop-dist&#x2F;target下"></a>成功的64位hadoop包在&#x2F;opt&#x2F;hadoop-2.7.2-src&#x2F;hadoop-dist&#x2F;target下</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 target]# pwd <br>/opt/hadoop-2.7.2-src/hadoop-dist/target <br></code></pre></td></tr></table></figure><h2 id="编译源码过程中常见的问题及解决方案"><a href="#编译源码过程中常见的问题及解决方案" class="headerlink" title="编译源码过程中常见的问题及解决方案"></a>编译源码过程中常见的问题及解决方案</h2><h3 id="（1）MAVEN-install时候JVM内存溢出"><a href="#（1）MAVEN-install时候JVM内存溢出" class="headerlink" title="（1）MAVEN install时候JVM内存溢出"></a>（1）MAVEN install时候JVM内存溢出</h3><p><strong>处理方式</strong>：在环境配置文件和maven的执行文件均可调整MAVEN_OPT的heap大小。（详情查阅MAVEN 编译 JVM调优问题，如：<a href="http://outofmemory.cn/code-snippet/12652/maven-outofmemoryerror-method%EF%BC%89">http://outofmemory.cn/code-snippet/12652/maven-outofmemoryerror-method）</a> </p><h3 id="（2）编译期间maven报错。可能网络阻塞问题导致依赖库下载不完整导致，多次执行命令（一次通过比较难）："><a href="#（2）编译期间maven报错。可能网络阻塞问题导致依赖库下载不完整导致，多次执行命令（一次通过比较难）：" class="headerlink" title="（2）编译期间maven报错。可能网络阻塞问题导致依赖库下载不完整导致，多次执行命令（一次通过比较难）："></a>（2）编译期间maven报错。可能网络阻塞问题导致依赖库下载不完整导致，多次执行命令（一次通过比较难）：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hadoop101 hadoop-2.7.2-src]#mvn package -Pdist,nativeN -DskipTests -Dtar <br></code></pre></td></tr></table></figure><h3 id="（3）报ant、protobuf等错误，插件下载未完整或者插件版本问题，最开始链接有较多特殊情况，同时推荐"><a href="#（3）报ant、protobuf等错误，插件下载未完整或者插件版本问题，最开始链接有较多特殊情况，同时推荐" class="headerlink" title="（3）报ant、protobuf等错误，插件下载未完整或者插件版本问题，最开始链接有较多特殊情况，同时推荐"></a>（3）报ant、protobuf等错误，插件下载未完整或者插件版本问题，最开始链接有较多特殊情况，同时推荐</h3><p>2.7.0版本的问题汇总帖子 <a href="http://www.tuicool.com/articles/IBn63qf">http://www.tuicool.com/articles/IBn63qf</a> </p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>1 Hadoop介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/267c749ad5ad.html"/>
    <url>/2022/12/267c749ad5ad.html</url>
    
    <content type="html"><![CDATA[<h1 id="dfs和fs的区别"><a href="#dfs和fs的区别" class="headerlink" title="dfs和fs的区别"></a>dfs和fs的区别</h1><h2 id="hadoop-fs"><a href="#hadoop-fs" class="headerlink" title="hadoop fs"></a>hadoop fs</h2><p>使用面最广，可以操作任何文件系统。</p><h2 id="hadoop-dfs与hdfs-dfs"><a href="#hadoop-dfs与hdfs-dfs" class="headerlink" title="hadoop dfs与hdfs dfs"></a>hadoop dfs与hdfs dfs</h2><p>只能操作HDFS文件系统相关（包括与Local FS间的操作），前者（dfs）已经Deprecated，一般使用后者。</p><h2 id="以下内容参考自stackoverflow"><a href="#以下内容参考自stackoverflow" class="headerlink" title="以下内容参考自stackoverflow"></a>以下内容参考自stackoverflow</h2><p>Following are the three commands which appears same but have minute differences</p><ol><li>hadoop fs {args}</li><li>hadoop dfs {args}</li><li>hdfs dfs {args}</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hadoop fs &lt;args&gt;<br></code></pre></td></tr></table></figure><p>FS relates to a generic file system which can point to any file systems like local, HDFS etc. So this can be used when you are dealing with different file systems such as Local FS, HFTP FS, S3 FS, and others 。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">hadoop dfs <span class="hljs-tag">&lt;<span class="hljs-name">args</span>&gt;</span><br></code></pre></td></tr></table></figure><p>dfs is very specific to HDFS. would work for operation relates to HDFS. This has been deprecated and we should use hdfs dfs instead.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">hdfs   dfs <span class="hljs-tag">&lt;<span class="hljs-name">args</span>&gt;</span><br></code></pre></td></tr></table></figure><p>same as 2nd i.e would work for all the operations related to HDFS and is the recommended command instead of hadoop dfs<br>below is the list categorized as HDFS commands.</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">**<span class="hljs-meta">#hdfs commands**</span><br></code></pre></td></tr></table></figure><p>  namenode|secondarynamenode|datanode|dfs|dfsadmin|fsck|balancer|fetchdt|oiv|dfsgroups<br>So even if you use Hadoop dfs , it will look locate hdfs and delegate that command to hdfs dfs</p><h1 id="shell操作"><a href="#shell操作" class="headerlink" title="shell操作"></a>shell操作</h1><h2 id="常用命令操作"><a href="#常用命令操作" class="headerlink" title="常用命令操作"></a>常用命令操作</h2><p>（0）启动Hadoop集群（方便后续的测试）</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>sbin/start-dfs.sh<br>[atguigu<span class="hljs-variable">@hadoop103</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>sbin/start-yarn.sh<br></code></pre></td></tr></table></figure><p>（1）-help：输出这个命令参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[atguigu@hadoop102 hadoop-2.7.2]$ hadoop fs -<span class="hljs-built_in">help</span> <span class="hljs-built_in">rm</span><br></code></pre></td></tr></table></figure><p>（2）-ls: 显示目录信息</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>hadoop fs -ls /<br></code></pre></td></tr></table></figure><p>（3）-mkdir：在HDFS上创建目录</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -mkdir -p <span class="hljs-regexp">/sanguo/</span>shuguo<br></code></pre></td></tr></table></figure><p>（4）-moveFromLocal：从本地剪切粘贴到HDFS</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>touch kongming.txt<br>[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>hadoop fs  -moveFromLocal  ./kongming.txt  /sanguo/shuguo<br></code></pre></td></tr></table></figure><p>（5）-appendToFile：追加一个文件到已经存在的文件末尾</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>touch liubei.txt<br>[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>vi liubei.txt<br>   输入<br>san gu mao lu<br>[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>hadoop fs -appendToFile liubei.txt /sanguo/shuguo/kongming.txt<br></code></pre></td></tr></table></figure><p>（6）-cat：显示文件内容</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -cat <span class="hljs-regexp">/sanguo/</span>shuguo/kongming.txt<br></code></pre></td></tr></table></figure><pre><code class="hljs">（7）-chgrp、-chmod、-chown：Linux文件系统中的用法一样，修改文件所属权限</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs  -chmod  <span class="hljs-number">666</span>  <span class="hljs-regexp">/sanguo/</span>shuguo/kongming.txt<br>[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs  -chown  atguigu:atguigu   <span class="hljs-regexp">/sanguo/</span>shuguo/kongming.txt<br></code></pre></td></tr></table></figure><pre><code class="hljs">（8）-copyFromLocal：从本地文件系统中拷贝文件到HDFS路径去</code></pre><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[atguigu<span class="hljs-variable">@hadoop102</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]<span class="hljs-variable">$ </span>hadoop fs -copyFromLocal README.txt /<br></code></pre></td></tr></table></figure><pre><code class="hljs">（9）-copyToLocal：从HDFS拷贝到本地</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -copyToLocal <span class="hljs-regexp">/sanguo/</span>shuguo<span class="hljs-regexp">/kongming.txt ./</span><br></code></pre></td></tr></table></figure><pre><code class="hljs">（10）-cp ：从HDFS的一个路径拷贝到HDFS的另一个路径</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -cp <span class="hljs-regexp">/sanguo/</span>shuguo<span class="hljs-regexp">/kongming.txt /</span>zhuge.txt<br></code></pre></td></tr></table></figure><pre><code class="hljs">（11）-mv：在HDFS目录中移动文件</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -mv <span class="hljs-regexp">/zhuge.txt /</span>sanguo<span class="hljs-regexp">/shuguo/</span><br></code></pre></td></tr></table></figure><pre><code class="hljs">（12）-get：等同于copyToLocal，就是从HDFS下载文件到本地</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -get <span class="hljs-regexp">/sanguo/</span>shuguo<span class="hljs-regexp">/kongming.txt ./</span><br></code></pre></td></tr></table></figure><pre><code class="hljs">（13）-getmerge：合并下载多个文件，比如HDFS的目录 /user/atguigu/test下有多个文件:log.1, log.2,log.3,...</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -getmerge <span class="hljs-regexp">/user/</span>atguigu<span class="hljs-regexp">/test/</span>* ./zaiyiqi.txt<br></code></pre></td></tr></table></figure><pre><code class="hljs">（14）-put：等同于copyFromLocal</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -put .<span class="hljs-regexp">/zaiyiqi.txt /u</span>ser<span class="hljs-regexp">/atguigu/</span>test/<br></code></pre></td></tr></table></figure><pre><code class="hljs">（15）-tail：显示一个文件的末尾</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -tail <span class="hljs-regexp">/sanguo/</span>shuguo/kongming.txt<br></code></pre></td></tr></table></figure><pre><code class="hljs">（16）-rm：删除文件或文件夹</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -rm <span class="hljs-regexp">/user/</span>atguigu<span class="hljs-regexp">/test/</span>jinlian2.txt<br></code></pre></td></tr></table></figure><pre><code class="hljs">（17）-rmdir：删除空目录</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[atguigu@hadoop102 hadoop-2.7.2]$ hadoop fs -<span class="hljs-built_in">mkdir</span> /test<br>[atguigu@hadoop102 hadoop-2.7.2]$ hadoop fs -<span class="hljs-built_in">rmdir</span> /test<br></code></pre></td></tr></table></figure><pre><code class="hljs">（18）-du统计文件夹的大小信息</code></pre><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -du -s -h <span class="hljs-regexp">/user/</span>atguigu/test<br><span class="hljs-number">2.7</span> K  <span class="hljs-regexp">/user/</span>atguigu/test<br>[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -du  -h <span class="hljs-regexp">/user/</span>atguigu/test<br><span class="hljs-number">1.3</span> K  <span class="hljs-regexp">/user/</span>atguigu<span class="hljs-regexp">/test/</span>README.txt<br><span class="hljs-number">15</span>     <span class="hljs-regexp">/user/</span>atguigu<span class="hljs-regexp">/test/</span>jinlian.txt<br><span class="hljs-number">1.4</span> K  <span class="hljs-regexp">/user/</span>atguigu<span class="hljs-regexp">/test/</span>zaiyiqi.txt<br></code></pre></td></tr></table></figure><h2 id="2-setrep-md"><a href="#2-setrep-md" class="headerlink" title="2 -setrep.md"></a>2 -setrep.md</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">[atguigu@hadoop102 hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">2</span>]$ hadoop fs -setrep <span class="hljs-number">10</span> <span class="hljs-regexp">/sanguo/</span>shuguo/kongming.txt<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160717.png">  <br>图3-3  HDFS副本数量<br>这里设置的副本数只是记录在NameNode的元数据中，是否真的会有这么多副本，还得看DataNode的数量。因为目前只有3台设备，最多也就3个副本，只有节点数的增加到10台时，副本数才能达到10。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>2 HDFS介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a2ab8cb50110.html"/>
    <url>/2022/12/a2ab8cb50110.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-客户端环境准备"><a href="#1-客户端环境准备" class="headerlink" title="1 客户端环境准备"></a>1 客户端环境准备</h1><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>若是windows电脑则需要配置HADOOP_HOME（其实感觉也不需要，只要导入maven依赖就行了）。</p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="1-打开IDEA建立MAVEN项目"><a href="#1-打开IDEA建立MAVEN项目" class="headerlink" title="1. 打开IDEA建立MAVEN项目"></a>1. 打开IDEA建立MAVEN项目</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160835.png" style="zoom:50%;" /><h3 id="2-配置pom-xml"><a href="#2-配置pom-xml" class="headerlink" title="2. 配置pom.xml"></a>2. 配置pom.xml</h3><p>pom.xml的配置信息如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.hadoop<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hadoop-hdfs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jdk.tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jdk.tools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>system<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">systemPath</span>&gt;</span>$&#123;JAVA_HOME&#125;/lib/tools.jar<span class="hljs-tag">&lt;/<span class="hljs-name">systemPath</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>最后的jdk可以直接删掉，直接在IDEA里面配置即可。<br>将其配置好后，采用阿里云镜像，可以快速下载好所需要的junit和hadoop等包。</p><h3 id="3-打印日志配置"><a href="#3-打印日志配置" class="headerlink" title="3. 打印日志配置"></a>3. 打印日志配置</h3><p>注意：如果Eclipse&#x2F;Idea打印不出日志，在控制台上只显示</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span><span class="hljs-selector-class">.log4j</span>:WARN No appenders could be found <span class="hljs-keyword">for</span> logger (org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.hadoop</span><span class="hljs-selector-class">.util</span>.Shell).  <br><span class="hljs-number">2</span><span class="hljs-selector-class">.log4j</span>:WARN Please initialize the log4j system properly.  <br><span class="hljs-number">3</span><span class="hljs-selector-class">.log4j</span>:WARN See http:<span class="hljs-comment">//logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span><br></code></pre></td></tr></table></figure><p>需要在项目的src&#x2F;main&#x2F;resources目录下，新建一个文件，命名为“log4j.properties”，在文件中填入</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">log4j.rootLogger</span>=INFO, stdout<br><span class="hljs-attr">log4j.appender.stdout</span>=org.apache.log4j.ConsoleAppender<br><span class="hljs-attr">log4j.appender.stdout.layout</span>=org.apache.log4j.PatternLayout<br><span class="hljs-attr">log4j.appender.stdout.layout.ConversionPattern</span>=%d %p [%c] - %m%n<br><span class="hljs-attr">log4j.appender.logfile</span>=org.apache.log4j.FileAppender<br><span class="hljs-attr">log4j.appender.logfile.File</span>=target/spring.log<br><span class="hljs-attr">log4j.appender.logfile.layout</span>=org.apache.log4j.PatternLayout<br><span class="hljs-attr">log4j.appender.logfile.layout.ConversionPattern</span>=%d %p [%c] - %m%n<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160930.png"></p><h3 id="4-创建包名com-coachhe-hdfs"><a href="#4-创建包名com-coachhe-hdfs" class="headerlink" title="4. 创建包名com.coachhe.hdfs"></a>4. 创建包名com.coachhe.hdfs</h3><h3 id="5-创建类HdfsClient"><a href="#5-创建类HdfsClient" class="headerlink" title="5. 创建类HdfsClient"></a>5. 创建类HdfsClient</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160940.png" style="zoom:80%;" /><h2 id="6-执行程序"><a href="#6-执行程序" class="headerlink" title="6. 执行程序"></a>6. 执行程序</h2><p>运行时需要进行用户配置:  </p><h3 id="eclipse："><a href="#eclipse：" class="headerlink" title="eclipse："></a>eclipse：</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160807.png"></p><h3 id="IDEA："><a href="#IDEA：" class="headerlink" title="IDEA："></a>IDEA：</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160956.png" style="zoom:80%;" /><h1 id="2-HDFS的API操作"><a href="#2-HDFS的API操作" class="headerlink" title="2 HDFS的API操作"></a>2 HDFS的API操作</h1><h2 id="测试参数优先级"><a href="#测试参数优先级" class="headerlink" title="测试参数优先级"></a>测试参数优先级</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174031.png" style="zoom:67%;" /><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174102.png" style="zoom:67%;" /><h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p>在这里将本机文件上传到了hdfs上，并且会发现副本只有一个，因为这里的优先级更高。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>参数优先级排序：（1）客户端代码中设置的值 &gt;（2）ClassPath下的用户自定义配置文件 &gt;（3）然后是服务器的默认配置</p><h2 id="HDFS文件下载"><a href="#HDFS文件下载" class="headerlink" title="HDFS文件下载"></a>HDFS文件下载</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174210.png" style="zoom:67%;" /><h2 id="HDFS文件夹删除"><a href="#HDFS文件夹删除" class="headerlink" title="HDFS文件夹删除"></a>HDFS文件夹删除</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174229.png" style="zoom:67%;" /><h2 id="HDFS文件名修改"><a href="#HDFS文件名修改" class="headerlink" title="HDFS文件名修改"></a>HDFS文件名修改</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174245.png" style="zoom:67%;" /><h2 id="HDFS文件和文件夹判断"><a href="#HDFS文件和文件夹判断" class="headerlink" title="HDFS文件和文件夹判断"></a>HDFS文件和文件夹判断</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174257.png" style="zoom:67%;" /><h1 id="HDFS的IO流操作"><a href="#HDFS的IO流操作" class="headerlink" title="HDFS的IO流操作"></a>HDFS的IO流操作</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>上面我们学的API操作HDFS系统都是框架封装好的。那么如果我们想自己实现上述API的操作该怎么实现呢？<br>我们可以采用IO流的方式实现数据的上传和下载。</p><h2 id="HDFS文件上传"><a href="#HDFS文件上传" class="headerlink" title="HDFS文件上传"></a>HDFS文件上传</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174345.png" style="zoom:67%;" /><h3 id="HDFS文件下载-1"><a href="#HDFS文件下载-1" class="headerlink" title="HDFS文件下载"></a>HDFS文件下载</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210174357.png" style="zoom:67%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>2 HDFS介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/bbdbf0db10c9.html"/>
    <url>/2022/12/bbdbf0db10c9.html</url>
    
    <content type="html"><![CDATA[<h1 id="NN和2NN工作机制"><a href="#NN和2NN工作机制" class="headerlink" title="NN和2NN工作机制"></a>NN和2NN工作机制</h1><h2 id="一-NameNode元数据存储位置"><a href="#一-NameNode元数据存储位置" class="headerlink" title="一 NameNode元数据存储位置"></a>一 NameNode元数据存储位置</h2><h3 id="思考：NameNode中的元数据是存储在哪里的？"><a href="#思考：NameNode中的元数据是存储在哪里的？" class="headerlink" title="思考：NameNode中的元数据是存储在哪里的？"></a>思考：NameNode中的元数据是存储在哪里的？</h3><p>首先，我们做个假设，如果存储在NameNode节点的磁盘中，因为经常需要进行随机访问，还有响应客户请求，必然是效率过低。因此，元数据需要存放在内存中。但如果只存在内存中，一旦断电，元数据丢失，整个集群就无法工作了。    </p><h3 id="因此产生在磁盘中备份元数据的FsImage。"><a href="#因此产生在磁盘中备份元数据的FsImage。" class="headerlink" title="因此产生在磁盘中备份元数据的FsImage。"></a>因此产生在磁盘中备份元数据的FsImage。</h3><p>这样又会带来新的问题，当在内存中的元数据更新时，如果同时更新FsImage，就会导致效率过低，但如果不更新，就会发生一致性问题，一旦NameNode节点断电，就会产生数据丢失。 </p><h3 id="因此，引入Edits文件-只进行追加操作，效率很高-。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到Edits中。这样，一旦NameNode节点断电，可以通过FsImage和Edits的合并，合成元数据。"><a href="#因此，引入Edits文件-只进行追加操作，效率很高-。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到Edits中。这样，一旦NameNode节点断电，可以通过FsImage和Edits的合并，合成元数据。" class="headerlink" title="因此，引入Edits文件(只进行追加操作，效率很高)。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到Edits中。这样，一旦NameNode节点断电，可以通过FsImage和Edits的合并，合成元数据。"></a>因此，引入Edits文件(只进行追加操作，效率很高)。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到Edits中。这样，一旦NameNode节点断电，可以通过FsImage和Edits的合并，合成元数据。</h3><p>但是，如果长时间添加数据到Edits中，会导致该文件数据过大，效率降低，而且一旦断电，恢复元数据需要的时间过长。因此，需要定期进行FsImage和Edits的合并，如果这个操作由NameNode节点完成，又会效率过低。</p><h3 id="因此，引入一个新的节点SecondaryNamenode，专门用于FsImage和Edits的合并。"><a href="#因此，引入一个新的节点SecondaryNamenode，专门用于FsImage和Edits的合并。" class="headerlink" title="因此，引入一个新的节点SecondaryNamenode，专门用于FsImage和Edits的合并。"></a>因此，引入一个新的节点SecondaryNamenode，专门用于FsImage和Edits的合并。</h3><h2 id="二-NameNode工作机制"><a href="#二-NameNode工作机制" class="headerlink" title="二 NameNode工作机制"></a>二 NameNode工作机制</h2><ol><li>NameNode加载编辑日志和镜像文件到内存中</li><li>客户端发起某个文件的增删改查请求</li><li>NameNode将记录操作日志、更新滚动日志</li><li>将内存中的数据进行修改</li></ol><h3 id="原理图："><a href="#原理图：" class="headerlink" title="原理图："></a>原理图：</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210182339.png" style="zoom:50%;" /><h2 id="三-Secondary-NameNode工作机制"><a href="#三-Secondary-NameNode工作机制" class="headerlink" title="三 Secondary NameNode工作机制"></a>三 Secondary NameNode工作机制</h2><p>当编辑日志太大之后，引入了Secondary NameNode</p><h3 id="1-请求是否需要CheckPoint"><a href="#1-请求是否需要CheckPoint" class="headerlink" title="1. 请求是否需要CheckPoint"></a>1. 请求是否需要CheckPoint</h3><h4 id="CheckPoint："><a href="#CheckPoint：" class="headerlink" title="CheckPoint："></a>CheckPoint：</h4><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>将编辑日志和镜像文件进行合并，然后序列化到新的镜像文件中。</p><h4 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h4><ol><li>定时时间到</li><li>Edits中的数据满了</li></ol><h3 id="2-请求执行CheckPoint"><a href="#2-请求执行CheckPoint" class="headerlink" title="2. 请求执行CheckPoint"></a>2. 请求执行CheckPoint</h3><h3 id="3-滚动正在写的Edits"><a href="#3-滚动正在写的Edits" class="headerlink" title="3. 滚动正在写的Edits"></a>3. 滚动正在写的Edits</h3><h3 id="4-拷贝到2nn"><a href="#4-拷贝到2nn" class="headerlink" title="4. 拷贝到2nn"></a>4. 拷贝到2nn</h3><h3 id="5-加载到内存并合并"><a href="#5-加载到内存并合并" class="headerlink" title="5. 加载到内存并合并"></a>5. 加载到内存并合并</h3><h3 id="6-生成新的Fsimage"><a href="#6-生成新的Fsimage" class="headerlink" title="6. 生成新的Fsimage"></a>6. 生成新的Fsimage</h3><h3 id="7-拷贝到nn"><a href="#7-拷贝到nn" class="headerlink" title="7. 拷贝到nn"></a>7. 拷贝到nn</h3><h3 id="8-重新命名为Fsimage"><a href="#8-重新命名为Fsimage" class="headerlink" title="8.重新命名为Fsimage"></a>8.重新命名为Fsimage</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210182608.png" style="zoom:50%;" /><h1 id="Fsimage和Edits解析"><a href="#Fsimage和Edits解析" class="headerlink" title="Fsimage和Edits解析"></a>Fsimage和Edits解析</h1><h2 id="1-目录"><a href="#1-目录" class="headerlink" title="1 目录"></a>1 目录</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183305.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183325.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183409.png" style="zoom: 67%;" /><h2 id="2-解析的命令"><a href="#2-解析的命令" class="headerlink" title="2 解析的命令"></a>2 解析的命令</h2><h3 id="oiv查看Fsimage文件"><a href="#oiv查看Fsimage文件" class="headerlink" title="oiv查看Fsimage文件"></a>oiv查看Fsimage文件</h3><h4 id="查看oiv和oev命令"><a href="#查看oiv和oev命令" class="headerlink" title="查看oiv和oev命令"></a>查看oiv和oev命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash"> hdfs oiv apply the offline fsimage viewer to an fsimage</span> <br>oev apply the offline edits viewer to an edits file <br></code></pre></td></tr></table></figure><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">hdfs oiv -<span class="hljs-selector-tag">p</span> 文件类型 -<span class="hljs-selector-tag">i</span>镜像文件 -o 转换后文件输出路径<br></code></pre></td></tr></table></figure><h4 id="案例实操"><a href="#案例实操" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ pwd <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>data<span class="hljs-regexp">/tmp/</span>dfs<span class="hljs-regexp">/name/</span>current <br>$ hdfs oiv -p XML -i fsimage_0000000000000000025 -o <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>fsimage.xml <br>$ cat <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>fsimage.xml <br></code></pre></td></tr></table></figure><h3 id="oev查看Edits文件"><a href="#oev查看Edits文件" class="headerlink" title="oev查看Edits文件"></a>oev查看Edits文件</h3><h4 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">hdfs oev -<span class="hljs-selector-tag">p</span> 文件类型 -<span class="hljs-selector-tag">i</span>编辑日志 -o 转换后文件输出路径 <br></code></pre></td></tr></table></figure><h4 id="案例实操-1"><a href="#案例实操-1" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ hdfs oev -p XML -i edits_0000000000000000012-<span class="hljs-number">0000000000000000013</span> -o <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>edits.xml <br>$ cat <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>edits.xml <br></code></pre></td></tr></table></figure><p>将显示的xml文件内容拷贝到Eclipse中创建的xml文件中，并格式化。</p><h2 id="3-重新格式化举例"><a href="#3-重新格式化举例" class="headerlink" title="3 重新格式化举例"></a>3 重新格式化举例</h2><h3 id="格式化之后的fsimage和edits"><a href="#格式化之后的fsimage和edits" class="headerlink" title="格式化之后的fsimage和edits"></a>格式化之后的fsimage和edits</h3><h4 id="hadoop100（NameNode）上的文件"><a href="#hadoop100（NameNode）上的文件" class="headerlink" title="hadoop100（NameNode）上的文件"></a>hadoop100（NameNode）上的文件</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183848.png"><br>可以看到，只有fsimage_000000的文件，并没有edits文件，也就是说，没有修改的过程，所以没有edits。</p><h3 id="hadoop102上的文件（Secondary-NameNade）"><a href="#hadoop102上的文件（Secondary-NameNade）" class="headerlink" title="hadoop102上的文件（Secondary NameNade）"></a>hadoop102上的文件（Secondary NameNade）</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183916.png"><br>可以看到，hadoop102上没有文件，因为还不需要它来进行合并fsimage和edits文件的操作</p><h3 id="进行一次操作：增加一个文件夹”-x2F-examples”"><a href="#进行一次操作：增加一个文件夹”-x2F-examples”" class="headerlink" title="进行一次操作：增加一个文件夹”&#x2F;examples”"></a>进行一次操作：增加一个文件夹”&#x2F;examples”</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183931.png"><br>可以看到，多了一个edits文件。仔细查看这两个文件：</p><h4 id="fsimage-00-00"><a href="#fsimage-00-00" class="headerlink" title="fsimage_00..00:"></a>fsimage_00..00:</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">hdfs oiv -p <span class="hljs-keyword">XML</span> <span class="hljs-title">-i</span> fsimage_0000000000000000000 -o fsimage.xml<br></code></pre></td></tr></table></figure><p>将其复制到IDEA格式化之后可以看到，最新的创建文件夹的动作并没有被记录。<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210183958.png" style="zoom:67%;" /></p><h4 id="edits文件"><a href="#edits文件" class="headerlink" title="edits文件"></a>edits文件</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">hdfs oev -p <span class="hljs-keyword">XML</span> <span class="hljs-title">-i</span> edits_0000000000000000001-<span class="hljs-number">0000000000000000003</span> -o edits.xml<br></code></pre></td></tr></table></figure><p>同样复制到IDEA格式化之后，可以看到创建文件夹的动作被记录在edits文件中。<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210184015.png"> <br>也就是说，在这个时候edits文件还没有和fsimage文件进行合并，这个动作是由2NN进行的。所以在2NN中没有出现文件。</p><h1 id="集群安全模式"><a href="#集群安全模式" class="headerlink" title="集群安全模式"></a>集群安全模式</h1><h2 id="1-进入和离开安全模式"><a href="#1-进入和离开安全模式" class="headerlink" title="1 进入和离开安全模式"></a>1 进入和离开安全模式</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210184046.png" style="zoom:50%;" /><h2 id="2-等待安全模式"><a href="#2-等待安全模式" class="headerlink" title="2 等待安全模式"></a>2 等待安全模式</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210184111.png" style="zoom:50%;" /><h1 id="NameNode多目录配置"><a href="#NameNode多目录配置" class="headerlink" title="NameNode多目录配置"></a>NameNode多目录配置</h1><h2 id="修改hdfs-site-xml"><a href="#修改hdfs-site-xml" class="headerlink" title="修改hdfs-site.xml"></a>修改hdfs-site.xml</h2><img src="https://pic.downk.cc/item/5fc7845b394ac52378b4e7b2.png" style="zoom:50%;" /><h2 id="结果：双目录"><a href="#结果：双目录" class="headerlink" title="结果：双目录"></a>结果：双目录</h2><img src="https://pic.downk.cc/item/5fc7845b394ac52378b4e7a9.png" style="zoom:50%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>2 HDFS介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e54b1648aeb8.html"/>
    <url>/2022/12/e54b1648aeb8.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>MapReduce是一个&#x3D;&#x3D;分布式运算程序的编程框架&#x3D;&#x3D;。是用户开发“基于Hadoop的数据分析应用”的核心框架。</p><h2 id="MR核心功能"><a href="#MR核心功能" class="headerlink" title="MR核心功能"></a>MR核心功能</h2><p>MapReduce&#x3D;&#x3D;核心功能&#x3D;&#x3D;是将&#x3D;&#x3D;用户编写的业务逻辑代码&#x3D;&#x3D;和&#x3D;&#x3D;自带默认组件&#x3D;&#x3D;整合成一个&#x3D;&#x3D;完整的分布式运算程序&#x3D;&#x3D;，并发运行在一个Hadoop集群上。</p><h1 id="2-MR优缺点"><a href="#2-MR优缺点" class="headerlink" title="2 MR优缺点"></a>2 MR优缺点</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><h3 id="1-MR易于编程"><a href="#1-MR易于编程" class="headerlink" title="1. MR易于编程"></a>1. MR易于编程</h3><p>它简单的实现一些接口，就可以完成一个分布式程序。</p><h3 id="2-良好的拓展性"><a href="#2-良好的拓展性" class="headerlink" title="2. 良好的拓展性"></a>2. 良好的拓展性</h3><p>当你的计算资源不能得到满足的时候，可以通过简单的增加机器来扩展它的计算能力。</p><h3 id="3-高容错性"><a href="#3-高容错性" class="headerlink" title="3. 高容错性"></a>3. 高容错性</h3><p>若其中一台机器挂了，它可以把上面的计算任务转移到另外一个节点上运行，不至于这个任务运行失败，而且这个过程不需要人工参加，而完全是由Hadoop内部完成的。</p><h3 id="4-适合PB级以上海量数据的离线计算"><a href="#4-适合PB级以上海量数据的离线计算" class="headerlink" title="4. 适合PB级以上海量数据的离线计算"></a>4. 适合PB级以上海量数据的离线计算</h3><p>可以实现上千台服务器集群并发处理，提供数据处理能力。</p><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><h3 id="1-不擅长实时计算"><a href="#1-不擅长实时计算" class="headerlink" title="1. 不擅长实时计算"></a>1. 不擅长实时计算</h3><p>MR无法像MySQL一样，在毫秒或者秒级内返回结果</p><h3 id="2-不擅长流式计算。"><a href="#2-不擅长流式计算。" class="headerlink" title="2. 不擅长流式计算。"></a>2. 不擅长流式计算。</h3><p>流式计算的输入数据是动态的，而MR的输入数据集是静态的，不能动态变化。</p><h3 id="3-不擅长DAG（有向图）计算"><a href="#3-不擅长DAG（有向图）计算" class="headerlink" title="3. 不擅长DAG（有向图）计算"></a>3. 不擅长DAG（有向图）计算</h3><p>也就是不能让多个应用程序存在依赖关系，后一个应用程序的输入为前一个的输出。在这种情况下，其实MR并不是不能做，而是使用后，每个MR的作业的输出结果都会写入到磁盘，会造成大量的磁盘IO，导致性能非常低下。</p><h1 id="3-MR核心思想"><a href="#3-MR核心思想" class="headerlink" title="3 MR核心思想"></a>3 MR核心思想</h1><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210235945.png" style="zoom: 25%;" /><p>1）分布式的运算程序往往需要分成至少2个阶段。<br>2）第一个阶段的MapTask并发实例，完全并行运行，互不相干。<br>3）第二个阶段的ReduceTask并发实例互不相干，但是他们的数据依赖于上一个阶段的所有MapTask并发实例的输出。<br>4）MapReduce编程模型只能包含一个Map阶段和一个Reduce阶段，如果用户的业务逻辑非常复杂，那就只能多个MapReduce程序，串行运行。 </p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>分析WordCount数据流走向深入理解MapReduce核心思想。 </p><h1 id="4-MR进程"><a href="#4-MR进程" class="headerlink" title="4 MR进程"></a>4 MR进程</h1><h2 id="一个完整的MapReduce程序在分布式运行时有三类实例进程"><a href="#一个完整的MapReduce程序在分布式运行时有三类实例进程" class="headerlink" title="一个完整的MapReduce程序在分布式运行时有三类实例进程"></a>一个完整的MapReduce程序在分布式运行时有三类实例进程</h2><h3 id="1-MrAppMaster"><a href="#1-MrAppMaster" class="headerlink" title="1. MrAppMaster"></a>1. MrAppMaster</h3><p>负责整个程序的过程调度及状态协调</p><h3 id="2-MapTask"><a href="#2-MapTask" class="headerlink" title="2. MapTask"></a>2. MapTask</h3><p>负责Map阶段的整个阶段处理流程</p><h3 id="3-ReduceTask"><a href="#3-ReduceTask" class="headerlink" title="3. ReduceTask"></a>3. ReduceTask</h3><p>负责Reduce阶段的整个数据处理流程</p><h1 id="5-官方WordCount源码"><a href="#5-官方WordCount源码" class="headerlink" title="5 官方WordCount源码"></a>5 官方WordCount源码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.coachhe.hdfs; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br><span class="hljs-keyword">import</span> java.util.StringTokenizer; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration; <br><span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.IntWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Job; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Mapper; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Reducer; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; <br><span class="hljs-keyword">import</span> org.apache.hadoop.util.GenericOptionsParser; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">wordcount</span> &#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenizerMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span>&lt;Object, Text, Text, IntWritable&gt; &#123;   <span class="hljs-comment">//继承泛型类Mapper </span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">IntWritable</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntWritable</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">//定义hadoop数据类型IntWritable实例one，并且赋值为1 </span><br>        <span class="hljs-keyword">private</span> <span class="hljs-type">Text</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>();                                    <span class="hljs-comment">//定义hadoop数据类型Text实例word </span><br>  <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(Object key, Text value, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <span class="hljs-comment">//实现map函数 </span><br>            <span class="hljs-type">StringTokenizer</span> <span class="hljs-variable">itr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringTokenizer</span>(value.toString());<span class="hljs-comment">//Java的字符串分解类，默认分隔符“空格”、“制表符(‘\t’)”、“换行符(‘\n’)”、“回车符(‘\r’)” </span><br>  <br>            <span class="hljs-keyword">while</span> (itr.hasMoreTokens()) &#123;  <span class="hljs-comment">//循环条件表示返回是否还有分隔符。 </span><br>                word.set(itr.nextToken());   <span class="hljs-comment">// nextToken()：返回从当前位置到下一个分隔符的字符串，word.set()：Java数据类型与hadoop数据类型转换 </span><br>                context.write(word, one);   <span class="hljs-comment">//hadoop全局类context输出函数write; </span><br>            &#125; <br>        &#125; <br>  <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntSumReducer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;Text, IntWritable, Text, IntWritable&gt; &#123;    <span class="hljs-comment">//继承泛型类Reducer </span><br>        <span class="hljs-keyword">private</span> <span class="hljs-type">IntWritable</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntWritable</span>();   <span class="hljs-comment">//实例化IntWritable </span><br>  <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reduce</span><span class="hljs-params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123;  <span class="hljs-comment">//实现reduce </span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <br>            <span class="hljs-keyword">for</span> (IntWritable val : values)    <span class="hljs-comment">//循环values，并记录单词个数 </span><br>                sum += val.get(); <br>            result.set(sum);   <span class="hljs-comment">//Java数据类型sum，转换为hadoop数据类型result </span><br>            context.write(key, result);   <span class="hljs-comment">//输出结果到hdfs </span><br>        &#125; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();   <span class="hljs-comment">//实例化Configuration </span><br><span class="hljs-comment">/*********** </span><br><span class="hljs-comment">GenericOptionsParser是hadoop框架中解析命令行参数的基本类。 getRemainingArgs();返回数组 </span><br><span class="hljs-comment">【一组路径】 </span><br><span class="hljs-comment">**********/</span> <br><span class="hljs-comment">//函数实现 </span><br>        <span class="hljs-comment">/** </span><br><span class="hljs-comment">         public String[] getRemainingArgs() &#123; </span><br><span class="hljs-comment">         return (commandLine == null) ? new String[]&#123;&#125; : commandLine.getArgs(); </span><br><span class="hljs-comment">         &#125; </span><br><span class="hljs-comment">         **/</span> <br><span class="hljs-comment">//总结上面：返回数组【一组路径】 </span><br>        String[] otherArgs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericOptionsParser</span>(conf, args).getRemainingArgs(); <br>  <br><span class="hljs-comment">//如果只有一个路径，则输出需要有输入路径和输出路径 </span><br>        <span class="hljs-keyword">if</span> (otherArgs.length &lt; <span class="hljs-number">2</span>) &#123; <br>            System.err.println(<span class="hljs-string">&quot;Usage: wordcount &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;&quot;</span>); <br>            System.exit(<span class="hljs-number">2</span>); <br>        &#125; <br>  <br>        <span class="hljs-type">Job</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> Job.getInstance(conf, <span class="hljs-string">&quot;word count&quot;</span>);   <span class="hljs-comment">//实例化job </span><br>        job.setJarByClass(wordcount.class);   <span class="hljs-comment">//为了能够找到wordcount这个类 </span><br>        job.setMapperClass(TokenizerMapper.class);   <span class="hljs-comment">//指定map类型 </span><br><span class="hljs-comment">/******** </span><br><span class="hljs-comment">指定CombinerClass类 </span><br><span class="hljs-comment">这里很多人对CombinerClass不理解 </span><br><span class="hljs-comment">************/</span> <br>        job.setCombinerClass(IntSumReducer.class); <br>        job.setReducerClass(IntSumReducer.class);  <span class="hljs-comment">//指定reduce类 </span><br>        job.setOutputKeyClass(Text.class); <span class="hljs-comment">//rduce输出Key的类型，是Text </span><br>        job.setOutputValueClass(IntWritable.class);  <span class="hljs-comment">// rduce输出Value的类型 </span><br>  <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; otherArgs.length - <span class="hljs-number">1</span>; ++i) <br>            FileInputFormat.addInputPath(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(String.valueOf(otherArgs)));  <span class="hljs-comment">//添加输入路径 </span><br>  <br>        FileOutputFormat.setOutputPath(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(otherArgs[otherArgs.length - <span class="hljs-number">1</span>]));   <span class="hljs-comment">//添加输出路径 </span><br>        System.exit(job.waitForCompletion(<span class="hljs-literal">true</span>) ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>);  <span class="hljs-comment">//提交job </span><br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h1 id="6-常用数据序列化类型"><a href="#6-常用数据序列化类型" class="headerlink" title="6 常用数据序列化类型"></a>6 常用数据序列化类型</h1><table><thead><tr><th>Java类型</th><th>Hadoop Writable类型</th></tr></thead><tbody><tr><td>boolean</td><td>BooleanWritable</td></tr><tr><td>byte</td><td>ByteWritable</td></tr><tr><td>int</td><td>IntWritable</td></tr><tr><td>float</td><td>FloatWritable</td></tr><tr><td>long</td><td>LongWritable</td></tr><tr><td>double</td><td>DoubleWritable</td></tr><tr><td>String</td><td>Text</td></tr><tr><td>map</td><td>MapWritable</td></tr><tr><td>array</td><td>ArrayWritable</td></tr></tbody></table><h1 id="7-MR编程规范"><a href="#7-MR编程规范" class="headerlink" title="7 MR编程规范"></a>7 MR编程规范</h1><h2 id="用户编写的程序分为三个部分"><a href="#用户编写的程序分为三个部分" class="headerlink" title="用户编写的程序分为三个部分"></a>用户编写的程序分为三个部分</h2><ol><li>Mapper   </li><li>Reducer </li><li>Driver</li></ol><h2 id="Mapper阶段"><a href="#Mapper阶段" class="headerlink" title="Mapper阶段"></a>Mapper阶段</h2><ol><li>用户自定义的Mapper要继承自己的父类 </li><li>Mapper的输入数据是KV对的形式 </li><li>Mapper中的业务逻辑写在map()方法里面 </li><li>Mapper的输出数据是KV对的形式 </li><li>map()方法（MapTask进程）对每个KV对调用一次</li></ol><h2 id="Reducer阶段"><a href="#Reducer阶段" class="headerlink" title="Reducer阶段"></a>Reducer阶段</h2><ol><li>用户自定义的Reducer要继承自己的父类*</li><li>Reducer的输入类型对应Mapper的输出类型，也是KV </li><li>Reducer的业务逻辑写在reduce()方法中 </li><li>ReduceTask进程对每一组相同k的&lt;k,v&gt;组调用一次reduce()方法</li></ol><h2 id="Driver阶段"><a href="#Driver阶段" class="headerlink" title="Driver阶段"></a>Driver阶段</h2><p>相当于YARN集群的客户端，用于提交我们整个程序到YARN集群，提交的是封装了MapReduce程序相关参数的job对象。 </p><h1 id="WordCount案例实操"><a href="#WordCount案例实操" class="headerlink" title="WordCount案例实操"></a>WordCount案例实操</h1><h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>在给定的文本文件中统计输出每一个单词出现的次数。 </p><h3 id="输入数据"><a href="#输入数据" class="headerlink" title="输入数据"></a>输入数据</h3><p>wc_shicao<br><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211002920.png" style="zoom: 33%;" /></p><h3 id="期望输出数据"><a href="#期望输出数据" class="headerlink" title="期望输出数据"></a>期望输出数据</h3><p>coachhe 4<br>hello 1<br>Hello 2<br>I 1<br>love 1<br>playing 1<br>tennis 1<br>Java 1<br>Hadoop 1<br>Thank 1<br>you 1<br>atguigu 1 </p><h3 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h3><p>需要分别设计Mapper Reducer和Driver。 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003020.png"></p><h2 id="创建maven工程"><a href="#创建maven工程" class="headerlink" title="创建maven工程"></a>创建maven工程</h2><h1 id="创建maven工程-1"><a href="#创建maven工程-1" class="headerlink" title="创建maven工程"></a>创建maven工程</h1> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003121.png" style="zoom:25%;" />其中依赖和之前的相同。 <h2 id="WordCountMapper"><a href="#WordCountMapper" class="headerlink" title="WordCountMapper"></a>WordCountMapper</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003152.png" style="zoom:25%;" /><h3 id="对Mapper类的源码进行分析"><a href="#对Mapper类的源码进行分析" class="headerlink" title="对Mapper类的源码进行分析"></a>对Mapper类的源码进行分析</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003239.png" style="zoom:25%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003319.png" style="zoom:25%;" /><h3 id="具体写WordCountMapper类"><a href="#具体写WordCountMapper类" class="headerlink" title="具体写WordCountMapper类"></a>具体写WordCountMapper类</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003436.png" style="zoom:25%;" /><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// map阶段 </span><br><span class="hljs-comment">// KEYIN 第一个参数，为输入数据的key </span><br><span class="hljs-comment">// VALUEIN 第二个参数，为输入数据的value </span><br><span class="hljs-comment">// KEYOUT 第三个参数，为输出数据的key的类型， coachhe 3，在这里是coachhe，所以是Text </span><br><span class="hljs-comment">// VALUEOUT 第四个参数，为输出数据的value，根据上面，是3，所以是LongWritable </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordcountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span>&lt;LongWritable, Text, Text, LongWritable&gt; &#123; <br>  <br>    <span class="hljs-type">Text</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(); <br>    <span class="hljs-type">LongWritable</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongWritable</span>(); <br>  <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(LongWritable key, Text value, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>        <span class="hljs-comment">// coachhe coachhe  输入数据 </span><br>  <br>        <span class="hljs-comment">// 1 获取一行 </span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> value.toString(); <br>  <br>        <span class="hljs-comment">// 2 切割单词 </span><br>        String[] words = line.split(<span class="hljs-string">&quot; &quot;</span>); <br>  <br>        <span class="hljs-comment">// 3 循环写出 </span><br>        <span class="hljs-keyword">for</span> (String word : words) &#123; <br>            k.set(word); <br>            v.set(<span class="hljs-number">1</span>); <br>            context.write(k, v); <br>        &#125; <br>  <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="WordcountReducer"><a href="#WordcountReducer" class="headerlink" title="WordcountReducer"></a>WordcountReducer</h2><h3 id="创建WordcountReducer"><a href="#创建WordcountReducer" class="headerlink" title="创建WordcountReducer"></a>创建WordcountReducer</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003647.png" style="zoom:25%;" /><h3 id="对Reducer类的源码分析"><a href="#对Reducer类的源码分析" class="headerlink" title="对Reducer类的源码分析"></a>对Reducer类的源码分析</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003752.png" style="zoom:25%;" /><h3 id="具体写WordcountReducer"><a href="#具体写WordcountReducer" class="headerlink" title="具体写WordcountReducer"></a>具体写WordcountReducer</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003901.png" style="zoom:25%;" /><h2 id="Driver类"><a href="#Driver类" class="headerlink" title="Driver类"></a>Driver类</h2><h3 id="固定格式"><a href="#固定格式" class="headerlink" title="固定格式"></a>固定格式</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211003945.png" style="zoom:25%;" /><h3 id="最终代码"><a href="#最终代码" class="headerlink" title="最终代码"></a>最终代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.wordcount; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration; <br><span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.LongWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Job; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordCountDriver</span> &#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, InterruptedException &#123; <br>  <br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(); <br>        <span class="hljs-comment">// 1 获取Job对象 </span><br>        <span class="hljs-type">Job</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> Job.getInstance(conf); <br>  <br>        <span class="hljs-comment">// 2 设置jar存储位置 </span><br>        job.setJarByClass(WordCountDriver.class); <br>  <br>        <span class="hljs-comment">// 3 关联Map和Reduce类 </span><br>        job.setMapperClass(WordcountMapper.class); <br>        job.setReducerClass(WordcountReducer.class); <br>  <br>        <span class="hljs-comment">// 4 设置Mapper阶段输出数据的key-value类型 </span><br>        job.setMapOutputKeyClass(Text.class); <br>        job.setMapOutputValueClass(LongWritable.class); <br>  <br>        <span class="hljs-comment">// 5 设置最终数据输出的key和value类型 </span><br>        job.setOutputKeyClass(String.class); <br>        job.setOutputValueClass(Long.class); <br>  <br>        <span class="hljs-comment">// 6 设置程序运行的输入路径和输出路径 </span><br>        FileInputFormat.setInputPaths(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">0</span>])); <br>        FileOutputFormat.setOutputPath(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">1</span>])); <br>  <br>        <span class="hljs-comment">// 7 提交job </span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> job.waitForCompletion(<span class="hljs-literal">true</span>);<span class="hljs-comment">//提交完成之后会打印信息,若设置为false则不会打印信息 </span><br>  <br>        System.exit(result ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="IDEA参数设置"><a href="#IDEA参数设置" class="headerlink" title="IDEA参数设置"></a>IDEA参数设置</h2><p>因为我们在上面的输入路径为args[0]，输出路径为args[1]。因此需要在IDEA上设置参数： </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211004148.png" style="zoom:25%;" />以空格分开 <h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><h3 id="现在在我的-x2F-路径（注意：这里是集群的地址，因为我现在是完全分布式）下有一个wc-shicao文件。"><a href="#现在在我的-x2F-路径（注意：这里是集群的地址，因为我现在是完全分布式）下有一个wc-shicao文件。" class="headerlink" title="现在在我的&#x2F;路径（注意：这里是集群的地址，因为我现在是完全分布式）下有一个wc_shicao文件。"></a>现在在我的&#x2F;路径（注意：这里是集群的地址，因为我现在是完全分布式）下有一个wc_shicao文件。</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211004351.png" style="zoom:25%;" />  <h3 id="现在我想把他进行wordcount之后结果输出到-x2F-wc-shicao-output中。"><a href="#现在我想把他进行wordcount之后结果输出到-x2F-wc-shicao-output中。" class="headerlink" title="现在我想把他进行wordcount之后结果输出到&#x2F;wc_shicao_output中。"></a>现在我想把他进行wordcount之后结果输出到&#x2F;wc_shicao_output中。</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211004425.png" style="zoom:25%;" /><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><img src="https://pic.downk.cc/item/5fc785ca394ac52378b5765d.png" style="zoom:25%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>3 MR介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/1b48e7806303.html"/>
    <url>/2022/12/1b48e7806303.html</url>
    
    <content type="html"><![CDATA[<h1 id="一-序列化基本介绍"><a href="#一-序列化基本介绍" class="headerlink" title="一 序列化基本介绍"></a>一 序列化基本介绍</h1><h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1 概念"></a>1 概念</h2><h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>序列化就是把内存中的对象，转换成字节序列（或其他数据传输协议）以便存储到硬盘（持久化）或者网络传输。 </p><h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>将受到的字节序列（或者其他数据传输协议）或者是磁盘的持久化序列，转换成内存中的对象 </p><h2 id="序列化的原因"><a href="#序列化的原因" class="headerlink" title="序列化的原因"></a>序列化的原因</h2><p>一般来说，“活的”对象只生存在内存里，关机断电就没有了。而且“活的”对象只能有本地进程使用，不能被发送到网络上的另一台计算机。然而序列化可以存储“活的”对象，可以将“活的”对象发送到远程计算机。 </p><h2 id="为什么不用java的序列化"><a href="#为什么不用java的序列化" class="headerlink" title="为什么不用java的序列化"></a>为什么不用java的序列化</h2><p>Java序列化是一个重量级序列化框架，一个对象被序列化之后，会附带很多额外信息（各种校验信息，Header，继承体系等），不便于在网络中高效传输。所以Hadoop开发了自己的一套序列化机制（Writable） </p><h2 id="Hadoop序列化特点"><a href="#Hadoop序列化特点" class="headerlink" title="Hadoop序列化特点"></a>Hadoop序列化特点</h2><ol><li>高效实用存储空间</li><li>快速：读写数据的额外开销小 </li><li>可拓展：随着协议的升级可以升级 </li><li>互操作：支持多语言交互</li></ol><h1 id="二-自定义Bean对象实现序列化"><a href="#二-自定义Bean对象实现序列化" class="headerlink" title="二 自定义Bean对象实现序列化"></a>二 自定义Bean对象实现序列化</h1><p>在企业开发中往往常用的基本序列化类型不能满足所有需求，比如在Hadoop框架内部传递一个bean对象，那么该对象就需要实现序列化接口。  </p><h2 id="具体实现bean对象序列化步骤如下7步"><a href="#具体实现bean对象序列化步骤如下7步" class="headerlink" title="具体实现bean对象序列化步骤如下7步"></a>具体实现bean对象序列化步骤如下7步</h2><ol><li>必须实现Writable接口  </li><li>反序列化时，需要反射调用空参构造函数，所以必须有空参构造</li></ol><p>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">FlowBean</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>();<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>重写序列化方法</li></ol><p>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(DataOutput out)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    out.writeLong(upFlow);  <br>    out.writeLong(downFlow);  <br>    out.writeLong(sumFlow);  <br>&#125;  <br></code></pre></td></tr></table></figure><ol start="4"><li>重写反序列化方法</li></ol><p>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFields</span><span class="hljs-params">(DataInput in)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>    upFlow = in.readLong();  <br>    downFlow = in.readLong();  <br>    sumFlow = in.readLong();  <br>&#125;  <br></code></pre></td></tr></table></figure><ol start="5"><li>注意反序列化的顺序和序列化的顺序完全一致  </li><li>要想把结果显示在文件中，需要重写toString()，可用”\t”分开，方便后续用。  </li><li>如果需要将自定义的bean放在key中传输，则还需要实现Comparable接口，因为MapReduce框中的Shuffle过程要求对key必须能排序。详见后面排序案例。</li></ol><p>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(FlowBean o)</span> &#123;  <br>    <span class="hljs-comment">// 倒序排列，从大到小  </span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>;  <br>&#125;  <br></code></pre></td></tr></table></figure><h1 id="三-序列化案例实操"><a href="#三-序列化案例实操" class="headerlink" title="三 序列化案例实操"></a>三 序列化案例实操</h1><h2 id="1-输入输出数据"><a href="#1-输入输出数据" class="headerlink" title="1 输入输出数据"></a>1 输入输出数据</h2><h3 id="输入数据"><a href="#输入数据" class="headerlink" title="输入数据"></a>输入数据</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211005218.png" style="zoom:25%;" /><h3 id="输出数据"><a href="#输出数据" class="headerlink" title="输出数据"></a>输出数据</h3><p>手机号码 上行流量 下行流量 总流量 </p><h3 id="例如："><a href="#例如：" class="headerlink" title="例如："></a>例如：</h3><p>13760436666129  4200  4100 8300 </p><h2 id="2-案例分析"><a href="#2-案例分析" class="headerlink" title="2 案例分析"></a>2 案例分析</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211005538.png" style="zoom:25%;" /><h2 id="3-创建新的包和类"><a href="#3-创建新的包和类" class="headerlink" title="3 创建新的包和类"></a>3 创建新的包和类</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211005609.png" style="zoom:25%;" /><h2 id="4-FlowBean（重点）"><a href="#4-FlowBean（重点）" class="headerlink" title="4 FlowBean（重点）"></a>4 FlowBean（重点）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.flowsum; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Writable; <br>  <br><span class="hljs-keyword">import</span> java.io.DataInput; <br><span class="hljs-keyword">import</span> java.io.DataOutput; <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Writable</span> &#123; <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> upFlow; <span class="hljs-comment">//上行流量 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> downFlow; <span class="hljs-comment">//下行流量 </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> sumFlow; <span class="hljs-comment">//总流量 </span><br>  <br>    <span class="hljs-comment">//空参构造，为了后续反射用 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FlowBean</span><span class="hljs-params">()</span>&#123; <br>        <span class="hljs-built_in">super</span>(); <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FlowBean</span><span class="hljs-params">(<span class="hljs-type">long</span> upFlow, <span class="hljs-type">long</span> downFlow)</span> &#123; <br>        <span class="hljs-built_in">super</span>(); <br>        <span class="hljs-built_in">this</span>.upFlow = upFlow; <br>        <span class="hljs-built_in">this</span>.downFlow = downFlow; <br>        sumFlow = upFlow + downFlow; <br>    &#125; <br>  <br>    <span class="hljs-comment">//序列化方法 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(DataOutput dataOutput)</span> <span class="hljs-keyword">throws</span> IOException &#123; <br>        dataOutput.writeLong(upFlow); <br>        dataOutput.writeLong(downFlow); <br>        dataOutput.writeLong(sumFlow); <br>    &#125; <br>  <br>  <br>    <span class="hljs-comment">//反序列化方法 </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFields</span><span class="hljs-params">(DataInput dataInput)</span> <span class="hljs-keyword">throws</span> IOException &#123; <br>        upFlow = dataInput.readLong(); <br>        downFlow = dataInput.readLong(); <br>        sumFlow = dataInput.readLong(); <br>    &#125; <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span>  upFlow + <span class="hljs-string">&quot;\t&quot;</span> + downFlow + <span class="hljs-string">&quot;\t&quot;</span> + sumFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getUpFlow</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> upFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUpFlow</span><span class="hljs-params">(<span class="hljs-type">long</span> upFlow)</span> &#123; <br>        <span class="hljs-built_in">this</span>.upFlow = upFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDownFlow</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> downFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDownFlow</span><span class="hljs-params">(<span class="hljs-type">long</span> downFlow)</span> &#123; <br>        <span class="hljs-built_in">this</span>.downFlow = downFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getSumFlow</span><span class="hljs-params">()</span> &#123; <br>        <span class="hljs-keyword">return</span> sumFlow; <br>    &#125; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSumFlow</span><span class="hljs-params">(<span class="hljs-type">long</span> sumFlow)</span> &#123; <br>        <span class="hljs-built_in">this</span>.sumFlow = sumFlow; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="5-FlowCountMapper"><a href="#5-FlowCountMapper" class="headerlink" title="5 FlowCountMapper"></a>5 FlowCountMapper</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.flowsum; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.LongWritable; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Mapper; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowCountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span>&lt;LongWritable, Text, Text, FlowBean&gt; &#123; <br>  <br>    <span class="hljs-type">Text</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(); <br>    <span class="hljs-type">FlowBean</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowBean</span>(); <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">map</span><span class="hljs-params">(LongWritable key, Text value, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>  <br>        <span class="hljs-comment">// 7 138xxxxxxxx 120.178.231.32 1116 954 200 输入数据类型 </span><br>  <br>        <span class="hljs-comment">// 1 获取一行 </span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> value.toString(); <br>  <br>        <span class="hljs-comment">// 2 切割 </span><br>        String[] fieles = line.split(<span class="hljs-string">&quot; &quot;</span>); <br>  <br>        <span class="hljs-comment">// 3 封装对象 </span><br>        k.set(fieles[<span class="hljs-number">1</span>]);  <span class="hljs-comment">//封装手机号 </span><br>        v.setUpFlow(Long.parseLong(fieles[fieles.length - <span class="hljs-number">3</span>])); <br>        v.setDownFlow(Long.parseLong(fieles[fieles.length - <span class="hljs-number">2</span>])); <br>  <br>        <span class="hljs-comment">// 4 写出 </span><br>        context.write(k,v); <br>  <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="6-FlowCountReducer"><a href="#6-FlowCountReducer" class="headerlink" title="6 FlowCountReducer"></a>6 FlowCountReducer</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.flowsum; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Reducer; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowCountReducer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;Text, FlowBean, Text, FlowBean&gt; &#123; <br>    <span class="hljs-type">Text</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(); <br>  <br>    <span class="hljs-meta">@Override</span> <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reduce</span><span class="hljs-params">(Text key, Iterable&lt;FlowBean&gt; values, Context context)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException &#123; <br>        <span class="hljs-comment">// 138xxxxxxxx 2481 24861 3000 </span><br>        <span class="hljs-comment">// 138xxxxxxxx 318  32921 32893 </span><br>  <br>        <span class="hljs-type">long</span> <span class="hljs-variable">sum_upFlow</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <br>        <span class="hljs-type">long</span> <span class="hljs-variable">sum_downFlow</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <br>  <br>        <span class="hljs-comment">// 1 累加求和 </span><br>        <span class="hljs-keyword">for</span> (FlowBean flowBean : values) &#123; <br>            sum_downFlow += flowBean.getDownFlow(); <br>            sum_upFlow += flowBean.getUpFlow(); <br>        &#125; <br>  <br>        k.set(key); <br>        <span class="hljs-type">FlowBean</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowBean</span>(sum_upFlow, sum_downFlow); <br>  <br>        <span class="hljs-comment">// 2 写出 </span><br>        context.write(k, v); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><h2 id="7-FlowCountDriver"><a href="#7-FlowCountDriver" class="headerlink" title="7 FlowCountDriver"></a>7 FlowCountDriver</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.flowsum; <br>  <br><span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration; <br><span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path; <br><span class="hljs-keyword">import</span> org.apache.hadoop.io.Text; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.Job; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat; <br><span class="hljs-keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; <br>  <br><span class="hljs-keyword">import</span> java.io.IOException; <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowCountDriver</span> &#123; <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, InterruptedException &#123; <br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">0</span>) &#123; <br>            args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/Users/heyizhi/BigData/hadoop/my_project/MapReduce序列化结果/phone_data&quot;</span>, <br>            <span class="hljs-string">&quot;/Users/heyizhi/BigData/hadoop/my_project/MapReduce序列化结果/Output&quot;</span>&#125;; <br>        &#125; <br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(); <br>        <span class="hljs-comment">// 1 获取job对象 </span><br>        <span class="hljs-type">Job</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> Job.getInstance(conf); <br>  <br>        <span class="hljs-comment">// 2 设置jar路径 </span><br>        job.setJarByClass(FlowCountDriver.class); <br>  <br>        <span class="hljs-comment">// 3 关联mapper和reducer </span><br>        job.setMapperClass(FlowCountMapper.class); <br>        job.setReducerClass(FlowCountReducer.class); <br>  <br>        <span class="hljs-comment">// 4 设置mapper输出的key和value类型 </span><br>        job.setMapOutputKeyClass(Text.class); <br>        job.setMapOutputValueClass(FlowBean.class); <br>  <br>        <span class="hljs-comment">// 5 设置最终输出的key和value类型 </span><br>        job.setOutputKeyClass(Text.class); <br>        job.setOutputValueClass(FlowBean.class); <br>  <br>        <span class="hljs-comment">// 6 设置输入输出路径 </span><br>        FileInputFormat.setInputPaths(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">0</span>])); <br>        FileOutputFormat.setOutputPath(job, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(args[<span class="hljs-number">1</span>])); <br>  <br>        <span class="hljs-comment">// 7 提交job </span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> job.waitForCompletion(<span class="hljs-literal">true</span>); <br>  <br>        System.exit(result ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>); <br>  <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="8-输入和输出"><a href="#8-输入和输出" class="headerlink" title="8 输入和输出"></a>8 输入和输出</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211005948.png"></p><h2 id="9-Linux环境使用"><a href="#9-Linux环境使用" class="headerlink" title="9 Linux环境使用"></a>9 Linux环境使用</h2><p>首先还是参考4 打包成可以直接运行的jar包将其打包为jar包放入linux环境中。 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211010037.png"></p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>3 MR介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/cb497c2cb769.html"/>
    <url>/2022/12/cb497c2cb769.html</url>
    
    <content type="html"><![CDATA[<h1 id="InputFormat数据输入"><a href="#InputFormat数据输入" class="headerlink" title="InputFormat数据输入"></a>InputFormat数据输入</h1><h2 id="1-切片与MapTask并行度决定机制"><a href="#1-切片与MapTask并行度决定机制" class="headerlink" title="1 切片与MapTask并行度决定机制"></a>1 切片与MapTask并行度决定机制</h2><p>MapTask的并行度决定Map阶段的任务处理并发度，进而影响到整个Job的处理速度。 </p><h3 id="思考："><a href="#思考：" class="headerlink" title="思考："></a>思考：</h3><p>1G的数据，启动8个MapTask，可以提高集群的并发处理能力。那么1K的数据，也启动8个MapTask，会提高集群性能吗？MapTask并行任务是否越多越好呢？哪些因素影响了MapTask并行度？ </p><h2 id="2-数据块和数据切片定义"><a href="#2-数据块和数据切片定义" class="headerlink" title="2 数据块和数据切片定义"></a>2 数据块和数据切片定义</h2><h3 id="数据块"><a href="#数据块" class="headerlink" title="数据块"></a>数据块</h3><p>Block是HDFS物理上把数据分成一块一块 </p><h3 id="数据切片"><a href="#数据切片" class="headerlink" title="数据切片"></a>数据切片</h3><p>数据切片只是在逻辑上对输入进行分片，并不会在磁盘上将其节分成片进行存储。 </p><h2 id="3-数据切片与MapTask并行度决定机制"><a href="#3-数据切片与MapTask并行度决定机制" class="headerlink" title="3 数据切片与MapTask并行度决定机制"></a>3 数据切片与MapTask并行度决定机制</h2><ol><li><p>一个Job的Map阶段并行度由客户顿在提交Job时的切片数决定</p></li><li><p>每一个Split切片分配一个MapTask并行实例处理 </p></li><li><p>默认情况下，切片大小&#x3D;BlockSize </p></li><li><p>切片时不考虑数据集整体，而是逐个针对每一个文件单独切片。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211010729.png" style="zoom:25%;" /></li></ol><h3 id="解释："><a href="#解释：" class="headerlink" title="解释："></a>解释：</h3><p>数据是以Block的形式存放在DataNode里面，每个Block的大小默认为128M。<br>每个切片都对应一个Map过程，如果切片大小设置为100M，那么数据会非常分散，因此切片大小设置成Block的大小最合适，这样可以每个Block都对应一个Map过程，而不用跨DataNode去找数据。 </p><h1 id="2-Job提交流程源码解析"><a href="#2-Job提交流程源码解析" class="headerlink" title="2 Job提交流程源码解析"></a>2 Job提交流程源码解析</h1><h2 id="总的框架"><a href="#总的框架" class="headerlink" title="总的框架"></a>总的框架</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211011109.png" style="zoom:25%;" /><h2 id="Job提交流程源码"><a href="#Job提交流程源码" class="headerlink" title="Job提交流程源码"></a>Job提交流程源码</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211011548.png"></p><h2 id="Submit步骤"><a href="#Submit步骤" class="headerlink" title="Submit步骤"></a>Submit步骤</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211011750.png"></p><h1 id="3-Job切片机制源码解析"><a href="#3-Job切片机制源码解析" class="headerlink" title="3 Job切片机制源码解析"></a>3 Job切片机制源码解析</h1><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211011849.png" style="zoom:25%;" /><h2 id="具体源码分析"><a href="#具体源码分析" class="headerlink" title="具体源码分析"></a>具体源码分析</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211012034.png"></p><p>然后</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211012217.png"></p><p>然后</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211012300.png"></p><p>以下四幅图组成了这个方法</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211012344.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211012422.png"></p><p>![image-20201211012519983](&#x2F;Users&#x2F;heyizhi&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20201211012519983.png)</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211012540.png"></p><h1 id="4-FileInputFormat切片机制"><a href="#4-FileInputFormat切片机制" class="headerlink" title="4 FileInputFormat切片机制"></a>4 FileInputFormat切片机制</h1><h2 id="切片机制"><a href="#切片机制" class="headerlink" title="切片机制"></a>切片机制</h2><ol><li>简单按照文件的内容长度进行切片 </li><li>切片大小，默认等于Block大小 </li><li>切片时不考虑数据集整体，而是逐个对每一个文件单独切片。</li></ol><h2 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h2><h3 id="输入数据"><a href="#输入数据" class="headerlink" title="输入数据"></a>输入数据</h3><p>有两个文件 </p><p>file1.txt   320M<br>file2.txt   10M </p><h3 id="经过FileInputFormat的切片机制"><a href="#经过FileInputFormat的切片机制" class="headerlink" title="经过FileInputFormat的切片机制"></a>经过FileInputFormat的切片机制</h3><p>运算之后，形成的切片信息如下<br>file1.txt.split1– 0<del>128<br>file1.txt.split2– 128</del>256<br>file1.txt.split3– 256<del>320<br>file2.txt.split1– -</del>10M </p><h2 id="切片大小公式"><a href="#切片大小公式" class="headerlink" title="切片大小公式"></a>切片大小公式</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211013144.png" style="zoom:50%;" /><h2 id="其中computeSplitSize为"><a href="#其中computeSplitSize为" class="headerlink" title="其中computeSplitSize为"></a>其中computeSplitSize为</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211013214.png" style="zoom:50%;" /><p>minSize默认为1。<br>maxSize默认为Long的最大值。 </p><h2 id="切片大小配置"><a href="#切片大小配置" class="headerlink" title="切片大小配置"></a>切片大小配置</h2><h4 id="maxsize（切片最大值）"><a href="#maxsize（切片最大值）" class="headerlink" title="maxsize（切片最大值）"></a>maxsize（切片最大值）</h4><p>参数如果调的比blockSize小，则会让切片变小，而且就等于这个参数的值 </p><h4 id="minsize（切片最小值）"><a href="#minsize（切片最小值）" class="headerlink" title="minsize（切片最小值）"></a>minsize（切片最小值）</h4><p>参数调的比blockSize大，则会让切片变得比blockSize还大，且等于这个参数的值 </p><h2 id="获得切片信息API"><a href="#获得切片信息API" class="headerlink" title="获得切片信息API"></a>获得切片信息API</h2><h3 id="获取切片的文件名称"><a href="#获取切片的文件名称" class="headerlink" title="获取切片的文件名称"></a>获取切片的文件名称</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> inputSplits.getPath().getName(); <br></code></pre></td></tr></table></figure><h3 id="根据文件类型获取切片信息"><a href="#根据文件类型获取切片信息" class="headerlink" title="根据文件类型获取切片信息"></a>根据文件类型获取切片信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">FileSplit</span> <span class="hljs-variable">inputSplit</span> <span class="hljs-operator">=</span> (FileSplit) context.getInputSplit();<br></code></pre></td></tr></table></figure><h1 id="5-CombineTextInputFormat"><a href="#5-CombineTextInputFormat" class="headerlink" title="5 CombineTextInputFormat"></a>5 CombineTextInputFormat</h1><h2 id="使用原因和场景"><a href="#使用原因和场景" class="headerlink" title="使用原因和场景"></a>使用原因和场景</h2><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>默认的为TextInputFormat切片机制，是对任务按文件规划切片，不管文件多小，都会是一个单独的切片，都会教给一个MapTask，这样如果有大量小文件，就会产生大量的MapTask，效率极其低下。 </p><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>因此CombineTextInputFormat用于小文件过多的场景，它可以将多个小文件从逻辑上规划到一个切片中，这样，多个小文件就可以交给一个MapTask处理。 </p><h2 id="虚拟存储切片最大值设置"><a href="#虚拟存储切片最大值设置" class="headerlink" title="虚拟存储切片最大值设置"></a>虚拟存储切片最大值设置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">CombineTextInputFormat.setMaxInputSplitSize(job, <span class="hljs-number">4194304</span>);<span class="hljs-comment">// 4m  </span><br></code></pre></td></tr></table></figure><p>注意：虚拟存储切片最大值设置最好根据实际的小文件大小情况来设置具体的值。 </p><h2 id="切片机制-1"><a href="#切片机制-1" class="headerlink" title="切片机制"></a>切片机制</h2><h3 id="（1）虚拟存储过程："><a href="#（1）虚拟存储过程：" class="headerlink" title="（1）虚拟存储过程："></a>（1）虚拟存储过程：</h3><p>将输入目录下所有文件大小，依次和设置的setMaxInputSplitSize值比较，如果不大于设置的最大值，逻辑上划分一个块。如果输入文件大于设置的最大值且大于两倍，那么以最大值切割一块；当剩余数据大小超过设置的最大值且不大于最大值2倍，此时将文件均分成2个虚拟存储块（防止出现太小切片）。 </p><p>例如setMaxInputSplitSize值为4M，输入文件大小为8.02M，则先逻辑上分成一个4M。剩余的大小为4.02M，如果按照4M逻辑划分，就会出现0.02M的小的虚拟存储文件，所以将剩余的4.02M文件切分成（2.01M和2.01M）两个文件。 </p><h3 id="（2）切片过程："><a href="#（2）切片过程：" class="headerlink" title="（2）切片过程："></a>（2）切片过程：</h3><p>（a）判断虚拟存储的文件大小是否大于setMaxInputSplitSize值，大于等于则单独形成一个切片。 </p><p>（b）如果不大于则跟下一个虚拟存储文件进行合并，共同形成一个切片。 </p><p>（c）测试举例：</p><p>有4个小文件大小分别为1.7M、5.1M、3.4M以及6.8M这四个小文件，则虚拟存储之后形成6个文件块，大小分别为： 1.7M，（2.55M、2.55M），3.4M以及（3.4M、3.4M） 。最终会形成3个切片，大小分别为： （1.7+2.55）M，（2.55+3.4）M，（3.4+3.4）M </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211013700.png" style="zoom: 25%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>3 MR介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/27325198a886.html"/>
    <url>/2022/12/27325198a886.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-MapTasks工作机制"><a href="#1-MapTasks工作机制" class="headerlink" title="1 MapTasks工作机制"></a>1 MapTasks工作机制</h1><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211022138.png"></p><h2 id="具体"><a href="#具体" class="headerlink" title="具体"></a>具体</h2><p>（1）Read阶段：MapTask通过用户编写的RecordReader，从输入InputSplit中解析出一个个key&#x2F;value。 </p><p>（2）Map阶段：该节点主要是将解析出的key&#x2F;value交给用户编写map()函数处理，并产生一系列新的key&#x2F;value。 </p><p>（3）Collect收集阶段：在用户编写map()函数中，当数据处理完成后，一般会调用OutputCollector.collect()输出结果。在该函数内部，它会将生成的key&#x2F;value分区（调用Partitioner），并写入一个环形内存缓冲区中。 </p><p>（4）Spill阶段：即“溢写”，当环形缓冲区满后，MapReduce会将数据写到本地磁盘上，生成一个临时文件。需要注意的是，将数据写入本地磁盘之前，先要对数据进行一次本地排序，并在必要时对数据进行合并、压缩等操作。 </p><h3 id="溢写阶段详情"><a href="#溢写阶段详情" class="headerlink" title="溢写阶段详情"></a>溢写阶段详情</h3><p>步骤1：利用快速排序算法对缓存区内的数据进行排序，排序方式是，先按照分区编号Partition进行排序，然后按照key进行排序。这样，经过排序后，数据以分区为单位聚集在一起，且同一分区内所有数据按照key有序。 </p><p>步骤2：按照分区编号由小到大依次将每个分区中的数据写入任务工作目录下的临时文件output&#x2F;spillN.out（N表示当前溢写次数）中。如果用户设置了Combiner，则写入文件之前，对每个分区中的数据进行一次聚集操作。 </p><p>步骤3：将分区数据的元信息写到内存索引数据结构SpillRecord中，其中每个分区的元信息包括在临时文件中的偏移量、压缩前数据大小和压缩后数据大小。如果当前内存索引大小超过1MB，则将内存索引写到文件output&#x2F;spillN.out.index中。 </p><p>（5）Combine阶段：当所有数据处理完成后，MapTask对所有临时文件进行一次合并，以确保最终只会生成一个数据文件。 </p><p>当所有数据处理完后，MapTask会将所有临时文件合并成一个大文件，并保存到文件output&#x2F;file.out中，同时生成相应的索引文件output&#x2F;file.out.index。 </p><p>在进行文件合并过程中，MapTask以分区为单位进行合并。对于某个分区，它将采用多轮递归合并的方式。每轮合并io.sort.factor（默认10）个文件，并将产生的文件重新加入待合并列表中，对文件排序后，重复以上过程，直到最终得到一个大文件。 </p><p>让每个MapTask最终只生成一个数据文件，可避免同时打开大量文件和同时读取大量小文件产生的随机读取带来的开销。</p><h1 id="2-ReduceTasks工作机制"><a href="#2-ReduceTasks工作机制" class="headerlink" title="2 ReduceTasks工作机制"></a>2 ReduceTasks工作机制</h1><h2 id="大纲-1"><a href="#大纲-1" class="headerlink" title="大纲"></a>大纲</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211022242.png"></p><h2 id="具体-1"><a href="#具体-1" class="headerlink" title="具体"></a>具体</h2><p>（1）Copy阶段：ReduceTask从各个MapTask上远程拷贝一片数据，并针对某一片数据，如果其大小超过一定阈值，则写到磁盘上，否则直接放到内存中。 </p><p>（2）Merge阶段：在远程拷贝数据的同时，ReduceTask启动了两个后台线程对内存和磁盘上的文件进行合并，以防止内存使用过多或磁盘上文件过多。 </p><p>（3）Sort阶段：按照MapReduce语义，用户编写reduce()函数输入数据是按key进行聚集的一组数据。为了将key相同的数据聚在一起，Hadoop采用了基于排序的策略。由于各个MapTask已经实现对自己的处理结果进行了局部排序，因此，ReduceTask只需对所有数据进行一次归并排序即可。 </p><p>（4）Reduce阶段：reduce()函数将计算结果写到HDFS上。 </p><h2 id="设置ReduceTask并发度"><a href="#设置ReduceTask并发度" class="headerlink" title="设置ReduceTask并发度"></a>设置ReduceTask并发度</h2><p>ReduceTask的并行度同样影响整个Job的执行并发度和执行效率，但与MapTask的并发数由切片数决定不同，ReduceTask数量的决定是可以直接手动设置： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 默认值是1，手动设置为4 </span><br>job.setNumReduceTasks(<span class="hljs-number">4</span>); <br></code></pre></td></tr></table></figure><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201211022459.png" style="zoom:33%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>3 MR介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/d5715e7030b7.html"/>
    <url>/2022/12/d5715e7030b7.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、HDFS定义"><a href="#一、HDFS定义" class="headerlink" title="一、HDFS定义"></a>一、HDFS定义</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>HDFS是一个文件系统，用于存储文件，通过目录树来定位文件； </p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>它是分布式的，由很多服务器联合起来实现其功能，集群中的服务器有各自的角色。 </p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>适合一次写入，多次读出的场景，且不支持文件的修改。适合用来做数据分析，并不适合用来做网盘应用。 </p><h1 id="二、HDFS优缺点"><a href="#二、HDFS优缺点" class="headerlink" title="二、HDFS优缺点"></a>二、HDFS优缺点</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><h4 id="1-高容错性"><a href="#1-高容错性" class="headerlink" title="1. 高容错性"></a>1. 高容错性</h4><ol><li>数据自动保存多个副本，通过增加副本的形式提高容错性。 </li><li>某一个副本丢失以后，可以自动恢复</li></ol><h4 id="2-适合处理大数据"><a href="#2-适合处理大数据" class="headerlink" title="2. 适合处理大数据"></a>2. 适合处理大数据</h4><ol><li>数据规模：能够处理数据规模达到GB、TB甚至PB级别的数据 </li><li>文件规模：能够处理百万规模以上的文件数量，数量相当之大</li></ol><h4 id="3-可以构建在廉价机器上"><a href="#3-可以构建在廉价机器上" class="headerlink" title="3. 可以构建在廉价机器上"></a>3. 可以构建在廉价机器上</h4><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><h4 id="1-不适合低延时数据访问"><a href="#1-不适合低延时数据访问" class="headerlink" title="1. 不适合低延时数据访问"></a>1. 不适合低延时数据访问</h4><h4 id="2-无法高效对大量小文件进行存储"><a href="#2-无法高效对大量小文件进行存储" class="headerlink" title="2. 无法高效对大量小文件进行存储"></a>2. 无法高效对大量小文件进行存储</h4><ol><li>存储大量小文件的话，它会占用NameNode大量内存来做存储文件和快信息，这样是不可取的，因为NameNode的内存总是有限的。 </li><li>小文件存储的寻址时间会超过读取时间。</li></ol><h4 id="3-不支持并发写入-文件随机修改"><a href="#3-不支持并发写入-文件随机修改" class="headerlink" title="3. 不支持并发写入,文件随机修改"></a>3. 不支持并发写入,文件随机修改</h4><ol><li>一个文件只能有一个写,不允许多个线程同时写 </li><li>仅支持数据追加,不支持文件的随机修改.</li></ol><h1 id="三、HDFS组成架构"><a href="#三、HDFS组成架构" class="headerlink" title="三、HDFS组成架构"></a>三、HDFS组成架构</h1><h2 id="NameNode（nn）：就是Master，它是一个主管，管理者"><a href="#NameNode（nn）：就是Master，它是一个主管，管理者" class="headerlink" title="NameNode（nn）：就是Master，它是一个主管，管理者"></a>NameNode（nn）：就是Master，它是一个主管，管理者</h2><ol><li>管理HDFS的名称空间 </li><li>配置副本策略 </li><li>管理数据块（Block）映射信息 </li><li>处理客户端读写请求</li></ol><h2 id="DataNode：就是Slave，NameNode下达命令，DataNode执行实际的操作"><a href="#DataNode：就是Slave，NameNode下达命令，DataNode执行实际的操作" class="headerlink" title="DataNode：就是Slave，NameNode下达命令，DataNode执行实际的操作"></a>DataNode：就是Slave，NameNode下达命令，DataNode执行实际的操作</h2><ol><li>存储实际的数据块 </li><li>执行数据块的读&#x2F;写操作</li></ol><h2 id="Client：就是客户端"><a href="#Client：就是客户端" class="headerlink" title="Client：就是客户端"></a>Client：就是客户端</h2><ol><li>文件切片。文件上传HDFS的时候，Client将文件切分成一个个的Block，然后进行上传 </li><li>与NameNode交互，获取文件的位置信息。 </li><li>与Data交互，去读或者写入数据 </li><li>Client提供一些命令来管理HDFS，比如NameNode格式化 </li><li>Client可以通过一些命令来访问HDFS，比如对HDFS增删改查等操作</li></ol><h2 id="Secondary-Namenode：并非NameNode的热备。当NameNode挂掉的时候，它并不能马上替换NameNode并提供服务"><a href="#Secondary-Namenode：并非NameNode的热备。当NameNode挂掉的时候，它并不能马上替换NameNode并提供服务" class="headerlink" title="Secondary Namenode：并非NameNode的热备。当NameNode挂掉的时候，它并不能马上替换NameNode并提供服务"></a>Secondary Namenode：并非NameNode的热备。当NameNode挂掉的时候，它并不能马上替换NameNode并提供服务</h2><ol><li>辅助NameNode，分担其工作量个，比如定期合并Fsimage（镜像文件）和Edits（编辑日志），并推送给NameNode </li><li>在紧急情况下，可辅助恢复NameNode</li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160627.png" style="zoom:80%;" /><h1 id="四、-HDFS文件块大小"><a href="#四、-HDFS文件块大小" class="headerlink" title="四、 HDFS文件块大小"></a>四、 HDFS文件块大小</h1><h2 id="文件块大小为128M的原因"><a href="#文件块大小为128M的原因" class="headerlink" title="文件块大小为128M的原因"></a>文件块大小为128M的原因</h2><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210160648.png" style="zoom: 50%;" /><h2 id="为什么块的大小不能过大或者过小"><a href="#为什么块的大小不能过大或者过小" class="headerlink" title="为什么块的大小不能过大或者过小"></a>为什么块的大小不能过大或者过小</h2><h4 id="1-太小："><a href="#1-太小：" class="headerlink" title="1. 太小："></a>1. 太小：</h4><p>增加寻址时间 </p><h4 id="2-太大："><a href="#2-太大：" class="headerlink" title="2. 太大："></a>2. 太大：</h4><p>从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间，导师程序在处理这块数据时会非常慢。 </p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>HDFS块的大小设置主要取决于硬盘传输速度。 </p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>2 HDFS介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/5081bba9e534.html"/>
    <url>/2022/12/5081bba9e534.html</url>
    
    <content type="html"><![CDATA[<h1 id="Session-mode"><a href="#Session-mode" class="headerlink" title="Session mode"></a>Session mode</h1><p>一共有5个文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~/kubernetes/flink/install/deploy/session-mode]# ll<br>total 24<br>-rw-r--r-- 1 coachhe users 2442 Oct 31 00:44 flink-configuration-configmap.yaml<br>-rw-r--r-- 1 coachhe users  225 Oct 31 00:36 jobmanager-rest-service.yaml<br>-rw-r--r-- 1 coachhe users  247 Oct 31 00:44 jobmanager-service.yaml<br>-rw-r--r-- 1 coachhe users 1165 Oct 31 00:41 jobmanager-session-deployment.yaml<br>-rw-r--r-- 1 coachhe users  241 Oct 31 00:40 taskmanager-query-state-service.yaml<br>-rw-r--r-- 1 coachhe users 1119 Oct 31 00:38 taskmanager-session-deployment.yaml<br></code></pre></td></tr></table></figure><p>现在我们来一个个看。</p><h2 id="configmap"><a href="#configmap" class="headerlink" title="configmap"></a>configmap</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># flink-configuration-configmap.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">flink-conf.yaml:</span> <span class="hljs-string">|+</span><br><span class="hljs-string">    jobmanager.rpc.address: flink-jobmanager</span><br><span class="hljs-string">    taskmanager.numberOfTaskSlots: 2</span><br><span class="hljs-string">    blob.server.port: 6124</span><br><span class="hljs-string">    jobmanager.rpc.port: 6123</span><br><span class="hljs-string">    taskmanager.rpc.port: 6122</span><br><span class="hljs-string">    queryable-state.proxy.ports: 6125</span><br><span class="hljs-string">    jobmanager.memory.process.size: 1600m</span><br><span class="hljs-string">    taskmanager.memory.process.size: 1728m</span><br><span class="hljs-string">    parallelism.default: 2</span><br><span class="hljs-string"></span>  <span class="hljs-attr">log4j-console.properties:</span> <span class="hljs-string">|+</span><br><span class="hljs-string">    # This affects logging for both user code and Flink</span><br><span class="hljs-string">    rootLogger.level = INFO</span><br><span class="hljs-string">    rootLogger.appenderRef.console.ref = ConsoleAppender</span><br><span class="hljs-string">    rootLogger.appenderRef.rolling.ref = RollingFileAppender</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    # Uncomment this if you want to _only_ change Flink&#x27;s logging</span><br><span class="hljs-string">    #logger.flink.name = org.apache.flink</span><br><span class="hljs-string">    #logger.flink.level = INFO</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    # The following lines keep the log level of common libraries/connectors on</span><br><span class="hljs-string">    # log level INFO. The root logger does not override this. You have to manually</span><br><span class="hljs-string">    # change the log levels here.</span><br><span class="hljs-string">    logger.akka.name = akka</span><br><span class="hljs-string">    logger.akka.level = INFO</span><br><span class="hljs-string">    logger.kafka.name= org.apache.kafka</span><br><span class="hljs-string">    logger.kafka.level = INFO</span><br><span class="hljs-string">    logger.hadoop.name = org.apache.hadoop</span><br><span class="hljs-string">    logger.hadoop.level = INFO</span><br><span class="hljs-string">    logger.zookeeper.name = org.apache.zookeeper</span><br><span class="hljs-string">    logger.zookeeper.level = INFO</span><br><span class="hljs-string"></span>    <br>    <span class="hljs-comment"># Log all infos to the console</span><br>    <span class="hljs-string">appender.console.name</span> <span class="hljs-string">=</span> <span class="hljs-string">ConsoleAppender</span><br>    <span class="hljs-string">appender.console.type</span> <span class="hljs-string">=</span> <span class="hljs-string">CONSOLE</span><br>    <span class="hljs-string">appender.console.layout.type</span> <span class="hljs-string">=</span> <span class="hljs-string">PatternLayout</span><br>    <span class="hljs-string">appender.console.layout.pattern</span> <span class="hljs-string">=</span> <span class="hljs-string">%d&#123;yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss,SSS&#125;</span> <span class="hljs-string">%-5p</span> <span class="hljs-string">%-60c</span> <span class="hljs-string">%x</span> <span class="hljs-bullet">-</span> <span class="hljs-string">%m%n</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Log all infos in the given rolling file</span><br>    <span class="hljs-string">appender.rolling.name</span> <span class="hljs-string">=</span> <span class="hljs-string">RollingFileAppender</span><br>    <span class="hljs-string">appender.rolling.type</span> <span class="hljs-string">=</span> <span class="hljs-string">RollingFile</span><br>    <span class="hljs-string">appender.rolling.append</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span><br>    <span class="hljs-string">appender.rolling.fileName</span> <span class="hljs-string">=</span> <span class="hljs-string">$&#123;sys:log.file&#125;</span><br>    <span class="hljs-string">appender.rolling.filePattern</span> <span class="hljs-string">=</span> <span class="hljs-string">$&#123;sys:log.file&#125;.%i</span><br>    <span class="hljs-string">appender.rolling.layout.type</span> <span class="hljs-string">=</span> <span class="hljs-string">PatternLayout</span><br>    <span class="hljs-string">appender.rolling.layout.pattern</span> <span class="hljs-string">=</span> <span class="hljs-string">%d&#123;yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss,SSS&#125;</span> <span class="hljs-string">%-5p</span> <span class="hljs-string">%-60c</span> <span class="hljs-string">%x</span> <span class="hljs-bullet">-</span> <span class="hljs-string">%m%n</span><br>    <span class="hljs-string">appender.rolling.policies.type</span> <span class="hljs-string">=</span> <span class="hljs-string">Policies</span><br>    <span class="hljs-string">appender.rolling.policies.size.type</span> <span class="hljs-string">=</span> <span class="hljs-string">SizeBasedTriggeringPolicy</span><br>    <span class="hljs-string">appender.rolling.policies.size.size=100MB</span><br>    <span class="hljs-string">appender.rolling.strategy.type</span> <span class="hljs-string">=</span> <span class="hljs-string">DefaultRolloverStrategy</span><br>    <span class="hljs-string">appender.rolling.strategy.max</span> <span class="hljs-string">=</span> <span class="hljs-number">10</span><br>    <br>    <span class="hljs-comment"># Suppress the irrelevant (wrong) warnings from the Netty channel handler</span><br>    <span class="hljs-string">logger.netty.name</span> <span class="hljs-string">=</span> <span class="hljs-string">org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline</span><br>    <span class="hljs-string">logger.netty.level</span> <span class="hljs-string">=</span> <span class="hljs-string">OFF%</span><br></code></pre></td></tr></table></figure><p>可以看到，这里就是通过data属性定义了两个配置信息flink-conf.yaml和log4j-console.properties，在这里值得注意的是，因为deployment使用configmap之后，是会将对应内容转换成文件挂载在对应的目录下，和我们的需求整好是符合的，我们需要将这两个配置信息转换为文件进行存储和使用。</p><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># jobmanager-service.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6123</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">blob-server</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6124</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">webui</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>    <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br></code></pre></td></tr></table></figure><p>可以看到，这是个ClusterIP类型的Service，作用是将6123、6124、8081三个端口对外暴露并且实现负载均衡。</p><h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><ol><li>jobmanager-session-deployment.yaml</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flink-jobmanager</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>      <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">flink</span><br>        <span class="hljs-attr">component:</span> <span class="hljs-string">jobmanager</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">jobmanager</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">flink:1.11.1-scala_2.11</span><br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;jobmanager&quot;</span>]<br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6123</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">rpc</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">6124</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">blob-server</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8081</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">webui</span><br>        <span class="hljs-attr">livenessProbe:</span><br>          <span class="hljs-attr">tcpSocket:</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">6123</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span><br>          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">60</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/opt/flink/conf</span><br>        <span class="hljs-attr">securityContext:</span><br>          <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">9999</span>  <span class="hljs-comment"># refers to user _flink_ from official flink image, change if necessary</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config-volume</span><br>        <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">flink-config</span><br>          <span class="hljs-attr">items:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">flink-conf.yaml</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">flink-conf.yaml</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">log4j-console.properties</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">log4j-console.properties</span><br></code></pre></td></tr></table></figure><p>针对上面的字段我们展开分析：</p><h2 id="apiVersion"><a href="#apiVersion" class="headerlink" title="apiVersion"></a>apiVersion</h2><p>版本号，这个没什么好说的。</p><h2 id="kind"><a href="#kind" class="headerlink" title="kind"></a>kind</h2><p>Api类型，表明这是一个Deployment</p><h1 id="metadata"><a href="#metadata" class="headerlink" title="metadata"></a>metadata</h1><p>元数据，表明该deployment的名字为<code>flink-jobmanager</code>，一般还会有一个label字段，</p><p>replicas</p><p>副本数量，这就是指定的Kubernetes集群里须要运行多少个Pod实例。当Pod异常退出或者挂掉的时候可以自动重启。</p><p>2. </p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/程序员/工具/git/image-20221111013522113.png" width = "30%" /><p>首先看看红框里的字段。我们先</p>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>K8S</category>
      
      <category>极客时间</category>
      
      <category>深入剖析k8s</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e2c43413917c.html"/>
    <url>/2022/12/e2c43413917c.html</url>
    
    <content type="html"><![CDATA[<h1 id="HDFS写数据流程"><a href="#HDFS写数据流程" class="headerlink" title="HDFS写数据流程"></a>HDFS写数据流程</h1><h2 id="1-剖析文件写入"><a href="#1-剖析文件写入" class="headerlink" title="1 剖析文件写入"></a>1 剖析文件写入</h2><img src="https://pic.downk.cc/item/5fc78128394ac52378b32230.png" style="zoom: 50%;" /><p>1）客户端通过Distributed FileSystem模块向NameNode请求上传文件，NameNode检查目标文件是否已存在，父目录是否存在。<br>2）NameNode返回是否可以上传。<br>3）客户端请求第一个Block上传到哪几个DataNode服务器上。<br>4）NameNode返回3个DataNode节点，分别为dn1、dn2、dn3。<br>5）客户端通过FSDataOutputStream模块请求dn1上传数据，dn1收到请求会继续调用dn2，然后dn2调用dn3，将这个通信管道建立完成。<br>6）dn1、dn2、dn3逐级应答客户端。<br>7）客户端开始往dn1上传第一个Block（先从磁盘读取数据放到一个本地内存缓存），以Packet为单位，dn1收到一个Packet就会传给dn2，dn2传给dn3；&#x3D;&#x3D;<strong>dn1每传一个packet会放入一个应答队列等待应答</strong>&#x3D;&#x3D;。<br>8）当一个Block传输完成之后，客户端再次请求NameNode上传第二个Block的服务器。（重复执行3-7步）。</p><h2 id="2-网络拓扑-节点计算"><a href="#2-网络拓扑-节点计算" class="headerlink" title="2 网络拓扑-节点计算"></a>2 网络拓扑-节点计算</h2><p>在HDFS写数据的过程中，NameNode会选择距离待上传数据最近距离的DataNode接收数据。那么这个最近距离怎么计算呢？</p><h3 id="节点距离"><a href="#节点距离" class="headerlink" title="节点距离"></a>节点距离</h3><p>两个节点到达最近的共同祖先的距离总和。<br><img src="https://pic.downk.cc/item/5fc78128394ac52378b3221b.png" style="zoom:50%;" /></p><pre><code class="hljs">## 3 副本存储节点选择</code></pre><img src="https://pic.downk.cc/item/5fc78128394ac52378b32203.png" style="zoom:50%;" /><h1 id="HDFS读数据流程"><a href="#HDFS读数据流程" class="headerlink" title="HDFS读数据流程"></a>HDFS读数据流程</h1><img src="https://pic.downk.cc/item/5fc78128394ac52378b321e0.png" style="zoom:50%;" /><p>1）客户端通过Distributed FileSystem向NameNode请求下载文件，NameNode通过查询元数据，找到文件块所在的DataNode地址。<br>2）挑选一台DataNode（就近原则，然后随机）服务器，请求读取数据。<br>3）DataNode开始传输数据给客户端（从磁盘里面读取数据输入流，以Packet为单位来做校验）。<br>4）客户端以Packet为单位接收，先在本地缓存，然后写入目标文件。  </p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>2 HDFS介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/bc0a1405c822.html"/>
    <url>/2022/12/bc0a1405c822.html</url>
    
    <content type="html"><![CDATA[<img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210184302.png" style="zoom: 67%;" /><p>1）一个数据块在DataNode上以文件形式存储在磁盘上，包括两个文件，一个是数据本身，一个是元数据包括数据块的长度，块数据的校验和，以及时间戳。<br>2）DataNode启动后向NameNode注册，通过后，周期性（1小时）的向NameNode上报所有的块信息。<br>3）心跳是每3秒一次，心跳返回结果带有NameNode给该DataNode的命令如复制块数据到另一台机器，或删除某个数据块。如果超过10分钟没有收到某个DataNode的心跳，则认为该节点不可用。<br>4）集群运行中可以安全加入和退出一些机器。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>2 HDFS介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/4009f3cc8d13.html"/>
    <url>/2022/12/4009f3cc8d13.html</url>
    
    <content type="html"><![CDATA[<h1 id="ClusterIP-模式的-Service"><a href="#ClusterIP-模式的-Service" class="headerlink" title="ClusterIP 模式的 Service"></a>ClusterIP 模式的 Service</h1><p>现在我有一个Service：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hostnames</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">hostnames</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">default</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9376</span><br></code></pre></td></tr></table></figure><p>解释：</p><ul><li><code>metadata</code>是元数据，代表想要创建的service的信息，这里只指定了一个name，代表想创建的service叫做hostnames。</li><li><code>selector</code>是声明，声明这个 Service 只代理携带了 app&#x3D;hostnames 标签的 Pod。</li><li><code>ports</code>是端口声明，说明这个 Service 的 80 端口，代理的是 Pod 的 9376 端口，协议是TCP。</li></ul><p>此时我可以直接<code>kubectl apply -f service.yaml</code></p><p>这样会创建一个服务：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221109001633876.png" alt="image-20221109001633876"></p><p>可以看见，服务名为<code>hostnames</code>，类型是<code>ClusterIP</code>，集群IP是<code>10.98.37.204</code>。</p><p>被service选中的pod，就被称为该service的<strong>endpoints</strong>。</p><p>值得注意的是，在这里我们选择是携带app&#x3D;hostnames标签的pod，但是因为我们此时还没有创建对应的deployment，所以我们获取该service对应的endpoints时，获取得到的结果会为空。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221109002408294.png" alt="image-20221109002408294"></p><p>此时我们来创建对应的deployment，编写了以下yaml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hostnames</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">hostnames</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">hostnames</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hostnames</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">k8s.gcr.io/serve_hostname</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9376</span><br>          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br></code></pre></td></tr></table></figure><p>解释：</p><ul><li><code>metadata</code>是元数据，代表想要创建的deploy的信息，这里只指定了一个name，代表想创建的deploy叫做hostnames。</li><li><code>app</code>代表标签，标签名为<code>hostname</code></li></ul><p>然后我们执行<code>kubectl apply -f deploy.yaml</code>：</p><p>这个应用的作用，就是每次访问 9376 端口时，返回它自己的 hostname。</p><p>此时我们再获取上面service的endpoints，就可以看到多出了三个endpoints</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221109003101025.png" alt="image-20221109003101025"></p><p>这三个endpoints就对应三个pods的ip地址对应的9376端口：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221109003147330.png" alt="image-20221109003147330"></p><p>需要注意的是，只有处于 Running 状态，且 readinessProbe 检查通过的 Pod，才会出现在 Service 的 Endpoints 列表里。并且，当某一个 Pod 出现问题时，Kubernetes 会自动把它从 Service 里摘除掉。</p><p>此时我们就可以通过访问该Service的url来访问对应的pods了：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221109003413489.png" alt="image-20221109003413489"></p><p>可以看到，我首先获取了该service的IP地址，然后连续访问了三次该IP地址对应的80端口，得到了三个不同的hostname，证明实现了负载均衡以及代理Pod的功能。</p><h2 id="ClusterIP模式的功能"><a href="#ClusterIP模式的功能" class="headerlink" title="ClusterIP模式的功能"></a>ClusterIP模式的功能</h2><p>ClusterIP 模式的 Service 为你提供的，就是一个 Pod 的稳定的 IP 地址，即 VIP。并且，这里 Pod 和 Service 的关系是可以通过 Label 确定的。</p>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>K8S</category>
      
      <category>极客时间</category>
      
      <category>深入剖析k8s</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/1d25dc80dc76.html"/>
    <url>/2022/12/1d25dc80dc76.html</url>
    
    <content type="html"><![CDATA[<h1 id="内存介绍"><a href="#内存介绍" class="headerlink" title="内存介绍"></a>内存介绍</h1><p>内存是非常重要的系统资源，是硬盘和 CPU 的中间仓库及桥梁，承载着操作系统和应用程序的实时运行。JVM 内存布局规定了 Java 在运行过程中内存申请、分配、管理的策略，保证了 JVM 的高效稳定运行。</p><h2 id="结构图"><a href="#结构图" class="headerlink" title="结构图"></a>结构图</h2><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211221130003.png" width = "50%" /><h1 id="从-JVM-角度看线程"><a href="#从-JVM-角度看线程" class="headerlink" title="从 JVM 角度看线程"></a>从 JVM 角度看线程</h1><ul><li>线程是一个程序里的运行单元。JVM 允许一个应用有多个线程并行的执行</li><li>在 Hotspot JVM 中，每个线程都与操作系统的本地线程直接映射。<ul><li>当一个 Java 线程准备好执行以后，此时一个操作系统的本地线程也同时创建。Java 线程执行终止之后，本地线程也会回收。</li></ul></li><li>操作系统负责所有线程的安排调度到任何一个可用的 CPU 上。一旦本地线程初始化成功，他就会调用 Java 线程中的 run () 方法</li></ul><h2 id="JVM-系统线程"><a href="#JVM-系统线程" class="headerlink" title="JVM 系统线程"></a>JVM 系统线程</h2><ul><li>虚拟机线程</li><li>周期任务线程</li><li>GC 线程</li><li>编译线程</li><li>信号调度线程</li></ul><h1 id="运行时数据区组件"><a href="#运行时数据区组件" class="headerlink" title="运行时数据区组件"></a>运行时数据区组件</h1><p>接下来，我们就来一个个介绍这些运行时数据区的组件。</p><h2 id="程序计数寄存器"><a href="#程序计数寄存器" class="headerlink" title="程序计数寄存器"></a>程序计数寄存器</h2><p>程序计数寄存器：Program Counter Register</p><h3 id="CPU-的寄存器"><a href="#CPU-的寄存器" class="headerlink" title="CPU 的寄存器"></a>CPU 的寄存器</h3><p>在了解程序计数寄存器之前，我们先需要了解一下 CPU 的寄存器。<br>寄存器存储指令相关的现场信息。CPU 只有把数据装载到寄存器才能够运行。</p><h3 id="程序计数寄存器和-CPU-寄存器之间的关系"><a href="#程序计数寄存器和-CPU-寄存器之间的关系" class="headerlink" title="程序计数寄存器和 CPU 寄存器之间的关系"></a>程序计数寄存器和 CPU 寄存器之间的关系</h3><p>JVM 中的 PC 寄存器是对物理 PC 寄存器的一种抽象模拟。</p><h3 id="PC-寄存器作用"><a href="#PC-寄存器作用" class="headerlink" title="PC 寄存器作用"></a>PC 寄存器作用</h3><p>PC 寄存器用来存储指向下一条指令的地址，也就是吉祥要执行的指令代码。由执行引擎读取下一条指令。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211222191350.png" width = "80%" /><h3 id="PC-寄存器介绍"><a href="#PC-寄存器介绍" class="headerlink" title="PC 寄存器介绍"></a>PC 寄存器介绍</h3><ul><li>PC 寄存器是一块很小的内存空间，几乎可以忽略不计。也是运行速度最快的存储区域</li><li>在 JVM 规范中，每个线程都有它自己的程序计数器，是线程私有的，生命周期和线程的生命周期保持一致</li><li>任何时间一个线程都只有一个方法在执行，也就是所谓的当前方法。程序计数器会存储当前线程正在执行的 Java 方法的 JVM 指令地址；若是在执行 native 方法（也就是 C 语言的方法，不是 Java 方法），则是未指定值（undefined）</li><li>它是程序控制流的指示器，分支、循环、跳转、异常处理、线程回复等基础功能都需要依赖这个计数器来完成</li><li>字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令</li><li>它是唯一一个在 Java 虚拟机规范中没有规定任何 OutOfMemoryError 情况的区域</li></ul><h4 id="PC-寄存器实例"><a href="#PC-寄存器实例" class="headerlink" title="PC 寄存器实例"></a>PC 寄存器实例</h4><p>我们首先新建一个类 <code>PCRegisterTest.java</code>, 为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.PCRegister;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PCRegisterTest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> i + j;  <br>  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abc&quot;</span>;  <br>        System.out.println(i);  <br>        System.out.println(k);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>反编译之后我们可以看到：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211223094728.png"></p><p>主要还是看 main 方法中，以操作数 10 为例，代表我们创建了一个字符串，指向常量池中的#2，找到常量池中的#2 为 String 类型，并且再次指向了#16，为 abc。这里其实是两步操作 (多了一步从去找#16 的过程），因此在操作数 10 之后直接是操作数 12</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211223095127.png"></p><h4 id="PC-寄存器图解"><a href="#PC-寄存器图解" class="headerlink" title="PC 寄存器图解"></a>PC 寄存器图解</h4><p>还是看我们上面的例子中的部分：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211223100353.png" width = "50%" /><p>从图中可以看到，左边一排的数字就是 PC 寄存器中存储的地址，右边一排就是操作指令，操作引擎会根据 PC 寄存器的地址去找到对应的操作指令，将其翻译成机器指令，让 CPU 进行具体的操作。</p><h3 id="PC-寄存器面试题"><a href="#PC-寄存器面试题" class="headerlink" title="PC 寄存器面试题"></a>PC 寄存器面试题</h3><ol><li>使用 PC 寄存器存储字节码指令地址有什么作用？</li></ol><p>因为 CPU 在不停切换各个线程，这时候切换回来以后，就得知道接着从哪开始继续执行。<br>JVM 的字节码解释器就需要通过改变 PC 寄存器的值来明确下一条应该执行什么样的字节码指令。</p><ol start="2"><li>PC 寄存器为什么是线程私有的？</li></ol><p>为了能够准确地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个 PC 寄存器，这样一来各个线程之间便可以进行独立计算，从而不会出现相互干扰的情况。</p><h2 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h2><h3 id="虚拟机栈的概述"><a href="#虚拟机栈的概述" class="headerlink" title="虚拟机栈的概述"></a>虚拟机栈的概述</h3><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>由于跨平台的设计，Java 的指令都是根据栈来设计的，不同平台的 CPU 架构不同，所以不能设计为基于寄存器的。</p><h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p>优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。</p><h4 id="栈和堆概述"><a href="#栈和堆概述" class="headerlink" title="栈和堆概述"></a>栈和堆概述</h4><p>栈是运行时的单位，而堆是存储的单位。<br>也就是说，栈解决程序的运行问题，即程序如何执行，或者说如何处理数据。堆解决的是数据存储的问题，即数据怎么放、放在哪？</p><h4 id="JVM-栈是什么"><a href="#JVM-栈是什么" class="headerlink" title="JVM 栈是什么"></a>JVM 栈是什么</h4><p>每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧（Stack Frame），对应着一次次的 Java 方法调用。<br>是线程私有的</p><h4 id="JVM-栈的生命周期"><a href="#JVM-栈的生命周期" class="headerlink" title="JVM 栈的生命周期"></a>JVM 栈的生命周期</h4><p>生命周期与线程一致</p><h4 id="JVM-栈的作用"><a href="#JVM-栈的作用" class="headerlink" title="JVM 栈的作用"></a>JVM 栈的作用</h4><p>主管 Java 程序的运行，它保存方法的局部变量 （8 种数据类型、对象的引用地址）、部分结果，并参与方法的调用和返回。</p><h4 id="JVM-栈的特点（有点）"><a href="#JVM-栈的特点（有点）" class="headerlink" title="JVM 栈的特点（有点）"></a>JVM 栈的特点（有点）</h4><ul><li>栈是一种快速有效的分配存储方式，访问速度仅次于程序计数器。</li><li>JVM 直接对 Java 栈的操作只有两个<ul><li>每个方法执行，伴随着进栈</li><li>执行结束后的出栈工作</li></ul></li><li>对于栈来说不存在垃圾回收问题</li></ul><h4 id="栈中可能出现的异常"><a href="#栈中可能出现的异常" class="headerlink" title="栈中可能出现的异常"></a>栈中可能出现的异常</h4><p>Java 虚拟机规范允许 Java 栈的大小是动态的或者是固定不变的。</p><ul><li>如果采用<strong>固定大小</strong>的 JVM 栈，那每一个线程的 JVM 栈容量可以在线程创建时独立选定，那如果线程请求分配的栈容量超过 Java 虚拟机能允许的最大容量，JVM 就会抛出一个 StackOverflowError 异常。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.JVMStack;  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackTest</span> &#123;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>&#123;  <br>        methodA();  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">StackTest</span> <span class="hljs-variable">stackTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StackTest</span>();  <br>        stackTest.methodA();  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224093503.png"></p><ul><li>如果 Java 虚拟机栈<strong>允许动态扩展</strong>，并且在尝试拓展的时候无法申请到足够的内存，或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈，那么 JVM 会抛出一个 OutOfMemoryError 异常（OOM）</li></ul><h4 id="设置栈内存大小"><a href="#设置栈内存大小" class="headerlink" title="设置栈内存大小"></a>设置栈内存大小</h4><p>可以使用 <code>-Xss</code> 选项来设置栈内存的大小。<br>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.JVMStack;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackTest</span> &#123;  <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span>&#123;  <br>        i++;  <br>        System.out.println(i);  <br>        methodB();  <br>    &#125;  <br>  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">StackTest</span> <span class="hljs-variable">stackTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StackTest</span>();  <br>        stackTest.methodB();  <br>    &#125;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>这里可以看到，每次执行methodB都会将i+1，这样可以看到methodB到底被调用了多少次（也就是虚拟机栈有多深）。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224093930.png"></p><p>可以看到，在不进行设置的情况下，执行了 10737 次。</p><p>这时我们设置一下栈大小：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224094507.png"></p><p>再次重新执行：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224094554.png"></p><p>可以看到，在设置栈大小为 256k 之后，只执行了 1755 次之后栈就溢出了！<br>体现了设置栈大小的作用</p><h3 id="栈的存储单位"><a href="#栈的存储单位" class="headerlink" title="栈的存储单位"></a>栈的存储单位</h3><h4 id="栈的存储内容-栈帧"><a href="#栈的存储内容-栈帧" class="headerlink" title="栈的存储内容-栈帧"></a>栈的存储内容-栈帧</h4><ul><li>每个线程都有自己的栈，栈中的数据都是以栈帧（Stack Frame）的格式存在。</li><li>在这个线程上正在执行的每个方法都各自对应一个栈帧</li><li>栈帧是一个内存区块，是一个<strong>数据集</strong>，维系着方法执行过程中的各种数据信息</li><li>JVM 直接对 Java 栈的操作只有两个，那就是压栈和出栈，遵循“先进后出”&#x2F;“后进先出”的原则。</li><li>在一条活动线程中，一个时间点上，只会有一个活动的栈帧。也就是说，只有当前正在执行的方法的栈帧是有效的，这个栈帧被称为当前栈帧，与当前栈帧对应的方法就是当前方法，定义这个方法的类就是当前类。<img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224101004.png" width = "50%" /></li><li>执行引擎运行的所有字节码指令只针对当前栈帧进行操作</li><li>如果在该方法中调用了其他方法，对应的新的栈帧会被创建出来，成为新的当前栈帧</li></ul><h4 id="栈运行原理"><a href="#栈运行原理" class="headerlink" title="栈运行原理"></a>栈运行原理</h4><ul><li>不同线程中所包含的栈帧是不允许存在相互引用的</li><li>如果当前方法调用了其他方法，方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧，接着，虚拟机会丢弃当前栈帧，让前一个栈帧成为当前栈帧。</li><li>Java 方法有两种返回函数的方式<ul><li>正常函数返回：使用 return 指令</li><li>抛出异常：无论任何异常（只要没被处理），都会返回<br>  在这里值得注意的是，如果 A 方法调用 B 方法时，如果 B 方法抛出异常，则会直接返回，将异常抛给 A 方法，若 A 方法没有处理异常的方式，会继续返回给 main 方法，如果 main 方法也没对异常进行处理，那么线程就会停止，只要有任意一个方法有处理异常的方法，那么线程就不会结束。<br>  总结一句话：抛出异常不等于线程停止<br>举例来看：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.JVMStack;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReturnErrorTest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">ReturnErrorTest</span> <span class="hljs-variable">returnErrorTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReturnErrorTest</span>();  <br>        returnErrorTest.methodA();  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>&#123;  <br>        System.out.println(<span class="hljs-string">&quot;methodA 开始执行&quot;</span>);  <br>        methodB();  <br>        System.out.println(<span class="hljs-string">&quot;methodA 执行结束&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span>&#123;  <br>        System.out.println(<span class="hljs-string">&quot;methodB 开始执行&quot;</span>);  <br>        methodC();  <br>        System.out.println(<span class="hljs-string">&quot;methodB 执行结束&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span>&#123;  <br>        System.out.println(<span class="hljs-string">&quot;methodC 开始执行&quot;</span>);  <br>        System.out.println(<span class="hljs-string">&quot;methodC 执行结束&quot;</span>);  <br>    &#125;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul><p>在这里可以看到，main 方法调用了 methodA，methodA 调用了 methodB，methodB 调用了 methodC，打印结果如下：</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224132142.png" width = "50%" /><p>此时没有任何方法有捕捉异常的机制，那么任意一个方法中抛出异常，则会直接线程终止：<br>例如我将 methodC 进行修改：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span>&#123;  <br>    System.out.println(<span class="hljs-string">&quot;methodC 开始执行&quot;</span>);  <br>    System.out.println(<span class="hljs-string">&quot;methodC 执行结束&quot;</span>);  <br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>();  <br>&#125;<br></code></pre></td></tr></table></figure><p>那么结果会直接报错：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224132358.png" width = "50%" /><br>在 C 方法执行之后就直接结束了，但是我如果在任意一个函数添加对异常的处理，例如我在 main 方法中捕捉并打印异常：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>    <span class="hljs-type">ReturnErrorTest</span> <span class="hljs-variable">returnErrorTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReturnErrorTest</span>();  <br>    <span class="hljs-keyword">try</span> &#123;  <br>        returnErrorTest.methodA();  <br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;  <br>        System.out.println(e);  <br>    &#125;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>此时再执行：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224132543.png" width = "50%" /></p><p>可以看到，线程正常执行完成，之所以只打印了 methodC 的结束信息，是因为 methodB 和 methodA 都直接抛出异常返回了。如果我在 methodB 中就捕捉了异常并且处理了，那么又是另外一种情况了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span>&#123;  <br>    System.out.println(<span class="hljs-string">&quot;methodB 开始执行&quot;</span>);  <br>    <span class="hljs-keyword">try</span> &#123;  <br>        methodC();  <br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;  <br>        System.out.println(e);  <br>    &#125;  <br>    System.out.println(<span class="hljs-string">&quot;methodB 执行结束&quot;</span>);  <br>&#125;<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224133037.png" width = "50%" />可以看到，在方法 B 中打印了异常，其他任务正常执行，并且 main 方法中的捕捉异常也没有工作了。<h3 id="栈帧的内部结构"><a href="#栈帧的内部结构" class="headerlink" title="栈帧的内部结构"></a>栈帧的内部结构</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211224133805.png" width = "80%" /><p>每个栈帧中存储着：</p><ul><li>局部变量表</li><li>操作数栈</li><li>动态链接（指向运行时常量池的方法引用）</li><li>方法返回地址</li><li>一些附加信息</li></ul><p>具体信息可以查看 [[8 虚拟机字节码执行引擎]]</p><h2 id="虚拟机堆"><a href="#虚拟机堆" class="headerlink" title="虚拟机堆"></a>虚拟机堆</h2><h1 id="对象探秘"><a href="#对象探秘" class="headerlink" title="对象探秘"></a>对象探秘</h1><h2 id="1-对象的创建"><a href="#1-对象的创建" class="headerlink" title="1. 对象的创建"></a>1. 对象的创建</h2><ol><li>类的加载<br>先看看《深入理解JVM》里面的步骤：<br>当Java虚拟机遇到一条字节码new指令时，首先将去检查这个指令的参数是否能在常 量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过。如果没有，那必须先执行相应的类加载过程。<br>这部分对应的内容就是<code>java.lang.ClassLoader</code>类的<code>loadClass</code>方法。</li></ol><ul><li>首先，来看看前半句话：<br>  &#x3D;&#x3D;当Java虚拟机遇到一条字节码new指令时，首先将去检查这个指令的参数是否能在常 量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过。&#x3D;&#x3D;<br>  对应的源码部分：  <img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210810094227.png height=700>  点进`findLoadClass(name)`，可以看到：  <img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210810094452.png height=200>  在这里，`checkName`很简单，作用是检查name是否为null或者是一个有效的二进制名，然后根据`findLoadedClass0`这个native方法去执行JVM的方法。</li><li>接下来看看后半句话：<br>  &#x3D;&#x3D;如果没有，那必须先执行相应的类加载过程。&#x3D;&#x3D;<br>  对应的源码部分：  <img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210810114433.png height=700>  这部分内容在[[7 虚拟机类加载机制]]进行详细说明，我们先大概分析一下，就是首先使用双亲委派机制尝试进行类的加载，如果失败，那么需要调用findClass方法来进行类的加载，最终返回的是一个Class对象。总结一下：类的加载主要分为三个步骤</li></ul><ol><li><p>检查是否已经加载，有就直接返回，避免重复加载</p></li><li><p>当前缓存中确实没有该类，那么遵循父优先加载机制，加载.class文件</p></li><li><p>上面两步都失败了，调用findClass()方法加载</p></li><li><p>分配内存<br>同样，看看《深入理解 JVM》<br>在类加载检查通过后，接下来虚拟机将为新生对象分配内存。对象所需内存的大小在类加载完成后便可完全确定，为对象分配空间的任务实际上便等同于把一块确定大小的内存块从 Java 堆中划分出来。</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/1fc40db53c56.html"/>
    <url>/2022/12/1fc40db53c56.html</url>
    
    <content type="html"><![CDATA[<h1 id="B-x2F-S架构"><a href="#B-x2F-S架构" class="headerlink" title="B&#x2F;S架构"></a>B&#x2F;S架构</h1><h2 id="B-x2F-S架构的好处"><a href="#B-x2F-S架构的好处" class="headerlink" title="B&#x2F;S架构的好处"></a>B&#x2F;S架构的好处</h2><ol><li>客户端使用统一的浏览器（Browser）。由于浏览器具有统一性，它不需要特殊的配置和网络连接，有效地屏蔽了不同服务提供商提供给用户使用服务的差异性。</li><li>服务端（Server）基于统一的HTTP。</li></ol>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java Web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/3f8a458cc995.html"/>
    <url>/2022/12/3f8a458cc995.html</url>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>给一个系统定位问题的时候，知识、经验是关键基础，数据是依据，工具是运用知识处理数据的手段。</p><h2 id="数据的内容"><a href="#数据的内容" class="headerlink" title="数据的内容"></a>数据的内容</h2><p>数据包括但不限于</p><ul><li>异常堆栈</li><li>虚拟机运行日志</li><li>垃圾收集器日志</li><li>线程快照（threaddump&#x2F;javacore文件）</li><li>堆转储快照（heapdump&#x2F;hprof文件）</li><li>…</li></ul><p>恰当地使用虚拟机故障处理、分析的工具可以提升我们分析数据、定位并解决问题的效率，但我们在学习工具前，也应当意识到工具永远都是知识技能的一层包装，没有什么工具是“秘密武器”，拥有了就能“包治百病”。</p><h1 id="基础故障处理工具"><a href="#基础故障处理工具" class="headerlink" title="基础故障处理工具"></a>基础故障处理工具</h1><p>观察一下JDK的bin目录下的命令行工具：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 1976<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jaotc<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jar<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jarsigner<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 java<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 javac<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 javadoc<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 javap<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jcmd<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jconsole<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jdb<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jdeprscan<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jdeps<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jfr<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jhsdb<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jimage<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jinfo<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jjs<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jlink<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jmap<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jmod<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jps<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jrunscript<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jshell<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jstack<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jstat<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 jstatd<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 keytool<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 pack200<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 rmic<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 rmid<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 rmiregistry<br>-rwxr-xr-x@ 1 coachhe  staff    24K  1 13  2021 serialver<br>-rwxr-xr-x@ 1 coachhe  staff    91K  1 13  2021 unpack200<br></code></pre></td></tr></table></figure><p>大家应该使用最多的就是java和javac，甚至很多人可能根本没有使用过除了这两个工具以外的其他工具，包括我，之前除了jps还真没用过其他的工具，但是这些工具在打包、部署、签名、调试、监控、运维等各种场景都可能会用到，是非常很重要的。</p><h1 id="可视化故障处理工具"><a href="#可视化故障处理工具" class="headerlink" title="可视化故障处理工具"></a>可视化故障处理工具</h1><p>JDK中除了附带大量的命令行工具外，还提供了几个功能集成度更高的可视化工具，用户可以使用这些可视化工具以更加便捷的方式进行进程故障诊断和调试工作。这类工具主要包括JConsoIe、JHSDB、VisualVM和JMC四个。</p><h2 id="JHSDB-基于服务性代理的调试工具"><a href="#JHSDB-基于服务性代理的调试工具" class="headerlink" title="JHSDB:基于服务性代理的调试工具"></a>JHSDB:基于服务性代理的调试工具</h2><p>JDK中提供了JCMD和JHSDB两个集成式的多功能工具箱，它们不仅整合了上一节介绍到的所有基础工具所能提供的专项功能，而且由于有着“后发优势”，能够做得往往比之前的老工具们更好、更强大</p><p>JCMD、JHSDB和基础工具的对比<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210816221525.png height=300></p><p>JHSDB是一款基于服务性代理(Serviceability Agent,SA)实现的<strong>进程外</strong>调试工具。</p><h3 id="服务性代理介绍"><a href="#服务性代理介绍" class="headerlink" title="服务性代理介绍"></a>服务性代理介绍</h3><p>服务性代理是HotSpot虚拟机中一组用于映射Java虚拟机运行信息的、主要基于Java语言（含少量JNI代码）实现的API集合。</p><p>服务性代理以HotSpot内部的数据结构为参照物进行设计，把这些C++的数据抽象出Java模型对象，相当于<strong>HotSpot的C++代码的一个镜像</strong>。</p><h4 id="服务性代理作用："><a href="#服务性代理作用：" class="headerlink" title="服务性代理作用："></a>服务性代理作用：</h4><p>通过服务性代理的API，可以在一个独立的Java虚拟机的进程里分析其他HotSpot虚拟机的内部数据，或者从HotSpot虚拟机进程内存中dump出来的转储快照里还原出它的运行状态细节。</p><h3 id="利用JHSDB分析代码实例（对象存放位置）"><a href="#利用JHSDB分析代码实例（对象存放位置）" class="headerlink" title="利用JHSDB分析代码实例（对象存放位置）"></a>利用JHSDB分析代码实例（对象存放位置）</h3><h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JHSDB_TestCase</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>        <span class="hljs-keyword">static</span> <span class="hljs-type">ObjectHolder</span> <span class="hljs-variable">staticObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectHolder</span>();<br>        <span class="hljs-type">ObjectHolder</span> <span class="hljs-variable">instanceObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectHolder</span>();<br><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">foo</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-type">ObjectHolder</span> <span class="hljs-variable">localObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectHolder</span>();<br>            System.out.println(<span class="hljs-string">&quot;done&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectHolder</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Test</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JHSDB_TestCase</span>.Test();<br>        test.foo();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>问题</strong>：<br>staticObj、instanceObj、localObj这三个变量（而不是它们所指向的对象）存放在哪里？</p><p><strong>分析</strong>：<br>根据前面知识的学习（具体的看[[2 Java内存区域与内存溢出异常]]），我们当然可以很快分辨出来：</p><ul><li>staticObj在方法区</li><li>instanceObj在Java堆</li><li>localObj则是存放在foo()方法栈帧的局部变量表中</li></ul><p>现在通过JDSDB来实践验证这一点。</p><p>首先，我们要确保这三个变量已经在内存中分配好，然后将程序暂停下来，以便有空隙进行实验，因此我们把断点打在<code>System.out.println(&quot;done&quot;)</code>上，然后在debug模式下运行程序。<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210817002249.png height=500></p><p>使用参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-Xmx10m -XX:+UseSerialGC -XX:-UseCompressedOops<br></code></pre></td></tr></table></figure><p>程序执行后通过jps查询到测试程序的进程ID，具体如下：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210817002811.png height=500></p><p>使用以下命令进入JHSDB的图形化模式，并使其附加进程4212（也就是我们正在运行的Java程序）</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/85ba184d3fdd.html"/>
    <url>/2022/12/85ba184d3fdd.html</url>
    
    <content type="html"><![CDATA[<h1 id="运行时栈帧结构"><a href="#运行时栈帧结构" class="headerlink" title="运行时栈帧结构"></a>运行时栈帧结构</h1><p>每一个方法从调用开始到执行结束的过程，都对应着一个栈帧在虚拟机栈里面从入栈到出栈的过程。</p><p>理解：</p><ul><li>虚拟机栈: 一个程序从main方法开始到最终全部执行结束的过程。</li><li>栈帧: 一个方法从开始到结束的过程。</li><li>main方法调用的其他方法的数量&#x3D;栈帧的数量</li></ul><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20221125101813.png"></p><p>可以看到，一个虚拟机栈就是一个 <code>main</code> 进程从开始运行到最终结束的过程。在 <code>main</code> 进程运行时，每调用一次方法，就会生成一个栈帧，每个方法调用时可能会继续调用其他方法，那么会继续生成栈帧，栈帧的生命周期是和方法同步的。</p><h2 id="栈帧的组成"><a href="#栈帧的组成" class="headerlink" title="栈帧的组成"></a>栈帧的组成</h2><ul><li>局部变量表</li><li>操作数栈</li><li>动态连接</li><li>方法返回地址</li><li>额外的附加信息</li></ul><h3 id="局部变量表"><a href="#局部变量表" class="headerlink" title="局部变量表"></a>局部变量表</h3><p>定义: 局部变量表是一组变量表的存储空间，用于存放方法参数和方法内部定义的局部变量。</p><h3 id="操作数栈"><a href="#操作数栈" class="headerlink" title="操作数栈"></a>操作数栈</h3><p>直接来看个具体例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: CoachHe  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2022/11/25 10:00  </span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperandStackTest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAddOperation</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">byte</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> i + j;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，是一个很简单的类和方法，那么我们来看看用 <code>javap -verbose OperandStackTest</code> 反编译出来的内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs shell">Classfile /Users/coachhe/programs/java/jvm-coachhe/Chapter8_JVMBytecodeEngine/target/classes/com/coachhe/section2_运行时栈帧结构/操作数栈/OperandStackTest.class<br>  Last modified 2022-11-25; size 532 bytes<br>  MD5 checksum d2ef1ed6453d469857e18d619fc5dd29<br>  Compiled from &quot;OperandStackTest.java&quot;<br>public class com.coachhe.section2_运行时栈帧结构.操作数栈.OperandStackTest<br>  minor version: 0<br>  major version: 52<br>  flags: ACC_PUBLIC, ACC_SUPER<br>Constant pool:<br><span class="hljs-meta prompt_">   #</span><span class="language-bash">1 = Methodref          <span class="hljs-comment">#3.#19         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">2 = Class              <span class="hljs-comment">#20            // com/coachhe/section2_运行时栈帧结构/操作数栈/OperandStackTest</span></span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">3 = Class              <span class="hljs-comment">#21            // java/lang/Object</span></span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">4 = Utf8               &lt;init&gt;</span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">5 = Utf8               ()V</span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">6 = Utf8               Code</span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">7 = Utf8               LineNumberTable</span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">8 = Utf8               LocalVariableTable</span><br><span class="hljs-meta prompt_">   #</span><span class="language-bash">9 = Utf8               this</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">10 = Utf8               Lcom/coachhe/section2_运行时栈帧结构/操作数栈/OperandStackTest;</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">11 = Utf8               testAddOperation</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">12 = Utf8               i</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">13 = Utf8               B</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">14 = Utf8               j</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">15 = Utf8               I</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">16 = Utf8               k</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">17 = Utf8               SourceFile</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">18 = Utf8               OperandStackTest.java</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">19 = NameAndType        <span class="hljs-comment">#4:#5          // &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">20 = Utf8               com/coachhe/section2_运行时栈帧结构/操作数栈/OperandStackTest</span><br><span class="hljs-meta prompt_">  #</span><span class="language-bash">21 = Utf8               java/lang/Object</span><br>&#123;<br>  public com.coachhe.section2_运行时栈帧结构.操作数栈.OperandStackTest();<br>    descriptor: ()V<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=1, locals=1, args_size=1<br>         0: aload_0<br>         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>         4: return<br>      LineNumberTable:<br>        line 7: 0<br>      LocalVariableTable:<br>        Start  Length  Slot  Name   Signature<br>            0       5     0  this   Lcom/coachhe/section2_运行时栈帧结构/操作数栈/OperandStackTest;<br><br>  public void testAddOperation();<br>    descriptor: ()V<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=2, locals=4, args_size=1<br>         0: bipush        15<br>         2: istore_1<br>         3: iconst_0<br>         4: istore_2<br>         5: iload_1<br>         6: iload_2<br>         7: iadd<br>         8: istore_3<br>         9: return<br>      LineNumberTable:<br>        line 9: 0<br>        line 10: 3<br>        line 11: 5<br>        line 12: 9<br>      LocalVariableTable:<br>        Start  Length  Slot  Name   Signature<br>            0      10     0  this   Lcom/coachhe/section2_运行时栈帧结构/操作数栈/OperandStackTest;<br>            3       7     1     i   B<br>            5       5     2     j   I<br>            9       1     3     k   I<br>&#125;<br>SourceFile: &quot;OperandStackTest.java&quot;<br></code></pre></td></tr></table></figure><p>可以看到，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">0</span>: bipush        <span class="hljs-number">15</span><br><span class="hljs-number">2</span>: istore_1<br><span class="hljs-number">3</span>: iconst_0<br><span class="hljs-number">4</span>: istore_2<br><span class="hljs-number">5</span>: iload_1<br><span class="hljs-number">6</span>: iload_2<br><span class="hljs-number">7</span>: iadd<br><span class="hljs-number">8</span>: istore_3<br><span class="hljs-number">9</span>: <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><p>这部分对应的是 <code>testAddOperation()</code> 方法对应的字节码指令。</p><h1 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h1><p>方法调用并不等同于方法中的代码被执行。</p><h2 id="方法调用的任务"><a href="#方法调用的任务" class="headerlink" title="方法调用的任务"></a>方法调用的任务</h2><p>方法调用阶段唯一的任务就是<strong>确定被调用方法的版本</strong>（也就是调用哪一个方法），暂时还未涉及方法内部的具体运行过程。</p><h2 id="1-解析"><a href="#1-解析" class="headerlink" title="1. 解析"></a>1. 解析</h2><p>Class文件的编译过程中不包含传统语言编译的连接步骤，一切方法调用在Class文件里面存储的都<strong>只是符号引用</strong>，而不是方法在实际运行时内存布局中的入口地址（也就是直接引用）。<br>而在类加载的<strong>解析阶段</strong>（具体阶段可以看[[7 虚拟机类加载机制]]），会将其中的一部分符号引用转化为直接引用。<br>这种解析能够成立的前提是：<br>方法在程序真正运行之前就有一个可确定的调用版本，并且这个方法的调用版本在运行期间是不可改变的。换句话说，调用目标在程序代码写好、编译器进行编译那一刻就已经确定下来，这类方法的调用被称为解析。(来自《深入理解Java虚拟机》)<br>注意：<br>在这里是有一点歧义的，如果是我理解错了希望大佬可以指出，这里说&#x3D;&#x3D;这类方法的调用被称为解析&#x3D;&#x3D;，也就是说<code>解析=调用可确定并且在运行期间不可改变的方法版本</code>，但是在前面的学习中我们知道，解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程，不单单是这一类方法，还包括很多用invokedynamic指令修饰的，在运行期间版本会改变的方法。所以这两个地方对解析的解释是否有歧义呢？</p><p>在Java语言中，符合”编译器可知，运行期不可变“这个要求的方法，主要有&#x3D;&#x3D;静态方法&#x3D;&#x3D;和&#x3D;&#x3D;私有方法&#x3D;&#x3D;两大类。</p><ul><li>静态方法<br>与类型直接关联</li><li>私有方法<br>在外部不可被访问</li></ul><p>这两种方法各自特点决定了它们不可能通过集成或者别的方式重写出其他版本，因此它们都很适合在类加载阶段进行解析。</p><h3 id="调用字节码指令的方法"><a href="#调用字节码指令的方法" class="headerlink" title="调用字节码指令的方法"></a>调用字节码指令的方法</h3><p>调用不同类型的方法，字节码指令集里设计了不同的指令。在JVM中支持以下5中方法调用字节码指令：</p><ul><li>invokestatic：用于调用静态方法</li><li>invokespecial：用于调用实例构造器<code>&lt;init&gt;()</code>方法、私有方法和父类中的方法</li><li>invokevirtual：用于调用所有虚方法</li><li>invokeinterface：用于调用接口方法，会在运行时再确定一个实现接口的对象</li><li>invokedynamic：现在运行时动态解析出调用点限定符所引用的方法，然后再执行该方法。</li></ul><p>前面四条调用指令，分派逻辑都固化在JVM内部，而invokedynamic指令的分派逻辑是用户设定的引导方法来决定的。</p><h3 id="非虚方法和虚方法"><a href="#非虚方法和虚方法" class="headerlink" title="非虚方法和虚方法"></a>非虚方法和虚方法</h3><p>只要能被invokestatic和invokespecial，都可以在解析阶段中确定唯一的调用版本。也就是非虚方法，共有以下5种</p><ol><li>静态方法</li><li>私有方法</li><li>实例构造器</li><li>父类方法</li><li>被final修饰的方法（虽然它被invokevirtual指令调用）<br>对于final方法，由于历史原因，它是被invokevirtual指令调用的，但是因为它也无法被覆盖，没有其他版本的可能，所以它就是一种非虚方法。</li></ol><p>以上5种方法会在类加载的时候（也就是类周期的第1个阶段，详见[[7 虚拟机类加载机制]]）就可以把符号引用解析为该方法的直接引用。</p><p>其他方法被称为虚方法。</p><p>代码：方法静态解析演示</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.Chapter3_方法调用;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 方法静态解析演示</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> coachhe</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticResolution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Hello World&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        StaticResolution.sayHello();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>使用javap命令查看这段程序对应的字节码：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210811005539.png height=300><br>可以看到，的确是通过invokestatic命令来调用sayHello()方法，而且其调用的方法版本已经在编译时明确以常量池项的形式固化在字节码指令的参数之中（常量池#5号）：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210811093827.png height=1500></p><p>可以看到，和String进行了绑定。</p><h2 id="2-分派"><a href="#2-分派" class="headerlink" title="2. 分派"></a>2. 分派</h2>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/842f642f6608.html"/>
    <url>/2022/12/842f642f6608.html</url>
    
    <content type="html"><![CDATA[<p>生成一个任务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://localhost:8071/ui/jobs&#x27; \<br>  -H &#x27;Content-Type: application/json;charset=UTF-8&#x27; \<br>  --data-raw &#x27;&#123;&quot;name&quot;:&quot;测试任务&quot;,&quot;cron&quot;:&quot;1 * * * *&quot;,&quot;protocol&quot;:&quot;http&quot;,&quot;uri&quot;:&quot;http://localhost:8080/api/v1/work-order/create?nowUserName=coachhe&quot;,&quot;remark&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;creator&quot;:&quot;admin&quot;,&quot;preJobId&quot;:&quot;&quot;,&quot;timeout&quot;:60,&quot;retryCount&quot;:2,&quot;retryWaitTime&quot;:10,&quot;failTakeover&quot;:0,&quot;misfireThreshold&quot;:0,&quot;executorSelectStrategy&quot;:&quot;random&quot;,&quot;httpParam&quot;:&quot;&quot;,&quot;httpHeaderParam&quot;:&quot;&quot;,&quot;httpSign&quot;:0,&quot;shardingCount&quot;:0,&quot;shardingParam&quot;:&quot;&quot;,&quot;alarmEmail&quot;:&quot;&quot;,&quot;subJobScheduleStrategy&quot;:0,&quot;subJobIds&quot;:[],&quot;executors&quot;:[&#123;&quot;address&quot;:&quot;127.0.0.1:8080&quot;,&quot;weight&quot;:0,&quot;status&quot;:1&#125;]&#125;&#x27; \<br>  --compressed<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>调度系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7021a6160682.html"/>
    <url>/2022/12/7021a6160682.html</url>
    
    <content type="html"><![CDATA[<h1 id="动态语言和静态语言"><a href="#动态语言和静态语言" class="headerlink" title="动态语言和静态语言"></a>动态语言和静态语言</h1><h2 id="动态语言"><a href="#动态语言" class="headerlink" title="动态语言"></a>动态语言</h2><p>动态语言是一类运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。通俗点说，就是在运行时代码可以根据某些条件改变自身结构<br>主要动态语言：Object-C、C#、JavaScript、PHP、Python等。</p><h2 id="静态语言"><a href="#静态语言" class="headerlink" title="静态语言"></a>静态语言</h2><p>与动态语言相对应的，运行时结构不可变的语言就是静态语言。</p><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p>Java不是动态语言，但Java可以称之为“准动态语言”。即Java有一定的动态性，我们可以利用反射机制获得类似动态语言的特性。Java的动态性让编程的时候更加灵活。</p><h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><p>对于Cpp或者c，被编译成.c文件之后，就没有办法再改变了，也就是说，这个文件如何执行，已经被预先设置好了，没办法改了。<br>但是对于Java，被编译成.class文件之后，可以通过反射得到.class文件的内部信息。并且可以进行修改，所以可以被称为动态语言。</p><h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><p>Reflection（反射）是Java被视为动态语言的关键，反射机制允许程序在执行期间借助于Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.String&quot;</span>)<br></code></pre></td></tr></table></figure><p>加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，透过这个镜子可以看到类的结构，所以，我们称之为反射。</p><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210808155324.png width = 500 heigh = 100><h1 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h1><p>在Object类中定义了以下的方法，此方法将被所有子类继承。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Class <span class="hljs-title function_">getClass</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>以上方法的返回类型是一个Class类，此类是Java反射的源头，实际上所谓反射从程序的运行结果来看也很好理解，即：可以通过对象反射求出类的名称<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210808161638.png width=500 heigh=500></p><h2 id="关于Class类"><a href="#关于Class类" class="headerlink" title="关于Class类"></a>关于Class类</h2><ul><li>Class本身也是一个类</li><li>Class对象只能由系统建立对象</li><li>一个加载的类在JVM中只会有一个Class实例</li><li>一个Class对象对应的是一个加载到JVM中的一个.class文件</li><li>每个类的实例都会记得自己是由哪个Class实例所生成</li><li>通过Class可以完整地得到一个类中所有被加载的结构</li><li>Class类是Reflection的根源，针对任何你想动态加载、运行的类，唯有先获得相应的Class对象。</li></ul><h2 id="获得Class对象的三种方式"><a href="#获得Class对象的三种方式" class="headerlink" title="获得Class对象的三种方式"></a>获得Class对象的三种方式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.coachhe.reflect.kuang;<br><br><span class="hljs-comment">// 测试class类的创建方式有哪些</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">test03</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>        System.out.println(<span class="hljs-string">&quot;这个人是：&quot;</span> + person.name);<br><br>        <span class="hljs-comment">// 1. 通过对象获得</span><br>        Class&lt;?&gt; c1 = person.getClass();<br><br>        <span class="hljs-comment">// 2. forname获得</span><br>        Class&lt;?&gt; c2 = Class.forName(<span class="hljs-string">&quot;com.coachhe.reflect.kuang.Student&quot;</span>);<br><br>        <span class="hljs-comment">// 3. 通过类型.class获得</span><br>        Class&lt;Student&gt; c3 = Student.class;<br><br>        System.out.println(c1.hashCode());<br>        System.out.println(c2.hashCode());<br>        System.out.println(c3.hashCode());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>    String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;学生&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;老师&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210808162833.png height=200><br>可以看到，通过三种方式获得的Class对象都有相同的hashcode，所以是同一个。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java反射</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a6eeaf079e2e.html"/>
    <url>/2022/12/a6eeaf079e2e.html</url>
    
    <content type="html"><![CDATA[<h1 id="JVM构建实例浅析"><a href="#JVM构建实例浅析" class="headerlink" title="JVM构建实例浅析"></a>JVM构建实例浅析</h1><h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br></code></pre></td></tr></table></figure><h2 id="创建对象的过程"><a href="#创建对象的过程" class="headerlink" title="创建对象的过程"></a>创建对象的过程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br></code></pre></td></tr></table></figure><ol><li>加载类<br> a. ClassLoader加载.class文件到内存<br> b. 执行静态代码块和静态初始化语句</li><li>执行new，申请一片内存空间</li><li>调用构造器，创建一个空白对象</li><li>子类调用父类构造器</li><li>构造器执行<br> a. 执行构造代码块和初始化语句<br> b. 构造器内容</li></ol><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210806103334.png"></p><h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2><h3 id="loadClass"><a href="#loadClass" class="headerlink" title="loadClass()"></a><code>loadClass()</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoader</span> &#123;<br>   <span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve) <br>   <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-keyword">synchronized</span> (getClassLoadingLock(name)) &#123;<br>            <span class="hljs-comment">// 首先，检查是否已经加载该类</span><br>            Class&lt;?&gt; c = findLoadedClass(name);<br>            <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">t0</span> <span class="hljs-operator">=</span> System.nanoTime();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// 如果尚未加载，则遵循父优先的等级加载机制（所谓双亲委派机制）</span><br>                    <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) &#123;<br>                        c = parent.loadClass(name, <span class="hljs-literal">false</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        c = findBootstrapClassOrNull(name);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>                    <span class="hljs-comment">// ClassNotFoundException thrown if class not found</span><br>                    <span class="hljs-comment">// from the non-null parent class loader</span><br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// 模板方法模式：如果还是没有加载成功，调用findClass()</span><br>                    <span class="hljs-type">long</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> System.nanoTime();<br>                    c = findClass(name);<br><br>                    <span class="hljs-comment">// this is the defining class loader; record the stats</span><br>                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);<br>                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);<br>                    sun.misc.PerfCounter.getFindClasses().increment();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (resolve) &#123;<br>                resolveClass(c);<br>            &#125;<br>            <span class="hljs-keyword">return</span> c;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>加载.class文件大致可以分为3个步骤：</p><ol><li>检查是否已经加载，有就直接返回，避免重复加载</li><li>当前缓存中确实没有该类，那么遵循父优先加载机制，加载.class文件</li><li>上面两步都失败了，调用findClass()方法加载</li></ol><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>需要注意的是，ClassLoader类本身是抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoader</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>而抽象类是无法通过new创建对象的。所以它的findClass()方法写的很随意，直接抛了异常，反正你无法通过ClassLoader对象调用。也就是说，父类ClassLoader中的findClass()方法根本不会去加载.class文件。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ClassLoader类的findClass方法</span><br><span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;  <br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(name);  <br>&#125;<br></code></pre></td></tr></table></figure><p>正确的做法是，子类重写覆盖findClass()，在里面写自定义的加载逻辑。比如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">/*自己另外写一个getClassData()</span><br><span class="hljs-comment">                  通过IO流从指定位置读取xxx.class文件得到字节数组*/</span><br><span class="hljs-type">byte</span>[] datas = getClassData(name);<br><span class="hljs-keyword">if</span>(datas == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(<span class="hljs-string">&quot;类没有找到：&quot;</span> + name);<br>&#125;<br><span class="hljs-comment">//调用类加载器本身的defineClass()方法，由字节码得到Class对象</span><br><span class="hljs-keyword">return</span> defineClass(name, datas, <span class="hljs-number">0</span>, datas.length);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>e.printStackTrace();<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(<span class="hljs-string">&quot;类找不到：&quot;</span> + name);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>defineClass()是ClassLoader定义的方法，目的是根据.class文件的字节数组byte[] b造出一个对应的Class对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Class&lt;?&gt; defineClass(String name, <span class="hljs-type">byte</span>[] b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len, ProtectionDomain protectionDomain)<br>    <span class="hljs-keyword">throws</span> ClassFormatError<br>&#123;<br>    protectionDomain = preDefineClass(name, protectionDomain);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> defineClassSourceLocation(protectionDomain);<br>    Class&lt;?&gt; c = defineClass1(name, b, off, len, protectionDomain, source);<br>    postDefineClass(c, protectionDomain);<br>    <span class="hljs-keyword">return</span> c;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>我们无法得知具体是如何实现的，因为最终它调用了一个native方法defineClass1：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> Class&lt;?&gt; defineClass0(String name, <span class="hljs-type">byte</span>[] b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len, ProtectionDomain pd);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> Class&lt;?&gt; defineClass1(String name, <span class="hljs-type">byte</span>[] b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len, ProtectionDomain pd, String source);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> Class&lt;?&gt; defineClass2(String name, java.nio.ByteBuffer b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len, ProtectionDomain pd, String source);<br></code></pre></td></tr></table></figure><p>目前，关于类加载器知道了这些信息：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210806110330.png"></p><p>现在，.class文件已经被类加载器加载到内存中，并且JVM根据其字节数组创建了对应的Class对象。</p><h2 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Class类</span><br><span class="hljs-comment">// 里面对反射的支持，写了个内部类里面的字段与.class的内容映射</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionData</span>&lt;T&gt; &#123;<br><span class="hljs-comment">// 类的各种参数</span><br><span class="hljs-comment">// 字段、方法、构造器对象</span><br>        <span class="hljs-keyword">volatile</span> Field[] declaredFields;<br>        <span class="hljs-keyword">volatile</span> Field[] publicFields;<br>        <span class="hljs-keyword">volatile</span> Method[] declaredMethods;<br>        <span class="hljs-keyword">volatile</span> Method[] publicMethods;<br>        <span class="hljs-keyword">volatile</span> Constructor&lt;T&gt;[] declaredConstructors;<br>        <span class="hljs-keyword">volatile</span> Constructor&lt;T&gt;[] publicConstructors;<br>        <span class="hljs-keyword">volatile</span> Field[] declaredPublicFields;<br>        <span class="hljs-keyword">volatile</span> Method[] declaredPublicMethods;<br>        <span class="hljs-keyword">volatile</span> Class&lt;?&gt;[] interfaces;<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> redefinedCount;<br><br>        ReflectionData(<span class="hljs-type">int</span> redefinedCount) &#123;<br>            <span class="hljs-built_in">this</span>.redefinedCount = redefinedCount;<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment">// 注解数据</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">transient</span> SoftReference&lt;ReflectionData&lt;T&gt;&gt; reflectionData;<br><br>    <span class="hljs-comment">// 泛型信息</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">transient</span> <span class="hljs-type">int</span> <span class="hljs-variable">classRedefinedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><p>针对字段、方法、构造器，因为信息量太大了，JDK还单独写了三个类：Field、Method、Constructor。<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210807144327.png width=500 heigh=500><br>例如Method类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Method类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Method</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Executable</span> &#123;<br>    <span class="hljs-keyword">private</span> Class&lt;?&gt;            clazz;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>                 slot;<br>    <span class="hljs-comment">// This is guaranteed to be interned by the VM in the 1.4</span><br>    <span class="hljs-comment">// reflection implementation</span><br><br><span class="hljs-comment">// 方法名、返回值类型</span><br>    <span class="hljs-keyword">private</span> String              name;   <br><br><span class="hljs-comment">// 参数类型、异常类型、修饰符</span><br>    <span class="hljs-keyword">private</span> Class&lt;?&gt;            returnType;<br>    <span class="hljs-keyword">private</span> Class&lt;?&gt;[]          parameterTypes;<br>    <span class="hljs-keyword">private</span> Class&lt;?&gt;[]          exceptionTypes;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>                 modifiers;<br>    <span class="hljs-comment">// Generics and annotations support</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> String              signature;<br>    <span class="hljs-comment">// generic info repository; lazily initialized</span><br><br><br><span class="hljs-comment">// 方法泛型、方法上的注解</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> MethodRepository genericInfo;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[]              annotations;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[]              parameterAnnotations;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[]              annotationDefault;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> MethodAccessor methodAccessor;<br></code></pre></td></tr></table></figure><p>也就是说，Class类虽然准备了很多字段用来表示一个.class文件的信息，比如类名、注解、实现的接口等，但对于字段、方法、构造器等，为了更详细地描述这些重要信息，还写了三个类，每个类里面都有很详细的对应。而Class类本身就维持这三个对象的引用（对象数组形式！因为一个类可能有多个方法，所以Class要用Method[] methods保存）。</p><p>例如这里给出一个UserController类的例子<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210807143107.png  width=500 height=80></p><p>在这里我们可以看到，左边是具体的方法，右边是对应的Method类，Method类将getUserBy方法的所有信息“解构”之后保存在Method对象中。<br>值得注意的是，getUserBy方法是UserController类的一个方法，UserController类中的所有信息被“解构”后保存在Class类中。其中字段、方法、构造器又用Field、Method等对象单独表示。</p><p>大概了解完Class类的字段后，看一下Class类的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 是个final类，无法被继承</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Class</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable, GenericDeclaration, Type, AnnotatedElement &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> ANNOTATION= <span class="hljs-number">0x00002000</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ENUM</span>      <span class="hljs-operator">=</span> <span class="hljs-number">0x00004000</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SYNTHETIC</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x00001000</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerNatives</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">static</span> &#123;<br>        registerNatives();<br>    &#125;<br><br><span class="hljs-comment">// 构造器是private的，无法手动new，Class对象只能由虚拟机创建</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Class</span><span class="hljs-params">(ClassLoader loader)</span> &#123;<br>        classLoader = loader;<br>    &#125;<br></code></pre></td></tr></table></figure><p>可以发现，Class类的构造器是私有的，我们无法手动new一个Class对象，只能由JVM创建。JVM在构造Class对象时，需要传入一个类加载器，然后才有我们上面分析的一连串加载、创建过程。</p><h3 id="Class-forName-方法"><a href="#Class-forName-方法" class="headerlink" title="Class.forName()方法"></a><code>Class.forName()</code>方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; forName(String className)<br>            <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>    Class&lt;?&gt; caller = Reflection.getCallerClass();<br>    <span class="hljs-keyword">return</span> forName0(className, <span class="hljs-literal">true</span>, ClassLoader.getClassLoader(caller), caller);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，返回了一个Class对象，注意<code>ClassLoader.getClassLoader(caller)</code>，还是用传入的类加载器去生成。</p><h3 id="newInstance-方法"><a href="#newInstance-方法" class="headerlink" title="newInstance()方法"></a><code>newInstance()</code>方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@CallerSensitive</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">newInstance</span><span class="hljs-params">()</span><br>        <span class="hljs-keyword">throws</span> InstantiationException, IllegalAccessException<br>    &#123;<br>        <span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-literal">null</span>) &#123;<br>            checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="hljs-literal">false</span>);<br>        &#125;<br><br><span class="hljs-comment">// 如果cachedConstructor为空，那么就</span><br>        <span class="hljs-keyword">if</span> (cachedConstructor == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == Class.class) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalAccessException</span>(<br>                    <span class="hljs-string">&quot;Can not call newInstance() on the Class for java.lang.Class&quot;</span><br>                );<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// 在这里，empty代表要获取的空参构造对象</span><br>                Class&lt;?&gt;[] empty = &#123;&#125;;<br>                <span class="hljs-keyword">final</span> Constructor&lt;T&gt; c = getConstructor0(empty, Member.DECLARED);<br> java.security.AccessController.doPrivileged(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.security.PrivilegedAction&lt;Void&gt;() &#123;<br>                        <span class="hljs-keyword">public</span> Void <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                                c.setAccessible(<span class="hljs-literal">true</span>);<br>                                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                            &#125;<br>                        &#125;);<br>                cachedConstructor = c;<br><span class="hljs-comment">// 如果没有空参构造方法就抛异常</span><br>            &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;<br>                <span class="hljs-keyword">throw</span> (InstantiationException)<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiationException</span>(getName()).initCause(e);<br>            &#125;<br>        &#125;<br>        Constructor&lt;T&gt; tmpConstructor = cachedConstructor;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">modifiers</span> <span class="hljs-operator">=</span> tmpConstructor.getModifiers();<br>        <span class="hljs-keyword">if</span> (!Reflection.quickCheckMemberAccess(<span class="hljs-built_in">this</span>, modifiers)) &#123;<br>            Class&lt;?&gt; caller = Reflection.getCallerClass();<br>            <span class="hljs-keyword">if</span> (newInstanceCallerCache != caller) &#123;<br>                Reflection.ensureMemberAccess(caller, <span class="hljs-built_in">this</span>, <span class="hljs-literal">null</span>, modifiers);<br>                newInstanceCallerCache = caller;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// Run constructor</span><br>        <span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// 调用空参构造对象的newInstance()创建实例</span><br>            <span class="hljs-keyword">return</span> tmpConstructor.newInstance((Object[])<span class="hljs-literal">null</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InvocationTargetException e) &#123;<br>            Unsafe.getUnsafe().throwException(e.getTargetException());<br>            <span class="hljs-comment">// Not reached</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">transient</span> Constructor&lt;T&gt; cachedConstructor;  <br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">transient</span> Class&lt;?&gt; newInstanceCallerCache;<br></code></pre></td></tr></table></figure><p>首先关注一下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Class&lt;?&gt;[] empty = &#123;&#125;;  <br><span class="hljs-keyword">final</span> Constructor&lt;T&gt; c = getConstructor0(empty, Member.DECLARED);<br></code></pre></td></tr></table></figure><p>再仔细看<code>getConstructor0</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Constructor&lt;T&gt; <span class="hljs-title function_">getConstructor0</span><span class="hljs-params">(Class&lt;?&gt;[] parameterTypes,</span><br><span class="hljs-params">                                    <span class="hljs-type">int</span> which)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException<br>&#123;<br>    Constructor&lt;T&gt;[] constructors = privateGetDeclaredConstructors((which == Member.PUBLIC));<br>    <span class="hljs-keyword">for</span> (Constructor&lt;T&gt; constructor : constructors) &#123;<br>        <span class="hljs-keyword">if</span> (arrayContentsEq(parameterTypes,<br>                            constructor.getParameterTypes())) &#123;<br>            <span class="hljs-keyword">return</span> getReflectionFactory().copyConstructor(constructor);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchMethodException</span>(getName() + <span class="hljs-string">&quot;.&lt;init&gt;&quot;</span> + argumentTypesToString(parameterTypes));<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，empty对应的是parameterTypes，也就是参数类型，因为之前的empty为空，所以调用的是空参构造函数，如果没有空参构造方法就抛异常。</p><p>调用空参构造对象的newInstance()创建实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">tmpConstructor.newInstance((Object[]) <span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><p>所以，本质上Class对象要想创建实例，其实都是通过构造器（<code>tmpConstructor</code>）对象。如果没有空参构造对象，就无法使用clazz.newInstance()，必须要获取其他有参的构造对象然后调用构造对象的newInstance()。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java反射</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e9f844295dba.html"/>
    <url>/2022/12/e9f844295dba.html</url>
    
    <content type="html"><![CDATA[<h1 id="构建基础"><a href="#构建基础" class="headerlink" title="构建基础"></a>构建基础</h1><h2 id="Projects-和-tasks"><a href="#Projects-和-tasks" class="headerlink" title="Projects 和 tasks"></a>Projects 和 tasks</h2><p>projects 和 tasks是 Gradle 中最重要的两个概念。</p><p>任何一个 Gradle 构建都是由一个或多个 projects 组成。每个 project 包括许多可构建组成部分。 这完全取决于你要构建些什么。举个例子，每个 project 或许是一个 jar 包或者一个 web 应用，它也可以是一个由许多其他项目中产生的 jar 构成的 zip 压缩包。一个 project 不必描述它只能进行构建操作。它也可以部署你的应用或搭建你的环境。不要担心它像听上去的那样庞大。 Gradle 的 build-by-convention 可以让您来具体定义一个 project 到底该做什么。</p><p>每个 project 都由多个 tasks 组成。每个 task 都代表了构建执行过程中的一个原子性操作。如编译，打包，生成 javadoc，发布到某个仓库等操作。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">task upper &lt;&lt; &#123;<br>    String someString = &#x27;mY_nAmE&#x27;<br>    println &quot;Original: &quot; + someString<br>    println &quot;Upper case: &quot; + someString.toUpperCase()<br>&#125;<br></code></pre></td></tr></table></figure><p>Output of gradle -q upper</p><blockquote><p>gradle -q upper<br>Original: mY_nAmE<br>Upper case: MY_NAME</p></blockquote><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p><strong>注</strong>：&lt;&lt;在Gradle4.x中被弃用，在Gradle 5.0中被移除，详情见：<a href="https://docs.gradle.org/4.0/release-notes.html#setting-the-compiler-executable-is-no-longer-deprecated">Gradle 4.x官网</a><br><strong>例</strong>：task &lt;&lt; { println ‘Hello world!’}   <br><strong>解决方法</strong>：直接去掉或使用doLast解决。</p><h2 id="任务依赖"><a href="#任务依赖" class="headerlink" title="任务依赖"></a>任务依赖</h2><h3 id="在两个任务之间指明依赖关系"><a href="#在两个任务之间指明依赖关系" class="headerlink" title="在两个任务之间指明依赖关系"></a>在两个任务之间指明依赖关系</h3><p>build.gradle</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml">task hello &lt;&lt; &#123;<br>    println &#x27;Hello world!&#x27;<br>&#125;<br>task intro(dependsOn: hello) &lt;&lt; &#123;<br>    println &quot;I&#x27;m Gradle&quot;<br>&#125;<br></code></pre></td></tr></table></figure><p>Output of gradle -q intro</p><blockquote><p>gradle -q intro<br>Hello world!<br>I’m Gradle</p></blockquote><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211123100013.png"></p><h3 id="延迟依赖"><a href="#延迟依赖" class="headerlink" title="延迟依赖"></a>延迟依赖</h3><p>build.gradle</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml">task taskX(dependsOn: &#x27;taskY&#x27;) &lt;&lt; &#123;<br>    println &#x27;taskX&#x27;<br>&#125;<br>task taskY &lt;&lt; &#123;<br>    println &#x27;taskY&#x27;<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><blockquote><p>gradle -q taskX<br>taskY<br>taskX</p></blockquote><p>可以看到，taskX是在taskY之前被定义的，但是还是可以引用taskY，这在多项目构建中是非常有用的。</p><h2 id="通过API进行任务之间的通信"><a href="#通过API进行任务之间的通信" class="headerlink" title="通过API进行任务之间的通信"></a>通过API进行任务之间的通信</h2><h3 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h3><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211123101012.png"></p><p>在这里，创建了4个任务（task0到task3），然后通过API添加了依赖，让task0依赖于task2和task3，最后输出。</p><h3 id="增加任务行为"><a href="#增加任务行为" class="headerlink" title="增加任务行为"></a>增加任务行为</h3><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211123101922.png"></p><p>在这里，定义了一个任务hello，并且在前后并且最后都添加了相应的任务行为。</p><p>doFirst和doLast可以进行多次调用。他们分别被添加到任务的开头和结尾。当任务开始执行时这些动作会按照既定顺序进行。</p><p><strong>其中&lt;&lt;操作符是doLast的简写模式</strong>。</p><h2 id="增加自定义属性"><a href="#增加自定义属性" class="headerlink" title="增加自定义属性"></a>增加自定义属性</h2><h3 id="为任务增加自定义属性"><a href="#为任务增加自定义属性" class="headerlink" title="为任务增加自定义属性"></a>为任务增加自定义属性</h3><p>build.gradle</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">task myTask &#123;<br>        ext.myProperty = &quot;myValue&quot;<br>&#125;<br><br>task printTaskProperties &lt;&lt; &#123;<br>        println myTask.myProperty<br>&#125;<br><br>[root@coachhe-code HelloWorld]# gradle -q printTaskProperties<br>myValue<br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211123102953.png"></p><h2 id="定义默认任务"><a href="#定义默认任务" class="headerlink" title="定义默认任务"></a>定义默认任务</h2><p>build.gradle</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">defaultTasks &#x27;clean&#x27;, &#x27;run&#x27;<br>task clean &lt;&lt; &#123;<br>    println &#x27;Default Cleaning!&#x27;<br>&#125;<br>task run &lt;&lt; &#123;<br>    println &#x27;Default Running!&#x27;<br>&#125;<br>task other &lt;&lt; &#123;<br>    println &quot;I&#x27;m not a default task!&quot;<br>&#125;<br></code></pre></td></tr></table></figure><p>gradle -q的输出结果</p><blockquote><p>gradle -q<br>Default Cleaning!<br>Default Running</p></blockquote><p>也就是说，如果我不指定要执行的任务，就会默认执行Default的任务。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java工具</category>
      
      <category>Gradle</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/f452954324f7.html"/>
    <url>/2022/12/f452954324f7.html</url>
    
    <content type="html"><![CDATA[<h1 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h1><p><code>@Import</code>是<code>Spring</code>基于 Java 注解配置的主要组成部分。<code>@Import</code>注解提供了<code>@Bean</code>注解的功能，同时还有原来<code>Spring</code>基于 xml 配置文件里的<code>&lt;import&gt;</code>标签组织多个分散的xml文件的功能，当然在这里是组织多个分散的<code>@Configuration</code>的类。</p><h1 id="Import注解的功能"><a href="#Import注解的功能" class="headerlink" title="@Import注解的功能"></a>@Import注解的功能</h1><h2 id="1-引入其他的-Configuration"><a href="#1-引入其他的-Configuration" class="headerlink" title="1. 引入其他的@Configuration"></a>1. 引入其他的@Configuration</h2><p>假设有如下接口和两个实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ServiceInterface</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServiceInterface</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ServiceA&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServiceInterface</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ServiceB&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>两个<code>@Configuration</code>，其中<code>ConfigA``@Import``ConfigB</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test<br><span class="hljs-meta">@Import(ConfigB.class)</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigA</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> ServiceInterface <span class="hljs-title function_">getServiceA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceA</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigB</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> ServiceInterface <span class="hljs-title function_">getServiceB</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceB</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>通过<code>ConfigA</code>创建<code>AnnotationConfigApplicationContext</code>，获取<code>ServiceInterface</code>，看是哪种实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(ConfigA.class);<br>    <span class="hljs-type">ServiceInterface</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> ctx.getBean(ServiceInterface.class);<br>    bean.test();<br>&#125;<br></code></pre></td></tr></table></figure><p>输出为：<code>ServiceB</code>.证明<code>@Import</code>的优先于本身的的类定义加载。</p><h2 id="2-直接初始化其他类的Bean"><a href="#2-直接初始化其他类的Bean" class="headerlink" title="2. 直接初始化其他类的Bean"></a>2. 直接初始化其他类的Bean</h2><p> 在<strong>Spring 4.2</strong>之后，<code>@Import</code>可以直接指定实体类，加载这个类定义到<code>context</code>中。 例如把上面代码中的<code>ConfigA</code>的<code>@Import</code>修改为<code>@Import(ServiceB.class)</code>，就会生成<code>ServiceB</code>的<code>Bean</code>到容器上下文中，之后运行<code>main</code>方法，输出为：<code>ServiceB</code>.证明<code>@Import</code>的优先于本身的的类定义加载.</p><h2 id="3-指定实现ImportSelector-以及DefferredServiceImportSelector-的类，用于个性化加载"><a href="#3-指定实现ImportSelector-以及DefferredServiceImportSelector-的类，用于个性化加载" class="headerlink" title="3. 指定实现ImportSelector(以及DefferredServiceImportSelector)的类，用于个性化加载"></a>3. 指定实现ImportSelector(以及DefferredServiceImportSelector)的类，用于个性化加载</h2><p> 指定实现<code>ImportSelector</code>的类，通过<code>AnnotationMetadata</code>里面的属性，动态加载类。</p><h3 id="AnnotationMetadata"><a href="#AnnotationMetadata" class="headerlink" title="AnnotationMetadata"></a>AnnotationMetadata</h3><p> <code>AnnotationMetadata</code>是<code>Import</code>注解所在的类属性（如果所在类是注解类，则延伸至应用这个注解类的非注解类为止）。</p><p>需要实现<code>selectImports</code>方法，返回要加载的<code>@Configuation</code>或者具体<code>Bean</code>类的全限定名的<code>String</code>数组。</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java注解</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/54b80c2de8bb.html"/>
    <url>/2022/12/54b80c2de8bb.html</url>
    
    <content type="html"><![CDATA[<h1 id="什么是注解"><a href="#什么是注解" class="headerlink" title="什么是注解"></a>什么是注解</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ul><li>不是程序本身，可以对程序做出解释  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.annotation<br>   <span class="hljs-comment">// 什么是注解</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test01</span> &#123;<br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>       &#125;<br>   &#125;<br><br><br></code></pre></td></tr></table></figure></li><li>可以被其他程序（比如：编译器等）读取</li></ul><h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><ul><li>注解是以”@注释名”在代码中存在的，还可以添加一些参数值，例如：<code>@SuppressWarning(value=&quot;unchecked&quot;)</code></li></ul><h2 id="在哪里使用"><a href="#在哪里使用" class="headerlink" title="在哪里使用"></a>在哪里使用</h2><ul><li>可以附加在package，class，method，field上面，相当于给他们添加了额外的辅助信息，我们可以通过反射机制编程实现对这些元数据的访问</li></ul><h1 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h1><h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h2><p>元注解的作用就是负责注解其他注解。</p><h2 id="四个元注解类型"><a href="#四个元注解类型" class="headerlink" title="四个元注解类型"></a>四个元注解类型</h2><h3 id="Target"><a href="#Target" class="headerlink" title="@Target"></a><code>@Target</code></h3><h4 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Target &#123;  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * Returns an array of the kinds of elements an annotation type </span><br><span class="hljs-comment"> * can be applied to. </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> an array of the kinds of elements an annotation type  </span><br><span class="hljs-comment">     * can be applied to </span><br><span class="hljs-comment"> */</span> <br>ElementType[] value();  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>@Target</code>说明了Annotaion所修饰的对象范围。<br>Annotation可被用于 </p><ol><li>packages、types（类、接口、枚举、Annotation类型）</li><li>类型成员（方法、构造方法、成员变量、枚举值）</li><li>方法参数和本地变量（如循环变量、catch参数）</li></ol><h4 id="Target的作用"><a href="#Target的作用" class="headerlink" title="@Target的作用"></a><code>@Target</code>的作用</h4><p>在Annotation类型的声明中使用了target可更加明晰其修饰的目标。</p><h3 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a><code>@Documented</code></h3><p>说明该注解是否需要产生在JAVAdoc中</p><h4 id="源代码-1"><a href="#源代码-1" class="headerlink" title="源代码"></a>源代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Documented &#123;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a><code>@Retention</code></h3><p>表明需要在什么级别保存该注释信息，用于描述注解的<strong>生命周期</strong>。<br><code>SOURCE&lt;CLASS&lt;RUNTIME</code></p><h4 id="源代码-2"><a href="#源代码-2" class="headerlink" title="源代码"></a>源代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Retention &#123;  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">    * Returns the retention policy. </span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span> the retention policy  </span><br><span class="hljs-comment">    */</span> <br>RetentionPolicy <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a><code>@Inherited</code></h3><p>子类可以继承父类的注解</p><h4 id="源代码-3"><a href="#源代码-3" class="headerlink" title="源代码"></a>源代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Inherited &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="元注解使用示例"><a href="#元注解使用示例" class="headerlink" title="元注解使用示例"></a>元注解使用示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.annotation;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><br><span class="hljs-comment">// 测试元注解</span><br><span class="hljs-meta">@MyAnnotation</span> <span class="hljs-comment">//放这里可以</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test02</span> &#123;<br><br><span class="hljs-comment">//    @MyAnnotation // 这里会报错，因为在下面声明了只能修饰Element.TYPE，也就是类或者接口等</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义一个注解</span><br><span class="hljs-comment">// @Target 表示我们的注解可以用在哪些地方</span><br><span class="hljs-meta">@Target(value= ElementType.TYPE)</span><br><span class="hljs-comment">// @Retention 表示我们的注解在什么地方还有效，比如SOURCE只能在源码阶段有效</span><br><span class="hljs-meta">@Retention(value= RetentionPolicy.SOURCE)</span><br><span class="hljs-comment">// @Documented 表示是否将我们的注解生成在JAVAdoc中</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-comment">// @Inherited 子类可以继承父类的注解</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@interface</span> MyAnnotation&#123;&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>Java语法</category>
      
      <category>Java注解</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/524b98130287.html"/>
    <url>/2022/12/524b98130287.html</url>
    
    <content type="html"><![CDATA[<h1 id="原理初探"><a href="#原理初探" class="headerlink" title="原理初探"></a>原理初探</h1><p>自动配置</p><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><p>pom.xml中自动配置了依赖</p><p>启动器<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210919171656.png"></p><ul><li>spring-boot-dependencies:核心依赖在父工程中<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li>说白了就是Springboot的启动场景</li><li>比如spring-boot-starter-web，他就会帮我们将所有web相关的功能场景进行打包</li><li>springboot会将所有的场景功能场景，都变成一个个的启动器</li><li>我们要使用什么功能，就只需要找到对应的启动器就可以了<code>starter</code></li><li>我们在写或者引入一些Springboot依赖的时候，不需要指定版本，就因为有这些版本仓库。<br>具体来说，例如放在resources里面的application文件能被感知到的原因<img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210919171327.png></li></ul><h2 id="主程序"><a href="#主程序" class="headerlink" title="主程序"></a>主程序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.coachhe.springboot.learning;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;  <br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;  <br>  <br><span class="hljs-meta">@SpringBootApplication</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringbootApplication</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        SpringApplication.run(SpringbootApplication.class, args);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>@SpringBootApplication<br>顾名思义，这是Springboot的配置类。进入这个注解，可以看到这个注解由多个注解组成：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Inherited</span>  <br><span class="hljs-meta">@SpringBootConfiguration</span>  <br><span class="hljs-meta">@EnableAutoConfiguration</span>  <br><span class="hljs-meta">@ComponentScan(  </span><br><span class="hljs-meta">    excludeFilters = &#123;@Filter(  </span><br><span class="hljs-meta">    type = FilterType.CUSTOM,  </span><br><span class="hljs-meta">    classes = &#123;TypeExcludeFilter.class&#125;  </span><br><span class="hljs-meta">), @Filter(  </span><br><span class="hljs-meta">    type = FilterType.CUSTOM,  </span><br><span class="hljs-meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;  </span><br><span class="hljs-meta">)&#125;  </span><br><span class="hljs-meta">)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>先来看看<code>@SpringBootConfiguration</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration &#123;  <br>    <span class="hljs-meta">@AliasFor(  </span><br><span class="hljs-meta">        annotation = Configuration.class  </span><br><span class="hljs-meta"> )</span>  <br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">proxyBeanMethods</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，这个注解是由Configuration构成的，也就是说这个注解就是个也是一个Spring组件。</p><p>接着看看<code>@EnableAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Inherited</span>  <br><span class="hljs-meta">@AutoConfigurationPackage</span>  <br><span class="hljs-meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;  <br>    <span class="hljs-type">String</span> <span class="hljs-variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>;  <br>  <br>    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> &#123;&#125;;  <br>  <br>    String[] excludeName() <span class="hljs-keyword">default</span> &#123;&#125;;  <br>&#125;<br></code></pre></td></tr></table></figure><p>在这里我们看到，重要的是两个注解，<code>@AutoConfigurationPackage</code>和<code>@Import(&#123;AutoConfigurationImportSelector.class&#125;)</code>，首先来看看第一个注解<code>@AutoConfigurationPackage</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Documented</span>  <br><span class="hljs-meta">@Inherited</span>  <br><span class="hljs-meta">@Import(&#123;Registrar.class&#125;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage &#123;  <br>&#125;<br></code></pre></td></tr></table></figure><p>在这里导入了一个注册器<br><code>@Import(&#123;Register.class&#125;)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Registrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImportBeanDefinitionRegistrar</span>, DeterminableImports &#123;<br>        Registrar() &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;<br>            AutoConfigurationPackages.register(registry, (<span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationPackages</span>.PackageImport(metadata)).getPackageName());<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title function_">determineImports</span><span class="hljs-params">(AnnotationMetadata metadata)</span> &#123;<br>            <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationPackages</span>.PackageImport(metadata));<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>接着看第二个注解<code>@Import(&#123;AutoConfigurationImportSelector.class&#125;)</code>，这是一个选择器，点进去</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/536fd9254766.html"/>
    <url>/2022/12/536fd9254766.html</url>
    
    <content type="html"><![CDATA[<p>HBase 是一种&#x3D;&#x3D;分布式&#x3D;&#x3D;、&#x3D;&#x3D;可扩展&#x3D;&#x3D;、&#x3D;&#x3D;支持海量数据存储&#x3D;&#x3D;的NoSQL数据库。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>HBase</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/91a8f02780f0.html"/>
    <url>/2022/12/91a8f02780f0.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-Name-Space"><a href="#1-Name-Space" class="headerlink" title="1 Name Space"></a>1 Name Space</h1><p>命名空间，类似于关系型数据库的DatabBase 概念，每个命名空间下有多个表。HBase有两个自带的命名空间，分别是&#x3D;&#x3D;hbase&#x3D;&#x3D; 和&#x3D;&#x3D;default&#x3D;&#x3D;，&#x3D;&#x3D;hbase &#x3D;&#x3D;中存放的是HBase 内置的表，&#x3D;&#x3D;default&#x3D;&#x3D; 表是用户默认使用的命名空间。</p><h1 id="2-Region"><a href="#2-Region" class="headerlink" title="2 Region"></a>2 Region</h1><p>类似于关系型数据库的表概念。不同的是，HBase 定义表时只需要声明&#x3D;&#x3D;列族&#x3D;&#x3D;即可，不需要声明具体的列。这意味着，往HBase 写入数据时，字段可以&#x3D;&#x3D;动态&#x3D;&#x3D;、&#x3D;&#x3D;按需&#x3D;&#x3D;指定。因此，和关系型数据库相比，HBase 能够轻松应对字段变更的场景。</p><h1 id="3-Row"><a href="#3-Row" class="headerlink" title="3 Row"></a>3 Row</h1><p>HBase表中的每行数据都由一个&#x3D;&#x3D;RowKey&#x3D;&#x3D;和多个&#x3D;&#x3D;Column&#x3D;&#x3D;（列）组成，数据是按照RowKey的&#x3D;&#x3D;字典顺序存储&#x3D;&#x3D;的，并且查询数据时只能根据RowKey进行检索，所以RowKey 的设计十分重要。</p><h1 id="4-Column"><a href="#4-Column" class="headerlink" title="4 Column"></a>4 Column</h1><p>HBase中的每个列都由 &#x3D;&#x3D;Column Family(列族)&#x3D;&#x3D; 和 &#x3D;&#x3D;Column Qualifier（列限定符）&#x3D;&#x3D; 进行限定，例如info：name，info：age。建表时，只需指明列族，而列限定符无需预先定义。</p><h1 id="5-Time-Stamp"><a href="#5-Time-Stamp" class="headerlink" title="5 Time Stamp"></a>5 Time Stamp</h1><p>用于标识数据的不同版本（version），每条数据写入时，如果不指定时间戳，系统会 自动为其加上该字段，其值为写入HBase 的时间。</p><h1 id="6-Cell"><a href="#6-Cell" class="headerlink" title="6 Cell"></a>6 Cell</h1><p>由{rowkey, column Family：column Qualifier, time Stamp} 唯一确定的单元。cell中的数据是没有类型的，全部是字节码形式存贮。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>HBase</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/05c8e81af2c2.html"/>
    <url>/2022/12/05c8e81af2c2.html</url>
    
    <content type="html"><![CDATA[<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>最重要的就是TimeStamp，根据这个可以利用HDFS来实现增删改查的功能。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>HBase</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/60e3d28ea32b.html"/>
    <url>/2022/12/60e3d28ea32b.html</url>
    
    <content type="html"><![CDATA[<h1 id="HBase数据模型"><a href="#HBase数据模型" class="headerlink" title="HBase数据模型"></a>HBase数据模型</h1><h2 id="逻辑"><a href="#逻辑" class="headerlink" title="逻辑"></a>逻辑</h2><p>HBase 的数据模型同关系型数据库很类似，数据存储在一张表中，有行有列。</p><h2 id="底层物理存储结构"><a href="#底层物理存储结构" class="headerlink" title="底层物理存储结构"></a>底层物理存储结构</h2><p>但从HBase 的底层物理存储结构（K-V）来看，HBase 更像是一个multi-dimensional map。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>HBase</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7ee4177945a8.html"/>
    <url>/2022/12/7ee4177945a8.html</url>
    
    <content type="html"><![CDATA[<h1 id="一-Kafka概述"><a href="#一-Kafka概述" class="headerlink" title="一 Kafka概述"></a>一 Kafka概述</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>Kafka 是一个<strong>分布式</strong>的基于<strong>发布&#x2F;订阅模式</strong>的<strong>消息队列</strong>（Message Queue），主要应用于大数据实时处理领域。 </p><h2 id="消息队列（MQ）"><a href="#消息队列（MQ）" class="headerlink" title="消息队列（MQ）"></a>消息队列（MQ）</h2><h3 id="同步处理和异步处理"><a href="#同步处理和异步处理" class="headerlink" title="同步处理和异步处理"></a>同步处理和异步处理</h3><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409101746.png"></p><h3 id="使用消息队列的好处"><a href="#使用消息队列的好处" class="headerlink" title="使用消息队列的好处"></a>使用消息队列的好处</h3><ol><li><p>解耦 </p><p>允许你独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。 </p></li><li><p>可恢复性 </p><p>系统的一部分组件失效时，不会影响到整个系统。消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。 </p></li><li><p>缓冲 </p><p>有助于控制和优化数据流经过系统的速度，解决生产消息和费的处理速度不一致的情况。 </p></li><li><p>灵活性&amp;峰值处理能力 </p><p>在访问量剧增的情况下，应用仍然需要继续发挥作用，但是这样的突发流量并不常见。如果为以能处理这类峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。 </p></li><li><p>异步通信 </p><p>很多时候，用户不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。</p></li></ol><h3 id="消息队列的两种模型"><a href="#消息队列的两种模型" class="headerlink" title="消息队列的两种模型"></a>消息队列的两种模型</h3><h4 id="1-点对点模式"><a href="#1-点对点模式" class="headerlink" title="1. 点对点模式"></a>1. 点对点模式</h4><p>一对一，消费者主动拉取数据，消息收到后消息清除</p><p>消息生产者生产消息发送到Queue中，然后消息消费者从Queue中取出并且消费消息。 </p><p>消息被消费以后，queue中不再有存储，所以消息消费者不可能消费到已经被消费的消息。Queue支持存在多个消费者，但是对一个消息而言，只会有一个消费者可以消费。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409102037.png" style="zoom:50%;" /><h4 id="2-发布-x2F-订阅模式"><a href="#2-发布-x2F-订阅模式" class="headerlink" title="2. 发布&#x2F;订阅模式"></a>2. 发布&#x2F;订阅模式</h4><p>一对多，消费者消费数据之后不会清除消息</p><p>消息生产者（发布）将消息发布到topic中，同时有多个消息消费者（订阅）消费该消息。和点对点方式不同，发布到topic的消息会被所有订阅者消费。 </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409102049.png" style="zoom:50%;" /><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>发布&#x2F;订阅模式有两种 </p><p>一种是消息队列主动推送数据模式（消息队列确定推送速度）。 </p><ul><li>坏处：消费者可能扛不住</li><li>好处：消费者可以随时获取最新的消息</li></ul><p>一种是消费者主动拉取数据模式（消费者确定拉取速度）。 </p><ul><li>坏处：需要耗费大量资源去轮询获取最新的消息</li><li>好处：能根据消费者的需要去动态获取数据</li></ul><h3 id="Kafka基本架构"><a href="#Kafka基本架构" class="headerlink" title="Kafka基本架构"></a>Kafka基本架构</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409102147.png" style="zoom:50%;" /><p><strong>1）Producer</strong> ：消息生产者，就是向kafka broker 发消息的客户端； </p><p><strong>2）Consumer</strong> ：消息消费者，向kafka broker 取消息的客户端； </p><p><strong>3）Consumer Group</strong> （<strong>CG</strong>）：消费者组，由多个consumer 组成。消费者组内每个消费者负责消费不同分区的数据，一个分区只能由一个组内消费者消费；消费者组之间互不影响。所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者。 </p><p><strong>4）Broker</strong> ：一台kafka 服务器就是一个broker。一个集群由多个broker 组成。一个broker 可以容纳多个topic。 </p><p><strong>5）Topic</strong> ：可以理解为一个队列，生产者和消费者面向的都是一个<strong>topic</strong>； </p><p><strong>6）Partition</strong>：为了实现扩展性，一个非常大的topic 可以分布到多个broker（即服务器）上，一个<strong>topic</strong> 可以分为多个<strong>partition</strong>，<strong>每个partition 是一个有序的队列</strong>； </p><p><strong>7）Replica</strong>：副本，为保证集群中的某个节点发生故障时，该节点上的partition 数据不丢失， </p><h1 id="二-Kafka入门"><a href="#二-Kafka入门" class="headerlink" title="二 Kafka入门"></a>二 Kafka入门</h1><h2 id="1-Kafka安装"><a href="#1-Kafka安装" class="headerlink" title="1. Kafka安装"></a>1. Kafka安装</h2><h3 id="文件的解压"><a href="#文件的解压" class="headerlink" title="文件的解压"></a>文件的解压</h3><ol><li><p>将<code>kafka_2.11-0.11.0.0.tgz</code>文件解压到<code>/opt/module</code>中</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112216.png" style="zoom:33%;" /><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@3e54fd72a673 software]# tar xvfz kafka_2.11-0.11.0.0.tgz -C /opt/module/<br></code></pre></td></tr></table></figure></li><li><p>文件改名</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112414.png" style="zoom:33%;" /><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@3e54fd72a673 module]# mv kafka_2.11-0.11.0.0/ kafka<br></code></pre></td></tr></table></figure></li></ol><h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><h4 id="修改server-properties"><a href="#修改server-properties" class="headerlink" title="修改server.properties"></a>修改server.properties</h4><ol><li><p>首先使得每个broker.id唯一</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112631.png" style="zoom: 50%;" /></li><li><p>zookeeper连接端口</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112800.png" style="zoom:50%;" /><p>更改之后：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112852.png" style="zoom:50%;" /></li><li><p>更改暂存文件目录</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112930.png" style="zoom:50%;" /><p>修改之后：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409112957.png" style="zoom:50%;" /></li><li><p>打开使能删除功能</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409113043.png" style="zoom:50%;" /></li></ol><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><ol><li><p>在<code>/etc/profile</code>中增加<code>KAFKA_HOME</code></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409113314.png"></p></li><li><p>执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@3e54fd72a673 config]# source /etc/profile<br></code></pre></td></tr></table></figure></li></ol><h3 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h3><p>将kafka复制到其他服务器上，然后修改每个服务器的broker id即可（保证broker id）唯一 </p><ol><li>chadoop1</li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409113508.png" style="zoom:50%;" /><ol start="2"><li>chadoop2</li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409113616.png" style="zoom:50%;" /><ol start="3"><li>chadoop3</li></ol><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409113651.png" style="zoom:50%;" /><h2 id="2-Kfaka启动"><a href="#2-Kfaka启动" class="headerlink" title="2. Kfaka启动"></a>2. Kfaka启动</h2><h3 id="启动命令"><a href="#启动命令" class="headerlink" title="启动命令"></a>启动命令</h3><p>需要保证zk启动</p><h4 id="启动的两种方式"><a href="#启动的两种方式" class="headerlink" title="启动的两种方式"></a>启动的两种方式</h4><ol><li><p>启动阻塞进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kafka-server-start.sh config/server.properties<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409114822.png" style="zoom:50%;" /></li><li><p>启动守护进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kafka-server-start.sh -daemon config/server.properties<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409114920.png" style="zoom:50%;" /></li></ol><h3 id="群起Kafka"><a href="#群起Kafka" class="headerlink" title="群起Kafka"></a>群起Kafka</h3><p>kafka没有群起脚本，我们可以自己制作一个。 </p><h4 id="群起脚本代码"><a href="#群起脚本代码" class="headerlink" title="群起脚本代码"></a>群起脚本代码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span> <br> <br>case $1 in <br>  &quot;start&quot;)&#123; <br> <br>    for i in chadoop1 chadoop2 chadoop3<br>    do <br>        echo &quot;************$i************&quot; <br>        ssh $i &quot;/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties&quot; <br>    done <br>&#125;;; <br> <br>  &quot;stop&quot;)&#123; <br> <br>    for i in chadoop1 chadoop2 chadoop3 <br>    do <br>        echo &quot;************$i************&quot; <br>        ssh $i &quot;/opt/module/kafka/bin/kafka-server-stop.sh /opt/module/kafka/config/server.properties&quot; <br>    done <br>&#125;;; <br> <br>esac<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409115146.png" style="zoom:50%;" /><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>ssh时经常无法识别JAVA_HOME，因此经常找不到jps指令和JAVA指令，也就无法启动Kafka，因此我们需要在脚本kafka-server-start.sh中指定JAVA_HOME。</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409115331.png" style="zoom:50%;" /><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kakfa.sh start<br></code></pre></td></tr></table></figure><ol><li><p>chadoop1</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409120237.png" style="zoom:50%;" /></li><li><p>chadoop2</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409120302.png" style="zoom:50%;" /></li><li><p>chadoop3</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210409120325.png" style="zoom:50%;" /></li></ol>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>MQ</category>
      
      <category>KafKa</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e35058a116b8.html"/>
    <url>/2022/12/e35058a116b8.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-Region-Server"><a href="#1-Region-Server" class="headerlink" title="1 Region Server"></a>1 Region Server</h1><p>Region Server 为 &#x3D;&#x3D;Region 的管理者&#x3D;&#x3D;，其实现类为HRegionServer.  </p><h2 id="主要作用如下"><a href="#主要作用如下" class="headerlink" title="主要作用如下:"></a>主要作用如下:</h2><p><strong>对于数据的操作</strong>：get, put, delete；<br><strong>对于Region 的操作</strong>：splitRegion、compactRegion。</p><h1 id="2-Master"><a href="#2-Master" class="headerlink" title="2 Master"></a>2 Master</h1><p>Master 是所有&#x3D;&#x3D;Region Server 的管理者&#x3D;&#x3D;，其实现类为HMaster</p><h2 id="主要作用如下："><a href="#主要作用如下：" class="headerlink" title="主要作用如下："></a>主要作用如下：</h2><p><strong>对于表的操作：</strong> create, delete, alter<br><strong>对于RegionServer 的操作</strong> ：分配regions 到每个RegionServer，监控每个RegionServer 的状态，负载均衡和故障转移。</p><h1 id="3-Zookeeper"><a href="#3-Zookeeper" class="headerlink" title="3 Zookeeper"></a>3 Zookeeper</h1><p>HBase 通过Zookeeper 来做Master 的高可用、RegionServer 的监控、元数据的入口以及集群配置的维护等工作。</p><h1 id="4-HDFS"><a href="#4-HDFS" class="headerlink" title="4 HDFS"></a>4 HDFS</h1><p>HDFS 为HBase 提供最终的底层数据存储服务，同时为HBase 提供高可用的支持。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>HBase</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/36c06a135d7e.html"/>
    <url>/2022/12/36c06a135d7e.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-创建和查看主题"><a href="#1-创建和查看主题" class="headerlink" title="1. 创建和查看主题"></a>1. 创建和查看主题</h1><h2 id="关键脚本"><a href="#关键脚本" class="headerlink" title="关键脚本"></a>关键脚本</h2><p><code>kafka-topics.sh</code></p><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="查看所有topic"><a href="#查看所有topic" class="headerlink" title="查看所有topic"></a>查看所有topic</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kafka-topics.sh --zookeeper kafka01:2181 --list<br></code></pre></td></tr></table></figure><h3 id="创建主题"><a href="#创建主题" class="headerlink" title="创建主题"></a>创建主题</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 创建名为first的topic</span></span><br>kakfa-topics.sh --create --zookeeper kafka01:2181 --topic first --partitions 2 --replication-factor 2<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 创建名为second的topic</span></span><br>kakfa-topics.sh --create --zookeeper kafka01:2181 --topic second --partitions 2 --replication-factor 2<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210419003535.png" width="1100"><h4 id="查看各个服务器的logs文件"><a href="#查看各个服务器的logs文件" class="headerlink" title="查看各个服务器的logs文件"></a>查看各个服务器的logs文件</h4><p>注意：需要先将配置文件server.properties文件里的log.dir更改路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">log.dirs=/opt/module/kafka_2.12-2.7.1/logs<br></code></pre></td></tr></table></figure><p>然后就可以在对应的文件下查看到创建的目录</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210801134547.png" width="1100"><p>这里的<code>first-0</code>和<code>first-1</code>对应的是partitions的数量，并且他们会在不同的主机上存有副本,可以看到，对应的kafka02机器上就只有一个first-1,这是因为replication-factor数量为2，所以两个first-1就是两个副本。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20210801134949.png" width="1100"><h3 id="删除主题"><a href="#删除主题" class="headerlink" title="删除主题"></a>删除主题</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kafka-topics.sh --delete --zookeeper kafka01:2181 --topic second<br></code></pre></td></tr></table></figure><h1 id="2-产生和消费消息"><a href="#2-产生和消费消息" class="headerlink" title="2. 产生和消费消息"></a>2. 产生和消费消息</h1><h2 id="命令-1"><a href="#命令-1" class="headerlink" title="命令"></a>命令</h2><h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@kafka02 kafka_2.12-2.7.1]# kafka-console-producer.sh --topic first --broker-list kafka01:9092<br></code></pre></td></tr></table></figure><p>往first这个topic里发送消息</p><h3 id="消费消息"><a href="#消费消息" class="headerlink" title="消费消息"></a>消费消息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">从最近的消息开始消费</span><br>[root@kafka03 kafka_2.12-2.7.1]# kafka-console-consumer.sh --topic first --bootstrap-server kafka02:9092<br><span class="hljs-meta prompt_"># </span><span class="language-bash">从最之前的消息开始消费</span><br>[root@kafka03 kafka_2.12-2.7.1]# kafka-console-consumer.sh --topic first --bootstrap-server kafka02:9092 --from-begining<br></code></pre></td></tr></table></figure><p>注意：<br>在这里之前是使用<code>kafka-console-consumer.sh --topic first --zookeeper kafka02:2181</code>，但是现在已经不支持zookeeper，所以要用bootstrap-server</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">在kafka02上发送消息</span><br>[root@kafka02 logs]# kafka-console-producer.sh --topic first --broker-list kafka01:9092<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">hello kafka</span> <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"></span><br><span class="language-bash"></span><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">在kafka03上接收消息</span><br>```shell<br>[root@kafka03 kafka_2.12-2.7.1]# kafka-console-consumer.sh --topic first --bootstrap-server kafka02:9092<br>hello kafka<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>MQ</category>
      
      <category>KafKa</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/074c169ae7be.html"/>
    <url>/2022/12/074c169ae7be.html</url>
    
    <content type="html"><![CDATA[<h1 id="一、-准备工作"><a href="#一、-准备工作" class="headerlink" title="一、 准备工作"></a>一、 准备工作</h1><h2 id="1-关闭防火墙"><a href="#1-关闭防火墙" class="headerlink" title="1. 关闭防火墙"></a>1. 关闭防火墙</h2><ul><li>关闭防火墙：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop firewalld<br></code></pre></td></tr></table></figure><ul><li>禁止防火墙开机自启：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl disable firewalld<br></code></pre></td></tr></table></figure><h2 id="2-关闭selinux"><a href="#2-关闭selinux" class="headerlink" title="2. 关闭selinux"></a>2. 关闭selinux</h2><ul><li>永久关闭：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">永久</span><br>sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config<br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启</span><br>reboot<br></code></pre></td></tr></table></figure><ul><li>临时关闭：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"> # </span><span class="language-bash">临时</span><br>setenforce 0<br></code></pre></td></tr></table></figure><h2 id="3-关闭swap分区"><a href="#3-关闭swap分区" class="headerlink" title="3 关闭swap分区"></a>3 关闭swap分区</h2><ul><li>永久关闭swap分区：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">永久</span><br>sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启</span><br>reboot<br></code></pre></td></tr></table></figure><ul><li>临时关闭swap分区：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">swapoff -a<br></code></pre></td></tr></table></figure><h2 id="4-主机名"><a href="#4-主机名" class="headerlink" title="4 主机名"></a>4 主机名</h2><p>注：这里可以是自己去腾讯云上租服务器，也可以装三个虚拟机。我的是重装了一台很久不用的windows台式机，然后用Vmware建了三台虚拟机。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">192.168.182.129<br>192.168.182.128<br>192.168.182.130<br></code></pre></td></tr></table></figure><p>这里的<code>192.168.182.129</code>被我用来做k8s的master，其余两台被我用来做k8s的node。</p><ul><li>设置主机名：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname &lt;hostname&gt;<br></code></pre></td></tr></table></figure><ul><li>设置<code>192.168.182.129</code>的主机名：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname centos01<br></code></pre></td></tr></table></figure><ul><li>设置<code>192.168.182.128</code>的主机名：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname centos02<br></code></pre></td></tr></table></figure><ul><li>设置<code>192.168.182.130</code>的主机名：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname centos03<br></code></pre></td></tr></table></figure><p>然后将三台机器重启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">reboot -f<br></code></pre></td></tr></table></figure><h2 id="5-在master节点上添加hosts"><a href="#5-在master节点上添加hosts" class="headerlink" title="5 在master节点上添加hosts"></a>5 在master节点上添加hosts</h2><ul><li>在每个节点添加hosts：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /etc/hosts &lt;&lt; EOF<br>192.168.182.129 centos01<br>192.168.182.128 centos02<br>192.168.182.130 centos03<br>EOF<br></code></pre></td></tr></table></figure><p>注意：这是我的服务器的ip地址，每个人不一样</p><h2 id="6-将桥接的IPv4流量传递到iptables的链"><a href="#6-将桥接的IPv4流量传递到iptables的链" class="headerlink" title="6 将桥接的IPv4流量传递到iptables的链"></a>6 将桥接的IPv4流量传递到iptables的链</h2><ul><li>在每个节点添加如下的命令：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF<br>net.bridge.bridge-nf-call-ip6tables = 1<br>net.bridge.bridge-nf-call-iptables = 1<br>net.ipv4.ip_forward = 1<br>vm.swappiness = 0<br>EOF<br><span class="hljs-meta prompt_"># </span><span class="language-bash">加载br_netfilter模块</span><br>modprobe br_netfilter<br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看是否加载</span><br>lsmod | grep br_netfilter<br><span class="hljs-meta prompt_"># </span><span class="language-bash">生效</span><br>sysctl --system  <br></code></pre></td></tr></table></figure><h2 id="7-时间同步"><a href="#7-时间同步" class="headerlink" title="7 时间同步"></a>7 时间同步</h2><ul><li>在每个节点添加时间同步：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install ntpdate -y<br>ntpdate time.windows.com<br></code></pre></td></tr></table></figure><p>注意：我这里并没有安装成功，一直没有找到ntpdate这个安装包，不知道为什么。。</p><h2 id="8-开启ipvs"><a href="#8-开启ipvs" class="headerlink" title="8 开启ipvs"></a>8 开启ipvs</h2><ul><li>在每个节点安装ipset和ipvsadm：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install ipset ipvsadm<br></code></pre></td></tr></table></figure><ul><li>在所有节点执行如下脚本：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>modprobe -- ip_vs<br>modprobe -- ip_vs_rr<br>modprobe -- ip_vs_wrr<br>modprobe -- ip_vs_sh<br>modprobe -- nf_conntrack_ipv4<br>EOF<br></code></pre></td></tr></table></figure><ul><li>授权、运行、检查是否加载：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4<br></code></pre></td></tr></table></figure><ul><li>检查是否加载：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">lsmod | grep -e ipvs -e nf_conntrack_ipv4<br></code></pre></td></tr></table></figure><h1 id="二、-开始安装"><a href="#二、-开始安装" class="headerlink" title="二、 开始安装"></a>二、 开始安装</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><ul><li>k8s默认CRI（容器运行时）为Docker，因此需要先安装Docker。</li></ul><h2 id="2-安装Docker"><a href="#2-安装Docker" class="headerlink" title="2 安装Docker"></a>2 安装Docker</h2><ul><li><h4 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y yum-utils device-mapper-persistent-data lvm2<br></code></pre></td></tr></table></figure></li><li><h4 id="设置stable镜像仓库"><a href="#设置stable镜像仓库" class="headerlink" title="设置stable镜像仓库"></a>设置stable镜像仓库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure></li><li><h4 id="更新yum软件包索引"><a href="#更新yum软件包索引" class="headerlink" title="更新yum软件包索引"></a>更新yum软件包索引</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum makecache<br></code></pre></td></tr></table></figure></li></ul><ul><li><p>安装最新版本docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install docker-ce<br></code></pre></td></tr></table></figure></li></ul><ul><li><p>设置Docker镜像加速器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;<br>&#123;<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://hub-mirror.c.163.com&quot;,<br>    &quot;https://mirror.baidubce.com&quot;<br>  ]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><p>注意：这里配置之后也可以有效解决限频问题，非常不错</p></li><li><p>启动docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start docker<br></code></pre></td></tr></table></figure></li></ul><h2 id="3-配置yum源"><a href="#3-配置yum源" class="headerlink" title="3 配置yum源"></a>3 配置yum源</h2><p>注意：这步很重要，否则无法找到kubelet等软件安装包。</p><p>3.1 首先创建install.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>cat &lt;&lt;EOF &gt; /etc/yum.repos.d/mirrors.aliyun.com_kubernetes.repo<br>[mirrors.aliyun.com_kubernetes]<br>name=added from: https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/<br>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/<br>enabled=1<br>gpgcheck=0<br>EOF<br></code></pre></td></tr></table></figure><p>3.2 执行install.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod a+x install.sh<br>./install.sh<br></code></pre></td></tr></table></figure><p>3.3 更新缓存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum clean all -y &amp;&amp; yum makecache -y &amp;&amp; yum repolist -y<br></code></pre></td></tr></table></figure><h2 id="4-安装kubeadm、kubelet和kubectl"><a href="#4-安装kubeadm、kubelet和kubectl" class="headerlink" title="4 安装kubeadm、kubelet和kubectl"></a>4 安装kubeadm、kubelet和kubectl</h2><p>配置好yum源之后可以直接下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y kubelet kubeadm kubectl<br>systemctl enable   kubelet.service<br>systemctl restart  kubelet.service<br></code></pre></td></tr></table></figure><h1 id="三、-开始部署"><a href="#三、-开始部署" class="headerlink" title="三、 开始部署"></a>三、 开始部署</h1><h2 id="1-部署Kubernetes-Master"><a href="#1-部署Kubernetes-Master" class="headerlink" title="1. 部署Kubernetes Master"></a>1. 部署Kubernetes Master</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubeadm init \<br>  --kubernetes-version v1.21.3 \<br>  --pod-network-cidr=10.244.0.0/16<br></code></pre></td></tr></table></figure><p>参数解释：</p><p><code> --kubernetes-version</code>是kubernetes版本</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210722011435718.png" alt="image-20210722011435718" style="zoom:50%;" /><p>初始化完成之后出现一下结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">Your Kubernetes control-plane has initialized successfully!<br><br>To start using your cluster, you need to run the following as a regular user:<br><br>  mkdir -p $HOME/.kube<br>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br>  sudo chown $(id -u):$(id -g) $HOME/.kube/config<br><br>Alternatively, if you are the root user, you can run:<br><br>  export KUBECONFIG=/etc/kubernetes/admin.conf<br><br>You should now deploy a pod network to the cluster.<br>Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:<br>  https://kubernetes.io/docs/concepts/cluster-administration/addons/<br><br>Then you can join any number of worker nodes by running the following on each as root:<br><br>kubeadm join 192.168.182.129:6443 --token 1fbv2q.z7pf5acfqcmdz11d \<br>        --discovery-token-ca-cert-hash sha256:275d02690cef8898369840cd184a9267f96d1340333f0044cf0032665293bfae<br></code></pre></td></tr></table></figure><h2 id="2-加入Kubernetes-Nodes"><a href="#2-加入Kubernetes-Nodes" class="headerlink" title="2. 加入Kubernetes Nodes"></a>2. 加入Kubernetes Nodes</h2><p>接着在另外两台服务器上执行master init之后的指令<br>&#x3D;&#x3D;node centos2&#x3D;&#x3D;</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@centos02 ~</span>]<span class="hljs-meta"># docker ps</span><br>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES<br>[<span class="hljs-meta">root@centos02 ~</span>]<span class="hljs-meta"># docker images</span><br>REPOSITORY   TAG       IMAGE ID   CREATED   SIZE<br>[<span class="hljs-meta">root@centos02 ~</span>]<span class="hljs-meta"># kubeadm join 192.168.182.129:6443 --token 1fbv2q.z7pf5acfqcmdz11d \</span><br>&gt;         --discovery-token-ca-cert-hash sha256:<span class="hljs-number">275</span>d02690cef8898369840cd184a9267f96d1340333f0044cf0032665293bfae<br>[<span class="hljs-meta">preflight</span>] Running pre-flight checks<br>        [<span class="hljs-meta">WARNING Service-Docker</span>]: docker service <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> enabled, please run <span class="hljs-string">&#x27;systemctl enable docker.service&#x27;</span><br>        [<span class="hljs-meta">WARNING IsDockerSystemdCheck</span>]: detected <span class="hljs-string">&quot;cgroupfs&quot;</span> <span class="hljs-keyword">as</span> the Docker cgroup driver. The recommended driver <span class="hljs-keyword">is</span> <span class="hljs-string">&quot;systemd&quot;</span>. Please follow the guide at https:<span class="hljs-comment">//kubernetes.io/docs/setup/cri/</span><br>[<span class="hljs-meta">preflight</span>] Reading configuration <span class="hljs-keyword">from</span> the cluster...<br>[<span class="hljs-meta">preflight</span>] FYI: You can look at <span class="hljs-keyword">this</span> config file <span class="hljs-keyword">with</span> <span class="hljs-string">&#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br>[<span class="hljs-meta">kubelet-start</span>] Writing kubelet configuration to file <span class="hljs-string">&quot;/var/lib/kubelet/config.yaml&quot;</span><br>[<span class="hljs-meta">kubelet-start</span>] Writing kubelet environment file <span class="hljs-keyword">with</span> flags to file <span class="hljs-string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br>[<span class="hljs-meta">kubelet-start</span>] Starting the kubelet<br>[<span class="hljs-meta">kubelet-start</span>] Waiting <span class="hljs-keyword">for</span> the kubelet to perform the TLS Bootstrap...<br><br>This node has joined the cluster:<br>* Certificate signing request was sent to apiserver <span class="hljs-keyword">and</span> a response was received.<br>* The Kubelet was informed of the <span class="hljs-keyword">new</span> secure connection details.<br><br>Run <span class="hljs-string">&#x27;kubectl get nodes&#x27;</span> <span class="hljs-keyword">on</span> the control-plane to see <span class="hljs-keyword">this</span> node <span class="hljs-keyword">join</span> the cluster.<br></code></pre></td></tr></table></figure><p>&#x3D;&#x3D;node centos3&#x3D;&#x3D;</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@centos03 ~</span>]<span class="hljs-meta"># kubeadm join 192.168.182.129:6443 --token 1fbv2q.z7pf5acfqcmdz11d \</span><br>&gt;         --discovery-token-ca-cert-hash sha256:<span class="hljs-number">275</span>d02690cef8898369840cd184a9267f96d1340333f0044cf0032665293bfae<br>[<span class="hljs-meta">preflight</span>] Running pre-flight checks<br>        [<span class="hljs-meta">WARNING Service-Docker</span>]: docker service <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> enabled, please run <span class="hljs-string">&#x27;systemctl enable docker.service&#x27;</span><br>        [<span class="hljs-meta">WARNING IsDockerSystemdCheck</span>]: detected <span class="hljs-string">&quot;cgroupfs&quot;</span> <span class="hljs-keyword">as</span> the Docker cgroup driver. The recommended driver <span class="hljs-keyword">is</span> <span class="hljs-string">&quot;systemd&quot;</span>. Please follow the guide at https:<span class="hljs-comment">//kubernetes.io/docs/setup/cri/</span><br>[<span class="hljs-meta">preflight</span>] Reading configuration <span class="hljs-keyword">from</span> the cluster...<br>[<span class="hljs-meta">preflight</span>] FYI: You can look at <span class="hljs-keyword">this</span> config file <span class="hljs-keyword">with</span> <span class="hljs-string">&#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br>[<span class="hljs-meta">kubelet-start</span>] Writing kubelet configuration to file <span class="hljs-string">&quot;/var/lib/kubelet/config.yaml&quot;</span><br>[<span class="hljs-meta">kubelet-start</span>] Writing kubelet environment file <span class="hljs-keyword">with</span> flags to file <span class="hljs-string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br>[<span class="hljs-meta">kubelet-start</span>] Starting the kubelet<br>[<span class="hljs-meta">kubelet-start</span>] Waiting <span class="hljs-keyword">for</span> the kubelet to perform the TLS Bootstrap...<br><br>This node has joined the cluster:<br>* Certificate signing request was sent to apiserver <span class="hljs-keyword">and</span> a response was received.<br>* The Kubelet was informed of the <span class="hljs-keyword">new</span> secure connection details.<br><br>Run <span class="hljs-string">&#x27;kubectl get nodes&#x27;</span> <span class="hljs-keyword">on</span> the control-plane to see <span class="hljs-keyword">this</span> node <span class="hljs-keyword">join</span> the cluster.<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>K8S</category>
      
      <category>尚硅谷</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/b9c10c4fb7dd.html"/>
    <url>/2022/12/b9c10c4fb7dd.html</url>
    
    <content type="html"><![CDATA[<h1 id="安装VisualBox"><a href="#安装VisualBox" class="headerlink" title="安装VisualBox"></a>安装VisualBox</h1><p>这里就不赘述了，非常简单。</p><h1 id="下载ubuntu"><a href="#下载ubuntu" class="headerlink" title="下载ubuntu"></a>下载ubuntu</h1><p>在<code>https://ubuntu.com/download/desktop/thank-you?version=22.04.1&amp;architecture=amd64</code>这里下载ubuntu</p><h1 id="新建ubuntu"><a href="#新建ubuntu" class="headerlink" title="新建ubuntu"></a>新建ubuntu</h1><p>点击新建</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025026333.png" alt="image-20221015025026333"></p><p>选择对应配置</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025124239.png" alt="image-20221015025124239"></p><p>设置用户名和密码</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025159222.png" alt="image-20221015025159222"></p><p>设置内存和CPU核心数量。</p><p>注意，这里最少需要4G内存和2核，我为了虚拟机性能可以更好一点，打算使用4G内存和4核CPU。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025310552.png" alt="image-20221015025310552"></p><p>设置硬盘大小</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025336939.png" alt="image-20221015025336939"></p><p>最后虚拟机建设完毕</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025450731.png" alt="image-20221015025450731"></p><h2 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h2><p>打开网络：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025632135.png" alt="image-20221015025632135"></p><p>关闭声音</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025651183.png" alt="image-20221015025651183"></p><h2 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h2><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025721243.png" alt="image-20221015025721243"></p><p>在这里需要先新建一个host-only-network</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025757129.png" alt="image-20221015025757129"></p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025822200.png" alt="image-20221015025822200"></p><p>然后将网卡1更新为Host-only Network</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025905419.png" alt="image-20221015025905419"></p><p>然后将网卡2更新为网络地址转换（NAT）</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015025940463.png" alt="image-20221015025940463"></p><p>最后就可以打开虚拟机了。</p><h2 id="安装虚拟机"><a href="#安装虚拟机" class="headerlink" title="安装虚拟机"></a>安装虚拟机</h2><p>就一股脑安装好了</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015031448056.png" alt="image-20221015031448056"></p><p>在这里需要注意设置固定IP。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_9ad1c3e8-2004-435c-b009-ce1918649545.png" alt="企业微信截图_9ad1c3e8-2004-435c-b009-ce1918649545"></p><p>这样这个IP就被我设置为了固定的192.168.56.2，到时候再设置个端口转发就可以外网访问了。</p><p>安装常用工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt install -y git vim curl jq<br>sudo apt install -y openssh-server<br></code></pre></td></tr></table></figure><p>安装完成之后可以执行<code>ip addr</code>来查看当前ip地址</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015043359838.png" alt="image-20221015043359838"></p><p>可以看到，这里的ip地址就是我们刚才设置的<code>192.168.56.100</code></p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20221015043535575.png" alt="image-20221015043535575"></p><p>可以看到，这里就可以远程连接到刚刚创建好的虚拟机了。</p><p>由于我们是有公网ip</p><p><code>36290o47n5.wicp.vip</code></p><p>因此打开一个端口映射：</p>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>K8S</category>
      
      <category>极客时间</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/f464243da5dc.html"/>
    <url>/2022/12/f464243da5dc.html</url>
    
    <content type="html"><![CDATA[<h1 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h1><h2 id="Redis是什么？"><a href="#Redis是什么？" class="headerlink" title="Redis是什么？"></a>Redis是什么？</h2><p>Redis（Remote Dictionary Server )，即远程字典服务。</p><p>是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p><p>与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p><h2 id="Redis能干什么？"><a href="#Redis能干什么？" class="headerlink" title="Redis能干什么？"></a>Redis能干什么？</h2><ol><li>内存存储、持久化，内存是断电即失的，所以需要持久化（RDB、AOF）</li><li>高效率、用于高速缓冲</li><li>发布订阅系统</li><li>地图信息分析</li><li>计时器、计数器(eg：浏览量)</li><li>。。。</li></ol><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ol><li>多样的数据类型</li><li>持久化</li><li>集群</li><li>事务</li><li>…</li></ol><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="基本环境配置"><a href="#基本环境配置" class="headerlink" title="基本环境配置"></a>基本环境配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">CentOS Linux release 7<br>redis 3.0.4<br></code></pre></td></tr></table></figure><ol><li><p>将redis下载并解压到对应文件夹</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210506212114.png"></p></li></ol><h2 id="安装必备环境并编译"><a href="#安装必备环境并编译" class="headerlink" title="安装必备环境并编译"></a>安装必备环境并编译</h2><ol><li><p>安装gcc基本环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install gcc-c++<br></code></pre></td></tr></table></figure></li><li><p>执行<code>make</code>命令</p><p>在redis主目录执行make命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210506212628.png" style="zoom:50%;" /></li><li><p>执行<code>make install</code>命令</p><p>只有执行<code>make install</code>之后<code>/usr/local/bin</code>目录下才会出现redis等命令</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210506213315.png"></p></li><li><p>redis默认安装路径<code>/usr/local/bin</code></p><p>在该目录下新建自己的配置文件夹（coachhe-redis-config），然后将配置文件拷贝到这个目录下</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210506213532.png"></p></li></ol><h2 id="配置并启动"><a href="#配置并启动" class="headerlink" title="配置并启动"></a>配置并启动</h2><ol><li><p>修改redis.conf文件</p><p>a. 注释掉<code>bind 127.0.0.1</code>这一行</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210507101139.png" style="zoom: 50%;" /><p>b. 将<code> protected-mode</code> 属性改为 no （关闭保护模式，不然会阻止远程访问）</p><p>c. 将 <code>daemonize</code> 属性改为 yes （这样启动时就在后台启动）</p><img src="/Users/coachhe/Library/Application Support/typora-user-images/image-20210507101354436.png" alt="image-20210507101354436" style="zoom:50%;" /><p>d. 设置密码（可选）</p></li><li><p>启动</p><p> 在<code>/usr/local/bin</code>目录下执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./redis-server /usr/local/bin/coachhe-redis-config/redis.conf<br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210507101631.png"></p></li></ol><h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">测试：100个并发连接 100000请求</span><br>redis-benchmark -h localhost -p 6379 -c 100 -n 100000<br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210507102257.png"></p><h1 id="Redis命令简介"><a href="#Redis命令简介" class="headerlink" title="Redis命令简介"></a>Redis命令简介</h1><h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h2><h3 id="SADD"><a href="#SADD" class="headerlink" title="SADD"></a>SADD</h3><p>将一个或多个 <code>member</code> 元素加入到集合 <code>key</code> 当中，已经存在于集合的 <code>member</code> 元素将被忽略。</p><p>假如 <code>key</code> 不存在，则创建一个只包含 <code>member</code> 元素作成员的集合。</p><p>当 <code>key</code> 不是集合类型时，返回一个错误。</p><p>（示例看<code>SMEMBERS</code>那里）</p><h3 id="SMEMBERS"><a href="#SMEMBERS" class="headerlink" title="SMEMBERS"></a>SMEMBERS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs redis">SMEMBERS key<br></code></pre></td></tr></table></figure><p>返回集合 <code>key</code> 中的所有成员。</p><p>不存在的 <code>key</code> 被视为空集合。</p><h3 id="SCARD"><a href="#SCARD" class="headerlink" title="SCARD"></a>SCARD</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SCARD key<br></code></pre></td></tr></table></figure><p>返回集合 <code>key</code> 的基数(集合中元素的数量)。</p><h3 id="SPOP"><a href="#SPOP" class="headerlink" title="SPOP"></a>SPOP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SPOP key<br></code></pre></td></tr></table></figure><p>移除并返回集合中的一个随机元素。</p><p>如果只想获取一个随机元素，但不想该元素从集合中被移除的话，可以使用<code> SRANDMEMBER</code>命令</p><h3 id="SRANDMEMBER"><a href="#SRANDMEMBER" class="headerlink" title="SRANDMEMBER"></a>SRANDMEMBER</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SRANDMEMBER key [count]<br></code></pre></td></tr></table></figure><p>如果命令执行时，只提供了 <code>key</code> 参数，那么返回集合中的一个随机元素。</p><p>从 Redis 2.6 版本开始，<code>SRANDMEMBER</code>命令接受可选的 <code>count</code> 参数：</p><ul><li>如果 <code>count</code> 为正数，且小于集合基数，那么命令返回一个包含 <code>count</code> 个元素的数组，数组中的元素<strong>各不相同</strong>。如果 <code>count</code> 大于等于集合基数，那么返回整个集合。</li><li>如果 <code>count</code> 为负数，那么命令返回一个数组，数组中的元素<strong>可能会重复出现多次</strong>，而数组的长度为 <code>count</code> 的绝对值。</li></ul><p>该操作和<code>SPOP</code>相似，但<code>SPOP</code>将随机元素从集合中移除并返回，而<code>SRANDMEMBER</code>则仅仅返回随机元素，而不对集合进行任何改动。</p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210507222950.png" style="zoom: 50%;" /><h2 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h2><h3 id="RPUSH"><a href="#RPUSH" class="headerlink" title="RPUSH"></a>RPUSH</h3><p>将一个或多个值value插入到列表key的表尾（最右边）</p><p>如果有多个value值，那么各个value值按<strong>从左到右</strong>的顺序依次插入到表尾：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">RPUSH mylist a b c<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 等价于</span></span><br>RPUSH mylist a<br>RPUSH mylist b<br>RPUSH mylist c<br></code></pre></td></tr></table></figure><p>时间复杂度：O(1)</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210511092634.png"></p><h3 id="LPUSH"><a href="#LPUSH" class="headerlink" title="LPUSH"></a>LPUSH</h3><p>将一个或多个值value插入到列表key的表头（最右边）</p><p>如果有多个value值，那么各个value值按<strong>从左到右</strong>的顺序依次插入到表头：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">RPUSH mylist a b c<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 等价于</span></span><br>RPUSH mylist a<br>RPUSH mylist b<br>RPUSH mylist c<br></code></pre></td></tr></table></figure><p>时间复杂度：O(1)</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210511093120.png" style="zoom:50%;" /><h2 id="Hash（哈希表）"><a href="#Hash（哈希表）" class="headerlink" title="Hash（哈希表）"></a>Hash（哈希表）</h2><p>同时将多个field-value（域-值）对设置到哈希表key中。</p><p>此命令会覆盖哈希表中已存在的域</p><p><strong>时间复杂度</strong>：O(N)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">HMSET key field value [field value ...]<br></code></pre></td></tr></table></figure><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210511095225.png" style="zoom: 50%;" />]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>NoSQL</category>
      
      <category>Redis</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/4e8c2c6b8302.html"/>
    <url>/2022/12/4e8c2c6b8302.html</url>
    
    <content type="html"><![CDATA[<h1 id="前言：APUE的实验环境的搭建"><a href="#前言：APUE的实验环境的搭建" class="headerlink" title="前言：APUE的实验环境的搭建"></a>前言：APUE的实验环境的搭建</h1><h2 id="APUE源代码下载"><a href="#APUE源代码下载" class="headerlink" title="APUE源代码下载"></a>APUE源代码下载</h2><p>  <a href="http://www.apuebook.com/code3e.html">http://www.apuebook.com/code3e.html</a><br>  得到源代码压缩包文件src.tar.gz</p><h2 id="保存在自己的工作目录并解压·"><a href="#保存在自己的工作目录并解压·" class="headerlink" title="保存在自己的工作目录并解压·"></a>保存在自己的工作目录并解压·</h2>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp src.3e.tar.gz ~ <br>//作用是将其放入工作环境中<br>tar -xzvf src.tar.gz<br>//作用是解压<br></code></pre></td></tr></table></figure><h2 id="进入apaue-2e查看README"><a href="#进入apaue-2e查看README" class="headerlink" title="进入apaue.2e查看README"></a>进入apaue.2e查看README</h2><p>  第二版中需要进行更改workspace的操作，但是第三版似乎不需要（至少我没有遇见），因此这步可以跳过</p><h2 id="将入lib库执行make"><a href="#将入lib库执行make" class="headerlink" title="将入lib库执行make"></a>将入lib库执行make</h2>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd lib<br>make<br></code></pre></td></tr></table></figure><p>   执行之后会得到静态库lib apue.a<br>  <img src="https://pic.downk.cc/item/5fc6364bf81f7e3bd97ee21d.png"><br>   将其复制到&#x2F;usr&#x2F;lib中<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo cp apue.a  /usr/lib<br></code></pre></td></tr></table></figure></p><h2 id="把头文件apue-x2F-h复制到-x2F-usr-x2F-include中"><a href="#把头文件apue-x2F-h复制到-x2F-usr-x2F-include中" class="headerlink" title="把头文件apue&#x2F;h复制到&#x2F;usr&#x2F;include中"></a>把头文件apue&#x2F;h复制到&#x2F;usr&#x2F;include中</h2><p>   我们所需要的头文件在apue.2e中的include文件中，需要将其复制到&#x2F;usr&#x2F;include中，这样gcc编译期间就能顺利找到头文件apue.h了。<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo cp include/apue.h /usr/include<br></code></pre></td></tr></table></figure></p><h2 id="到这里准备工作就做完了，尝试进行一次编译"><a href="#到这里准备工作就做完了，尝试进行一次编译" class="headerlink" title="到这里准备工作就做完了，尝试进行一次编译"></a>到这里准备工作就做完了，尝试进行一次编译</h2>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd filedir                 //进入随意一个文件库<br>gcc -o myls ls1.c -lapue   //进行编译<br></code></pre></td></tr></table></figure><p>   最后一句-lapue必须加上，含义是去掉err部分<br>   这里我们可以看到，正确输出了myls，并且编译正常<br><img src="https://pic.downk.cc/item/5fc63689f81f7e3bd97f1e08.png"></p><p>   <strong>注意</strong><br>      第二版的各章的源代码直接放在了apue.2e里，第三版各章的源代码放在figlinks文件夹下。</p><h1 id="2-UNIX基础知识"><a href="#2-UNIX基础知识" class="headerlink" title="2 UNIX基础知识"></a>2 UNIX基础知识</h1><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h2><p>本章从程序员的角度快速浏览UNIX，对舒总引用的一些术语和概念进行简要的说明并给出实例。在以后各章中，将对这些概念做更详细的说明。</p><h2 id="2-UNIX体系结构"><a href="#2-UNIX体系结构" class="headerlink" title="2 UNIX体系结构"></a>2 UNIX体系结构</h2><p><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3321797453,2172960764&fm=26&gp=0.jpg" alt="WX20200414-151549@2x.png"></p><p>如图所示，操作系统所对应的是内核（kernel）部分，内核的接口被称为系统调用。公用函数库构建在系统调用接口之上，对系统调用进行封装，应用程序既可使用公共函数库，也可使用系统调用。</p><p><strong>说人话</strong>：操作系统&#x3D;内核，需要用系统调用才能使用操作系统为我们工作，例如进行内存的分配，设备的IO等。shell和公共函数都能直接进行系统调用，应用程序可以直接进行系统调用，也可以使用shell和公共函数库里的函数，从而间接进行系统调用。</p><h2 id="3-登录"><a href="#3-登录" class="headerlink" title="3 登录"></a>3 登录</h2><h3 id="登录名"><a href="#登录名" class="headerlink" title="登录名"></a>登录名</h3><p>用户在登录UNIX系统键入用户名和密码时，系统在其口令文件中查看登录名：<br>口令文件通常在&#x2F;etc&#x2F;passwd中：</p><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><p>shell是一个命令行解释器，读取用户输入，然后执行命令。shell的用户输入通常来自终端（交互式shell），有时则来自于文件（成为shell脚本）。</p><h2 id="4-文件和目录"><a href="#4-文件和目录" class="headerlink" title="4 文件和目录"></a>4 文件和目录</h2><h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><p>   UNIX文件系统是目录和文件的一种层次结构，所有东西的起点是成为<strong>根</strong>（root）的目录，这个目录的名称是一个字符“&#x2F;”。</p><h4 id="根目录的文件"><a href="#根目录的文件" class="headerlink" title="根目录的文件"></a>根目录的文件</h4><p>  主要由以下几个文件组成<br>   &#x2F;bin：基本命令的二进制文件<br>   &#x2F;boot：自动自动的静态代码<br>   &#x2F;dev：device files：设备代码<br>   &#x2F;etc：host-specific system configuration:主机特定的系统配置<br>  &amp;emsp; &#x2F;etc&#x2F;opt：&#x2F;opt的配置文件<br>  &amp;emsp; &#x2F;etc&#x2F;X11：X Window System的配置文件<br>  &amp;emsp; &#x2F;etc&#x2F;sgml：SGML的配置文件<br>  &amp;emsp; &#x2F;etc&#x2F;xml：XML的配置文件<br>   &#x2F;home：家目录<br>   &#x2F;lib：<br>   &#x2F;media<br>   &#x2F;mnt<br>   &#x2F;root：管理文件<br>   &#x2F;tmp：暂存文件目录<br>   <strong>&#x2F;usr</strong>：用户目录  </p><h4 id="用户目录"><a href="#用户目录" class="headerlink" title="用户目录"></a>用户目录</h4><p>   &#x2F;usr&#x2F;bin：主要作用是放置自己安装的命令，例如python，perl<br>   &#x2F;usr&#x2F;include：包括标准头文件（也就是APUE.h放置的地方，gcc会自动找到这个头文件）<br>   &#x2F;usr&#x2F;lib：包括我们的库和安装包（也就是APUE.a放置的地方，是一个静态库）<br>   &#x2F;usr&#x2F;src：放一些源文件（user source）<br>   更加具体的，请参考FHS<br>   <a href="http://www.pathname.com/fhs/pub/fhs-2.3.pdf">FHS下载链接</a></p><h2 id="5-输入和输出"><a href="#5-输入和输出" class="headerlink" title="5 输入和输出"></a>5 输入和输出</h2><h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><p>   文件描述符（file descriptor）通常是一个非常小的非负整数，内核用以表示一个特定进程正在访问的文件。当内核打开一个现有文件或者创建一个新文件时，它都返回一个文件描述符，在读写文件时，可以使用这个文件描述符<br>   <strong>理解</strong><br>  &amp;emsp;&amp;emsp;0,1,2叫文件描述符；Linux中，每打开一个文件都有一个小的整数与之对应，就是文件描述符！<br>&amp;emsp;&amp;emsp;0 是标准输入的 （stdin）<br>&amp;emsp;&amp;emsp;1 是标准输出的 （stdout）<br>&amp;emsp;&amp;emsp;2 是标准报错输出的 （stderr）<br>&amp;emsp;&amp;emsp;’&lt;’是输入重定向符<br>&amp;emsp;&amp;emsp;’&gt;’是输出重定向符  </p><h3 id="标准输入、标准输出和标准错误"><a href="#标准输入、标准输出和标准错误" class="headerlink" title="标准输入、标准输出和标准错误"></a>标准输入、标准输出和标准错误</h3><p>   按照惯例，每当运行一个新程序的时候，所有的shell都会为其打开三个文件描述符，即<strong>标准输入</strong>、<strong>标准输出</strong>和<strong>标准错误</strong>，如果不做特殊处理，执行一个简单的命令ls，那么三个描述符都是指向终端的。大多数shell都提供一种方法，使任何一个或所有者三个描述符都能重新定向到某个文件。例如：<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls &gt; file.list<br></code></pre></td></tr></table></figure><br>   执行ls命令，其标准输出重新定向到名为file.list的文件</p><h3 id="不带缓冲的I-x2F-O（unbuffered-I-x2F-O）"><a href="#不带缓冲的I-x2F-O（unbuffered-I-x2F-O）" class="headerlink" title="不带缓冲的I&#x2F;O（unbuffered I&#x2F;O）"></a>不带缓冲的I&#x2F;O（unbuffered I&#x2F;O）</h3><p>不带缓冲的I&#x2F;O又称为非标准I&#x2F;O，含义是在函数中需要进行buffer size的确认。</p><h4 id="典型函数"><a href="#典型函数" class="headerlink" title="典型函数"></a>典型函数</h4><p>open<br>read<br>write<br>lseek<br>close<br>提供了不带缓存的I&#x2F;O,这些函数都使用文件描述符。</p><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p><img src="https://pic.downk.cc/item/5fc636f5f81f7e3bd97f4dec.png"><br>在这里可以看见，需要预先设定一个BUFFSIZE，这对程序的性能是有影响的。</p><h3 id="标准I-x2F-O"><a href="#标准I-x2F-O" class="headerlink" title="标准I&#x2F;O"></a>标准I&#x2F;O</h3><p>带缓存的I&#x2F;O也称为标准I&#x2F;O，含义是不需要自己去定义buffer size，库函数会帮助自己定义好。</p><h4 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h4><p>在这里可以看见，不需要预先设定BUFFSIZE了，库函数都会帮自己做好。因此对于程序员来说方便了许多。</p><h2 id="6-程序和进程"><a href="#6-程序和进程" class="headerlink" title="6 程序和进程"></a>6 程序和进程</h2><h3 id="1-程序"><a href="#1-程序" class="headerlink" title="1 程序"></a>1 程序</h3><p>程序是一个存储在磁盘上某个目录中的可执行文件。内核使用exec函数将程序读入内存，并执行程序。<br><strong>理解</strong><br>程序只是一段代码，并没有动起来，内核使用exec函数将这段程序（代码）读入内存并执行之后程序变成了进程，也就是说，进程是动起来的程序。</p><h3 id="2-进程和进程ID"><a href="#2-进程和进程ID" class="headerlink" title="2 进程和进程ID"></a>2 进程和进程ID</h3><p>程序的执行实例叫做进程，某些操作系统用任务表示正在被执行的程序。<br>UNIX系统确保每个进程都有一个唯一的数字标识符，称为进程ID，进程ID总是一个非负整数。</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p><img src="https://pic.downk.cc/item/5fc636c3f81f7e3bd97f43ab.png"><br>如图所示，将该程序会调用getpid得到其进程ID进行打印，可以看见，随着多次调用该程序，内核多次使用exec函数将程序读入内存并执行，进程ID也会随之增大。</p><h3 id="3-进程控制"><a href="#3-进程控制" class="headerlink" title="3 进程控制"></a>3 进程控制</h3><p>有三个用户进程控制的主要函数：fork、exec和waitpid。<br>fork用于创建一个新锦成。新进程是调用进程的一个副本，调动进程被称为父进程，新创建的进程被称为子进程。  </p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a><strong>注意</strong></h4><p>fork调用一次返回两个进程ID，对父进程返回子进程的进程ID，对子进程返回0。<br>exec函数是内核调用以生成新的进程的。<br>waitpid是父进程用来等待子进程结束所调用的，参数指定要等待的进程，当该进程停止时得到通知。  </p><h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><p><img src="https://pic.downk.cc/item/5fc636cef81f7e3bd97f4639.png"></p><h3 id="4-线程和线程ID"><a href="#4-线程和线程ID" class="headerlink" title="4 线程和线程ID"></a>4 线程和线程ID</h3><p>与进程先攻，线程也用ID表示。但是，线程ID只在它所属的进程里起作用。一个进程中的线程ID在另一个进程中没有意义。</p><h2 id="7-出错处理"><a href="#7-出错处理" class="headerlink" title="7 出错处理"></a>7 出错处理</h2><p>当UNIX系统函数出错时，通常会返回一个负值，整型变量errno通常被设置为具有特定信息的值。</p><h3 id="errno的使用规则"><a href="#errno的使用规则" class="headerlink" title="errno的使用规则"></a>errno的使用规则</h3><ol><li>如果没有出错，其值不会被例程清零。因此，仅当函数的返回值指明出错时，才检验其值。</li><li>任何函数都不会讲errno的值设置为0，而且在&lt;errno.h&gt;头文件中定义的所有常量都不为0。</li></ol><h3 id="errno的打印"><a href="#errno的打印" class="headerlink" title="errno的打印"></a>errno的打印</h3><p>C标准定义了两个函数来打印出错信息</p><ol><li>strerror函数将errno映射为一个出错消息字符串，并返回此字符串的指针</li><li>perror函数基于errno的当前值，在标准错误上产生一条错误信息然后返回</li></ol><h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><p><img src="https://pic.downk.cc/item/5fc63661f81f7e3bd97ee741.png"><br>如图所示，可以看到采用了两种方式进行打印errno。<br><strong>注意</strong>：我们将程序名作为参数传递给perror。这是标准的UNIX惯例。使用这种方法，在程序作为管道的一部分执行时，例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">prog1 &lt; inputfile | prog2 | prog3 &gt; outputfile<br></code></pre></td></tr></table></figure><p>我们就能分清3个程序中的哪一个产生了一条特定的出错信息。</p><h3 id="出错恢复"><a href="#出错恢复" class="headerlink" title="出错恢复"></a>出错恢复</h3><p>   可将&lt;errno.h&gt;中定义的各种出分为两类：致命性的和非致命性的。<br>   对于非致命出错，是可能恢复的，例如典型恢复操作是延迟一段时间后重试（例如网络不可用）</p><h2 id="8-用户标识"><a href="#8-用户标识" class="headerlink" title="8 用户标识"></a>8 用户标识</h2><h3 id="1-用户ID"><a href="#1-用户ID" class="headerlink" title="1 用户ID"></a>1 用户ID</h3><p>   口令文件登录项中的用户ID是一个数值，它向系统标识各个不同的用户。<br>   <strong>注意</strong>：用户标识为0的用户为根用户或者超级用户。也就是登录名为root的用户，这种用户的特权称为超级用户特权。</p><h3 id="2-组ID"><a href="#2-组ID" class="headerlink" title="2 组ID"></a>2 组ID</h3><p>   口令文件登录项也包括用户的组ID，它是一个数值。<br>   <strong>注意</strong>：多个用户ID可以是同一个组ID，组被用于将若干用户集合到项目或部门中去。<br>   族文件将组名映射为数值的组ID。组文件通常是&#x2F;etc&#x2F;group。</p><h3 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h3><p><img src="https://pic.downk.cc/item/5fc6371af81f7e3bd97f56b7.png"></p><h2 id="9-信号"><a href="#9-信号" class="headerlink" title="9 信号"></a>9 信号</h2><p>   信号用于通知进程发生了某种情况。例如进程执行除法时发现除数为0，则将名为SIGFPE（浮点异常）的信号发送给该进程。</p><h3 id="处理信号的方式"><a href="#处理信号的方式" class="headerlink" title="处理信号的方式"></a>处理信号的方式</h3><ol><li>忽略信号（不推荐）</li><li>系统默认方式处理（例如除以0的默认是终止进程）</li><li>捕捉信号进行处理：提供一个函数来进行处理。</li></ol><h2 id="10-时间值"><a href="#10-时间值" class="headerlink" title="10 时间值"></a>10 时间值</h2><p>历史上，UNIX系统使用过两种不同的时间值</p><ol><li><p>日历时间<br>用date函数，根据参数的不同可以表达不同的时间。例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">date //显示当前时间<br>date +%s //显示自协调世界时（UTC，1970年1月1日00:00:00)这个特定的时间以来所经历的秒数累计值。<br></code></pre></td></tr></table></figure></li><li><p>进程时间<br>也被称为CPU时间，用以度量进程使用的中央处理器资源。</p></li></ol><h2 id="11-系统调动和库函数"><a href="#11-系统调动和库函数" class="headerlink" title="11 系统调动和库函数"></a>11 系统调动和库函数</h2><p>《UNIX程序员手册》第三部分定义了程序员可以使用的通用库函数。虽然这些函数可能会调用一个或多个内核的系统调用，但是它们并不是内核的入口点。<br>例如printf函数函数会调用write系统调用以输出一个字符串，但strcpy（复制一个字符串）和atoi（将ASCII转换成正数）并不使用任何内核的系统调用。<strong>也就是说</strong>：库函数可能涉及系统调用，也可能不涉及系统调用，可能需要调用内核，也可能不需要调用内核。</p><h3 id="系统调用和库函数的区别"><a href="#系统调用和库函数的区别" class="headerlink" title="系统调用和库函数的区别"></a>系统调用和库函数的区别</h3><p>库函数可以替换，但是系统调用通常是不能替换的。<br>   <strong>例如</strong>我们可以有多种输出方式，但是核心系统调用write是不能替换的。<br>   <strong>再比如</strong>UNIX系统只提供一个时间的系统调用：也就是返回自协调世界时以来所经历的秒数累计值，但是可以通过后续的多种库函数处理得到我们所需要的结论</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/1f75f6323c59.html"/>
    <url>/2022/12/1f75f6323c59.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-进程间通信分类"><a href="#1-进程间通信分类" class="headerlink" title="1 进程间通信分类"></a>1 进程间通信分类</h1><ol><li>管道</li><li>XSI -&gt; SysV</li><li>网络套接字</li></ol><p>其中1和2是在同一台主机上的，3是在不同主机上的。</p><h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><p>内核提供，单工通信（一端作为读端，一端作为写端），自同步机制</p><h3 id="管道分类"><a href="#管道分类" class="headerlink" title="管道分类"></a>管道分类</h3><ol><li>匿名管道<br>匿名管道是由内核创建的，磁盘不可见（也就是使用ls命令时看不到），通过调用pipe函数创建一个匿名管道。</li><li>命名管道</li></ol><h3 id="管道的创建"><a href="#管道的创建" class="headerlink" title="管道的创建"></a>管道的创建</h3><p>通过调用pipe函数创建一个匿名管道</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pipe</span><span class="hljs-params">(<span class="hljs-type">int</span> fd[<span class="hljs-number">2</span>])</span>;<br></code></pre></td></tr></table></figure><p>返回值：<br>若成功返回0，若出错返回-1.<br>并且通过参数fd返回两个文件描述符：fd[0]为读而打开，fd[1]为写而打开。fd[1]的输出是fd[0]的输入。</p><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>也就是说，通过参数fd返回两个文件，一个文件专门读，一个文件专门写。<br>如图所示：<br><img src="https://pic.downk.cc/item/5fc63658f81f7e3bd97ee579.jpg"></p><p>单个进程的管道几乎没有任何用户，通常，进程会先调用pipe，然后调用fork，创建从父进程到子进程的IPC通道，反之亦然。<br>也就是说，父进程先调用pipe，创建两个可以互相沟通的文件，再调用fork，因为fork出来的子进程完全继承了父进程的一切特性，因此他也拥有者两个文件，因此父子进程可以通过这两个文件进行沟通。<br>如图所示：<br><img src="https://pic.downk.cc/item/5fc63633f81f7e3bd97eddb4.jpg"></p><h3 id="管道的方向"><a href="#管道的方向" class="headerlink" title="管道的方向"></a>管道的方向</h3><p>对于从父进程到子进程的管道，父进程关闭管道的读端（fd[0]），子进程关闭写端（fd[1]）。<br><img src="https://pic.downk.cc/item/5fc6361ff81f7e3bd97eda29.jpg"><br>这样就创建了一个单方向的从父进程到子进程的管道。</p><h3 id="管道实例（fig15-5）"><a href="#管道实例（fig15-5）" class="headerlink" title="管道实例（fig15.5）"></a>管道实例（fig15.5）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span>n;<br><span class="hljs-type">int</span>fd[<span class="hljs-number">2</span>];<br><span class="hljs-type">pid_t</span>pid;<br><span class="hljs-type">char</span>line[MAXLINE];<br><br><span class="hljs-keyword">if</span> (pipe(fd) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;pipe error&quot;</span>);<br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* parent */</span><br>close(fd[<span class="hljs-number">0</span>]);<br>write(fd[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;hello world\n&quot;</span>, <span class="hljs-number">12</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">/* child */</span><br>close(fd[<span class="hljs-number">1</span>]);<br>n = read(fd[<span class="hljs-number">0</span>], line, MAXLINE);<br>write(STDOUT_FILENO, line, n);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc6369df81f7e3bd97f3894.jpg"></p><p>解释：</p><p>可以看到，先创建了一个pipe，然后调用fork创建子进程，将父进程的fd[0]关闭，再将子进程的fd[1]关闭，变成了一个单向管道。</p><h3 id="管道的应用"><a href="#管道的应用" class="headerlink" title="管道的应用"></a>管道的应用</h3><p>我们有一个父进程，此时我们需要通过输入来进行一些操作，而这些操作不可能通过父进程来完成，那么可以先让父进程创建一个管道，然后fork一个子进程，让子进程调用exec，执行接收到的命令。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;apue.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>DEF_PAGER<span class="hljs-string">&quot;/bin/more&quot;</span><span class="hljs-comment">/* default pager program */</span></span><br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br><span class="hljs-type">int</span>n;<br><span class="hljs-type">int</span>fd[<span class="hljs-number">2</span>];<br><span class="hljs-type">pid_t</span>pid;<br><span class="hljs-type">char</span>*pager, *argv0;<br><span class="hljs-type">char</span>line[MAXLINE];<br>FILE*fp;<br><br><span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>)<br>err_quit(<span class="hljs-string">&quot;usage: a.out &lt;pathname&gt;&quot;</span>);<br><br><span class="hljs-keyword">if</span> ((fp = fopen(argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;r&quot;</span>)) == <span class="hljs-literal">NULL</span>)<br>err_sys(<span class="hljs-string">&quot;can&#x27;t open %s&quot;</span>, argv[<span class="hljs-number">1</span>]);<br><span class="hljs-keyword">if</span> (pipe(fd) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;pipe error&quot;</span>);<br><br><span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>err_sys(<span class="hljs-string">&quot;fork error&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* parent */</span><br>close(fd[<span class="hljs-number">0</span>]);<span class="hljs-comment">/* close read end */</span><br><br><span class="hljs-comment">/* parent copies argv[1] to pipe */</span><br><span class="hljs-keyword">while</span> (fgets(line, MAXLINE, fp) != <span class="hljs-literal">NULL</span>) &#123;<br>n = <span class="hljs-built_in">strlen</span>(line);<br><span class="hljs-keyword">if</span> (write(fd[<span class="hljs-number">1</span>], line, n) != n)<br>err_sys(<span class="hljs-string">&quot;write error to pipe&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (ferror(fp))<br>err_sys(<span class="hljs-string">&quot;fgets error&quot;</span>);<br><br>close(fd[<span class="hljs-number">1</span>]);<span class="hljs-comment">/* close write end of pipe for reader */</span><br><br><span class="hljs-keyword">if</span> (waitpid(pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;waitpid error&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">/* child */</span><br>close(fd[<span class="hljs-number">1</span>]);<span class="hljs-comment">/* close write end */</span><br><span class="hljs-keyword">if</span> (fd[<span class="hljs-number">0</span>] != STDIN_FILENO) &#123;<br><span class="hljs-keyword">if</span> (dup2(fd[<span class="hljs-number">0</span>], STDIN_FILENO) != STDIN_FILENO)<br>err_sys(<span class="hljs-string">&quot;dup2 error to stdin&quot;</span>);<br>close(fd[<span class="hljs-number">0</span>]);<span class="hljs-comment">/* don&#x27;t need this after dup2 */</span><br>&#125;<br><br><span class="hljs-comment">/* get arguments for execl() */</span><br><span class="hljs-keyword">if</span> ((pager = getenv(<span class="hljs-string">&quot;PAGER&quot;</span>)) == <span class="hljs-literal">NULL</span>)<br>pager = DEF_PAGER;<br><span class="hljs-keyword">if</span> ((argv0 = <span class="hljs-built_in">strrchr</span>(pager, <span class="hljs-string">&#x27;/&#x27;</span>)) != <span class="hljs-literal">NULL</span>)<br>argv0++;<span class="hljs-comment">/* step past rightmost slash */</span><br><span class="hljs-keyword">else</span><br>argv0 = pager;<span class="hljs-comment">/* no slash in pager */</span><br><br><span class="hljs-keyword">if</span> (execl(pager, argv0, (<span class="hljs-type">char</span> *)<span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>)<br>err_sys(<span class="hljs-string">&quot;execl error for %s&quot;</span>, pager);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2-命名管道"><a href="#2-命名管道" class="headerlink" title="2 命名管道"></a>2 命名管道</h1><p>命名管道叫FIFO，之前介绍的管道都是匿名管道，只能在两个相关的进程间使用（也就是说，fork的一个有血缘关系的进程之间使用）。</p><h2 id="命名管道的创建"><a href="#命名管道的创建" class="headerlink" title="命名管道的创建"></a>命名管道的创建</h2><p>我们用函数mkfifo来创建管道</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">mkfifo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">mode_t</span> mode)</span>;<br></code></pre></td></tr></table></figure><p>也可以直接使用命令mkfifo来创建一个命名管道，效果：<br><img src="https://pic.downk.cc/item/5fc6367cf81f7e3bd97f06eb.jpg"></p><h2 id="FIFO的使用"><a href="#FIFO的使用" class="headerlink" title="FIFO的使用"></a>FIFO的使用</h2><p>创建了名为my_fifo的管道之后，我们可以用两个shell（两个进程）对其进行读写。<br>例如我们将天气情况读入my_fifo中。<br><img src="https://pic.downk.cc/item/5fc63694f81f7e3bd97f2e75.jpg"><br>可以看到如图所示，将date的信息写入my_fifo之后不会结束，因为比如得有进程将其读出之后才能结束，因此我们再用另一个shell来读这个FIFO。<br><img src="https://pic.downk.cc/item/5fc63707f81f7e3bd97f5228.jpg"><br><img src="https://pic.downk.cc/item/5fc63658f81f7e3bd97ee57e.jpg"><br>可以看到，将信息读出之后之前读入的进程也结束了。</p><h1 id="3-XSI-IPC"><a href="#3-XSI-IPC" class="headerlink" title="3 XSI IPC"></a>3 XSI IPC</h1><h2 id="XSI定义"><a href="#XSI定义" class="headerlink" title="XSI定义"></a>XSI定义</h2><p>XSI就是System Interface and Headers:是一种UNIX系统协议<br>IPC就是Interprocess Communication：进程间通信</p><h2 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h2><p>有三种称为XSI IPC的IPC：<strong>消息队列</strong>、<strong>信息量</strong>和<strong>共享存储器</strong>。</p><h2 id="IPC的通用功能。"><a href="#IPC的通用功能。" class="headerlink" title="IPC的通用功能。"></a>IPC的通用功能。</h2><h3 id="1-标识符和键"><a href="#1-标识符和键" class="headerlink" title="1 标识符和键"></a>1 标识符和键</h3><p>每个内核中的IPC结构都用一个非负整数的标识符加以引用。<br>标识符是IPC对象的内部名。每个IPC对象都与一个键（key）相关联，将这个键作为该对象的外部名。</p><h4 id="创建键的方法"><a href="#创建键的方法" class="headerlink" title="创建键的方法"></a>创建键的方法</h4><p>使用ftok能使用路径名和项目ID产生一个键</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span><br><br><span class="hljs-type">key_t</span> <span class="hljs-title function_">ftok</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">int</span> id)</span>;<br></code></pre></td></tr></table></figure><p>参数：<br>path参数必须引用一个现有的文件。并且产生键时，只使用id参数的低8位。<br>因此对于不同文件的两个路径名，如果使用同一项目ID，那么可能产生相同的键。</p><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">key_t</span> key = ftok(<span class="hljs-string">&quot;/Users/heyizhi/程序员/Linux/Linux学习/UNIX环境高级编程/apue.3e/figlinks/ipc/pipe&quot;</span>, <span class="hljs-number">500</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, key);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在这里我们使用一个管道的路径和项目ID&#x3D;500来创建了一个key。<br>输出：<br>![IMAGE](resources&#x2F;9528BA501FB592F</p><h3 id="2-key和flag"><a href="#2-key和flag" class="headerlink" title="2 key和flag"></a>2 key和flag</h3><p>3中IPC的get函数功能相同，就是创建或者打开一个IPC。例如msgget的作用就是打开或者创建一个消息队列。他们都有两个类似的参数：一个key和一个整型flag。在创建新的IPC结构时，如果key是IPC_PRIVATE或者和当前某种类型的IPC结构无关，则需要指明flag的IPC_CREAT标志位。<br>若需要引用一个现有队列，key必须等于队列创建时指定的key的值，并且ICP_CREAT必须不被指明</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>绝不能指定IPC_PRIVATE作为键来引用一个现有的队列。</p><h1 id="4-消息队列"><a href="#4-消息队列" class="headerlink" title="4 消息队列"></a>4 消息队列</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>消息队列是消息的链接表，存储在内核中，由消息队列标识符标识。</p><h2 id="1-调用的第一个函数通常是msgget"><a href="#1-调用的第一个函数通常是msgget" class="headerlink" title="1 调用的第一个函数通常是msgget"></a>1 调用的第一个函数通常是msgget</h2><h3 id="1-1-作用"><a href="#1-1-作用" class="headerlink" title="1.1 作用"></a>1.1 作用</h3><p>其功能是打开一个现有队列或创建一个新队列</p><h3 id="1-2-函数"><a href="#1-2-函数" class="headerlink" title="1.2 函数"></a>1.2 函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">include &lt;sys/msg.h&gt;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">msgget</span><span class="hljs-params">(<span class="hljs-type">key_t</span> key, <span class="hljs-type">int</span> flag)</span>;<br></code></pre></td></tr></table></figure><p>key是通过之前提高的ftok()函数所生成的。flag在第三节已经讲过。在创建新队列时，需要初始化msqid_ds结构的下列成员。</p><h2 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h2><p>由三个文件组成，分别是发射端，接收端和头文件。</p><h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//在这里是我们的头文件，设定了传输协议，预定双方对话格式</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> PROTO_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PROTO_H_</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> KEYPATH <span class="hljs-string">&quot;/etc/services&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> KEYPROJ <span class="hljs-string">&#x27;g&#x27;</span>  <span class="hljs-comment">//表示当前字符一定可以转型给转型数</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAMESIZE 32</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_st</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">long</span> mtype;<br>    <span class="hljs-type">char</span> name[NAMESIZE];<br>    <span class="hljs-type">int</span> math;<br>    <span class="hljs-type">int</span> chinese;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h3 id="接收端"><a href="#接收端" class="headerlink" title="接收端"></a>接收端</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/msg.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;proto.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">key_t</span> key;<br>    <span class="hljs-type">int</span> msgid;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_st</span> <span class="hljs-title">rbuf</span>;</span><br><br>    key = ftok(KEYPATH, KEYPROJ);<br>    <span class="hljs-keyword">if</span>(key &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        perror(<span class="hljs-string">&quot;ftok()&quot;</span>);<br>    &#125;<br><br>    msgid = msgget(key, IPC_CREAT|<span class="hljs-number">0600</span>);<br>    <span class="hljs-keyword">if</span>(msgid &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        perror(<span class="hljs-string">&quot;msgget()&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(msgrcv(msgid, &amp;rbuf, <span class="hljs-keyword">sizeof</span>(rbuf) - <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">long</span>),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            perror(<span class="hljs-string">&quot;msgrcv()&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NAME = %s\n&quot;</span>, rbuf.name);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;MATH = %d\n&quot;</span>, rbuf.math);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;CHINESE = %d\n&quot;</span>,rbuf.chinese);<br>    &#125;<br><br>    msgctl(msgid, IPC_RMID, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="发射端"><a href="#发射端" class="headerlink" title="发射端"></a>发射端</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/msg.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;proto.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>    <span class="hljs-type">key_t</span> key;<br>    <span class="hljs-type">int</span> msgid;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_st</span> <span class="hljs-title">sbuf</span>;</span><br><br>    key = ftok(KEYPATH, KEYPROJ);<br>    <span class="hljs-keyword">if</span>(key &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        perror(<span class="hljs-string">&quot;ftok()&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    msgid = msgget(key, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span>(msgid &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        perror(<span class="hljs-string">&quot;msgid()&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    sbuf.mtype = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">strcpy</span>(sbuf.name, <span class="hljs-string">&quot;Alan&quot;</span>);<br>    sbuf.math = rand()%<span class="hljs-number">100</span>;<br>    sbuf.chinese = rand()%<span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">if</span>(msgsnd(msgid, &amp;sbuf, <span class="hljs-keyword">sizeof</span>(sbuf) - <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">long</span>), <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>)&#123;<br>        perror(<span class="hljs-string">&quot;msgsnd();&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK!&quot;</span>);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="5-信号量"><a href="#5-信号量" class="headerlink" title="5 信号量"></a>5 信号量</h1><p>信号量的英文是Semephore</p><p>同样的，主要是三种函数，分别是semget()、semop()和semctl()</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e4cf97e059ae.html"/>
    <url>/2022/12/e4cf97e059ae.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h1><p>本章开始讨论UNIX系统，先说明可用的文件I&#x2F;O函数-打开文件、读文件、写文件等。<br>UNIX系统中的大部分文件I&#x2F;O只需要用到5个函数：open、read、write、lseek以及close。然后说明不同缓冲长度对read和write函数的影响。</p><p><strong>不带缓冲的定义</strong>：术语不带缓冲指的是每个read和write都调用内核中的一个系统调用。<br>也就是说，不带缓冲的I&#x2F;O就是其中的I&#x2F;O操作都是直接对内核进行系统调用的。而带缓冲的I&#x2F;O就不会直接对内核调用。</p><h1 id="2-文件描述符"><a href="#2-文件描述符" class="headerlink" title="2 文件描述符"></a>2 文件描述符</h1><p>对于内核而言，所有打开的文件都通过文件描述符引用。</p><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>open()&#x2F;create()&#x2F;socket等函数<strong>生成</strong>文件描述符<br>&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;&amp;darr;<br>read()&#x2F;write()等函数<strong>使用</strong>文件描述符</p><h2 id="对应"><a href="#对应" class="headerlink" title="对应"></a>对应</h2><p>按照惯例，UNIX系统shell把文件描述符0余进程的标准输入相关联，文件描述符1与标准输出相关联，文件描述符2与标准错误相关联。  </p><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a><strong>解释</strong></h4><p>Linux shell在创建一个进程的时候，会自动生成三个文件，分别是标准输入、输出和标准错误，并且生成三个文件描述符与其相对应。之后我们操作输入输出其实是直接对这些文件操作，而不是直接I&#x2F;O。</p><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p><img src="https://pic4.zhimg.com/80/v2-3691c953c62dba149ea2cc16e190b7f7_1440w.jpg" alt="fig1.4"><br>这是fig1.4.c，作用是模拟将标准输入写到标准输出中。里面就用到了STDIN_FILENO，默认为0。</p><h2 id="3-函数open和openat"><a href="#3-函数open和openat" class="headerlink" title="3 函数open和openat"></a>3 函数open和openat</h2><p>调用open和openat可以打开或创建一个文件。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcnt1.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">int</span> olafg. ... <span class="hljs-comment">/* mode_t */</span></span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-type">int</span> openat(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">int</span> <span class="hljs-number">0f</span>lay, ... <span class="hljs-comment">/* mode_t mode */</span>;</span></span><br></code></pre></td></tr></table></figure><p>两函数的返回值：若成功则返回文件描述符，若出错则返回-1.</p><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><ol><li>path是要打开或创建的文件的名字</li><li>*path表示打开或创建的文件所在的地址</li><li>oflag参数用来说明此函数的多个选项，用下列一个或者多个常量进行“或”运算构成oflag参数（在&lt;fcntl.h&gt;头文件中定义）<br><strong>理解</strong>：也就是说，多个常量是可以同时指定的，例如O_RDONLY || O_CREATE就是一个oflg参数形式，表示这是只读打开的，并且如果没有这个文件就创建它。</li><li>fd参数：将open和openat区分开<br>(1) 若path是<strong>绝对路径名</strong>，这种情况open和openat含义相同，fd参数被忽略<br>(2) 若path是<strong>相对路径名</strong>，这种情况fd是相对路径在文件名系统中的开始地址。fd参数通过打开相对路径所在目录来获取。<br>(3) 若path是<strong>相对路径名</strong>，且fd具有特殊值AT_FDCWD。openat和open效果类似。</li></ol><h2 id="openat希望解决的问题"><a href="#openat希望解决的问题" class="headerlink" title="openat希望解决的问题"></a>openat希望解决的问题</h2><ol><li>让线程可以使用相对路径名打开目录中的文件，而不再只能打开当前工作目录。</li><li>避免TOCTTOU错误。</li></ol><h2 id="文件名和路径名截断"><a href="#文件名和路径名截断" class="headerlink" title="文件名和路径名截断"></a>文件名和路径名截断</h2><p>如果试图创建的文件名超过NAME_MAX，那么早期UNIX系统会进行截断，也就是指保留14个。</p><h3 id="带来的问题"><a href="#带来的问题" class="headerlink" title="带来的问题"></a>带来的问题</h3><p>这样无法判断是否该文件名被截断过</p><h1 id="4-函数create（不建议）"><a href="#4-函数create（不建议）" class="headerlink" title="4 函数create（不建议）"></a>4 函数create（不建议）</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functl.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">create</span> <span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">mode_t</span> mode)</span>;<br></code></pre></td></tr></table></figure><p>等价于</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C">open(path, OWRONLY | O_CREATE |O_TRUNC, mode)<br></code></pre></td></tr></table></figure><p>因此可以被open替代<br>##不足之处<br>   它以制度方式打开所创建的文件，需要创建一个文件，然后写，然后读，则必须的步骤：<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">create<br>close<br>open<br></code></pre></td></tr></table></figure><br>   很复杂，现在不建议使用。</p><h1 id="5-函数close（少用）"><a href="#5-函数close（少用）" class="headerlink" title="5 函数close（少用）"></a>5 函数close（少用）</h1><p>关闭一个进程时还会释放该进程加在文件上的所有锁。<br>进程终止时内核自动关闭它所有的打开文件，因此很多程序都利用了这一点，而不是显式地使用close关闭打开文件。  </p><h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a><strong>理解</strong></h4><p>我们可以让文件一直开着，知道我们这个进程终止了，自动所有文件都会全部关掉，而不用中途显式地使用close了。</p><h1 id="6-函数lseek"><a href="#6-函数lseek" class="headerlink" title="6 函数lseek"></a>6 函数lseek</h1><h2 id="当前文件偏移量-current-file-offset"><a href="#当前文件偏移量-current-file-offset" class="headerlink" title="当前文件偏移量(current file offset)"></a>当前文件偏移量(current file offset)</h2><p>通常是一个非负整数，用以度量从文件开始处计算的字节数。通常，读写操作都从当前文件偏移处开始。</p><h2 id="lseek函数作用"><a href="#lseek函数作用" class="headerlink" title="lseek函数作用"></a>lseek函数作用</h2><p>调用lseek可以显式地为一个打开文件设置偏移量    </p><h4 id="理解-1"><a href="#理解-1" class="headerlink" title="理解"></a><strong>理解</strong></h4><ol><li>前提是这个文件已经打开，也就是说lseek不能打开文件，只能作用于一个打开的文件</li><li>作用是为这个打开的文件设置一个偏移量，也就是确定该文件的偏移量具体位于哪个位置。</li></ol><h2 id="lseek函数形式"><a href="#lseek函数形式" class="headerlink" title="lseek函数形式"></a>lseek函数形式</h2><p>lseek函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">off_t</span> <span class="hljs-title function_">lseek</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset, <span class="hljs-type">int</span> whence)</span>;<br></code></pre></td></tr></table></figure><h3 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h3><p>fd：文件标识符<br>offset：偏移量，其解释是根据whence来决定的<br>whence：分三种情况：</p><ol><li>whence&#x3D;SEEK_SET，则该文件的偏移量为距文件开始出offset个字节</li><li>whence&#x3D;SEEK_CUR，则该文件偏移量设置为当前值加offset，offset<strong>可正可负</strong>。</li><li>whence&#x3D;SEEK_END，则该文件偏移量设置为文件长度加offset，offset<strong>可正可负</strong>。</li></ol><p>若lseek成功执行，则返回新的文件偏移量</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>例如</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">off_t</span> currpos;;<br>currpos = <span class="hljs-built_in">lseek</span>(fd, <span class="hljs-number">0</span>, SEEK_CUR);<br></code></pre></td></tr></table></figure><p>第一行先初始化一个currpos，接着第二行执行lseek(fd,0,SEEK_CUR);SEEK_CUR代表将文件偏移量设置为当前值加上offset。因此这两行代码其实就是得到了当前文件的偏移量。并且还可以用来测试当前的文件是否可以设置偏移量。</p><p>例3.1</p><p><strong>注意</strong><br>当前文件偏移量有正有负，因此需要比较lseek的返回值时应当谨慎，不要测试它是否小于0，而是测试是否等于-1。</p><h2 id="空洞"><a href="#空洞" class="headerlink" title="空洞"></a>空洞</h2><p>文件偏移量可以大于文件的当前长度，在这种情况下，对该文件的下一次写将加长该文件，并在文件中构成一个空洞。位于文件中但没有写过的字节都被读为0。<br><strong>理解</strong><br>例如一个文件长度为5，但是文件偏移量为10，那么在进行写操作的时候会直接在10这个位置进行写入，那么5到9这个位置就是空洞，它其实不存在，但是读出来都为默认为0。并且这段区域是不需要分配磁盘块的。也就是0-4有一个磁盘块，10开始有磁盘块，但是5-9没有分配磁盘块。</p><h3 id="例3-2"><a href="#例3-2" class="headerlink" title="例3.2"></a>例3.2</h3><p><img src="https://pic.downk.cc/item/5fc636fdf81f7e3bd97f4fc3.png"><br>运行之后可以得到结果：<br><img src="https://pic.downk.cc/item/5fc6369df81f7e3bd97f387d.png"><br>函数解释：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l    //以长格式显示目录下的内容列表<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc636f5f81f7e3bd97f4de2.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l -&quot;filename&quot;   //以长格式显示目录下某个文件的内容列表<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc63669f81f7e3bd97eec47.png"><br>格式说明</p><ol><li>首字母代表的是文件类型，其中”-“为普通文件、”d”为目录文件、”c”为字符设备文件、”b”为块设备文件、”p”为管道文件、”l”为链接文件、”s”为socket文件。<br>“rwx”分别代表拥有读、写和执行权限，“-”代表无对应权限。三个“rwx”依次代表文件所有者、文件所有者所在用户组、其它用户对文件拥有的权限。<br>例如我们这里的首字段是-rw-r--r--@，第一个字符是”-“，代表普通文件，接下来是rw-，代表文件所有者对其拥有读写权，但没有执行权。接下来是r–，代表用户所有者所在用户组对其只有读的权利。最后一个是r–，代表其他用户对文件只有读的权利。</li><li>第二字段：文件硬连接数量<br>这里的数量为1，表示只有一个硬连接</li><li>第三字段：文件拥有者<br>文件拥有者是heyizhi</li><li>第四字段：文件拥有者所在组<br>文件拥有者所在组是staff</li><li>第五字段：文件大小（以字节为单位）<br>文件大小，4035</li><li>第六字段：文件最后更改时间<br>文件最后更改时间是4月14日凌晨00:52分</li><li>第七字段：文件名（若为链接文件则追加显示其链接的原文件的路径）<br>文件名是vimrc</li></ol><p><strong>od作用</strong>：按指定格式输出其内容<br>主要分为以下几种：</p><table><thead><tr><th>缩写</th><th>格式规范</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>-t a</td><td>输出命名字符</td></tr><tr><td>-b</td><td>-t o1</td><td>输出八进制字节</td></tr><tr><td>-c</td><td>-t c</td><td>输出可打印的单字节字符，C反斜杠转义或3位八进制序列</td></tr><tr><td>-d</td><td>-t u2</td><td>输出无符号十进制数（双字节）</td></tr><tr><td>-f</td><td>-t fF</td><td>输出浮点型。</td></tr><tr><td>-i</td><td>-t dI（大写I）</td><td>输出十进制整数。</td></tr><tr><td>-l</td><td>-t dL</td><td>输出十进制长整型。</td></tr><tr><td>-o</td><td>-t o2</td><td>输出八进制字节（双字节）。</td></tr><tr><td>-s</td><td>-t d2</td><td>输出十进制数（双字节）。</td></tr><tr><td>-x</td><td>-t x2</td><td>输出十六进制数（双字节）。</td></tr><tr><td>也就是按照参数的不同以不同的格式输出。若没有参数则直接输出内容：</td><td></td><td></td></tr><tr><td>例如：</td><td></td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">od file.hole<br></code></pre></td></tr></table></figure><p>输出<br><img src="https://pic.downk.cc/item/5fc63616f81f7e3bd97ed88f.png"><br>若设置参数则会在每行相应给出地址来输出，同时满足固定的格式：<br>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">od -c file.hole //意思是输出可打印的单字节字符，以8进制形式<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc636d9f81f7e3bd97f492d.png"></p><h1 id="7-函数read"><a href="#7-函数read" class="headerlink" title="7 函数read"></a>7 函数read</h1><p>函数形式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> nbytes)</span>;<br></code></pre></td></tr></table></figure><p>如果read成功，返回读到的字节数；如已经到达文件尾端，则返回0.</p><h2 id="读取到的字节数少于要求读的字节数"><a href="#读取到的字节数少于要求读的字节数" class="headerlink" title="读取到的字节数少于要求读的字节数"></a>读取到的字节数少于要求读的字节数</h2><ol><li>读普通文件时，在读到要求字节数之前已经到达了文件尾端。</li><li>当从终端设备读时，通常一次最多读一行</li><li>当从网络读时，缓冲机制可能导致</li><li>从管道或者FIFO读时，如若管道包含的字节少于所需的数量，那么read将只返回实际可用的字节数。</li><li>信号中断而已经读了部分数据量时</li></ol><h1 id="8-函数write"><a href="#8-函数write" class="headerlink" title="8 函数write"></a>8 函数write</h1><p>函数形式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">write</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> nbytes)</span>;<br></code></pre></td></tr></table></figure><p>若成功则返回读到的字节数，若出错，返回-1<br><strong>注意：</strong><br>其返回值通常与参数nbytes的值相同，否则表示出错。</p><h1 id="9-I-x2F-O效率"><a href="#9-I-x2F-O效率" class="headerlink" title="9 I&#x2F;O效率"></a>9 I&#x2F;O效率</h1><h2 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h2><p>只使用read和write函数复制一个文件。<br><img src="https://pic.downk.cc/item/5fc63673f81f7e3bd97efa59.jpg"><br>可以看到。文件的作用是复制所写的内容将其再输出一遍。</p><h1 id="10-文件共享"><a href="#10-文件共享" class="headerlink" title="10 文件共享"></a>10 文件共享</h1><p>UNIX在不同进程间<strong>共享</strong>打开文件。<br>UNIX内核使用3种数据结构表示打开文件，它们之间的关系决定了在文件共享方面一个进程对另一个进程可能产生的影响。</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/6be4ce26f66b.html"/>
    <url>/2022/12/6be4ce26f66b.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-文件系统"><a href="#1-文件系统" class="headerlink" title="1 文件系统"></a>1 文件系统</h1><p>需要了解文件系统，我们需要先对磁盘的物理结构有一定的了解</p><h2 id="磁盘的物理结构"><a href="#磁盘的物理结构" class="headerlink" title="磁盘的物理结构"></a>磁盘的物理结构</h2><p><img src="https://pic.downk.cc/item/5fc636a7f81f7e3bd97f3e32.jpg"><br>可以看到，磁盘由很多盘面组成，而盘上则是由很多同心圆组成的磁道，每个磁道又被切割为许多扇区。所有磁盘面的同一个磁道构成一个柱面，同一柱面的所有磁道学完后，才会移入下一柱面。<br>磁盘的最小组成单位可以看成扇区，每个扇区的大小逻辑看起来是512字节，但是实际上底层的物理扇区是4096字节.</p><h2 id="文件系统的结构"><a href="#文件系统的结构" class="headerlink" title="文件系统的结构"></a>文件系统的结构</h2><p>在UNIX系统中，要将具体的文件与磁盘相对应，就会将磁盘划分为很多个分区，每个分区对应一个文件系统，磁盘、分区和文件系统的结构如下：<br><img src="https://pic.downk.cc/item/5fc636f5f81f7e3bd97f4de7.jpg"></p><ol><li>自举块：也称为引导块，分区中文件系统自身引导程序存放的地方。在每个分区的第一个扇区，用来安装引导记录</li><li>超级块：超级块在每个文件系统的根上，超级块描述和维护文件系统的状态。用来记录文件系统整体信息，例如inode总量和blocks总量等。</li></ol><h3 id="对文件分区的理解："><a href="#对文件分区的理解：" class="headerlink" title="对文件分区的理解："></a><strong>对文件分区的理解：</strong></h3><p>文件系统指文件存在的物理空间。</p><h4 id="对于Linux系统："><a href="#对于Linux系统：" class="headerlink" title="对于Linux系统："></a><strong>对于Linux系统：</strong></h4><p>linux系统中每个分区都是一个文件系统，都有自己的目录层次结构。Linux文件系统中的文件是数据的集合，文件系统不仅包含着文件中的数据而且还有文件系统的结构，所有Linux 用户和程序看到的文件、目录、软连接及文件保护信息等都存储在其中。这种机制有利于用户和操作系统的交互。<br>每个实际文件系统从操作系统和系统服务中分离出来，它们之间通过一个接口层：虚拟文件系统或VFS来通讯。VFS使得Linux可以支持多个不同的文件系统，每个表示一个VFS 的通用接口。由于软件将Linux 文件系统的所有细节进行了转换,所以Linux核心的其它部分及系统中运行的程序将看到统一的文件系统。Linux 的虚拟文件系统允许用户同时能透明地安装许多不同的文件系统。<br>在Linux文件系统中，<strong>EXT2文件系统</strong>、<strong>虚拟文件系统</strong>、**&#x2F;proc**文件系统是三个具有代表性的文件系统。</p><h4 id="对于macOS："><a href="#对于macOS：" class="headerlink" title="对于macOS："></a><strong>对于macOS：</strong></h4><p>Mac 不需要分区。近年的Mac都是SSD（闪存）了，并且使用专为闪存设计的新文件管理系统APFS（Apple File System），响应速度和安全性都有所增强，分区反而会增加SSD写入次数损耗。 </p><p>在这里，只关注柱面组里的i节点和数据块部分结构，其中数据块存放着文件的具体内容，如下图：<br><img src="https://pic.downk.cc/item/5fc63722f81f7e3bd97f5883.jpg"><br>每个i节点都有一个链接计数标记，表示指向该i节点的文件&#x2F;目录的数量，只有当链接计数标记减少到0时，才会释放该文件所占用的数据块，可以从图中看到有两个目录项指向同一个i节点。<br>i节点包含了文件的所有信息，包含文件的权限位信息，文件类型文件长度等（文件名保存在目录项中）。<br>在不更换文件系统的情况下为一个文件重命名，该文件的实际位置并没有更改，只需在目录块中构造一个新的目录项指向原先的i节点，并将原来的目录项删除即可。</p><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p>若现在创建一个名为testdir的文件，那么会自动包含.（当前位置）和..（上一级位置）和testdir目录，那么这三个目录以及testdir目录在柱面组里目录块和数据块的结构如下：<br><img src="https://pic.downk.cc/item/5fc6364cf81f7e3bd97ee226.jpg"></p><p>对于标号为1267的i节点，其类型字段表示它是一个目录，链接计数大于等于3，原因：至少有三个目录指向她：</p><ol><li>命名它的目录项</li><li>在该目录中的.项</li><li>在其子目录testdir中的..项。<br><strong>注意</strong><br>父目录中的每一个子目录都使该父目录的链接计数增加1，因为会有一个..项指向它。</li></ol><p>i节点一般存放的是一些状态信息，所以影响到i节点的操作有很多，比如更改文件的访问权限，更改用户ID，更改链接数等，一些涉及到文件实际内容相关的操作都不会影响到节点。</p><h1 id="2-文件相关属性的解读"><a href="#2-文件相关属性的解读" class="headerlink" title="2 文件相关属性的解读"></a>2 文件相关属性的解读</h1><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h2><p>第3章主要讲了执行I&#x2F;O操作的函数，讨论是围绕普通文件I&#x2F;O进行的-打开文件、读文件和写文件。<br>本章将描述文件系统的其他特征和文件的性质。<br>文件相关的信息都保存在stat结构中，大部分信息都来自inode节点。本章讲述的大部分函数都是针对其中的属性进行修改。</p><h2 id="2-函数stat、fstat、fstatat和lstat"><a href="#2-函数stat、fstat、fstatat和lstat" class="headerlink" title="2 函数stat、fstat、fstatat和lstat"></a>2 函数stat、fstat、fstatat和lstat</h2><p>给定函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#incllude <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">stat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> pathname, <span class="hljs-keyword">struct</span> stat *<span class="hljs-keyword">restrict</span> buf)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">fstat</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-keyword">struct</span> stat *buf)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">lstat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> pathname, <span class="hljs-keyword">struct</span> stat *<span class="hljs-keyword">restrict</span> buf)</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">fstatat</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> pathname, <span class="hljs-keyword">struct</span> stat *<span class="hljs-keyword">restrict</span> buf, <span class="hljs-type">int</span> flag)</span>;<br><br><span class="hljs-comment">//所有四个函数的返回值：若成功范围0，若出错返回-1；</span><br></code></pre></td></tr></table></figure><p>stat是一个结构体，定义大致如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> &#123;</span><br>  <span class="hljs-type">mode_t</span>         st_mode;     <span class="hljs-comment">//文件类型和模式（访问权限）</span><br>  <span class="hljs-type">ino_t</span>          st_ino;<br>  <span class="hljs-type">dev_t</span>          st_dev;<br>  <span class="hljs-type">dev_t</span>          st_rdev;<br>  <span class="hljs-type">nlink_t</span>        st_nlink;<br>  <span class="hljs-type">uid_t</span>          st_uid;<br>  <span class="hljs-type">gid_t</span>          st_gid;<br>  <span class="hljs-type">off_t</span>          st_size;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timespec</span> <span class="hljs-title">st_atime</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timespec</span> <span class="hljs-title">st_mtime</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timespec</span> <span class="hljs-title">st_ctime</span>;</span><br>  <span class="hljs-type">blisize_t</span>      st_blksize;<br>  <span class="hljs-type">blkcnt_t</span>       st_blocks;<br>&#125;;<br></code></pre></td></tr></table></figure><p>在这里附上MAC OS的stat代码：</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a><strong>注意</strong></h4><p>linux的stat.h头文件的目录在&#x2F;usr&#x2F;include&#x2F;stat.h<br>macos的stat.h头文件的目录在&#x2F;Library&#x2F;Developer&#x2F;CommanLineTools&#x2F;SDKs&#x2F;MacOSX10.14.sdk&#x2F;usr&#x2F;include&#x2F;sys<br><img src="https://pic.downk.cc/item/5fc63661f81f7e3bd97ee74a.jpg"><br>可以看到，除了中间部分不同，其余都是一样的。</p><h3 id="lstat和stat的区别"><a href="#lstat和stat的区别" class="headerlink" title="lstat和stat的区别"></a>lstat和stat的区别</h3><p>对于除了软链接情况下的所有情况lstat和stat都是相同的，但是对于软链接情况，lstat表示的是<strong>当前文件</strong>的文件类型，stat表示的是<strong>指向的文件</strong>的文件类型。<br><img src="https://pic.downk.cc/item/5fc63707f81f7e3bd97f5223.jpg"><br>可以看到，原来的lstat版本表明stdout文件时一个软链接，改动后的stat版本表示stat是一个特殊字符类型。</p><p>接下来探讨结构体stat中的具体内容：</p><h2 id="3-文件类型"><a href="#3-文件类型" class="headerlink" title="3 文件类型"></a>3 文件类型</h2><p>对应上面stat结构体中的st_mode。<br>文件类型包括以下几种：</p><ol><li>普通文件</li><li>目录文件</li><li>块特殊文件</li><li>字符特殊文件</li><li>FIFO</li><li>套接字</li><li>符号链接<br>文件类型信息包含在stat结构的st_mode成员中。可以用以下的宏确定文件类型。<br><img src="https://pic.downk.cc/item/5fc6364cf81f7e3bd97ee22a.jpg"></li></ol><p><img src="https://pic.downk.cc/item/5fc636b8f81f7e3bd97f4149.jpg"><br>可以看到，不同的文件输出了不同的结果。</p><h2 id="4-设置用户ID和设置组ID"><a href="#4-设置用户ID和设置组ID" class="headerlink" title="4 设置用户ID和设置组ID"></a>4 设置用户ID和设置组ID</h2><p>与一个进程相关的I有6个或者更多，如图：<br><img src="https://pic.downk.cc/item/5fc63689f81f7e3bd97f1ddc.jpg"></p><h2 id="5-文件访问权限"><a href="#5-文件访问权限" class="headerlink" title="5 文件访问权限"></a>5 文件访问权限</h2><p>st_mode值也包含了对文件的访问权限位。<br>也就是说，st_mode同时定义了文件类型和文件的访问权限。<br>每个文件有9个访问权限位，可将它们分为3类：<br><img src="https://pic.downk.cc/item/5fc636a7f81f7e3bd97f3e2c.jpg"></p><h2 id="7-函数access和faccessat"><a href="#7-函数access和faccessat" class="headerlink" title="7 函数access和faccessat"></a>7 函数access和faccessat</h2><p><img src="https://pic.downk.cc/item/5fc6363cf81f7e3bd97edf05.jpg"></p><h2 id="9-函数chmod、fchmod和fchmodat"><a href="#9-函数chmod、fchmod和fchmodat" class="headerlink" title="9 函数chmod、fchmod和fchmodat"></a>9 函数chmod、fchmod和fchmodat</h2><p><img src="https://pic.downk.cc/item/5fc6371af81f7e3bd97f56a6.jpg"></p><h2 id="18-创建和读取符号链接"><a href="#18-创建和读取符号链接" class="headerlink" title="18 创建和读取符号链接"></a>18 创建和读取符号链接</h2><p><img src="https://pic.downk.cc/item/5fc636d9f81f7e3bd97f4925.jpg"></p><h2 id="22-读目录"><a href="#22-读目录" class="headerlink" title="22 读目录"></a>22 读目录</h2><p><img src="https://pic.downk.cc/item/5fc636b8f81f7e3bd97f4153.jpg"></p><p><img src="https://pic.downk.cc/item/5fc6369df81f7e3bd97f3883.jpg">、</p><p><img src="https://pic.downk.cc/item/5fc6363cf81f7e3bd97edf02.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/829bfb70dd2a.html"/>
    <url>/2022/12/829bfb70dd2a.html</url>
    
    <content type="html"><![CDATA[<h1 id="标准I-x2F-O介绍"><a href="#标准I-x2F-O介绍" class="headerlink" title="标准I&#x2F;O介绍"></a>标准I&#x2F;O介绍</h1><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h2><p>本章讲述标准I&#x2F;O库。不仅是UNIX，很多其他操作系统都实现了标准I&#x2F;O库，所以这个库由ISO C标准说明。<br>标准I&#x2F;O库处理很多细节，如缓冲区分配，以优化的块长度执行I&#x2F;O等。这些处理使用户不必担心如何选择使用正确的块长度。</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>FILE类型贯穿始终，FILE是一个结构体，随着学习深入会逐渐了解。</p><h3 id="FILE的产生"><a href="#FILE的产生" class="headerlink" title="FILE的产生"></a>FILE的产生</h3><p>FILE类型通过fopen来产生。</p><h2 id="2-流和FILE对象"><a href="#2-流和FILE对象" class="headerlink" title="2 流和FILE对象"></a>2 流和FILE对象</h2><h3 id="系统调用I-x2F-O和标准I-x2F-O的区别"><a href="#系统调用I-x2F-O和标准I-x2F-O的区别" class="headerlink" title="系统调用I&#x2F;O和标准I&#x2F;O的区别"></a>系统调用I&#x2F;O和标准I&#x2F;O的区别</h3><h4 id="系统调用I-x2F-O："><a href="#系统调用I-x2F-O：" class="headerlink" title="系统调用I&#x2F;O："></a>系统调用I&#x2F;O：</h4><p>对于系统调用I&#x2F;O函数，都是围绕<strong>文件描述符</strong>展开的。当打开一个文件时，返回一个文件描述符，然后该文件描述符就用于后续的I&#x2F;O操作。</p><h4 id="标准I-x2F-O："><a href="#标准I-x2F-O：" class="headerlink" title="标准I&#x2F;O："></a>标准I&#x2F;O：</h4><p>而对于标准I&#x2F;O库，它们的操作是围绕<strong>流</strong>进行的，当标准I&#x2F;O库打开或创建一个文件时，我们已使一个流与一个文件相关联。</p><h3 id="文件和流的区别和联系"><a href="#文件和流的区别和联系" class="headerlink" title="文件和流的区别和联系"></a>文件和流的区别和联系</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>文件是计算机管理数据的基本单位，同时也是应用程序保存和读取数据的一个重要场所。<br>流是字节序列的抽象概念，例如文件、输入&#x2F;输出设备、内部进程通信管道等。流提供一种向后备存储器写入字节和从后备存储器读取字节的方式。</p><h4 id="存储介质"><a href="#存储介质" class="headerlink" title="存储介质"></a>存储介质</h4><p>文件是指在各种存储介质上（如硬盘、可移动磁盘、CD等）永久存储的数据的有序集合，它是进行数据读写操作的基本对象。<br>除了和磁盘文件直接相关的文件流以外，流还有多种类型。流可以分布在网络中、内存中或者是磁带中。</p><h3 id="流的定向"><a href="#流的定向" class="headerlink" title="流的定向"></a>流的定向</h3><p>我们已经知道，流是字节序列的抽象概念。<br>对于<strong>ASCII字符集</strong>，一个字符用<strong>一个</strong>字节表示：称为单字节字符集<br>对于<strong>国际字符集</strong>，一个字符用<strong>多个</strong>字节表示：称为多字节（宽）字符集</p><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><p><strong>流的定向</strong>决定了所读、写的字符是单字节还是多字节。<br>解释：<br>也就是说流的定向决定了所读写的字符是ASCII字符集还是国际字符集</p><h4 id="fwide函数"><a href="#fwide函数" class="headerlink" title="fwide函数"></a>fwide函数</h4><p>fwide函数可用于设置流的定向</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;wchar.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">fwide</span><span class="hljs-params">(FILE *fp, <span class="hljs-type">int</span> mode)</span>;<br></code></pre></td></tr></table></figure><p>参数：<br>参数mode的不同值fwide执行不同的工作：</p><ol><li>若mode为负，则fwide将试图使指定的流是字节定向的（ASCII字符集）</li><li>若mode为正，则fwide将试图使指定的流是宽定向的（国际字符集）</li><li>若mode为0，则fwide将不试图设置流的定向，但返回标识该流定向的值。</li></ol><h3 id="标准输入、标准输出和标准错误"><a href="#标准输入、标准输出和标准错误" class="headerlink" title="标准输入、标准输出和标准错误"></a>标准输入、标准输出和标准错误</h3><p>标准输入、标准输出和标准错误是进程预定义的3个流，并且这3个流可以自动被进程使用，<br>这3个标准I&#x2F;O流通过预定义文件指针stdin、stdout和stderr加以引用。这3个文件指针定义在头文件&lt;stdio.h&gt;</p><h3 id="缓冲"><a href="#缓冲" class="headerlink" title="缓冲"></a>缓冲</h3><h4 id="缓冲目的"><a href="#缓冲目的" class="headerlink" title="缓冲目的"></a>缓冲目的</h4><p>标准I&#x2F;O库提供缓冲的目的是尽可能减少使用read和write调用的次数。它也对每个I&#x2F;O流自动进行缓冲管理。</p><h3 id="3种类型的缓冲"><a href="#3种类型的缓冲" class="headerlink" title="3种类型的缓冲"></a>3种类型的缓冲</h3><h4 id="1-全缓冲"><a href="#1-全缓冲" class="headerlink" title="1. 全缓冲"></a>1. 全缓冲</h4><p>在这种情况下，在填满标准I&#x2F;O缓冲区后才进行实际的I&#x2F;O操作。</p><h5 id="冲洗（flush）"><a href="#冲洗（flush）" class="headerlink" title="冲洗（flush）"></a>冲洗（flush）</h5><p>术语冲洗（flush）说明标准I&#x2F;O缓冲区的写操作。值得注意的是，UNIX环境中，flush有两种意思。在标准I&#x2F;O库方面，flush意味着将缓冲区中的内容写到磁盘上（此时该缓冲区的内容可能没有填满）。在终端驱动程序方面，flush表示丢弃已存储在缓冲区中的数据</p><h4 id="2-行缓冲"><a href="#2-行缓冲" class="headerlink" title="2. 行缓冲"></a>2. 行缓冲</h4><p>顾名思义，行缓冲的意思是遇到换行符之后才进行I&#x2F;O操作。这允许我们一次输出一个字符（用标准I&#x2F;O函数fputc），但只有在写了一行之后才进行实际I&#x2F;O操作。</p><h5 id="对于行缓冲有两个限制"><a href="#对于行缓冲有两个限制" class="headerlink" title="对于行缓冲有两个限制"></a>对于行缓冲有两个限制</h5><ol><li>因为标准I&#x2F;O库用来收集每一行的缓冲区的长度是固定的，所以只要填满缓冲区，那么及时还没有写一个换行符，也进行I&#x2F;O操作。</li><li>任何时候只要通过I&#x2F;O库要求<br>（a）一个不带缓冲的流<br>（b）一个行缓冲的流得到输入数据，那么就会冲洗所有行缓冲输出流。</li></ol><h4 id="3-不带缓冲：标准I-x2F-O库不对字符进行缓冲存储。"><a href="#3-不带缓冲：标准I-x2F-O库不对字符进行缓冲存储。" class="headerlink" title="3. 不带缓冲：标准I&#x2F;O库不对字符进行缓冲存储。"></a>3. 不带缓冲：标准I&#x2F;O库不对字符进行缓冲存储。</h4><h3 id="缓冲设置"><a href="#缓冲设置" class="headerlink" title="缓冲设置"></a>缓冲设置</h3><p>对任何一个给定的流，如果我们并不喜欢这些系统默认，则可调用下列两个函数中的一个更改缓冲类型。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">setbuf</span><span class="hljs-params">(FILE *<span class="hljs-keyword">restrict</span> fp, <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> buf)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">setvbuf</span><span class="hljs-params">(FILE *<span class="hljs-keyword">restrict</span> fp, <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> buf, <span class="hljs-type">int</span> mode, <span class="hljs-type">size_t</span> size)</span>;<br></code></pre></td></tr></table></figure><p>使用setvbuf,我们可以精确地说明所需的缓冲类型。这是用mode参数实现的：<br>_IOFBF 全缓冲<br>_IOLBF 行缓冲<br>_IONBF 不带缓冲<br>如果指定一个不带缓冲的流，则忽略buf和size参数。如果指定全缓冲或行缓冲，则buf和size可选择地指定一个缓冲区及其长度。如果该流是带缓冲的，而buf是NULL，则标准I&#x2F;O库将自动地为该刘分配适当长度的缓冲区。适当的长度指的是由常量BUFSIZE指定的值。<br>任何时候，我们都可强制冲洗一个流。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">fflush</span><span class="hljs-params">(FILE *fp)</span>;<br></code></pre></td></tr></table></figure><p>此函数使所有未写的数据都被传送至内核。作为一种特殊情形，如若fp是NULL，此函数将导致所有输出流被冲洗。</p><h1 id="fopen系列函数"><a href="#fopen系列函数" class="headerlink" title="fopen系列函数"></a>fopen系列函数</h1><p>下列3个函数打开一个标准I&#x2F;O流。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br>FILE *<span class="hljs-title function_">fopen</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> pathname, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> type)</span>;<br>FILE *<span class="hljs-title function_">freopen</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> pathname, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> type, FILE *<span class="hljs-keyword">restrict</span> fp)</span>;<br>FILE *<span class="hljs-title function_">fdopen</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *type)</span>;<br></code></pre></td></tr></table></figure><h2 id="函数区别如下"><a href="#函数区别如下" class="headerlink" title="函数区别如下"></a>函数区别如下</h2><h3 id="fopen"><a href="#fopen" class="headerlink" title="fopen"></a>fopen</h3><p>fopen 函数打开路径名为pathname的一个指定的文件。</p><h3 id="freopen"><a href="#freopen" class="headerlink" title="freopen"></a>freopen</h3><p>freopen 函数在一个制定的流上打开一个指定的文件，如若该流已经打开，则先关闭该流。若该流已经定向，则使用freopen清除该定向。此函数一般用于将一个指定的文件打开为一个预定义的流：标准输入，标准输出或标准错误。</p><h3 id="fdopen"><a href="#fdopen" class="headerlink" title="fdopen"></a>fdopen</h3><p>fdopen函数取一个已有的文件描述符（我们可能从open、dup、dup2、fcntl、pip、socket、socketpair或accept函数得到此文件描述符），并使一个标准的I&#x2F;O流与该描述符相结合。此函数常用与创建管道和网络通信通道函数返回的描述符。因为这些特殊类型的文件不能用标准I&#x2F;O函数fopen打开，所以我们必须先调用设备专用函数以获得一个文件描述符，然后用fdopen使一个标准I&#x2F;O流与该描述符相结合。</p><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="1-pathname"><a href="#1-pathname" class="headerlink" title="1.pathname"></a>1.pathname</h3><p>路径名，const修饰表明不会对传输的参数做任何修改。</p><h3 id="2-type"><a href="#2-type" class="headerlink" title="2.type"></a>2.type</h3><p>权限<br><img src="https://pic.downk.cc/item/5fc63722f81f7e3bd97f588e.jpg"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol><li>r代表只读，若文件不存在则报错。</li><li>w代表只写，并且文件若存在则将其清空，若不存在则创建</li><li>a代表追加，并且文件若存在则继续写，若不存在则创建</li><li>a+模式则较为特殊，若是读操作则放开头，写操作则放在结尾。</li></ol><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>在UNIX中，b这个字符无关紧要，也就是说r和rb含义相同。</p><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>返回值是一个指向FILE结构体的指针，FILE结构体在上一节中给出了介绍，那么这个指针的指向位置是在哪呢？<br>答案：<br>堆上。<br>解释：<br>存放位置有三个可能性：栈、静态区和堆<br>而函数的形式如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">FILE *<span class="hljs-title function_">fopen</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> pathname, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-keyword">restrict</span> type)</span>&#123;<br>   <br>   <span class="hljs-keyword">return</span> ;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，若是栈，那么意味着是局部变量，在函数调用结束之后就被销毁了，因此不可能是栈。<br>那么若是静态区，则需要在函数体中</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> FILE tmp;<br><span class="hljs-keyword">return</span> &amp;tmp;<br></code></pre></td></tr></table></figure><p>但是对于static修饰的变量只能声明一次，也就是说，以后再调用fopen函数时不会重新static定义一个变量了，只会返回相同的变量。<br>因此只能在堆上。<br>也就是需要在定义时就先分配一定空间，如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">FILE *tmp = null;<br>tmp = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(FILE)); <span class="hljs-comment">//至关重要，将其分配在了堆上</span><br></code></pre></td></tr></table></figure><h1 id="fclose函数"><a href="#fclose函数" class="headerlink" title="fclose函数"></a>fclose函数</h1><p>fclose函数作用于fopen相反</p><h2 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h2><p>fopen里有malloc函数，因为在fclose里面需要free。这是成对出现的</p><h2 id="函数形式"><a href="#函数形式" class="headerlink" title="函数形式"></a>函数形式</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">fclose</span><span class="hljs-params">(FILE *fp)</span>;<br></code></pre></td></tr></table></figure><h3 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h3><p>若成功返回0，若失败返回EOF（一般是-1，但是为了严谨需要使用EOF）</p><h3 id="动作"><a href="#动作" class="headerlink" title="动作"></a>动作</h3><p>在该文件被关闭之前，冲洗缓冲区中的输出数据。缓冲区中的任何输入数据被丢弃。如果标准I&#x2F;O库已经为该流自动分配了一个缓冲区，则释放此缓冲区<br>当一个进程正常终止时，则所有带未写缓冲数据的标准I&#x2F;O流都被冲洗，所有打开的标准I&#x2F;O流都被关闭。</p><h2 id="fopen和fclose举例"><a href="#fopen和fclose举例" class="headerlink" title="fopen和fclose举例"></a>fopen和fclose举例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    FILE *fp;<br>    fp = fopen(<span class="hljs-string">&quot;tmp&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-keyword">if</span>(fp == <span class="hljs-literal">NULL</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fopen():%s\n&quot;</span>,strerror(errno));<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK!&quot;</span>);<br><br>    fclose(fp);<br><br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>解释：在这里以写的形式打开一个叫tmp的文件，因为文件不存在，因此创建了该文件，并且输出OK，最终调用dclose关闭流</p><p>输出：<br><img src="https://pic.downk.cc/item/5fc6361ff81f7e3bd97eda26.jpg"></p><h2 id="打开文件的数量上限"><a href="#打开文件的数量上限" class="headerlink" title="打开文件的数量上限"></a>打开文件的数量上限</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    FILE *fp;<br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>        fp = fopen(<span class="hljs-string">&quot;tmp&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>);<br>        <span class="hljs-keyword">if</span>(fp == <span class="hljs-literal">NULL</span>)&#123;<br>            perror(<span class="hljs-string">&quot;fopen()&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        count++;<br>    &#125;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;count = %d\n&quot;</span>, count);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>解释：<br>在这里不断创建文件，直到达到文件数量上限时给出break，输出创建文件数量<br>输出：<br><img src="https://pic.downk.cc/item/5fc636a7f81f7e3bd97f3e42.jpg"></p><p>和<br><img src="https://pic.downk.cc/item/5fc63722f81f7e3bd97f5887.jpg"><br>给出的限制是相同的。因为自动打开的流为stdin，stdout，stderr，因此剩余256-3&#x3D;253</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/669b1d6cebc4.html"/>
    <url>/2022/12/669b1d6cebc4.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@chadoop01 apache-pulsar-2.8.0]# bin/pulsar-admin tenants list<br>&quot;public&quot;<br>&quot;pulsar&quot;<br>[root@chadoop01 apache-pulsar-2.8.0]# bin/pulsar-admin brokers list user<br>&quot;192.168.10.5:8080&quot;<br>&quot;192.168.10.4:8080&quot;<br>&quot;192.168.10.3:8080&quot;<br>[root@chadoop01 apache-pulsar-2.8.0]# bin/pulsar-admin namespaces list public<br>&quot;public/default&quot;<br>[root@chadoop01 apache-pulsar-2.8.0]# bin/pulsar-admin topics list public/default<br>&quot;persistent://public/default/produce_topic-partition-2&quot;<br>&quot;persistent://public/default/produce_topic-partition-1&quot;<br>&quot;persistent://public/default/consume_topic-partition-0&quot;<br>&quot;persistent://public/default/produce_topic-partition-0&quot;<br>&quot;persistent://public/default/consume_topic-partition-2&quot;<br>&quot;persistent://public/default/consume_topic-partition-1&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除:需要先卸载后删除</span><br>[root@chadoop02 apache-pulsar-2.8.0]# bin/pulsar-admin topics unload persistent://public/default/from_topic<br>[root@chadoop02 apache-pulsar-2.8.0]# bin/pulsar-admin topics delete persistent://public/default/consume_topic6<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">生产</span><br>bin/pulsar-client produce public/default/from_topic --messages &quot;&#123;data:[&#123;data:hello1,topic:topic1&#125;,&#123;data:hello2,topic:topic2&#125;],client:ccc&#125;&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">向my-topic这个topic生产数据，内容为“hello-pulsar”，如果topic不存在，pulsar会自动创建</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">消费</span><br>bin/pulsar-client consume public/default/produce_topic -s &quot;topicGroup&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">消费my-topic的数据，订阅名称为“topicGroup<span class="hljs-string">&quot;, 如果topic不存在，pulsar会自动创建</span></span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">2021</span>-<span class="hljs-number">07</span>-<span class="hljs-number">13</span> <span class="hljs-number">05</span>:<span class="hljs-number">03</span>:<span class="hljs-number">32.002</span>  INFO <span class="hljs-number">10200</span> --- [r-client-io-<span class="hljs-number">1</span>-<span class="hljs-number">1</span>] o.a.p.c.i.PartitionedProducerImpl        : [<span class="hljs-keyword">public</span>/<span class="hljs-keyword">default</span>/produce_topic] Created partitioned producer<br><span class="hljs-number">2021</span>-<span class="hljs-number">07</span>-<span class="hljs-number">13</span> <span class="hljs-number">05</span>:<span class="hljs-number">03</span>:<span class="hljs-number">32.002</span>  INFO <span class="hljs-number">10200</span> --- [           main] c.c.s.l.d.i.PulsarMQ                     : initialized done<br><span class="hljs-number">2021</span>-<span class="hljs-number">07</span>-<span class="hljs-number">13</span> <span class="hljs-number">05</span>:<span class="hljs-number">03</span>:<span class="hljs-number">32.047</span>  INFO <span class="hljs-number">10200</span> --- [           main] c.c.s.l.c.PulsarController               : [INFO] Begin to execute PulsarController<br><span class="hljs-number">2021</span>-<span class="hljs-number">07</span>-<span class="hljs-number">13</span> <span class="hljs-number">05</span>:<span class="hljs-number">03</span>:<span class="hljs-number">32.047</span>  INFO <span class="hljs-number">10200</span> --- [           main] c.c.s.l.d.i.PulsarMQ                     : [INFO] Begin to consume the message<br></code></pre></td></tr></table></figure><h1 id="Java调试"><a href="#Java调试" class="headerlink" title="Java调试"></a>Java调试</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>MQ</category>
      
      <category>pulsar</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/d451c06ee214.html"/>
    <url>/2022/12/d451c06ee214.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-终端登录和网络登录"><a href="#1-终端登录和网络登录" class="headerlink" title="1 终端登录和网络登录"></a>1 终端登录和网络登录</h1><h3 id="终端介绍"><a href="#终端介绍" class="headerlink" title="终端介绍"></a>终端介绍</h3><p>计算机&#x3D;主机+终端<br>终端&#x3D;输入设备+输出设备</p><p>也就是说，终端其实就是向主机输入信息和输出信息的设备，可以分为输入设备和输出设备。台式机的输入通常包括键盘、鼠标、麦克风，输出设备包括显示器、扬声器等。</p><h4 id="理解："><a href="#理解：" class="headerlink" title="理解："></a>理解：</h4><p>也就是说，我们最开始买来的笔记本电脑只有一个主机，没有输入输出设备，不能使用。因此我们需要购买一些终端来进行输入输出操作，例如我们买键盘和县食品，那么我们就可以通过输入终端（键盘）进行输入操作，通过输出终端（显示屏）来进行输出操作，显示我们的输入经过主机运算之后得到的内容。</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>终端本身没有任何计算等功能，只有输入和输出的功能，只有经过主机的计算才能有作用，否则就是废铁</p><h4 id="终端服务器"><a href="#终端服务器" class="headerlink" title="终端服务器"></a>终端服务器</h4><p>若一个机构有多台主机，那么要让每个终端都能连接到任意一个主机，就需要一个终端服务器，让终端和终端服务器之间连接，然后用户启动时选择要登录得主机，类似于今天的路由器。</p><h4 id="控制台（Console）"><a href="#控制台（Console）" class="headerlink" title="控制台（Console）"></a>控制台（Console）</h4><p>大部分终端（例如鼠标键盘）都是通过线路连接。但是有个终端与众不同，它是与主机一体的，不需要连线，这个特殊的终端就是console。中文名为控制台。Console是用来管理主机的，只能给系统管理员使用，而且一个主机只能有一个console。</p><h4 id="控制台和普通终端的区别"><a href="#控制台和普通终端的区别" class="headerlink" title="控制台和普通终端的区别"></a>控制台和普通终端的区别</h4><p>Console与一般终端在外表上没什么区别，但是在功能上却大不相同，有些事情只能在console上完成，而不能在终端完成。例如当系统启动出错时，错误信息会显示在Console的显示器屏幕上，而不会显示在一般的终端上。在单用户模式下，只有console才能连接到主机，其他终端没有权限访问主机。</p><h4 id="终端模拟程序"><a href="#终端模拟程序" class="headerlink" title="终端模拟程序"></a>终端模拟程序</h4><p>终端属于硬件。从前用户坐在真实的终端前面输入命令，现在输入命令时不能使用真正的终端。因为现在真实的终端是图形界面的终端。现在，用户要输入命令必须使用终端模拟程序(Terminal Emulation Program)。终端模拟程序就是我们平常在Linux桌面环境中打开的终端窗口(Terminal Window)，它是个虚拟终端，但主机会认为它就是真正的终端。终端模拟程序也可以叫做终端模拟器(Terminal Emulator)。</p><h3 id="虚拟控制台"><a href="#虚拟控制台" class="headerlink" title="虚拟控制台"></a>虚拟控制台</h3><p>终端模拟程序有两种：</p><ol><li>终端窗口</li><li>虚拟控制台</li></ol><p>Unix允许用户在自己电脑上使用多个终端，其中一个是图形终端，其他六个是字符终端。这七个终端使用同一个显示器和键盘。</p><p>参考文献：<br><a href="https://www.linuxdashen.com/%E4%BD%A0%E7%9C%9F%E7%9A%84%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%88%E7%AB%AF%E5%90%97%EF%BC%9F">https://www.linuxdashen.com/%E4%BD%A0%E7%9C%9F%E7%9A%84%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%88%E7%AB%AF%E5%90%97%EF%BC%9F</a></p><h2 id="控制终端"><a href="#控制终端" class="headerlink" title="控制终端"></a>控制终端</h2><p>终端有两种类型：</p><ol><li>常规终端设备</li><li>伪终端设备<br>常规终端设备是一种本机终端设备，可以键入该终端设备并将输入发送到系统，例如我们输入Ctrl+Alt+F1进入TTY1，可以注意到除了终端，没有图形，这就是常规终端设备。<br>伪终端是我们使用额终端，它们使用shell终端窗口模拟终端，并用PTS表示。</li></ol><p>通常将进程绑定到控制终端。</p><h1 id="2-进程组和会话"><a href="#2-进程组和会话" class="headerlink" title="2 进程组和会话"></a>2 进程组和会话</h1><h2 id="进程组"><a href="#进程组" class="headerlink" title="进程组"></a>进程组</h2><p>每个进程除了有一进程ID之外，还属于一个进程组。</p><h3 id="进程组定义"><a href="#进程组定义" class="headerlink" title="进程组定义"></a>进程组定义</h3><p>进程组是一个或多个进程的集合，通常，它们是在同一作业中结合起来的。</p><h3 id="进程组函数"><a href="#进程组函数" class="headerlink" title="进程组函数"></a>进程组函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">pid_t</span> <span class="hljs-title function_">getpgrp</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure><p>返回值时<strong>调用进程</strong>的进程组的ID。<br>注意：<br>这里只能是调用进程的进程组ID，不能查看别的进程对应的进程组ID。如是要查看别的组的进程组ID，可以用getpgid</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">pid_t</span> <span class="hljs-title function_">getpgid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid)</span>;<br></code></pre></td></tr></table></figure><p>若pid是0，则返回调用进程的组ID，出错则返回-1.</p><h3 id="组长ID"><a href="#组长ID" class="headerlink" title="组长ID"></a>组长ID</h3><p>每个进程组有一个组长进程。<br>组长进程特定：<br><em>组长进程的进程组ID等于其进程ID。</em><br>也就是说，若是需要查看一个进程的进程组的组长ID，只需要查看进程的进程组ID就行了，这两者是相等的。</p><h4 id="进程和进程组ID举例"><a href="#进程和进程组ID举例" class="headerlink" title="进程和进程组ID举例"></a>进程和进程组ID举例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>  <span class="hljs-type">pid_t</span> pid;    <span class="hljs-comment">//进程ID</span><br>  <span class="hljs-type">pid_t</span> pgid;   <span class="hljs-comment">//进程组ID</span><br><br>  pgid = getpgid(<span class="hljs-number">0</span>);<br>  pid = getpid();<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;进程号为：%d\n&quot;</span>, pid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;进程组号为：%d\n&quot;</span>, pgid);<br><br><br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>输出：</p><p><img src="https://pic.downk.cc/item/5fc636c3f81f7e3bd97f43a4.jpg">)</p><p>解释：</p><p>在这里，该进程ID就是该进程组ID，也就是说，这个进程的进程组的组长进程就是该进程。</p><h2 id="进程组加入或创建"><a href="#进程组加入或创建" class="headerlink" title="进程组加入或创建"></a>进程组加入或创建</h2><p>进程调用setpgid可以加入一个现有的进程组或者创建一个新进程组。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">setpgid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid, <span class="hljs-type">pid_t</span> pgid)</span>;<br></code></pre></td></tr></table></figure><p>作用：<br>将进程pid的进程组ID设置为pgid。若pid&#x3D;pgid，则有pid指定的进程变成进程组组长。<br>情况：</p><ol><li>如果两个参数相等，就将pid指定的进程变成进程组组长 </li><li>如果pid是0，则使用调用者的进程ID。</li><li>如果pgid是0，则由pid指定的进程ID用作进程组ID。</li></ol><p>举例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-type">pid_t</span> pid;<br>  <span class="hljs-type">pid_t</span> pgid;<br>  <span class="hljs-type">int</span> status;<br>  <span class="hljs-type">int</span> id;<br><br>  pid = getpid();<br>  pgid = getpgid(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程id=%d\n&quot;</span>, pid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程组id=%d\n&quot;</span>, pgid);<br><br>  id = fork();<br>  <span class="hljs-keyword">if</span> (id == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-type">pid_t</span> tmp_parentid = pid;<br>    pid = getpid();<br>    <span class="hljs-type">int</span> tmp=setpgid(tmp_parentid, pid);<br>    <span class="hljs-keyword">if</span> (tmp == <span class="hljs-number">-1</span>)&#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// setpgid(pid, pid);</span><br>    pgid = getpgid(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;子进程id=%d\n&quot;</span>, pid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;子进程组id=%d\n&quot;</span>, pgid);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  wait(&amp;status);<br>  pid = getpid();<br>  pgid = getpgid(<span class="hljs-number">0</span>);<br><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程id=%d\n&quot;</span>, pid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程组id=%d\n&quot;</span>, pgid);<br><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="输出："><a href="#输出：" class="headerlink" title="输出："></a>输出：</h4><p><img src="https://pic.downk.cc/item/5fc636e5f81f7e3bd97f4b62.jpg"></p><h1 id="3-会话"><a href="#3-会话" class="headerlink" title="3 会话"></a>3 会话</h1><p>会话(session)是一个或者多个进程组的集合<br>说白了，会话其实就是多个进程组之间的联系，例如后台进程组和前台进程组之间。</p><h2 id="举例：一个含有3个进程组的会话"><a href="#举例：一个含有3个进程组的会话" class="headerlink" title="举例：一个含有3个进程组的会话"></a>举例：一个含有3个进程组的会话</h2><p><img src="https://pic.downk.cc/item/5fc636e5f81f7e3bd97f4b54.jpg"></p><h2 id="调用setsid函数建立一个新的会话"><a href="#调用setsid函数建立一个新的会话" class="headerlink" title="调用setsid函数建立一个新的会话"></a>调用setsid函数建立一个新的会话</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">pid_t</span> <span class="hljs-title function_">setsid</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure><p>若成功返回进程组ID，若失败返回-1.<br>如果调用函数的进程不是一个进程组的组长，则该函数会创建一个新会话。具体发生以下三件事：</p><ol><li>该进程会变成新会话的<strong>会话首进程</strong>（session leader，也就是创建该会话的进程）。此时该进程是新会话中的唯一进程</li><li>该进程称为一个新进程组的组长进程。新进程组ID是调用该进程的进程ID</li><li>该进程没有控制终端。如果在调用setsid之前该进程有一个控制终端，那么这种联系也会被切断。</li></ol><h2 id="返回错误的情况"><a href="#返回错误的情况" class="headerlink" title="返回错误的情况"></a>返回错误的情况</h2><p>若调用该进程已经是进程组的组长，则此函数返回出错。</p><h2 id="如何设置"><a href="#如何设置" class="headerlink" title="如何设置"></a>如何设置</h2><p>通常先调用fork，然后使其父进程终止，而子进程继续，因为子进程继承了父进程的进程组ID，而且其进程ID是重新分配的，两者不可能相等，这就保证了子进程不是一个进程组的组长。</p><h2 id="调用getsid函数返回会话首进程的进程组ID"><a href="#调用getsid函数返回会话首进程的进程组ID" class="headerlink" title="调用getsid函数返回会话首进程的进程组ID"></a>调用getsid函数返回会话首进程的进程组ID</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">pid_t</span> <span class="hljs-title function_">getsid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid)</span>;<br></code></pre></td></tr></table></figure><p>若成功返回会话首进程的进程组ID，出错返回-1.</p><h2 id="setsid和getsid实例"><a href="#setsid和getsid实例" class="headerlink" title="setsid和getsid实例"></a>setsid和getsid实例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-type">pid_t</span> pid;<br>  <span class="hljs-type">pid_t</span> pgid;<br>  <span class="hljs-type">pid_t</span> sid;<br>  <span class="hljs-type">int</span> status;<br><br>  pid = getpid();<br>  pgid = getpgid(<span class="hljs-number">0</span>);<br>  sid = getsid(pid);<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程id为%d\n&quot;</span>,pid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程组id为%d\n&quot;</span>,pgid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程sid为%d\n&quot;</span>,sid);<br><br>  <span class="hljs-type">int</span> tmpid;<br>  tmpid = fork();<br>  <span class="hljs-keyword">if</span>(tmpid == <span class="hljs-number">0</span>)&#123;<br>    pid = getpid();<br>    sid = getsid(pid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;子进程目前的sid为%d\n&quot;</span>,sid);<br>    pgid = setsid();<br>    sid = getsid(pid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;子进程id为%d\n&quot;</span>,pid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;子进程新组id为%d\n&quot;</span>,pgid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;子进程新sid为%d\n&quot;</span>,sid);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  wait(&amp;status);<br>  pid = getpid();<br>  sid = getsid(pid);<br>  pgid = getpgid(<span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程新id为%d\n&quot;</span>,pid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程新组id为%d\n&quot;</span>,pgid);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;父进程新sid为%d\n&quot;</span>,sid);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="输出：-1"><a href="#输出：-1" class="headerlink" title="输出："></a>输出：</h4><p><img src="https://pic.downk.cc/item/5fc636d9f81f7e3bd97f4922.jpg"></p><h4 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h4><p>先是得到了父进程的进程id为1717，此时父进程的组id就是父进程的id，会话ID是831。然后父进程fork了一个子进程，子进程的id为1857，并且当前的会话ID和父进程的相同，也为831.经过setsid之后将当前的ID设置成了会话ID，但是并不影响父进程的ID、组ID和会话ID。</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/50053022f779.html"/>
    <url>/2022/12/50053022f779.html</url>
    
    <content type="html"><![CDATA[<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><ol><li>Linux操作系统</li><li>Docker</li></ol><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ol><li>k8s概念和架构</li><li>从零搭建k8s集群<ol><li>基于客户端工具kubeadm</li><li>基于二进制包方式</li></ol></li><li>k8s核心概念<ol><li>Pod</li><li>Controller</li><li>Service</li><li>Igress</li><li>RBAC</li><li>Helm</li><li>持久存储</li></ol></li><li>搭建集群监控平台系统</li><li>从零搭建高可用k8s集群</li><li>在集群环境部署项目</li></ol>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>K8S</category>
      
      <category>尚硅谷</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/68e49038c60d.html"/>
    <url>/2022/12/68e49038c60d.html</url>
    
    <content type="html"><![CDATA[<h1 id="k8s概述"><a href="#k8s概述" class="headerlink" title="k8s概述"></a>k8s概述</h1><ul><li>k8s是谷歌在2014年开源的容器化集群管理系统</li><li>使用k8s进行容器化应用部署</li><li>使用k8s利于应用扩展</li><li>k8s目标实施部署容器化应用更加简洁和高效</li></ul><h1 id="k8s功能"><a href="#k8s功能" class="headerlink" title="k8s功能"></a>k8s功能</h1><ol><li><p>自动装箱</p><p>基于容器对应用运行环境的资源配置要求自动部署应用容器</p></li><li><p>自我修复</p><p>当容器失败时，会对容器进行重启</p><p>当所部署的Node节点有问题时，会对容器进行重新部署和重新调度</p><p>当容器未通过监控检查时，会关闭此容器直到容器正常运行时，才会对外提供服务</p></li><li><p>水平扩展</p><p>用户不需使用额外的服务发现机制，就能够基于Kubernetes自身能力实现服务发现和负载均衡</p></li><li><p>滚动更新</p><p>可以根据应用的变化，对应用容器进行的应用，进行一次性或批量式更新</p></li><li><p>版本回退</p><p>可以根据应用部署情况，对应用容器运行的应用，进行历史版本即时回退</p></li><li><p>秘钥和配置管理</p><p>在不需要重新构建镜像的情况下，可以部署和更新秘钥和应用配置，类似热部署。</p></li><li><p>存储编排</p><p>自动实现存储系统挂载及应用，特别对有状态应用实现数据持久化非常重要。存储系统可以来自于本地目录、网络存储（NFS、Gluster等）、公有云存储服务。</p></li><li><p>批处理</p><p>提供一次性处理任务。</p></li></ol><h1 id="k8s集群架构组件"><a href="#k8s集群架构组件" class="headerlink" title="k8s集群架构组件"></a>k8s集群架构组件</h1><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/image-20210614175627564.png" alt="image-20210614175627564"  /><h1 id="k8s核心概念"><a href="#k8s核心概念" class="headerlink" title="k8s核心概念"></a>k8s核心概念</h1><h2 id="1-Pod"><a href="#1-Pod" class="headerlink" title="1. Pod"></a>1. Pod</h2><ol><li>最小部署单元</li><li>一组容器的集合</li><li>共享网络</li><li>生命周期是短暂的</li></ol><h2 id="2-controller"><a href="#2-controller" class="headerlink" title="2. controller"></a>2. controller</h2><ol><li>确保预期的Pod副本数量</li><li>无状态应用部署和有状态应有部署</li><li>确保所有的node运行同一个pod</li><li>一次性任务和定时任务</li></ol><h2 id="3-Service"><a href="#3-Service" class="headerlink" title="3. Service"></a>3. Service</h2><p>定义一组Pod的访问规则</p>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>K8S</category>
      
      <category>尚硅谷</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/bd72c62a8be0.html"/>
    <url>/2022/12/bd72c62a8be0.html</url>
    
    <content type="html"><![CDATA[<h1 id="Golang最强⼤的访问控制框架casbin全解析"><a href="#Golang最强⼤的访问控制框架casbin全解析" class="headerlink" title="Golang最强⼤的访问控制框架casbin全解析"></a>Golang最强⼤的访问控制框架casbin全解析</h1><p>Casbin是⼀个强⼤的、⾼效的开源访问控制框架，其权限管理机制⽀持多种访问控制模型。⽬前这个框架的⽣态已经发展的越来越好了。提供了各种语⾔的类库，⾃定义的权限<br>模型语⾔，以及模型编辑器。在各种语⾔中，golang的⽀持还是最全的，所以我们就研究casbin的golang实现。</p><h2 id="访问控制模型"><a href="#访问控制模型" class="headerlink" title="访问控制模型"></a>访问控制模型</h2><h3 id="UGO-User-Group-Other"><a href="#UGO-User-Group-Other" class="headerlink" title="UGO(User, Group,Other)"></a>UGO(User, Group,Other)</h3><p>这个是Linux中对于资源进⾏权限管理的访问模型。Linux中⼀切资源都是⽂件，每个⽂件都可以设置三种⾓⾊的访问权限（⽂件创建者，⽂件创建者所在组，其他⼈）。这种访<br>问模型的缺点很明显，只能为⼀类⽤户设置权限，如果这类⽤户中有特殊的⼈，那么它⽆能为⼒了。</p><h3 id="ACL-访问控制列表"><a href="#ACL-访问控制列表" class="headerlink" title="ACL(访问控制列表)"></a>ACL(访问控制列表)</h3><p>它的原理是，每个资源都配置有⼀个列表，这个列表记录哪些⽤户可以对这项资源进⾏CRUD操作。当系统试图访问这项资源的时候，会⾸先检查这个列表中是否有关于当前⽤<br>户的访问权限，从⽽确定这个⽤户是否有权限访问当前资源。linux在UGO之外，也增加了这个功能。</p><p>在linux系统中，我们可以使用getfacl和setfacl命令对某个资源设置增加某个人或者某个组的权限列表。操作系统会根据这个权限列表进行判断，当前用户是否有权限操作这个资源。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-11-161-centos ~/download_data]# setfacl -m user:coachhe:rw- ./1.txt <br>[root@VM-11-161-centos ~/download_data]# getfacl 1.txt <br><span class="hljs-meta prompt_"># </span><span class="language-bash">file: 1.txt</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">owner: root</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">group: root</span><br>user::rw-<br>user:coachhe:rw-<br>group::r--<br>mask::rw-<br>other::r--<br></code></pre></td></tr></table></figure><p>可以看到，我们通过setfacl给对1.txt这个资源设置增加了coachhe用户的权限读写权限，然后通过getfacl命令可以看到用户的权限</p><h2 id="RBAC-基于角色的权限访问控制"><a href="#RBAC-基于角色的权限访问控制" class="headerlink" title="RBAC(基于角色的权限访问控制)"></a>RBAC(基于角色的权限访问控制)</h2><p>这个是很多业务系统最通⽤的权限访问控制系统。它的特点是在⽤户和具体权限之间增加了⼀个⾓⾊。就是先设置⼀个⾓⾊，⽐如管理员，然后将⽤户关联某个⾓⾊中，再将⾓<br>⾊设置某个权限。⽤户和⾓⾊是多对多关系，⾓⾊和权限是多对多关系。所以⼀个⽤户是否有某个权限，根据⽤户属于哪些⾓⾊，再根据⾓⾊是否拥有某个权限来判断这个⽤户<br>是否有某个权限。<br>RBAC的逻辑有更多的变种:</p><h3 id="变种一：角色引入继承"><a href="#变种一：角色引入继承" class="headerlink" title="变种一：角色引入继承"></a>变种一：角色引入继承</h3><p>角色引入了继承概念，那么继承的角色有了上下级或者等级关系。 </p><h3 id="变种二：角色引入了约束"><a href="#变种二：角色引入了约束" class="headerlink" title="变种二：角色引入了约束"></a>变种二：角色引入了约束</h3><p>角色引入了约束概念。约束概念有两种，</p><h4 id="1-静态职责分离："><a href="#1-静态职责分离：" class="headerlink" title="1. 静态职责分离："></a>1. 静态职责分离：</h4><p>a、互斥角色：同一个用户在两个互斥角色中只能选择一个<br>b、基数约束：一个用户拥有的角色是有限的，一个角色拥有的许可也是有限的<br>c、先决条件约束：用户想要获得高级角色，首先必须拥有低级角色 </p><h4 id="2-是动态职责分离："><a href="#2-是动态职责分离：" class="headerlink" title="2. 是动态职责分离："></a>2. 是动态职责分离：</h4><p>可以动态的约束用户拥有的角色，如一个用户可以拥有两个角色，但是运行时只能激活一个角色。 </p><h3 id="变种三：既有角色约束，又有角色继承"><a href="#变种三：既有角色约束，又有角色继承" class="headerlink" title="变种三：既有角色约束，又有角色继承"></a>变种三：既有角色约束，又有角色继承</h3><p>就是前面两种角色变种的集合。</p><h2 id="ABAC-基于属性的权限验证"><a href="#ABAC-基于属性的权限验证" class="headerlink" title="ABAC(基于属性的权限验证)"></a>ABAC(基于属性的权限验证)</h2><p>Attribute-based access control,这种权限验证模式是用属性来标记资源权限的。<br>比如k8s中就用到这个权限验证方法.比如某个资源有pod属性,有命名空间属性,那么我设置的时候可以这样设置: </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Bob可以在命名空间 projectCaribou中读取pod: <br>&#123;&quot;apiVersion&quot;: &quot;abac.authorization.kubernetes.io/v1beta1&quot;, &quot;kind&quot;: &quot;Policy&quot;, &quot;spec&quot;: &#123;&quot;user&quot;: &quot;bob&quot;, &quot;namespace&quot;: &quot;projectCaribou&quot;, &quot;resource&quot;: &quot;pods&quot;, &quot;readonly&quot;: true&#125;&#125; <br></code></pre></td></tr></table></figure><p>这个权限验证模型的好处就是扩展性好,一旦要增加某种权限,就可以直接增加某种属性.</p><h1 id="casbin的基本使用"><a href="#casbin的基本使用" class="headerlink" title="casbin的基本使用"></a>casbin的基本使用</h1><p>casbin使用配置文件来设置访问控制模型。我们可以通过casbin的模型编辑器来查看</p><p>它有两个配置文件，model.conf和policy.csv。其中model.conf存储的是我们访问控制模型，policy.csv存储的是我们具体的用户权限配置。<br>例如：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220517113604.png" width = "50%" /></p><p>使用示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;fmt&quot;</span><br>  <span class="hljs-string">&quot;log&quot;</span><br><br>  <span class="hljs-string">&quot;github.com/casbin/casbin/v2&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">check</span><span class="hljs-params">(e *casbin.Enforcer, sub, obj, act <span class="hljs-type">string</span>)</span></span> &#123;<br>  ok, _ := e.Enforce(sub, obj, act)<br>  <span class="hljs-keyword">if</span> ok &#123;<br>    fmt.Printf(<span class="hljs-string">&quot;%s CAN %s %s\n&quot;</span>, sub, act, obj)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    fmt.Printf(<span class="hljs-string">&quot;%s CANNOT %s %s\n&quot;</span>, sub, act, obj)<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  e, err := casbin.NewEnforcer(<span class="hljs-string">&quot;./model.conf&quot;</span>, <span class="hljs-string">&quot;./policy.csv&quot;</span>)<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    log.Fatalf(<span class="hljs-string">&quot;NewEnforecer failed:%v\n&quot;</span>, err)<br>  &#125;<br><br>  check(e, <span class="hljs-string">&quot;dajun&quot;</span>, <span class="hljs-string">&quot;data1&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>)<br>  check(e, <span class="hljs-string">&quot;lizi&quot;</span>, <span class="hljs-string">&quot;data2&quot;</span>, <span class="hljs-string">&quot;write&quot;</span>)<br>  check(e, <span class="hljs-string">&quot;dajun&quot;</span>, <span class="hljs-string">&quot;data1&quot;</span>, <span class="hljs-string">&quot;write&quot;</span>)<br>  check(e, <span class="hljs-string">&quot;dajun&quot;</span>, <span class="hljs-string">&quot;data2&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>)<br>&#125;<span class="hljs-string">``</span><span class="hljs-string">`</span><br><span class="hljs-string"></span><br><span class="hljs-string">`</span><span class="hljs-string">``</span><span class="hljs-keyword">go</span><br>e, err := casbin.NewEnforcer(<span class="hljs-string">&quot;./model.conf&quot;</span>, <span class="hljs-string">&quot;./policy.csv&quot;</span>)<br></code></pre></td></tr></table></figure><p>主要看这一行，通过两个配置文件创建了一个Enforcer。</p><p>当然，casbin 可以读取具体 policy 的时候不仅仅可以通过 csv ⽂件进⾏读取，也可以通过数据库进⾏读取。这样我们甚⾄可以写⼀个⽤户管理后台来配置不同的⽤户权限。<br>model.conf 也是可以从配置⽂件中获取，也可以从代码中获取，从代码中获取就可以扩展为先读取数据库，再代码加载。但是 model.conf ⼀旦修改，对应的 policy 就需要进⾏<br>同步修改，所以 model 在⼀个系统中不要进⾏频繁修改。</p><h2 id="PML"><a href="#PML" class="headerlink" title="PML"></a>PML</h2><p>在看完上面两个配置文件<code>./model.conf</code>和<code>./policy.csv</code>时候是不是一脸懵？要了解配置文件，我们需要先了解一下PML语言：<br>PML(PERM modeling language)。其中的 PERM 指的是 Policy-Effect-Request-Matcher 。</p><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>代表请求。看我们上面的例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pml">[request_definition]<br>r = sub, obj, act<br></code></pre></td></tr></table></figure><p>代表一个请求有三个标准元素，请求主体，请求对象，请求操作</p><h3 id="Policy和Policy-Rule"><a href="#Policy和Policy-Rule" class="headerlink" title="Policy和Policy_Rule"></a>Policy和Policy_Rule</h3><p>Policy 代表策略，它表示具体的权限定义的规则是什么<br>在policy.csv文件中定义的策略就是policy_rule。它和Policy是一一对应的。<br>例如我们上面的例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pml">[policy_definition]<br>p = sub, obj, act<br></code></pre></td></tr></table></figure><p>我们定义了 policy 的规则如此，那么我们在 policy.csv 中每⼀⾏定义的 policy_rule 就必须和这个属性⼀⼀对应。</p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20220517114718.png" width = "50%" />可以看到，policy.csv和policy_definition中的属性一一对应，所以在我们这里，sub=dajun,obj=data1,act=read，代表dajun(p.sub=dajun)可以对data1(p.obj=data1)进行read(p.act=read)操作这个规则。因此dajun can read data1<p>policy默认的最后一个属性为决策结果，字段名为eft，默认值为allow，也就是说，通过的情况下，p.eft就设置为allow</p><h3 id="Matcher"><a href="#Matcher" class="headerlink" title="Matcher"></a>Matcher</h3><p>有请求，有规则，那么请求是否匹配某个规则，则是matcher进行判断的<br>比如我们这里这个：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pml">[matchers]<br>m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act<br></code></pre></td></tr></table></figure><p>表示当<code>r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act</code>的时候返回true，否则返回false</p><h3 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h3><p>Effect ⽤来判断如果⼀个请求满⾜了规则，是否需要同意请求。它的规则⽐较复杂⼀些。</p><p>比如我们这里：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pml">[policy_effect]<br>e = some(where (p.eft == allow))<br></code></pre></td></tr></table></figure><p>这里的some表示括号中的表达式个数大于等于1就行。<br>我们这句话的意思就是将request和所有policy比对完之后，所有policy的策略结果(p.eft)为allow的个数&gt;&#x3D;1，整个请求的策略就是true</p><h2 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h2><p>⾃定义函数是在 matcher 中使⽤的。我们可以⾃⼰定义⼀个函数，然后注册进enforcer，在matcher中我们就可以使⽤了。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">KeyMatch</span><span class="hljs-params">(key1 <span class="hljs-type">string</span>, key2 <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-comment">// i用来看*在key2中的哪个位置</span><br>    i := strings.Index(key2, <span class="hljs-string">&quot;*&quot;</span>)<br><span class="hljs-comment">// 如果key2中没有*，那么直接比较key1和key2</span><br>    <span class="hljs-keyword">if</span> i == <span class="hljs-number">-1</span> &#123;<br>        <span class="hljs-keyword">return</span> key1 == key2<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(key1) &gt; i &#123;<br>        <span class="hljs-keyword">return</span> key1[:i] == key2[:i]<br>    &#125;<br>    <span class="hljs-keyword">return</span> key1 == key2[:i]<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">KeyMatchFunc</span><span class="hljs-params">(args ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">error</span>) &#123;<br>    name1 := args[<span class="hljs-number">0</span>].(<span class="hljs-type">string</span>)<br>    name2 := args[<span class="hljs-number">1</span>].(<span class="hljs-type">string</span>)<br>    <span class="hljs-keyword">return</span> (<span class="hljs-type">bool</span>)(KeyMatch(name1, name2)), <span class="hljs-literal">nil</span><br>&#125;<br>e.AddFunction(<span class="hljs-string">&quot;my_func&quot;</span>, KeyMatchFunc)<br></code></pre></td></tr></table></figure><p>在这里我们定义了一个函数KeyMatchFunc，比较key1和key2，然后将其注册进了e中，这样我们就可以在matcher中直接使用了：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pml">// 配置⽂件中就可以这样写了<br>[matchers]<br>m = r.sub == p.sub &amp;&amp; my_func(r.obj, p.obj) &amp;&amp; r.act == p.act<br></code></pre></td></tr></table></figure><h3 id="casbin中的自定义函数"><a href="#casbin中的自定义函数" class="headerlink" title="casbin中的自定义函数"></a>casbin中的自定义函数</h3><table><thead><tr><th>Function</th><th>arg1</th><th>arg2</th></tr></thead><tbody><tr><td>KeyMatch</td><td>a URL path like <code>/alice_data/resource1</code></td><td>a URL path or a <code>*</code> like <code>/alice_data/*</code></td></tr><tr><td>KeyMatch2</td><td>a URL path like <code>/alice_data/resource1</code></td><td>a URL path or a <code>:</code> like <code>/alice_data/:resource</code></td></tr><tr><td>KeyMatch3</td><td>a URL path like <code>/alice_data/resource1</code></td><td>a URL path or a <code>&#123;&#125;</code> like <code>/alice_data/&#123;resource&#125;</code></td></tr><tr><td>KeyMatch4</td><td>a URL path like <code>/alice_data/123/book/123</code></td><td>a URL path or a <code>&#123;&#125;</code> like <code>/alice_data/&#123;id&#125;/book/&#123;id&#125;</code></td></tr><tr><td>regexMatch</td><td>any sthing</td><td>a regular expression pattern</td></tr><tr><td>ipMatch</td><td>an IP address like  <code>192.168.2.123</code></td><td>an IP address or a CIDR like <code>192.168.2.0/24</code></td></tr></tbody></table><h2 id="部分理解"><a href="#部分理解" class="headerlink" title="部分理解"></a>部分理解</h2><p>1 我们先定义属性，通⽤的⼀些属性如 subject, object, action。<br>2 定义的属性可以作为 Request 的属性，也可以作为 Policy的属性。<br>3 Policy_Rule 是 Policy 的具体规则。<br>4 使⽤定义的 Matcher 将 Request 和 Policy 进⾏匹配，这个匹配的过程可能使⽤到⾃定义函数。<br>5 所有的 Policy 匹配完成的结果，通过 Effect 规则得出最终是否可以访问的结果。</p><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml">[<span class="hljs-string">request_definition</span>]  <br><span class="hljs-string">r</span> <span class="hljs-string">=</span> <span class="hljs-string">sub,</span> <span class="hljs-string">obj,</span> <span class="hljs-string">act</span>  <br>  <br>[<span class="hljs-string">policy_definition</span>]  <br><span class="hljs-string">p</span> <span class="hljs-string">=</span> <span class="hljs-string">sub,</span> <span class="hljs-string">obj,</span> <span class="hljs-string">act</span>  <br>  <br>[<span class="hljs-string">policy_effect</span>]  <br><span class="hljs-string">e</span> <span class="hljs-string">=</span> <span class="hljs-string">some(where</span> <span class="hljs-string">(p.eft</span> <span class="hljs-string">==</span> <span class="hljs-string">allow))</span>  <br>  <br>[<span class="hljs-string">matchers</span>]  <br><span class="hljs-string">m</span> <span class="hljs-string">=</span> <span class="hljs-string">r.sub</span> <span class="hljs-string">==</span> <span class="hljs-string">p.sub</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">r.obj</span> <span class="hljs-string">==</span> <span class="hljs-string">p.obj</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">r.act</span> <span class="hljs-string">==</span> <span class="hljs-string">p.act</span> <span class="hljs-string">||</span> <span class="hljs-string">r.sub</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;root&quot;</span><br></code></pre></td></tr></table></figure><p>Request:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">alice, data1, read<br></code></pre></td></tr></table></figure><p>这里例子中定义一个Policy_Rule：alice对data1有read权限，当request(alice,data1,read)进来时，它匹配其中一条规则，所以some之后的最终结果为true</p><h3 id="RESTFUL"><a href="#RESTFUL" class="headerlink" title="RESTFUL"></a>RESTFUL</h3><p>RESTFUL接口使用URL和HTTP请求方法表示资源的增删改查，那么我们可以用KeyMatch等函数来判断是否可以进行某个请求</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml">[<span class="hljs-string">request_definition</span>]  <br><span class="hljs-string">r</span> <span class="hljs-string">=</span> <span class="hljs-string">sub,</span> <span class="hljs-string">obj,</span> <span class="hljs-string">act</span>  <br>  <br>[<span class="hljs-string">policy_definition</span>]  <br><span class="hljs-string">p</span> <span class="hljs-string">=</span> <span class="hljs-string">sub,</span> <span class="hljs-string">obj,</span> <span class="hljs-string">act</span>  <br>  <br>[<span class="hljs-string">policy_effect</span>]  <br><span class="hljs-string">e</span> <span class="hljs-string">=</span> <span class="hljs-string">some(where</span> <span class="hljs-string">(p.eft</span> <span class="hljs-string">==</span> <span class="hljs-string">allow))</span>  <br>  <br>[<span class="hljs-string">matchers</span>]  <br><span class="hljs-string">m</span> <span class="hljs-string">=</span> <span class="hljs-string">r.sub</span> <span class="hljs-string">==</span> <span class="hljs-string">p.sub</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">(keyMatch2(r.obj,</span> <span class="hljs-string">p.obj)</span> <span class="hljs-string">||</span> <span class="hljs-string">keyMatch(r.obj,</span> <span class="hljs-string">p.obj))</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">(r.act</span> <span class="hljs-string">==</span> <span class="hljs-string">p.act</span> <span class="hljs-string">||</span> <span class="hljs-string">p.act</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;*&quot;</span><span class="hljs-string">)</span><br></code></pre></td></tr></table></figure><p>Request:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">alice, /alice_data/hello, GET<br></code></pre></td></tr></table></figure><p>当请求进来时，KeyMatch会判断alice对hello资源是否有GET权限，如果有则判断为true</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Casbin ⽀持的权限模型有：</p><ul><li>ACL (Access Control List, 访问控制列表)</li><li>具有超级⽤户的 ACL</li><li>没有⽤户的 ACL: 对于没有⾝份验证或⽤户登录的系统尤其有⽤。</li><li>没有资源的 ACL: 某些场景可能只针对资源的类型, ⽽不是单个资源, 诸如 write-article, read-log等权限。它不控制对特定⽂章或⽇志的访问。</li><li>RBAC (基于⾓⾊的访问控制)</li><li>⽀持资源⾓⾊的RBAC: ⽤户和资源可以同时具有⾓⾊ (或组)。</li><li>⽀持域&#x2F;租户的RBAC: ⽤户可以为不同的域&#x2F;租户设置不同的⾓⾊集。</li><li>ABAC (基于属性的访问控制): ⽀持利⽤resource.Owner这种语法糖获取元素的属性。</li><li>RESTful: ⽀持路径, 如 <code>/res/*</code>, <code>/res/:id</code> 和 HTTP ⽅法, 如 <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>。</li><li>拒绝优先: ⽀持允许和拒绝授权, 拒绝优先于允许。</li></ul>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>go组件</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/6e08b079a45f.html"/>
    <url>/2022/12/6e08b079a45f.html</url>
    
    <content type="html"><![CDATA[<h1 id="口令文件（用户数据库文件）"><a href="#口令文件（用户数据库文件）" class="headerlink" title="口令文件（用户数据库文件）"></a>口令文件（用户数据库文件）</h1><h2 id="阴影文件"><a href="#阴影文件" class="headerlink" title="阴影文件"></a>阴影文件</h2><p>加密口令是经单项算法加密处理过的用户口令副本。因为此算法是单向的，所以不能从加密口令猜测原来的口令</p><h2 id="组文件"><a href="#组文件" class="headerlink" title="组文件"></a>组文件</h2>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>APUE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/d860dcfab95e.html"/>
    <url>/2022/12/d860dcfab95e.html</url>
    
    <content type="html"><![CDATA[<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><h2 id="insert模式："><a href="#insert模式：" class="headerlink" title="insert模式："></a>insert模式：</h2><ol><li>Shift+a:直接跳到尾部进入insert模式</li><li>a: 在当前字符的后面进入 insert 模式</li><li>Shift+i: 直接跳到行的开头进入 insert 模式</li><li>i: 在当前字符的前面进入 insert 模式</li><li>Shift+o: 在当前一行的上一行插入一行进入 insert 模式</li><li>o: 在当前一行的下一行插入一行进入 insert 模式</li><li>Shift+g: 直接到达最后一行</li><li>gg: 来到文件的最开头一个字符</li></ol><h2 id="normal模式"><a href="#normal模式" class="headerlink" title="normal模式"></a>normal模式</h2><h3 id="进入方式"><a href="#进入方式" class="headerlink" title="进入方式"></a>进入方式</h3><p>从insert模式按q键退出</p><h4 id="操作："><a href="#操作：" class="headerlink" title="操作："></a>操作：</h4><p>c+数字：删除后面数字个元素后进入insert模式。例如c6的含义是删除当前位置之后的6个元素后进入insert模式</p><h3 id="删除系列"><a href="#删除系列" class="headerlink" title="删除系列"></a>删除系列</h3><h3 id="d-系列"><a href="#d-系列" class="headerlink" title="d 系列"></a>d 系列</h3><p>dd：剪切整行<br>d→：往右剪切一个字符<br>d3→：往右剪切三个字符</p><h3 id="d-结合-f："><a href="#d-结合-f：" class="headerlink" title="d 结合 f："></a>d 结合 f：</h3><p>df: 往后删到第一个出现的冒号<br>df3: 往后删除第一个出现的 3</p><h3 id="c-系列："><a href="#c-系列：" class="headerlink" title="c 系列："></a>c 系列：</h3><p>c6→：删除右边6个字符后进入insert模式<br>chw：删除当前光标所在的单词（这里是因为我将i改成了h，也就是进入insert模式的i）<br>ch”：删除两个双引号之间的所有内容（这也是因为我将i改成了h）</p><h2 id="y-系列：（复制系列）"><a href="#y-系列：（复制系列）" class="headerlink" title="y 系列：（复制系列）"></a>y 系列：（复制系列）</h2><p>Y3→：往右复制3个字符</p><h2 id="粘贴系列"><a href="#粘贴系列" class="headerlink" title="粘贴系列"></a>粘贴系列</h2><p>p：粘贴</p><h2 id="寻找系列："><a href="#寻找系列：" class="headerlink" title="寻找系列："></a>寻找系列：</h2><p>f系列：（往后找）<br>fv：往后找到第一个v</p><h2 id="搜索："><a href="#搜索：" class="headerlink" title="搜索："></a>搜索：</h2><p>&#x2F;：</p><h2 id="撤回：u"><a href="#撤回：u" class="headerlink" title="撤回：u"></a>撤回：u</h2><h2 id="分屏系列："><a href="#分屏系列：" class="headerlink" title="分屏系列："></a>分屏系列：</h2><p>上下分屏：在normal模式下输入:split<br>左右分屏：在normal模式下输入:vsplit<br>设置快捷键si（这里是因为把i改成了h）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">map si : <span class="hljs-keyword">set</span> splitright<span class="hljs-operator">&lt;</span>CR<span class="hljs-operator">&gt;</span>:vsplit<span class="hljs-operator">&lt;</span>CR<span class="hljs-operator">&gt;</span> ：向上分屏<br></code></pre></td></tr></table></figure><h3 id="可视模式："><a href="#可视模式：" class="headerlink" title="可视模式："></a>可视模式：</h3><h4 id="按v进入一般的可视模式："><a href="#按v进入一般的可视模式：" class="headerlink" title="按v进入一般的可视模式："></a>按v进入一般的可视模式：</h4><p>可以选中当前的字符，然后按上下左右选中自己所需要的字符，进行删除，剪切，复制等操作<br>Shift+g：从当前所在位置直接选到最后一行<br>ggVG：全选</p><h4 id="进行normal模式操作："><a href="#进行normal模式操作：" class="headerlink" title="进行normal模式操作："></a>进行normal模式操作：</h4><p>:normal A.png ：对选中的所有行加上.png后缀<br>:normal Hmy-：对选中的所有行加上my-前缀（这里是因为我将i键改为了h键）</p><h3 id="可视块模式："><a href="#可视块模式：" class="headerlink" title="可视块模式："></a>可视块模式：</h3><p>按control+v进入可视块模式<br>此时可以选中块<br>按上下左右或者G等键可以按照矩形的方式选中块进行操作</p><h3 id="典型操作："><a href="#典型操作：" class="headerlink" title="典型操作："></a>典型操作：</h3><ol><li>gg进入开头，按Shift+g键选中第一列，那么按d就可删除</li><li>gg进入开头，按Shift+g键选中第一列，按Shift+i进入insert模式，写入之后按Esc，此时发现所有第一列都更改了！</li></ol><h1 id="Vim配置文件"><a href="#Vim配置文件" class="headerlink" title="Vim配置文件"></a>Vim配置文件</h1><h2 id="设置配置文件的方法："><a href="#设置配置文件的方法：" class="headerlink" title="设置配置文件的方法："></a>设置配置文件的方法：</h2><p>首先进入主目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~<br></code></pre></td></tr></table></figure><p>然后新建一个文件夹</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-built_in">mkdir</span> .<span class="hljs-keyword">vim</span><br></code></pre></td></tr></table></figure><p>然后新建文件vimrc</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">vim vimrc</span><br></code></pre></td></tr></table></figure><h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs shell">let mapleader=&quot; &quot;       &quot; 第一行注释的意思是将leader键更改为空格<br>syntax on&quot; 自动语法高亮<br>set number&quot; 显示行号<br>set norelativenumber&quot; 不显示相对行号<br>set cursorline&quot; 突出显示当前行<br>set wrap<br>set showcmd<br><br>set hlsearch&quot; 搜索时启动高亮<br>exec &quot;nohlsearch&quot;<br>set incsearch&quot; <br>set ignorecase&quot; 搜索时忽略大小写<br>set smartcase<br><br>set nocompatible&quot; 保证使用流畅<br>filetype on<br>filetype indent on<br>filetype plugin on<br>filetype plugin indent on  &quot; 这四行是硬性要求,识别不同的文件格式<br>set mouse=a &quot; 让vim可以使用鼠标<br>set encoding=utf-8&quot; 支持中文<br>let &amp;t_ut=&#x27; &#x27;&quot; 改变有些终端可能配色不对的问题<br><br>set expandtab           &quot; 用向上的箭头将窗口向上移5个单位<br>set tabstop=2<br>set shiftwidth=2<br>set softtabstop=2<br><br>&quot; 可以显示空格<br>set listchars=tab:▸\ ,trail:▫<br>set scrolloff=5<br>&quot; 缩进选项<br>set tw=0<br>set indentexpr=<br><br>set backspace=indent,eol,start        &quot; 这行的作用是能让行首back时回到行尾<br>set foldmethod=indent<br>set foldlevel=99<br>let &amp;t_SI = &quot;\&lt;Esc&gt;]50;CursorShape=1\x7&quot;<br>let &amp;t_SR = &quot;\&lt;Esc&gt;]50;CursorShape=2\x7&quot;<br>let &amp;t_EI = &quot;\&lt;Esc&gt;]50;CursorShape=0\x7&quot;<br>set laststatus=2<br>set autochdir<br><br>&quot;作用：关闭vim之后重新打开，光标能回到上一次的位置<br>au BufReadPost * if line(&quot;&#x27;\&quot;&quot;) &gt; 1 &amp;&amp; line(&quot;&#x27;\&quot;&quot;) &lt;= line(&quot;$&quot;) | exe &quot;normal! g&#x27;\&quot;&quot; | endif<br><br><br>noremap &lt;LEADER&gt;&lt;CR&gt; :nohlsearch&lt;CR&gt;<br>&quot; 用空格+回车取消搜索的高亮<br>map s &lt;nop&gt;<br>&quot; <br>map S :w&lt;CR&gt;<br>&quot; 用S来进行保存<br>map Q :q&lt;CR&gt;<br>&quot; 用Q来退出<br>map R :source $MYVIMRC&lt;CR&gt;<br>&quot; 用R来执行这个配置文件让其直接起作用<br><br>map sl :set splitright&lt;CR&gt;:vsplit&lt;CR&gt;<br>&quot; 向右分屏，并且将光标放到右边<br>map sh :set nosplitright&lt;CR&gt;:vsplit&lt;CR&gt;<br>&quot; 向左分屏，并且将光标放到左边<br>map sk :set nosplitbelow&lt;CR&gt;:split&lt;CR&gt;<br>&quot; 向上分屏，并且将光标放到上面<br>map sj :set splitbelow&lt;CR&gt;:split&lt;CR&gt;<br>&quot; 向下分屏，并且将光标放到下面<br><br>map &lt;LEADER&gt;l &lt;C-w&gt;l<br>&quot; 用空格+l将光标切换到右边<br>map &lt;LEADER&gt;j &lt;C-w&gt;k<br>&quot; 用空格+k将光标切换到下面<br>map &lt;LEADER&gt;h &lt;C-w&gt;h<br>&quot; 用空格+j将光标切换到左边<br>map &lt;LEADER&gt;k &lt;C-w&gt;j <br>&quot; 用空格+i将光标切换到上面<br>map &lt;up&gt; :res + 5&lt;CR&gt;<br>&quot; 用向上的箭头将窗口向上移5个单位<br>map &lt;down&gt; :res -5&lt;CR&gt;<br>                        &quot; 用向下的箭头将窗口向下移5个单位<br>map &lt;left&gt; :vertical resize-5&lt;CR&gt;<br>                        &quot; 用向左的箭头将窗口向左移5个单位<br>map &lt;right&gt; :vertical resize+5&lt;CR&gt;<br>&quot; 用向右的箭头将窗口向右移5个单位<br><br>&quot; 进行插件的安装<br>call plug#begin(&#x27;~/.vim/plugged&#x27;)<br><br>Plug &#x27;vim-airline/vim-airline&#x27;<br>&quot; 该插件安装后能在下面出现工作框<br>Plug &#x27;connorholyday/vim-snazzy&#x27;<br>&quot; 该插件安装后使用snazzy字体<br><br>&quot; File navigation<br>Plug &#x27;Xuyuanp/nerdtree-git-plugin&#x27;<br><br>&quot; Taglist<br>Plug &#x27;majutsushi/tagbar&#x27;, &#123; &#x27;on&#x27;: &#x27;TagbarOpenAutoClose&#x27; &#125;<br><br>&quot; Error checking<br>Plug &#x27;w0rp/ale&#x27;<br><br>&quot; Other visual enhancement<br>Plug &#x27;nathanaelkane/vim-indent-guides&#x27;<br>Plug &#x27;itchyny/vim-cursorword&#x27;<br><br><br>&quot; HTML, CSS, JavaScript, PHP, JSON, etc.<br>Plug &#x27;elzr/vim-json&#x27;<br>Plug &#x27;hail2u/vim-css3-syntax&#x27;<br>Plug &#x27;spf13/PIV&#x27;, &#123; &#x27;for&#x27; :[&#x27;php&#x27;, &#x27;vim-plug&#x27;] &#125;<br>Plug &#x27;gko/vim-coloresque&#x27;, &#123; &#x27;for&#x27;: [&#x27;vim-plug&#x27;, &#x27;php&#x27;, &#x27;html&#x27;, &#x27;javascript&#x27;, &#x27;css&#x27;, &#x27;less&#x27;] &#125;<br>Plug &#x27;pangloss/vim-javascript&#x27;, &#123; &#x27;for&#x27; :[&#x27;javascript&#x27;, &#x27;vim-plug&#x27;] &#125;<br>Plug &#x27;mattn/emmet-vim&#x27;<br><br><br>&quot; Other useful utilities<br>Plug &#x27;terryma/vim-multiple-cursors&#x27;<br>Plug &#x27;junegunn/goyo.vim&#x27; &quot; distraction free writing mode<br>Plug &#x27;tpope/vim-surround&#x27; &quot; type ysks&#x27; to wrap the word with &#x27;&#x27; or type cs&#x27;` to change &#x27;word&#x27; to `word`<br>Plug &#x27;godlygeek/tabular&#x27; &quot; type ;Tabularize /= to align the =<br>Plug &#x27;gcmt/wildfire.vim&#x27; &quot; in Visual mode, type i&#x27; to select all text in &#x27;&#x27;, or type i) i] i&#125; ip<br>Plug &#x27;scrooloose/nerdcommenter&#x27; &quot; in &lt;space&gt;cc to comment a line<br><br>&quot; Dependencies<br>Plug &#x27;MarcWeber/vim-addon-mw-utils&#x27;<br>Plug &#x27;kana/vim-textobj-user&#x27;<br>Plug &#x27;fadein/vim-FIGlet&#x27;<br><br>call plug#end()<br><br>&quot; 这里进行snazy的设置<br>color snazzy<br>let g:SnazzyTransparent = 1<br><br></code></pre></td></tr></table></figure><h1 id="Vim插件安装"><a href="#Vim插件安装" class="headerlink" title="Vim插件安装"></a>Vim插件安装</h1><h2 id="1-安装插件支持"><a href="#1-安装插件支持" class="headerlink" title="1. 安装插件支持"></a>1. 安装插件支持</h2><p>在shell中执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -fLo ~/.vim/autoload/plug.vim --create-dirs \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim<br></code></pre></td></tr></table></figure><h2 id="2-安装Vundle插件支持"><a href="#2-安装Vundle插件支持" class="headerlink" title="2. 安装Vundle插件支持"></a>2. 安装Vundle插件支持</h2><h3 id="安装Vundle"><a href="#安装Vundle" class="headerlink" title="安装Vundle:"></a>安装Vundle:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim<br>~/.vimrc<br></code></pre></td></tr></table></figure><h3 id="文件中也添加如下命令："><a href="#文件中也添加如下命令：" class="headerlink" title="文件中也添加如下命令："></a>文件中也添加如下命令：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">set nocompatible<br>filetype off<br>set rtp+=~/.vim/bundle/Vundle.vim<br>call vundle#begin()<br>Plugin &#x27;VundleVim/Vundle.vim&#x27;<br></code></pre></td></tr></table></figure><h3 id="Plugs下面加入你需要的vim-plug"><a href="#Plugs下面加入你需要的vim-plug" class="headerlink" title="Plugs下面加入你需要的vim-plug"></a>Plugs下面加入你需要的vim-plug</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Plugin &#x27;vim-airline/vim-airline&#x27;<br>call vundle#end()<br>filetype plugin indent on<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>Vim</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/48a39831d1f7.html"/>
    <url>/2022/12/48a39831d1f7.html</url>
    
    <content type="html"><![CDATA[<h3 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1 基本概念"></a>1 基本概念</h3><h2 id="双括号结构"><a href="#双括号结构" class="headerlink" title="双括号结构"></a>双括号结构</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol><li>在双括号结构中，所有表达式可以像C语言一样，如a++，b–等</li><li>在双括号结构中，所有变量可以不加入：”$”符号前缀</li><li>双括号可以进行逻辑运算，四则运算</li><li>双括号结构扩展了for，while，if条件测试运算</li><li>支持多个表达式运算，各个表达式之间用逗号分开</li></ol><h3 id="例：依次输出100以内的2的幂值"><a href="#例：依次输出100以内的2的幂值" class="headerlink" title="例：依次输出100以内的2的幂值"></a>例：依次输出100以内的2的幂值</h3><h4 id="while方式"><a href="#while方式" class="headerlink" title="while方式"></a>while方式</h4><p><img src="https://pic.downk.cc/item/5fc7496a394ac5237899b675.png"></p><h4 id="双括号方式"><a href="#双括号方式" class="headerlink" title="双括号方式"></a>双括号方式</h4><p><img src="https://pic.downk.cc/item/5fc7496b394ac5237899b680.png"></p><h2 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h2><h3 id="单引号和双引号的区别"><a href="#单引号和双引号的区别" class="headerlink" title="单引号和双引号的区别"></a>单引号和双引号的区别</h3><p>单引号之间的内容原封不动地指定给了变量(也就是说，对立面的内容不做任何更改，输入什么就是什么，不做操作）<br>双引号取消了空格的作用，特殊符号的含义保留</p><h3 id="反引号与"><a href="#反引号与" class="headerlink" title="反引号与$()"></a>反引号与$()</h3><p>两个方法都可以将一条命令或者某个脚本的执行结果赋给变量。</p><h3 id="方法1-用反引号将命令括起来"><a href="#方法1-用反引号将命令括起来" class="headerlink" title="方法1:用反引号将命令括起来"></a>方法1:用反引号将命令括起来</h3><p>格式为：</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">变量=`命令` <br></code></pre></td></tr></table></figure><h3 id="方法2-用美元符和小括号将命令括起来，"><a href="#方法2-用美元符和小括号将命令括起来，" class="headerlink" title="方法2:用美元符和小括号将命令括起来，"></a>方法2:用美元符和小括号将命令括起来，</h3><p>格式为：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">变量=$(命令) <br></code></pre></td></tr></table></figure><p>例如，将命令date 的运行结果赋给变量A 和B：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">A=`<span class="hljs-built_in">date</span>`  <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$A</span>  <br></code></pre></td></tr></table></figure><p>结果：Sat Apr 16 22:51:26 CST 2011<br>变量A 存放了date 命令的执行结果  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">B=$(<span class="hljs-built_in">date</span>)  <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$B</span>  <br></code></pre></td></tr></table></figure><p>Sat Apr 16 22:57 :47 CST 2011<br>变量B 存放了date 命令的执行结果 </p><h2 id="运行路径"><a href="#运行路径" class="headerlink" title="运行路径"></a>运行路径</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!bin/bash</span> <br></code></pre></td></tr></table></figure><p>井号(#)加感叹号(!)用作shell命令的完全路径：<br>显示后期命令以哪种shell来执行</p><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>shell有很多种<br><img src="https://pic.downk.cc/item/5fc7496b394ac5237899b68f.jpg"><br>最常用的就是bin目录下的bash（mac上较常用的是zsh）</p><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">This is what a example looks like</span><br></code></pre></td></tr></table></figure><p>这是注释，执行时被忽略</p><h2 id="文件名"><a href="#文件名" class="headerlink" title="文件名"></a>文件名</h2><p>shell程序一般以.sh作为结尾</p><h2 id="创建shell程序的步骤"><a href="#创建shell程序的步骤" class="headerlink" title="创建shell程序的步骤"></a>创建shell程序的步骤</h2><ol><li>创建包含命令和控制文件的shell文件</li><li>修改这个文件的权限使他可运行<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod u+x<br></code></pre></td></tr></table></figure></li><li>执行<br>.&#x2F;example.sh或者绝对路径（例如root&#x2F;test&#x2F;example.sh)</li></ol><h1 id="2-变量"><a href="#2-变量" class="headerlink" title="2 变量"></a>2 变量</h1><h2 id=""><a href="#" class="headerlink" title="$?"></a>$?</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>$?表示上一条指令返回的结果：若正常结束则为0，非正常结束则为1</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>例如指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls<br></code></pre></td></tr></table></figure><p>那么一定返回0（正常结束）,因为ls不存在非正常返回<br>若</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> a.txt<br></code></pre></td></tr></table></figure><p>并且a.txt不存在的话，则返回1.</p><p><img src="https://pic.downk.cc/item/5fc74b84394ac523789ac9e2.jpg"></p><h2 id="shift使用"><a href="#shift使用" class="headerlink" title="shift使用"></a>shift使用</h2><p>#shift命令:参数左移指令<br>每执行一次，参数序列顺次左移一个位置，$#的值减1，用于分别处理每个参数，移动出去的参数，不能再用</p><p><img src="https://pic.downk.cc/item/5fc74a0d394ac523789a3292.jpg"></p><h2 id="临时变量和永久变量"><a href="#临时变量和永久变量" class="headerlink" title="临时变量和永久变量"></a>临时变量和永久变量</h2><h3 id="临时变量"><a href="#临时变量" class="headerlink" title="临时变量"></a>临时变量</h3><p>临时变量是shell内部定义的，使用范围仅限于定义它的程序，对其他程序不可见。例如用户自定义变量，</p><h4 id="用户自定义变量"><a href="#用户自定义变量" class="headerlink" title="用户自定义变量"></a>用户自定义变量</h4><p>由字母或下划线大头。由字母、数字和下划线组成，并且大小写字母意义不同，变量名长度没有限制。<strong>使用</strong>变量值时，要在变量名前加上前缀”$”,通过&#x3D;进行变量的<strong>赋值</strong>。</p><h5 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h5><p>赋值时两边不能有空格，可以将表达式的结果赋值给变量。<br>例如：<br><img src="https://pic.downk.cc/item/5fc74abf394ac523789a7d11.jpg"><br><img src="https://pic.downk.cc/item/5fc74abf394ac523789a7d21.jpg"></p><h5 id="列出所有变量"><a href="#列出所有变量" class="headerlink" title="列出所有变量"></a>列出所有变量</h5><p>使用set命令：<br><img src="https://pic.downk.cc/item/5fc74abf394ac523789a7d37.jpg"><br>内容非常多</p><h5 id="查看某个变量的值"><a href="#查看某个变量的值" class="headerlink" title="查看某个变量的值"></a>查看某个变量的值</h5><p>用set | grep XX 命令<br><img src="https://pic.downk.cc/item/5fc74abf394ac523789a7d46.jpg"></p><h5 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h5><p>unset命令<br><img src="https://pic.downk.cc/item/5fc74abf394ac523789a7d57.jpg"></p><h3 id="永久变量"><a href="#永久变量" class="headerlink" title="永久变量"></a>永久变量</h3><p>是环境变量，其值不随shell脚本的执行结束而消失  </p><h5 id="例如："><a href="#例如：" class="headerlink" title="例如："></a>例如：</h5><p><img src="https://pic.downk.cc/item/5fc74abf394ac523789a7d60.jpg"></p><h2 id="位置变量和特殊变量"><a href="#位置变量和特殊变量" class="headerlink" title="位置变量和特殊变量"></a>位置变量和特殊变量</h2><h3 id="1-位置变量"><a href="#1-位置变量" class="headerlink" title="1. 位置变量"></a>1. 位置变量</h3><p>Shell解释执行用户的命令时，将命令行的第一个字作为命令名，而其他字作为参数。由出现在命令行上的位置确定的参数称为位置参数。<br>位置变量：使用$N来表示<br>例：<br>.&#x2F;example.sh file1 file2 file3<br>$0：这个程序的文件名example.sh<br>$n：这个程序的第n个参数，n&#x3D;1..N</p><h3 id="2-特殊变量"><a href="#2-特殊变量" class="headerlink" title="2. 特殊变量"></a>2. 特殊变量</h3><p>有些变量时一开始执行Script脚本时就会设定，且不能被修改，但我们不叫它只读的系统变量，而叫他特殊变量。这些变量当一个执行时就有了，以下是一些特殊变量：<br>$* 程序的所有参数<br>$# 这个程序的参数个数<br>$$ 这个程序的PID<br>$! 执行上一个后台程序的PID<br>$? 执行上一个指令的返回值<br>$_ 在此之前执行的命令或者脚本的最后一个参数</p><h4 id="特殊变量举例"><a href="#特殊变量举例" class="headerlink" title="特殊变量举例"></a>特殊变量举例</h4><p><img src="https://pic.downk.cc/item/5fc74b84394ac523789ac9e9.jpg"></p><h4 id="举例：变量在shell中的使用"><a href="#举例：变量在shell中的使用" class="headerlink" title="举例：变量在shell中的使用"></a>举例：变量在shell中的使用</h4><p><img src="https://pic.downk.cc/item/5fc74b84394ac523789ac9f5.jpg"></p><h1 id="3-语法"><a href="#3-语法" class="headerlink" title="3 语法"></a>3 语法</h1><h2 id="test测试语句"><a href="#test测试语句" class="headerlink" title="test测试语句"></a>test测试语句</h2><h3 id="测试字符串"><a href="#测试字符串" class="headerlink" title="测试字符串"></a>测试字符串</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">test </span>str1==str2 是否相等<br><span class="hljs-keyword">test </span>str1!=str2 是否不相等<br><span class="hljs-keyword">test </span>str1 测试字符串是否不空<br><span class="hljs-keyword">test </span>-n str1 <br><span class="hljs-keyword">test </span>-z str1<br></code></pre></td></tr></table></figure><h3 id="测试正数："><a href="#测试正数：" class="headerlink" title="测试正数："></a>测试正数：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">test ini1 -eq ini2   测试是否相等<br>test int1 -ge int2   测试int1是否大于等于（ge，greater or equal)int2<br>test int1 -gt int2   测试int1是否大于int2<br>test int1 -le int2   测试int1是否小于等于int2<br>test int1 -lt int2   测试int1是否小于int2<br>test int1 -ne int2   测试int1是否不等于int2<br></code></pre></td></tr></table></figure><p>注意：<br>也可以省略test</p><h3 id="文件测试："><a href="#文件测试：" class="headerlink" title="文件测试："></a>文件测试：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">test -d file # 测试是否为目录<br>test -f file # 测试是否为文件<br>test -x file # 测试是否可执行<br>test -r file # 测试是否可读<br>test -w file # 测试是否可写<br>test -e file # 测试文件是否存在<br>test -s file # 测试大小是否为空，是否为空文件<br></code></pre></td></tr></table></figure><h2 id="算术表达式"><a href="#算术表达式" class="headerlink" title="算术表达式"></a>算术表达式</h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><p>对整数型变量进行算术运算</p><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>运算符之间要有空格<br><img src="https://pic.downk.cc/item/5fc74c09394ac523789b0426.jpg"></p><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><p><img src="https://pic.downk.cc/item/5fc74c09394ac523789b0430.jpg"></p><h4 id="注意：-2"><a href="#注意：-2" class="headerlink" title="注意："></a>注意：</h4><p>1.在这里是用的是反引号，不是单引号或者双引号，这样才能使用的是计算出来的结果<br>2.expr中间的所有符号都必须有空格</p><h3 id="反引号和-的区别"><a href="#反引号和-的区别" class="headerlink" title="反引号和$()的区别"></a>反引号和$()的区别</h3><p>反引号是使用后面表达式计算出来的结果<br>$()表示的是整个表达式</p><h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><h3 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h3><p>流控制语句 适用于多分支</p><h4 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h4><p><img src="https://pic.downk.cc/item/5fc74c91394ac523789b4147.jpg"><br>最后的esac是case的倒过来写</p><h3 id="if控制语句"><a href="#if控制语句" class="headerlink" title="if控制语句"></a>if控制语句</h3><h4 id="if语法"><a href="#if语法" class="headerlink" title="if语法"></a>if语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">if 条件 ;then<br>语句<br>fi<br></code></pre></td></tr></table></figure><h4 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h4><p><img src="https://pic.downk.cc/item/5fc74c91394ac523789b4156.jpg"></p><h4 id="if-x2F-else语法"><a href="#if-x2F-else语法" class="headerlink" title="if&#x2F;else语法"></a>if&#x2F;else语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">if 条件; then<br>语句1<br>else<br>语句2<br>fi<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc74c91394ac523789b416d.jpg"></p><h4 id="多条件联合"><a href="#多条件联合" class="headerlink" title="多条件联合"></a>多条件联合</h4><p>-a 或 &amp;&amp; :逻辑与<br>-o 或 ||：逻辑或</p><p>更复杂的if语句：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">if 条件1 ; then<br>   语句1<br>elif 条件2 ; then<br>   语句2<br>else <br>   语句3<br>fi<br></code></pre></td></tr></table></figure><h4 id="举例：判断文件类型"><a href="#举例：判断文件类型" class="headerlink" title="举例：判断文件类型"></a>举例：判断文件类型</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -lt 1 ];<span class="hljs-keyword">then</span></span><br>    echo &quot;A argument is needed.&quot;<br>    exit 1<br>fi<br><br>if ! [ -e $1 ];then<br>    echo &quot;No such file or directory.&quot;<br>    exit 2<br>fi<br><br>if [ -f $1 ];then<br>    echo &quot;Common file&quot;<br>elif [ -d $1 ];then<br>    echo &quot;Directory&quot;<br>elif [ -L $1 ];then<br>    echo &quot;Symbolic link&quot;<br>elif [ -b $1 ];then<br>    echo &quot;block special file&quot;<br>elif [  -c $1 ];then<br>    echo &quot;character special file&quot;<br>elif [  -S $1 ];then<br>    echo &quot;Socket file&quot;<br>else<br>    echo &quot;Unknow&quot;<br>fi<br></code></pre></td></tr></table></figure><h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><h3 id="continue和break"><a href="#continue和break" class="headerlink" title="continue和break"></a>continue和break</h3><p>break+continue用法和其他语言差不多：</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p><img src="https://pic.downk.cc/item/5fc74d78394ac523789ba123.jpg"></p><h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><p><img src="https://pic.downk.cc/item/5fc74d78394ac523789ba131.jpg"></p><h3 id="for…done格式"><a href="#for…done格式" class="headerlink" title="for…done格式"></a>for…done格式</h3><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">for 变量 in 变量群<br>do<br>   xxx<br>done<br></code></pre></td></tr></table></figure><p><img src="https://pic.downk.cc/item/5fc74d78394ac523789ba141.jpg"></p><h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><p><img src="https://pic.downk.cc/item/5fc74d78394ac523789ba154.jpg"></p><h2 id="4-文件类型"><a href="#4-文件类型" class="headerlink" title="4 文件类型"></a>4 文件类型</h2><p>-z：是否是合格文件<br>-e：文件是否存在<br>-f：是否是一个普通文件<br>-L：是否是一个软链接文件<br>-b：是否是一个块设备文件<br>-c：是否是一个字符设备文件<br>-p：是否是一个管道文件<br>-S：是否是一个套接字文件<br>-s：判断内容是否为空</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell">if [ -z $filename ]<br>then<br>    echo -e &quot;错误，请输入文件！&quot;<br>    exit 222<br>fi<br>if [ ! -e $filename ]<br>then<br>    echo &quot;你输入的文件不存在&quot;<br>fi<br>if [ -f $filename ]<br>then<br>    echo &quot;你输入的文件存在；并且是一个普通文件&quot;<br>fi<br>if [ -d $filename ]<br>then<br>    echo -e &quot;你输入的文件存在；并且是一个目录&quot;<br>fi<br>if [ -L $filename ]<br>then<br>    echo -e &quot;你输入的文件存在；并且是一个软链接文件&quot; <br>fi<br>if [ -b $filename ]<br>then<br>    echo -e &quot;你输入的文件存在；并且是一个块设备文件&quot;<br>fi<br>if [ -c $filename ]<br>then<br>    echo -e &quot;你输入的文件存在；并且是一个字符设备文件&quot;<br>fi<br>if [ -p $filename ]<br>then<br>    echo -e &quot;你输入的文件存在；并且是一个管道文件&quot;<br>fi<br>if [ -S $filename ]<br>then<br>    echo -e &quot;你输入的文件存在；并且是一个套接字文件&quot;<br>fi<br></code></pre></td></tr></table></figure><h1 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h1><h2 id="MURI-Escape-amp"><a href="#MURI-Escape-amp" class="headerlink" title="-MURI Escape, &amp;_"></a>-MURI Escape, &amp;_</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">a=<span class="hljs-constructor">$(<span class="hljs-params">echo</span> <span class="hljs-string">&quot;$url&quot;</span> | <span class="hljs-params">perl</span> -MURI::Escape -<span class="hljs-params">ne</span> &#x27;<span class="hljs-params">chomp</span>;<span class="hljs-params">print</span> <span class="hljs-params">uri_escape</span>($<span class="hljs-params">_</span>)</span>,<span class="hljs-string">&quot;\n&quot;</span>&#x27;)<br></code></pre></td></tr></table></figure><p>-MURI::Escape是URL模块。<br>该模块导出两个函数：<br>uri_escape:该函数执行URL转义，也就是URL编码，将网址编码<br>uri_unescape:该函数执行URL转义，也就是URL解码，将编码得到的网址进行解码</p><p>$_ 表示在此之前执行的命令或者脚本的最后一个参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> “<span class="hljs-variable">$url</span><span class="hljs-string">&quot; | perl -MURI::Escape -ne &#x27;chomp;print uri_escape(<span class="hljs-variable">$_</span>),&quot;</span>\n<span class="hljs-string">&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>作用：<br>将URL中的保留字符转换为其百分比编码的对应字符。</p><p>假设定义了一个变量为file：<br>代码如下:<br>file&#x3D;&#x2F;dir1&#x2F;dir2&#x2F;dir3&#x2F;my.file.txt<br>可以用${ }分别替换得到不同的值：</p><h3 id="file-x2F"><a href="#file-x2F" class="headerlink" title="${file#*&#x2F;}"></a>${file#*&#x2F;}</h3><p>作用：删掉第一个 &#x2F; 及其左边的字符串：<br>结果：dir1&#x2F;dir2&#x2F;dir3&#x2F;my.file.txt</p><h3 id="file-x2F-1"><a href="#file-x2F-1" class="headerlink" title="${file##*&#x2F;}"></a>${file##*&#x2F;}</h3><p>作用：删掉最后一个 &#x2F;  及其左边的字符串<br>结果：my.file.txt</p><h4 id="举例-3"><a href="#举例-3" class="headerlink" title="举例"></a>举例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;--hello--&quot; | sed &#x27;s/-//g&#x27;<br></code></pre></td></tr></table></figure><p>在这里是将-全部去掉（因为g前面的两个&#x2F;中间没有任何内容），若是sed ‘s&#x2F;-&#x2F;a&#x2F;g’就是将所有-替换成a</p><h3 id="file"><a href="#file" class="headerlink" title="${file#*.}"></a>${file#*.}</h3><p>作用：删掉第一个.及其左边的字符串<br>结果：file.txt</p><h3 id="file-1"><a href="#file-1" class="headerlink" title="${file##*.}"></a>${file##*.}</h3><p>作用：删掉最后一个.及其左边的字符串<br>结果：txt</p><h3 id="file-x2F-2"><a href="#file-x2F-2" class="headerlink" title="${file%&#x2F;*}"></a>${file%&#x2F;*}</h3><p>作用：删掉最后一个&#x2F;及其右边的字符串<br>结果：&#x2F;dir1&#x2F;dir2&#x2F;dir3</p><h3 id="file-x2F-3"><a href="#file-x2F-3" class="headerlink" title="${file%%&#x2F;*}"></a>${file%%&#x2F;*}</h3><p>作用：删掉第一个&#x2F;及其右边的字符串<br>结果：(空值)</p><h3 id="file-2"><a href="#file-2" class="headerlink" title="${file%.*}"></a>${file%.*}</h3><p>作用：删掉最后一个.及其右边的字符串<br>结果：&#x2F;dir1&#x2F;dir2&#x2F;dir3&#x2F;my.file</p><h3 id="file-3"><a href="#file-3" class="headerlink" title="${file%%.*}"></a>${file%%.*}</h3><p>作用：删掉第一个.及其右边的字符串<br>结果：&#x2F;dir1&#x2F;dir2&#x2F;dir3&#x2F;my</p><p>#记忆的方法为：<br>#是去掉左边（键盘上#在$的左边）</p><p>%是去掉右边（键盘上%在$的右边）</p><p>#匹配<br>单一符号是最小匹配；两个符号是最大匹配</p><h2 id="grep-x2F-dev-x2F-null"><a href="#grep-x2F-dev-x2F-null" class="headerlink" title="$, grep, &#x2F;dev&#x2F;null"></a>$, grep, &#x2F;dev&#x2F;null</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo $h|grep Authorization &gt; /dev/null<br></code></pre></td></tr></table></figure><p>&#x2F;dev&#x2F;null:<br>这是一个特殊设备，称为空设备，它会丢弃一切写入它的数据，但是读取它则会抛出错误。<br>在shell中常用它来表示放弃执行的结果，<br>这行的作用是值需要得到</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo $h | grep Autorization<br></code></pre></td></tr></table></figure><p>的结果，而不需要将其输出，也就是看$h中是否存在Autorization，作为接下来的$?的输入，如果存在返回0，如果不存在则返回1.</p><h2 id="得到最后一级目录名"><a href="#得到最后一级目录名" class="headerlink" title="得到最后一级目录名"></a>得到最后一级目录名</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">last_dir=`echo $dir|awk -F&#x27;/&#x27; &#x27;&#123;print $NF&#125;&#x27;`<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>Shell</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/b9eab08fc488.html"/>
    <url>/2022/12/b9eab08fc488.html</url>
    
    <content type="html"><![CDATA[<h1 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h1><h2 id="scp定义"><a href="#scp定义" class="headerlink" title="scp定义"></a>scp定义</h2><p>scp可以实现服务器与服务器之间的数据拷贝（from server1 to server2） </p><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r $pdir/$fname $user@hadoop$host:$pdir/$fname <br></code></pre></td></tr></table></figure><h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407090837.png" style="zoom:50%;" /><h2 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h2><ol><li>本机数据拷贝到别的服务器 </li><li>从别的服务器将数据拷贝到本机 </li><li>将某台非本机的服务器的数据拷贝到另一台主机</li></ol><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><p>在hadoop100上，将hadoop100中&#x2F;home&#x2F;hadoop_learning目录下的软件拷贝到hadoop102上。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r hadoop_learning/ root@hadoop101:/home/hadoop_learning<br></code></pre></td></tr></table></figure><p> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407090953.png"></p><p>结果：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091011.png" style="zoom:50%;" /><p>注意：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091033.png" style="zoom:50%;" /><h3 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h3><p>在hadoop102上从hadoop100处拉取&#x2F;home&#x2F;hadoop_learning下的数据 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo scp -r coachhe@hadoop100:/home/hadoop_learning /home/hadoop_learning<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091130.png"></p><p>结果：</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091202.png" style="zoom:50%;" /><h3 id="案例3"><a href="#案例3" class="headerlink" title="案例3"></a>案例3</h3><p>在hadoop101上将hadoop100的数据拷贝到hadoop102 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r coachhe@hadoop100:/home/hadoop_learning root@hadoop102:/home/hadoop_learning2<br></code></pre></td></tr></table></figure><p> <img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091243.png"></p><h1 id="远程同步工具rsync"><a href="#远程同步工具rsync" class="headerlink" title="远程同步工具rsync"></a>远程同步工具rsync</h1><h2 id="rsync和scp的区别"><a href="#rsync和scp的区别" class="headerlink" title="rsync和scp的区别"></a>rsync和scp的区别</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>rsync主要用于备份和镜像。具有速度快，避免复制相同内容和支持符号链接的优点。 </p><h3 id="和scp的区别"><a href="#和scp的区别" class="headerlink" title="和scp的区别"></a>和scp的区别</h3><p>用rsync做文件的复制要比scp速度快，rsync只对差异文件做更新，scp是把所有文件都复制过去。 </p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rsync -rvl $pdir/$fname $user@hadoop$host:$host:$pdir/$fname<br></code></pre></td></tr></table></figure><h3 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h3><table><thead><tr><th>选项</th><th>功能</th></tr></thead><tbody><tr><td>-r</td><td>递归</td></tr><tr><td>-v</td><td>显示复制过程</td></tr><tr><td>-l</td><td>拷贝符号连接</td></tr></tbody></table><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>将hadoop100机器上的&#x2F;home&#x2F;newdisk目录同步到hadoop101服务器root目录下的&#x2F;home&#x2F;newdisk下。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo rsync -rvl /home/newdisk/ root@hadoop101:/home/newdisk <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091442.png"></p><h1 id="编写集群分发脚本xsync"><a href="#编写集群分发脚本xsync" class="headerlink" title="编写集群分发脚本xsync"></a>编写集群分发脚本xsync</h1><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span> <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">1 获取输入参数个数，如果没有参数则直接退出</span> <br>pcount=$# <br>if((pcount==0)); then <br>echo no args; <br>exit; <br>fi <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2 获取文件名称</span> <br>p1=$1 <br>fname=`basename $p1` #这里就是拿到最终文件的名称，/opt/module就是module <br>echo fname=$fname <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3 获取上级目录到绝对路径</span> <br>pdir=`cd -P $(dirname $p1); pwd` #这里是得到文件的路径 <br>echo pdir=$pdir <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4 获取当前用户名称</span> <br>user=`whoami` #也就是coachhe <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">5 循环</span> <br>for((host=101;host&lt;103;host++)); do <br>echo -------- hadoop$host --------- <br>rsync -rvl $pdir/$fname root@hadoop$host:$pdir <br>done <br></code></pre></td></tr></table></figure><h2 id="脚本执行"><a href="#脚本执行" class="headerlink" title="脚本执行"></a>脚本执行</h2><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091638.png"></p><h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210407091655.png" style="zoom:50%;" />]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>Command</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/5b48cccef9c6.html"/>
    <url>/2022/12/5b48cccef9c6.html</url>
    
    <content type="html"><![CDATA[<p>1、捕获接口参数</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>-i <interface></td><td>接口名或网卡编号 (默认: 第一个非环回接口)</td></tr><tr><td>-f <capture filter></td><td>使用libpcap过滤表达式进行包过滤</td></tr><tr><td>-s <snaplen></td><td>设置每个抓包的大小，默认为262144</td></tr><tr><td>-p</td><td>不使用混杂模式抓捕报文（即只抓取与本机有关的流量）</td></tr><tr><td>-I</td><td>如果支持则启用镜像模式</td></tr><tr><td>-B<buffer size></td><td>内核缓存大小 (默认4MB)</td></tr><tr><td>-y <link type></td><td>链路层类型 (默认为找到的第一个协议)</td></tr><tr><td>-D</td><td>列出所有接口并退出</td></tr><tr><td>-L</td><td>列出所有接口链路层类型并退出（供-y参数使用）</td></tr></tbody></table><p>2、捕获终止条件参数</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>-c <packet count></td><td>捕获到n个包时停止 (默认不限，持续捕获)</td></tr><tr><td>-a <autostop cond.> … duration:NUM</td><td>捕获进行NUM后停止</td></tr><tr><td>-a <autostop cond.> … filesize:NUM</td><td>输出文件大于NUM KB后停止</td></tr><tr><td>-a <autostop cond.> … files:NUM</td><td>输出超过NUM个文件后停止</td></tr></tbody></table><p>3、捕获输出参数</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>-b <ringbuffer opt.> … duration:NUM</td><td>在NUM秒后写入下一个文件（文件名由-w参数决定）</td></tr><tr><td>-b <ringbuffer opt.> … interval:NUM</td><td>创建时间间隔NUM秒</td></tr><tr><td>-b <ringbuffer opt.> … filesize:NUM</td><td>在文件大于NUM KB后写入下一个文件</td></tr><tr><td>-b <ringbuffer opt.> … files:NUM</td><td>循环缓存: 在NUM个文件后替换早前的</td></tr></tbody></table><p>4、读取文件参数</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>-r <infile></td><td>设置需要读取的文件名及路径</td></tr></tbody></table><p>5、分析处理参数</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>-2</td><td>执行两次分析</td></tr><tr><td>-R <read filter></td><td>包的读取过滤器，可以在wireshark的filter语法上查看；在wireshark的视图-&gt;过滤器视图，在这一栏点击表达式，就会列出来对所有协议的支持。(例如可以过滤)</td></tr><tr><td>-Y <display filter></td><td>使用读取过滤器的语法，在单次分析中可以代替-R选项;</td></tr><tr><td>-n:</td><td>禁止所有地址名字解析（默认为允许所有）</td></tr><tr><td>-N <name resolve flags> :</td><td>启用某一层的地址名字解析。“m”代表MAC层，“n”代表网络层，“t”代表传输层，“C”代表当前异步DNS查找。如果-n和-N参数同时存在，-n将被忽略。如果-n和-N参数都不写，则默认打开所有地址名字解析。</td></tr><tr><td>-d <layer_type>&#x3D;&#x3D;,<decode_as_protocol> …</td><td>将指定的数据按有关协议解包输出,如要将tcp 8888端口的流量按http解包，应该写为“-d tcp.port&#x3D;&#x3D;8888,http”;tshark -d. 可以列出所有支持的有效选择器。</td></tr></tbody></table><p>6、输出参数</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>&#96;-w &lt;outfile</td><td>-&gt;&#96;</td></tr><tr><td>-C <config profile></td><td>启动时使用指定的配置文件</td></tr><tr><td>-F <output file type></td><td>设置输出文件格式类型, 默认为pcapng格式 “-F”留空则列出所有的文件类型</td></tr><tr><td>-V</td><td>输出中增加报文层次树(包详细信息)</td></tr><tr><td>-O <protocols></td><td>仅显示以下协议的详细信息，逗号分割</td></tr><tr><td>-P</td><td>每写入一个文件后进行包情况汇总</td></tr><tr><td>-S <separator></td><td>数据包之间的行分割符</td></tr><tr><td>-x</td><td>输出中增加16进制和ascii字符信息(报文按字节显示)</td></tr><tr><td>&#96;-T pdml</td><td>ps</td></tr><tr><td>-j <protocolfilter></td><td>&#96;当-T ek</td></tr><tr><td>-J <protocolfilter></td><td>&#96;当 -T ek</td></tr><tr><td>-e <field></td><td>当 -T fields 设置时打印字段 (如tcp.port,_ws.col.Info) 此选项可以多个用于打印多个字段<br/>-E<fieldsoption>&#x3D;当-Tfields选项启用时用于输出配置:</td></tr></tbody></table><p>7、其他</p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>-h</td><td>显示帮助</td></tr><tr><td>-v</td><td>显示版本</td></tr><tr><td>-o <name>: …</td><td>覆盖配置项</td></tr><tr><td>-K <keytab></td><td>使用keytab文件用于解密kerberos</td></tr><tr><td>-G [report]</td><td>生成一份或多份报告，默认report&#x3D;“fields”,使用”-G help”获取更多信息</td></tr></tbody></table><p>​<br>​<br>​<br>​</p><hr>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>计算机网络</category>
      
      <category>TCP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/78294053fe5b.html"/>
    <url>/2022/12/78294053fe5b.html</url>
    
    <content type="html"><![CDATA[<h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>搭建一个“最小化”的环境，在这个环境里仅有 HTTP 协议的两个端点：请求方和应答方，去除一切多余的环节，从而可以抓住重点，快速掌握 HTTP 的本质。</p><h1 id="软件需要"><a href="#软件需要" class="headerlink" title="软件需要"></a>软件需要</h1><img src="https://static001.geekbang.org/resource/image/85/0b/85cadf90dc96cf413afaf8668689ef0b.png?wh=3000*1681" alt="img" style="zoom: 25%;" /><p>简单说一下这个“最小化”环境用到的应用软件：</p><ul><li>Wireshark</li><li>Telnet</li><li>OpenResty</li></ul><p><strong>Wireshark</strong> 是著名的网络抓包工具，能够截获在 TCP&#x2F;IP 协议栈中传输的所有流量，并按协议类型、地址、端口等任意过滤，功能非常强大，是学习网络协议的必备工具。</p><p>它就像是网络世界里的一台“高速摄像机”，把只在一瞬间发生的网络传输过程如实地“拍摄”下来，事后再“慢速回放”，让我们能够静下心来仔细地分析那一瞬到底发生了什么。</p><p><strong>Telnet</strong> 是一个经典的虚拟终端，基于 TCP 协议远程登录主机，我们可以使用它来模拟浏览器的行为，连接服务器后手动发送 HTTP 请求，把浏览器的干扰也彻底排除，能够从最原始的层面去研究 HTTP 协议。</p><p><strong>OpenResty</strong> 你可能比较陌生，它是基于 Nginx 的一个“强化包”，里面除了 Nginx 还有一大堆有用的功能模块，不仅支持 HTTP&#x2F;HTTPS，还特别集成了脚本语言 Lua 简化 Nginx 二次开发，方便快速地搭建动态网关，更能够当成应用容器来编写业务逻辑。选择 OpenResty 而不直接用 Nginx 的原因是它相当于 Nginx 的“超集”，功能更丰富，安装部署更方便。我也会用 Lua 编写一些服务端脚本，实现简单的 Web 服务器响应逻辑，方便实验。</p><h1 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h1><p>在这里我使用了<code>Ubuntu20.04LTS</code>环境，只需执行以下几个命令即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装导入GPG公钥所需的依赖包：</span><br>sudo apt-get -y install --no-install-recommends wget gnupg ca-certificates<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">导入GPG密钥：</span><br>wget -O - https://openresty.org/package/pubkey.gpg | sudo apt-key add -<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装add-apt-repository命令</span><br>sudo apt-get -y install --no-install-recommends software-properties-common<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">添加官方仓库：</span><br>sudo add-apt-repository -y &quot;deb http://openresty.org/package/ubuntu $(lsb_release -sc) main&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">更新APT索引：</span><br>sudo apt-get update<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装 OpenResty</span><br>sudo apt-get -y install openresty<br></code></pre></td></tr></table></figure><p>全部完成后，OpenResty 会安装到“&#x2F;usr&#x2F;local&#x2F;openresty”目录里，可以用它自带的命令行工具“resty”来验证是否安装成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">resty -v</span><br>resty 0.23<br>nginx version: openresty/1.15.8.2<br>built with OpenSSL 1.1.0k  28 May 2019<br></code></pre></td></tr></table></figure><p>有了 OpenResty，就可以从 GitHub 上获取 http_study 项目的源码了，用“git clone”是最简单快捷的方法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/chronolaw/http_study<br></code></pre></td></tr></table></figure><p>在 Git 仓库的“www”目录，为 Linux 环境补充了一个 Shell 脚本“run.sh”，作用和 Windows 下的 start.bat、stop.bat 差不多，可以简单地启停实验环境，后面可以接命令行参数 start&#x2F;stop&#x2F;reload&#x2F;list：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd http_study/www/    #脚本必须在www目录下运行，才能找到nginx.conf<br>./run.sh start        #启动实验环境<br>./run.sh list         #列出实验环境的Nginx进程<br>./run.sh reload       #重启实验环境<br>./run.sh stop         #停止实验环境<br></code></pre></td></tr></table></figure><p>启动 OpenResty 之后，就可以用浏览器或者 curl 来验证课程里的各个测试 URI，但之前不要忘记修改“&#x2F;etc&#x2F;hosts”添加域名解析，例如</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -v &quot;http://127.0.0.1/&quot;<br>curl -v &quot;http://www.chrono.com/09-1&quot;<br>curl -k &quot;https://www.chrono.com/24-1?key=1234&quot;<br>curl -v &quot;http://www.chrono.com/41-1&quot;<br></code></pre></td></tr></table></figure><h1 id="进行抓包"><a href="#进行抓包" class="headerlink" title="进行抓包"></a>进行抓包</h1><p>我们的实验环境运行在本机的 127.0.0.1 上，也就是 loopback“环回”地址。所以，在这里我们执行这条命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tshark -i lo -f &#x27;tcp dst port 80&#x27; -w a.pcapng<br></code></pre></td></tr></table></figure><p>在这里，<code>-i</code>表示指定地址，<code>lo</code>代表回环地址，也就是<code>127.0.0.1</code>，<code>-f</code>代表使用libpcap过滤表达式进行包过滤，这里<code>tcp dst port 80</code>的意识是只捕获80端口的包，<code>-w</code>代表输出的文件名。</p><p>此时会进入一个命令等待的状态：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221016155142982.png" alt="image-20221016155142982"></p><p>然后我们打开另一个连接，去telnet本机的80端口</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221016155217415.png" alt="image-20221016155217415"></p><p>可以看到，执行telnet之后另一个连接处马上出现了变化，说明捕获包成功。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221016155321731.png" alt="image-20221016155321731"></p><p>此时可以看到，出现了一个新文件<code>a.pcapng</code>，这个文件内部就是捕获到的包内容。但是此时都是乱码：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/image-20221016155418050.png" alt="image-20221016155418050"></p><p>需要使用tshark才能进行解析：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@VM-4-5-ubuntu:~/http_study/wireshark# tshark -r 08-1.pcapng <br>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.<br>    1   0.000000    127.0.0.1 → 127.0.0.1    TCP 108 52085 → 80 [SYN] Seq=0 Win=64240 Len=0 MSS=65495 WS=256 SACK_PERM=1<br>    2   0.000067    127.0.0.1 → 127.0.0.1    TCP 108 80 → 52085 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=65495 WS=256 SACK_PERM=1<br>    3   0.000149    127.0.0.1 → 127.0.0.1    TCP 84 52085 → 80 [ACK] Seq=1 Ack=1 Win=525568 Len=0<br>    4   0.000558    127.0.0.1 → 127.0.0.1    TCP 108 52086 → 80 [SYN] Seq=0 Win=64240 Len=0 MSS=65495 WS=256 SACK_PERM=1<br>    5   0.000613    127.0.0.1 → 127.0.0.1    TCP 108 80 → 52086 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=65495 WS=256 SACK_PERM=1<br>    6   0.000671    127.0.0.1 → 127.0.0.1    TCP 84 52086 → 80 [ACK] Seq=1 Ack=1 Win=525568 Len=0<br>    7   0.114968    127.0.0.1 → 127.0.0.1    HTTP 848 GET / HTTP/1.1 <br>    8   0.115017    127.0.0.1 → 127.0.0.1    TCP 84 80 → 52085 [ACK] Seq=1 Ack=383 Win=525568 Len=0<br>    9   0.115457    127.0.0.1 → 127.0.0.1    HTTP 1246 HTTP/1.1 200 OK  (text/html)<br>   10   0.115498    127.0.0.1 → 127.0.0.1    TCP 84 52085 → 80 [ACK] Seq=383 Ack=582 Win=524800 Len=0<br>   11   0.650736    127.0.0.1 → 127.0.0.1    HTTP 774 GET /favicon.ico HTTP/1.1 <br>   12   0.650789    127.0.0.1 → 127.0.0.1    TCP 84 80 → 52085 [ACK] Seq=582 Ack=728 Win=525056 Len=0<br>   13   0.650988    127.0.0.1 → 127.0.0.1    HTTP 1540 HTTP/1.1 404 Not Found  (text/html)<br>   14   0.651037    127.0.0.1 → 127.0.0.1    TCP 84 52085 → 80 [ACK] Seq=728 Ack=1310 Win=524288 Len=0<br></code></pre></td></tr></table></figure><p>由于HTTP 协议是运行在 TCP&#x2F;IP 基础上的，依靠 TCP&#x2F;IP 协议来实现数据的可靠传输。所以浏览器要用 HTTP 协议收发数据，首先要做的就是建立 TCP 连接。</p><p>因为我们在地址栏里直接输入了 IP 地址“127.0.0.1”，而 Web 服务器的默认端口是 80，所以浏览器就要依照 TCP 协议的规范，使用“三次握手”建立与 Web 服务器的连接。</p><p>对应到 Wireshark 里，就是最开始的三个抓包，浏览器使用的端口是 52085，服务器使用的端口是 80，经过 SYN、SYN&#x2F;ACK、ACK 的三个包之后，浏览器与服务器的 TCP 连接就建立起来了。（这里就是<strong>三次握手</strong>的发生所在地）</p><p>有了可靠的 TCP 连接通道后，HTTP 协议就可以开始工作了。于是，浏览器按照 HTTP 协议规定的格式，通过 TCP 发送了一个“GET &#x2F; HTTP&#x2F;1.1”请求报文，也就是 Wireshark 里的第四个包。</p><p>随后，Web 服务器回复了第五个包，在 TCP 协议层面确认：“刚才的报文我已经收到了”，不过这个 TCP 包 HTTP 协议是看不见的。</p><p>Web 服务器收到报文后在内部就要处理这个请求。同样也是依据 HTTP 协议的规定，解析报文，看看浏览器发送这个请求想要干什么。它一看，原来是要求获取根目录下的默认文件，好吧，那我就从磁盘上把那个文件全读出来，再拼成符合 HTTP 格式的报文，发回去吧。这就是 Wireshark 里的第六个包“HTTP&#x2F;1.1 200 OK”，底层走的还是 TCP 协议。</p><p>同样的，浏览器也要给服务器回复一个 TCP 的 ACK 确认，“你的响应报文收到了，多谢”，即第七个包。</p><p>这时浏览器就收到了响应数据，但里面是什么呢？所以也要解析报文。一看，服务器给我的是个 HTML 文件，好，那我就调用排版引擎、JavaScript 引擎等等处理一下，然后在浏览器窗口里展现出了欢迎页面。</p><p>这之后还有两个来回，共四个包，重复了相同的步骤。这是浏览器自动请求了作为网站图标的“favicon.ico”文件，与我们输入的网址无关。但因为我们的实验环境没有这个文件，所以服务器在硬盘上找不到，返回了一个“404 Not Found”。</p><p>至此，“键入网址再按下回车”的全过程就结束了。</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>计算机网络</category>
      
      <category>TCP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/087b63fc9298.html"/>
    <url>/2022/12/087b63fc9298.html</url>
    
    <content type="html"><![CDATA[<h1 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h1><h2 id="系统版本"><a href="#系统版本" class="headerlink" title="系统版本"></a>系统版本</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">[root@coachhe-code ~]# uname -srm<br>Linux 3.10.107-1-tlinux2_kvm_guest-0049 x86_64<br></code></pre></td></tr></table></figure><h2 id="Gcc-版本"><a href="#Gcc-版本" class="headerlink" title="Gcc 版本"></a>Gcc 版本</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">[root@coachhe-code TencentKona-11-master]# gcc --version<br>gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-4)<br>Copyright (C) 2018 Free Software Foundation, Inc.<br>This is free software; see the source for copying conditions.  There is NO<br>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br></code></pre></td></tr></table></figure><h2 id="G-版本"><a href="#G-版本" class="headerlink" title="G++ 版本"></a>G++ 版本</h2><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@coachhe-code</span> TencentKona<span class="hljs-number">-11</span>-master]# g++ --version<br>g++ (GCC) <span class="hljs-number">8.5</span>.<span class="hljs-number">0</span> <span class="hljs-number">20210514</span> (Red Hat <span class="hljs-number">8.5</span>.<span class="hljs-number">0</span><span class="hljs-number">-4</span>)<br>Copyright (C) <span class="hljs-number">2018</span> Free Software Foundation<span class="hljs-punctuation">,</span> Inc.<br>This is <span class="hljs-keyword">free</span> software<span class="hljs-comment">; see the source for copying conditions.  There is NO</span><br>warranty<span class="hljs-comment">; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></code></pre></td></tr></table></figure><h2 id="最终-jdk-版本"><a href="#最终-jdk-版本" class="headerlink" title="最终 jdk 版本"></a>最终 jdk 版本</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">[root@coachhe-code bin]# ./java -version<br>openjdk version &quot;11.0.13-internal&quot; 2021-10-19<br>OpenJDK Runtime Environment (build 11.0.13-internal+0-adhoc..TencentKona-11-master)<br>OpenJDK 64-Bit Server VM (build 11.0.13-internal+0-adhoc..TencentKona-11-master, mixed mode)<br></code></pre></td></tr></table></figure><h1 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h1><ol><li><p>下载 jdk11<br>注意我这里是腾讯的 jdk11，不是市面上的 openjdk11，源码下载地址是：<a href="https://github.com/Tencent/TencentKona-11">TencentKona-11</a><br>直接下载之后在本地解压即可。<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211207212049.png"></p></li><li><p>在服务器上安装各种依赖<br>其实没有什么技巧，首先安装</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">yum groupinstall &quot;Development Tools&quot;<br></code></pre></td></tr></table></figure></li></ol><p>然后在源目录下执行</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">bash configure<br></code></pre></td></tr></table></figure><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20211207212438.png"></p><p>然后一直根据提示安装各种依赖就行了。</p><ol start="3"><li>执行 <code>make images</code> 即可</li></ol><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>首先在IDEA中，点击<code>File-&gt;Project Structure</code>，删除现有的SDKs<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203004.png height=500></p><p>然后重新添加我们目录下的SDK<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203150.png height=500><br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203248.png height=500></p><p>此时源码还是只读的，无法进行更改，这是因为这里的源码我们还是默认去系统<code>$JAVA_HOME</code>目录下的src里面找的Java源代码，因为我们还需要将Sourcepath里面的src文件的目录进行修改：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203445.png height=500><br>点击加号之后添加我们自己的openjdk目录：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203537.png height = 500><br>添加之后确认：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809203646.png height = 500></p><p>此时我们就可以进入源码进行修改了，例如最基础的<code>System.out.println()</code>，我们可以进入查看：<br><img src=https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/Redis/20210809204047.png height=500></p><p>修改之后对应文件目录下的src文件就会被更改了，然后重新在源文件目录下<code>make images</code>就可以更新了<br>注意：<code>make images</code>会在原来的基础上增量编译，不会重新编译了</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>jdk</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e14f7304f132.html"/>
    <url>/2022/12/e14f7304f132.html</url>
    
    <content type="html"><![CDATA[<h1 id="Hadoop介绍"><a href="#Hadoop介绍" class="headerlink" title="Hadoop介绍"></a>Hadoop介绍</h1><h2 id="1-定义"><a href="#1-定义" class="headerlink" title="1 定义"></a>1 定义</h2><p>Hadoop是一个由Apache基金会所开发的<strong>分布式系统基础架构</strong></p><h3 id="2-解决问题"><a href="#2-解决问题" class="headerlink" title="2 解决问题"></a>2 解决问题</h3><p><strong>海量数据的存储和海量数据的分析计算</strong>问题。</p><h3 id="3-三大发行版本"><a href="#3-三大发行版本" class="headerlink" title="3 三大发行版本"></a>3 三大发行版本</h3><p>Apache：最基础，对于入门学习最好</p><p>Cloudera：在大型互联网企业中用的较多</p><p>Hortonworks：文档较好</p><h3 id="4-Hadoop的优势"><a href="#4-Hadoop的优势" class="headerlink" title="4 Hadoop的优势"></a>4 Hadoop的优势</h3><ol><li><strong>高可靠性</strong>：Hadoop底层维护了多个副本（默认为3个），所以即使Hadoop某个计算元素或存储出现故障，也不会导致数据的丢失。</li><li><strong>高扩展性</strong>：在集群间分配任务数据，可方便的扩展数以千计的节点。（增加服务器时不用把系统停下来）</li><li><strong>高效性</strong>：在MapReduce的思想下，Hadoop是并行工作的（多个服务器一起计算），以加快任务处理的速度。</li><li><strong>高容错性</strong>：能够自动将失败的任务重新分配。</li></ol><h2 id="5-Hadoop的组成"><a href="#5-Hadoop的组成" class="headerlink" title="5 Hadoop的组成"></a>5 Hadoop的组成</h2><h3 id="Hadoop1-x和2-x的区别"><a href="#Hadoop1-x和2-x的区别" class="headerlink" title="Hadoop1.x和2.x的区别"></a>Hadoop1.x和2.x的区别</h3><table><thead><tr><th>Hadoop1.x的组成</th><th>Hadoop2.x的组成</th></tr></thead><tbody><tr><td>Common（辅助工具）</td><td>Common（辅助工具）</td></tr><tr><td>HDFS（数据存储）</td><td>HDFS（数据存储）</td></tr><tr><td>MapReduce（计算+资源调度）</td><td>Yarn（资源调度）</td></tr></tbody></table><p>1.x中MapReduce需要同时负责计算和资源调度</p><p>2.x中Yarn负责资源调度，MapReduce负责计算</p><h3 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h3><ol><li><strong>NameNode（nn）</strong>: 存储文件的元数据，如文件名，文件目录结构，文件属性（生成时间、副本数、文件权限），以及每个文件的块列表和块所在的DataNode。<br>(相当于是目录)</li><li><strong>DataNoade（dn）</strong>：在本地文件系统存储块数据，以及块数据的校验和。具体的内容</li><li><strong>Secondary NameNode（2nn）</strong>： 用来监控HDFS状态的辅助后台程序，每隔一段时间获取HDFS元数据的快照。<br>(用来辅助NameNode工作)</li></ol><h3 id="YARN架构概述"><a href="#YARN架构概述" class="headerlink" title="YARN架构概述"></a>YARN架构概述</h3><p>Resource Manager相当于<strong>部门经理</strong>，负责整个部门的运行<br>NodeManager是单节点的负责对象。<br>App Mstr相当于<strong>项目经理</strong>，负责某个项目。负责在集群上某一个任务的协调<br>Container是YARN中的资源抽象，它封装了某个节点的多维度资源，如内存、CPU、磁盘、网络等（<strong>虚拟化技术</strong>）  </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Flink/20201210153155.png" style="zoom:80%;" /><h3 id="MapReduce架构概述"><a href="#MapReduce架构概述" class="headerlink" title="MapReduce架构概述"></a>MapReduce架构概述</h3><p>MapReduce将计算过程分为两个阶段：Map和Reduce<br>（1） Map阶段并行处理输入数据<br>（2） Reduce阶段对Map结果进行汇总</p><h1 id="Hadoop运行环境搭建"><a href="#Hadoop运行环境搭建" class="headerlink" title="Hadoop运行环境搭建"></a>Hadoop运行环境搭建</h1><h2 id="1-虚拟机环境准备"><a href="#1-虚拟机环境准备" class="headerlink" title="1 虚拟机环境准备"></a>1 虚拟机环境准备</h2><h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p><strong>第一步，更改网卡设置</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190137.png" style="zoom:50%;" /><p>同时记录下mac地址，为00:0c:29:d2:60:7a</p><p><strong>第二步：更改网络设置</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190206.png" style="zoom:50%;" /><p><strong>第三步：更改主机名</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190228.png" style="zoom:50%;" /><p><strong>第四步：添加映射</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190256.png" style="zoom:50%;" /><p><strong>第五步：更改网络配置</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190317.png" style="zoom:50%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190348.png" style="zoom:50%;" /><p>（注意！！mac是.1不是.2）</p><p><strong>总结</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190412.png" style="zoom:50%;" /><p><strong>结果</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190432.png" style="zoom: 50%;" /><h3 id="用户配置"><a href="#用户配置" class="headerlink" title="用户配置"></a>用户配置</h3><p><strong>修改配置文件&#x2F;etc&#x2F;sudoers</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190521.png" style="zoom:50%;" /><h3 id="java和hadoop环境安装"><a href="#java和hadoop环境安装" class="headerlink" title="java和hadoop环境安装"></a>java和hadoop环境安装</h3><ol><li><p><strong>在&#x2F;opt目录下创建module、software文件夹</strong></p><p>​software用来存储所有程序的jar包（类似安装包）</p><p>​module就是所有的jar包解压之后放置的地方（安装的地方）</p></li><li><p><strong>将jdk包和hadoop包传到&#x2F;opt&#x2F;software中</strong></p></li><li><p><strong>将这两个包解压到&#x2F;opt&#x2F;module中</strong></p></li></ol><p><strong>命令</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">tar -zxvf xxx -C <span class="hljs-regexp">/opt/m</span>odule<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190636.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190648.png"></p><p><strong>注意</strong></p><p>此时的文件是属于root的，需要将其改为自己的</p><h3 id="在文件-x2F-etc-x2F-profile中添加JAVA-HOME和HADOOP-HOME"><a href="#在文件-x2F-etc-x2F-profile中添加JAVA-HOME和HADOOP-HOME" class="headerlink" title="在文件&#x2F;etc&#x2F;profile中添加JAVA_HOME和HADOOP_HOME"></a>在文件&#x2F;etc&#x2F;profile中添加JAVA_HOME和HADOOP_HOME</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190728.png" style="zoom:50%;" /><h3 id="source-x2F-etc-x2F-profile"><a href="#source-x2F-etc-x2F-profile" class="headerlink" title="source &#x2F;etc&#x2F;profile"></a>source &#x2F;etc&#x2F;profile</h3><p>就可以了</p><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210190805.png" style="zoom:50%;" /><h2 id="2-官方案例"><a href="#2-官方案例" class="headerlink" title="2 官方案例"></a>2 官方案例</h2><p>我自己在&#x2F;home目录下建立了一个hadoop_learning文件夹，然后在里面的examples进行演示。</p><h3 id="①-grep案例"><a href="#①-grep案例" class="headerlink" title="① grep案例"></a>① grep案例</h3><p><strong>a. 首先将hadoop文件夹下的etc目录下的.xml文件复制到grep_input文件中：</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>etc<span class="hljs-regexp">/hadoop/</span>*.xml grep_input/<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191208.png"></p><p><strong>b. 然后运行hadoop示例的example文件来执行grep</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">hadoop jar <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>share<span class="hljs-regexp">/hadoop/m</span>apreduce<span class="hljs-regexp">/hadoop-mapreduce-examples-2.7.2.jar grep grep_input/</span> grep_output <span class="hljs-string">&#x27;dfs[a-z.]+&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191245.png"></p><p><strong>c. 最后在grep_output里面看结果</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191308.png" style="zoom:80%;" /><h3 id="②-WordCount案例"><a href="#②-WordCount案例" class="headerlink" title="② WordCount案例"></a>② WordCount案例</h3><p><strong>a. 首先自己创建一个wc_input文件，里面放入自己写的文件</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191348.png" style="zoom:50%;" /><p><strong>b. 运行hadoop示例的example文件来执行</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">hadoop jar <span class="hljs-regexp">/opt/m</span>odule<span class="hljs-regexp">/hadoop-2.7.2/</span>share<span class="hljs-regexp">/hadoop/m</span>apreduce<span class="hljs-regexp">/hadoop-mapreduce-examples-2.7.2.jar wordcount wc_input/</span> wc_output<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191426.png"></p><p><strong>c. 就可以得到词频的统计结果</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191442.png" style="zoom:50%;" /><h1 id="伪分布式模式"><a href="#伪分布式模式" class="headerlink" title="伪分布式模式"></a>伪分布式模式</h1><h2 id="1-启动HDFS并运行MR文件"><a href="#1-启动HDFS并运行MR文件" class="headerlink" title="1 启动HDFS并运行MR文件"></a>1 启动HDFS并运行MR文件</h2><h3 id="伪分布式模式介绍"><a href="#伪分布式模式介绍" class="headerlink" title="伪分布式模式介绍"></a>伪分布式模式介绍</h3><p>按照分布式来进行配置，只是<strong>只有一台服务器</strong>而已。</p><h3 id="伪分布式配置"><a href="#伪分布式配置" class="headerlink" title="伪分布式配置"></a>伪分布式配置</h3><p>在hadoop目录下的etc&#x2F;hadoop里面是所有的配置文件</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191640.png"></p><p><strong>1. 修改env文件</strong></p><p>只要看到env，就改JAVA_HOME</p><p><strong>修改前：</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191721.png" style="zoom: 80%;" /><p><strong>修改后：</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191745.png" style="zoom: 50%;" /><p><strong>2. 修改core-site.xml</strong></p><p><strong>修改前</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191819.png" style="zoom:50%;" /><p><strong>修改后</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191837.png" style="zoom:50%;" /><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>fs.defaultFS<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hdfs://hadoop1:9000<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.tmp.dir<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>file:/home/hadoop/tmp<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>io.file.buffer.size<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>131702<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>3. 修改hdfs-site.xml</strong></p><p>指定HDFS副本的数量</p><p><strong>修改前</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191916.png" style="zoom:50%;" /><p><strong>修改后</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210191933.png" style="zoom:50%;" /><h3 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h3><p><strong>1. 格式化NameNode</strong></p><p>第一次启动时格式化即可，以后就不要总格式化了。</p><p>bin目录下的hdfs可以做到</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192158.png" style="zoom:80%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">bin</span>/hdfs namenode -<span class="hljs-built_in">format</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192227.png"></p><p><strong>2. 启动NameNode</strong></p><p>所有的启动命令都在sbin目录下面</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192301.png" style="zoom:67%;" /><p>输入</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">hadoop-daemon.sh <span class="hljs-literal">start</span> namenode<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192329.png" style="zoom:80%;" /><p><strong>3. 检查是否启动成功</strong></p><p>用jps检查</p><p>jps：java的ps进程</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192353.png" style="zoom:80%;" /><p><strong>4. 启动DataNode</strong></p><p>还是用hadoop-daemon.sh来启动</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192422.png"></p><p><strong>5. 检查datanode是否启动成功</strong></p><p>还是jps</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192442.png" style="zoom:50%;" /><p><strong>6. 检查集群是否启动</strong></p><p>去window主机的谷歌浏览器上输入ip地址:50070查看是否能正常进入</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192511.png" style="zoom:80%;" /><p><strong>注意！！！</strong></p><p>必须关闭防火墙！否则不能正常进入</p><h3 id="添加目录和文件"><a href="#添加目录和文件" class="headerlink" title="添加目录和文件"></a>添加目录和文件</h3><p><strong>最开始的时候只有根目录</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192608.png" style="zoom:67%;" /><p><strong>若要添加目录，则需要用hadoop的指令</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">bin<span class="hljs-regexp">/hdfs dfs -mkdir -p /</span>home<span class="hljs-regexp">/hadoop_learning/</span>coachhe<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192641.png" style="zoom: 80%;" /><p><strong>ls用法</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">bin<span class="hljs-regexp">/hdfs dfs -ls /</span>home<span class="hljs-regexp">/hadoop_learning/</span><br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192714.png" style="zoom:80%;" /><p><strong>上传文件</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">hdfs dfs -put <span class="hljs-regexp">/home/</span>hadoop_learning<span class="hljs-regexp">/examples/</span>wc_input<span class="hljs-regexp">/wc.input /</span>home<span class="hljs-regexp">/hadoop_learning/</span>examples<span class="hljs-regexp">/wc_input/</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192743.png"></p><h3 id="重新格式化NameNode"><a href="#重新格式化NameNode" class="headerlink" title="重新格式化NameNode"></a>重新格式化NameNode</h3><p><strong>首先</strong></p><p>关闭jps查询得到的NameNode和DataNode进程</p><p><strong>然后</strong></p><p>删除$HADOOP_HOME目录下面的data和logs文件。</p><p><strong>注意</strong></p><p>一定要先退出进程再删除文件</p><h4 id="思考：为么不能一直格式化NameNode？"><a href="#思考：为么不能一直格式化NameNode？" class="headerlink" title="思考：为么不能一直格式化NameNode？"></a>思考：为么不能一直格式化NameNode？</h4><p>因为DataNode和NameNode共享同一个集群 ID，两者之间需要相互通信，因此如果格式化之后NameNode会变化集群ID，导致两者不能通信。</p><p><strong>具体分析</strong></p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192834.png" style="zoom:67%;" /><h2 id="2-启动YARN并运行MR文件"><a href="#2-启动YARN并运行MR文件" class="headerlink" title="2 启动YARN并运行MR文件"></a>2 启动YARN并运行MR文件</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ol><li>配置集群在YARN上运行MR</li><li>启动、测试集群增、删、查</li><li>在YARN上执行WordCount案例。</li></ol><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><strong>1. 修改yarn-env.sh（同样也在etc&#x2F;hadoop目录下）</strong> </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210192951.png" style="zoom:80%;" /><p><strong>2. 配置yarn-site.xml</strong> </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193014.png"></p><p>修改后格式如下</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193029.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;configuration&gt;<br><br>&lt;!-- Site specific YARN configuration properties --&gt;<br>        &lt;property&gt;<br>                &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;<br>                &lt;value&gt;mapreduce_shuffle&lt;/value&gt;<br>        &lt;/property&gt;<br><br>        &lt;property&gt;<br>                &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;<br>                &lt;value&gt;clinux01&lt;/value&gt;<br>        &lt;/property&gt;<br><br>&lt;/configuration&gt;<br></code></pre></td></tr></table></figure><p><strong>3. 配置mapred-env.sh</strong> </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193047.png" style="zoom:50%;" /><p><strong>4. 配置mapreds-site.xml.template，重新命名为mapred-site.xml</strong> </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193108.png"></p><p><strong>5. 修改mapred-site.xml</strong> </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193131.png" style="zoom: 67%;" /><p> 修改后如下</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193150.png" style="zoom: 67%;" /><p><strong>总结</strong> </p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193215.png" style="zoom:67%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193228.png" style="zoom:67%;" /><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193248.png" style="zoom: 67%;" /><h3 id="启动集群-1"><a href="#启动集群-1" class="headerlink" title="启动集群"></a>启动集群</h3><h4 id="1-保证NameNode和DataNode已经启动"><a href="#1-保证NameNode和DataNode已经启动" class="headerlink" title="1. 保证NameNode和DataNode已经启动"></a>1. 保证NameNode和DataNode已经启动</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193400.png"></p><h4 id="2-启动resourcemanager和nodemanager"><a href="#2-启动resourcemanager和nodemanager" class="headerlink" title="2. 启动resourcemanager和nodemanager"></a>2. 启动resourcemanager和nodemanager</h4><p>  使用sbin目录下的yarn-daemon.sh脚本，启动方法和hadoop-daemon.sh一样</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193426.png"  /><h4 id="标志"><a href="#标志" class="headerlink" title="标志"></a>标志</h4><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193502.png"></p><h2 id="运行MR程序"><a href="#运行MR程序" class="headerlink" title="运行MR程序"></a>运行MR程序</h2><p>运行方式和没有YARN完全相同</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">hadoop jar share<span class="hljs-regexp">/hadoop/m</span>apreduce<span class="hljs-regexp">/hadoop-mapreduce-examples-2.7.2.jar wordcount /</span>home<span class="hljs-regexp">/hadoop_learning/</span>examples<span class="hljs-regexp">/wc_input/</span>wc.input <span class="hljs-regexp">/home/</span>hadoop_learning<span class="hljs-regexp">/examples/</span>wc_output_yarn <br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193605.png"></p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>运行得到的输出（wc_output_yarn）不能直接在服务器上看见，需要用hdfs指令才能看到 </p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Hadoop/20201210193629.png"></p><h3 id="配置文件总结"><a href="#配置文件总结" class="headerlink" title="配置文件总结"></a>配置文件总结</h3><table><thead><tr><th>要获取的默认文件</th><th>文件存放在Hadoop的jar包中的位置</th></tr></thead><tbody><tr><td>[core-default.xml]</td><td>hadoop-common-2.7.2.jar&#x2F; core-default.xml</td></tr><tr><td>[hdfs-default.xml]</td><td>hadoop-hdfs-2.7.2.jar&#x2F; hdfs-default.xml</td></tr><tr><td>[yarn-default.xml]</td><td>hadoop-yarn-common-2.7.2.jar&#x2F; yarn-default.xml</td></tr><tr><td>[mapred-default.xml]</td><td>hadoop-mapreduce-client-core-2.7.2.jar&#x2F; mapred-default.xml</td></tr></tbody></table><h4 id="自定义配置文件"><a href="#自定义配置文件" class="headerlink" title="自定义配置文件"></a>自定义配置文件</h4><p><strong>core-site.xml、hdfs-site.xml、yarn-site.xml、mapred-site.xml</strong>四个配置文件存放在$HADOOP_HOME&#x2F;etc&#x2F;hadoop这个路径上，用户可以根据项目需求重新进行修改配置。</p>]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>Hadoop</category>
      
      <category>1 Hadoop介绍</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/ae496904726a.html"/>
    <url>/2022/12/ae496904726a.html</url>
    
    <content type="html"><![CDATA[<p>安装：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml">pip3 install -i https://pypi.doubanio.com/simple pandas<br>yum install python3-devel<br>pip3 install -i https://pypi.doubanio.com/simple jupyter<br>pip3 install -i https://pypi.doubanio.com/simple xlrd<br>pip3 install -i https://pypi.doubanio.com/simple ipenpyxl<br>yum -y install libjpeg-turbo-devel<br>pip3 install -i https://pypi.doubanio.com/simple matplotlib<br>pip3 install -i https://pypi.doubanio.com/simple pillow<br></code></pre></td></tr></table></figure><h1 id="DataFram-和-Series"><a href="#DataFram-和-Series" class="headerlink" title="DataFram 和 Series"></a>DataFram 和 Series</h1><p>关系图：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20220103233047.png"></p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Python</category>
      
      <category>Python分析excel</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/ce3fe63d4f0a.html"/>
    <url>/2022/12/ce3fe63d4f0a.html</url>
    
    <content type="html"><![CDATA[<h1 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h1><h3 id="普通cat"><a href="#普通cat" class="headerlink" title="普通cat"></a>普通cat</h3><p>显示文本内容</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404012449.png" style="zoom:50%;" /><h3 id="cat-n-1-txt"><a href="#cat-n-1-txt" class="headerlink" title="cat -n 1.txt"></a>cat -n 1.txt</h3><p>-n参数给所有的行加上行号</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404012510.png" style="zoom:50%;" /><h3 id="cat-b-1-txt"><a href="#cat-b-1-txt" class="headerlink" title="cat -b 1.txt"></a>cat -b 1.txt</h3><p>对脚本很有用，只给有文本的行加上行号</p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404012623.png" style="zoom:50%;" /><h3 id="cat结合wc显示行数"><a href="#cat结合wc显示行数" class="headerlink" title="cat结合wc显示行数"></a>cat结合wc显示行数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> 1.txt | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Scala/20210404012656.png" style="zoom:50%;" /><p>显示1.txt的行数</p><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>- c 统计字节数。<br>- l 统计行数。<br>- w 统计字数。</p><h1 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h1><h3 id="cp-i-test-one-test-two"><a href="#cp-i-test-one-test-two" class="headerlink" title="cp -i test_one test_two"></a>cp -i test_one test_two</h3><p>询问是否用test_one替换test_two</p><h3 id="cp-R"><a href="#cp-R" class="headerlink" title="cp -R"></a>cp -R</h3><p>在一条命令中递归地复制整个目录的内容</p><h1 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h1><p>用来编辑定时任务。</p><h3 id="列出所有定时任务"><a href="#列出所有定时任务" class="headerlink" title="列出所有定时任务"></a>列出所有定时任务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">crontab -l<br></code></pre></td></tr></table></figure><p>得到所有crontab任务</p><h3 id="编辑crontab文件"><a href="#编辑crontab文件" class="headerlink" title="编辑crontab文件"></a>编辑crontab文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">crontab -e<br></code></pre></td></tr></table></figure><h1 id="date"><a href="#date" class="headerlink" title="date"></a>date</h1><h3 id="date-1"><a href="#date-1" class="headerlink" title="date"></a>date</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">date</span><br></code></pre></td></tr></table></figure><h3 id="date-”-F”"><a href="#date-”-F”" class="headerlink" title="date +”%F”"></a>date +”%F”</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F&quot;</span><br></code></pre></td></tr></table></figure><h3 id="date-”-F-T”"><a href="#date-”-F-T”" class="headerlink" title="date +”%F %T”"></a>date +”%F %T”</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">date +<span class="hljs-string">&quot;%F %T&quot;</span><br></code></pre></td></tr></table></figure><h3 id="date-d"><a href="#date-d" class="headerlink" title="date -d"></a>date -d</h3><p>得到字符串形式的输出</p><h3 id="date-s"><a href="#date-s" class="headerlink" title="date +%s"></a>date +%s</h3><p>得到当前unix时间戳</p><h3 id="date-s-d”24-hour-ago”"><a href="#date-s-d”24-hour-ago”" class="headerlink" title="date +%s -d”24 hour ago”"></a>date +%s -d”24 hour ago”</h3><p>得到24小时之间的unix时间戳</p><h1 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h1><h3 id="ls-1"><a href="#ls-1" class="headerlink" title="ls"></a>ls</h3><p>展示所有文件和目录</p><h3 id="ls-F"><a href="#ls-F" class="headerlink" title="ls -F"></a>ls -F</h3><p>区分文件和目录，是目录的后面会有”&#x2F;“</p><h3 id="ls-a"><a href="#ls-a" class="headerlink" title="ls -a"></a>ls -a</h3><p>将隐藏文件和普通文件及目录一起显示出来</p><h3 id="ls-R"><a href="#ls-R" class="headerlink" title="ls -R"></a>ls -R</h3><p>递归显示当前目录下包含的子目录的文件</p><h3 id="ls-l"><a href="#ls-l" class="headerlink" title="ls -l"></a>ls -l</h3><p>显示长列表</p><h1 id="man"><a href="#man" class="headerlink" title="man"></a>man</h1><h3 id="bash手册"><a href="#bash手册" class="headerlink" title="bash手册"></a>bash手册</h3><p>man命令用来访问存储在Linux系统上的手册压面。在想要查找的工具的名称前面输入man命令，就可以找到那个工具相应的手册条目。</p><h3 id="Linux手册页的内容区域"><a href="#Linux手册页的内容区域" class="headerlink" title="Linux手册页的内容区域"></a>Linux手册页的内容区域</h3><table><thead><tr><th>区域号</th><th>所涵盖的内容</th></tr></thead><tbody><tr><td>1</td><td>可执行的程序或shell命令</td></tr><tr><td>2</td><td>系统调用</td></tr><tr><td>3</td><td>库调用</td></tr><tr><td>4</td><td>特殊文件</td></tr><tr><td>5</td><td>文件格式与约定</td></tr><tr><td>6</td><td>游戏</td></tr><tr><td>7</td><td>概览、约定及杂项</td></tr><tr><td>8</td><td>超级用户和系统管理员命令</td></tr><tr><td>9</td><td>内核例程</td></tr></tbody></table><h1 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h1><h3 id="rm-i"><a href="#rm-i" class="headerlink" title="rm -i"></a>rm -i</h3><p>删除前询问是否删除</p><h3 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h3><p>rmdir是删除目录，没有rmdir -i，因为其只能删除空目录，可以先用rm -i进入其目录删除其中的文件，然后再删除目录本身</p><h3 id="rm-r-x2F-rm-rf"><a href="#rm-r-x2F-rm-rf" class="headerlink" title="rm -r &#x2F; rm -rf"></a>rm -r &#x2F; rm -rf</h3><p>会直接将目录和其中的文件一起删除<br>和rm -rf相同</p><h3 id="rm-ri"><a href="#rm-ri" class="headerlink" title="rm -ri"></a>rm -ri</h3><p>会进行递归询问</p><h1 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h1><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>tr是对管道传输过来的参数进行过滤。tr是一个过滤器<br>##作用<br>对来自标准输入的字符进行替换、压缩和删除。它可以将一组字符变成另一组字符，经常用来编写优美的单行命令，作用很强大</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><ol><li><p>将输入字符由大写转换为小写：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello world&quot;</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27;a-z&#x27;</span> <span class="hljs-string">&#x27;A-Z&#x27;</span><br></code></pre></td></tr></table></figure><p>输出：<br>HELLO WORLD</p></li><li><p>使用tr删除字符：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello 123 world 456&quot;</span> | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27;0-9&#x27;</span><br></code></pre></td></tr></table></figure><p>输出：<br>hello world</p></li><li><p>将制表符转换为空格</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> text | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27;\t&#x27;</span> <span class="hljs-string">&#x27; &#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>字符集补集，从输入文本中将不在补集中的所有字符删除</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">echo</span> aa.,a <span class="hljs-number">1</span> b#$bb <span class="hljs-number">2</span> c*cc <span class="hljs-number">3</span> ddd <span class="hljs-number">4</span> | tr -d -c &#x27;<span class="hljs-number">0</span>-<span class="hljs-number">9</span> \n&#x27;<br></code></pre></td></tr></table></figure><p>输出：<br>1 2 3 4<br>解释：<br>在这里，-d和-c配合，如果去掉-d则会出错，如果去掉-c则会得到相反的结果，会将所有0-9删除。</p></li></ol><h1 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h1><p>wc用来统计字数<br>输出格式如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">wc</span> testfile           <span class="hljs-comment"># testfile文件的统计信息</span></span>  <br>3 92 598 testfile       # testfile文件的行数为3、单词数92、字节数598 <br></code></pre></td></tr></table></figure><p>输出的第一个参数为行数，第二个参数为单词数量，第三个参数为字节数量，第四个参数是文件名</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>Linux</category>
      
      <category>Command</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/02ad8ebc9366.html"/>
    <url>/2022/12/02ad8ebc9366.html</url>
    
    <content type="html"><![CDATA[<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="英文缩写"><a href="#英文缩写" class="headerlink" title="英文缩写"></a>英文缩写</h2><p>单一职责原则：Single Responsibility Principle（SRP）</p><h2 id="RBAC模型"><a href="#RBAC模型" class="headerlink" title="RBAC模型"></a>RBAC模型</h2><p>RBAC模型：Role-Based Access Control，基于角色的访问控制，通过分配和取消角色来完成用户权限的授予和取消，使动作主题（用户）与资源的行为（权限）分离。</p><h2 id="单一职责原则的定义："><a href="#单一职责原则的定义：" class="headerlink" title="单一职责原则的定义："></a>单一职责原则的定义：</h2><p>应该有且仅有一个原因引起类的变更。</p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>设计模式</category>
      
      <category>设计模式之禅</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/431c31aceb44.html"/>
    <url>/2022/12/431c31aceb44.html</url>
    
    <content type="html"><![CDATA[<h1 id="目标：过年前学完JVM"><a href="#目标：过年前学完JVM" class="headerlink" title="目标：过年前学完JVM"></a>目标：过年前学完JVM</h1><h1 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h1><p>一共381个视频，目前学习到了第34个，还有340个，每天学习8个&#x2F;每周学习48个&#x2F;每月学习200个</p><ul><li><input checked="" disabled="" type="checkbox"> 01-JVM内存与垃圾回收篇概述</li><li><input checked="" disabled="" type="checkbox"> 02-如何看待Java上层技术与JVM</li><li><input checked="" disabled="" type="checkbox"> 03-为什么要学习JVM</li><li><input checked="" disabled="" type="checkbox"> 04-面向人群和课程特点</li><li><input checked="" disabled="" type="checkbox"> 05-官方规范下载与参考书目</li><li><input checked="" disabled="" type="checkbox"> 06-跨平台的语言Java和跨语言的平台JVM</li><li><input checked="" disabled="" type="checkbox"> 07-字节码与多语言混合编程</li><li><input checked="" disabled="" type="checkbox"> 08-Java及JVM历史上的重大事件</li><li><input checked="" disabled="" type="checkbox"> 09-虚拟机与Java虚拟机介绍</li><li><input checked="" disabled="" type="checkbox"> 10-JVM的位置</li><li><input checked="" disabled="" type="checkbox"> 11-JVM的整体结构</li><li><input checked="" disabled="" type="checkbox"> 12-Java代码执行流程</li><li><input checked="" disabled="" type="checkbox"> 13-区分栈的指令集架构和寄存器的指令集架构</li><li><input checked="" disabled="" type="checkbox"> 14-JVM的生命周期</li><li><input checked="" disabled="" type="checkbox"> 15-SUN Classic VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 16-Exact VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 17-HotSpot VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 18-JRockit VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 19-IBM J9 VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 20-KVM、CDC、CLDC的介绍</li><li><input checked="" disabled="" type="checkbox"> 21-Azul VM和BEA Liquid VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 22-Apache Harmony的介绍</li><li><input checked="" disabled="" type="checkbox"> 23-Microsoft JVM和TaobaoJVM</li><li><input checked="" disabled="" type="checkbox"> 24-Dalvik VM及其他虚拟机的介绍</li><li><input checked="" disabled="" type="checkbox"> 25-Graal VM的介绍</li><li><input checked="" disabled="" type="checkbox"> 26-内存结构概述</li><li><input checked="" disabled="" type="checkbox"> 27-概述类的加载器及类加载过程</li><li><input checked="" disabled="" type="checkbox"> 28-类的加载过程一：Loading</li><li><input checked="" disabled="" type="checkbox"> 29-类的加载过程二：Linking</li><li><input checked="" disabled="" type="checkbox"> 30-类的加载过程三：Initialization</li><li><input checked="" disabled="" type="checkbox"> 31-几种类加载器的使用体会</li><li><input checked="" disabled="" type="checkbox"> 32-引导类、扩展类、系统类加载器的使用及演示</li><li><input checked="" disabled="" type="checkbox"> 33-为什么需要用户自定义类加载器及具体实现</li><li><input checked="" disabled="" type="checkbox"> 34-ClassLoader的常用方法及获取方法</li><li><input checked="" disabled="" type="checkbox"> 35-双亲委派机制的工作原理及演示</li><li><input checked="" disabled="" type="checkbox"> 36-双亲委派机制的优势</li><li><input checked="" disabled="" type="checkbox"> 37-沙箱安全机制</li><li><input checked="" disabled="" type="checkbox"> 38-类的主动使用与被动使用等</li><li><input checked="" disabled="" type="checkbox"> 39-运行时数据区内部结构</li><li><input checked="" disabled="" type="checkbox"> 40-JVM中的线程说明</li><li><input checked="" disabled="" type="checkbox"> 41-PC寄存器概述</li><li><input checked="" disabled="" type="checkbox"> 42-PC寄存器的使用举例</li><li><input checked="" disabled="" type="checkbox"> 43-解决PC寄存器两个面试问题</li><li><input checked="" disabled="" type="checkbox"> 44-虚拟机栈的主要特点</li><li><input checked="" disabled="" type="checkbox"> 45-虚拟机栈的常见异常与如何设置栈大小</li><li><input checked="" disabled="" type="checkbox"> 46-栈的存储结构和运行原理</li><li><input checked="" disabled="" type="checkbox"> 47-栈桢的内部结构</li><li><input checked="" disabled="" type="checkbox"> 48-局部变量表结构的认识</li><li><input checked="" disabled="" type="checkbox"> 49-字节码中方法内部结构的剖析</li><li><input checked="" disabled="" type="checkbox"> 50-变量槽slot的理解与演示</li><li><input checked="" disabled="" type="checkbox"> 51-静态变量与局部变量的对比及小结</li><li><input checked="" disabled="" type="checkbox"> 52-操作数栈的特点</li><li><input checked="" disabled="" type="checkbox"> 53-涉及操作数栈的字节码指令执行分析</li><li><input checked="" disabled="" type="checkbox"> 54-栈顶缓存技术</li><li><input checked="" disabled="" type="checkbox"> 55-动态链接的理解与常量池的作用</li><li><input checked="" disabled="" type="checkbox"> 56-方法的绑定机制：静态绑定与动态绑定</li><li><input checked="" disabled="" type="checkbox"> 57-4种方法调用指令区分非虚方法与虚方法</li><li><input checked="" disabled="" type="checkbox"> 58-invokedynamic指令的使用</li><li><input checked="" disabled="" type="checkbox"> 59-方法重写的本质与虚方法表的使用</li><li><input checked="" disabled="" type="checkbox"> 60-方法返回地址的说明</li><li><input checked="" disabled="" type="checkbox"> 61-栈桢中的一些附加信息</li><li><input checked="" disabled="" type="checkbox"> 62-虚拟机栈的5道面试题</li><li><input checked="" disabled="" type="checkbox"> 63-本地方法接口的理解</li><li><input checked="" disabled="" type="checkbox"> 64-本地方法栈的理解</li><li><input checked="" disabled="" type="checkbox"> 65-JVM学习路线与内容回顾</li><li><input checked="" disabled="" type="checkbox"> 66-堆空间的概述_进程中堆的唯一性</li><li><input checked="" disabled="" type="checkbox"> 67-堆空间关于对象创建和和GC的概述</li><li><input checked="" disabled="" type="checkbox"> 68-堆的细分内存结构</li><li><input checked="" disabled="" type="checkbox"> 69-堆空间大小的设置和查看</li><li><input checked="" disabled="" type="checkbox"> 70-OOM的说明与举例</li><li><input checked="" disabled="" type="checkbox"> 71-新生代与老年代中相关参数的设置</li><li><input checked="" disabled="" type="checkbox"> 72-图解对象分配的一般过程</li><li><input checked="" disabled="" type="checkbox"> 73-对象分配的特殊情况</li><li><input checked="" disabled="" type="checkbox"> 74-代码举例与JVisualVM演示对象的分配过程</li><li><input checked="" disabled="" type="checkbox"> 75-常用优工具概述与Jprofiler的演示</li><li><input checked="" disabled="" type="checkbox"> 76-MinorGC、MajorGC和FullGC的对比</li><li><input checked="" disabled="" type="checkbox"> 77-GC举例与日志分析</li><li><input checked="" disabled="" type="checkbox"> 78-体会堆空间分代的思想</li><li><input checked="" disabled="" type="checkbox"> 79-总结内存分配策略</li><li><input checked="" disabled="" type="checkbox"> 80-堆空间为每个线程分配的TLAB</li><li><input checked="" disabled="" type="checkbox"> 81-小结堆空间的常用参数设置</li><li><input checked="" disabled="" type="checkbox"> 82-通过逃逸分析看堆空间的对象分配策略</li><li><input checked="" disabled="" type="checkbox"> 83-代码优化之栈上分配</li><li><input checked="" disabled="" type="checkbox"> 84-代码优化之同步省略</li><li><input checked="" disabled="" type="checkbox"> 85-代码优化之标量替换</li><li><input checked="" disabled="" type="checkbox"> 86-代码优化及堆的小结</li><li><input disabled="" type="checkbox"> 87-方法区概述_栈堆方法区间的交互关系</li><li><input disabled="" type="checkbox"> 88-方法区的基本理解</li><li><input disabled="" type="checkbox"> 89-Hotspot中方法区的演进</li><li><input disabled="" type="checkbox"> 90-设置方法区大小的参数</li><li><input disabled="" type="checkbox"> 91-OOM：PermGen和OOM：Metaspace举例</li><li><input disabled="" type="checkbox"> 92-方法区的内部结构1</li><li><input disabled="" type="checkbox"> 93-方法区的内部结构2</li><li><input disabled="" type="checkbox"> 94-class文件中常量池的理解</li><li><input disabled="" type="checkbox"> 95-运行时常量池的理解</li><li><input disabled="" type="checkbox"> 96-图示举例方法区的使用</li><li><input disabled="" type="checkbox"> 97-方法区在jdk6、jdk7、jdk8中的演进细节</li><li><input disabled="" type="checkbox"> 98-StringTable为什么要调整位置</li><li><input disabled="" type="checkbox"> 99-如何证明静态变量存在哪</li><li><input disabled="" type="checkbox"> 100-方法区的垃圾回收行为</li><li><input disabled="" type="checkbox"> 101-运行时数据区的总结与常见大厂面试题说明</li><li><input disabled="" type="checkbox"> 102-对象实例化的几种方式</li><li><input disabled="" type="checkbox"> 103-字节码角度看对象的创建过程</li><li><input disabled="" type="checkbox"> 104-对象创建的六个步骤</li><li><input disabled="" type="checkbox"> 105-对象的内存布局</li><li><input disabled="" type="checkbox"> 106-对象访问定位</li><li><input disabled="" type="checkbox"> 107-直接内存的简单体验</li><li><input disabled="" type="checkbox"> 108-使用本地内存读写数据的测试</li><li><input disabled="" type="checkbox"> 109-直接内存的00M与内存大小的设置</li><li><input disabled="" type="checkbox"> 110-执行引擎的作用及工作过程概述</li><li><input disabled="" type="checkbox"> 111-Java程序的编译和解释运行的理解</li><li><input disabled="" type="checkbox"> 112-机器码_指令_汇编_高级语言理解与执行过程</li><li><input disabled="" type="checkbox"> 113-解释器的使用</li><li><input disabled="" type="checkbox"> 114-HotspotVM为何解释器与JIT编译器并存</li><li><input disabled="" type="checkbox"> 115-热点代码探测确定何时JIT</li><li><input disabled="" type="checkbox"> 116-Hotspot设置模式_C1与C2编译器</li><li><input disabled="" type="checkbox"> 117-Graal编译器与AOT编译器</li><li><input disabled="" type="checkbox"> 118-String的不可变性</li><li><input disabled="" type="checkbox"> 119-String底层Hashtable结构的说明</li><li><input disabled="" type="checkbox"> 120-String内存结构的分配位置</li><li><input disabled="" type="checkbox"> 121-两个案例熟悉String的基本操作</li><li><input disabled="" type="checkbox"> 122-字符串拼接操作的面试题讲解</li><li><input disabled="" type="checkbox"> 123-字符串变量拼接操作的底层原理</li><li><input disabled="" type="checkbox"> 124-拼接操作与append操作的效率对比</li><li><input disabled="" type="checkbox"> 125-intern()的理解</li><li><input disabled="" type="checkbox"> 126-new String()到底创建了几个对象</li><li><input disabled="" type="checkbox"> 127-关于intern()的面试难题</li><li><input disabled="" type="checkbox"> 128-面试的拓展问题</li><li><input disabled="" type="checkbox"> 129-intern()的课后练习1</li><li><input disabled="" type="checkbox"> 130-intern()的课后练习2</li><li><input disabled="" type="checkbox"> 131-intern()的空间效率测试</li><li><input disabled="" type="checkbox"> 132-StringTable的垃圾回收测试</li><li><input disabled="" type="checkbox"> 133-G1垃圾收集器的String去重操作</li><li><input disabled="" type="checkbox"> 134-垃圾回收相关章节的说明</li><li><input disabled="" type="checkbox"> 135-什么是GC，为什么需要GC</li><li><input disabled="" type="checkbox"> 136-了解早期垃圾回收行为</li><li><input disabled="" type="checkbox"> 137-Java自动内存管理介绍</li><li><input disabled="" type="checkbox"> 138-垃圾回收相关算法概述</li><li><input disabled="" type="checkbox"> 139-引用计数算法的原理及优缺点</li><li><input disabled="" type="checkbox"> 140-Java代码举例_Python的引用计数实施方案</li><li><input disabled="" type="checkbox"> 141-可达性分析算法与GC Roots</li><li><input disabled="" type="checkbox"> 142-对象的finalization机制</li><li><input disabled="" type="checkbox"> 143-代码演示可复活的对象</li><li><input disabled="" type="checkbox"> 144-使用MAT查看GC Roots</li><li><input disabled="" type="checkbox"> 145-使用JProfiler进行GC Roots溯源</li><li><input disabled="" type="checkbox"> 146-使用JProfiler分析OOM</li><li><input disabled="" type="checkbox"> 147-标记-清除算法原理及优缺点</li><li><input disabled="" type="checkbox"> 148-复制算法原理及优缺点</li><li><input disabled="" type="checkbox"> 149-标记-压缩算法原理及优缺点</li><li><input disabled="" type="checkbox"> 150-不同指标上对比三种算法</li><li><input disabled="" type="checkbox"> 151-分代收集算法的说明</li><li><input disabled="" type="checkbox"> 152-增量收集算法原理及优缺点</li><li><input disabled="" type="checkbox"> 153-分区算法的说明</li><li><input disabled="" type="checkbox"> 154-垃圾回收相关概念的概述</li><li><input disabled="" type="checkbox"> 155-System.gc()的理解</li><li><input disabled="" type="checkbox"> 156-手动gc理解不可达对象的回收行为</li><li><input disabled="" type="checkbox"> 157-内存溢出的分析</li><li><input disabled="" type="checkbox"> 158-内存泄漏的分析</li><li><input disabled="" type="checkbox"> 159-StopTheWorld事件的理解</li><li><input disabled="" type="checkbox"> 160-程序的并行与并发</li><li><input disabled="" type="checkbox"> 161-垃圾回收的并行与并发</li><li><input disabled="" type="checkbox"> 162-安全点与安全区域的说明</li><li><input disabled="" type="checkbox"> 163-Java中几种不同引用的概述</li><li><input disabled="" type="checkbox"> 164-强引用：不回收</li><li><input disabled="" type="checkbox"> 165-软引用：内存不足即回收</li><li><input disabled="" type="checkbox"> 166-弱引用：发现即回收</li><li><input disabled="" type="checkbox"> 167-虚引用：对象回收跟踪</li><li><input disabled="" type="checkbox"> 168-终结器引用的介绍</li><li><input disabled="" type="checkbox"> 169-垃圾回收器章节概览</li><li><input disabled="" type="checkbox"> 170-垃圾回收器的分类</li><li><input disabled="" type="checkbox"> 171-GC性能指标的整体说明</li><li><input disabled="" type="checkbox"> 172-吞吐量与暂停时间的对比说明</li><li><input disabled="" type="checkbox"> 173-垃圾回收器的发展迭代史</li><li><input disabled="" type="checkbox"> 174-垃圾回收器的组合关系</li><li><input disabled="" type="checkbox"> 175-如何查看默认的垃圾回收器</li><li><input disabled="" type="checkbox"> 176-Serial与Serial Old垃圾回收器的介绍</li><li><input disabled="" type="checkbox"> 177-如何设置使用Serial垃圾回收器</li><li><input disabled="" type="checkbox"> 178-ParNew垃圾回收器的介绍</li><li><input disabled="" type="checkbox"> 179-如何设置使用ParNew垃圾回收器</li><li><input disabled="" type="checkbox"> 180-Parallel与Parallel Old垃圾回收器的介绍</li><li><input disabled="" type="checkbox"> 181-Parallel垃圾回收器的相关参数设置</li><li><input disabled="" type="checkbox"> 182-CMS垃圾回收器概述与工作原理</li><li><input disabled="" type="checkbox"> 183-CMS的特点与弊端分析</li><li><input disabled="" type="checkbox"> 184-CMS垃圾回收器的参数设置</li><li><input disabled="" type="checkbox"> 185-CMS的小结及后续JDK版本中的变化</li><li><input disabled="" type="checkbox"> 186-认识G1垃圾回收器</li><li><input disabled="" type="checkbox"> 187-G1垃圾回收器的优势和不足</li><li><input disabled="" type="checkbox"> 188-G1的参数设置</li><li><input disabled="" type="checkbox"> 189-G1在生产环境的适用场景</li><li><input disabled="" type="checkbox"> 190-region的使用介绍</li><li><input disabled="" type="checkbox"> 191-G1垃圾回收器的主要回收环节</li><li><input disabled="" type="checkbox"> 192-记忆集与写屏障</li><li><input disabled="" type="checkbox"> 193-G1垃圾回收过程的详细说明</li><li><input disabled="" type="checkbox"> 194-G1垃圾回收的优化建议</li><li><input disabled="" type="checkbox"> 195-7种经典的垃圾回收器总结与调优建议</li><li><input disabled="" type="checkbox"> 196-常用的显示GC日志的参数</li><li><input disabled="" type="checkbox"> 197-GC日志中垃圾回收数据的分析</li><li><input disabled="" type="checkbox"> 198-举例说明日志中堆空间数据如何解读</li><li><input disabled="" type="checkbox"> 199-日志分析工具的使用</li><li><input disabled="" type="checkbox"> 200-新时期的Epsilon和Shenandoah垃圾回收器</li><li><input disabled="" type="checkbox"> 201-革命性的ZGC的性能介绍</li><li><input disabled="" type="checkbox"> 202-其他的厂商的垃圾回收器</li><li><input disabled="" type="checkbox"> 203-最后寄语</li><li><input disabled="" type="checkbox"> 204-JVM中篇内容概述</li><li><input disabled="" type="checkbox"> 205-字节码文件的跨平台性</li><li><input disabled="" type="checkbox"> 206-了解Java的前端编译器</li><li><input disabled="" type="checkbox"> 207-透过字节码看代码执行细节举例1</li><li><input disabled="" type="checkbox"> 208-透过字节码看代码执行细节举例2</li><li><input disabled="" type="checkbox"> 209-透过字节码看代码执行细节举例3</li><li><input disabled="" type="checkbox"> 210-解读Class文件的三种方式</li><li><input disabled="" type="checkbox"> 211-Class文件本质和内部数据类型</li><li><input disabled="" type="checkbox"> 212-Class文件内部结构概述</li><li><input disabled="" type="checkbox"> 213-字节码数据保存到excel中的操作</li><li><input disabled="" type="checkbox"> 214-Class文件的标识：魔数</li><li><input disabled="" type="checkbox"> 215-Class文件版本号</li><li><input disabled="" type="checkbox"> 216-常量池概述</li><li><input disabled="" type="checkbox"> 217-常量池计数器</li><li><input disabled="" type="checkbox"> 218-常量池表中的字面量和符号引用</li><li><input disabled="" type="checkbox"> 219-解析得到常量池中所有的常量</li><li><input disabled="" type="checkbox"> 220-常量池表数据的解读1</li><li><input disabled="" type="checkbox"> 221-常量池表数据的解读2</li><li><input disabled="" type="checkbox"> 222-常量池表项数据的总结</li><li><input disabled="" type="checkbox"> 223-访问标识</li><li><input disabled="" type="checkbox"> 224-类索引、父类索引、接口索引集合</li><li><input disabled="" type="checkbox"> 225-字段表集合的整体理解</li><li><input disabled="" type="checkbox"> 226-字段表数据的解读</li><li><input disabled="" type="checkbox"> 227-方法表集合的整体理解</li><li><input disabled="" type="checkbox"> 228-方法表数据的解读</li><li><input disabled="" type="checkbox"> 229-属性表集合的整理理解</li><li><input disabled="" type="checkbox"> 230-方法中Code属性的解读</li><li><input disabled="" type="checkbox"> 231-LineNumberTable和LocalVariableTable属性的解读</li><li><input disabled="" type="checkbox"> d232-SourceFile属性的解读</li><li><input disabled="" type="checkbox"> 233-Class文件结构的小结</li><li><input disabled="" type="checkbox"> 234-javac -g操作的说明</li><li><input disabled="" type="checkbox"> 235-javap主要参数的使用</li><li><input disabled="" type="checkbox"> d236-javap解析得到的文件结构的解读</li><li><input disabled="" type="checkbox"> d237-javap使用小结</li><li><input disabled="" type="checkbox"> 238-字节码指令集的概述</li><li><input disabled="" type="checkbox"> 239-指令与数据类型的关系及指令分类</li><li><input disabled="" type="checkbox"> 240-加载与存储指令概述</li><li><input disabled="" type="checkbox"> 241-再谈操作数栈与局部变量表</li><li><input disabled="" type="checkbox"> 242-局部变量压栈指令</li><li><input disabled="" type="checkbox"> 243-常量入栈指令</li><li><input disabled="" type="checkbox"> 244-出栈装入局部变量表指令</li><li><input disabled="" type="checkbox"> 245-算术指令及举例</li><li><input disabled="" type="checkbox"> d246-算法指令再举例</li><li><input disabled="" type="checkbox"> 247-彻底搞定++运算符</li><li><input disabled="" type="checkbox"> 248-比较指令的说明</li><li><input disabled="" type="checkbox"> 249-宽化类型转换</li><li><input disabled="" type="checkbox"> d250-窄化类型转换</li><li><input disabled="" type="checkbox"> d251-创建类和数组实例的指令</li><li><input disabled="" type="checkbox"> 252-字段访问指令</li><li><input disabled="" type="checkbox"> 253-数组操作指令</li><li><input disabled="" type="checkbox"> 254-类型检查指令</li><li><input disabled="" type="checkbox"> 255-方法调用指令</li><li><input disabled="" type="checkbox"> 256-方法返回指令</li><li><input disabled="" type="checkbox"> 257-操作数栈管理指令</li><li><input disabled="" type="checkbox"> d258-比较指令</li><li><input disabled="" type="checkbox"> 259-条件跳转指令</li><li><input disabled="" type="checkbox"> d260-比较条件跳转指令</li><li><input disabled="" type="checkbox"> 261-多条件分支跳转指令</li><li><input disabled="" type="checkbox"> 262-无条件跳转指令</li><li><input disabled="" type="checkbox"> 263-抛出异常指令</li><li><input disabled="" type="checkbox"> 264-异常处理与异常表</li><li><input disabled="" type="checkbox"> d265-同步控制指令</li><li><input disabled="" type="checkbox"> d266-类的生命周期概述</li><li><input disabled="" type="checkbox"> 267-加载完成的操作及二进制的获取方式</li><li><input disabled="" type="checkbox"> 268-类模型与Class实例的位置</li><li><input disabled="" type="checkbox"> 269-链接之验证环节</li><li><input disabled="" type="checkbox"> 270-链接之准备环节</li><li><input disabled="" type="checkbox"> 271-链接之解析环节</li><li><input disabled="" type="checkbox"> 272-初始化过程与类初始化方法</li><li><input disabled="" type="checkbox"> 273-初始化阶段赋值与准备阶段赋值的对比</li><li><input disabled="" type="checkbox"> d274-类初始化方法clinit()的线程安全性</li><li><input disabled="" type="checkbox"> 275-何为类的主动使用和被动使用</li><li><input disabled="" type="checkbox"> 276-类的主动使用1</li><li><input disabled="" type="checkbox"> 277-类的主动使用2</li><li><input disabled="" type="checkbox"> 278-类的主动使用3</li><li><input disabled="" type="checkbox"> 279-类的主动使用4</li><li><input disabled="" type="checkbox"> 280-类的被动使用</li><li><input disabled="" type="checkbox"> 281-类的使用介绍</li><li><input disabled="" type="checkbox"> 282-类的卸载相关问题</li><li><input disabled="" type="checkbox"> 283-类加载器的概述</li><li><input disabled="" type="checkbox"> 284-命名空间与类的唯一性</li><li><input disabled="" type="checkbox"> 285-类的加载器的分类</li><li><input disabled="" type="checkbox"> 286-引导类加载器的说明</li><li><input disabled="" type="checkbox"> 287-扩展类加载器的说明</li><li><input disabled="" type="checkbox"> 288-系统类加载器的说明</li><li><input disabled="" type="checkbox"> 289-用户自定义类加载器的说明</li><li><input disabled="" type="checkbox"> 290-测试不同类使用的类加载器</li><li><input disabled="" type="checkbox"> 291-ClassLoader与Launcher的初步剖析</li><li><input disabled="" type="checkbox"> 292-ClassLoader的源码解析1</li><li><input disabled="" type="checkbox"> 293-ClassLoader的源码解析2</li><li><input disabled="" type="checkbox"> 294-ClassLoader子类的结构剖析</li><li><input disabled="" type="checkbox"> 295-双亲委派机制的优势与劣势</li><li><input disabled="" type="checkbox"> d296-三次双亲委派机制的破坏</li><li><input disabled="" type="checkbox"> 297-热替换的代码实现</li><li><input disabled="" type="checkbox"> 298-沙箱安全机制</li><li><input disabled="" type="checkbox"> 299-自定义类加载器的好处和应用场景</li><li><input disabled="" type="checkbox"> 300-自定义类加载器的代码实现</li><li><input disabled="" type="checkbox"> 301-Java9的新特性</li><li><input disabled="" type="checkbox"> 302-性能监控与调优篇概述</li><li><input disabled="" type="checkbox"> 303-见识一下大厂面试题</li><li><input disabled="" type="checkbox"> 304-为什么调优及监控的依据</li><li><input disabled="" type="checkbox"> 305-性能优化的三部曲</li><li><input disabled="" type="checkbox"> 306-4个性能测试指标及相关关系</li><li><input disabled="" type="checkbox"> 307-JVM命令行监控工具的概述</li><li><input disabled="" type="checkbox"> 308-jps：查看正在运行的Java进程</li><li><input disabled="" type="checkbox"> 309-jstat：基本语法</li><li><input disabled="" type="checkbox"> 310-jstat：如何排查OOM和内存泄漏</li><li><input disabled="" type="checkbox"> d311-jinfo：实时查看和修改JVM配置参数</li><li><input disabled="" type="checkbox"> 312-PrintFlagsFinal的使用</li><li><input disabled="" type="checkbox"> 313-jmap：各种option参数说明</li><li><input disabled="" type="checkbox"> 314-导出dump堆转储快照文件的两种方式</li><li><input disabled="" type="checkbox"> 315-jmap：如何显示堆内存等功能</li><li><input disabled="" type="checkbox"> 316-jhat：JDK自带堆分析工具</li><li><input disabled="" type="checkbox"> 317-jstack：追踪JVM中线程快照</li><li><input disabled="" type="checkbox"> d318-jcmd：多功能命令行工具</li><li><input disabled="" type="checkbox"> 319-jstatd：远程主机信息收集</li><li><input disabled="" type="checkbox"> 320-JVM监控及诊断的GUI工具概述</li><li><input disabled="" type="checkbox"> 321-jConsole的使用</li><li><input disabled="" type="checkbox"> 322-VisualVM的安装及连接方式</li><li><input disabled="" type="checkbox"> 323-VisualVM的基本功能</li><li><input disabled="" type="checkbox"> 324-VisualVM生成和查看堆dump文件</li><li><input disabled="" type="checkbox"> 325-Visual生成和分析线程dump文件</li><li><input disabled="" type="checkbox"> 326-VisualVM的CPU抽样和内存抽样</li><li><input disabled="" type="checkbox"> 327-MAT概述_获取dump的四种方式</li><li><input disabled="" type="checkbox"> 328-MAT界面主要功能概览</li><li><input disabled="" type="checkbox"> 329-MAT中Histogram的功能演示</li><li><input disabled="" type="checkbox"> 330-基于对象的出引用与入引用分析内存泄漏</li><li><input disabled="" type="checkbox"> 331-ShallowHeap与RetainedHeap</li><li><input disabled="" type="checkbox"> 332-案例分析：StudentTrace</li><li><input disabled="" type="checkbox"> 333-支配树的理解及应用</li><li><input disabled="" type="checkbox"> 334-案例：Tomcat堆溢出分析</li><li><input disabled="" type="checkbox"> 335-内存泄漏的理解与分类</li><li><input disabled="" type="checkbox"> 336-内存泄漏的8种情况</li><li><input disabled="" type="checkbox"> 337-内存泄漏分析案例1</li><li><input disabled="" type="checkbox"> 338-内存泄漏分析案例2</li><li><input disabled="" type="checkbox"> 339-OQL语句的使用举例</li><li><input disabled="" type="checkbox"> 340-JProfiler的使用概述</li><li><input disabled="" type="checkbox"> 341-JProfiler的安装和配置</li><li><input disabled="" type="checkbox"> 342-两种数据采集方式</li><li><input disabled="" type="checkbox"> 343-遥感监测视图中相关监测数据</li><li><input disabled="" type="checkbox"> 344-内存视图的分析</li><li><input disabled="" type="checkbox"> 345-Heap Walker功能演示</li><li><input disabled="" type="checkbox"> 346-CPU视图的功能说明</li><li><input disabled="" type="checkbox"> 347-Threads视图的功能说明</li><li><input disabled="" type="checkbox"> 348-JProfiler使用案例1</li><li><input disabled="" type="checkbox"> 349-JProfiler使用案例2</li><li><input disabled="" type="checkbox"> 350-为什么要引入Arthas</li><li><input disabled="" type="checkbox"> 351-Arthas的安装及对Java进程的监控</li><li><input disabled="" type="checkbox"> 352-Arthas中基础指令的使用</li><li><input disabled="" type="checkbox"> 353-dashboard命令和thread命令</li><li><input disabled="" type="checkbox"> 354-sysprop命令和heapdump命令</li><li><input disabled="" type="checkbox"> 355-sc命令和sm命令</li><li><input disabled="" type="checkbox"> 356-jad命令_mc命令_classloader命令</li><li><input disabled="" type="checkbox"> 357-monitor_watch_trace_stack_tt命令</li><li><input disabled="" type="checkbox"> 358-Arthas的其它相关命令</li><li><input disabled="" type="checkbox"> 359-JMC介绍_实时JVM监控</li><li><input disabled="" type="checkbox"> 360-Java Flight Recorder介绍和取样分析</li><li><input disabled="" type="checkbox"> 361-火焰图的使用介绍</li><li><input disabled="" type="checkbox"> 362-Tprofiler等工具的介绍</li><li><input disabled="" type="checkbox"> 363-JVM参数选项类型1：标准参数选项</li><li><input disabled="" type="checkbox"> 364-JVM参数选项类型2：-X参数选项</li><li><input disabled="" type="checkbox"> 365-JVM参数选项类型3：-XX参数选项</li><li><input disabled="" type="checkbox"> 366-如何添加JVM参数选项的说明</li><li><input disabled="" type="checkbox"> 367-打印设置的XX选项及值</li><li><input disabled="" type="checkbox"> 368-栈、堆、方法区内存的相关VM参数选项设置</li><li><input disabled="" type="checkbox"> 369-OutOfMemory相关VM参数选项的设置</li><li><input disabled="" type="checkbox"> 370-回顾经典的GC及相互搭配关系</li><li><input disabled="" type="checkbox"> 371-不同垃圾回收器的VM参数选项设置</li><li><input disabled="" type="checkbox"> 372-GC日志相关VM参数选项的设置</li><li><input disabled="" type="checkbox"> 373-了解其他VM参数选项</li><li><input disabled="" type="checkbox"> 374-通过Java代码获取JVM参数</li><li><input disabled="" type="checkbox"> 375-复习GC的分类</li><li><input disabled="" type="checkbox"> 376-GC日志的分类</li><li><input disabled="" type="checkbox"> 377-MinorGC的日志解析</li><li><input disabled="" type="checkbox"> 378-FullGC的日志解析</li><li><input disabled="" type="checkbox"> 379-在线日志分析工具：GCEasy</li><li><input disabled="" type="checkbox"> 380-其它日志分析工具：GCViewer、GChisto、HPjmeter</li><li><input disabled="" type="checkbox"> 381-OOM及性能优化案例与解决方案</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/309852b47cb6.html"/>
    <url>/2022/12/309852b47cb6.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-25 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-25_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-25_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-25_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/eb7a83b8d2e0.html"/>
    <url>/2022/12/eb7a83b8d2e0.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-24 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-24_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-24_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-24_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/5ab1501d6e8f.html"/>
    <url>/2022/12/5ab1501d6e8f.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-23 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-23_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-23_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-23_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/6864184b36c1.html"/>
    <url>/2022/12/6864184b36c1.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-26 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-26_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-26_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-26_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/7882ba100e5f.html"/>
    <url>/2022/12/7882ba100e5f.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-28 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-28_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-28_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-28_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/2dad49d8bb4d.html"/>
    <url>/2022/12/2dad49d8bb4d.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-27 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-27_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_6</li><li><input disabled="" type="checkbox"> 2022-11-27_7</li><li><input disabled="" type="checkbox"> 2022-11-27_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-27_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-27_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/4989edcca425.html"/>
    <url>/2022/12/4989edcca425.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-30 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-30_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-30_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-30_2</li><li><input disabled="" type="checkbox"> 2022-11-30_3</li><li><input disabled="" type="checkbox"> 2022-11-30_4</li><li><input disabled="" type="checkbox"> 2022-11-30_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/d2df766735cf.html"/>
    <url>/2022/12/d2df766735cf.html</url>
    
    <content type="html"><![CDATA[<p>2022-12-01 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-12-01_1</li><li><input disabled="" type="checkbox"> 2022-12-01_2</li><li><input disabled="" type="checkbox"> 2022-12-01_3</li><li><input disabled="" type="checkbox"> 2022-12-01_4</li><li><input disabled="" type="checkbox"> 2022-12-01_5</li><li><input disabled="" type="checkbox"> 2022-12-01_6</li><li><input disabled="" type="checkbox"> 2022-12-01_7</li><li><input disabled="" type="checkbox"> 2022-12-01_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input disabled="" type="checkbox"> 2022-12-01_1</li><li><input disabled="" type="checkbox"> 2022-12-01_2</li><li><input disabled="" type="checkbox"> 2022-12-01_3</li><li><input disabled="" type="checkbox"> 2022-12-01_4</li><li><input disabled="" type="checkbox"> 2022-12-01_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/a2bad990a849.html"/>
    <url>/2022/12/a2bad990a849.html</url>
    
    <content type="html"><![CDATA[<p>2022-11-29 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-29_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_5</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_6</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_7</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input checked="" disabled="" type="checkbox"> 2022-11-29_1</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_2</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_3</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_4</li><li><input checked="" disabled="" type="checkbox"> 2022-11-29_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/b756d53209da.html"/>
    <url>/2022/12/b756d53209da.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-在远端服务器上建立一个新的用户，专门用来存储-git-仓库"><a href="#1-在远端服务器上建立一个新的用户，专门用来存储-git-仓库" class="headerlink" title="1. 在远端服务器上建立一个新的用户，专门用来存储 git 仓库"></a>1. 在远端服务器上建立一个新的用户，专门用来存储 git 仓库</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">useradd git</span><br></code></pre></td></tr></table></figure><h1 id="2-在远端服务器上创建一个空的-git-仓库"><a href="#2-在远端服务器上创建一个空的-git-仓库" class="headerlink" title="2. 在远端服务器上创建一个空的 git 仓库"></a>2. 在远端服务器上创建一个空的 git 仓库</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git init --bare &lt;reponame&gt;<br></code></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[git@VM-4-16-centos ~]$ git init --bare coachhe-code<br>Initialized empty Git repository in /home/git/coachhe-code/<br>[git@VM-4-16-centos ~]$ ls<br>coachhe-code  company-working<br>[git@VM-4-16-centos ~]$ cd coachhe-code/<br>[git@VM-4-16-centos coachhe-code]$ ls<br>branches  config  description  HEAD  hooks  info  objects  refs<br></code></pre></td></tr></table></figure><p>可以看到，创建了一个空的仓库。</p><h1 id="3-在本地将仓库同步过来"><a href="#3-在本地将仓库同步过来" class="headerlink" title="3. 在本地将仓库同步过来"></a>3. 在本地将仓库同步过来</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> git@43.154.34.118:/home/git/coachhe-code coachhe-code</span><br>Cloning into &#x27;coachhe-code&#x27;...<br>warning: You appear to have cloned an empty repository.<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
      <category>Git</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/e32bbce3d98f.html"/>
    <url>/2022/12/e32bbce3d98f.html</url>
    
    <content type="html"><![CDATA[<p>2022-12-03 coachhe</p><h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>[[JVM学习计划]]</p><ul><li><input disabled="" type="checkbox"> 2022-12-03_1</li><li><input disabled="" type="checkbox"> 2022-12-03_2</li><li><input disabled="" type="checkbox"> 2022-12-03_3</li><li><input disabled="" type="checkbox"> 2022-12-03_4</li><li><input disabled="" type="checkbox"> 2022-12-03_5</li><li><input disabled="" type="checkbox"> 2022-12-03_6</li><li><input disabled="" type="checkbox"> 2022-12-03_7</li><li><input disabled="" type="checkbox"> 2022-12-03_8</li></ul><h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>[[Flink学习计划]]</p><ul><li><input disabled="" type="checkbox"> 2022-12-03_1</li><li><input disabled="" type="checkbox"> 2022-12-03_2</li><li><input disabled="" type="checkbox"> 2022-12-03_3</li><li><input disabled="" type="checkbox"> 2022-12-03_4</li><li><input disabled="" type="checkbox"> 2022-12-03_5</li></ul>]]></content>
    
    
    <categories>
      
      <category>学习进度</category>
      
      <category>计划</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/c799406dd5c4.html"/>
    <url>/2022/12/c799406dd5c4.html</url>
    
    <content type="html"><![CDATA[<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><h2 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h2><p>将应用和环境打包成一个镜像！</p><p>数据？如果数据都在容器中，那么我们容器删除，数据就会丢失！需求：数据可以持久化</p><p>MySQL，容器删除了，删库跑路！需求：MySQL数据可以存储在本地！</p><p>容器之间可以有一个数据共享的技术！Docker容器中产生的数据，同步到本地！</p><p>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Linux上面！</p><p><strong>总结一句话：容器的持久化和同步操作！容器间也是可以数据共享的！</strong></p><h2 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h2><blockquote><p>方法1 直接使用命令来挂载 -v</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it -v 主机目录：容器内目录 镜像<br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325155433.png"></p><p>之后</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325155537.png"></p><p>再来测试，关闭容器之后重新打开</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325155802.png"></p><p>依旧是同步的</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325160127.png"></p><p><strong>好处：我们以后修改只需要在本地修改即可，容器内会自动同步！</strong></p><h3 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">匿名挂载</span><br>-v 容器内路径!<br>docker run -d -P --name nginx01 -v /etc/nginx nginx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看所有的volume的情况</span><br>➜  ~ docker volume ls    <br>DRIVER              VOLUME NAME<br>local               33ae588fae6d34f511a769948f0d3d123c9d45c442ac7728cb85599c2657e50d<br>local            <br><span class="hljs-meta prompt_"># </span><span class="language-bash">这里发现，这种就是匿名挂载，我们在 -v只写了容器内的路径，没有写容器外的路劲！</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">具名挂载</span><br>➜  ~ docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx<br>➜  ~ docker volume ls                  <br>DRIVER              VOLUME NAME<br>local               juming-nginx<br><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325161309.png"></p><p>卷的目录：</p><p>所有的docker容器内的卷，没有指定目录的情况下都是在<code>/var/lib/docker/volumes/xxxx/_data</code>下；</p><p>我们可以通过具名挂载方便的找到一个卷，大多情况下在使用<code>具名挂载</code></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325162154.png"></p><p>拓展：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">通过 -v 容器内路径： ro rw 改变读写权限</span><br>ro #readonly 只读<br>rw #readwrite 可读可写<br>docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx<br>docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</span><br></code></pre></td></tr></table></figure><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325163225.png"></p><p>启动自己的容器</p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325164604.png"></p><p><img src="https://coachhe.oss-cn-shenzhen.aliyuncs.com/Docker/20210325164741.png"></p>]]></content>
    
    
    <categories>
      
      <category>微服务</category>
      
      <category>Docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/c1f825fe6bc9.html"/>
    <url>/2022/12/c1f825fe6bc9.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-操作系统的概念"><a href="#1-操作系统的概念" class="headerlink" title="1 操作系统的概念"></a>1 操作系统的概念</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><img src="https://pic.downk.cc/item/5fc885a9394ac523782ae5d6.png">  </p><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><h3 id="1、作为系统资源的管理者"><a href="#1、作为系统资源的管理者" class="headerlink" title="1、作为系统资源的管理者"></a>1、作为系统资源的管理者</h3><p><img src="https://pic.downk.cc/item/5fc885a9394ac523782ae5ce.png">  </p><h3 id="2、-作为用户和计算机硬件之间的接口（自下往上看）"><a href="#2、-作为用户和计算机硬件之间的接口（自下往上看）" class="headerlink" title="2、 作为用户和计算机硬件之间的接口（自下往上看）"></a>2、 作为用户和计算机硬件之间的接口（自下往上看）</h3><p>需要提供三个功能<br>a. 命令接口：允许用户直接使用<br>b. 程序接口：允许用户通过程序间接使用<br>c. GUI：现代操作系统中最流行的图形用户接口<br><img src="https://pic.downk.cc/item/5fc885a9394ac523782ae5c7.png"></p><h4 id="命令接口"><a href="#命令接口" class="headerlink" title="命令接口"></a>命令接口</h4><h5 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h5><ol><li>联机命令接口：用户说一句，操作系统做一句（例如打开cmd界面，输入time指令）<br><img src="https://pic.downk.cc/item/5fc885a9394ac523782ae5be.png">  </li><li>脱机命令接口：用户说一堆，操作系统做一堆,如.bat文件</li></ol><h5 id="程序接口"><a href="#程序接口" class="headerlink" title="程序接口"></a>程序接口</h5><p>如C:\Windows\System32\user.dll 程序员在程序中调用user32.dll(该调用过程为系统调用)即可创建窗口等功能。只能通过用户程序间接调用。 </p><h3 id="3、图形用户界面（GUI）"><a href="#3、图形用户界面（GUI）" class="headerlink" title="3、图形用户界面（GUI）"></a>3、图形用户界面（GUI）</h3><p>Windows、安卓等图形化操作界面<br><img src="https://pic.downk.cc/item/5fc885a9394ac523782ae5b6.png"></p><h3 id="4、-作为最接近硬件的层次"><a href="#4、-作为最接近硬件的层次" class="headerlink" title="4、 作为最接近硬件的层次"></a>4、 作为最接近硬件的层次</h3><h4 id="功能-1"><a href="#功能-1" class="headerlink" title="功能"></a>功能</h4><p>实现对硬件机器的拓展 </p><p>没有任何软件支持的计算机称为裸机，裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成更强、使用更方便的机器。 </p><h1 id="2-操作系统的特征"><a href="#2-操作系统的特征" class="headerlink" title="2 操作系统的特征"></a>2 操作系统的特征</h1><h2 id="1-并发"><a href="#1-并发" class="headerlink" title="1 并发"></a>1 并发</h2><p>并发指的是两个或多个事件在同一事件间隔发生。这些事件宏观上是同时发生的，但微观上是交替发生的。 </p><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>不同于并行，并行是微观和宏观都是同时发生的 </p><h3 id="操作系统的并发性："><a href="#操作系统的并发性：" class="headerlink" title="操作系统的并发性："></a>操作系统的并发性：</h3><p>计算机系统中同时存在着多个运行的程序 </p><h2 id="2-共享"><a href="#2-共享" class="headerlink" title="2 共享"></a>2 共享</h2><p>共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。 </p><h3 id="资源共享方式"><a href="#资源共享方式" class="headerlink" title="资源共享方式"></a>资源共享方式</h3><p><img src="https://pic.downk.cc/item/5fc8916a394ac52378335864.png"></p><h3 id="互斥共享方式"><a href="#互斥共享方式" class="headerlink" title="互斥共享方式"></a>互斥共享方式</h3><p>使用QQ和微信视频，同一时间段内摄像头只能分配给其中一个进程。 </p><h3 id="同时共享方式"><a href="#同时共享方式" class="headerlink" title="同时共享方式"></a>同时共享方式</h3><h4 id="宏观上看"><a href="#宏观上看" class="headerlink" title="宏观上看"></a>宏观上看</h4><p>两边都在同时读取并发送文件 </p><h4 id="微观上看"><a href="#微观上看" class="headerlink" title="微观上看"></a>微观上看</h4><p>两个进程是交替着访问硬盘的 </p><h2 id="3-虚拟"><a href="#3-虚拟" class="headerlink" title="3 虚拟"></a>3 虚拟</h2><p>虚拟是指把一个屋里上的实体变为若干逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的。 </p><h3 id="虚拟技术"><a href="#虚拟技术" class="headerlink" title="虚拟技术"></a>虚拟技术</h3><ol><li>空分复用 </li><li>时分复用</li></ol><h2 id="4-异步"><a href="#4-异步" class="headerlink" title="4 异步"></a>4 异步</h2><p>在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。</p><p>只有系统拥有并发性，才有可能导致异步性</p><h2 id="总结：并发和共享的区别"><a href="#总结：并发和共享的区别" class="headerlink" title="总结：并发和共享的区别"></a>总结：并发和共享的区别</h2><p>两者缺一不可，互为存在条件</p><p>并发和共享是操作系统<strong>最基本</strong>的两个特征</p><h1 id="3-操作系统的运行机制和体系结构"><a href="#3-操作系统的运行机制和体系结构" class="headerlink" title="3 操作系统的运行机制和体系结构"></a>3 操作系统的运行机制和体系结构</h1><h2 id="1-指令"><a href="#1-指令" class="headerlink" title="1 指令"></a>1 指令</h2><p>“指令”就是处理器（CPU）能够识别和执行的最基本命令<br><img src="https://pic.downk.cc/item/5fc89219394ac5237834149e.png"></p><p>例如： </p><p><img src="https://pic.downk.cc/item/5fc89219394ac5237834148d.png"></p><h3 id="指令的分类"><a href="#指令的分类" class="headerlink" title="指令的分类"></a>指令的分类</h3><ol><li>特权指令 </li><li>非特权指令</li></ol><h2 id="2-处理器状态和程序种类"><a href="#2-处理器状态和程序种类" class="headerlink" title="2 处理器状态和程序种类"></a>2 处理器状态和程序种类</h2><ol><li>用户态（自态）：此时CPU只能执行非特权指令   </li><li>核心态（管态）：特权指令、非特权指令都可以执行</li></ol><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>用程序状态字寄存器（PSW）中的某标志位来表示，0为用户态，1为核心态。  </p><h3 id="两种程序"><a href="#两种程序" class="headerlink" title="两种程序"></a>两种程序</h3><ol><li>内核程序：可以执行内核指令的程序 </li><li>应用程序（普通程序）</li></ol><h2 id="3-操作系统的内核"><a href="#3-操作系统的内核" class="headerlink" title="3 操作系统的内核"></a>3 操作系统的内核</h2><p><img src="https://pic.downk.cc/item/5fc892cd394ac5237834b5df.png"></p><p>操作系统还可以细分为两部分：最最核心的部分是内核，剩下的是非内核功能。 </p><h3 id="内核还可以继续细分"><a href="#内核还可以继续细分" class="headerlink" title="内核还可以继续细分"></a>内核还可以继续细分</h3><p><img src="https://pic.downk.cc/item/5fc892cd394ac5237834b5d1.png"></p><p>最接近计算机硬件的有： </p><ol><li>时钟管理：实现计时功能 </li><li>原语：具有原子性：特殊的程序，是最接近硬件的部分，这种程序的运行具有原子性（就是一旦运行就需要运行到底）</li></ol><p>所以<strong>内核&#x3D;时钟管理+终端处理+原语+（进程管理、存储器管理、设备管理等功能）</strong>； </p><h3 id="大内核和微内核"><a href="#大内核和微内核" class="headerlink" title="大内核和微内核"></a>大内核和微内核</h3><h4 id="大内核"><a href="#大内核" class="headerlink" title="大内核"></a>大内核</h4><p>大内核就是将操作系统主要模块都作为系统内核，运行在核心态 </p><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><p>高性能 </p><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><p>内核代码庞大，结构混乱，难以维护 </p><h4 id="微内核"><a href="#微内核" class="headerlink" title="微内核"></a>微内核</h4><p>只把最基本的功能保留在内核 </p><h5 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h5><p>内核功能烧，结构清晰，方便维护 </p><h5 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h5><p>需要频繁地在核心态和用户态之间切换，性能低 </p><h1 id="5-中断和异常"><a href="#5-中断和异常" class="headerlink" title="5 中断和异常"></a>5 中断和异常</h1><h2 id="中断机制的诞生"><a href="#中断机制的诞生" class="headerlink" title="中断机制的诞生"></a>中断机制的诞生</h2><p>最初一个时刻只能执行一个程序。效率很低</p><p>为了解决这个问题，人们发明了操作系统（作为计算机的管理者），引入中断机制，实现了多道程序并发执行。</p><p>发生中断就意味需要操作系统介入，开展管理工作。</p><h2 id="中断的概念和作用"><a href="#中断的概念和作用" class="headerlink" title="中断的概念和作用"></a>中断的概念和作用</h2><ol><li>当中断发生时，CPU立即进入核心态</li><li>当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理</li><li>对于不同的终端信号，会进行不同的处理</li></ol><p>发生了中断，就意味着操作系统接入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配I&#x2F;O设备等）需要使用特权指令，因此CPU要从用户态转为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权，有了中断，才能实现多道程序并发执行。</p><h3 id="用户态到核心态的方法"><a href="#用户态到核心态的方法" class="headerlink" title="用户态到核心态的方法"></a>用户态到核心态的方法</h3><p>“用户态→核心态”是通过中断实现的，并且中断是唯一途径。</p><p>“核心态→用户态”值需要通过一个特权指令，将PSW从1设置为0就行了。</p><h2 id="中断的分类"><a href="#中断的分类" class="headerlink" title="中断的分类"></a>中断的分类</h2><p><img src="https://pic.downk.cc/item/5fc895fc394ac52378368047.png"></p><h3 id="另一种分类方式"><a href="#另一种分类方式" class="headerlink" title="另一种分类方式"></a>另一种分类方式</h3><p><img src="https://pic.downk.cc/item/5fc895fc394ac52378368058.png"></p><h2 id="中断的处理过程"><a href="#中断的处理过程" class="headerlink" title="中断的处理过程"></a>中断的处理过程</h2><p><img src="https://pic.downk.cc/item/5fc895fc394ac5237836803f.png"> </p><h1 id="6-系统调用"><a href="#6-系统调用" class="headerlink" title="6 系统调用"></a>6 系统调用</h1><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p><img src="https://pic.downk.cc/item/5fc896df394ac5237836c779.png"><br>程序接口：面向应用程序（编程人员）：由一组系统调用组成 </p><h2 id="系统调用定义"><a href="#系统调用定义" class="headerlink" title="系统调用定义"></a>系统调用定义</h2><p>“系统调用”是操作系统提供给应用程序（程序员&#x2F;编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以发出系统调用请求来获得操作系统的服务。 </p><h2 id="系统调用作用"><a href="#系统调用作用" class="headerlink" title="系统调用作用"></a>系统调用作用</h2><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>两个人使用同一台打印机，同时按下打印按钮，如何确保不会混杂资料？ </p><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>操作系统提供“系统调用”功能，用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统发出请求。操作系统会对各个请求进行协调管理。 </p><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，凡是与资源有关的操作（如储存分配，I&#x2F;O操作、文件管理等），都必须通过系统调用的方法向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。 </p><h2 id="系统调用分类"><a href="#系统调用分类" class="headerlink" title="系统调用分类"></a>系统调用分类</h2><p><img src="https://pic.downk.cc/item/5fc89739394ac5237836e833.png"></p><h2 id="系统调用和库函数的区别"><a href="#系统调用和库函数的区别" class="headerlink" title="系统调用和库函数的区别"></a>系统调用和库函数的区别</h2><p><img src="https://pic.downk.cc/item/5fc89739394ac5237836e828.png"></p><h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>系统调用的相关处理在核心态运行，但是一般都被封装在了各种类库函数里，应用程序通过调用库函数间接地进行系统调用。 </p><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>不是所有库函数都有系统调用，只有一些涉及到内核的函数（例如创建一个文件等）才有，一些简单的如“取绝对值”的函数就不需要封装系统调用。 </p><h2 id="系统调用背后的过程"><a href="#系统调用背后的过程" class="headerlink" title="系统调用背后的过程"></a>系统调用背后的过程</h2><p><img src="https://pic.downk.cc/item/5fc89739394ac5237836e828.png"></p><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p><img src="https://pic.downk.cc/item/5fc89739394ac5237836e7fc.png"></p><h5 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h5><ol><li>陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，从而CPU进入核心态 </li><li>发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行 </li><li>陷入指令是唯一一个只能在用户态下执行，而不可以在核心态执行的指令。</li></ol>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>操作系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/5dec8aff61d9.html"/>
    <url>/2022/12/5dec8aff61d9.html</url>
    
    <content type="html"><![CDATA[<h1 id="1-进程的定义、组成、组织方式和特征"><a href="#1-进程的定义、组成、组织方式和特征" class="headerlink" title="1 进程的定义、组成、组织方式和特征"></a>1 进程的定义、组成、组织方式和特征</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>就是一个指令序列 </p><p>早期的计算机（只支持单道程序） </p><p><img src="https://pic.downk.cc/item/5fc8ae1e394ac5237846520c.png"></p><p>引入多道程序技术之后</p><p><img src="https://pic.downk.cc/item/5fc8ae5f394ac523784691d5.png"></p><h3 id="进程实体"><a href="#进程实体" class="headerlink" title="进程实体"></a>进程实体</h3><p><strong>程序段、数据段、PCB</strong>三部分组成了<strong>进程实体（进程映像）</strong>。一般情况下，我们把进程实体简称为进程。 </p><p><img src="https://pic.downk.cc/item/5fc8aeca394ac5237846ebc5.png"></p><h3 id="创建进程"><a href="#创建进程" class="headerlink" title="创建进程"></a>创建进程</h3><p>所谓创建进程，实质上是创建进程实体中的PCB </p><h3 id="撤销进程"><a href="#撤销进程" class="headerlink" title="撤销进程"></a>撤销进程</h3><p>撤销进程，实质上是撤销进程实体中的PCB </p><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。 </p><h2 id="2-进程的组成"><a href="#2-进程的组成" class="headerlink" title="2 进程的组成"></a>2 进程的组成</h2><p>进程由程序段、数据段、PCB三部分组成 </p><p><img src="https://pic.downk.cc/item/5fc8af0b394ac5237847215a.png"></p><h3 id="PCB"><a href="#PCB" class="headerlink" title="PCB"></a>PCB</h3><p>操作系统通过PCB来管理进程，因此PCB中包含操作系统对其进行管理所需的各种信息<br><img src="https://pic.downk.cc/item/5fc8af32394ac5237847475d.png">  </p><h3 id="程序段"><a href="#程序段" class="headerlink" title="程序段"></a>程序段</h3><p>程度代码存储位置 </p><h3 id="数据段"><a href="#数据段" class="headerlink" title="数据段"></a>数据段</h3><p>程序运行时使用、产生的运算数据。如全局变量、局部变量、宏定义的常量，就存放在数据段内。 </p><p>一个系统中有很多个PCB，为了能对它们加以有效的管理，应该用适当的方式将这些PCB组织起来。 </p><h2 id="3-进程的组织方式"><a href="#3-进程的组织方式" class="headerlink" title="3 进程的组织方式"></a>3 进程的组织方式</h2><p><img src="https://pic.downk.cc/item/5fc8af57394ac523784760fc.png"></p><h3 id="1-链接方式"><a href="#1-链接方式" class="headerlink" title="1. 链接方式"></a>1. 链接方式</h3><p><strong>步骤1</strong>:按照进程状态（三种状态：执行状态，就绪状态，阻塞状态）将PCB分为三个队列。 </p><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>执行状态只有1个（单核），就绪状态通常会把优先级高的进程放在队头。 </p><p><strong>步骤2</strong>：操作系统持有指向各个队列的指针 </p><p><img src="https://pic.downk.cc/item/5fc8af92394ac52378479fac.png"></p><h3 id="2-索引方式"><a href="#2-索引方式" class="headerlink" title="2. 索引方式"></a>2. 索引方式</h3><p><strong>步骤1</strong>：建立就绪状态和阻塞状态的两种就绪索引表，其中操作系统的指针指向每个表的表头<br><img src="https://pic.downk.cc/item/5fc8afb6394ac5237847bdbc.png"></p><h2 id="4-进程的特征"><a href="#4-进程的特征" class="headerlink" title="4 进程的特征"></a>4 进程的特征</h2><ol><li>动态性（最基本） </li><li>并发性 </li><li>独立性 </li><li>异步行 </li><li>结构性</li></ol><p><img src="https://pic.downk.cc/item/5fc8afef394ac5237847e055.png"></p><h1 id="2-进程的状态和转换"><a href="#2-进程的状态和转换" class="headerlink" title="2 进程的状态和转换"></a>2 进程的状态和转换</h1><h2 id="进程的三种基本状态"><a href="#进程的三种基本状态" class="headerlink" title="进程的三种基本状态"></a>进程的三种基本状态</h2><h3 id="1-运行态"><a href="#1-运行态" class="headerlink" title="1. 运行态"></a>1. 运行态</h3><h3 id="2-就绪态"><a href="#2-就绪态" class="headerlink" title="2. 就绪态"></a>2. 就绪态</h3><p>和运行态相比，就绪态拥有程序运行的除了处理机（CPU）以外的所有资源 </p><h3 id="3-阻塞态（等待态）"><a href="#3-阻塞态（等待态）" class="headerlink" title="3. 阻塞态（等待态）"></a>3. 阻塞态（等待态）</h3><p>和运行态相比，阻塞态没有处理机和其他资源。 </p><p><img src="https://pic.downk.cc/item/5fc8b1bc394ac5237849a7d6.png"></p><h3 id="另外两种状态"><a href="#另外两种状态" class="headerlink" title="另外两种状态"></a>另外两种状态</h3><p><img src="https://pic.downk.cc/item/5fc8b1df394ac5237849b4a4.png"></p><h2 id="进程状态的转换"><a href="#进程状态的转换" class="headerlink" title="进程状态的转换"></a>进程状态的转换</h2><p><img src="https://pic.downk.cc/item/5fc8cc20394ac5237856e485.png"></p><h1 id="3-进程控制"><a href="#3-进程控制" class="headerlink" title="3 进程控制"></a>3 进程控制</h1><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><p><img src="https://pic.downk.cc/item/5fc8cc68394ac52378575bd9.png"></p><h2 id="什么是进程控制"><a href="#什么是进程控制" class="headerlink" title="什么是进程控制"></a>什么是进程控制</h2><p><img src="https://pic.downk.cc/item/5fc8cc79394ac523785778b5.png"></p><h2 id="如何实现-原语"><a href="#如何实现-原语" class="headerlink" title="如何实现-原语"></a>如何实现-原语</h2><p><img src="https://pic.downk.cc/item/5fc8cc8a394ac5237857954a.png"></p><h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><p>若CPU让某个队列中的某个事件到另一个队列中，若PCB的状态没有相应转换（没来得及修改），则会变得很危险。 </p><h3 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h3><p>原语 </p><h3 id="原语特点"><a href="#原语特点" class="headerlink" title="原语特点"></a>原语特点</h3><p>原语的特点是执行期间不允许中断，只能一气呵成。 </p><h3 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h3><p>这种不可被中断的操作即原子操作。 </p><h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><p>原语采用“关中断指令”和“开中断指令”实现 </p><h4 id="理解："><a href="#理解：" class="headerlink" title="理解："></a>理解：</h4><p>也就是说，当需要执行原语代码时，关闭外部中断信号，执行完后，打开外部中断信号。这样就能保证原语不会被中断了。<br>因此，原语运行在核心态</p><h2 id="进程控制相关原语"><a href="#进程控制相关原语" class="headerlink" title="进程控制相关原语"></a>进程控制相关原语</h2><h3 id="原语要做的无非三件事"><a href="#原语要做的无非三件事" class="headerlink" title="原语要做的无非三件事"></a>原语要做的无非三件事</h3><ol><li>更新PCB中的信息（如修改进程状态标志，将运行环境保存到PCB，从PCB中恢复运行环境）<br>a. 所有的进程控制原语都一定会修改进程状态标志<br>b. 剥夺当前运行进程的CPU使用权必定修改进状态标志<br>c. 某进程开始运行前必然要恢复其运行环境 </li><li>将PCB插入合适的队列 </li><li>分配&#x2F;回收资源</li></ol><h3 id="创建原语"><a href="#创建原语" class="headerlink" title="创建原语"></a>创建原语</h3><p><img src="https://pic.downk.cc/item/5fc8cd1c394ac52378585dc0.png"></p><h3 id="撤销原语"><a href="#撤销原语" class="headerlink" title="撤销原语"></a>撤销原语</h3><p><img src="https://pic.downk.cc/item/5fc8cd2c394ac52378586863.png"></p><h3 id="进程的阻塞和唤醒"><a href="#进程的阻塞和唤醒" class="headerlink" title="进程的阻塞和唤醒"></a>进程的阻塞和唤醒</h3><p><img src="https://pic.downk.cc/item/5fc8cd3d394ac523785872eb.png"></p><h3 id="进程的切换"><a href="#进程的切换" class="headerlink" title="进程的切换"></a>进程的切换</h3><p><img src="https://pic.downk.cc/item/5fc8cd4b394ac52378587c18.png"></p><h1 id="4-进程的通信"><a href="#4-进程的通信" class="headerlink" title="4 进程的通信"></a>4 进程的通信</h1><p><img src="https://pic.downk.cc/item/5fc8cd94394ac5237858b4fd.png"></p><h2 id="进程通信定义和种类"><a href="#进程通信定义和种类" class="headerlink" title="进程通信定义和种类"></a>进程通信定义和种类</h2><p><img src="https://pic.downk.cc/item/5fc8cdb4394ac5237858d1a3.png"></p><h2 id="进程通信-共享存储"><a href="#进程通信-共享存储" class="headerlink" title="进程通信-共享存储"></a>进程通信-共享存储</h2><p>提供了一个互斥共享空间，也就是说，两个进程对共享空间的访问必须是互斥的（通过操作系统提供的工具实现） </p><p>操作系统只负责提供共享空间和同步互斥工具。 </p><h3 id="共享存储的两种方式"><a href="#共享存储的两种方式" class="headerlink" title="共享存储的两种方式"></a>共享存储的两种方式</h3><h4 id="1-基于数据结构的共享"><a href="#1-基于数据结构的共享" class="headerlink" title="1. 基于数据结构的共享"></a>1. 基于数据结构的共享</h4><p>比如共享空间里只能放一个长度为10的数组，这种共享方式速度慢，限制多，是一种低级通信方式 </p><h4 id="2-基于存储区的共享"><a href="#2-基于存储区的共享" class="headerlink" title="2. 基于存储区的共享"></a>2. 基于存储区的共享</h4><p>在内存中画出一块共享存储区，数据的形式、存放位置都由进程控制，而不是操作系统，这种方式速度快，是一种高级通信方式 </p><p><img src="https://pic.downk.cc/item/5fc8cdf2394ac5237858f83b.png"></p><h2 id="进程通信-管道通信"><a href="#进程通信-管道通信" class="headerlink" title="进程通信-管道通信"></a>进程通信-管道通信</h2><p>“管道”是指用于连续读写进程的一个共享文件，其实就是在内存中开辟一个大小固定的缓冲区。 </p><p><img src="https://pic.downk.cc/item/5fc8ce1d394ac52378590e81.png"></p><p><img src="https://pic.downk.cc/item/5fc8ce2f394ac52378591b8c.png"></p><h2 id="进程通信-消息传递"><a href="#进程通信-消息传递" class="headerlink" title="进程通信-消息传递"></a>进程通信-消息传递</h2><p>进程间的数据交换以格式化的消息（Message）为单位，进程通过操作系统提供的“发送消息&#x2F;接收消息”两个原语进行数据交流。 </p><p><img src="https://pic.downk.cc/item/5fc8ce4a394ac52378592ba8.png"></p><h1 id="5-线程概念和多线程模型"><a href="#5-线程概念和多线程模型" class="headerlink" title="5 线程概念和多线程模型"></a>5 线程概念和多线程模型</h1><p><img src="https://pic.downk.cc/item/5fc8ce69394ac5237859416e.png"></p><h3 id="线程的定义"><a href="#线程的定义" class="headerlink" title="线程的定义"></a>线程的定义</h3><p>引入线程之后，计算机可以同时执行两个程序（例如同时使用QQ和音乐），但是在一个程序里我们可能希望使用多个功能（例如QQ里的聊天和视频） </p><p>传统的进程是程序执行流的最小单位，不能满足要求，因此，<strong>引入了“线程”，来增加并发度</strong></p><p><img src="https://pic.downk.cc/item/5fc8ce89394ac523785953af.png"></p><h3 id="线程成为了程序执行流的最小单位"><a href="#线程成为了程序执行流的最小单位" class="headerlink" title="线程成为了程序执行流的最小单位"></a>线程成为了程序执行流的最小单位</h3><p>线程是一个基本的CPU执行单元，也是程序执行流的最小单位。 </p><p>引入线程后，<strong>进程只作为除CPU之外的系统资源的分配单元</strong>（如打印机、内存地址空间等都是分配给进程的）。 </p><h2 id="引入进程机制后的变化"><a href="#引入进程机制后的变化" class="headerlink" title="引入进程机制后的变化"></a>引入进程机制后的变化</h2><p><img src="https://pic.downk.cc/item/5fc8ceb8394ac523785974dc.png"></p><h3 id="类比"><a href="#类比" class="headerlink" title="类比"></a>类比</h3><p><img src="https://pic.downk.cc/item/5fc8cecd394ac52378598466.png"></p><h3 id="线程的属性"><a href="#线程的属性" class="headerlink" title="线程的属性"></a>线程的属性</h3><p><img src="https://pic.downk.cc/item/5fc8cee2394ac5237859901d.png"></p><h3 id="线程的实现方式"><a href="#线程的实现方式" class="headerlink" title="线程的实现方式"></a>线程的实现方式</h3><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><h4 id="用户级线程"><a href="#用户级线程" class="headerlink" title="用户级线程"></a>用户级线程</h4><p><img src="https://pic.downk.cc/item/5fc8cf06394ac5237859ac84.png"></p><h4 id="内核级线程"><a href="#内核级线程" class="headerlink" title="内核级线程"></a>内核级线程</h4><p><img src="https://pic.downk.cc/item/5fc8cf31394ac5237859c95b.png"></p><p><img src="https://pic.downk.cc/item/5fc8cf49394ac5237859e0ad.png"></p><h2 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h2><h3 id="多对一模型"><a href="#多对一模型" class="headerlink" title="多对一模型"></a>多对一模型</h3><p><img src="https://pic.downk.cc/item/5fc8cf71394ac523785a099a.png"></p><h3 id="一对一模型（纯粹的内核级线程）"><a href="#一对一模型（纯粹的内核级线程）" class="headerlink" title="一对一模型（纯粹的内核级线程）"></a>一对一模型（纯粹的内核级线程）</h3><p><img src="https://pic.downk.cc/item/5fc8cf88394ac523785a1f26.png"></p><h3 id="多对多模型"><a href="#多对多模型" class="headerlink" title="多对多模型"></a>多对多模型</h3><p><img src="https://pic.downk.cc/item/5fc8cf99394ac523785a3465.png"></p>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>操作系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/5518cc84c62b.html"/>
    <url>/2022/12/5518cc84c62b.html</url>
    
    <content type="html"><![CDATA[<h1 id="什么是操作系统"><a href="#什么是操作系统" class="headerlink" title="什么是操作系统"></a>什么是操作系统</h1><p>操作系统是计算机硬件和应用之间的一层软件。</p><h2 id="操作系统的作用"><a href="#操作系统的作用" class="headerlink" title="操作系统的作用"></a>操作系统的作用</h2><ol><li>方便我们使用硬件，如使用显存</li><li>高效地使用硬件，如开多个终端</li></ol><h2 id="管理哪些硬件"><a href="#管理哪些硬件" class="headerlink" title="管理哪些硬件"></a>管理哪些硬件</h2><ol><li>CPU管理</li><li>内存管理</li><li>终端管理</li><li>磁盘管理</li><li>文件管理</li><li>网络管理</li><li>电源管理</li><li>多核管理</li></ol><h2 id="学习操作系统的层次"><a href="#学习操作系统的层次" class="headerlink" title="学习操作系统的层次"></a>学习操作系统的层次</h2><ol><li>从应用软件出发“探到操作系统”<ol><li>集中在使用计算机的接口上</li><li>使用显示器：printf；使用CPU：fork，使用文件：open、read….</li></ol></li><li>从应用软件出发“进入操作系统”。&#x3D;&#x3D;本门课程目标&#x3D;&#x3D;<br>1. 一段文件是如何写入磁盘的</li><li>从硬件出发“设计并实现操作系统”<ol><li>给你一个板子，配一个操作系统</li></ol></li></ol><p>我们的目标是从应用软件出发进入操作系统</p><ol><li>能理解真实操作系统的运转</li><li>printf(“hello world“)到底是怎么回事</li><li>能在真是的基本操作系统上动手实践</li></ol>]]></content>
    
    
    <categories>
      
      <category>计算机</category>
      
      <category>操作系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/43d3ff7f92b8.html"/>
    <url>/2022/12/43d3ff7f92b8.html</url>
    
    <content type="html"><![CDATA[<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>腾讯云轻量服务器，可以直接购买 wordpress，会配置上用户名和密码。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212233928.png"></p><h1 id="基础设置"><a href="#基础设置" class="headerlink" title="基础设置"></a>基础设置</h1><p>登录服务器访问之后，可以得到网站地址，用户名和密码，以及数据库的密码，就可以顺利进行登录了。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212234031.png"></p><p>接着就直接登录上去了，进入管理界面：</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212234110.png"></p><p>在设置这里可以进行一系列的基础设置：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212234304.png"></p><p>基础设置：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212234408.png"></p><p>进行基本设置之后就可以看到浏览效果：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212234605.png"></p><h1 id="更改主题"><a href="#更改主题" class="headerlink" title="更改主题"></a>更改主题</h1><p>更改为 astra 主题，接下来的教程都会基于这个主题来进行。</p><p><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212234827.png"></p><p>结果就是刷新之后主题彻底变更了<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212235004.png"></p><h1 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h1><p>首先安装 elementor 插件：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211212235147.png"></p><h1 id="Astra-主题操作"><a href="#Astra-主题操作" class="headerlink" title="Astra 主题操作"></a>Astra 主题操作</h1><p>首先安装插件<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211213003833.png"></p><p>安装导入插件之后会出现导航：<br><img src="https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20211213004921.png"></p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
      <category>WordPress</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/8dd807d1977c.html"/>
    <url>/2022/12/8dd807d1977c.html</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>大数据</category>
      
      <category>Hadoop生态</category>
      
      <category>HBase</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/1d0794edaf56.html"/>
    <url>/2022/12/1d0794edaf56.html</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java Web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/b64df2354d3e.html"/>
    <url>/2022/12/b64df2354d3e.html</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java语言</category>
      
      <category>JVM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/abfa7e31ab72.html"/>
    <url>/2022/12/abfa7e31ab72.html</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Go</category>
      
      <category>Go项目</category>
      
      <category>工单系统</category>
      
      <category>ferry工单系统</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/12/38167ee76c84.html"/>
    <url>/2022/12/38167ee76c84.html</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
      <category>Java</category>
      
      <category>Java开发</category>
      
      <category>Java框架</category>
      
      <category>Spring</category>
      
      <category>源码</category>
      
      <category>《Spring源码深度解析》</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
