---
categories:
  - 计算机
  - 操作系统
---
# 1 操作系统的概念

## 概念

![](https://pic.downk.cc/item/5fc885a9394ac523782ae5d6.png)  

## 功能

### 1、作为系统资源的管理者 
![](https://pic.downk.cc/item/5fc885a9394ac523782ae5ce.png)  


### 2、 作为用户和计算机硬件之间的接口（自下往上看） 
需要提供三个功能  
a. 命令接口：允许用户直接使用  
b. 程序接口：允许用户通过程序间接使用  
c. GUI：现代操作系统中最流行的图形用户接口 
![](https://pic.downk.cc/item/5fc885a9394ac523782ae5c7.png)

#### 命令接口 

##### 分类 
1. 联机命令接口：用户说一句，操作系统做一句（例如打开cmd界面，输入time指令） 
![](https://pic.downk.cc/item/5fc885a9394ac523782ae5be.png)  
2. 脱机命令接口：用户说一堆，操作系统做一堆,如.bat文件 

##### 程序接口 

如C:\Windows\System32\user.dll 程序员在程序中调用user32.dll(该调用过程为系统调用)即可创建窗口等功能。只能通过用户程序间接调用。 

 

### 3、图形用户界面（GUI） 

Windows、安卓等图形化操作界面 
![](https://pic.downk.cc/item/5fc885a9394ac523782ae5b6.png)

### 4、 作为最接近硬件的层次 

#### 功能
实现对硬件机器的拓展 

没有任何软件支持的计算机称为裸机，裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成更强、使用更方便的机器。 

 

# 2 操作系统的特征

## 1 并发

并发指的是两个或多个事件在同一事件间隔发生。这些事件宏观上是同时发生的，但微观上是交替发生的。 

### 注意：

不同于并行，并行是微观和宏观都是同时发生的 

### 操作系统的并发性： 

计算机系统中同时存在着多个运行的程序 

## 2 共享 

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。 

 

### 资源共享方式 
![](https://pic.downk.cc/item/5fc8916a394ac52378335864.png)

### 互斥共享方式 

使用QQ和微信视频，同一时间段内摄像头只能分配给其中一个进程。 

### 同时共享方式 

#### 宏观上看
两边都在同时读取并发送文件 

#### 微观上看
两个进程是交替着访问硬盘的 

## 3 虚拟

虚拟是指把一个屋里上的实体变为若干逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的。 

### 虚拟技术 
1. 空分复用 
2. 时分复用 

## 4 异步

在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

只有系统拥有并发性，才有可能导致异步性

## 总结：并发和共享的区别

两者缺一不可，互为存在条件

并发和共享是操作系统**最基本**的两个特征

# 3 操作系统的运行机制和体系结构

## 1 指令

“指令”就是处理器（CPU）能够识别和执行的最基本命令   
![](https://pic.downk.cc/item/5fc89219394ac5237834149e.png)

例如： 

![](https://pic.downk.cc/item/5fc89219394ac5237834148d.png)

### 指令的分类 
1. 特权指令 
2. 非特权指令 

## 2 处理器状态和程序种类

1. 用户态（自态）：此时CPU只能执行非特权指令   
2. 核心态（管态）：特权指令、非特权指令都可以执行 

### 区别

用程序状态字寄存器（PSW）中的某标志位来表示，0为用户态，1为核心态。  

### 两种程序 

1. 内核程序：可以执行内核指令的程序 
2. 应用程序（普通程序） 

## 3 操作系统的内核

![](https://pic.downk.cc/item/5fc892cd394ac5237834b5df.png)

操作系统还可以细分为两部分：最最核心的部分是内核，剩下的是非内核功能。 

### 内核还可以继续细分 
![](https://pic.downk.cc/item/5fc892cd394ac5237834b5d1.png)

最接近计算机硬件的有： 
1. 时钟管理：实现计时功能 
2. 原语：具有原子性：特殊的程序，是最接近硬件的部分，这种程序的运行具有原子性（就是一旦运行就需要运行到底） 

所以**内核=时钟管理+终端处理+原语+（进程管理、存储器管理、设备管理等功能）**； 


### 大内核和微内核 

#### 大内核 

大内核就是将操作系统主要模块都作为系统内核，运行在核心态 

##### 优点
高性能 
##### 缺点
内核代码庞大，结构混乱，难以维护 

#### 微内核 
只把最基本的功能保留在内核 

##### 优点
内核功能烧，结构清晰，方便维护 
##### 缺点
需要频繁地在核心态和用户态之间切换，性能低 



# 5 中断和异常

## 中断机制的诞生

最初一个时刻只能执行一个程序。效率很低

为了解决这个问题，人们发明了操作系统（作为计算机的管理者），引入中断机制，实现了多道程序并发执行。

发生中断就意味需要操作系统介入，开展管理工作。

## 中断的概念和作用

1. 当中断发生时，CPU立即进入核心态
2. 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理
3. 对于不同的终端信号，会进行不同的处理

发生了中断，就意味着操作系统接入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配I/O设备等）需要使用特权指令，因此CPU要从用户态转为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权，有了中断，才能实现多道程序并发执行。

### 用户态到核心态的方法

“用户态→核心态”是通过中断实现的，并且中断是唯一途径。

“核心态→用户态”值需要通过一个特权指令，将PSW从1设置为0就行了。

## 中断的分类

![](https://pic.downk.cc/item/5fc895fc394ac52378368047.png)

### 另一种分类方式 

![](https://pic.downk.cc/item/5fc895fc394ac52378368058.png)

 

## 中断的处理过程

![](https://pic.downk.cc/item/5fc895fc394ac5237836803f.png) 

 # 6 系统调用

## 回顾
![](https://pic.downk.cc/item/5fc896df394ac5237836c779.png)  
程序接口：面向应用程序（编程人员）：由一组系统调用组成 

## 系统调用定义 

“系统调用”是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以发出系统调用请求来获得操作系统的服务。 

## 系统调用作用 

### 场景
两个人使用同一台打印机，同时按下打印按钮，如何确保不会混杂资料？ 

### 解决方法
操作系统提供“系统调用”功能，用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统发出请求。操作系统会对各个请求进行协调管理。 

### 作用 

应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，凡是与资源有关的操作（如储存分配，I/O操作、文件管理等），都必须通过系统调用的方法向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。 

 ## 系统调用分类

![](https://pic.downk.cc/item/5fc89739394ac5237836e833.png)

## 系统调用和库函数的区别

![](https://pic.downk.cc/item/5fc89739394ac5237836e828.png)

### 解释 

系统调用的相关处理在核心态运行，但是一般都被封装在了各种类库函数里，应用程序通过调用库函数间接地进行系统调用。 

##### 注意

不是所有库函数都有系统调用，只有一些涉及到内核的函数（例如创建一个文件等）才有，一些简单的如“取绝对值”的函数就不需要封装系统调用。 

## 系统调用背后的过程

![](https://pic.downk.cc/item/5fc89739394ac5237836e828.png)

### 运行

![](https://pic.downk.cc/item/5fc89739394ac5237836e7fc.png)


##### 注意 

1. 陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，从而CPU进入核心态 
2. 发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行 
3. 陷入指令是唯一一个只能在用户态下执行，而不可以在核心态执行的指令。 







