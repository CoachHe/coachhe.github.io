# 1 进程的定义、组成、组织方式和特征

## 定义 
就是一个指令序列 

早期的计算机（只支持单道程序） 

![](https://pic.downk.cc/item/5fc8ae1e394ac5237846520c.png)

引入多道程序技术之后

![](https://pic.downk.cc/item/5fc8ae5f394ac523784691d5.png)

### 进程实体 

**程序段、数据段、PCB**三部分组成了**进程实体（进程映像）**。一般情况下，我们把进程实体简称为进程。 

![](https://pic.downk.cc/item/5fc8aeca394ac5237846ebc5.png)

### 创建进程 
所谓创建进程，实质上是创建进程实体中的PCB 

### 撤销进程 
撤销进程，实质上是撤销进程实体中的PCB 

### 进程 

进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。 

## 2 进程的组成

进程由程序段、数据段、PCB三部分组成 

![](https://pic.downk.cc/item/5fc8af0b394ac5237847215a.png)

### PCB 

操作系统通过PCB来管理进程，因此PCB中包含操作系统对其进行管理所需的各种信息   
![](https://pic.downk.cc/item/5fc8af32394ac5237847475d.png)  

### 程序段 

程度代码存储位置 

### 数据段 

程序运行时使用、产生的运算数据。如全局变量、局部变量、宏定义的常量，就存放在数据段内。 



一个系统中有很多个PCB，为了能对它们加以有效的管理，应该用适当的方式将这些PCB组织起来。 

 

## 3 进程的组织方式

![](https://pic.downk.cc/item/5fc8af57394ac523784760fc.png)

### 1. 链接方式 

**步骤1**:按照进程状态（三种状态：执行状态，就绪状态，阻塞状态）将PCB分为三个队列。 

##### 注意 
执行状态只有1个（单核），就绪状态通常会把优先级高的进程放在队头。 

**步骤2**：操作系统持有指向各个队列的指针 

![](https://pic.downk.cc/item/5fc8af92394ac52378479fac.png)

### 2. 索引方式 

**步骤1**：建立就绪状态和阻塞状态的两种就绪索引表，其中操作系统的指针指向每个表的表头
![](https://pic.downk.cc/item/5fc8afb6394ac5237847bdbc.png)



## 4 进程的特征

1. 动态性（最基本） 
2. 并发性 
3. 独立性 
4. 异步行 
5. 结构性 

![](https://pic.downk.cc/item/5fc8afef394ac5237847e055.png)



# 2 进程的状态和转换

## 进程的三种基本状态

### 1. 运行态 

### 2. 就绪态 

和运行态相比，就绪态拥有程序运行的除了处理机（CPU）以外的所有资源 

### 3. 阻塞态（等待态） 

和运行态相比，阻塞态没有处理机和其他资源。 

![](https://pic.downk.cc/item/5fc8b1bc394ac5237849a7d6.png)

### 另外两种状态

![](https://pic.downk.cc/item/5fc8b1df394ac5237849b4a4.png)



## 进程状态的转换

![](https://pic.downk.cc/item/5fc8cc20394ac5237856e485.png)

# 3 进程控制

## 大纲

![](https://pic.downk.cc/item/5fc8cc68394ac52378575bd9.png)



## 什么是进程控制

![](https://pic.downk.cc/item/5fc8cc79394ac523785778b5.png)



## 如何实现-原语

![](https://pic.downk.cc/item/5fc8cc8a394ac5237857954a.png)


### 问题： 

若CPU让某个队列中的某个事件到另一个队列中，若PCB的状态没有相应转换（没来得及修改），则会变得很危险。 

### 解决方式
原语 

### 原语特点 

原语的特点是执行期间不允许中断，只能一气呵成。 

### 原子操作 

这种不可被中断的操作即原子操作。 

### 实现方式 

原语采用“关中断指令”和“开中断指令”实现 

#### 理解： 

也就是说，当需要执行原语代码时，关闭外部中断信号，执行完后，打开外部中断信号。这样就能保证原语不会被中断了。  
因此，原语运行在核心态

## 进程控制相关原语

### 原语要做的无非三件事 

1. 更新PCB中的信息（如修改进程状态标志，将运行环境保存到PCB，从PCB中恢复运行环境）    
   a. 所有的进程控制原语都一定会修改进程状态标志   
   b. 剥夺当前运行进程的CPU使用权必定修改进状态标志   
   c. 某进程开始运行前必然要恢复其运行环境 
2. 将PCB插入合适的队列 
3. 分配/回收资源 

### 创建原语
![](https://pic.downk.cc/item/5fc8cd1c394ac52378585dc0.png)

### 撤销原语
![](https://pic.downk.cc/item/5fc8cd2c394ac52378586863.png)

### 进程的阻塞和唤醒 
![](https://pic.downk.cc/item/5fc8cd3d394ac523785872eb.png)

### 进程的切换 
![](https://pic.downk.cc/item/5fc8cd4b394ac52378587c18.png)

# 4 进程的通信

![](https://pic.downk.cc/item/5fc8cd94394ac5237858b4fd.png)

## 进程通信定义和种类

![](https://pic.downk.cc/item/5fc8cdb4394ac5237858d1a3.png)

## 进程通信-共享存储

提供了一个互斥共享空间，也就是说，两个进程对共享空间的访问必须是互斥的（通过操作系统提供的工具实现） 

操作系统只负责提供共享空间和同步互斥工具。 


### 共享存储的两种方式 

#### 1. 基于数据结构的共享   
比如共享空间里只能放一个长度为10的数组，这种共享方式速度慢，限制多，是一种低级通信方式 
#### 2. 基于存储区的共享   
在内存中画出一块共享存储区，数据的形式、存放位置都由进程控制，而不是操作系统，这种方式速度快，是一种高级通信方式 

![](https://pic.downk.cc/item/5fc8cdf2394ac5237858f83b.png)

## 进程通信-管道通信

“管道”是指用于连续读写进程的一个共享文件，其实就是在内存中开辟一个大小固定的缓冲区。 

![](https://pic.downk.cc/item/5fc8ce1d394ac52378590e81.png)

![](https://pic.downk.cc/item/5fc8ce2f394ac52378591b8c.png)



## 进程通信-消息传递

进程间的数据交换以格式化的消息（Message）为单位，进程通过操作系统提供的“发送消息/接收消息”两个原语进行数据交流。 

![](https://pic.downk.cc/item/5fc8ce4a394ac52378592ba8.png)

# 5 线程概念和多线程模型

![](https://pic.downk.cc/item/5fc8ce69394ac5237859416e.png)

### 线程的定义

引入线程之后，计算机可以同时执行两个程序（例如同时使用QQ和音乐），但是在一个程序里我们可能希望使用多个功能（例如QQ里的聊天和视频） 

 

传统的进程是程序执行流的最小单位，不能满足要求，因此，**引入了“线程”，来增加并发度**

![](https://pic.downk.cc/item/5fc8ce89394ac523785953af.png)

### 线程成为了程序执行流的最小单位 

线程是一个基本的CPU执行单元，也是程序执行流的最小单位。 

引入线程后，**进程只作为除CPU之外的系统资源的分配单元**（如打印机、内存地址空间等都是分配给进程的）。 

## 引入进程机制后的变化

![](https://pic.downk.cc/item/5fc8ceb8394ac523785974dc.png)

### 类比
![](https://pic.downk.cc/item/5fc8cecd394ac52378598466.png)

### 线程的属性

![](https://pic.downk.cc/item/5fc8cee2394ac5237859901d.png)



### 线程的实现方式

### 分类 

#### 用户级线程

![](https://pic.downk.cc/item/5fc8cf06394ac5237859ac84.png)

#### 内核级线程 

![](https://pic.downk.cc/item/5fc8cf31394ac5237859c95b.png)

![](https://pic.downk.cc/item/5fc8cf49394ac5237859e0ad.png)

## 多线程模型

### 多对一模型
![](https://pic.downk.cc/item/5fc8cf71394ac523785a099a.png)

### 一对一模型（纯粹的内核级线程）
![](https://pic.downk.cc/item/5fc8cf88394ac523785a1f26.png)

### 多对多模型

![](https://pic.downk.cc/item/5fc8cf99394ac523785a3465.png)













