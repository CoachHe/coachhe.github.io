---
title: 7.3.1 加载
tags: []
categories:
  - 编程语言
  - Java
  - Java语言
  - JVM
  - 第7章 虚拟机类加载机制
  - 7.3 类加载的过程
date: 2022-12-29 17:11:16
---

注意：这里的加载≠类加载，只是类加载的一个阶段。

在加载阶段，Java 虚拟机需要完成以下三件事情：
1. 通过一个类的全限定名来获取定义此类的二进制字节流
2. 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。
3. 在内存中生成一个代表这个类的 `java.lang.Class` 对象，作为方法区这个类的各种数据的访问入口。

注意：这个阶段是最灵活的一个阶段，也是开发人员可控性最强的阶段。

例如“通过一个类的全限定名来获取定义此类的二进制字节流”这条规则. 它并没有指明二进制字节流必须得从某个 Class 文件中获取，确切地说是根本没有指明要从哪里获取、如何获取。仅仅这一点空隙，Java 虚拟机的使用者们就可以在加载阶段搭构建出一个相当开放广阔的舞台，Java 发展历程中，充满创造力的开发人员则在这个舞台上玩出了各种花样，许多举足轻重的 Java 技术都建立在这一基础之上，
- 例如最典型的从 ZIP 压缩包中读取，也就是日后 JAR 格式的基础。
- 从网络中获取
- 运行时计算生成，这种场景用的最多的就是动态代理技术。
- ...

加载阶段既可以使用 Java 虚拟机里内置的引导类加载器来完成，也可以由用户自定义的类加载器去完成，开发人员通过定义自己的类加载器去控制字节流的获取方式（重写一个类加载器的 `findClass()` 或 `loadClass()` 方法），实现根据自己的想法来赋予应用程序获取运行代码的动态性。

也就是说，加载阶段完成之后，类加载器已经调用过 loadClass 方法来生成一个 Class 对象了（具体可以看 [[Java反射浅析]])。

具体来说，加载阶段结束后，Java 虚拟机外部的二进制字节流就按照虚拟机所设定的格式存储在方法区之中了，方法区中的数据存储格式完全由虚拟机实现自行定义，《Java 虚拟机规范》未规定此区域的具体数据结构。类型数据妥善安置在方法区之后，会在 Java 堆内存中实例化一个 java. lang. dass 类的对象，这个对象将作为程序访问方法区中的类型数据的外部接口。加载阶段与连接阶段的部分动作（如一部分字节码文件格式验证动作）是交叉进行的，加载阶段尚未完成，连接阶段可能已经开始，但这些夹在加载阶段之中进行的动作，仍然属于连接阶段的一部分，这两个阶段的开始时间仍然保持着固定的先后顺序。
