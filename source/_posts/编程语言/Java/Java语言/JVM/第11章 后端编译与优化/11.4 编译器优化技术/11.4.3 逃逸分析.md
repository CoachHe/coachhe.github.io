---
title: 11.4.3 逃逸分析  
date: 2023-01-02 02:11:25  
tags: []  
---

逃逸分析（Escape Analysis）是目前 Java 虚拟机中比较前沿的优化技术，它与类型继承关系分析一样，并不是直接优化代码的手段，而是为其他优化措施提供依据的分析技术。

随着 JIT 编译器的发展与**逃逸分析技术**逐渐成熟，**栈上分配、标量替换优化技术**将会导致一些微妙的变化，所有的对象都分配到堆上也渐渐变得不那么“绝对“了。


# 逃逸分析的原理

## 方法逃逸

分析对象动态作用域，当一个对象在方法里面被定义后，它可能被外部方法所引用，例如作为调用参数传递到其他方法中，这种称为方法逃逸；

## 线程逃逸

分析对象动态作用域，当一个对象在方法里面被定义后，它可能被外部线程访问到，譬如赋值给可以在其他线程中访问的实例变量，这种称为线程逃逸；

## 逃逸程度

从不逃逸、方法逃逸到线程逃逸，称为对象由低到高的不同逃逸程度。

# 逃逸分析进行的优化

如果能证明一个对象不会逃逸到方法或线程之外（也就是说别的方法或线程无法通过任何途径访问到这个对象），或者逃逸程度比较低（只能逃逸出方法而不会逃逸出线程），则可能为这个对象实例采取不同程度的优化。

典型的如：

```java
public void my_method() {
	V v = new V();
	// use v
	// ...
	v = null;
}
```

可以看到，这里的 v 就没有逃逸出方法，有可能就可以进行优化；

如：

- 栈上分配（Stack Allocations）
- 标量替换（Scalar Replacement）
- 同步消除（Synchronization Elimination）



