---
title: 2.4.2 对象的内存布局  
date: 2023-01-03 13:23:36  
tags: []  
---

也是先来看张图：

<img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20230106003154.png" width = "100%" />

在 HotSpot 虚拟机中，对象在堆内存理中的存储布局可以划分为三个部分
- 对象头 (Header)
- 实例数据 (Instance Data)
- 对齐填充 (Padding)

# 对象头

对象头由两部分组成：

1. 运行时元数据
2. 类型指针

## 运行时元数据 (Mark Word)

1. 哈希值
2. GC 分代年龄
3. 锁状态标志
4. 线程持有的锁
5. 偏向线程 ID
6. 偏向时间戳

## 类型指针

指向类元数据 InstanceKlass，确定该对象所属的类型

## 说明

如果是数组，还需要记录数组的长度

# 实例数据

这部分数据是对象真正存储的有效信息，包括程序代码中定义的各种类型的字段，包括从父类继承下来的和本身拥有的字段

## 规则

- 相同宽度的字段总是会被分配在一起
- 父类中定义的字段会出现在子类之前
- 如果 CompactFields 参数为 true（默认为 true）：子类的窄变量可能插入到父类变量的空隙

# 对齐填充

这并不是必然存在的，也没有特别的含义，它仅仅起着占位符的作用。

由于 HotSpot 虚拟机的自动内存管理系统要求对象的起始地址必须是 8 字节的整数倍，换句话说==任何对象的大小都必须是 8 字节的整数倍==。对象头部分已经被精心设计成正好是 8 字节的背书，因此，如果对象实例数据部分没有对齐的话，就需要通过对齐来补全。









