---
title: 2.3.5 运行时常量池
tags: []
categories:
  - 编程语言
  - Java
  - Java语言
  - JVM
  - 第2章 Java内存区域与内存溢出异常
  - 2.3 运行时数据区域
date: 2022-12-29 15:55:08
---

# 为什么需要常量池

一个 java 源文件中的类、接口，编译后产生的一个字节码文件。而 Java 种的字节码需要数据支持，通常这种数据会很大以至于不能直接存在字节码里，换一种方式，可以存在常量池，这个字节码包含了指向常量池的引用。在动态链接的时候会用到运行时常量池。

比如：

```java
public class SimpleClass {
	public void sayHello() {
		System.out.println("hello");
	}
}
```

这个文件编译出来的 class 文件会非常小，但是里面却使用了 String、System、PrintStream 以及 Object 等结构。这里的代码量其实已经很小了，如果代码多，引用到的结构会更多！这里就需要常量池了


# 常量池中有什么？

- 数量值
- 字符串值
- 类引用
- 字段引用
- 方法引用

# 运行时常量池

- 运行时常量池是方法区的一部分
- 常量池表是 Class 文件的一部分，**用于存放编译器生成的各种字面量和符号引用**，这部分内容在类加载后存放在方法区的运行时常量池中
- 运行时常量池，在加载类和接口到虚拟机后，就会创建对应的运行时常量池
- JVM 为每个已加载的类型（类或借口）都维护一个常量池。池中的数据项像数组项一样，是通过**索引访问**的
- 运行时常量池中包含多种不同的常量，包括编译器就已经明确的数值字面量，也包括运行期解析后才能获得的方法或者字段引用。此时不再是常量池中的符号地址了，这里换为真实地址
	- 运行时常量池，相对于 Class 文件常量池的另一重要特性是：具备动态性
- 运行时常量池类似于传统编程语言中的符号表，但是它所包含的数据却比符号表要更丰富一些
- 当创建类或借口的运行时常量池时，如果构造运行时常量池所需的内存空间超过了方法区所能提供的最大值，则 JVM 会抛 OOM 异常。

