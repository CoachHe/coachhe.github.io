---
title: 3. 无意识的递归  
date: 2022-12-16 01:29:54  
tags: []  
---

和其他类一样，Java 的标准集合最终也是从 `Object` 继承来的，所以它们也包含了一个 `toString` 方法。这个方法从集合中被重写，这样它生成的结果字符串就能表示容器自身，以及该容器持有的所有对象。以 `ArrayList.toString()` 为例，它会遍历 `ArrayList` 的元素并为每个元素调用 `toString()` 方法。

```java
/**
 * @author CoachHe
 * @date 2022/12/16 01:32
 **/
public class ArrayListDisplay {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        list.add(1);
        list.add(5);
        System.out.println(list);
    }
}
```

输出：

<img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221216013425.png" width = "70%" />

可以看到，这里输出的不是默认的地址，而是一串可视化的数字。这是因为 `ArrayList` 继承自 `AbstractCollection`，它重写了 `toString` 方法。

```java
public String toString() {  
    Iterator<E> it = iterator();  
    if (! it.hasNext())  
        return "[]";  
  
    StringBuilder sb = new StringBuilder();  
    sb.append('[');  
    for (;;) {  
        E e = it.next();  
        sb.append(e == this ? "(this Collection)" : e);  
        if (! it.hasNext())  
            return sb.append(']').toString();  
        sb.append(',').append(' ');  
    }  
}
```

如果希望 `toString()` 打印对象的内存地址，使用 this 来实现：

```java
/**
 * @author CoachHe
 * @date 2022/12/16 01:37
 **/
public class InfiniteRecursion {
    

    public static void main(String[] args) {
        Stream.generate(InfiniteRecursion::new)
                .limit(10)
                .forEach(System.out::println);
    }
}
```

<img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221216013945.png" width = "70%" />

可以看到，直接打印结果是对象的地址。此时如果我们重写了 `toString()` 方法：

```java
/**
 * @author CoachHe
 * @date 2022/12/16 01:37
 **/
public class InfiniteRecursion {

    @Override
    public String toString() {
        return "InfiniteRecursion address: " + this + "\n";
    }

    public static void main(String[] args) {
        Stream.generate(InfiniteRecursion::new)
                .limit(10)
                .forEach(System.out::println);
    }
}
```

<img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221216014212.png" width = "80%" />

可以看到，这里直接报错了，这是因为

```java
"InfiniteRecursion address: " + this + "\n";
```

这行代码zhi'xi