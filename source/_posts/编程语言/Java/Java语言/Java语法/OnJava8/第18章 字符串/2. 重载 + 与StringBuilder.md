---
title: 2. 重载 + 与StringBuilder  
date: 2022-12-15 01:50:09  
tags: []  
---

在上一节 [[1. 字符串概述]]中我们知道，`String` 对象是不可变的，因此我们可以根据需要为特定的 `String` 设置多个别名。因为 `String` 是只读的，指向它的任何引用都不可能改变它的值，所以引用之间不会相互影响。

不可变性可能会带来效率问题。

一个典型的例子是操作符 `+`，它针对 `String` 对象做了重载。==操作符重载==意味着在与特定类一起使用时，相应的操作符具有额外的意义。（应用于 `String` 的 `+` 和 `+=` 是 Java 中仅有的被重载的操作符，Java 中不允许程序员重构其他操作符）

`+` 操作可以用来拼接字符串：

在进行之前我们先了解一下拼接的规则：

1. 常量和常量的拼接结果在常量池，原理是编译器优化
2. 常量池中不会存在相同内容的变量
3. **只要其中有一个是变量，结果就在堆中**。变量拼接的原理是 `StringBuilder`
4. 如果拼接的结果调用 `intern()` 方法，则主动将常量池中还没有的字符串对象放入池中，并返回此对象地址

让我们慢慢来看，首先是上面第一条 L常量和常量的拼接结果在常量池

```java
    // 证明常量拼接之后会通过编译器间优化放入常量池中
    @Test
    public void ConcatenationTest1(){
        String a = "abc";
        String b = "a" + "b" + "c";
        /**
         * 最终，java编译成.class，再执行.class
         * String a = "abc";
         * String b = "abc";
         */
        System.out.println(a == b); //true
        System.out.println(a.equals(b)); //true
    }
```

可以看到，判断 `a == b` 时输出的是 `true`，这是因为在编译期进行优化，可以看下编译之后的 class 文件反编译的结果：

<img src=" https://coachhe-1305181419.cos.ap-guangzhou.myqcloud.com/%E7%A8%8B%E5%BA%8F%E5%91%98/%E5%B7%A5%E5%85%B7/git/20221215024246.png" width = "70%" />

可以看到，编译期间进行了优化。





```java
/**  
 * @author CoachHe  
 * @date 2022/12/15 02:37  
 **/public class Concatenation {  
    public static void main(String[] args) {  
        String mango = "mango";  
        String s = "abc" + mango + "def" + 47;  
        System.out.println(s);  
    }  
}
```

